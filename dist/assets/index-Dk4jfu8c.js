import{Q as ns,u as ge,a as ni,b as de,j as i,c as os}from"./query-BHFOmHtL.js";import{a as rs,u as _e,L as tt,b as ht,r as D,R as He,c as po,d as ss,g as as,B as ls,e as ho,f as je}from"./vendor-fFS1ukCR.js";import{c as ds}from"./supabase-GtAdROLV.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))l(d);new MutationObserver(d=>{for(const p of d)if(p.type==="childList")for(const u of p.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function r(d){const p={};return d.integrity&&(p.integrity=d.integrity),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?p.credentials="include":d.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function l(d){if(d.ep)return;d.ep=!0;const p=r(d);fetch(d.href,p)}})();var qi={},so=rs;qi.createRoot=so.createRoot,qi.hydrateRoot=so.hydrateRoot;var cs=function(){return null};const us=new ns({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*30,retry:1,refetchOnWindowFocus:!0,refetchOnMount:!0},mutations:{retry:0}}}),ps=void 0,hs=void 0;throw new Error("Missing Supabase environment variables");const T=ds(ps,hs),pt={async getAll(n,s={}){const{category:r,isDefault:l,search:d}=s;let p=T.from("email_templates").select("*").eq("owner_id",n).order("is_default",{ascending:!1}).order("name");r&&(p=p.eq("category",r)),typeof l=="boolean"&&(p=p.eq("is_default",l)),d&&(p=p.or(`name.ilike.%${d}%,subject.ilike.%${d}%`));const{data:u,error:x}=await p;if(x)throw x;return u},async getById(n,s){const{data:r,error:l}=await T.from("email_templates").select("*").eq("owner_id",n).eq("id",s).single();if(l)throw l;return r},async getByDefaultKey(n,s){const{data:r,error:l}=await T.from("email_templates").select("*").eq("owner_id",n).eq("default_key",s).single();if(l)throw l;return r},async create(n,s){const{data:r,error:l}=await T.from("email_templates").insert({owner_id:n,is_default:!1,...s}).select().single();if(l)throw l;return r},async update(n,s,r){const{data:l,error:d}=await T.from("email_templates").update({...r,updated_at:new Date().toISOString()}).eq("owner_id",n).eq("id",s).select().single();if(d)throw d;return l},async delete(n,s){const{error:r}=await T.from("email_templates").delete().eq("owner_id",n).eq("id",s).eq("is_default",!1);if(r)throw r;return!0},async duplicate(n,s){const r=await this.getById(n,s),{data:l,error:d}=await T.from("email_templates").insert({owner_id:n,is_default:!1,default_key:null,name:`${r.name} (Copy)`,subject:r.subject,body_html:r.body_html,body_text:r.body_text,category:r.category,merge_fields:r.merge_fields}).select().single();if(d)throw d;return l},async getByCategory(n,s){const{data:r,error:l}=await T.from("email_templates").select("*").eq("owner_id",n).eq("category",s).order("is_default",{ascending:!1}).order("name");if(l)throw l;return r},async getCategories(n){const{data:s,error:r}=await T.from("email_templates").select("category").eq("owner_id",n).not("category","is",null);if(r)throw r;return[...new Set(s.map(l=>l.category))]},async resetToDefault(n,s){return this.getById(n,s)}},$i=()=>{const{userId:n}=_e();return n};function fo(n={}){const s=$i();return ge({queryKey:["templates",s,n],queryFn:()=>pt.getAll(s,n),enabled:!!s})}function fs(){const n=$i();return ge({queryKey:["templates",n,"categories"],queryFn:()=>pt.getCategories(n),enabled:!!n})}function xo(){const n=$i(),s=ni(),r=()=>{s.invalidateQueries({queryKey:["templates",n]})},l=de({mutationFn:x=>pt.create(n,x),onSuccess:r}),d=de({mutationFn:({templateId:x,updates:g})=>pt.update(n,x,g),onSuccess:x=>{r(),s.setQueryData(["template",n,x.id],x)}}),p=de({mutationFn:x=>pt.delete(n,x),onSuccess:r}),u=de({mutationFn:x=>pt.duplicate(n,x),onSuccess:r});return{createTemplate:l,updateTemplate:d,deleteTemplate:p,duplicateTemplate:u}}const Ce={async getAll(n,s={}){const{status:r,category:l,search:d}=s;let p=T.from("automations").select(`
        *,
        _count:automation_enrollments(count)
      `).eq("owner_id",n).order("is_default",{ascending:!1}).order("name");r&&(p=p.eq("status",r)),l&&(p=p.eq("category",l)),d&&(p=p.or(`name.ilike.%${d}%,description.ilike.%${d}%`));const{data:u,error:x}=await p;if(x)throw x;return u},async getAllWithStats(n){const{data:s,error:r}=await T.from("automations").select("*").eq("owner_id",n).order("is_default",{ascending:!1}).order("name");if(r)throw r;const l=s.map(x=>x.id),{data:d,error:p}=await T.from("automation_enrollments").select("automation_id, status").in("automation_id",l);if(p)throw p;const u={};return d.forEach(x=>{u[x.automation_id]||(u[x.automation_id]={total:0,active:0,completed:0,exited:0}),u[x.automation_id].total++,u[x.automation_id][x.status.toLowerCase()]++}),s.map(x=>({...x,enrollmentStats:u[x.id]||{total:0,active:0,completed:0,exited:0}}))},async getById(n,s){const{data:r,error:l}=await T.from("automations").select("*").eq("owner_id",n).eq("id",s).single();if(l)throw l;return r},async getByIdWithDetails(n,s){const r=await this.getById(n,s),{data:l,error:d}=await T.from("automation_enrollments").select("status").eq("automation_id",s);if(d)throw d;const p={total:l.length,active:l.filter(f=>f.status==="Active").length,completed:l.filter(f=>f.status==="Completed").length,exited:l.filter(f=>f.status==="Exited").length,paused:l.filter(f=>f.status==="Paused").length},{data:u,error:x}=await T.from("email_logs").select("status, open_count, click_count").eq("automation_id",s);if(x)throw x;const g={sent:u.length,delivered:u.filter(f=>f.status==="Delivered"||f.status==="Opened"||f.status==="Clicked").length,opened:u.filter(f=>f.open_count>0).length,clicked:u.filter(f=>f.click_count>0).length,bounced:u.filter(f=>f.status==="Bounced").length};return{...r,enrollmentStats:p,emailSummary:g}},async getByDefaultKey(n,s){const{data:r,error:l}=await T.from("automations").select("*").eq("owner_id",n).eq("default_key",s).single();if(l)throw l;return r},async create(n,s){const{data:r,error:l}=await T.from("automations").insert({owner_id:n,is_default:!1,status:"Draft",...s}).select().single();if(l)throw l;return r},async update(n,s,r){const{data:l,error:d}=await T.from("automations").update({...r,updated_at:new Date().toISOString()}).eq("owner_id",n).eq("id",s).select().single();if(d)throw d;return l},async updateStatus(n,s,r){return this.update(n,s,{status:r})},async activate(n,s){return this.updateStatus(n,s,"active")},async pause(n,s){return this.updateStatus(n,s,"paused")},async archive(n,s){return this.updateStatus(n,s,"archived")},async delete(n,s){const{error:r}=await T.from("automations").delete().eq("owner_id",n).eq("id",s).eq("is_default",!1);if(r)throw r;return!0},async duplicate(n,s){const r=await this.getById(n,s),{data:l,error:d}=await T.from("automations").insert({owner_id:n,is_default:!1,default_key:null,name:`${r.name} (Copy)`,description:r.description,category:r.category,status:"Draft",send_time:r.send_time,timezone:r.timezone,frequency:r.frequency,max_enrollments:r.max_enrollments,enrollment_cooldown_days:r.enrollment_cooldown_days,distribute_evenly:r.distribute_evenly,filter_config:r.filter_config,nodes:r.nodes}).select().single();if(d)throw d;return l},async updateFilters(n,s,r){return this.update(n,s,{filter_config:r})},async updateNodes(n,s,r){return this.update(n,s,{nodes:r})},async updateSchedule(n,s,r){const{sendTime:l,timezone:d,frequency:p}=r;return this.update(n,s,{send_time:l,timezone:d,frequency:p})},async updateEnrollmentRules(n,s,r){const{maxEnrollments:l,cooldownDays:d,distributeEvenly:p}=r;return this.update(n,s,{max_enrollments:l,enrollment_cooldown_days:d,distribute_evenly:p})},async getByStatus(n,s){const{data:r,error:l}=await T.from("automations").select("*").eq("owner_id",n).eq("status",s).order("name");if(l)throw l;return r},async getActive(n){return this.getByStatus(n,"Active")},async getCategories(n){const{data:s,error:r}=await T.from("automations").select("category").eq("owner_id",n).not("category","is",null);if(r)throw r;return[...new Set(s.map(l=>l.category))]}},Fi=()=>{const{userId:n}=_e();return n};function xs(){const n=Fi();return ge({queryKey:["automations",n,"withStats"],queryFn:()=>Ce.getAllWithStats(n),enabled:!!n})}function ms(n){const s=Fi();return ge({queryKey:["automation",s,n],queryFn:()=>Ce.getById(s,n),enabled:!!s&&!!n})}function mo(){const n=Fi(),s=ni(),r=()=>{s.invalidateQueries({queryKey:["automations",n]})},l=de({mutationFn:S=>Ce.create(n,S),onSuccess:r}),d=de({mutationFn:({automationId:S,updates:k})=>Ce.update(n,S,k),onSuccess:S=>{r(),s.setQueryData(["automation",n,S.id],S)}}),p=de({mutationFn:S=>Ce.delete(n,S),onSuccess:r}),u=de({mutationFn:S=>Ce.duplicate(n,S),onSuccess:r}),x=de({mutationFn:S=>Ce.activate(n,S),onSuccess:S=>{r(),s.setQueryData(["automation",n,S.id],S)}}),g=de({mutationFn:S=>Ce.pause(n,S),onSuccess:S=>{r(),s.setQueryData(["automation",n,S.id],S)}}),f=de({mutationFn:S=>Ce.archive(n,S),onSuccess:r}),M=de({mutationFn:({automationId:S,filterConfig:k})=>Ce.updateFilters(n,S,k),onSuccess:S=>{s.setQueryData(["automation",n,S.id],S)}}),b=de({mutationFn:({automationId:S,nodes:k})=>Ce.updateNodes(n,S,k),onSuccess:S=>{s.setQueryData(["automation",n,S.id],S)}}),I=de({mutationFn:({automationId:S,scheduleConfig:k})=>Ce.updateSchedule(n,S,k),onSuccess:S=>{s.setQueryData(["automation",n,S.id],S)}}),j=de({mutationFn:({automationId:S,rules:k})=>Ce.updateEnrollmentRules(n,S,k),onSuccess:S=>{s.setQueryData(["automation",n,S.id],S)}});return{createAutomation:l,updateAutomation:d,deleteAutomation:p,duplicateAutomation:u,activateAutomation:x,pauseAutomation:g,archiveAutomation:f,updateFilters:M,updateNodes:b,updateSchedule:I,updateEnrollmentRules:j}}const gs={async getByAutomation(n,s={}){const{status:r,limit:l=50,offset:d=0}=s;let p=T.from("automation_enrollments").select(`
        *,
        account:accounts(
          account_unique_id,
          name,
          person_email,
          email,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("automation_id",n).order("enrolled_at",{ascending:!1}).range(d,d+l-1);r&&(p=p.eq("status",r));const{data:u,error:x}=await p;if(x)throw x;return u},async getByAccount(n,s={}){const{status:r}=s;let l=T.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category, status)
      `).eq("account_id",n).order("enrolled_at",{ascending:!1});r&&(l=l.eq("status",r));const{data:d,error:p}=await l;if(p)throw p;return d},async getById(n){const{data:s,error:r}=await T.from("automation_enrollments").select(`
        *,
        account:accounts(*),
        automation:automations(*)
      `).eq("id",n).single();if(r)throw r;return s},async getStats(n){const{data:s,error:r}=await T.from("automation_enrollments").select("status, emails_sent, emails_opened, emails_clicked").eq("automation_id",n);if(r)throw r;const l={total:s.length,active:0,completed:0,exited:0,paused:0,totalEmailsSent:0,totalOpens:0,totalClicks:0};return s.forEach(d=>{l[d.status.toLowerCase()]++,l.totalEmailsSent+=d.emails_sent||0,l.totalOpens+=d.emails_opened||0,l.totalClicks+=d.emails_clicked||0}),l},async canEnroll(n,s){const{data:r,error:l}=await T.rpc("can_enroll_in_automation",{p_account_id:n,p_automation_id:s});if(l)throw l;return r},async enroll(n,s,r={}){var f;if(!await this.canEnroll(s,n))throw new Error("Account cannot be enrolled in this automation");const{data:d,error:p}=await T.from("automations").select("nodes").eq("id",n).single();if(p)throw p;const u=(f=d.nodes)==null?void 0:f[0],{data:x,error:g}=await T.from("automation_enrollments").insert({automation_id:n,account_id:s,status:"Active",current_node_id:(u==null?void 0:u.id)||null,metadata:r}).select().single();if(g)throw g;return x},async bulkEnroll(n,s){const r={enrolled:[],skipped:[],errors:[]};for(const l of s)try{if(await this.canEnroll(l,n)){const p=await this.enroll(n,l);r.enrolled.push(p)}else r.skipped.push(l)}catch(d){r.errors.push({accountId:l,error:d.message})}return r},async exit(n,s="manual"){const{data:r,error:l}=await T.from("automation_enrollments").update({status:"Exited",exit_reason:s,exited_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",n).select().single();if(l)throw l;return r},async pause(n){const{data:s,error:r}=await T.from("automation_enrollments").update({status:"Paused",updated_at:new Date().toISOString()}).eq("id",n).select().single();if(r)throw r;return s},async resume(n){const{data:s,error:r}=await T.from("automation_enrollments").update({status:"Active",updated_at:new Date().toISOString()}).eq("id",n).select().single();if(r)throw r;return s},async complete(n){const{data:s,error:r}=await T.from("automation_enrollments").update({status:"Completed",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",n).select().single();if(r)throw r;return s},async updateProgress(n,s,r=null){const{data:l,error:d}=await T.from("automation_enrollments").update({current_node_id:s,current_branch:r,last_action_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",n).select().single();if(d)throw d;return l},async setNextAction(n,s){const{data:r,error:l}=await T.from("automation_enrollments").update({next_action_at:s,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(l)throw l;return r},async incrementEmailSent(n){const{data:s,error:r}=await T.rpc("increment_enrollment_email_sent",{p_enrollment_id:n});if(r){const{data:l}=await T.from("automation_enrollments").select("emails_sent").eq("id",n).single();return T.from("automation_enrollments").update({emails_sent:((l==null?void 0:l.emails_sent)||0)+1}).eq("id",n)}return s},async getReadyForAction(){const{data:n,error:s}=await T.from("automation_enrollments").select(`
        *,
        automation:automations(*),
        account:accounts(*)
      `).eq("status","Active").lte("next_action_at",new Date().toISOString()).order("next_action_at");if(s)throw s;return n},async getHistory(n){const{data:s,error:r}=await T.from("enrollment_history").select(`
        *,
        email_log:email_logs(id, subject, status, sent_at, first_opened_at, first_clicked_at)
      `).eq("enrollment_id",n).order("created_at",{ascending:!0});if(r)throw r;return s},async logHistory(n,s){const{data:r,error:l}=await T.from("enrollment_history").insert({enrollment_id:n,...s}).select().single();if(l)throw l;return r}};function _s(n,s={}){return ge({queryKey:["enrollments","account",n,s],queryFn:()=>gs.getByAccount(n,s),enabled:!!n,staleTime:3e4})}const ti={async getAll(n,s={}){const{status:r,automationId:l,accountId:d,limit:p=50,offset:u=0,startDate:x,endDate:g}=s;let f=T.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email, primary_contact_first_name),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",n).order("created_at",{ascending:!1}).range(u,u+p-1);r&&(f=f.eq("status",r)),l&&(f=f.eq("automation_id",l)),d&&(f=f.eq("account_id",d)),x&&(f=f.gte("sent_at",x)),g&&(f=f.lte("sent_at",g));const{data:M,error:b}=await f;if(b)throw b;return M},async getById(n,s){const{data:r,error:l}=await T.from("email_logs").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name),
        enrollment:automation_enrollments(id, status)
      `).eq("owner_id",n).eq("id",s).single();if(l)throw l;return r},async getByIdWithEvents(n,s){const r=await this.getById(n,s),{data:l,error:d}=await T.from("email_events").select("*").eq("email_log_id",s).order("event_timestamp",{ascending:!0});if(d)throw d;return{...r,events:l}},async getByAccount(n,s,r={}){const{limit:l=20}=r,{data:d,error:p}=await T.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",n).eq("account_id",s).order("created_at",{ascending:!1}).limit(l);if(p)throw p;return d},async getByAutomation(n,s,r={}){const{limit:l=50,offset:d=0,status:p}=r;let u=T.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",n).eq("automation_id",s).order("created_at",{ascending:!1}).range(d,d+l-1);p&&(u=u.eq("status",p));const{data:x,error:g}=await u;if(g)throw g;return x},async create(n,s){const{data:r,error:l}=await T.from("email_logs").insert({owner_id:n,status:"Queued",...s}).select().single();if(l)throw l;return r},async updateStatus(n,s,r,l={}){const{data:d,error:p}=await T.from("email_logs").update({status:r,...l,updated_at:new Date().toISOString()}).eq("owner_id",n).eq("id",s).select().single();if(p)throw p;return d},async markSent(n,s,r){return this.updateStatus(n,s,"Sent",{sent_at:new Date().toISOString(),sendgrid_message_id:r})},async markFailed(n,s,r,l=null){return this.updateStatus(n,s,"Failed",{failed_at:new Date().toISOString(),error_message:r,error_code:l})},async getRecentOpens(n,s=10){const{data:r,error:l}=await T.from("email_logs").select(`
        id, subject, first_opened_at, open_count,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",n).not("first_opened_at","is",null).order("first_opened_at",{ascending:!1}).limit(s);if(l)throw l;return r},async getRecentClicks(n,s=10){const{data:r,error:l}=await T.from("email_logs").select(`
        id, subject, first_clicked_at, click_count,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",n).not("first_clicked_at","is",null).order("first_clicked_at",{ascending:!1}).limit(s);if(l)throw l;return r},async getBounces(n,s={}){const{limit:r=50,offset:l=0}=s,{data:d,error:p}=await T.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",n).eq("status","Bounced").order("bounced_at",{ascending:!1}).range(l,l+r-1);if(p)throw p;return d},async getStats(n,s,r,l=null){const{data:d,error:p}=await T.rpc("get_email_stats",{p_owner_id:n,p_start_date:s,p_end_date:r,p_automation_id:l});if(p)throw p;return(d==null?void 0:d[0])||{total_sent:0,total_delivered:0,total_opened:0,unique_opens:0,total_clicked:0,unique_clicks:0,total_bounced:0,open_rate:0,click_rate:0}},async getDailyStats(n,s,r,l=null){let d=T.from("email_stats_daily").select("*").eq("owner_id",n).gte("stat_date",s).lte("stat_date",r).order("stat_date");l?d=d.eq("automation_id",l):d=d.is("automation_id",null);const{data:p,error:u}=await d;if(u)throw u;return p},async getComparisonStats(n,s=30){const r=new Date,l=new Date(r);l.setDate(l.getDate()-s);const d=new Date(l);d.setDate(d.getDate()-s);const[p,u]=await Promise.all([this.getStats(n,l.toISOString().split("T")[0],r.toISOString().split("T")[0]),this.getStats(n,d.toISOString().split("T")[0],l.toISOString().split("T")[0])]),x=(g,f)=>f===0?g>0?100:0:((g-f)/f*100).toFixed(1);return{current:p,previous:u,changes:{sent:x(p.total_sent,u.total_sent),delivered:x(p.total_delivered,u.total_delivered),opened:x(p.unique_opens,u.unique_opens),clicked:x(p.unique_clicks,u.unique_clicks),bounced:x(p.total_bounced,u.total_bounced)}}}},ys=()=>{const{userId:n}=_e();return n};function vs(n,s={}){const r=ys();return ge({queryKey:["emailLogs",r,"account",n,s],queryFn:()=>ti.getByAccount(r,n,s),enabled:!!r&&!!n,staleTime:3e4})}const go={async getRecent(n,s={}){const{category:r,limit:l=20,offset:d=0}=s;let p=T.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name),
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).eq("owner_id",n).order("created_at",{ascending:!1}).range(d,d+l-1);r&&(p=p.eq("event_category",r));const{data:u,error:x}=await p;if(x)throw x;return u},async getByAccount(n,s,r=20){const{data:l,error:d}=await T.from("activity_log").select(`
        *,
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).eq("owner_id",n).eq("account_id",s).order("created_at",{ascending:!1}).limit(r);if(d)throw d;return l},async getByAutomation(n,s,r=50){const{data:l,error:d}=await T.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("owner_id",n).eq("automation_id",s).order("created_at",{ascending:!1}).limit(r);if(d)throw d;return l},async getByType(n,s,r={}){const{limit:l=50,offset:d=0}=r,{data:p,error:u}=await T.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("owner_id",n).eq("event_type",s).order("created_at",{ascending:!1}).range(d,d+l-1);if(u)throw u;return p},async log(n,s){const{data:r,error:l}=await T.from("activity_log").insert({owner_id:n,...s}).select().single();if(l)throw l;return r},async logEmailSent(n,s,r,l=null){return this.log(n,{event_type:"email_sent",event_category:"email",title:"Email sent",email_log_id:s,account_id:r,automation_id:l,actor_type:l?"automation":"user"})},async logEmailOpened(n,s,r){return this.log(n,{event_type:"email_opened",event_category:"email",title:"Email opened",email_log_id:s,account_id:r,actor_type:"system"})},async logEmailClicked(n,s,r,l=null){return this.log(n,{event_type:"email_clicked",event_category:"email",title:"Email link clicked",email_log_id:s,account_id:r,actor_type:"system",event_data:l?{url:l}:{}})},async logEnrollment(n,s,r,l){return this.log(n,{event_type:"enrollment_created",event_category:"automation",title:`Enrolled in ${l}`,automation_id:s,account_id:r,actor_type:"automation"})},async logAutomationCompleted(n,s,r,l){return this.log(n,{event_type:"automation_completed",event_category:"automation",title:`Completed ${l}`,automation_id:s,account_id:r,actor_type:"automation"})},async logUnsubscribe(n,s,r,l=null){return this.log(n,{event_type:"unsubscribed",event_category:"account",title:r==="all"?"Unsubscribed from all emails":"Unsubscribed from automation",account_id:s,automation_id:l,actor_type:"system",severity:"warning"})},async logBounce(n,s,r,l){return this.log(n,{event_type:"email_bounced",event_category:"email",title:`Email bounced (${l})`,email_log_id:s,account_id:r,actor_type:"system",severity:"warning",event_data:{bounce_type:l}})},async getStats(n,s=7){const r=new Date;r.setDate(r.getDate()-s);const{data:l,error:d}=await T.from("activity_log").select("event_type, event_category").eq("owner_id",n).gte("created_at",r.toISOString());if(d)throw d;const p={total:l.length,byType:{},byCategory:{}};return l.forEach(u=>{p.byType[u.event_type]=(p.byType[u.event_type]||0)+1,p.byCategory[u.event_category]=(p.byCategory[u.event_category]||0)+1}),p}},_o={async getAll(n,s={}){const{status:r,automationId:l,limit:d=50,offset:p=0}=s;let u=T.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",n).order("scheduled_for",{ascending:!0}).range(p,p+d-1);r&&(u=u.eq("status",r)),l&&(u=u.eq("automation_id",l));const{data:x,error:g}=await u;if(g)throw g;return x},async getUpcoming(n,s=10){const{data:r,error:l}=await T.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        automation:automations(id, name)
      `).eq("owner_id",n).eq("status","Pending").gte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0}).limit(s);if(l)throw l;return r},async getReadyToSend(){const{data:n,error:s}=await T.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name, owner_id)
      `).eq("status","Pending").lte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0});if(s)throw s;return n},async getById(n,s){const{data:r,error:l}=await T.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name)
      `).eq("owner_id",n).eq("id",s).single();if(l)throw l;return r},async create(n,s){const{data:r,error:l}=await T.from("scheduled_emails").insert({owner_id:n,status:"Pending",...s}).select().single();if(l)throw l;return r},async createBatch(n,s){const r=s.map(p=>({owner_id:n,status:"Pending",...p})),{data:l,error:d}=await T.from("scheduled_emails").insert(r).select();if(d)throw d;return l},async update(n,s,r){const{data:l,error:d}=await T.from("scheduled_emails").update({...r,updated_at:new Date().toISOString()}).eq("owner_id",n).eq("id",s).select().single();if(d)throw d;return l},async cancel(n,s){return this.update(n,s,{status:"Cancelled"})},async reschedule(n,s,r){return this.update(n,s,{scheduled_for:r,status:"Pending",attempts:0})},async markProcessing(n){const{data:s,error:r}=await T.from("scheduled_emails").update({status:"Processing",last_attempt_at:new Date().toISOString(),attempts:T.sql`attempts + 1`,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(r)throw r;return s},async markSent(n,s){const{data:r,error:l}=await T.from("scheduled_emails").update({status:"Sent",email_log_id:s,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(l)throw l;return r},async markFailed(n,s){const{data:r,error:l}=await T.from("scheduled_emails").select("attempts, max_attempts").eq("id",n).single();if(l)throw l;const d=r.attempts<r.max_attempts,{data:p,error:u}=await T.from("scheduled_emails").update({status:d?"Pending":"Failed",error_message:s,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(u)throw u;return p},async delete(n,s){const{error:r}=await T.from("scheduled_emails").delete().eq("owner_id",n).eq("id",s);if(r)throw r;return!0},async getStats(n){const{data:s,error:r}=await T.from("scheduled_emails").select("status, scheduled_for").eq("owner_id",n);if(r)throw r;const l=new Date,d={pending:0,processing:0,sent:0,failed:0,cancelled:0,upcomingToday:0,upcomingThisWeek:0},p=new Date(l);p.setHours(23,59,59,999);const u=new Date(l);return u.setDate(u.getDate()+7),s.forEach(x=>{if(d[x.status.toLowerCase()]++,x.status==="Pending"){const g=new Date(x.scheduled_for);g<=p&&d.upcomingToday++,g<=u&&d.upcomingThisWeek++}}),d}},Rt={async getAll(n,s={}){const{status:r,search:l,limit:d=25,offset:p=0,expiring:u=!1}=s;let x=T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n);if(r){let O=r;r.toLowerCase()==="prior"&&(O="prior_customer"),x=x.ilike("account_status",O)}l&&(x=x.or(`name.ilike.%${l}%,person_email.ilike.%${l}%,email.ilike.%${l}%`));const{count:g,error:f}=await x;if(f)throw f;let M=T.from("accounts").select("*").eq("owner_id",n).order("name").range(p,p+d-1);if(r){let O=r;r.toLowerCase()==="prior"&&(O="prior_customer"),M=M.ilike("account_status",O)}l&&(M=M.or(`name.ilike.%${l}%,person_email.ilike.%${l}%,email.ilike.%${l}%`));const{data:b,error:I}=await M;if(I)throw I;if(!b||b.length===0)return{accounts:[],total:g||0};const j=b.map(O=>O.account_unique_id).filter(Boolean),k=new Date().toISOString().split("T")[0],R=new Date;R.setDate(R.getDate()+30);const v=R.toISOString().split("T")[0];if(j.length>0){const{data:O,error:Z}=await T.from("policies").select("account_id, policy_lob, policy_status, expiration_date").in("account_id",j);if(!Z&&O){const E={};O.forEach(z=>{var K;E[z.account_id]||(E[z.account_id]=[]);const W=z.expiration_date&&z.expiration_date>=k&&z.expiration_date<=v;E[z.account_id].push({policy_type:z.policy_lob,status:((K=z.policy_status)==null?void 0:K.toLowerCase())||"unknown",expiration_date:z.expiration_date,is_expiring:W})}),b.forEach(z=>{z.policies=E[z.account_unique_id]||[],z.policy_count=z.policies.length,z.has_expiring_policy=z.policies.some(W=>W.is_expiring),z.expiring_policy_count=z.policies.filter(W=>W.is_expiring).length})}}if(u){const O=b.filter(Z=>Z.has_expiring_policy);return{accounts:O,total:O.length,isExpiringFilter:!0}}return{accounts:b,total:g||0}},async getStats(n){const{count:s,error:r}=await T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n);if(r)throw r;const{count:l}=await T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n).ilike("account_status","customer"),{count:d}=await T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n).ilike("account_status","prospect"),{count:p}=await T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n).ilike("account_status","prior_customer"),{count:u}=await T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n).ilike("account_status","lead");let x=0;const g=new Date().toISOString().split("T")[0],f=new Date;f.setDate(f.getDate()+30);const M=f.toISOString().split("T")[0],{count:b}=await T.from("policies").select("*",{count:"exact",head:!0}).gte("expiration_date",g).lte("expiration_date",M);if(b&&b>0){const{data:I}=await T.from("policies").select("account_id").gte("expiration_date",g).lte("expiration_date",M).limit(5e3);if(I&&I.length>0){const j=[...new Set(I.map(S=>S.account_id).filter(Boolean))];if(j.length>0){let S=0;const k=100;for(let R=0;R<j.length;R+=k){const v=j.slice(R,R+k),{count:O}=await T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n).in("account_unique_id",v);S+=O||0}x=S}}}return{Customer:l||0,Prospect:d||0,Prior:p||0,Lead:u||0,total:s||0,expiring:x}},async getById(n){const{data:s,error:r}=await T.from("accounts").select("*").eq("account_unique_id",n).single();if(r)throw r;return s},async getByIdWithPolicies(n){const{data:s,error:r}=await T.from("accounts").select("*").eq("account_unique_id",n).single();if(r)throw r;if(!s)return null;const{data:l,error:d}=await T.from("policies").select("*").eq("account_id",n).order("expiration_date",{ascending:!1});if(d)return console.error("Error fetching policies:",d),{...s,policies:[]};if(l&&l.length>0){const p=[...new Set(l.map(u=>u.carrier_id).filter(Boolean))];if(p.length>0){const{data:u,error:x}=await T.from("carriers").select("id, name").in("id",p);if(u&&u.length>0){const g={};u.forEach(f=>{g[f.id]=f.name}),l.forEach(f=>{f.carrier_id&&g[f.carrier_id]&&(f.carrier={name:g[f.carrier_id]})})}}}return{...s,policies:l||[]}},async getByIdWithEmailHistory(n,s){const r=await this.getByIdWithPolicies(s),{data:l,error:d}=await T.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",n).eq("account_id",s).order("created_at",{ascending:!1}).limit(20);if(d)throw d;const{data:p,error:u}=await T.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category)
      `).eq("account_id",s).order("enrolled_at",{ascending:!1});if(u)throw u;return{...r,emailLogs:l,enrollments:p}},async search(n,s,r=20){const{data:l,error:d}=await T.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name").eq("owner_id",n).or(`name.ilike.%${s}%,person_email.ilike.%${s}%,email.ilike.%${s}%,primary_contact_first_name.ilike.%${s}%,primary_contact_last_name.ilike.%${s}%`).limit(r);if(d)throw d;return l},async getByStatus(n,s,r={}){const{limit:l=50,offset:d=0}=r,{data:p,error:u}=await T.from("accounts").select("*").eq("owner_id",n).eq("account_status",s).order("name").range(d,d+l-1);if(u)throw u;return p},async getCustomers(n,s={}){return this.getByStatus(n,"customer",s)},async getProspects(n,s={}){return this.getByStatus(n,"prospect",s)},async getPriorCustomers(n,s={}){return this.getByStatus(n,"prior_customer",s)},async getWithExpiringPolicies(n,s=45){const r=new Date;r.setDate(r.getDate()+s);const{data:l,error:d}=await T.from("policies").select(`
        policy_unique_id,
        policy_lob,
        expiration_date,
        policy_status,
        account_id,
        account:accounts!policies_account_id_fkey(
          account_unique_id,
          name,
          person_email,
          email,
          owner_id,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("policy_status","Active").lte("expiration_date",r.toISOString().split("T")[0]).gte("expiration_date",new Date().toISOString().split("T")[0]).order("expiration_date");if(d)throw d;return l.filter(p=>{var u;return((u=p.account)==null?void 0:u.owner_id)===n})},async getCounts(n){const{data:s,error:r}=await T.from("accounts").select("account_status").eq("owner_id",n);if(r)throw r;const l={total:s.length,customer:0,prospect:0,prior_customer:0,other:0};return s.forEach(d=>{var u;const p=((u=d.account_status)==null?void 0:u.toLowerCase().replace(" ","_"))||"other";l[p]!==void 0?l[p]++:l.other++}),l},getEmail(n){return n.person_email||n.email},getDisplayName(n){return n.primary_contact_first_name?`${n.primary_contact_first_name} ${n.primary_contact_last_name||""}`.trim():n.name},canReceiveMarketing(n){return n.user_subscribed_to_marketing!==!1&&n.person_has_opted_out_of_email!==!0&&(n.person_email||n.email)},async getEligibleForAutomation(n,s){let r=T.from("accounts").select("*").eq("owner_id",n).or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false").not("person_email","is",null);const{data:l,error:d}=await r;if(d)throw d;const p=l.map(f=>f.account_unique_id),{data:u,error:x}=await T.from("policies").select("*").in("account_id",p);if(x)throw x;return l.map(f=>({...f,policies:u.filter(M=>M.account_id===f.account_unique_id)})).filter(f=>this.canReceiveMarketing(f))}},yo={async getDashboardData(n,s={}){const{days:r=30}=s,[l,d,p,u,x,g,f]=await Promise.all([ti.getComparisonStats(n,r),go.getRecent(n,{limit:10}),_o.getUpcoming(n,5),ti.getRecentOpens(n,5),ti.getRecentClicks(n,5),Rt.getCounts(n),this.getAutomationStats(n)]);return{emailStats:l.current,emailChanges:l.changes,recentActivity:d,scheduledEmails:p,recentOpens:u,recentClicks:x,accountCounts:g,automationStats:f}},async getAutomationStats(n){const{data:s,error:r}=await T.from("automations").select(`
        id,
        name,
        status,
        stats
      `).eq("owner_id",n).eq("status","Active");if(r)throw r;const l=s.map(x=>x.id),{data:d,error:p}=await T.from("automation_enrollments").select("automation_id, status").in("automation_id",l);if(p)throw p;const u={};return d.forEach(x=>{u[x.automation_id]||(u[x.automation_id]={active:0,total:0}),u[x.automation_id].total++,x.status==="Active"&&u[x.automation_id].active++}),{total:s.length,active:s.filter(x=>x.status==="Active").length,automations:s.map(x=>{var g,f;return{...x,enrollmentCount:((g=u[x.id])==null?void 0:g.total)||0,activeEnrollments:((f=u[x.id])==null?void 0:f.active)||0}})}},async getEmailPerformanceOverTime(n,s=30){const r=new Date;r.setDate(r.getDate()-s);const{data:l,error:d}=await T.from("email_stats_daily").select("*").eq("owner_id",n).is("automation_id",null).gte("stat_date",r.toISOString().split("T")[0]).order("stat_date");if(d)throw d;return l},async getTopAutomations(n,s=5){const{data:r,error:l}=await T.from("automations").select("id, name, stats").eq("owner_id",n).eq("status","Active");if(l)throw l;return r.map(p=>{var u,x,g,f,M;return{...p,sent:((u=p.stats)==null?void 0:u.sent)||0,opened:((x=p.stats)==null?void 0:x.opened)||0,clicked:((g=p.stats)==null?void 0:g.clicked)||0,openRate:((f=p.stats)==null?void 0:f.sent)>0?(((M=p.stats)==null?void 0:M.opened)||0)/p.stats.sent*100:0}}).sort((p,u)=>u.openRate-p.openRate).slice(0,s)},async getAccountsNeedingAttention(n){const{data:s,error:r}=await T.from("email_logs").select(`
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",n).eq("status","Bounced").not("account_id","is",null).limit(10);if(r)throw r;const l=await Rt.getWithExpiringPolicies(n,30);return{bouncedEmails:s.map(d=>d.account).filter((d,p,u)=>u.findIndex(x=>x.account_unique_id===d.account_unique_id)===p),expiringPolicies:l.slice(0,10)}},async getQuickStats(n){const s=new Date().toISOString().split("T")[0],r=new Date;r.setDate(r.getDate()-30);const[{count:l},{count:d},{count:p},{count:u}]=await Promise.all([T.from("email_logs").select("*",{count:"exact",head:!0}).eq("owner_id",n).gte("sent_at",s),T.from("email_logs").select("*",{count:"exact",head:!0}).eq("owner_id",n).gte("first_opened_at",s),T.from("automations").select("*",{count:"exact",head:!0}).eq("owner_id",n).eq("status","Active"),T.from("scheduled_emails").select("*",{count:"exact",head:!0}).eq("owner_id",n).eq("status","Pending")]);return{emailsToday:l||0,opensToday:d||0,activeAutomations:p||0,pendingScheduled:u||0}}},vo=()=>{const{userId:n}=_e();return n};function bo(){const n=vo();return ge({queryKey:["dashboard",n,"quick"],queryFn:()=>yo.getQuickStats(n),enabled:!!n,staleTime:1e4,refetchInterval:3e4})}function bs(n=30){const s=vo();return ge({queryKey:["dashboard",s,"performance",n],queryFn:()=>yo.getEmailPerformanceOverTime(s,n),enabled:!!s})}const ut={async get(n){const{data:s,error:r}=await T.from("user_settings").select("*").eq("user_id",n).single();if(r&&r.code!=="PGRST116")throw r;return s},async getWithUser(n){const{data:s,error:r}=await T.from("user_settings").select(`
        *,
        user:users(user_unique_id, email, first_name, last_name, role_name, profile_name)
      `).eq("user_id",n).single();if(r&&r.code!=="PGRST116")throw r;return s},async create(n,s={}){const{data:r,error:l}=await T.from("user_settings").insert({user_id:n,...s}).select().single();if(l)throw l;return r},async update(n,s){const{data:r,error:l}=await T.from("user_settings").update({...s,updated_at:new Date().toISOString()}).eq("user_id",n).select().single();if(l)throw l;return r},async updateSignature(n,s){const{signatureName:r,signatureTitle:l,signaturePhone:d,signatureEmail:p,signatureMessage:u}=s;return this.update(n,{signature_name:r,signature_title:l,signature_phone:d,signature_email:p,signature_message:u})},async updateAgencyInfo(n,s){const{agencyName:r,agencyAddress:l,agencyPhone:d,agencyWebsite:p}=s;return this.update(n,{agency_name:r,agency_address:l,agency_phone:d,agency_website:p})},async updateEmailSettings(n,s){const{fromName:r,fromEmail:l,replyToEmail:d,defaultSendTime:p,timezone:u,dailySendLimit:x}=s;return this.update(n,{from_name:r,from_email:l,reply_to_email:d,default_send_time:p,timezone:u,daily_send_limit:x})},async updatePreferences(n,s){const r=await this.get(n);return this.update(n,{preferences:{...r==null?void 0:r.preferences,...s}})},async getSignatureHtml(n){const s=await this.get(n);if(!s)return"";const{signature_name:r,signature_title:l,signature_phone:d,signature_email:p,signature_message:u}=s;let x='<table style="margin-top: 20px; font-family: Arial, sans-serif;">';return x+="<tr><td>",r&&(x+=`<strong style="font-size: 14px;">${r}</strong><br>`),l&&(x+=`<span style="color: #666;">${l}</span><br>`),d&&(x+=`<span>${d}</span><br>`),p&&(x+=`<a href="mailto:${p}" style="color: #0066cc;">${p}</a><br>`),u&&(x+=`<p style="margin-top: 10px; font-style: italic; color: #666;">${u}</p>`),x+="</td></tr></table>",x},async getUnsubscribeFooterHtml(n,s,r=null){const l=await this.get(n),d="https://your-app.com",p=`${d}/unsubscribe?type=automation&id=${s}&aid=${r}`,u=`${d}/unsubscribe?type=all&id=${s}`;let x=`
      <table style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; width: 100%; font-family: Arial, sans-serif;">
        <tr>
          <td style="text-align: center; font-size: 12px; color: #666;">
    `;return r&&(x+=`<a href="${p}" style="color: #666;">Unsubscribe from these emails</a> &nbsp;|&nbsp; `),x+=`<a href="${u}" style="color: #666;">Unsubscribe from all emails</a>`,(l!=null&&l.agency_name||l!=null&&l.agency_address)&&(x+="<br><br>",l.agency_name&&(x+=l.agency_name),l.agency_address&&(x+=` | ${l.agency_address}`)),x+=`
          </td>
        </tr>
      </table>
    `,x}},wo=()=>{const{userId:n}=_e();return n};function ws(){const n=wo();return ge({queryKey:["userSettings",n],queryFn:()=>ut.get(n),enabled:!!n})}function Ss(){const n=wo(),s=ni(),r=()=>{s.invalidateQueries({queryKey:["userSettings",n]})},l=de({mutationFn:g=>ut.update(n,g),onSuccess:r}),d=de({mutationFn:g=>ut.updateSignature(n,g),onSuccess:r}),p=de({mutationFn:g=>ut.updateAgencyInfo(n,g),onSuccess:r}),u=de({mutationFn:g=>ut.updateEmailSettings(n,g),onSuccess:r}),x=de({mutationFn:g=>ut.updatePreferences(n,g),onSuccess:r});return{updateSettings:l,updateSignature:d,updateAgencyInfo:p,updateEmailSettings:u,updatePreferences:x}}const So=()=>{const{userId:n}=_e();return n};function js(n={}){const s=So();return ge({queryKey:["accounts",s,n],queryFn:()=>Rt.getAll(s,n),enabled:!!s,staleTime:3e4})}function Cs(n){return ge({queryKey:["account",n,"policies"],queryFn:()=>Rt.getByIdWithPolicies(n),enabled:!!n,staleTime:3e4})}function ks(){const n=So();return ge({queryKey:["accounts",n,"stats"],queryFn:()=>Rt.getStats(n),enabled:!!n})}const zs=()=>{const{userId:n}=_e();return n};function Ts(n,s=20){const r=zs();return ge({queryKey:["activity",r,"account",n],queryFn:()=>go.getByAccount(r,n,s),enabled:!!r&&!!n,staleTime:3e4})}const Ls=()=>{const{userId:n}=_e();return n};function Ps(n=10){const s=Ls();return ge({queryKey:["scheduledEmails",s,"upcoming",n],queryFn:()=>_o.getUpcoming(s,n),enabled:!!s})}const Rs=(n,s,r,l)=>{const p=(r-n)*Math.PI/180,u=(l-s)*Math.PI/180,x=Math.sin(p/2)*Math.sin(p/2)+Math.cos(n*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2);return 3959*(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)))},Pt={},Ms=n=>new Promise(s=>setTimeout(s,n)),Is=async(n,s=!1)=>{if(Pt[n])return Pt[n];try{s||await Ms(100);const l=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&q=${encodeURIComponent(n)}&limit=1`,{headers:{"User-Agent":"ISGMarketing/1.0"}})).json();if(l&&l.length>0){const d={lat:parseFloat(l[0].lat),lng:parseFloat(l[0].lon)};return Pt[n]=d,d}}catch(r){console.error("Geocoding error:",r)}return null},As=async n=>{const s={},r=[...new Set(n.filter(Boolean))];for(const l of r)if(Pt[l])s[l]=Pt[l];else{const d=await Is(l,!1);d&&(s[l]=d)}return s},Fe={async getAll(n,s={}){const{status:r,limit:l=50,offset:d=0}=s;let p=T.from("mass_email_batches").select(`
        *,
        template:email_templates(id, name, subject)
      `).eq("owner_id",n).order("created_at",{ascending:!1}).range(d,d+l-1);r&&(p=p.eq("status",r));const{data:u,error:x}=await p;if(x)throw x;return u},async getById(n,s){const{data:r,error:l}=await T.from("mass_email_batches").select(`
        *,
        template:email_templates(*)
      `).eq("owner_id",n).eq("id",s).single();if(l)throw l;return r},async create(n,s){const{data:r,error:l}=await T.from("mass_email_batches").insert({owner_id:n,status:"Draft",...s}).select().single();if(l)throw l;return r},async update(n,s,r){const{data:l,error:d}=await T.from("mass_email_batches").update({...r,updated_at:new Date().toISOString()}).eq("owner_id",n).eq("id",s).select().single();if(d)throw d;return l},async delete(n,s){const{error:r}=await T.from("mass_email_batches").delete().eq("owner_id",n).eq("id",s).eq("status","Draft");if(r)throw r;return!0},async getRecipients(n,s,r={}){const{limit:l=100,offset:d=0}=r,{rules:p=[],notOptedOut:u=!0,search:x=""}=s||{},g=p.filter(E=>E.field==="account_status"&&E.value),f=p.filter(E=>E.field==="policy_type"&&E.value),M=p.filter(E=>E.field==="policy_count"&&E.value),b=p.filter(E=>E.field==="policy_expiration"&&E.value),I=p.filter(E=>E.field==="location"&&E.value),j=p.filter(E=>E.field==="state"&&E.value),S=p.filter(E=>E.field==="city"&&E.value);let k=T.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name, person_has_opted_out_of_email, billing_city, billing_state, billing_postal_code, billing_street").eq("owner_id",n);if(g.length>0){const E=g[0];if(E.operator==="is")k=k.eq("account_status",E.value);else if(E.operator==="is_not")k=k.neq("account_status",E.value);else if(E.operator==="is_any"){const z=E.value.split(",").filter(W=>W);z.length>0&&(k=k.in("account_status",z))}}u&&(k=k.or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false")),x&&(k=k.or(`name.ilike.%${x}%,person_email.ilike.%${x}%,email.ilike.%${x}%`)),k=k.order("name").range(d,d+l-1);const{data:R,error:v}=await k;if(v)throw v;let O=R.filter(E=>{const z=E.person_email||E.email;return z&&z.includes("@")});if((f.length>0||M.length>0||b.length>0)&&O.length>0){const E=O.map(V=>V.account_unique_id),{data:z,error:W}=await T.from("policies").select("account_id, policy_lob, expiration_date, policy_status").in("account_id",E);if(W)throw W;const K={};z.forEach(V=>{K[V.account_id]||(K[V.account_id]=[]),K[V.account_id].push(V)}),O=O.filter(V=>{const se=K[V.account_unique_id]||[];for(const _ of M){const C=se.length,B=parseInt(_.value,10);if(_.operator==="equals"&&C!==B||_.operator==="greater_than"&&C<=B||_.operator==="less_than"&&C>=B||_.operator==="at_least"&&C<B)return!1}for(const _ of f){const C=_.operator==="is_any"?_.value.split(","):[_.value],B=se.some(P=>C.some($=>{var U;return(U=P.policy_lob)==null?void 0:U.toLowerCase().includes($.toLowerCase())}));if(_.operator==="is"&&!B||_.operator==="is_any"&&!B||_.operator==="is_not"&&B)return!1}const X=new Date().toISOString().split("T")[0];for(const _ of b)if(_.operator==="in_next_days"){const C=parseInt(_.value,10),B=new Date;B.setDate(B.getDate()+C);const P=B.toISOString().split("T")[0];if(!se.some(U=>U.expiration_date&&U.expiration_date>=X&&U.expiration_date<=P))return!1}else if(_.operator==="before"){if(!se.some(B=>B.expiration_date&&B.expiration_date<_.value))return!1}else if(_.operator==="after"){if(!se.some(B=>B.expiration_date&&B.expiration_date>_.value))return!1}else if(_.operator==="between"&&!se.some(B=>B.expiration_date&&B.expiration_date>=_.value&&B.expiration_date<=(_.value2||_.value)))return!1;return!0})}if(j.length>0&&O.length>0&&(O=O.filter(E=>{for(const z of j){const W=(E.billing_state||"").toUpperCase();if(z.operator==="is"){if(W!==z.value.toUpperCase())return!1}else if(z.operator==="is_not"){if(W===z.value.toUpperCase())return!1}else if(z.operator==="is_any"&&!z.value.split(",").map(V=>V.toUpperCase()).includes(W))return!1}return!0})),S.length>0&&O.length>0&&(O=O.filter(E=>{for(const z of S){const W=(E.billing_city||"").toLowerCase(),K=(z.value||"").toLowerCase();if(z.operator==="contains"){if(!W.includes(K))return!1}else if(z.operator==="equals"){if(W!==K)return!1}else if(z.operator==="starts_with"&&!W.startsWith(K))return!1}return!0})),I.length>0&&O.length>0)for(const E of I){const[z,W]=E.value.split(",").map(parseFloat),K=parseInt(E.radius||"25",10);console.log("Location filter:",{centerLat:z,centerLng:W,radiusMiles:K,recipientCount:O.length});const V={};O.forEach(_=>{const C=(_.billing_postal_code||"").trim(),B=(_.billing_city||"").trim(),P=(_.billing_state||"").trim();let $="";C&&P?$=`${C}, ${P}, USA`:B&&P?$=`${B}, ${P}, USA`:C&&($=`${C}, USA`),$&&(V[_.account_unique_id]=$)});const se=[...new Set(Object.values(V))];console.log("Unique locations to geocode:",se.length);const X=await As(se);console.log("Geocode results:",Object.keys(X).length),O=O.filter(_=>{const C=V[_.account_unique_id];if(!C)return console.log("No location for account:",_.account_unique_id),!1;const B=X[C];if(!B)return console.log("No geocode result for:",C),!1;const P=Rs(z,W,B.lat,B.lng),$=P<=K;return console.log(`${_.name}: ${C} -> ${P.toFixed(1)} miles ${$?"✓":"✗"}`),$}),console.log("Recipients after location filter:",O.length)}return O},async countRecipients(n,s){const{rules:r=[],notOptedOut:l=!0,search:d=""}=s||{},p=r.filter(R=>R.field==="policy_type"&&R.value),u=r.filter(R=>R.field==="policy_count"&&R.value),x=r.filter(R=>R.field==="policy_expiration"&&R.value),g=r.filter(R=>R.field==="location"&&R.value),f=r.filter(R=>R.field==="city"&&R.value);if(p.length>0||u.length>0||x.length>0||g.length>0||f.length>0)return(await this.getRecipients(n,s,{limit:1e4})).length;let b=T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n);const I=r.filter(R=>R.field==="account_status"&&R.value);if(I.length>0){const R=I[0];if(R.operator==="is")b=b.eq("account_status",R.value);else if(R.operator==="is_not")b=b.neq("account_status",R.value);else if(R.operator==="is_any"){const v=R.value.split(",").filter(O=>O);v.length>0&&(b=b.in("account_status",v))}}const j=r.filter(R=>R.field==="state"&&R.value);if(j.length>0){const R=j[0];if(R.operator==="is")b=b.ilike("billing_state",R.value);else if(R.operator==="is_not")b=b.not("billing_state","ilike",R.value);else if(R.operator==="is_any"){const v=R.value.split(",").filter(O=>O);v.length>0&&(b=b.in("billing_state",v))}}l&&(b=b.or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false")),d&&(b=b.or(`name.ilike.%${d}%,person_email.ilike.%${d}%,email.ilike.%${d}%`));const{count:S,error:k}=await b;if(k)throw k;return S||0},async getRecipientLocationBreakdown(n,s){const{rules:r=[],notOptedOut:l=!0,search:d=""}=s||{},p=r.filter(v=>v.field!=="location"),u={...s,rules:p},x=p.filter(v=>v.field==="policy_type"&&v.value),g=p.filter(v=>v.field==="policy_count"&&v.value),f=p.filter(v=>v.field==="policy_expiration"&&v.value),M=x.length>0||g.length>0||f.length>0;let b;if(M)b=await this.getRecipients(n,u,{limit:1e4});else{let v=T.from("accounts").select("billing_city, billing_state").eq("owner_id",n);const O=p.filter(W=>W.field==="account_status"&&W.value);if(O.length>0){const W=O[0];if(W.operator==="is")v=v.eq("account_status",W.value);else if(W.operator==="is_not")v=v.neq("account_status",W.value);else if(W.operator==="is_any"){const K=W.value.split(",").filter(V=>V);K.length>0&&(v=v.in("account_status",K))}}const Z=p.filter(W=>W.field==="state"&&W.value);if(Z.length>0){const W=Z[0];if(W.operator==="is")v=v.ilike("billing_state",W.value);else if(W.operator==="is_not")v=v.not("billing_state","ilike",W.value);else if(W.operator==="is_any"){const K=W.value.split(",").filter(V=>V);K.length>0&&(v=v.in("billing_state",K))}}l&&(v=v.or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false"));const{data:E,error:z}=await v;if(z)throw z;b=E||[]}const I={},j={},S=v=>v?v.toLowerCase().replace(/\b\w/g,O=>O.toUpperCase()):"";b.forEach(v=>{const O=(v.billing_state||"").trim(),Z=(v.billing_city||"").trim();if(O){const E=O.length===2?O.toUpperCase():S(O);I[E]=(I[E]||0)+1}if(Z&&O){const E=S(Z),z=O.length===2?O.toUpperCase():S(O),W=`${E}, ${z}`;j[W]=(j[W]||0)+1}});const k=Object.entries(I).map(([v,O])=>({state:v,count:O})).sort((v,O)=>O.count-v.count).slice(0,10),R=Object.entries(j).map(([v,O])=>({city:v,count:O})).sort((v,O)=>O.count-v.count).slice(0,10);return{total:b.length,byState:k,byCity:R}},async scheduleBatch(n,s,r=null){const l=await this.getById(n,s);if(!l)throw new Error("Batch not found");if(l.status!=="Draft")throw new Error("Can only schedule draft batches");const d=await this.getRecipients(n,l.filter_config,{limit:1e4});if(d.length===0)throw new Error("No recipients match the filter");const p=r||new Date().toISOString(),u=d.map(f=>({owner_id:n,account_id:f.account_unique_id,template_id:l.template_id,recipient_email:f.person_email||f.email,recipient_name:f.primary_contact_first_name?`${f.primary_contact_first_name} ${f.primary_contact_last_name||""}`.trim():f.name,subject:l.subject,scheduled_for:p,status:"Pending",batch_id:s})),x=100;let g=0;for(let f=0;f<u.length;f+=x){const M=u.slice(f,f+x),{data:b,error:I}=await T.from("scheduled_emails").insert(M).select();if(I)throw I;g+=b.length}return await this.update(n,s,{status:r?"Scheduled":"Sending",total_recipients:d.length,scheduled_for:p,started_at:r?null:new Date().toISOString()}),{scheduled:g,total:d.length,scheduledFor:p}},async cancelBatch(n,s){await this.update(n,s,{status:"Cancelled"});const{error:r}=await T.from("scheduled_emails").update({status:"Cancelled"}).eq("owner_id",n).eq("batch_id",s).eq("status","Pending");if(r)throw r;return!0},async getBatchStats(n,s){const{data:r,error:l}=await T.from("scheduled_emails").select("status").eq("owner_id",n).eq("batch_id",s);if(l)throw l;const d={pending:0,sent:0,failed:0,cancelled:0,total:r.length};return r.forEach(p=>{const u=p.status.toLowerCase();d[u]!==void 0&&d[u]++}),d},async getAllWithStats(n,s={}){const r=await this.getAll(n,s);return await Promise.all(r.map(async d=>{if(d.status==="Draft")return{...d,stats:null};const p=await this.getBatchStats(n,d.id);return{...d,stats:p}}))}},Mt=()=>{const{userId:n}=_e();return n};function Es(n={}){const s=Mt();return ge({queryKey:["massEmails",s,"withStats",n],queryFn:()=>Fe.getAllWithStats(s,n),enabled:!!s})}function Bs(n,s={}){const r=Mt();return ge({queryKey:["massEmailRecipients",r,n,s],queryFn:()=>Fe.getRecipients(r,n,s),enabled:!!r&&!!n})}function Os(n){const s=Mt();return ge({queryKey:["massEmailRecipientCount",s,n],queryFn:()=>Fe.countRecipients(s,n),enabled:!!s&&!!n})}function Ds(n){const s=Mt();return ge({queryKey:["massEmailLocationBreakdown",s,n],queryFn:()=>Fe.getRecipientLocationBreakdown(s,n),enabled:!!s&&!!n})}function Ws(){const n=Mt(),s=ni(),r=()=>{s.invalidateQueries({queryKey:["massEmails",n]})},l=de({mutationFn:g=>Fe.create(n,g),onSuccess:r}),d=de({mutationFn:({batchId:g,updates:f})=>Fe.update(n,g,f),onSuccess:r}),p=de({mutationFn:g=>Fe.delete(n,g),onSuccess:r}),u=de({mutationFn:({batchId:g,scheduledFor:f})=>Fe.scheduleBatch(n,g,f),onSuccess:()=>{r(),s.invalidateQueries({queryKey:["scheduledEmails",n]})}}),x=de({mutationFn:g=>Fe.cancelBatch(n,g),onSuccess:()=>{r(),s.invalidateQueries({queryKey:["scheduledEmails",n]})}});return{createBatch:l,updateBatch:d,deleteBatch:p,scheduleBatch:u,cancelBatch:x}}const et=({width:n="100%",height:s="20px"})=>i.jsx("div",{style:{width:n,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite"}}),Xt=({label:n,value:s,change:r,icon:l,positive:d,isLoading:p,theme:u})=>i.jsxs("div",{style:{padding:"20px",backgroundColor:u.bgCard,borderRadius:"12px",border:`1px solid ${u.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[i.jsx("span",{style:{color:u.textSecondary,fontSize:"13px"},children:n}),i.jsx("span",{style:{fontSize:"20px"},children:l})]}),p?i.jsx(et,{height:"32px",width:"80px"}):i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:u.text,marginBottom:"4px"},children:s}),r&&i.jsx("span",{style:{fontSize:"12px",color:d?u.success:u.danger},children:r})]})]}),qs=({email:n,theme:s,userId:r})=>{var l,d,p;return i.jsx("div",{style:{padding:"14px",backgroundColor:s.bg,borderRadius:"8px",border:`1px solid ${s.border}`},children:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[i.jsxs("div",{children:[i.jsxs("div",{style:{fontSize:"11px",color:s.textMuted,marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{children:"🕐"})," ",new Date(n.scheduled_for).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]}),i.jsx(tt,{to:`/${r}/clients/${n.account_id}`,style:{fontSize:"14px",fontWeight:"600",color:s.text,textDecoration:"none"},children:((l=n.accounts)==null?void 0:l.name)||"Unknown Account"}),i.jsx("div",{style:{fontSize:"12px",color:s.textSecondary,marginTop:"2px"},children:((d=n.email_templates)==null?void 0:d.subject)||"No subject"}),i.jsx("span",{style:{display:"inline-block",marginTop:"6px",padding:"3px 8px",backgroundColor:s.bgHover,borderRadius:"4px",fontSize:"11px",color:s.textSecondary},children:((p=n.email_templates)==null?void 0:p.name)||"Unknown Template"})]}),i.jsxs("div",{style:{display:"flex",gap:"6px"},children:[i.jsx("button",{style:{padding:"6px 10px",backgroundColor:s.bgHover,border:`1px solid ${s.border}`,borderRadius:"6px",color:s.textSecondary,cursor:"pointer",fontSize:"12px"},children:"✈️"}),i.jsx("button",{style:{padding:"6px 10px",backgroundColor:s.bgHover,border:`1px solid ${s.border}`,borderRadius:"6px",color:s.textSecondary,cursor:"pointer",fontSize:"12px"},children:"×"})]})]})})},Ns=({label:n,you:s,avg:r,theme:l})=>i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[i.jsx("span",{style:{fontSize:"12px",color:l.textSecondary},children:n}),i.jsxs("span",{style:{fontSize:"12px",color:l.textMuted},children:[s,"% vs ",r,"%"]})]}),i.jsxs("div",{style:{display:"flex",gap:"4px",height:"24px"},children:[i.jsx("div",{style:{width:`${Math.min(s,100)}%`,backgroundColor:l.primary,borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:i.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[s,"%"]})}),i.jsx("div",{style:{width:`${Math.min(r,100)}%`,backgroundColor:"#14b8a6",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:i.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[r,"%"]})})]})]}),ao=({t:n})=>{const{userId:s}=_e(),{data:r,isLoading:l,error:d}=bo(),{data:p,isLoading:u}=Ps(7),{data:x,isLoading:g}=bs(30),f=[{label:"Open Rate",you:(r==null?void 0:r.openRate)||0,avg:32},{label:"Click Rate",you:(r==null?void 0:r.clickRate)||0,avg:8},{label:"Response Rate",you:(r==null?void 0:r.responseRate)||8,avg:5}],M=I=>I>=1e3?`${(I/1e3).toFixed(1)}k`:(I==null?void 0:I.toLocaleString())||"0",b=I=>`${Math.round(I||0)}%`;return i.jsxs("div",{children:[i.jsxs("div",{style:{marginBottom:"24px"},children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Dashboard"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px",margin:0},children:"Overview of your email campaigns and performance"})]}),d&&i.jsx("div",{style:{padding:"16px",backgroundColor:`${n.danger}15`,border:`1px solid ${n.danger}30`,borderRadius:"8px",marginBottom:"24px",color:n.danger,fontSize:"14px"},children:"Failed to load dashboard data. Please try refreshing the page."}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"24px"},children:[i.jsx(Xt,{label:"Emails Sent",value:M(r==null?void 0:r.emailsSent),change:r!=null&&r.emailsSentChange?`${r.emailsSentChange>0?"+":""}${r.emailsSentChange}%`:null,icon:"📧",positive:(r==null?void 0:r.emailsSentChange)>0,isLoading:l,theme:n}),i.jsx(Xt,{label:"Open Rate",value:b(r==null?void 0:r.openRate),change:r!=null&&r.openRateChange?`${r.openRateChange>0?"+":""}${r.openRateChange}%`:null,icon:"📬",positive:(r==null?void 0:r.openRateChange)>0,isLoading:l,theme:n}),i.jsx(Xt,{label:"Click Rate",value:b(r==null?void 0:r.clickRate),change:r!=null&&r.clickRateChange?`${r.clickRateChange>0?"+":""}${r.clickRateChange}%`:null,icon:"🖱️",positive:(r==null?void 0:r.clickRateChange)>0,isLoading:l,theme:n}),i.jsx(Xt,{label:"Scheduled",value:M(r==null?void 0:r.scheduledCount),change:null,icon:"📅",positive:null,isLoading:l,theme:n})]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Upcoming Scheduled Emails"}),i.jsx(tt,{to:`/${s}/scheduled`,style:{fontSize:"12px",color:n.primary,textDecoration:"none"},children:"View all →"})]}),i.jsx("p",{style:{fontSize:"12px",color:n.textSecondary,marginBottom:"16px"},children:"Emails scheduled to be sent in the next 7 days"}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:u?Array.from({length:3}).map((I,j)=>i.jsxs("div",{style:{padding:"14px",backgroundColor:n.bg,borderRadius:"8px",border:`1px solid ${n.border}`},children:[i.jsx(et,{height:"12px",width:"120px"}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(et,{height:"16px",width:"180px"})}),i.jsx("div",{style:{marginTop:"4px"},children:i.jsx(et,{height:"12px",width:"220px"})})]},j)):(p==null?void 0:p.length)>0?p.slice(0,5).map(I=>i.jsx(qs,{email:I,theme:n,userId:s},I.id)):i.jsxs("div",{style:{padding:"40px 20px",textAlign:"center",color:n.textMuted,fontSize:"14px"},children:[i.jsx("div",{style:{fontSize:"32px",marginBottom:"8px"},children:"📭"}),"No scheduled emails in the next 7 days"]})})]}),i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"4px"},children:"Performance Comparison"}),i.jsx("p",{style:{fontSize:"12px",color:n.textSecondary,marginBottom:"16px"},children:"Your metrics compared to industry averages"}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:l?Array.from({length:3}).map((I,j)=>i.jsxs("div",{children:[i.jsx(et,{height:"12px",width:"100px"}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(et,{height:"24px"})})]},j)):f.map((I,j)=>i.jsx(Ns,{label:I.label,you:I.you,avg:I.avg,theme:n},j))}),i.jsxs("div",{style:{display:"flex",gap:"16px",marginTop:"16px",justifyContent:"center"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:n.primary,borderRadius:"2px"}}),i.jsx("span",{style:{fontSize:"11px",color:n.textSecondary},children:"You"})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"#14b8a6",borderRadius:"2px"}}),i.jsx("span",{style:{fontSize:"11px",color:n.textSecondary},children:"Industry Avg"})]})]})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Recent Email Activity"}),i.jsx(tt,{to:`/${s}/activity`,style:{fontSize:"12px",color:n.primary,textDecoration:"none"},children:"View all →"})]}),g?i.jsx(et,{height:"200px"}):(x==null?void 0:x.length)>0?i.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"4px",height:"200px",padding:"20px 0"},children:x.slice(-14).map((I,j)=>{const S=Math.max(...x.map(R=>R.sent||0),1),k=(I.sent||0)/S*150;return i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[i.jsx("div",{style:{width:"100%",height:`${k}px`,backgroundColor:n.primary,borderRadius:"4px 4px 0 0",minHeight:"4px"},title:`${I.sent||0} sent on ${I.date}`}),i.jsx("span",{style:{fontSize:"9px",color:n.textMuted},children:new Date(I.date).toLocaleDateString("en-US",{weekday:"short"}).charAt(0)})]},j)})}):i.jsx("div",{style:{padding:"40px 20px",textAlign:"center",color:n.textMuted,fontSize:"14px"},children:"No email activity data yet"})]})]})},Bi=({width:n="100%",height:s="20px"})=>i.jsx("div",{style:{width:n,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Zs=[{id:"welcome",name:"Welcome Series",desc:"Send a series of welcome emails to new clients over their first 30 days",icon:"📧",category:"Onboarding",defaultNodes:[{type:"trigger",config:{frequency:"daily",time:"09:00"}},{type:"send_email",config:{templateKey:"welcome_email"}},{type:"delay",config:{days:3}},{type:"send_email",config:{templateKey:"getting_started"}}]},{id:"renewal",name:"Renewal Reminder",desc:"Automated reminders for upcoming policy renewals with customizable timing",icon:"📅",category:"Retention",defaultNodes:[{type:"trigger",config:{frequency:"daily",time:"09:00"}},{type:"send_email",config:{templateKey:"renewal_30_day"}},{type:"delay",config:{days:14}},{type:"condition",config:{type:"email_opened"}}]},{id:"engagement",name:"Engagement Campaign",desc:"Re-engage inactive clients with targeted email sequences",icon:"📈",category:"Engagement",defaultNodes:[{type:"trigger",config:{frequency:"weekly",time:"10:00"}},{type:"send_email",config:{templateKey:"reengagement"}}]},{id:"policy_update",name:"Policy Update Alert",desc:"Notify clients about important policy changes and updates",icon:"🔔",category:"Communication",defaultNodes:[{type:"trigger",config:{frequency:"immediate"}},{type:"send_email",config:{templateKey:"policy_update"}}]}],$s=({template:n,onUse:s,theme:r})=>i.jsxs("div",{style:{padding:"20px",backgroundColor:r.bgCard,borderRadius:"12px",border:`1px solid ${r.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:r.bgHover,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:n.icon}),i.jsx("span",{style:{padding:"4px 10px",backgroundColor:r.bgHover,borderRadius:"20px",fontSize:"11px",color:r.textSecondary},children:n.category})]}),i.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:r.text,marginBottom:"6px"},children:n.name}),i.jsx("p",{style:{fontSize:"13px",color:r.textSecondary,marginBottom:"16px",lineHeight:"1.5"},children:n.desc}),i.jsx("button",{onClick:()=>s(n),style:{width:"100%",padding:"10px",backgroundColor:r.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Use Template"})]}),Fs=({automation:n,onEdit:s,onToggle:r,theme:l})=>{var u;const d=n.stats||{},p=n.status==="active";return i.jsxs("tr",{style:{borderTop:`1px solid ${l.border}`},children:[i.jsx("td",{style:{padding:"14px 16px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:l.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px"},children:"⚡"}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:l.text},children:n.name}),n.description&&i.jsx("div",{style:{fontSize:"12px",color:l.textMuted},children:n.description})]})]})}),i.jsx("td",{style:{padding:"14px 16px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx("button",{onClick:()=>r(n.id,p?"pause":"activate"),style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:p?l.success:l.bgHover,cursor:"pointer",position:"relative",transition:"background-color 0.2s",flexShrink:0},children:i.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:p?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})}),i.jsx("span",{style:{fontSize:"12px",color:p?l.success:l.textMuted,fontWeight:"500"},children:p?"Active":n.status==="draft"?"Draft":"Paused"})]})}),i.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:l.textSecondary},children:((u=d.totalSent)==null?void 0:u.toLocaleString())||0}),i.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:l.textSecondary},children:d.openRate?`${Math.round(d.openRate)}%`:"—"}),i.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:l.textSecondary},children:d.clickRate?`${Math.round(d.clickRate)}%`:"—"}),i.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:l.textSecondary},children:d.activeEnrollments||0}),i.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:i.jsx("button",{onClick:()=>s(n.id),style:{padding:"6px 12px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"6px",color:l.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Edit"})})]})},Hs=({t:n})=>{const{userId:s}=_e(),r=ht(),[l,d]=D.useState("my"),{data:p,isLoading:u,error:x}=xs(),{activateAutomation:g,pauseAutomation:f}=mo(),M=()=>{r(`/${s}/automations/new`)},b=async v=>{r(`/${s}/automations/new`,{state:{templateId:v.id,templateName:v.name,defaultNodes:v.defaultNodes}})},I=v=>{r(`/${s}/automations/${v}`)},j=async(v,O)=>{try{O==="activate"?await g.mutateAsync(v):await f.mutateAsync(v)}catch(Z){console.error(`Failed to ${O} automation:`,Z)}},S=(p==null?void 0:p.filter(v=>v.status==="active"))||[],k=(p==null?void 0:p.filter(v=>v.status==="paused"))||[],R=(p==null?void 0:p.filter(v=>v.status==="draft"))||[];return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Automations"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px",margin:0},children:"Create and manage automated email workflows"})]}),i.jsxs("button",{onClick:M,style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:"+"})," Create Custom"]})]}),x&&i.jsx("div",{style:{padding:"16px",backgroundColor:`${n.danger}15`,border:`1px solid ${n.danger}30`,borderRadius:"8px",marginBottom:"24px",color:n.danger,fontSize:"14px"},children:"Failed to load automations. Please try refreshing the page."}),!u&&p&&i.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"24px",padding:"16px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsxs("div",{style:{textAlign:"center",flex:1},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.success},children:S.length}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary},children:"Active"})]}),i.jsx("div",{style:{width:"1px",backgroundColor:n.border}}),i.jsxs("div",{style:{textAlign:"center",flex:1},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.warning},children:k.length}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary},children:"Paused"})]}),i.jsx("div",{style:{width:"1px",backgroundColor:n.border}}),i.jsxs("div",{style:{textAlign:"center",flex:1},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.textMuted},children:R.length}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary},children:"Drafts"})]}),i.jsx("div",{style:{width:"1px",backgroundColor:n.border}}),i.jsxs("div",{style:{textAlign:"center",flex:1},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.primary},children:p.reduce((v,O)=>{var Z;return v+(((Z=O.stats)==null?void 0:Z.totalSent)||0)},0).toLocaleString()}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary},children:"Total Sent"})]})]}),i.jsxs("div",{style:{display:"flex",gap:"0",marginBottom:"24px",backgroundColor:n.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:[i.jsxs("button",{onClick:()=>d("my"),style:{padding:"10px 20px",backgroundColor:l==="my"?n.bgCard:"transparent",border:"none",borderRadius:"8px",color:l==="my"?n.text:n.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:l==="my"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:["My Automations ",p&&`(${p.length})`]}),i.jsx("button",{onClick:()=>d("templates"),style:{padding:"10px 20px",backgroundColor:l==="templates"?n.bgCard:"transparent",border:"none",borderRadius:"8px",color:l==="templates"?n.text:n.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:l==="templates"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:"Templates"})]}),l==="templates"&&i.jsxs(i.Fragment,{children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Pre-built Templates"}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:Zs.map(v=>i.jsx($s,{template:v,onUse:b,theme:n},v.id))})]}),l==="my"&&i.jsx(i.Fragment,{children:u?i.jsx("div",{style:{backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,padding:"20px"},children:Array.from({length:3}).map((v,O)=>i.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:O>0?`1px solid ${n.border}`:"none"},children:[i.jsx(Bi,{width:"36px",height:"36px"}),i.jsxs("div",{style:{flex:1},children:[i.jsx(Bi,{width:"200px",height:"16px"}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(Bi,{width:"120px",height:"12px"})})]})]},O))}):(p==null?void 0:p.length)>0?i.jsx("div",{style:{backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,overflow:"hidden"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{backgroundColor:n.bgHover},children:[i.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Automation"}),i.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Status"}),i.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Sent"}),i.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Open Rate"}),i.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Click Rate"}),i.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Enrolled"}),i.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Actions"})]})}),i.jsx("tbody",{children:p.map(v=>i.jsx(Fs,{automation:v,onEdit:I,onToggle:j,theme:n},v.id))})]})}):i.jsxs("div",{style:{padding:"60px 20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"⚡"}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"8px"},children:"No automations yet"}),i.jsx("p",{style:{fontSize:"14px",color:n.textSecondary,marginBottom:"24px"},children:"Create your first automation to start sending targeted emails automatically."}),i.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[i.jsx("button",{onClick:()=>d("templates"),style:{padding:"10px 20px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,cursor:"pointer",fontSize:"14px"},children:"Browse Templates"}),i.jsx("button",{onClick:M,style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Custom"})]})]})})]})},ei=({width:n="100%",height:s="20px"})=>i.jsx("div",{style:{width:n,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Us=({template:n,onSave:s,onClose:r,theme:l})=>{const[d,p]=D.useState((n==null?void 0:n.name)||""),[u,x]=D.useState((n==null?void 0:n.subject)||""),[g,f]=D.useState((n==null?void 0:n.body_html)||(n==null?void 0:n.body_text)||""),[M,b]=D.useState((n==null?void 0:n.category)||"general"),[I,j]=D.useState(!1),S=async()=>{j(!0);try{await s({name:d,subject:u,body_html:g,body_text:g.replace(/<[^>]*>/g,""),category:M}),r()}catch(v){console.error("Failed to save template:",v)}finally{j(!1)}},k=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],R=v=>{f(g+v)};return i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:100},onClick:r}),i.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxHeight:"90vh",backgroundColor:l.bgCard,borderRadius:"16px",border:`1px solid ${l.border}`,zIndex:101,display:"flex",flexDirection:"column",overflow:"hidden"},children:[i.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${l.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:l.text,margin:0},children:n?"Edit Template":"Create Template"}),i.jsx("button",{onClick:r,style:{background:"none",border:"none",color:l.textMuted,cursor:"pointer",fontSize:"20px"},children:"×"})]}),i.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Template Name"}),i.jsx("input",{type:"text",value:d,onChange:v=>p(v.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Category"}),i.jsxs("select",{value:M,onChange:v=>b(v.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"},children:[i.jsx("option",{value:"general",children:"General"}),i.jsx("option",{value:"welcome",children:"Welcome"}),i.jsx("option",{value:"renewal",children:"Renewal"}),i.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),i.jsx("option",{value:"engagement",children:"Engagement"}),i.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),i.jsx("input",{type:"text",value:u,onChange:v=>x(v.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:k.map(v=>i.jsx("button",{onClick:()=>R(v.key),style:{padding:"4px 10px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"6px",color:l.textSecondary,cursor:"pointer",fontSize:"11px"},children:v.label},v.key))})]}),i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Email Body"}),i.jsx("textarea",{value:g,onChange:v=>f(v.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:12,style:{width:"100%",padding:"12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),i.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${l.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[i.jsx("button",{onClick:r,style:{padding:"10px 20px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),i.jsx("button",{onClick:S,disabled:I||!d||!u,style:{padding:"10px 20px",backgroundColor:l.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:I?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:I||!d||!u?.6:1},children:I?"Saving...":n?"Save Changes":"Create Template"})]})]})]})},Gs=({template:n,onEdit:s,onDuplicate:r,onDelete:l,theme:d})=>{var g,f;const[p,u]=D.useState(!1),x={welcome:d.success,renewal:d.warning,cross_sell:d.primary,engagement:d.purple,policy_update:"#06b6d4",general:d.textMuted};return i.jsxs("div",{style:{padding:"20px",backgroundColor:d.bgCard,borderRadius:"12px",border:`1px solid ${d.border}`,position:"relative"},children:[i.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px"},children:[i.jsx("button",{onClick:()=>u(!p),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:d.textMuted,cursor:"pointer",fontSize:"16px"},children:"⋮"}),p&&i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,zIndex:10},onClick:()=>u(!1)}),i.jsxs("div",{style:{position:"absolute",top:"100%",right:0,backgroundColor:d.bgCard,border:`1px solid ${d.border}`,borderRadius:"8px",padding:"4px",zIndex:11,minWidth:"140px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[i.jsx("button",{onClick:()=>{s(n),u(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:d.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:"✏️ Edit"}),i.jsx("button",{onClick:()=>{r(n),u(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:d.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:"📋 Duplicate"}),i.jsx("button",{onClick:()=>{l(n.id),u(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:d.danger,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:"🗑️ Delete"})]})]})]}),i.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${x[n.category]||d.textMuted}15`,color:x[n.category]||d.textMuted,borderRadius:"20px",fontSize:"11px",fontWeight:"500",marginBottom:"12px",textTransform:"capitalize"},children:((g=n.category)==null?void 0:g.replace("_"," "))||"General"}),i.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:d.text,marginBottom:"6px"},children:n.name}),i.jsx("p",{style:{fontSize:"13px",color:d.textSecondary,marginBottom:"8px"},children:n.subject}),i.jsxs("p",{style:{fontSize:"12px",color:d.textMuted,marginBottom:"12px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:[(f=n.body_text)==null?void 0:f.substring(0,100),"..."]}),i.jsxs("div",{style:{display:"flex",gap:"16px",paddingTop:"12px",borderTop:`1px solid ${d.border}`,fontSize:"11px",color:d.textMuted},children:[i.jsxs("span",{children:["📧 ",n.usage_count||0," sent"]}),i.jsxs("span",{children:["📬 ",n.open_rate?`${Math.round(n.open_rate)}%`:"—"," opens"]})]}),i.jsx("button",{onClick:()=>s(n),style:{marginTop:"12px",width:"100%",padding:"10px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,cursor:"pointer",fontSize:"13px"},children:"Edit Template"})]})},Vs=({t:n})=>{const{userId:s}=_e(),[r,l]=D.useState("my"),[d,p]=D.useState("all"),[u,x]=D.useState(""),[g,f]=D.useState(!1),[M,b]=D.useState(null),{data:I,isLoading:j,error:S}=fo(),{data:k}=fs(),{createTemplate:R,updateTemplate:v,deleteTemplate:O,duplicateTemplate:Z}=xo(),E=(I==null?void 0:I.filter(X=>!(d!=="all"&&X.category!==d||u&&!X.name.toLowerCase().includes(u.toLowerCase())&&!X.subject.toLowerCase().includes(u.toLowerCase()))))||[],z=()=>{b(null),f(!0)},W=X=>{b(X),f(!0)},K=async X=>{M?await v.mutateAsync({id:M.id,...X}):await R.mutateAsync(X)},V=async X=>{await Z.mutateAsync(X.id)},se=async X=>{window.confirm("Are you sure you want to delete this template?")&&await O.mutateAsync(X)};return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Email Templates"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px",margin:0},children:"Create and manage reusable email templates"})]}),i.jsxs("button",{onClick:z,style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:"+"})," Create Template"]})]}),S&&i.jsx("div",{style:{padding:"16px",backgroundColor:`${n.danger}15`,border:`1px solid ${n.danger}30`,borderRadius:"8px",marginBottom:"24px",color:n.danger,fontSize:"14px"},children:"Failed to load templates. Please try refreshing the page."}),i.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"24px",alignItems:"center"},children:[i.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"300px"},children:[i.jsx("input",{type:"text",placeholder:"Search templates...",value:u,onChange:X=>x(X.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"}}),i.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:n.textMuted},children:"🔍"})]}),i.jsxs("select",{value:d,onChange:X=>p(X.target.value),style:{padding:"10px 12px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px",minWidth:"150px"},children:[i.jsx("option",{value:"all",children:"All Categories"}),i.jsx("option",{value:"welcome",children:"Welcome"}),i.jsx("option",{value:"renewal",children:"Renewal"}),i.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),i.jsx("option",{value:"engagement",children:"Engagement"}),i.jsx("option",{value:"policy_update",children:"Policy Update"}),i.jsx("option",{value:"general",children:"General"})]}),i.jsxs("span",{style:{fontSize:"13px",color:n.textMuted},children:[E.length," template",E.length!==1?"s":""]})]}),j?i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:Array.from({length:6}).map((X,_)=>i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx(ei,{width:"80px",height:"20px"}),i.jsx("div",{style:{marginTop:"12px"},children:i.jsx(ei,{width:"180px",height:"18px"})}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(ei,{width:"220px",height:"14px"})}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(ei,{height:"40px"})})]},_))}):E.length>0?i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:E.map(X=>i.jsx(Gs,{template:X,onEdit:W,onDuplicate:V,onDelete:se,theme:n},X.id))}):i.jsxs("div",{style:{padding:"60px 20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"📝"}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"8px"},children:u||d!=="all"?"No templates found":"No templates yet"}),i.jsx("p",{style:{fontSize:"14px",color:n.textSecondary,marginBottom:"24px"},children:u||d!=="all"?"Try adjusting your search or filter criteria.":"Create your first email template to get started."}),!u&&d==="all"&&i.jsx("button",{onClick:z,style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Template"})]}),g&&i.jsx(Us,{template:M,onSave:K,onClose:()=>f(!1),theme:n})]})},Oi=({width:n="100%",height:s="20px"})=>i.jsx("div",{style:{width:n,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Ks=({type:n,theme:s})=>{const r=(n||"").toLowerCase();let l=r;(r==="prior_customer"||r.startsWith("prior"))&&(l="prior"),r.startsWith("customer")&&(l="customer"),r.startsWith("prospect")&&(l="prospect"),r.startsWith("lead")&&(l="lead");const d={customer:{bg:`${s.success}20`,text:s.success,label:"Customer"},prospect:{bg:`${s.primary}20`,text:s.primary,label:"Prospect"},prior:{bg:`${s.textMuted}20`,text:s.textMuted,label:"Prior Customer"},lead:{bg:`${s.warning}20`,text:s.warning,label:"Lead"}},p=d[l]||d.prospect;return i.jsx("span",{style:{padding:"4px 10px",backgroundColor:p.bg,color:p.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:p.label||n||"Unknown"})},Ys=({policyType:n,status:s,theme:r})=>{const l=s==="active";return i.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"3px 8px",backgroundColor:l?`${r.success}10`:`${r.textMuted}10`,borderRadius:"6px",fontSize:"11px",color:l?r.success:r.textMuted},children:[l?"✓":"○"," ",n]})},Js=({client:n,onClick:s,theme:r})=>{var l,d,p;return i.jsxs("tr",{style:{borderTop:`1px solid ${r.border}`,cursor:"pointer"},onClick:s,onMouseOver:u=>u.currentTarget.style.backgroundColor=r.bgHover,onMouseOut:u=>u.currentTarget.style.backgroundColor="transparent",children:[i.jsx("td",{style:{padding:"14px 16px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:r.bgHover,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",color:r.textMuted},children:((l=n.name)==null?void 0:l.charAt(0).toUpperCase())||"?"}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:r.text},children:n.name}),i.jsx("div",{style:{fontSize:"12px",color:r.textMuted},children:n.person_email||n.email||"—"})]})]})}),i.jsx("td",{style:{padding:"14px 16px"},children:i.jsx(Ks,{type:n.account_status||"Prospect",theme:r})}),i.jsx("td",{style:{padding:"14px 16px"},children:i.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",alignItems:"center"},children:((d=n.policies)==null?void 0:d.length)>0?i.jsxs(i.Fragment,{children:[n.policies.slice(0,3).map((u,x)=>i.jsx(Ys,{policyType:u.policy_type||"Policy",status:u.status,theme:r},x)),n.policies.length>3&&i.jsxs("span",{style:{fontSize:"11px",color:r.textMuted},children:["+",n.policies.length-3," more"]})]}):i.jsx("span",{style:{fontSize:"13px",color:r.textMuted},children:"No policies"})})}),i.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:r.textSecondary,textAlign:"center"},children:n.policy_count||((p=n.policies)==null?void 0:p.length)||0}),i.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:i.jsxs("div",{style:{display:"flex",gap:"6px",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:u=>{u.stopPropagation()},style:{padding:"6px 12px",backgroundColor:r.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:"📧 Email"}),i.jsx("button",{onClick:u=>{u.stopPropagation(),s()},style:{padding:"6px 12px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.textSecondary,cursor:"pointer",fontSize:"12px"},children:"View"})]})})]})},Tt=({label:n,value:s,icon:r,color:l,theme:d,onClick:p,active:u})=>i.jsxs("div",{onClick:p,style:{padding:"16px",backgroundColor:u?`${l}15`:d.bgCard,borderRadius:"10px",border:`2px solid ${u?l:d.border}`,textAlign:"center",cursor:p?"pointer":"default",transition:"all 0.2s ease",transform:u?"scale(1.02)":"scale(1)"},onMouseOver:x=>{p&&(x.currentTarget.style.borderColor=l,x.currentTarget.style.transform="scale(1.02)")},onMouseOut:x=>{p&&!u&&(x.currentTarget.style.borderColor=d.border,x.currentTarget.style.transform="scale(1)")},children:[i.jsx("div",{style:{fontSize:"24px",marginBottom:"4px"},children:r}),i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:l||d.text},children:s}),i.jsx("div",{style:{fontSize:"12px",color:d.textSecondary},children:n})]}),Qs=({t:n})=>{const{userId:s}=_e(),r=ht(),[l,d]=D.useState(""),[p,u]=D.useState("all"),[x,g]=D.useState("name"),[f,M]=D.useState("asc"),[b,I]=D.useState(1),j=25,S=D.useMemo(()=>{const C={limit:j,offset:(b-1)*j};return p!=="all"&&p!=="expiring"&&(C.status=p),p==="expiring"&&(C.expiring=!0,C.limit=100,C.offset=0),l.length>=2&&(C.search=l),C},[p,b,l]),{data:k,isLoading:R,error:v}=js(S),{data:O,isLoading:Z}=ks(),E=(k==null?void 0:k.accounts)||[],z=(k==null?void 0:k.total)||0,W=Math.ceil(z/j),K=D.useMemo(()=>!E||E.length===0?[]:[...E].sort((C,B)=>{let P=C[x],$=B[x];return x==="name"&&(P=(P==null?void 0:P.toLowerCase())||"",$=($==null?void 0:$.toLowerCase())||""),x==="policy_count"&&(P=C.policy_count||0,$=B.policy_count||0),f==="asc"?P>$?1:-1:P<$?1:-1}),[E,x,f]),V=C=>{u(C),I(1)},se=C=>{d(C),I(1)},X=C=>{r(`/${s}/accounts/${C}`)},_=O||{Customer:0,Prospect:0,Prior:0,total:0,expiring:0};return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Accounts"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px",margin:0},children:"View and manage your account database"})]}),i.jsxs("div",{style:{display:"flex",gap:"12px"},children:[i.jsx("button",{onClick:()=>{},style:{padding:"10px 16px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:"📤 Export"}),i.jsx("button",{style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"+ Add Account"})]})]}),v&&i.jsx("div",{style:{padding:"16px",backgroundColor:`${n.danger}15`,border:`1px solid ${n.danger}30`,borderRadius:"8px",marginBottom:"24px",color:n.danger,fontSize:"14px"},children:"Failed to load accounts. Please try refreshing the page."}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"16px",marginBottom:"24px"},children:[i.jsx(Tt,{label:"Total Accounts",value:Z?"...":_.total,icon:"📊",color:n.text,theme:n,onClick:()=>V("all"),active:p==="all"}),i.jsx(Tt,{label:"Customers",value:Z?"...":_.Customer,icon:"👥",color:n.success,theme:n,onClick:()=>V(p==="Customer"?"all":"Customer"),active:p==="Customer"}),i.jsx(Tt,{label:"Prospects",value:Z?"...":_.Prospect,icon:"🎯",color:n.primary,theme:n,onClick:()=>V(p==="Prospect"?"all":"Prospect"),active:p==="Prospect"}),i.jsx(Tt,{label:"Prior Customers",value:Z?"...":_.Prior,icon:"📁",color:n.textMuted,theme:n,onClick:()=>V(p==="Prior"?"all":"Prior"),active:p==="Prior"}),i.jsx(Tt,{label:"Expiring in 30d",value:Z?"...":_.expiring,icon:"⚠️",color:n.warning,theme:n,onClick:()=>V(p==="expiring"?"all":"expiring"),active:p==="expiring"})]}),i.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"20px",alignItems:"center",flexWrap:"wrap"},children:[i.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"350px"},children:[i.jsx("input",{type:"text",placeholder:"Search by name, email, or phone...",value:l,onChange:C=>se(C.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"}}),i.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:n.textMuted},children:"🔍"})]}),i.jsxs("select",{value:p,onChange:C=>V(C.target.value),style:{padding:"10px 12px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px",minWidth:"150px"},children:[i.jsx("option",{value:"all",children:"All Types"}),i.jsx("option",{value:"Customer",children:"Customers"}),i.jsx("option",{value:"Prospect",children:"Prospects"}),i.jsx("option",{value:"Prior",children:"Prior Customers"}),i.jsx("option",{value:"Lead",children:"Leads"}),i.jsx("option",{value:"expiring",children:"Expiring Policies"})]}),i.jsxs("select",{value:`${x}-${f}`,onChange:C=>{const[B,P]=C.target.value.split("-");g(B),M(P)},style:{padding:"10px 12px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px",minWidth:"150px"},children:[i.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),i.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),i.jsx("option",{value:"created_at-desc",children:"Newest First"}),i.jsx("option",{value:"created_at-asc",children:"Oldest First"})]}),i.jsx("span",{style:{fontSize:"13px",color:n.textMuted,marginLeft:"auto"},children:p==="expiring"?`${K.length} account${K.length!==1?"s":""} with expiring policies`:`Showing ${(b-1)*j+1}-${Math.min(b*j,z)} of ${z} account${z!==1?"s":""}`})]}),R?i.jsx("div",{style:{backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,padding:"20px"},children:Array.from({length:5}).map((C,B)=>i.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:B>0?`1px solid ${n.border}`:"none"},children:[i.jsx(Oi,{width:"40px",height:"40px"}),i.jsxs("div",{style:{flex:1},children:[i.jsx(Oi,{width:"200px",height:"16px"}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(Oi,{width:"150px",height:"12px"})})]})]},B))}):K.length>0?i.jsx("div",{style:{backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,overflow:"hidden"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{backgroundColor:n.bgHover},children:[i.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Account"}),i.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Type"}),i.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Policies"}),i.jsx("th",{style:{padding:"14px 16px",textAlign:"center",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"# Policies"}),i.jsx("th",{style:{padding:"14px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Actions"})]})}),i.jsx("tbody",{children:K.map(C=>i.jsx(Js,{client:C,onClick:()=>X(C.account_unique_id),theme:n},C.id))})]})}):i.jsxs("div",{style:{padding:"60px 20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"👥"}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"8px"},children:l?"No accounts found":"No accounts yet"}),i.jsx("p",{style:{fontSize:"14px",color:n.textSecondary,marginBottom:"24px"},children:l?"Try adjusting your search criteria.":"Your accounts will appear here once synced from Salesforce."})]}),W>1&&p!=="expiring"&&i.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginTop:"24px",padding:"16px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("button",{onClick:()=>I(1),disabled:b===1,style:{padding:"8px 12px",backgroundColor:b===1?n.bgHover:n.bg,border:`1px solid ${n.border}`,borderRadius:"6px",color:b===1?n.textMuted:n.text,cursor:b===1?"not-allowed":"pointer",fontSize:"13px"},children:"⟨⟨ First"}),i.jsx("button",{onClick:()=>I(C=>Math.max(1,C-1)),disabled:b===1,style:{padding:"8px 12px",backgroundColor:b===1?n.bgHover:n.bg,border:`1px solid ${n.border}`,borderRadius:"6px",color:b===1?n.textMuted:n.text,cursor:b===1?"not-allowed":"pointer",fontSize:"13px"},children:"⟨ Prev"}),i.jsxs("span",{style:{padding:"8px 16px",fontSize:"14px",color:n.text,fontWeight:"500"},children:["Page ",b," of ",W]}),i.jsx("button",{onClick:()=>I(C=>Math.min(W,C+1)),disabled:b===W,style:{padding:"8px 12px",backgroundColor:b===W?n.bgHover:n.bg,border:`1px solid ${n.border}`,borderRadius:"6px",color:b===W?n.textMuted:n.text,cursor:b===W?"not-allowed":"pointer",fontSize:"13px"},children:"Next ⟩"}),i.jsx("button",{onClick:()=>I(W),disabled:b===W,style:{padding:"8px 12px",backgroundColor:b===W?n.bgHover:n.bg,border:`1px solid ${n.border}`,borderRadius:"6px",color:b===W?n.textMuted:n.text,cursor:b===W?"not-allowed":"pointer",fontSize:"13px"},children:"Last ⟩⟩"})]}),_.expiring>0&&p!=="expiring"&&i.jsxs("div",{style:{marginTop:"24px",padding:"16px 20px",backgroundColor:`${n.warning}10`,border:`1px solid ${n.warning}30`,borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("span",{style:{fontSize:"24px"},children:"⚠️"}),i.jsxs("div",{children:[i.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:n.text},children:[_.expiring," account",_.expiring!==1?"s have":" has"," policies expiring in the next 30 days"]}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary},children:"Consider setting up renewal reminders for these accounts."})]})]}),i.jsx("button",{onClick:()=>V("expiring"),style:{padding:"8px 16px",backgroundColor:n.warning,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"View Expiring"})]})]})},Xe=({width:n="100%",height:s="20px"})=>i.jsx("div",{style:{width:n,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),jo=({status:n,theme:s})=>{const r={active:{bg:`${s.success}20`,text:s.success},pending:{bg:`${s.warning}20`,text:s.warning},cancelled:{bg:`${s.danger}20`,text:s.danger},expired:{bg:`${s.textMuted}20`,text:s.textMuted}},l=r[n]||r.pending;return i.jsx("span",{style:{padding:"4px 10px",backgroundColor:l.bg,color:l.text,borderRadius:"20px",fontSize:"11px",fontWeight:"500",textTransform:"capitalize"},children:n})},Lt=({event:n,theme:s})=>{const r={sent:"📤",delivered:"✅",opened:"📬",clicked:"🖱️",bounced:"❌",unsubscribed:"🚫"};return i.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"2px 8px",backgroundColor:s.bgHover,borderRadius:"4px",fontSize:"11px",color:s.textSecondary},children:[r[n]||"📧"," ",n]})},Xs=({policy:n,theme:s})=>{var u;const r=n.expiration_date?Math.ceil((new Date(n.expiration_date)-new Date)/864e5):null,l=n.policy_lob||n.policy_type||"Unknown",d=n.policy_status||n.status||"unknown",p=((u=n.carrier)==null?void 0:u.name)||n.carrier_name||n.carrier||"—";return i.jsxs("div",{style:{padding:"16px",backgroundColor:s.bg,borderRadius:"10px",border:`1px solid ${s.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[i.jsx("div",{style:{padding:"8px 12px",backgroundColor:`${s.primary}15`,borderRadius:"8px",fontSize:"14px",fontWeight:"600",color:s.primary},children:l}),i.jsx(jo,{status:d.toLowerCase(),theme:s})]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",fontSize:"13px"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{color:s.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Policy Number"}),i.jsx("div",{style:{color:s.text},children:n.policy_number||"—"})]}),i.jsxs("div",{children:[i.jsx("div",{style:{color:s.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Carrier"}),i.jsx("div",{style:{color:s.text},children:p})]}),i.jsxs("div",{children:[i.jsx("div",{style:{color:s.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Effective Date"}),i.jsx("div",{style:{color:s.text},children:n.effective_date?new Date(n.effective_date).toLocaleDateString():"—"})]}),i.jsxs("div",{children:[i.jsx("div",{style:{color:s.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Expiration"}),i.jsx("div",{style:{color:r!==null&&r>0&&r<=30?s.warning:s.text},children:n.expiration_date?i.jsxs(i.Fragment,{children:[new Date(n.expiration_date).toLocaleDateString(),r!==null&&r>0&&r<=30&&i.jsxs("span",{style:{fontSize:"11px",marginLeft:"6px"},children:["(",r,"d left)"]})]}):"—"})]})]}),(n.premium||n.annual_premium)&&i.jsxs("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:`1px solid ${s.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("span",{style:{fontSize:"12px",color:s.textMuted},children:"Annual Premium"}),i.jsxs("span",{style:{fontSize:"16px",fontWeight:"600",color:s.success},children:["$",(n.premium||n.annual_premium).toLocaleString()]})]})]})},ea=({log:n,theme:s})=>{var r;return i.jsxs("div",{style:{padding:"14px",backgroundColor:s.bg,borderRadius:"8px",border:`1px solid ${s.border}`,marginBottom:"8px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:s.text},children:((r=n.email_templates)==null?void 0:r.name)||"Direct Email"}),i.jsx("div",{style:{fontSize:"12px",color:s.textSecondary,marginTop:"2px"},children:n.subject})]}),i.jsx("div",{style:{textAlign:"right"},children:i.jsxs("div",{style:{fontSize:"11px",color:s.textMuted},children:[new Date(n.sent_at).toLocaleDateString()," at"," ",new Date(n.sent_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})})]}),i.jsxs("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:[i.jsx(Lt,{event:"sent",theme:s}),n.delivered_at&&i.jsx(Lt,{event:"delivered",theme:s}),n.opened_at&&i.jsx(Lt,{event:"opened",theme:s}),n.clicked_at&&i.jsx(Lt,{event:"clicked",theme:s}),n.bounced_at&&i.jsx(Lt,{event:"bounced",theme:s})]})]})},ta=({activity:n,theme:s})=>{const r={email_sent:"📤",email_opened:"📬",email_clicked:"🖱️",enrollment_started:"▶️",enrollment_completed:"✅",enrollment_paused:"⏸️",note_added:"📝"};return i.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[i.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:s.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:r[n.action_type]||"📌"}),i.jsxs("div",{style:{flex:1},children:[i.jsx("div",{style:{fontSize:"13px",color:s.text},children:n.description}),i.jsx("div",{style:{fontSize:"11px",color:s.textMuted,marginTop:"2px"},children:new Date(n.created_at).toLocaleString()})]})]})},lo=({enrollment:n,theme:s,userId:r})=>{var l;return i.jsxs("div",{style:{padding:"14px",backgroundColor:s.bg,borderRadius:"8px",border:`1px solid ${s.border}`,marginBottom:"8px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx(tt,{to:`/${r}/automations/${n.automation_id}`,style:{fontSize:"14px",fontWeight:"500",color:s.text,textDecoration:"none"},children:((l=n.automations)==null?void 0:l.name)||"Unknown Automation"}),i.jsxs("div",{style:{fontSize:"12px",color:s.textMuted,marginTop:"2px"},children:["Started ",new Date(n.enrolled_at).toLocaleDateString()]})]}),i.jsx(jo,{status:n.status==="active"?"active":n.status,theme:s})]}),n.current_node_id&&i.jsxs("div",{style:{marginTop:"10px",padding:"8px 10px",backgroundColor:s.bgHover,borderRadius:"6px",fontSize:"12px",color:s.textSecondary},children:["📍 Current step: ",n.current_node_name||n.current_node_id]})]})},ia=({t:n})=>{var Z,E;const{userId:s,accountId:r}=_e(),l=ht(),[d,p]=D.useState("overview"),{data:u,isLoading:x,error:g}=Cs(r),{data:f,isLoading:M}=vs(d==="overview"||d==="emails"?r:null),{data:b,isLoading:I}=Ts(d==="activity"?r:null),{data:j,isLoading:S}=_s(d==="overview"||d==="automations"?r:null),{data:k}=bo(),R={emailsSent:(f==null?void 0:f.length)||0,opened:(f==null?void 0:f.filter(z=>z.opened_at).length)||0,clicked:(f==null?void 0:f.filter(z=>z.clicked_at).length)||0,openRate:(f==null?void 0:f.length)>0?Math.round(f.filter(z=>z.opened_at).length/f.length*100):0,clickRate:(f==null?void 0:f.length)>0?Math.round(f.filter(z=>z.clicked_at).length/f.length*100):0,activeEnrollments:(j==null?void 0:j.filter(z=>z.status==="active").length)||0},v={openRate:(k==null?void 0:k.openRate)||25,clickRate:(k==null?void 0:k.clickRate)||5};if(x)return i.jsxs("div",{children:[i.jsx(Xe,{width:"200px",height:"32px"}),i.jsx("div",{style:{marginTop:"20px"},children:i.jsx(Xe,{height:"200px"})})]});if(g||!u)return i.jsxs("div",{style:{padding:"60px 20px",textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"😕"}),i.jsx("h2",{style:{color:n.text,marginBottom:"8px"},children:"Account Not Found"}),i.jsx("p",{style:{color:n.textSecondary,marginBottom:"24px"},children:"We couldn't find the account you're looking for."}),i.jsx("button",{onClick:()=>l(`/${s}/accounts`),style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Accounts"})]});const O=[{id:"overview",label:"Overview"},{id:"emails",label:`Emails (${(f==null?void 0:f.length)||0})`},{id:"automations",label:`Automations (${(j==null?void 0:j.length)||0})`},{id:"activity",label:"Activity"}];return i.jsxs("div",{children:[i.jsxs("div",{style:{marginBottom:"24px"},children:[i.jsx("button",{onClick:()=>l(`/${s}/accounts`),style:{background:"none",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"14px",marginBottom:"12px",padding:0,display:"flex",alignItems:"center",gap:"6px"},children:"← Back to Accounts"}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:u.name}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(()=>{const z=(u.account_status||"").toLowerCase();let W=z;(z==="prior_customer"||z.startsWith("prior"))&&(W="prior"),z.startsWith("customer")&&(W="customer"),z.startsWith("prospect")&&(W="prospect"),z.startsWith("lead")&&(W="lead");const K={customer:{bg:`${n.success}20`,text:n.success,label:"Customer"},prospect:{bg:`${n.primary}20`,text:n.primary,label:"Prospect"},prior:{bg:`${n.textMuted}20`,text:n.textMuted,label:"Prior Customer"},lead:{bg:`${n.warning}20`,text:n.warning,label:"Lead"}},V=K[W]||K.prospect;return i.jsx("span",{style:{padding:"4px 10px",backgroundColor:V.bg,color:V.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:V.label})})(),u.account_unique_id&&i.jsxs("span",{style:{fontSize:"12px",color:n.textMuted},children:["ID: ",u.account_unique_id]})]})]}),i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx("button",{style:{padding:"10px 16px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:"📝 Add Note"}),i.jsx("button",{style:{padding:"10px 16px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"📧 Send Email"})]})]})]}),i.jsxs("div",{style:{display:"flex",gap:"24px",padding:"16px 20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,marginBottom:"24px",flexWrap:"wrap"},children:[(u.person_email||u.email)&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"16px"},children:"📧"}),i.jsx("a",{href:`mailto:${u.person_email||u.email}`,style:{color:n.primary,textDecoration:"none",fontSize:"14px"},children:u.person_email||u.email})]}),u.phone&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"16px"},children:"📱"}),i.jsx("a",{href:`tel:${u.phone}`,style:{color:n.text,textDecoration:"none",fontSize:"14px"},children:u.phone})]}),(u.billing_street||u.billing_city||u.billing_state)&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"16px"},children:"📍"}),i.jsx("span",{style:{color:n.textSecondary,fontSize:"14px"},children:[u.billing_street,[u.billing_city,u.billing_state].filter(Boolean).join(", "),u.billing_postal_code].filter(Boolean).join(" • ")})]}),u.primary_contact_first_name&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"16px"},children:"👤"}),i.jsxs("span",{style:{color:n.textSecondary,fontSize:"14px"},children:[u.primary_contact_first_name," ",u.primary_contact_last_name]})]})]}),i.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:n.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:O.map(z=>i.jsx("button",{onClick:()=>p(z.id),style:{padding:"10px 20px",backgroundColor:d===z.id?n.bgCard:"transparent",border:"none",borderRadius:"8px",color:d===z.id?n.text:n.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:z.label},z.id))}),d==="overview"&&i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,display:"flex",flexDirection:"column"},children:[i.jsxs("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px",flexShrink:0},children:["Policies (",((Z=u.policies)==null?void 0:Z.length)||0,")"]}),((E=u.policies)==null?void 0:E.length)>0?i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto",flex:1,paddingRight:"8px"},children:u.policies.map((z,W)=>i.jsx(Xs,{policy:z,theme:n},W))}):i.jsx("div",{style:{padding:"30px",textAlign:"center",color:n.textMuted},children:"No policies on file"})]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Email Engagement"}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"20px"},children:[i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.primary},children:R.emailsSent}),i.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:"Sent"})]}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.success},children:R.opened}),i.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:"Opened"})]}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.warning},children:R.clicked}),i.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:"Clicked"})]}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.danger},children:(f==null?void 0:f.filter(z=>z.bounced_at).length)||0}),i.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:"Bounced"})]})]})]}),i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Compared to Average"}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[i.jsx("span",{style:{fontSize:"13px",color:n.textSecondary},children:"Open Rate"}),i.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:R.openRate>=v.openRate?n.success:n.danger},children:[R.openRate,"%",R.openRate>=v.openRate?" ↑":" ↓"]})]}),i.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:n.bgHover,borderRadius:"4px",overflow:"hidden"},children:[i.jsx("div",{style:{position:"absolute",left:`${Math.min(v.openRate,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:n.textMuted,zIndex:2}}),i.jsx("div",{style:{width:`${Math.min(R.openRate,100)}%`,height:"100%",backgroundColor:R.openRate>=v.openRate?n.success:n.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[i.jsx("span",{style:{fontSize:"10px",color:n.textMuted},children:"0%"}),i.jsxs("span",{style:{fontSize:"10px",color:n.textMuted},children:["Avg: ",v.openRate,"%"]}),i.jsx("span",{style:{fontSize:"10px",color:n.textMuted},children:"100%"})]})]}),i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[i.jsx("span",{style:{fontSize:"13px",color:n.textSecondary},children:"Click Rate"}),i.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:R.clickRate>=v.clickRate?n.success:n.danger},children:[R.clickRate,"%",R.clickRate>=v.clickRate?" ↑":" ↓"]})]}),i.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:n.bgHover,borderRadius:"4px",overflow:"hidden"},children:[i.jsx("div",{style:{position:"absolute",left:`${Math.min(v.clickRate*5,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:n.textMuted,zIndex:2}}),i.jsx("div",{style:{width:`${Math.min(R.clickRate*5,100)}%`,height:"100%",backgroundColor:R.clickRate>=v.clickRate?n.success:n.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[i.jsx("span",{style:{fontSize:"10px",color:n.textMuted},children:"0%"}),i.jsxs("span",{style:{fontSize:"10px",color:n.textMuted},children:["Avg: ",v.clickRate,"%"]}),i.jsx("span",{style:{fontSize:"10px",color:n.textMuted},children:"20%+"})]})]}),i.jsxs("div",{style:{padding:"16px",backgroundColor:n.bg,borderRadius:"10px",textAlign:"center",marginTop:"8px"},children:[i.jsx("div",{style:{fontSize:"11px",color:n.textMuted,marginBottom:"4px"},children:"ENGAGEMENT SCORE"}),i.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:R.openRate>=v.openRate&&R.clickRate>=v.clickRate?n.success:R.openRate>=v.openRate||R.clickRate>=v.clickRate?n.warning:n.danger},children:R.emailsSent===0?"—":R.openRate>=v.openRate&&R.clickRate>=v.clickRate?"High":R.openRate>=v.openRate||R.clickRate>=v.clickRate?"Medium":"Low"}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary,marginTop:"4px"},children:R.emailsSent===0?"No emails sent yet":R.openRate>=v.openRate?"Above average engagement":"Below average engagement"})]})]})]}),i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Active Automations"}),(j==null?void 0:j.filter(z=>z.status==="active").length)>0?j.filter(z=>z.status==="active").map(z=>i.jsx(lo,{enrollment:z,theme:n,userId:s},z.id)):i.jsx("div",{style:{padding:"20px",textAlign:"center",color:n.textMuted,fontSize:"13px"},children:"Not enrolled in any automations"})]})]})]}),d==="emails"&&i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Email History"}),M?Array.from({length:3}).map((z,W)=>i.jsx("div",{style:{marginBottom:"12px"},children:i.jsx(Xe,{height:"80px"})},W)):(f==null?void 0:f.length)>0?f.map(z=>i.jsx(ea,{log:z,theme:n},z.id)):i.jsx("div",{style:{padding:"40px",textAlign:"center",color:n.textMuted},children:"No emails sent to this client yet"})]}),d==="automations"&&i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Automation Enrollments"}),i.jsx("button",{style:{padding:"8px 12px",backgroundColor:n.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:"+ Enroll in Automation"})]}),S?Array.from({length:2}).map((z,W)=>i.jsx("div",{style:{marginBottom:"12px"},children:i.jsx(Xe,{height:"60px"})},W)):(j==null?void 0:j.length)>0?j.map(z=>i.jsx(lo,{enrollment:z,theme:n,userId:s},z.id)):i.jsx("div",{style:{padding:"40px",textAlign:"center",color:n.textMuted},children:"Not enrolled in any automations"})]}),d==="activity"&&i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Activity Timeline"}),I?Array.from({length:5}).map((z,W)=>i.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[i.jsx(Xe,{width:"32px",height:"32px"}),i.jsxs("div",{style:{flex:1},children:[i.jsx(Xe,{width:"80%",height:"14px"}),i.jsx("div",{style:{marginTop:"4px"},children:i.jsx(Xe,{width:"120px",height:"12px"})})]})]},W)):(b==null?void 0:b.length)>0?i.jsx("div",{style:{borderLeft:`2px solid ${n.border}`,marginLeft:"15px",paddingLeft:"20px"},children:b.map(z=>i.jsx(ta,{activity:z,theme:n},z.id))}):i.jsx("div",{style:{padding:"40px",textAlign:"center",color:n.textMuted},children:"No activity recorded yet"})]})]})},Di=({width:n="100%",height:s="20px"})=>i.jsx("div",{style:{width:n,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Le=({label:n,value:s,onChange:r,placeholder:l,type:d="text",disabled:p,hint:u,theme:x})=>i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:x.text,display:"block",marginBottom:"6px"},children:n}),i.jsx("input",{type:d,value:s||"",onChange:g=>r(g.target.value),placeholder:l,disabled:p,style:{width:"100%",padding:"12px",backgroundColor:p?x.bgHover:x.bgInput,border:`1px solid ${x.border}`,borderRadius:"8px",color:x.text,fontSize:"14px",opacity:p?.6:1}}),u&&i.jsx("p",{style:{fontSize:"11px",color:x.textMuted,marginTop:"4px"},children:u})]}),na=({label:n,value:s,onChange:r,placeholder:l,rows:d=3,disabled:p,theme:u})=>i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:u.text,display:"block",marginBottom:"6px"},children:n}),i.jsx("textarea",{value:s||"",onChange:x=>r(x.target.value),placeholder:l,rows:d,disabled:p,style:{width:"100%",padding:"12px",backgroundColor:p?u.bgHover:u.bgInput,border:`1px solid ${u.border}`,borderRadius:"8px",color:u.text,fontSize:"14px",resize:"vertical",opacity:p?.6:1}})]}),oa=({settings:n,theme:s})=>i.jsxs("div",{style:{padding:"16px",backgroundColor:s.bg,borderRadius:"8px",border:`1px solid ${s.border}`},children:[(n==null?void 0:n.full_name)&&i.jsx("div",{style:{fontWeight:"600",color:s.text},children:n.full_name}),(n==null?void 0:n.job_title)&&i.jsx("div",{style:{color:s.textSecondary,fontSize:"14px"},children:n.job_title}),i.jsx("div",{style:{color:s.textSecondary,fontSize:"14px",marginTop:"4px"},children:[n==null?void 0:n.phone,n==null?void 0:n.email].filter(Boolean).join(" · ")}),(n==null?void 0:n.custom_message)&&i.jsx("div",{style:{color:s.textMuted,fontSize:"14px",fontStyle:"italic",marginTop:"8px"},children:n.custom_message}),!(n!=null&&n.full_name)&&!(n!=null&&n.job_title)&&i.jsx("div",{style:{color:s.textMuted,fontSize:"14px"},children:"Fill in your details to see a preview"})]}),ra=({t:n})=>{const{userId:s}=_e(),[r,l]=D.useState("signature"),[d,p]=D.useState(!1),[u,x]=D.useState(null),{data:g,isLoading:f,error:M}=ws(),{updateSettings:b,updateSignature:I}=Ss(),[j,S]=D.useState({full_name:"",job_title:"",phone:"",email:"",custom_message:"",agency_name:"",agency_address:"",agency_phone:"",agency_website:"",default_from_name:"",default_from_email:"",reply_to_email:"",sending_domain:""});D.useEffect(()=>{g&&S({full_name:g.full_name||"",job_title:g.job_title||"",phone:g.phone||"",email:g.email||"",custom_message:g.custom_message||"",agency_name:g.agency_name||"",agency_address:g.agency_address||"",agency_phone:g.agency_phone||"",agency_website:g.agency_website||"",default_from_name:g.default_from_name||"",default_from_email:g.default_from_email||"",reply_to_email:g.reply_to_email||"",sending_domain:g.sending_domain||""})},[g]);const k=Z=>E=>{S(z=>({...z,[Z]:E})),x(null)},R=async()=>{p(!0),x(null);try{await I.mutateAsync({full_name:j.full_name,job_title:j.job_title,phone:j.phone,email:j.email,custom_message:j.custom_message}),x({type:"success",text:"Signature saved successfully!"})}catch{x({type:"error",text:"Failed to save signature. Please try again."})}finally{p(!1)}},v=async()=>{p(!0),x(null);try{await b.mutateAsync(j),x({type:"success",text:"Settings saved successfully!"})}catch{x({type:"error",text:"Failed to save settings. Please try again."})}finally{p(!1)}},O=[{id:"signature",label:"Email Signature",icon:"👤"},{id:"agency",label:"Agency Info",icon:"🏢"},{id:"email",label:"Email Settings",icon:"📧"},{id:"integrations",label:"Integrations",icon:"🔗"}];return i.jsxs("div",{children:[i.jsxs("div",{style:{marginBottom:"24px"},children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Settings"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px",margin:0},children:"Manage your email preferences and configuration"})]}),M&&i.jsx("div",{style:{padding:"16px",backgroundColor:`${n.danger}15`,border:`1px solid ${n.danger}30`,borderRadius:"8px",marginBottom:"24px",color:n.danger,fontSize:"14px"},children:"Failed to load settings. Please try refreshing the page."}),u&&i.jsx("div",{style:{padding:"12px 16px",backgroundColor:u.type==="success"?`${n.success}15`:`${n.danger}15`,border:`1px solid ${u.type==="success"?n.success:n.danger}30`,borderRadius:"8px",marginBottom:"24px",color:u.type==="success"?n.success:n.danger,fontSize:"14px"},children:u.text}),i.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:n.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:O.map(Z=>i.jsxs("button",{onClick:()=>l(Z.id),style:{padding:"10px 20px",backgroundColor:r===Z.id?n.bgCard:"transparent",border:"none",borderRadius:"8px",color:r===Z.id?n.text:n.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[Z.icon," ",Z.label]},Z.id))}),f?i.jsxs("div",{style:{padding:"24px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx(Di,{width:"200px",height:"24px"}),i.jsx("div",{style:{marginTop:"24px"},children:i.jsx(Di,{height:"40px"})}),i.jsx("div",{style:{marginTop:"16px"},children:i.jsx(Di,{height:"40px"})})]}):i.jsxs(i.Fragment,{children:[r==="signature"&&i.jsxs("div",{style:{padding:"24px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"4px"},children:"Your Email Signature"}),i.jsx("p",{style:{fontSize:"13px",color:n.textSecondary,marginBottom:"24px"},children:"This signature will be automatically added to all emails you send through the platform"}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[i.jsx(Le,{label:"Full Name",value:j.full_name,onChange:k("full_name"),placeholder:"John Doe",theme:n}),i.jsx(Le,{label:"Job Title",value:j.job_title,onChange:k("job_title"),placeholder:"Insurance Advisor",theme:n}),i.jsx(Le,{label:"Phone Number",value:j.phone,onChange:k("phone"),placeholder:"(555) 123-4567",theme:n}),i.jsx(Le,{label:"Email Address",value:j.email,onChange:k("email"),placeholder:"john.doe@company.com",type:"email",theme:n})]}),i.jsx(na,{label:"Custom Message (Optional)",value:j.custom_message,onChange:k("custom_message"),placeholder:"Looking forward to serving you!",theme:n}),i.jsxs("div",{style:{marginBottom:"24px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:n.text,display:"block",marginBottom:"8px"},children:"Preview"}),i.jsx(oa,{settings:j,theme:n})]}),i.jsx("button",{onClick:R,disabled:d,style:{padding:"12px 24px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:d?"wait":"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px",opacity:d?.7:1},children:d?"💾 Saving...":"💾 Save Signature"})]}),r==="agency"&&i.jsxs("div",{style:{padding:"24px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"4px"},children:"Agency Information"}),i.jsx("p",{style:{fontSize:"13px",color:n.textSecondary,marginBottom:"24px"},children:"Your agency details used in email templates and footers"}),i.jsx(Le,{label:"Agency Name",value:j.agency_name,onChange:k("agency_name"),placeholder:"Insurance Solutions Group",theme:n}),i.jsx(Le,{label:"Address",value:j.agency_address,onChange:k("agency_address"),placeholder:"123 Main Street, Suite 100, Dallas, TX 75201",theme:n}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[i.jsx(Le,{label:"Phone",value:j.agency_phone,onChange:k("agency_phone"),placeholder:"(555) 000-0000",theme:n}),i.jsx(Le,{label:"Website",value:j.agency_website,onChange:k("agency_website"),placeholder:"https://www.example.com",theme:n})]}),i.jsx("button",{onClick:v,disabled:d,style:{padding:"12px 24px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:d?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:d?.7:1},children:d?"💾 Saving...":"💾 Save Agency Info"})]}),r==="email"&&i.jsxs("div",{style:{padding:"24px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[i.jsxs("div",{children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"4px"},children:"Email Configuration"}),i.jsx("p",{style:{fontSize:"13px",color:n.textSecondary},children:"Configure your sending domain and default email settings"})]}),i.jsx("span",{style:{padding:"4px 10px",backgroundColor:n.bgHover,borderRadius:"20px",fontSize:"11px",color:n.textSecondary},children:"Admin Only"})]}),i.jsx(Le,{label:"Sending Domain",value:j.sending_domain,onChange:k("sending_domain"),placeholder:"emails.yourcompany.com",hint:"The domain that will be used to send emails. Must be verified in SendGrid.",theme:n}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[i.jsx(Le,{label:"Default From Name",value:j.default_from_name,onChange:k("default_from_name"),placeholder:"Your Company",theme:n}),i.jsx(Le,{label:"Default From Email",value:j.default_from_email,onChange:k("default_from_email"),placeholder:"noreply@yourcompany.com",type:"email",theme:n})]}),i.jsx(Le,{label:"Reply-To Email",value:j.reply_to_email,onChange:k("reply_to_email"),placeholder:"support@yourcompany.com",type:"email",hint:"Where replies will be directed when recipients respond to automated emails.",theme:n}),i.jsx("button",{onClick:v,disabled:d,style:{padding:"12px 24px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:d?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:d?.7:1},children:d?"💾 Saving...":"💾 Save Configuration"})]}),r==="integrations"&&i.jsxs("div",{style:{padding:"24px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"24px"},children:"Integrations"}),i.jsx("div",{style:{padding:"20px",backgroundColor:n.bg,borderRadius:"10px",border:`1px solid ${n.border}`,marginBottom:"16px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#1A82E2",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SG"}),i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:"600",color:n.text,marginBottom:"2px"},children:"SendGrid"}),i.jsx("div",{style:{fontSize:"13px",color:n.textSecondary},children:"Email delivery service"})]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${n.success}20`,color:n.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),i.jsx("button",{style:{padding:"8px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"6px",color:n.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Configure"})]})]})}),i.jsx("div",{style:{padding:"20px",backgroundColor:n.bg,borderRadius:"10px",border:`1px solid ${n.border}`,marginBottom:"16px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#00A1E0",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SF"}),i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:"600",color:n.text,marginBottom:"2px"},children:"Salesforce"}),i.jsx("div",{style:{fontSize:"13px",color:n.textSecondary},children:"CRM data sync"})]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${n.success}20`,color:n.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),i.jsx("button",{style:{padding:"8px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"6px",color:n.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Sync Now"})]})]})}),i.jsxs("div",{style:{padding:"16px",backgroundColor:`${n.primary}10`,borderRadius:"8px",marginTop:"24px"},children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:n.text,marginBottom:"4px"},children:"📌 Webhook URL"}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary,marginBottom:"8px"},children:"Configure this URL in SendGrid to receive email event notifications"}),i.jsxs("code",{style:{display:"block",padding:"8px 12px",backgroundColor:n.bgCard,borderRadius:"6px",fontSize:"12px",color:n.primary,wordBreak:"break-all"},children:["https://your-app-url.com/api/webhooks/sendgrid/",s]})]})]})]})]})},Co={bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},sa=({onClose:n,t:s=Co})=>{const[r,l]=D.useState("simple"),[d,p]=D.useState("OR"),[u,x]=D.useState(""),[g,f]=D.useState(null),M=[{id:1,name:"John Smith",policies:"Auto only • Expires in 52 days",passes:!0,conditions:[{label:"Has policy type: Auto",passes:!0,value:"Auto (Active)"},{label:"Has policy type: Home",passes:!0,value:"None (Excluded)"},{label:"Expiration: 45-60 days",passes:!0,value:"52 days"}],groupResults:[{passes:!0},{passes:!1}]},{id:2,name:"Jane Wilson",policies:"Home only • Expires in 48 days",passes:!0,conditions:[{label:"Has policy type: Home",passes:!0,value:"Home (Active)"},{label:"Has policy type: Auto",passes:!0,value:"None (Excluded)"},{label:"Expiration: 45-60 days",passes:!0,value:"48 days"}],groupResults:[{passes:!1},{passes:!0}]},{id:3,name:"Bob Johnson",policies:"Auto + Home • Expires in 55 days",passes:!1,conditions:[{label:"Has policy type: Auto",passes:!0,value:"Auto (Active)"},{label:"Excludes: Home",passes:!1,reason:"Account has Home policy",value:"Home (Active)"},{label:"Expiration: 45-60 days",passes:!0,value:"55 days"}],groupResults:[{passes:!1},{passes:!1}]},{id:4,name:"Sarah Davis",policies:"Auto only • Expires in 90 days",passes:!1,conditions:[{label:"Has policy type: Auto",passes:!0,value:"Auto (Active)"},{label:"Has policy type: Home",passes:!0,value:"None (Excluded)"},{label:"Expiration: 45-60 days",passes:!1,reason:"Outside timing window",value:"90 days"}],groupResults:[{passes:!1},{passes:!1}]}].filter(_=>_.name.toLowerCase().includes(u.toLowerCase())),[b,I]=D.useState([{id:1,name:"Group 1",logic:"AND",color:s.primary,filters:{include:[{id:1,conditionId:"has_policy_type",label:"Has policy type",icon:"📋",value:"Auto"}],exclude:[{id:2,conditionId:"has_policy_type",label:"Has policy type",icon:"📋",value:"Home"}],activity:[]}},{id:2,name:"Group 2",logic:"AND",color:s.purple,filters:{include:[{id:3,conditionId:"has_policy_type",label:"Has policy type",icon:"📋",value:"Home"}],exclude:[{id:4,conditionId:"has_policy_type",label:"Has policy type",icon:"📋",value:"Auto"}],activity:[]}}]),[j,S]=D.useState({enabled:!0,field:"expiration_days",min:45,max:60}),k={"Customer Type":{icon:"👤",color:s.purple,conditions:[{id:"customer_status",label:"Customer status",configType:"select",options:["New","Existing","Prior","Prospect"]},{id:"is_new",label:"Is a new customer",configType:"none"},{id:"is_existing",label:"Is an existing customer",configType:"none"},{id:"is_prior",label:"Is a prior customer",configType:"none"}]},"Policy Bundle":{icon:"📦",color:s.primary,conditions:[{id:"bundle_status",label:"Bundle status",configType:"select",options:["Monoline","Bundled"]},{id:"policy_count",label:"Number of policies",configType:"number_compare",unit:"policies"}]},Coverage:{icon:"📋",color:s.success,conditions:[{id:"has_policy_type",label:"Has policy type",configType:"select",options:["Auto","Home","Renters","Umbrella","Life","Any Active"]},{id:"policy_status",label:"Policy status",configType:"select",options:["Active","Pending","Cancelled","Expired"]},{id:"has_active_renewal",label:"Has an active renewal",configType:"none"}]},"Policy Timing":{icon:"📅",color:s.warning,conditions:[{id:"expiration_days",label:"Expiration date",configType:"days_from_now"},{id:"effective_days",label:"Effective date",configType:"days_ago"},{id:"approaching_renewal",label:"Is approaching renewal",configType:"none"}]},"Email History":{icon:"📧",color:"#06b6d4",conditions:[{id:"no_email_in",label:"Hasn't received email in",configType:"days_threshold",defaultValue:30},{id:"received_template",label:"Has received email",configType:"select",options:["Welcome","Renewal","Cross Sell","Follow-Up","Feedback"]},{id:"not_received_template",label:"Has NOT received email",configType:"select",options:["Welcome","Renewal","Cross Sell","Follow-Up","Feedback"]}]},Engagement:{icon:"📬",color:"#8b5cf6",conditions:[{id:"opened_last",label:"Opened last email",configType:"none"},{id:"clicked_last",label:"Clicked last email",configType:"none"},{id:"no_opens_in",label:"Hasn't opened email in",configType:"days_threshold",defaultValue:60}]},Feedback:{icon:"⭐",color:"#eab308",conditions:[{id:"feedback_score",label:"Feedback score",configType:"number_compare",unit:"stars",max:5},{id:"gave_feedback",label:"Has given feedback",configType:"none"},{id:"no_feedback",label:"Has not given feedback",configType:"none"}]}},R=["#3b82f6","#a78bfa","#22c55e","#f59e0b","#ec4899","#06b6d4"],v=()=>{const _=Math.max(...b.map(C=>C.id),0)+1;I([...b,{id:_,name:`Group ${_}`,logic:"AND",color:R[(_-1)%R.length],filters:{include:[],exclude:[],activity:[]}}])},O=_=>{b.length>1&&I(b.filter(C=>C.id!==_))},Z=(_,C,B)=>{I(b.map(P=>P.id===_?{...P,filters:{...P.filters,[C]:[...P.filters[C],{...B,id:Date.now()}]}}:P))},E=(_,C,B,P)=>{I(b.map($=>$.id===_?{...$,filters:{...$.filters,[C]:$.filters[C].map(U=>U.id===B?{...U,...P}:U)}}:$))},z=(_,C,B)=>{I(b.map(P=>P.id===_?{...P,filters:{...P.filters,[C]:P.filters[C].filter($=>$.id!==B)}}:P))},W=_=>{for(const C of Object.values(k)){const B=C.conditions.find(P=>P.id===_);if(B)return B}return null},K=({filter:_,groupId:C,section:B,color:P})=>{const $=W(_.conditionId),U=()=>{if(!$)return null;switch($.configType){case"select":return i.jsx("select",{value:_.value||$.options[0],onChange:te=>E(C,B,_.id,{value:te.target.value}),style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"4px 8px",color:s.text,fontSize:"12px",marginLeft:"6px"},children:$.options.map(te=>i.jsx("option",{value:te,children:te},te))});case"days_threshold":return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginLeft:"6px"},children:[i.jsx("input",{type:"number",value:_.value||$.defaultValue||30,onChange:te=>E(C,B,_.id,{value:te.target.value}),style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"4px 6px",color:s.text,fontSize:"12px",width:"50px",textAlign:"center"}}),i.jsx("span",{style:{color:s.textMuted,fontSize:"11px"},children:"days"})]});case"number_compare":return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginLeft:"6px"},children:[i.jsxs("select",{value:_.operator||"at_least",onChange:te=>E(C,B,_.id,{operator:te.target.value}),style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"4px 6px",color:s.text,fontSize:"11px"},children:[i.jsx("option",{value:"equals",children:"equals"}),i.jsx("option",{value:"at_least",children:"at least"}),i.jsx("option",{value:"at_most",children:"at most"})]}),i.jsx("input",{type:"number",value:_.value||1,max:$.max,onChange:te=>E(C,B,_.id,{value:te.target.value}),style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"4px 6px",color:s.text,fontSize:"12px",width:"45px",textAlign:"center"}}),$.unit&&i.jsx("span",{style:{color:s.textMuted,fontSize:"11px"},children:$.unit})]});default:return null}};return i.jsxs("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"4px",padding:"8px 10px",backgroundColor:`${P}12`,borderRadius:"8px",border:`1px solid ${P}25`,fontSize:"13px",color:s.text},children:[i.jsx("span",{style:{opacity:.7},children:_.icon}),i.jsx("span",{children:_.label}),U(),i.jsx("button",{onClick:()=>z(C,B,_.id),style:{background:"none",border:"none",color:s.textMuted,cursor:"pointer",padding:"0 2px",fontSize:"16px",lineHeight:1,marginLeft:"auto"},children:"×"})]})},V=({groupId:_,section:C,onSelect:B,buttonColor:P})=>{const[$,U]=D.useState(!1),[te,H]=D.useState(null),we=C==="include"?"Add condition":C==="exclude"?"Add exclusion":"Add activity filter";return i.jsxs("div",{style:{position:"relative"},children:[i.jsxs("button",{onClick:()=>U(!$),style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:`1px dashed ${s.borderLight}`,borderRadius:"8px",color:s.textMuted,cursor:"pointer",fontSize:"12px",textAlign:"left",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{style:{color:P},children:"+"})," ",we]}),$&&i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:()=>{U(!1),H(null)}}),i.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",backgroundColor:s.bgCard,border:`1px solid ${s.borderLight}`,borderRadius:"12px",zIndex:100,overflow:"hidden",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},children:i.jsxs("div",{style:{display:"flex",maxHeight:"280px"},children:[i.jsx("div",{style:{width:"140px",borderRight:"1px solid #3f3f46",overflowY:"auto"},children:Object.entries(k).map(([q,ne])=>i.jsxs("button",{onClick:()=>H(q),style:{width:"100%",padding:"8px 10px",backgroundColor:te===q?"#27272a":"transparent",border:"none",borderLeft:te===q?`3px solid ${ne.color}`:"3px solid transparent",color:te===q?"#fafafa":"#a1a1aa",cursor:"pointer",fontSize:"11px",textAlign:"left",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:ne.icon})," ",q]},q))}),i.jsx("div",{style:{flex:1,padding:"6px",overflowY:"auto",minWidth:"180px"},children:te?k[te].conditions.map(q=>i.jsx("button",{onClick:()=>{B({conditionId:q.id,label:q.label,icon:k[te].icon,value:q.options?q.options[0]:q.defaultValue}),U(!1),H(null)},style:{width:"100%",padding:"8px 10px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:s.text,cursor:"pointer",fontSize:"12px",textAlign:"left"},children:q.label},q.id)):i.jsx("div",{style:{padding:"20px 12px",textAlign:"center",color:s.textMuted,fontSize:"11px"},children:"← Select category"})})]})})]})]})},se=()=>i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 0"},children:[i.jsx("div",{style:{height:"14px",width:"2px",backgroundColor:s.borderLight}}),i.jsx("button",{onClick:()=>p(d==="OR"?"AND":"OR"),style:{margin:"0 -1px",padding:"4px 12px",backgroundColor:d==="OR"?"#7c3aed":"#0891b2",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",fontSize:"10px",fontWeight:"700"},children:d}),i.jsx("div",{style:{height:"14px",width:"2px",backgroundColor:s.borderLight}})]}),X=({group:_,index:C})=>i.jsxs("div",{style:{backgroundColor:s.bg,borderRadius:"10px",border:`2px solid ${_.color}30`,overflow:"hidden"},children:[i.jsxs("div",{style:{padding:"8px 12px",backgroundColor:`${_.color}10`,borderBottom:`1px solid ${_.color}20`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"5px",backgroundColor:_.color,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"700",color:"#fff"},children:C+1}),i.jsx("input",{type:"text",value:_.name,onChange:B=>I(b.map(P=>P.id===_.id?{...P,name:B.target.value}:P)),style:{background:"none",border:"none",color:s.text,fontSize:"12px",fontWeight:"600",width:"80px"}})]}),b.length>1&&i.jsx("button",{onClick:()=>O(_.id),style:{background:"none",border:"none",color:s.textMuted,cursor:"pointer",fontSize:"16px"},children:"×"})]}),i.jsxs("div",{style:{padding:"12px"},children:[i.jsxs("div",{style:{marginBottom:"10px"},children:[i.jsxs("div",{style:{fontSize:"10px",fontWeight:"600",color:s.success,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{children:"✓"})," INCLUDE"]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[_.filters.include.map(B=>i.jsx(K,{filter:B,groupId:_.id,section:"include",color:"#22c55e"},B.id)),i.jsx(V,{groupId:_.id,section:"include",onSelect:B=>Z(_.id,"include",B),buttonColor:"#22c55e"})]})]}),i.jsxs("div",{style:{marginBottom:"10px"},children:[i.jsxs("div",{style:{fontSize:"10px",fontWeight:"600",color:s.danger,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{children:"✕"})," EXCLUDE"]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[_.filters.exclude.map(B=>i.jsx(K,{filter:B,groupId:_.id,section:"exclude",color:"#ef4444"},B.id)),i.jsx(V,{groupId:_.id,section:"exclude",onSelect:B=>Z(_.id,"exclude",B),buttonColor:"#ef4444"})]})]}),i.jsxs("div",{children:[i.jsxs("div",{style:{fontSize:"10px",fontWeight:"600",color:"#06b6d4",marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{children:"📧"})," ACTIVITY"]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[_.filters.activity.map(B=>i.jsx(K,{filter:B,groupId:_.id,section:"activity",color:"#06b6d4"},B.id)),i.jsx(V,{groupId:_.id,section:"activity",onSelect:B=>Z(_.id,"activity",B),buttonColor:"#06b6d4"})]})]})]})]});return i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 280px",gap:"16px",height:"100%"},children:[i.jsxs("div",{style:{overflowY:"auto",paddingRight:"8px"},children:[i.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"16px",backgroundColor:s.bgHover,padding:"3px",borderRadius:"8px",width:"fit-content"},children:[{id:"simple",label:"Guided",icon:"✨"},{id:"advanced",label:"Advanced",icon:"⚙️"}].map(_=>i.jsxs("button",{onClick:()=>l(_.id),style:{padding:"6px 12px",borderRadius:"6px",border:"none",cursor:"pointer",fontSize:"11px",fontWeight:"500",backgroundColor:r===_.id?"#3b82f6":"transparent",color:r===_.id?"#fff":"#71717a",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{children:_.icon})," ",_.label]},_.id))}),r==="simple"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px",padding:"8px 12px",backgroundColor:s.bgHover,borderRadius:"8px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"12px",color:s.textSecondary},children:"Filter Groups"}),b.length>1&&i.jsxs("span",{style:{padding:"2px 6px",backgroundColor:d==="OR"?"#7c3aed25":"#0891b225",borderRadius:"4px",fontSize:"9px",fontWeight:"600",color:d==="OR"?"#a78bfa":"#22d3ee"},children:[b.length," groups • ",d]})]}),i.jsx("button",{onClick:v,style:{padding:"4px 8px",backgroundColor:s.primary,border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer",fontSize:"10px",fontWeight:"500"},children:"+ Add Group"})]}),b.map((_,C)=>i.jsxs(He.Fragment,{children:[i.jsx(X,{group:_,index:C}),C<b.length-1&&i.jsx(se,{})]},_.id)),i.jsxs("div",{style:{marginTop:"16px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"8px"},children:[i.jsx("span",{style:{fontSize:"11px",color:s.primary},children:"⏱"}),i.jsx("span",{style:{fontSize:"12px",fontWeight:"600",color:s.text},children:"Timing"})]}),i.jsx("div",{style:{padding:"12px",backgroundColor:"rgba(59, 130, 246, 0.08)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[i.jsx("span",{style:{fontSize:"12px",color:s.textSecondary},children:"When"}),i.jsxs("select",{style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px 8px",color:s.text,fontSize:"11px"},children:[i.jsx("option",{children:"Days until expiration"}),i.jsx("option",{children:"Days since effective"}),i.jsx("option",{children:"Days since status change"})]}),i.jsx("span",{style:{fontSize:"12px",color:s.textSecondary},children:"is between"}),i.jsx("input",{type:"number",defaultValue:j.min,style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px",color:s.text,fontSize:"11px",width:"45px",textAlign:"center"}}),i.jsx("span",{style:{fontSize:"12px",color:s.textSecondary},children:"and"}),i.jsx("input",{type:"number",defaultValue:j.max,style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px",color:s.text,fontSize:"11px",width:"45px",textAlign:"center"}}),i.jsx("span",{style:{fontSize:"12px",color:s.textSecondary},children:"days"})]})})]})]}),r==="advanced"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px",padding:"8px 12px",backgroundColor:s.bgHover,borderRadius:"8px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"12px",color:s.textSecondary},children:"Rule Groups"}),i.jsx("button",{onClick:()=>p(d==="OR"?"AND":"OR"),style:{padding:"3px 8px",backgroundColor:d==="OR"?"#7c3aed":"#0891b2",border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer",fontSize:"9px",fontWeight:"700"},children:d}),i.jsx("span",{style:{fontSize:"10px",color:s.textMuted},children:"between groups"})]}),i.jsx("button",{onClick:v,style:{padding:"4px 8px",backgroundColor:s.primary,border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer",fontSize:"10px",fontWeight:"500"},children:"+ Add Group"})]}),b.map((_,C)=>i.jsxs(He.Fragment,{children:[i.jsxs("div",{style:{backgroundColor:s.bg,borderRadius:"10px",border:`2px solid ${_.color}30`,marginBottom:C<b.length-1?"0":"16px",overflow:"hidden"},children:[i.jsxs("div",{style:{padding:"8px 12px",backgroundColor:`${_.color}10`,borderBottom:`1px solid ${_.color}20`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"4px",backgroundColor:_.color,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"700",color:"#fff"},children:C+1}),i.jsx("input",{type:"text",value:_.name,onChange:B=>I(b.map(P=>P.id===_.id?{...P,name:B.target.value}:P)),style:{background:"none",border:"none",color:s.text,fontSize:"12px",fontWeight:"600",width:"80px"}})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{style:{fontSize:"10px",color:s.textMuted},children:"Logic:"}),i.jsxs("select",{value:_.logic,onChange:B=>I(b.map(P=>P.id===_.id?{...P,logic:B.target.value}:P)),style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"3px 6px",color:s.text,fontSize:"10px"},children:[i.jsx("option",{value:"AND",children:"AND"}),i.jsx("option",{value:"OR",children:"OR"})]}),b.length>1&&i.jsx("button",{onClick:()=>O(_.id),style:{background:"none",border:"none",color:s.textMuted,cursor:"pointer",fontSize:"14px"},children:"×"})]})]}),i.jsxs("div",{style:{padding:"10px"},children:[[..._.filters.include,..._.filters.exclude].map((B,P)=>i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 10px",backgroundColor:s.bgHover,borderRadius:"6px",marginBottom:"6px"},children:[i.jsxs("span",{style:{fontSize:"10px",color:s.textMuted,width:"16px",fontFamily:"monospace"},children:[P+1,"."]}),i.jsxs("select",{style:{backgroundColor:s.bgCard,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:s.textSecondary,fontSize:"10px",width:"80px"},children:[i.jsx("option",{children:"Field"}),i.jsx("option",{children:"Relationship"})]}),i.jsxs("select",{style:{backgroundColor:s.bgCard,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:s.text,fontSize:"10px",width:"70px"},children:[i.jsx("option",{children:"Policy"}),i.jsx("option",{children:"Account"}),i.jsx("option",{children:"Contact"})]}),i.jsx("span",{style:{color:s.borderLight,fontSize:"10px"},children:"."}),i.jsxs("select",{style:{backgroundColor:s.bgCard,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:s.text,fontSize:"10px",flex:1},children:[i.jsx("option",{children:"Type"}),i.jsx("option",{children:"Status"}),i.jsx("option",{children:"Premium"}),i.jsx("option",{children:"Effective Date"}),i.jsx("option",{children:"Expiration Date"})]}),i.jsxs("select",{style:{backgroundColor:s.bgCard,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:_.filters.exclude.find($=>$.id===B.id)?"#f87171":"#4ade80",fontSize:"10px",width:"80px"},children:[i.jsx("option",{children:"equals"}),i.jsx("option",{children:"not equals"}),i.jsx("option",{children:"contains"}),i.jsx("option",{children:"is empty"}),i.jsx("option",{children:"is not empty"})]}),i.jsx("input",{type:"text",defaultValue:B.value||"",placeholder:"value",style:{backgroundColor:s.bgCard,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:s.text,fontSize:"10px",width:"70px"}}),i.jsx("button",{onClick:()=>{const $=_.filters.include.find(U=>U.id===B.id)?"include":"exclude";z(_.id,$,B.id)},style:{background:"none",border:"none",color:s.textMuted,cursor:"pointer",fontSize:"12px"},children:"×"})]},B.id)),i.jsx("button",{onClick:()=>Z(_.id,"include",{label:"New Rule",value:"",icon:"📋"}),style:{width:"100%",padding:"8px",backgroundColor:"transparent",border:`1px dashed ${s.borderLight}`,borderRadius:"6px",color:s.textMuted,cursor:"pointer",fontSize:"10px"},children:"+ Add Rule"})]})]}),C<b.length-1&&i.jsx(se,{})]},_.id)),i.jsxs("div",{style:{padding:"12px",backgroundColor:"rgba(59, 130, 246, 0.08)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)"},children:[i.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:s.primary,marginBottom:"8px"},children:"⏱ Timing Window"}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[i.jsxs("select",{style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px 8px",color:s.text,fontSize:"10px"},children:[i.jsx("option",{children:"Policy.ExpirationDate"}),i.jsx("option",{children:"Policy.EffectiveDate"}),i.jsx("option",{children:"Account.StatusChangeDate"}),i.jsx("option",{children:"EmailActivity.LastSentDate"})]}),i.jsxs("select",{style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px 8px",color:s.text,fontSize:"10px"},children:[i.jsx("option",{children:"days from now between"}),i.jsx("option",{children:"days ago between"})]}),i.jsx("input",{type:"number",defaultValue:"45",style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px",color:s.text,fontSize:"10px",width:"40px",textAlign:"center"}}),i.jsx("span",{style:{color:s.textMuted,fontSize:"10px"},children:"AND"}),i.jsx("input",{type:"number",defaultValue:"60",style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px",color:s.text,fontSize:"10px",width:"40px",textAlign:"center"}})]})]})]})]}),i.jsxs("div",{style:{backgroundColor:s.bg,borderRadius:"10px",padding:"14px",display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:s.textMuted,textTransform:"uppercase",marginBottom:"10px"},children:"Audience Preview"}),i.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"6px",marginBottom:"12px"},children:[i.jsx("span",{style:{fontSize:"32px",fontWeight:"700",color:s.primary,fontFamily:"monospace",lineHeight:1},children:"1,247"}),i.jsx("span",{style:{color:s.textMuted,fontSize:"12px"},children:"match"})]}),i.jsxs("div",{style:{display:"flex",gap:"6px",marginBottom:"12px"},children:[i.jsxs("div",{style:{flex:1,padding:"8px",backgroundColor:s.bgHover,borderRadius:"6px",textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:s.success},children:"2,847"}),i.jsx("div",{style:{fontSize:"9px",color:s.textMuted},children:"Included"})]}),i.jsxs("div",{style:{flex:1,padding:"8px",backgroundColor:s.bgHover,borderRadius:"6px",textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:s.danger},children:"1,600"}),i.jsx("div",{style:{fontSize:"9px",color:s.textMuted},children:"Excluded"})]})]}),b.length>1&&i.jsxs("div",{style:{marginBottom:"10px"},children:[i.jsx("div",{style:{fontSize:"9px",color:s.textMuted,marginBottom:"4px"},children:"By group:"}),b.map((_,C)=>i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px 6px",backgroundColor:s.bgHover,borderRadius:"4px",marginBottom:"3px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("div",{style:{width:"14px",height:"14px",borderRadius:"3px",backgroundColor:_.color,fontSize:"8px",fontWeight:"700",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},children:C+1}),i.jsx("span",{style:{fontSize:"10px",color:s.textSecondary},children:_.name})]}),i.jsx("span",{style:{fontSize:"11px",fontWeight:"600",color:_.color},children:C===0?"847":"523"})]},_.id))]})]}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:s.textMuted,textTransform:"uppercase",marginBottom:"8px"},children:"🔍 Test with Account"}),i.jsxs("div",{style:{position:"relative",marginBottom:"10px"},children:[i.jsx("input",{type:"text",placeholder:"Search accounts...",value:u,onChange:_=>x(_.target.value),style:{width:"100%",padding:"8px 10px",paddingRight:"30px",backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"6px",color:s.text,fontSize:"11px"}}),i.jsx("span",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:s.textMuted,fontSize:"12px"},children:"🔎"})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:M.map(_=>i.jsxs("div",{onClick:()=>f(g===_.id?null:_.id),style:{padding:"8px 10px",backgroundColor:_.passes?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",border:`1px solid ${_.passes?"rgba(34, 197, 94, 0.2)":"rgba(239, 68, 68, 0.2)"}`,borderRadius:"6px",cursor:"pointer"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:s.text},children:_.name}),i.jsx("div",{style:{fontSize:"9px",color:s.textMuted},children:_.policies})]}),i.jsx("div",{style:{padding:"3px 8px",backgroundColor:_.passes?"#22c55e":"#ef4444",borderRadius:"4px",fontSize:"9px",fontWeight:"600",color:"#fff"},children:_.passes?"✓ Pass":"✗ Fail"})]}),g===_.id&&i.jsxs("div",{style:{marginTop:"10px",paddingTop:"10px",borderTop:"1px solid rgba(255,255,255,0.1)"},children:[i.jsx("div",{style:{fontSize:"9px",fontWeight:"600",color:s.textMuted,marginBottom:"6px"},children:"CONDITION RESULTS"}),_.conditions.map((C,B)=>i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"6px",marginBottom:"4px",padding:"4px 6px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"4px"},children:[i.jsx("span",{style:{fontSize:"10px",color:C.passes?"#22c55e":"#ef4444",flexShrink:0},children:C.passes?"✓":"✗"}),i.jsxs("div",{style:{flex:1},children:[i.jsx("div",{style:{fontSize:"10px",color:s.text},children:C.label}),!C.passes&&C.reason&&i.jsx("div",{style:{fontSize:"9px",color:s.danger,marginTop:"2px"},children:C.reason}),C.value&&i.jsxs("div",{style:{fontSize:"9px",color:s.textMuted,marginTop:"2px"},children:["Actual: ",C.value]})]})]},B)),b.length>1&&i.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.05)"},children:[i.jsx("div",{style:{fontSize:"9px",color:s.textMuted,marginBottom:"4px"},children:"GROUP RESULTS"}),i.jsx("div",{style:{display:"flex",gap:"4px"},children:_.groupResults.map((C,B)=>{var P;return i.jsxs("div",{style:{flex:1,padding:"4px",backgroundColor:C.passes?"rgba(34, 197, 94, 0.15)":"rgba(239, 68, 68, 0.15)",borderRadius:"4px",textAlign:"center"},children:[i.jsxs("div",{style:{fontSize:"9px",fontWeight:"600",color:((P=b[B])==null?void 0:P.color)||"#71717a"},children:["G",B+1]}),i.jsx("div",{style:{fontSize:"10px",color:C.passes?"#22c55e":"#ef4444"},children:C.passes?"✓":"✗"})]},B)})}),i.jsx("div",{style:{fontSize:"9px",color:s.textMuted,textAlign:"center",marginTop:"4px"},children:d==="OR"?"Needs 1 group to pass":"Needs all groups to pass"})]})]})]},_.id))}),i.jsx("button",{style:{width:"100%",marginTop:"8px",padding:"6px",backgroundColor:"transparent",border:`1px dashed ${s.borderLight}`,borderRadius:"6px",color:s.textMuted,cursor:"pointer",fontSize:"10px"},children:"View all matching records →"})]}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:s.textMuted,textTransform:"uppercase",marginBottom:"8px"},children:"Summary"}),i.jsx("div",{style:{fontSize:"10px",color:s.textSecondary,lineHeight:"1.6"},children:b.map((_,C)=>i.jsxs(He.Fragment,{children:[i.jsxs("div",{style:{padding:"6px",backgroundColor:`${_.color}10`,borderRadius:"4px",border:`1px solid ${_.color}20`,marginBottom:(C<b.length-1,"0")},children:[i.jsx("div",{style:{fontWeight:"600",color:_.color,marginBottom:"2px",fontSize:"9px"},children:_.name}),i.jsxs("div",{style:{color:s.text,fontSize:"10px"},children:[_.filters.include.map(B=>`${B.label}: ${B.value||""}`).join(" + "),_.filters.exclude.length>0&&i.jsxs("span",{style:{color:s.danger},children:[" ","− ",_.filters.exclude.map(B=>`${B.value||B.label}`).join(", ")]})]})]}),C<b.length-1&&i.jsx("div",{style:{textAlign:"center",padding:"3px 0",fontWeight:"700",fontSize:"9px",color:d==="OR"?"#a78bfa":"#22d3ee"},children:d})]},_.id))})]})]})]})},aa=[{id:"entry-criteria",type:"entry_criteria",title:"Entry Criteria",subtitle:"Define who enters this automation",config:{filterConfig:{}}},{id:"trigger",type:"trigger",title:"Trigger",subtitle:"Daily at 09:00 (Central)",config:{time:"09:00",timezone:"America/Chicago",frequency:"Daily"}},{id:"node-1",type:"send_email",title:"Send Email",subtitle:"Select template...",config:{template:""}}],la=({t:n,automation:s,onUpdate:r,onSave:l})=>{var z,W,K,V,se,X,_,C,B;const d=n||Co,p=s!=null&&s.nodes&&s.nodes.length>0?s.nodes:aa,[u,x]=D.useState(p),[g,f]=D.useState(null),[M,b]=D.useState(null),[I,j]=D.useState(!1),S={entry_criteria:{icon:"🎯",color:"#8b5cf6",label:"Entry Criteria"},trigger:{icon:"⚡",color:d.primary,label:"Trigger"},send_email:{icon:"📧",color:d.success,label:"Send Email"},delay:{icon:"⏱",color:d.warning,label:"Delay"},condition:{icon:"🔀",color:d.purple,label:"Condition"},field_condition:{icon:"📋",color:"#ec4899",label:"Field Check"},update_field:{icon:"✏️",color:"#06b6d4",label:"Update Field"},end:{icon:"🏁",color:d.textMuted,label:"End"}},k=[{type:"send_email",label:"Send Email",desc:"Send an email template",icon:"📧"},{type:"delay",label:"Delay",desc:"Wait before continuing",icon:"⏱"},{type:"condition",label:"Email Engagement",desc:"Branch on open/click",icon:"📬"},{type:"field_condition",label:"Field Condition",desc:"Branch on field value",icon:"🔀"},{type:"update_field",label:"Update Field",desc:"Update a record field",icon:"✏️"},{type:"end",label:"End",desc:"Stop automation",icon:"🏁"}],R=(P,$,U=null)=>{var H;const te={id:`node-${Date.now()}`,type:$,title:((H=k.find(we=>we.type===$))==null?void 0:H.label)||$,subtitle:"Configure...",config:{}};if(($==="condition"||$==="field_condition")&&(te.branches={yes:[],no:[]}),U)x(we=>{const q=ne=>ne.map(ae=>ae.id===P&&ae.branches?{...ae,branches:{...ae.branches,[U]:[...ae.branches[U],te]}}:ae.branches?{...ae,branches:{yes:q(ae.branches.yes),no:q(ae.branches.no)}}:ae);return q(we)});else{const we=u.findIndex(ne=>ne.id===P),q=[...u];q.splice(we+1,0,te),x(q)}b(null),f(te.id)},v=P=>{x($=>$.filter(U=>U.id!==P&&U.id!=="trigger"&&U.id!=="entry-criteria")),g===P&&f(null)},O=({node:P})=>{const $=S[P.type]||S.send_email,U=g===P.id,te=P.type==="entry_criteria",H=P.type==="trigger",we=te||H;return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[i.jsxs("div",{onClick:()=>{f(P.id),te&&j(!0)},style:{width:"320px",backgroundColor:d.bgCard,border:U?`2px solid ${$.color}`:`1px solid ${d.border}`,borderRadius:"12px",padding:"16px 18px",cursor:"pointer",position:"relative"},children:[!we&&i.jsx("button",{onClick:q=>{q.stopPropagation(),v(P.id)},style:{position:"absolute",top:"8px",right:"8px",background:"none",border:"none",color:d.textMuted,cursor:"pointer",fontSize:"16px"},children:"×"}),i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${$.color}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:$.icon}),i.jsxs("div",{style:{flex:1},children:[i.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:d.text},children:P.title}),i.jsx("div",{style:{fontSize:"12px",color:d.textMuted,marginTop:"2px"},children:P.subtitle})]})]}),te&&i.jsxs("button",{onClick:q=>{q.stopPropagation(),j(!0)},style:{marginTop:"12px",width:"100%",padding:"10px",backgroundColor:d.bgHover,border:`1px solid ${d.borderLight}`,borderRadius:"8px",color:d.textSecondary,cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[i.jsx("span",{children:"🎯"})," Edit Entry Criteria"]})]}),!P.branches&&i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[i.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.borderLight}}),i.jsx("button",{onClick:()=>b({afterNodeId:P.id,branch:null}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:d.bgHover,border:`1px solid ${d.borderLight}`,color:d.textMuted,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"}),i.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.borderLight}}),(M==null?void 0:M.afterNodeId)===P.id&&!(M!=null&&M.branch)&&i.jsx(Z,{onSelect:q=>R(P.id,q),onClose:()=>b(null)})]}),P.branches&&i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[i.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.borderLight}}),i.jsxs("div",{style:{display:"flex"},children:[i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:d.success}}),i.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#22c55e20",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:d.success},children:"YES"})]}),i.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.success}}),P.branches.yes.map(q=>i.jsx(O,{node:q},q.id)),i.jsx("button",{onClick:()=>b({afterNodeId:P.id,branch:"yes"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:d.bgHover,border:"1px dashed #22c55e",color:d.success,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(M==null?void 0:M.afterNodeId)===P.id&&(M==null?void 0:M.branch)==="yes"&&i.jsx(Z,{onSelect:q=>R(P.id,q,"yes"),onClose:()=>b(null)})]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#ef444420",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:d.danger},children:"NO"}),i.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:d.danger}})]}),i.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.danger}}),P.branches.no.map(q=>i.jsx(O,{node:q},q.id)),i.jsx("button",{onClick:()=>b({afterNodeId:P.id,branch:"no"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:d.bgHover,border:"1px dashed #ef4444",color:d.danger,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(M==null?void 0:M.afterNodeId)===P.id&&(M==null?void 0:M.branch)==="no"&&i.jsx(Z,{onSelect:q=>R(P.id,q,"no"),onClose:()=>b(null)})]})]})]})]})},Z=({onSelect:P,onClose:$})=>i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:$}),i.jsx("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"10px",backgroundColor:d.bgCard,border:`1px solid ${d.borderLight}`,borderRadius:"12px",padding:"8px",zIndex:100,width:"240px",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},children:k.map(U=>i.jsxs("button",{onClick:()=>P(U.type),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px",color:d.text,textAlign:"left"},children:[i.jsx("span",{style:{fontSize:"18px"},children:U.icon}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500"},children:U.label}),i.jsx("div",{style:{fontSize:"11px",color:d.textMuted},children:U.desc})]})]},U.type))})]}),E=u.find(P=>P.id===g)||u.flatMap(P=>P.branches?[...P.branches.yes||[],...P.branches.no||[]]:[]).find(P=>P.id===g);return i.jsxs("div",{style:{fontFamily:"'IBM Plex Sans', -apple-system, sans-serif",backgroundColor:d.bg,height:"100%",color:d.text,display:"flex"},children:[i.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[i.jsxs("div",{style:{width:"220px",borderRight:`1px solid ${d.border}`,padding:"16px",backgroundColor:d.bgCard,overflowY:"auto"},children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:d.textMuted,marginBottom:"12px",textTransform:"uppercase"},children:"Add Nodes"}),k.map(P=>i.jsxs("div",{style:{padding:"12px",backgroundColor:d.bgHover,borderRadius:"8px",marginBottom:"8px",cursor:"grab",display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx("span",{style:{fontSize:"18px"},children:P.icon}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:d.text},children:P.label}),i.jsx("div",{style:{fontSize:"11px",color:d.textMuted},children:P.desc})]})]},P.type))]}),i.jsx("div",{style:{flex:1,padding:"40px",overflowY:"auto",display:"flex",justifyContent:"center"},children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[u.map(P=>i.jsx(O,{node:P},P.id)),i.jsx("div",{style:{marginTop:"16px",padding:"8px 18px",backgroundColor:d.bgHover,borderRadius:"20px",fontSize:"12px",color:d.textMuted},children:"End of automation"})]})}),i.jsxs("div",{style:{width:"300px",borderLeft:`1px solid ${d.border}`,backgroundColor:d.bgCard,overflowY:"auto"},children:[i.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${d.border}`,fontSize:"11px",fontWeight:"600",color:d.textMuted,textTransform:"uppercase"},children:"Configuration"}),i.jsx("div",{style:{padding:"18px"},children:E?i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${((z=S[E.type])==null?void 0:z.color)||d.primary}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:((W=S[E.type])==null?void 0:W.icon)||"📧"}),i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:"600",color:d.text,fontSize:"15px"},children:E.title}),i.jsx("div",{style:{fontSize:"12px",color:d.textMuted},children:((K=S[E.type])==null?void 0:K.label)||"Node"})]})]}),E.type==="entry_criteria"&&i.jsxs("div",{children:[i.jsx("p",{style:{fontSize:"13px",color:d.textSecondary,marginBottom:"16px"},children:"Define which contacts enter this automation based on their attributes and behavior."}),i.jsx("button",{onClick:()=>j(!0),style:{width:"100%",padding:"12px",backgroundColor:d.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Edit Entry Criteria"})]}),E.type==="trigger"&&i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Run Time"}),i.jsx("input",{type:"time",defaultValue:((V=E.config)==null?void 0:V.time)||"09:00",style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px",marginBottom:"16px"}}),i.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Frequency"}),i.jsxs("select",{defaultValue:((se=E.config)==null?void 0:se.frequency)||"Daily",style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"},children:[i.jsx("option",{children:"Daily"}),i.jsx("option",{children:"Weekly"}),i.jsx("option",{children:"Monthly"})]})]}),E.type==="send_email"&&i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Email Template"}),i.jsxs("select",{defaultValue:((X=E.config)==null?void 0:X.template)||"",style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"},children:[i.jsx("option",{value:"",children:"Select template..."}),i.jsx("option",{children:"Welcome Email"}),i.jsx("option",{children:"Cross-Sell Introduction"}),i.jsx("option",{children:"Renewal Reminder"}),i.jsx("option",{children:"Follow-Up"}),i.jsx("option",{children:"Re-engagement"})]})]}),E.type==="delay"&&i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Wait Duration"}),i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx("input",{type:"number",defaultValue:((_=E.config)==null?void 0:_.duration)||1,min:"1",style:{flex:1,padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"}}),i.jsxs("select",{defaultValue:((C=E.config)==null?void 0:C.unit)||"days",style:{flex:1,padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"},children:[i.jsx("option",{value:"hours",children:"Hours"}),i.jsx("option",{value:"days",children:"Days"}),i.jsx("option",{value:"weeks",children:"Weeks"})]})]})]}),(E.type==="condition"||E.type==="field_condition")&&i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Condition Type"}),i.jsxs("select",{defaultValue:((B=E.config)==null?void 0:B.type)||"email_opened",style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"},children:[i.jsx("option",{value:"email_opened",children:"Email Opened"}),i.jsx("option",{value:"email_clicked",children:"Email Clicked"}),i.jsx("option",{value:"field_value",children:"Field Value"})]})]}),E.type==="end"&&i.jsx("p",{style:{fontSize:"13px",color:d.textSecondary},children:"This node ends the automation flow. Contacts reaching this point will exit the automation."})]}):i.jsxs("div",{style:{textAlign:"center",color:d.textMuted,padding:"30px 0"},children:[i.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:"👆"}),i.jsx("div",{style:{fontSize:"13px"},children:"Select a node to configure"})]})})]})]}),I&&i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",zIndex:200},onClick:()=>j(!1)}),i.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"1000px",height:"80vh",backgroundColor:d.bgCard,borderRadius:"16px",border:`1px solid ${d.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[i.jsxs("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${d.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[i.jsx("h2",{style:{fontSize:"15px",fontWeight:"600",color:d.text,margin:0},children:"Audience Criteria"}),i.jsx("button",{onClick:()=>j(!1),style:{background:"none",border:"none",color:d.textMuted,cursor:"pointer",fontSize:"18px"},children:"×"})]}),i.jsx("div",{style:{flex:1,padding:"20px",overflow:"hidden"},children:i.jsx(sa,{onClose:()=>j(!1),t:d})}),i.jsxs("div",{style:{padding:"12px 20px",borderTop:`1px solid ${d.border}`,display:"flex",justifyContent:"flex-end",gap:"8px",flexShrink:0},children:[i.jsx("button",{onClick:()=>j(!1),style:{padding:"8px 16px",backgroundColor:d.bgHover,border:`1px solid ${d.borderLight}`,borderRadius:"6px",color:d.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Cancel"}),i.jsx("button",{onClick:()=>j(!1),style:{padding:"8px 16px",backgroundColor:d.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px",fontWeight:"500"},children:"Save Criteria"})]})]})]})]})},co=({t:n})=>{var O,Z;const{userId:s,automationId:r}=_e(),l=ht(),d=po(),p=!r||r==="new";(O=d.state)!=null&&O.templateName||((Z=d.state)==null||Z.templateId);const{data:u,isLoading:x,error:g}=ms(p?null:r),{createAutomation:f,updateAutomation:M,activateAutomation:b,pauseAutomation:I}=mo(),j=async()=>{if(p)return;const E=S.status==="active",z=E?"paused":"active";try{E?await I.mutateAsync(r):await b.mutateAsync(r),k(W=>({...W,status:z}))}catch(W){console.error("Failed to toggle status:",W)}},[S,k]=D.useState({name:"",description:"",category:"general",status:"draft",send_time:"10:00",timezone:"America/Chicago",frequency:"Daily",filter_config:{},nodes:[]});D.useEffect(()=>{u&&k({name:u.name||"",description:u.description||"",category:u.category||"general",status:u.status||"draft",send_time:u.send_time||"10:00",timezone:u.timezone||"America/Chicago",frequency:u.frequency||"Daily",filter_config:u.filter_config||{},nodes:u.nodes||[]})},[u]);const R=async E=>{try{if(p){const z=await f.mutateAsync(E);l(`/${s}/automations/${z.id}`,{replace:!0})}else await M.mutateAsync({automationId:r,updates:E})}catch(z){console.error("Failed to save automation:",z),alert("Failed to save automation. Please try again.")}},v=()=>{l(`/${s}/automations`)};return!p&&x?i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[i.jsx("div",{style:{fontSize:"32px"},children:"⏳"}),i.jsx("div",{style:{color:(n==null?void 0:n.textSecondary)||"#a1a1aa"},children:"Loading automation..."})]}):g?i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[i.jsx("div",{style:{fontSize:"48px"},children:"😕"}),i.jsx("h2",{style:{color:(n==null?void 0:n.text)||"#fafafa",margin:0},children:"Automation Not Found"}),i.jsx("p",{style:{color:(n==null?void 0:n.textSecondary)||"#a1a1aa"},children:"We couldn't find the automation you're looking for."}),i.jsx("button",{onClick:v,style:{padding:"10px 20px",backgroundColor:(n==null?void 0:n.primary)||"#3b82f6",border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Automations"})]}):i.jsxs("div",{style:{margin:"-24px",height:"calc(100vh - 49px)",display:"flex",flexDirection:"column"},children:[i.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${(n==null?void 0:n.border)||"#27272a"}`,display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:(n==null?void 0:n.bgCard)||"#18181b",flexShrink:0},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("button",{onClick:v,style:{background:"none",border:"none",color:(n==null?void 0:n.textSecondary)||"#a1a1aa",cursor:"pointer",fontSize:"20px",padding:"4px 8px",display:"flex",alignItems:"center"},children:"←"}),i.jsx("h1",{style:{fontSize:"16px",fontWeight:"600",color:(n==null?void 0:n.text)||"#fafafa",margin:0},children:p?"Create Automation":`Edit: ${(u==null?void 0:u.name)||"Automation"}`})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[!p&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"13px",color:(n==null?void 0:n.textSecondary)||"#a1a1aa"},children:S.status==="active"?"Active":"Inactive"}),i.jsx("button",{onClick:j,disabled:b.isPending||I.isPending,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:S.status==="active"?(n==null?void 0:n.success)||"#22c55e":(n==null?void 0:n.bgHover)||"#27272a",cursor:"pointer",position:"relative",transition:"background-color 0.2s",opacity:b.isPending||I.isPending?.6:1},children:i.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:S.status==="active"?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})})]}),i.jsx("button",{onClick:()=>R(S),disabled:f.isPending||M.isPending,style:{padding:"8px 16px",backgroundColor:(n==null?void 0:n.primary)||"#3b82f6",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",opacity:f.isPending||M.isPending?.7:1},children:f.isPending||M.isPending?"Saving...":p?"Create":"Save Changes"})]})]}),i.jsx("div",{style:{flex:1,overflow:"hidden"},children:i.jsx(la,{t:n,automation:S,onUpdate:k,onSave:R})})]})};function da(n,s){const r=D.useRef(s);D.useEffect(function(){s!==r.current&&n.attributionControl!=null&&(r.current!=null&&n.attributionControl.removeAttribution(r.current),s!=null&&n.attributionControl.addAttribution(s)),r.current=s},[n,s])}function ca(n,s,r){s.center!==r.center&&n.setLatLng(s.center),s.radius!=null&&s.radius!==r.radius&&n.setRadius(s.radius)}const ua=1;function pa(n){return Object.freeze({__version:ua,map:n})}function ko(n,s){return Object.freeze({...n,...s})}const zo=D.createContext(null),To=zo.Provider;function Hi(){const n=D.useContext(zo);if(n==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return n}function Lo(n){function s(r,l){const{instance:d,context:p}=n(r).current;return D.useImperativeHandle(l,()=>d),r.children==null?null:He.createElement(To,{value:p},r.children)}return D.forwardRef(s)}function ha(n){function s(r,l){const{instance:d}=n(r).current;return D.useImperativeHandle(l,()=>d),null}return D.forwardRef(s)}function Po(n,s){const r=D.useRef();D.useEffect(function(){return s!=null&&n.instance.on(s),r.current=s,function(){r.current!=null&&n.instance.off(r.current),r.current=null}},[n,s])}function Ui(n,s){const r=n.pane??s.pane;return r?{...n,pane:r}:n}var Ni={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(n,s){(function(r,l){l(s)})(ss,function(r){var l="1.9.4";function d(e){var t,o,a,c;for(o=1,a=arguments.length;o<a;o++){c=arguments[o];for(t in c)e[t]=c[t]}return e}var p=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}();function u(e,t){var o=Array.prototype.slice;if(e.bind)return e.bind.apply(e,o.call(arguments,1));var a=o.call(arguments,2);return function(){return e.apply(t,a.length?a.concat(o.call(arguments)):arguments)}}var x=0;function g(e){return"_leaflet_id"in e||(e._leaflet_id=++x),e._leaflet_id}function f(e,t,o){var a,c,h,m;return m=function(){a=!1,c&&(h.apply(o,c),c=!1)},h=function(){a?c=arguments:(e.apply(o,arguments),setTimeout(m,t),a=!0)},h}function M(e,t,o){var a=t[1],c=t[0],h=a-c;return e===a&&o?e:((e-c)%h+h)%h+c}function b(){return!1}function I(e,t){if(t===!1)return e;var o=Math.pow(10,t===void 0?6:t);return Math.round(e*o)/o}function j(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function S(e){return j(e).split(/\s+/)}function k(e,t){Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?p(e.options):{});for(var o in t)e.options[o]=t[o];return e.options}function R(e,t,o){var a=[];for(var c in e)a.push(encodeURIComponent(o?c.toUpperCase():c)+"="+encodeURIComponent(e[c]));return(!t||t.indexOf("?")===-1?"?":"&")+a.join("&")}var v=/\{ *([\w_ -]+) *\}/g;function O(e,t){return e.replace(v,function(o,a){var c=t[a];if(c===void 0)throw new Error("No value provided for variable "+o);return typeof c=="function"&&(c=c(t)),c})}var Z=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function E(e,t){for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1}var z="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function W(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var K=0;function V(e){var t=+new Date,o=Math.max(0,16-(t-K));return K=t+o,window.setTimeout(e,o)}var se=window.requestAnimationFrame||W("RequestAnimationFrame")||V,X=window.cancelAnimationFrame||W("CancelAnimationFrame")||W("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function _(e,t,o){if(o&&se===V)e.call(t);else return se.call(window,u(e,t))}function C(e){e&&X.call(window,e)}var B={__proto__:null,extend:d,create:p,bind:u,get lastId(){return x},stamp:g,throttle:f,wrapNum:M,falseFn:b,formatNum:I,trim:j,splitWords:S,setOptions:k,getParamString:R,template:O,isArray:Z,indexOf:E,emptyImageUrl:z,requestFn:se,cancelFn:X,requestAnimFrame:_,cancelAnimFrame:C};function P(){}P.extend=function(e){var t=function(){k(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},o=t.__super__=this.prototype,a=p(o);a.constructor=t,t.prototype=a;for(var c in this)Object.prototype.hasOwnProperty.call(this,c)&&c!=="prototype"&&c!=="__super__"&&(t[c]=this[c]);return e.statics&&d(t,e.statics),e.includes&&($(e.includes),d.apply(null,[a].concat(e.includes))),d(a,e),delete a.statics,delete a.includes,a.options&&(a.options=o.options?p(o.options):{},d(a.options,e.options)),a._initHooks=[],a.callInitHooks=function(){if(!this._initHooksCalled){o.callInitHooks&&o.callInitHooks.call(this),this._initHooksCalled=!0;for(var h=0,m=a._initHooks.length;h<m;h++)a._initHooks[h].call(this)}},t},P.include=function(e){var t=this.prototype.options;return d(this.prototype,e),e.options&&(this.prototype.options=t,this.mergeOptions(e.options)),this},P.mergeOptions=function(e){return d(this.prototype.options,e),this},P.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),o=typeof e=="function"?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(o),this};function $(e){if(!(typeof L>"u"||!L||!L.Mixin)){e=Z(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var U={on:function(e,t,o){if(typeof e=="object")for(var a in e)this._on(a,e[a],t);else{e=S(e);for(var c=0,h=e.length;c<h;c++)this._on(e[c],t,o)}return this},off:function(e,t,o){if(!arguments.length)delete this._events;else if(typeof e=="object")for(var a in e)this._off(a,e[a],t);else{e=S(e);for(var c=arguments.length===1,h=0,m=e.length;h<m;h++)c?this._off(e[h]):this._off(e[h],t,o)}return this},_on:function(e,t,o,a){if(typeof t!="function"){console.warn("wrong listener type: "+typeof t);return}if(this._listens(e,t,o)===!1){o===this&&(o=void 0);var c={fn:t,ctx:o};a&&(c.once=!0),this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(c)}},_off:function(e,t,o){var a,c,h;if(this._events&&(a=this._events[e],!!a)){if(arguments.length===1){if(this._firingCount)for(c=0,h=a.length;c<h;c++)a[c].fn=b;delete this._events[e];return}if(typeof t!="function"){console.warn("wrong listener type: "+typeof t);return}var m=this._listens(e,t,o);if(m!==!1){var y=a[m];this._firingCount&&(y.fn=b,this._events[e]=a=a.slice()),a.splice(m,1)}}},fire:function(e,t,o){if(!this.listens(e,o))return this;var a=d({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var c=this._events[e];if(c){this._firingCount=this._firingCount+1||1;for(var h=0,m=c.length;h<m;h++){var y=c[h],w=y.fn;y.once&&this.off(e,w,y.ctx),w.call(y.ctx||this,a)}this._firingCount--}}return o&&this._propagateEvent(a),this},listens:function(e,t,o,a){typeof e!="string"&&console.warn('"string" type argument expected');var c=t;typeof t!="function"&&(a=!!t,c=void 0,o=void 0);var h=this._events&&this._events[e];if(h&&h.length&&this._listens(e,c,o)!==!1)return!0;if(a){for(var m in this._eventParents)if(this._eventParents[m].listens(e,t,o,a))return!0}return!1},_listens:function(e,t,o){if(!this._events)return!1;var a=this._events[e]||[];if(!t)return!!a.length;o===this&&(o=void 0);for(var c=0,h=a.length;c<h;c++)if(a[c].fn===t&&a[c].ctx===o)return c;return!1},once:function(e,t,o){if(typeof e=="object")for(var a in e)this._on(a,e[a],t,!0);else{e=S(e);for(var c=0,h=e.length;c<h;c++)this._on(e[c],t,o,!0)}return this},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[g(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[g(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,d({layer:e.target,propagatedFrom:e.target},e),!0)}};U.addEventListener=U.on,U.removeEventListener=U.clearAllEventListeners=U.off,U.addOneTimeEventListener=U.once,U.fireEvent=U.fire,U.hasEventListeners=U.listens;var te=P.extend(U);function H(e,t,o){this.x=o?Math.round(e):e,this.y=o?Math.round(t):t}var we=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};H.prototype={clone:function(){return new H(this.x,this.y)},add:function(e){return this.clone()._add(q(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(q(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new H(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new H(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=we(this.x),this.y=we(this.y),this},distanceTo:function(e){e=q(e);var t=e.x-this.x,o=e.y-this.y;return Math.sqrt(t*t+o*o)},equals:function(e){return e=q(e),e.x===this.x&&e.y===this.y},contains:function(e){return e=q(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+I(this.x)+", "+I(this.y)+")"}};function q(e,t,o){return e instanceof H?e:Z(e)?new H(e[0],e[1]):e==null?e:typeof e=="object"&&"x"in e&&"y"in e?new H(e.x,e.y):new H(e,t,o)}function ne(e,t){if(e)for(var o=t?[e,t]:e,a=0,c=o.length;a<c;a++)this.extend(o[a])}ne.prototype={extend:function(e){var t,o;if(!e)return this;if(e instanceof H||typeof e[0]=="number"||"x"in e)t=o=q(e);else if(e=ae(e),t=e.min,o=e.max,!t||!o)return this;return!this.min&&!this.max?(this.min=t.clone(),this.max=o.clone()):(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(o.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(o.y,this.max.y)),this},getCenter:function(e){return q((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return q(this.min.x,this.max.y)},getTopRight:function(){return q(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,o;return typeof e[0]=="number"||e instanceof H?e=q(e):e=ae(e),e instanceof ne?(t=e.min,o=e.max):t=o=e,t.x>=this.min.x&&o.x<=this.max.x&&t.y>=this.min.y&&o.y<=this.max.y},intersects:function(e){e=ae(e);var t=this.min,o=this.max,a=e.min,c=e.max,h=c.x>=t.x&&a.x<=o.x,m=c.y>=t.y&&a.y<=o.y;return h&&m},overlaps:function(e){e=ae(e);var t=this.min,o=this.max,a=e.min,c=e.max,h=c.x>t.x&&a.x<o.x,m=c.y>t.y&&a.y<o.y;return h&&m},isValid:function(){return!!(this.min&&this.max)},pad:function(e){var t=this.min,o=this.max,a=Math.abs(t.x-o.x)*e,c=Math.abs(t.y-o.y)*e;return ae(q(t.x-a,t.y-c),q(o.x+a,o.y+c))},equals:function(e){return e?(e=ae(e),this.min.equals(e.getTopLeft())&&this.max.equals(e.getBottomRight())):!1}};function ae(e,t){return!e||e instanceof ne?e:new ne(e,t)}function ve(e,t){if(e)for(var o=t?[e,t]:e,a=0,c=o.length;a<c;a++)this.extend(o[a])}ve.prototype={extend:function(e){var t=this._southWest,o=this._northEast,a,c;if(e instanceof re)a=e,c=e;else if(e instanceof ve){if(a=e._southWest,c=e._northEast,!a||!c)return this}else return e?this.extend(ee(e)||ue(e)):this;return!t&&!o?(this._southWest=new re(a.lat,a.lng),this._northEast=new re(c.lat,c.lng)):(t.lat=Math.min(a.lat,t.lat),t.lng=Math.min(a.lng,t.lng),o.lat=Math.max(c.lat,o.lat),o.lng=Math.max(c.lng,o.lng)),this},pad:function(e){var t=this._southWest,o=this._northEast,a=Math.abs(t.lat-o.lat)*e,c=Math.abs(t.lng-o.lng)*e;return new ve(new re(t.lat-a,t.lng-c),new re(o.lat+a,o.lng+c))},getCenter:function(){return new re((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new re(this.getNorth(),this.getWest())},getSouthEast:function(){return new re(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){typeof e[0]=="number"||e instanceof re||"lat"in e?e=ee(e):e=ue(e);var t=this._southWest,o=this._northEast,a,c;return e instanceof ve?(a=e.getSouthWest(),c=e.getNorthEast()):a=c=e,a.lat>=t.lat&&c.lat<=o.lat&&a.lng>=t.lng&&c.lng<=o.lng},intersects:function(e){e=ue(e);var t=this._southWest,o=this._northEast,a=e.getSouthWest(),c=e.getNorthEast(),h=c.lat>=t.lat&&a.lat<=o.lat,m=c.lng>=t.lng&&a.lng<=o.lng;return h&&m},overlaps:function(e){e=ue(e);var t=this._southWest,o=this._northEast,a=e.getSouthWest(),c=e.getNorthEast(),h=c.lat>t.lat&&a.lat<o.lat,m=c.lng>t.lng&&a.lng<o.lng;return h&&m},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return e?(e=ue(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ue(e,t){return e instanceof ve?e:new ve(e,t)}function re(e,t,o){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,o!==void 0&&(this.alt=+o)}re.prototype={equals:function(e,t){if(!e)return!1;e=ee(e);var o=Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng));return o<=(t===void 0?1e-9:t)},toString:function(e){return"LatLng("+I(this.lat,e)+", "+I(this.lng,e)+")"},distanceTo:function(e){return Re.distance(this,ee(e))},wrap:function(){return Re.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,o=t/Math.cos(Math.PI/180*this.lat);return ue([this.lat-t,this.lng-o],[this.lat+t,this.lng+o])},clone:function(){return new re(this.lat,this.lng,this.alt)}};function ee(e,t,o){return e instanceof re?e:Z(e)&&typeof e[0]!="object"?e.length===3?new re(e[0],e[1],e[2]):e.length===2?new re(e[0],e[1]):null:e==null?e:typeof e=="object"&&"lat"in e?new re(e.lat,"lng"in e?e.lng:e.lon,e.alt):t===void 0?null:new re(e,t,o)}var Pe={latLngToPoint:function(e,t){var o=this.projection.project(e),a=this.scale(t);return this.transformation._transform(o,a)},pointToLatLng:function(e,t){var o=this.scale(t),a=this.transformation.untransform(e,o);return this.projection.unproject(a)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,o=this.scale(e),a=this.transformation.transform(t.min,o),c=this.transformation.transform(t.max,o);return new ne(a,c)},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?M(e.lng,this.wrapLng,!0):e.lng,o=this.wrapLat?M(e.lat,this.wrapLat,!0):e.lat,a=e.alt;return new re(o,t,a)},wrapLatLngBounds:function(e){var t=e.getCenter(),o=this.wrapLatLng(t),a=t.lat-o.lat,c=t.lng-o.lng;if(a===0&&c===0)return e;var h=e.getSouthWest(),m=e.getNorthEast(),y=new re(h.lat-a,h.lng-c),w=new re(m.lat-a,m.lng-c);return new ve(y,w)}},Re=d({},Pe,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var o=Math.PI/180,a=e.lat*o,c=t.lat*o,h=Math.sin((t.lat-e.lat)*o/2),m=Math.sin((t.lng-e.lng)*o/2),y=h*h+Math.cos(a)*Math.cos(c)*m*m,w=2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y));return this.R*w}}),Me=6378137,he={R:Me,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,o=this.MAX_LATITUDE,a=Math.max(Math.min(o,e.lat),-o),c=Math.sin(a*t);return new H(this.R*e.lng*t,this.R*Math.log((1+c)/(1-c))/2)},unproject:function(e){var t=180/Math.PI;return new re((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:function(){var e=Me*Math.PI;return new ne([-e,-e],[e,e])}()};function We(e,t,o,a){if(Z(e)){this._a=e[0],this._b=e[1],this._c=e[2],this._d=e[3];return}this._a=e,this._b=t,this._c=o,this._d=a}We.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new H((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};function ft(e,t,o,a){return new We(e,t,o,a)}var oi=d({},Re,{code:"EPSG:3857",projection:he,transformation:function(){var e=.5/(Math.PI*he.R);return ft(e,.5,-e,.5)}()}),Io=d({},oi,{code:"EPSG:900913"});function Yi(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Ji(e,t){var o="",a,c,h,m,y,w;for(a=0,h=e.length;a<h;a++){for(y=e[a],c=0,m=y.length;c<m;c++)w=y[c],o+=(c?"L":"M")+w.x+" "+w.y;o+=t?F.svg?"z":"x":""}return o||"M0 0"}var ri=document.documentElement.style,At="ActiveXObject"in window,Ao=At&&!document.addEventListener,Qi="msLaunchUri"in navigator&&!("documentMode"in document),si=Ee("webkit"),Xi=Ee("android"),en=Ee("android 2")||Ee("android 3"),Eo=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Bo=Xi&&Ee("Google")&&Eo<537&&!("AudioNode"in window),ai=!!window.opera,tn=!Qi&&Ee("chrome"),nn=Ee("gecko")&&!si&&!ai&&!At,Oo=!tn&&Ee("safari"),on=Ee("phantom"),rn="OTransition"in ri,Do=navigator.platform.indexOf("Win")===0,sn=At&&"transition"in ri,li="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!en,an="MozPerspective"in ri,Wo=!window.L_DISABLE_3D&&(sn||li||an)&&!rn&&!on,xt=typeof orientation<"u"||Ee("mobile"),qo=xt&&si,No=xt&&li,ln=!window.PointerEvent&&window.MSPointerEvent,dn=!!(window.PointerEvent||ln),cn="ontouchstart"in window||!!window.TouchEvent,Zo=!window.L_NO_TOUCH&&(cn||dn),$o=xt&&ai,Fo=xt&&nn,Ho=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Uo=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",b,t),window.removeEventListener("testPassiveEventSupport",b,t)}catch{}return e}(),Go=function(){return!!document.createElement("canvas").getContext}(),di=!!(document.createElementNS&&Yi("svg").createSVGRect),Vo=!!di&&function(){var e=document.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Ko=!di&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&typeof t.adj=="object"}catch{return!1}}(),Yo=navigator.platform.indexOf("Mac")===0,Jo=navigator.platform.indexOf("Linux")===0;function Ee(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var F={ie:At,ielt9:Ao,edge:Qi,webkit:si,android:Xi,android23:en,androidStock:Bo,opera:ai,chrome:tn,gecko:nn,safari:Oo,phantom:on,opera12:rn,win:Do,ie3d:sn,webkit3d:li,gecko3d:an,any3d:Wo,mobile:xt,mobileWebkit:qo,mobileWebkit3d:No,msPointer:ln,pointer:dn,touch:Zo,touchNative:cn,mobileOpera:$o,mobileGecko:Fo,retina:Ho,passiveEvents:Uo,canvas:Go,svg:di,vml:Ko,inlineSvg:Vo,mac:Yo,linux:Jo},un=F.msPointer?"MSPointerDown":"pointerdown",pn=F.msPointer?"MSPointerMove":"pointermove",hn=F.msPointer?"MSPointerUp":"pointerup",fn=F.msPointer?"MSPointerCancel":"pointercancel",ci={touchstart:un,touchmove:pn,touchend:hn,touchcancel:fn},xn={touchstart:nr,touchmove:Et,touchend:Et,touchcancel:Et},it={},mn=!1;function Qo(e,t,o){return t==="touchstart"&&ir(),xn[t]?(o=xn[t].bind(this,o),e.addEventListener(ci[t],o,!1),o):(console.warn("wrong event specified:",t),b)}function Xo(e,t,o){if(!ci[t]){console.warn("wrong event specified:",t);return}e.removeEventListener(ci[t],o,!1)}function er(e){it[e.pointerId]=e}function tr(e){it[e.pointerId]&&(it[e.pointerId]=e)}function gn(e){delete it[e.pointerId]}function ir(){mn||(document.addEventListener(un,er,!0),document.addEventListener(pn,tr,!0),document.addEventListener(hn,gn,!0),document.addEventListener(fn,gn,!0),mn=!0)}function Et(e,t){if(t.pointerType!==(t.MSPOINTER_TYPE_MOUSE||"mouse")){t.touches=[];for(var o in it)t.touches.push(it[o]);t.changedTouches=[t],e(t)}}function nr(e,t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&ye(t),Et(e,t)}function or(e){var t={},o,a;for(a in e)o=e[a],t[a]=o&&o.bind?o.bind(e):o;return e=t,t.type="dblclick",t.detail=2,t.isTrusted=!1,t._simulated=!0,t}var rr=200;function sr(e,t){e.addEventListener("dblclick",t);var o=0,a;function c(h){if(h.detail!==1){a=h.detail;return}if(!(h.pointerType==="mouse"||h.sourceCapabilities&&!h.sourceCapabilities.firesTouchEvents)){var m=wn(h);if(!(m.some(function(w){return w instanceof HTMLLabelElement&&w.attributes.for})&&!m.some(function(w){return w instanceof HTMLInputElement||w instanceof HTMLSelectElement}))){var y=Date.now();y-o<=rr?(a++,a===2&&t(or(h))):a=1,o=y}}}return e.addEventListener("click",c),{dblclick:t,simDblclick:c}}function ar(e,t){e.removeEventListener("dblclick",t.dblclick),e.removeEventListener("click",t.simDblclick)}var ui=Dt(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),mt=Dt(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),_n=mt==="webkitTransition"||mt==="OTransition"?mt+"End":"transitionend";function yn(e){return typeof e=="string"?document.getElementById(e):e}function gt(e,t){var o=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!o||o==="auto")&&document.defaultView){var a=document.defaultView.getComputedStyle(e,null);o=a?a[t]:null}return o==="auto"?null:o}function oe(e,t,o){var a=document.createElement(e);return a.className=t||"",o&&o.appendChild(a),a}function ce(e){var t=e.parentNode;t&&t.removeChild(e)}function Bt(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function nt(e){var t=e.parentNode;t&&t.lastChild!==e&&t.appendChild(e)}function ot(e){var t=e.parentNode;t&&t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function pi(e,t){if(e.classList!==void 0)return e.classList.contains(t);var o=Ot(e);return o.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(o)}function J(e,t){if(e.classList!==void 0)for(var o=S(t),a=0,c=o.length;a<c;a++)e.classList.add(o[a]);else if(!pi(e,t)){var h=Ot(e);hi(e,(h?h+" ":"")+t)}}function pe(e,t){e.classList!==void 0?e.classList.remove(t):hi(e,j((" "+Ot(e)+" ").replace(" "+t+" "," ")))}function hi(e,t){e.className.baseVal===void 0?e.className=t:e.className.baseVal=t}function Ot(e){return e.correspondingElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function ke(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&lr(e,t)}function lr(e,t){var o=!1,a="DXImageTransform.Microsoft.Alpha";try{o=e.filters.item(a)}catch{if(t===1)return}t=Math.round(t*100),o?(o.Enabled=t!==100,o.Opacity=t):e.style.filter+=" progid:"+a+"(opacity="+t+")"}function Dt(e){for(var t=document.documentElement.style,o=0;o<e.length;o++)if(e[o]in t)return e[o];return!1}function Ve(e,t,o){var a=t||new H(0,0);e.style[ui]=(F.ie3d?"translate("+a.x+"px,"+a.y+"px)":"translate3d("+a.x+"px,"+a.y+"px,0)")+(o?" scale("+o+")":"")}function fe(e,t){e._leaflet_pos=t,F.any3d?Ve(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function Ke(e){return e._leaflet_pos||new H(0,0)}var _t,yt,fi;if("onselectstart"in document)_t=function(){Y(window,"selectstart",ye)},yt=function(){le(window,"selectstart",ye)};else{var vt=Dt(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);_t=function(){if(vt){var e=document.documentElement.style;fi=e[vt],e[vt]="none"}},yt=function(){vt&&(document.documentElement.style[vt]=fi,fi=void 0)}}function xi(){Y(window,"dragstart",ye)}function mi(){le(window,"dragstart",ye)}var Wt,gi;function _i(e){for(;e.tabIndex===-1;)e=e.parentNode;e.style&&(qt(),Wt=e,gi=e.style.outlineStyle,e.style.outlineStyle="none",Y(window,"keydown",qt))}function qt(){Wt&&(Wt.style.outlineStyle=gi,Wt=void 0,gi=void 0,le(window,"keydown",qt))}function vn(e){do e=e.parentNode;while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function yi(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}var dr={__proto__:null,TRANSFORM:ui,TRANSITION:mt,TRANSITION_END:_n,get:yn,getStyle:gt,create:oe,remove:ce,empty:Bt,toFront:nt,toBack:ot,hasClass:pi,addClass:J,removeClass:pe,setClass:hi,getClass:Ot,setOpacity:ke,testProp:Dt,setTransform:Ve,setPosition:fe,getPosition:Ke,get disableTextSelection(){return _t},get enableTextSelection(){return yt},disableImageDrag:xi,enableImageDrag:mi,preventOutline:_i,restoreOutline:qt,getSizedParentNode:vn,getScale:yi};function Y(e,t,o,a){if(t&&typeof t=="object")for(var c in t)bi(e,c,t[c],o);else{t=S(t);for(var h=0,m=t.length;h<m;h++)bi(e,t[h],o,a)}return this}var Be="_leaflet_events";function le(e,t,o,a){if(arguments.length===1)bn(e),delete e[Be];else if(t&&typeof t=="object")for(var c in t)wi(e,c,t[c],o);else if(t=S(t),arguments.length===2)bn(e,function(y){return E(t,y)!==-1});else for(var h=0,m=t.length;h<m;h++)wi(e,t[h],o,a);return this}function bn(e,t){for(var o in e[Be]){var a=o.split(/\d/)[0];(!t||t(a))&&wi(e,a,null,null,o)}}var vi={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function bi(e,t,o,a){var c=t+g(o)+(a?"_"+g(a):"");if(e[Be]&&e[Be][c])return this;var h=function(y){return o.call(a||e,y||window.event)},m=h;!F.touchNative&&F.pointer&&t.indexOf("touch")===0?h=Qo(e,t,h):F.touch&&t==="dblclick"?h=sr(e,h):"addEventListener"in e?t==="touchstart"||t==="touchmove"||t==="wheel"||t==="mousewheel"?e.addEventListener(vi[t]||t,h,F.passiveEvents?{passive:!1}:!1):t==="mouseenter"||t==="mouseleave"?(h=function(y){y=y||window.event,ji(e,y)&&m(y)},e.addEventListener(vi[t],h,!1)):e.addEventListener(t,m,!1):e.attachEvent("on"+t,h),e[Be]=e[Be]||{},e[Be][c]=h}function wi(e,t,o,a,c){c=c||t+g(o)+(a?"_"+g(a):"");var h=e[Be]&&e[Be][c];if(!h)return this;!F.touchNative&&F.pointer&&t.indexOf("touch")===0?Xo(e,t,h):F.touch&&t==="dblclick"?ar(e,h):"removeEventListener"in e?e.removeEventListener(vi[t]||t,h,!1):e.detachEvent("on"+t,h),e[Be][c]=null}function Ye(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function Si(e){return bi(e,"wheel",Ye),this}function bt(e){return Y(e,"mousedown touchstart dblclick contextmenu",Ye),e._leaflet_disable_click=!0,this}function ye(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function Je(e){return ye(e),Ye(e),this}function wn(e){if(e.composedPath)return e.composedPath();for(var t=[],o=e.target;o;)t.push(o),o=o.parentNode;return t}function Sn(e,t){if(!t)return new H(e.clientX,e.clientY);var o=yi(t),a=o.boundingClientRect;return new H((e.clientX-a.left)/o.x-t.clientLeft,(e.clientY-a.top)/o.y-t.clientTop)}var cr=F.linux&&F.chrome?window.devicePixelRatio:F.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function jn(e){return F.edge?e.wheelDeltaY/2:e.deltaY&&e.deltaMode===0?-e.deltaY/cr:e.deltaY&&e.deltaMode===1?-e.deltaY*20:e.deltaY&&e.deltaMode===2?-e.deltaY*60:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?-e.detail*20:e.detail?e.detail/-32765*60:0}function ji(e,t){var o=t.relatedTarget;if(!o)return!0;try{for(;o&&o!==e;)o=o.parentNode}catch{return!1}return o!==e}var ur={__proto__:null,on:Y,off:le,stopPropagation:Ye,disableScrollPropagation:Si,disableClickPropagation:bt,preventDefault:ye,stop:Je,getPropagationPath:wn,getMousePosition:Sn,getWheelDelta:jn,isExternalTarget:ji,addListener:Y,removeListener:le},Cn=te.extend({run:function(e,t,o,a){this.stop(),this._el=e,this._inProgress=!0,this._duration=o||.25,this._easeOutPower=1/Math.max(a||.5,.2),this._startPos=Ke(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=_(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,o=this._duration*1e3;t<o?this._runFrame(this._easeOut(t/o),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var o=this._startPos.add(this._offset.multiplyBy(e));t&&o._round(),fe(this._el,o),this.fire("step")},_complete:function(){C(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),ie=te.extend({options:{crs:oi,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,t){t=k(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=u(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),t.zoom!==void 0&&(this._zoom=this._limitZoom(t.zoom)),t.center&&t.zoom!==void 0&&this.setView(ee(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=mt&&F.any3d&&!F.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Y(this._proxy,_n,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,t,o){if(t=t===void 0?this._zoom:this._limitZoom(t),e=this._limitCenter(ee(e),t,this.options.maxBounds),o=o||{},this._stop(),this._loaded&&!o.reset&&o!==!0){o.animate!==void 0&&(o.zoom=d({animate:o.animate},o.zoom),o.pan=d({animate:o.animate,duration:o.duration},o.pan));var a=this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,o.zoom):this._tryAnimatedPan(e,o.pan);if(a)return clearTimeout(this._sizeTimer),this}return this._resetView(e,t,o.pan&&o.pan.noMoveStart),this},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=e,this)},zoomIn:function(e,t){return e=e||(F.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,t)},zoomOut:function(e,t){return e=e||(F.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,t)},setZoomAround:function(e,t,o){var a=this.getZoomScale(t),c=this.getSize().divideBy(2),h=e instanceof H?e:this.latLngToContainerPoint(e),m=h.subtract(c).multiplyBy(1-1/a),y=this.containerPointToLatLng(c.add(m));return this.setView(y,t,{zoom:o})},_getBoundsCenterZoom:function(e,t){t=t||{},e=e.getBounds?e.getBounds():ue(e);var o=q(t.paddingTopLeft||t.padding||[0,0]),a=q(t.paddingBottomRight||t.padding||[0,0]),c=this.getBoundsZoom(e,!1,o.add(a));if(c=typeof t.maxZoom=="number"?Math.min(t.maxZoom,c):c,c===1/0)return{center:e.getCenter(),zoom:c};var h=a.subtract(o).divideBy(2),m=this.project(e.getSouthWest(),c),y=this.project(e.getNorthEast(),c),w=this.unproject(m.add(y).divideBy(2).add(h),c);return{center:w,zoom:c}},fitBounds:function(e,t){if(e=ue(e),!e.isValid())throw new Error("Bounds are not valid.");var o=this._getBoundsCenterZoom(e,t);return this.setView(o.center,o.zoom,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e,t){if(e=q(e).round(),t=t||{},!e.x&&!e.y)return this.fire("moveend");if(t.animate!==!0&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Cn,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart"),t.animate!==!1){J(this._mapPane,"leaflet-pan-anim");var o=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,o,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,t,o){if(o=o||{},o.animate===!1||!F.any3d)return this.setView(e,t,o);this._stop();var a=this.project(this.getCenter()),c=this.project(e),h=this.getSize(),m=this._zoom;e=ee(e),t=t===void 0?m:t;var y=Math.max(h.x,h.y),w=y*this.getZoomScale(m,t),A=c.distanceTo(a)||1,N=1.42,G=N*N;function Q(xe){var Qt=xe?-1:1,Xr=xe?w:y,es=w*w-y*y+Qt*G*G*A*A,ts=2*Xr*G*A,Ei=es/ts,ro=Math.sqrt(Ei*Ei+1)-Ei,is=ro<1e-9?-18:Math.log(ro);return is}function be(xe){return(Math.exp(xe)-Math.exp(-xe))/2}function me(xe){return(Math.exp(xe)+Math.exp(-xe))/2}function Te(xe){return be(xe)/me(xe)}var Se=Q(0);function ct(xe){return y*(me(Se)/me(Se+N*xe))}function Kr(xe){return y*(me(Se)*Te(Se+N*xe)-be(Se))/G}function Yr(xe){return 1-Math.pow(1-xe,1.5)}var Jr=Date.now(),no=(Q(1)-Se)/N,Qr=o.duration?1e3*o.duration:1e3*no*.8;function oo(){var xe=(Date.now()-Jr)/Qr,Qt=Yr(xe)*no;xe<=1?(this._flyToFrame=_(oo,this),this._move(this.unproject(a.add(c.subtract(a).multiplyBy(Kr(Qt)/A)),m),this.getScaleZoom(y/ct(Qt),m),{flyTo:!0})):this._move(e,t)._moveEnd(!0)}return this._moveStart(!0,o.noMoveStart),oo.call(this),this},flyToBounds:function(e,t){var o=this._getBoundsCenterZoom(e,t);return this.flyTo(o.center,o.zoom,t)},setMaxBounds:function(e){return e=ue(e),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),e.isValid()?(this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(e){var t=this.options.minZoom;return this.options.minZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var t=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,t){this._enforcingBounds=!0;var o=this.getCenter(),a=this._limitCenter(o,this._zoom,ue(e));return o.equals(a)||this.panTo(a,t),this._enforcingBounds=!1,this},panInside:function(e,t){t=t||{};var o=q(t.paddingTopLeft||t.padding||[0,0]),a=q(t.paddingBottomRight||t.padding||[0,0]),c=this.project(this.getCenter()),h=this.project(e),m=this.getPixelBounds(),y=ae([m.min.add(o),m.max.subtract(a)]),w=y.getSize();if(!y.contains(h)){this._enforcingBounds=!0;var A=h.subtract(y.getCenter()),N=y.extend(h).getSize().subtract(w);c.x+=A.x<0?-N.x:N.x,c.y+=A.y<0?-N.y:N.y,this.panTo(this.unproject(c),t),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=d({animate:!1,pan:!0},e===!0?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var o=this.getSize(),a=t.divideBy(2).round(),c=o.divideBy(2).round(),h=a.subtract(c);return!h.x&&!h.y?this:(e.animate&&e.pan?this.panBy(h):(e.pan&&this._rawPanBy(h),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(u(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:o}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=d({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=u(this._handleGeolocationResponse,this),o=u(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,o,e):navigator.geolocation.getCurrentPosition(t,o,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var t=e.code,o=e.message||(t===1?"permission denied":t===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+o+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var t=e.coords.latitude,o=e.coords.longitude,a=new re(t,o),c=a.toBounds(e.coords.accuracy*2),h=this._locateOptions;if(h.setView){var m=this.getBoundsZoom(c);this.setView(a,h.maxZoom?Math.min(m,h.maxZoom):m)}var y={latlng:a,bounds:c,timestamp:e.timestamp};for(var w in e.coords)typeof e.coords[w]=="number"&&(y[w]=e.coords[w]);this.fire("locationfound",y)}},addHandler:function(e,t){if(!t)return this;var o=this[e]=new t(this);return this._handlers.push(o),this.options[e]&&o.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),ce(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(C(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var e;for(e in this._layers)this._layers[e].remove();for(e in this._panes)ce(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,t){var o="leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),a=oe("div",o,t||this._mapPane);return e&&(this._panes[e]=a),a},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds(),t=this.unproject(e.getBottomLeft()),o=this.unproject(e.getTopRight());return new ve(t,o)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,o){e=ue(e),o=q(o||[0,0]);var a=this.getZoom()||0,c=this.getMinZoom(),h=this.getMaxZoom(),m=e.getNorthWest(),y=e.getSouthEast(),w=this.getSize().subtract(o),A=ae(this.project(y,a),this.project(m,a)).getSize(),N=F.any3d?this.options.zoomSnap:1,G=w.x/A.x,Q=w.y/A.y,be=t?Math.max(G,Q):Math.min(G,Q);return a=this.getScaleZoom(be,a),N&&(a=Math.round(a/(N/100))*(N/100),a=t?Math.ceil(a/N)*N:Math.floor(a/N)*N),Math.max(c,Math.min(h,a))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new H(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,t){var o=this._getTopLeftPoint(e,t);return new ne(o,o.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(e===void 0?this.getZoom():e)},getPane:function(e){return typeof e=="string"?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,t){var o=this.options.crs;return t=t===void 0?this._zoom:t,o.scale(e)/o.scale(t)},getScaleZoom:function(e,t){var o=this.options.crs;t=t===void 0?this._zoom:t;var a=o.zoom(e*o.scale(t));return isNaN(a)?1/0:a},project:function(e,t){return t=t===void 0?this._zoom:t,this.options.crs.latLngToPoint(ee(e),t)},unproject:function(e,t){return t=t===void 0?this._zoom:t,this.options.crs.pointToLatLng(q(e),t)},layerPointToLatLng:function(e){var t=q(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){var t=this.project(ee(e))._round();return t._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(ee(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(ue(e))},distance:function(e,t){return this.options.crs.distance(ee(e),ee(t))},containerPointToLayerPoint:function(e){return q(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return q(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(q(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(ee(e)))},mouseEventToContainerPoint:function(e){return Sn(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=yn(e);if(t){if(t._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Y(t,"scroll",this._onScroll,this),this._containerId=g(t)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&F.any3d,J(e,"leaflet-container"+(F.touch?" leaflet-touch":"")+(F.retina?" leaflet-retina":"")+(F.ielt9?" leaflet-oldie":"")+(F.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=gt(e,"position");t!=="absolute"&&t!=="relative"&&t!=="fixed"&&t!=="sticky"&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),fe(this._mapPane,new H(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(J(e.markerPane,"leaflet-zoom-hide"),J(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,t,o){fe(this._mapPane,new H(0,0));var a=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire("viewprereset");var c=this._zoom!==t;this._moveStart(c,o)._move(e,t)._moveEnd(c),this.fire("viewreset"),a&&this.fire("load")},_moveStart:function(e,t){return e&&this.fire("zoomstart"),t||this.fire("movestart"),this},_move:function(e,t,o,a){t===void 0&&(t=this._zoom);var c=this._zoom!==t;return this._zoom=t,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),a?o&&o.pinch&&this.fire("zoom",o):((c||o&&o.pinch)&&this.fire("zoom",o),this.fire("move",o)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return C(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){fe(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[g(this._container)]=this;var t=e?le:Y;t(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&t(window,"resize",this._onResize,this),F.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){C(this._resizeRequest),this._resizeRequest=_(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,t){for(var o=[],a,c=t==="mouseout"||t==="mouseover",h=e.target||e.srcElement,m=!1;h;){if(a=this._targets[g(h)],a&&(t==="click"||t==="preclick")&&this._draggableMoved(a)){m=!0;break}if(a&&a.listens(t,!0)&&(c&&!ji(h,e)||(o.push(a),c))||h===this._container)break;h=h.parentNode}return!o.length&&!m&&!c&&this.listens(t,!0)&&(o=[this]),o},_isClickDisabled:function(e){for(;e&&e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var t=e.target||e.srcElement;if(!(!this._loaded||t._leaflet_disable_events||e.type==="click"&&this._isClickDisabled(t))){var o=e.type;o==="mousedown"&&_i(t),this._fireDOMEvent(e,o)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,t,o){if(e.type==="click"){var a=d({},e);a.type="preclick",this._fireDOMEvent(a,a.type,o)}var c=this._findEventTargets(e,t);if(o){for(var h=[],m=0;m<o.length;m++)o[m].listens(t,!0)&&h.push(o[m]);c=h.concat(c)}if(c.length){t==="contextmenu"&&ye(e);var y=c[0],w={originalEvent:e};if(e.type!=="keypress"&&e.type!=="keydown"&&e.type!=="keyup"){var A=y.getLatLng&&(!y._radius||y._radius<=10);w.containerPoint=A?this.latLngToContainerPoint(y.getLatLng()):this.mouseEventToContainerPoint(e),w.layerPoint=this.containerPointToLayerPoint(w.containerPoint),w.latlng=A?y.getLatLng():this.layerPointToLatLng(w.layerPoint)}for(m=0;m<c.length;m++)if(c[m].fire(t,w,!0),w.originalEvent._stopped||c[m].options.bubblingMouseEvents===!1&&E(this._mouseEvents,t)!==-1)return}},_draggableMoved:function(e){return e=e.dragging&&e.dragging.enabled()?e:this,e.dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on("load",e,t),this},_getMapPanePos:function(){return Ke(this._mapPane)||new H(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,t){var o=e&&t!==void 0?this._getNewPixelOrigin(e,t):this.getPixelOrigin();return o.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,t){var o=this.getSize()._divideBy(2);return this.project(e,t)._subtract(o)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,t,o){var a=this._getNewPixelOrigin(o,t);return this.project(e,t)._subtract(a)},_latLngBoundsToNewLayerBounds:function(e,t,o){var a=this._getNewPixelOrigin(o,t);return ae([this.project(e.getSouthWest(),t)._subtract(a),this.project(e.getNorthWest(),t)._subtract(a),this.project(e.getSouthEast(),t)._subtract(a),this.project(e.getNorthEast(),t)._subtract(a)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,o){if(!o)return e;var a=this.project(e,t),c=this.getSize().divideBy(2),h=new ne(a.subtract(c),a.add(c)),m=this._getBoundsOffset(h,o,t);return Math.abs(m.x)<=1&&Math.abs(m.y)<=1?e:this.unproject(a.add(m),t)},_limitOffset:function(e,t){if(!t)return e;var o=this.getPixelBounds(),a=new ne(o.min.add(e),o.max.add(e));return e.add(this._getBoundsOffset(a,t))},_getBoundsOffset:function(e,t,o){var a=ae(this.project(t.getNorthEast(),o),this.project(t.getSouthWest(),o)),c=a.min.subtract(e.min),h=a.max.subtract(e.max),m=this._rebound(c.x,-h.x),y=this._rebound(c.y,-h.y);return new H(m,y)},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),o=this.getMaxZoom(),a=F.any3d?this.options.zoomSnap:1;return a&&(e=Math.round(e/a)*a),Math.max(t,Math.min(o,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){pe(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,t){var o=this._getCenterOffset(e)._trunc();return(t&&t.animate)!==!0&&!this.getSize().contains(o)?!1:(this.panBy(o,t),!0)},_createAnimProxy:function(){var e=this._proxy=oe("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",function(t){var o=ui,a=this._proxy.style[o];Ve(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),a===this._proxy.style[o]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){ce(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),t=this.getZoom();Ve(this._proxy,this.project(e,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,o){if(this._animatingZoom)return!0;if(o=o||{},!this._zoomAnimated||o.animate===!1||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var a=this.getZoomScale(t),c=this._getCenterOffset(e)._divideBy(1-1/a);return o.animate!==!0&&!this.getSize().contains(c)?!1:(_(function(){this._moveStart(!0,o.noMoveStart||!1)._animateZoom(e,t,!0)},this),!0)},_animateZoom:function(e,t,o,a){this._mapPane&&(o&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,J(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:t,noUpdate:a}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(u(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&pe(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function pr(e,t){return new ie(e,t)}var Ie=P.extend({options:{position:"topright"},initialize:function(e){k(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),o=this.getPosition(),a=e._controlCorners[o];return J(t,"leaflet-control"),o.indexOf("bottom")!==-1?a.insertBefore(t,a.firstChild):a.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(ce(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),wt=function(e){return new Ie(e)};ie.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},t="leaflet-",o=this._controlContainer=oe("div",t+"control-container",this._container);function a(c,h){var m=t+c+" "+t+h;e[c+h]=oe("div",m,o)}a("top","left"),a("top","right"),a("bottom","left"),a("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)ce(this._controlCorners[e]);ce(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var kn=Ie.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,o,a){return o<a?-1:a<o?1:0}},initialize:function(e,t,o){k(this,o),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var a in e)this._addLayer(e[a],a);for(a in t)this._addLayer(t[a],a,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return Ie.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(g(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){J(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(J(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):pe(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return pe(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=oe("div",e),o=this.options.collapsed;t.setAttribute("aria-haspopup",!0),bt(t),Si(t);var a=this._section=oe("section",e+"-list");o&&(this._map.on("click",this.collapse,this),Y(t,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var c=this._layersLink=oe("a",e+"-toggle",t);c.href="#",c.title="Layers",c.setAttribute("role","button"),Y(c,{keydown:function(h){h.keyCode===13&&this._expandSafely()},click:function(h){ye(h),this._expandSafely()}},this),o||this.expand(),this._baseLayersList=oe("div",e+"-base",a),this._separator=oe("div",e+"-separator",a),this._overlaysList=oe("div",e+"-overlays",a),t.appendChild(a)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&g(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,o){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:o}),this.options.sortLayers&&this._layers.sort(u(function(a,c){return this.options.sortFunction(a.layer,c.layer,a.name,c.name)},this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Bt(this._baseLayersList),Bt(this._overlaysList),this._layerControlInputs=[];var e,t,o,a,c=0;for(o=0;o<this._layers.length;o++)a=this._layers[o],this._addItem(a),t=t||a.overlay,e=e||!a.overlay,c+=a.overlay?0:1;return this.options.hideSingleBase&&(e=e&&c>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(g(e.target)),o=t.overlay?e.type==="add"?"overlayadd":"overlayremove":e.type==="add"?"baselayerchange":null;o&&this._map.fire(o,t)},_createRadioElement:function(e,t){var o='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",a=document.createElement("div");return a.innerHTML=o,a.firstChild},_addItem:function(e){var t=document.createElement("label"),o=this._map.hasLayer(e.layer),a;e.overlay?(a=document.createElement("input"),a.type="checkbox",a.className="leaflet-control-layers-selector",a.defaultChecked=o):a=this._createRadioElement("leaflet-base-layers_"+g(this),o),this._layerControlInputs.push(a),a.layerId=g(e.layer),Y(a,"click",this._onInputClick,this);var c=document.createElement("span");c.innerHTML=" "+e.name;var h=document.createElement("span");t.appendChild(h),h.appendChild(a),h.appendChild(c);var m=e.overlay?this._overlaysList:this._baseLayersList;return m.appendChild(t),this._checkDisabledLayers(),t},_onInputClick:function(){if(!this._preventClick){var e=this._layerControlInputs,t,o,a=[],c=[];this._handlingClick=!0;for(var h=e.length-1;h>=0;h--)t=e[h],o=this._getLayer(t.layerId).layer,t.checked?a.push(o):t.checked||c.push(o);for(h=0;h<c.length;h++)this._map.hasLayer(c[h])&&this._map.removeLayer(c[h]);for(h=0;h<a.length;h++)this._map.hasLayer(a[h])||this._map.addLayer(a[h]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var e=this._layerControlInputs,t,o,a=this._map.getZoom(),c=e.length-1;c>=0;c--)t=e[c],o=this._getLayer(t.layerId).layer,t.disabled=o.options.minZoom!==void 0&&a<o.options.minZoom||o.options.maxZoom!==void 0&&a>o.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var e=this._section;this._preventClick=!0,Y(e,"click",ye),this.expand();var t=this;setTimeout(function(){le(e,"click",ye),t._preventClick=!1})}}),hr=function(e,t,o){return new kn(e,t,o)},Ci=Ie.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",o=oe("div",t+" leaflet-bar"),a=this.options;return this._zoomInButton=this._createButton(a.zoomInText,a.zoomInTitle,t+"-in",o,this._zoomIn),this._zoomOutButton=this._createButton(a.zoomOutText,a.zoomOutTitle,t+"-out",o,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),o},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,t,o,a,c){var h=oe("a",o,a);return h.innerHTML=e,h.href="#",h.title=t,h.setAttribute("role","button"),h.setAttribute("aria-label",t),bt(h),Y(h,"click",Je),Y(h,"click",c,this),Y(h,"click",this._refocusOnMap,this),h},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";pe(this._zoomInButton,t),pe(this._zoomOutButton,t),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(J(this._zoomOutButton,t),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(J(this._zoomInButton,t),this._zoomInButton.setAttribute("aria-disabled","true"))}});ie.mergeOptions({zoomControl:!0}),ie.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Ci,this.addControl(this.zoomControl))});var fr=function(e){return new Ci(e)},zn=Ie.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t="leaflet-control-scale",o=oe("div",t),a=this.options;return this._addScales(a,t+"-line",o),e.on(a.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),o},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,o){e.metric&&(this._mScale=oe("div",t,o)),e.imperial&&(this._iScale=oe("div",t,o))},_update:function(){var e=this._map,t=e.getSize().y/2,o=e.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(o)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),o=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,o,t/e)},_updateImperial:function(e){var t=e*3.2808399,o,a,c;t>5280?(o=t/5280,a=this._getRoundNum(o),this._updateScale(this._iScale,a+" mi",a/o)):(c=this._getRoundNum(t),this._updateScale(this._iScale,c+" ft",c/t))},_updateScale:function(e,t,o){e.style.width=Math.round(this.options.maxWidth*o)+"px",e.innerHTML=t},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),o=e/t;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,t*o}}),xr=function(e){return new zn(e)},mr='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',ki=Ie.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(F.inlineSvg?mr+" ":"")+"Leaflet</a>"},initialize:function(e){k(this,e),this._attributions={}},onAdd:function(e){e.attributionControl=this,this._container=oe("div","leaflet-control-attribution"),bt(this._container);for(var t in e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",function(){this.removeAttribution(e.layer.getAttribution())},this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var o=[];this.options.prefix&&o.push(this.options.prefix),e.length&&o.push(e.join(", ")),this._container.innerHTML=o.join(' <span aria-hidden="true">|</span> ')}}});ie.mergeOptions({attributionControl:!0}),ie.addInitHook(function(){this.options.attributionControl&&new ki().addTo(this)});var gr=function(e){return new ki(e)};Ie.Layers=kn,Ie.Zoom=Ci,Ie.Scale=zn,Ie.Attribution=ki,wt.layers=hr,wt.zoom=fr,wt.scale=xr,wt.attribution=gr;var Oe=P.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Oe.addTo=function(e,t){return e.addHandler(t,this),this};var _r={Events:U},Tn=F.touch?"touchstart mousedown":"mousedown",Ue=te.extend({options:{clickTolerance:3},initialize:function(e,t,o,a){k(this,a),this._element=e,this._dragStartTarget=t||e,this._preventOutline=o},enable:function(){this._enabled||(Y(this._dragStartTarget,Tn,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Ue._dragging===this&&this.finishDrag(!0),le(this._dragStartTarget,Tn,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!pi(this._element,"leaflet-zoom-anim"))){if(e.touches&&e.touches.length!==1){Ue._dragging===this&&this.finishDrag();return}if(!(Ue._dragging||e.shiftKey||e.which!==1&&e.button!==1&&!e.touches)&&(Ue._dragging=this,this._preventOutline&&_i(this._element),xi(),_t(),!this._moving)){this.fire("down");var t=e.touches?e.touches[0]:e,o=vn(this._element);this._startPoint=new H(t.clientX,t.clientY),this._startPos=Ke(this._element),this._parentScale=yi(o);var a=e.type==="mousedown";Y(document,a?"mousemove":"touchmove",this._onMove,this),Y(document,a?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(e){if(this._enabled){if(e.touches&&e.touches.length>1){this._moved=!0;return}var t=e.touches&&e.touches.length===1?e.touches[0]:e,o=new H(t.clientX,t.clientY)._subtract(this._startPoint);!o.x&&!o.y||Math.abs(o.x)+Math.abs(o.y)<this.options.clickTolerance||(o.x/=this._parentScale.x,o.y/=this._parentScale.y,ye(e),this._moved||(this.fire("dragstart"),this._moved=!0,J(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),J(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(o),this._moving=!0,this._lastEvent=e,this._updatePosition())}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),fe(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){pe(document.body,"leaflet-dragging"),this._lastTarget&&(pe(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),le(document,"mousemove touchmove",this._onMove,this),le(document,"mouseup touchend touchcancel",this._onUp,this),mi(),yt();var t=this._moved&&this._moving;this._moving=!1,Ue._dragging=!1,t&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)})}});function Ln(e,t,o){var a,c=[1,4,2,8],h,m,y,w,A,N,G,Q;for(h=0,N=e.length;h<N;h++)e[h]._code=Qe(e[h],t);for(y=0;y<4;y++){for(G=c[y],a=[],h=0,N=e.length,m=N-1;h<N;m=h++)w=e[h],A=e[m],w._code&G?A._code&G||(Q=Nt(A,w,G,t,o),Q._code=Qe(Q,t),a.push(Q)):(A._code&G&&(Q=Nt(A,w,G,t,o),Q._code=Qe(Q,t),a.push(Q)),a.push(w));e=a}return e}function Pn(e,t){var o,a,c,h,m,y,w,A,N;if(!e||e.length===0)throw new Error("latlngs not passed");ze(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var G=ee([0,0]),Q=ue(e),be=Q.getNorthWest().distanceTo(Q.getSouthWest())*Q.getNorthEast().distanceTo(Q.getNorthWest());be<1700&&(G=zi(e));var me=e.length,Te=[];for(o=0;o<me;o++){var Se=ee(e[o]);Te.push(t.project(ee([Se.lat-G.lat,Se.lng-G.lng])))}for(y=w=A=0,o=0,a=me-1;o<me;a=o++)c=Te[o],h=Te[a],m=c.y*h.x-h.y*c.x,w+=(c.x+h.x)*m,A+=(c.y+h.y)*m,y+=m*3;y===0?N=Te[0]:N=[w/y,A/y];var ct=t.unproject(q(N));return ee([ct.lat+G.lat,ct.lng+G.lng])}function zi(e){for(var t=0,o=0,a=0,c=0;c<e.length;c++){var h=ee(e[c]);t+=h.lat,o+=h.lng,a++}return ee([t/a,o/a])}var yr={__proto__:null,clipPolygon:Ln,polygonCenter:Pn,centroid:zi};function Rn(e,t){if(!t||!e.length)return e.slice();var o=t*t;return e=wr(e,o),e=br(e,o),e}function Mn(e,t,o){return Math.sqrt(St(e,t,o,!0))}function vr(e,t,o){return St(e,t,o)}function br(e,t){var o=e.length,a=typeof Uint8Array<"u"?Uint8Array:Array,c=new a(o);c[0]=c[o-1]=1,Ti(e,c,t,0,o-1);var h,m=[];for(h=0;h<o;h++)c[h]&&m.push(e[h]);return m}function Ti(e,t,o,a,c){var h=0,m,y,w;for(y=a+1;y<=c-1;y++)w=St(e[y],e[a],e[c],!0),w>h&&(m=y,h=w);h>o&&(t[m]=1,Ti(e,t,o,a,m),Ti(e,t,o,m,c))}function wr(e,t){for(var o=[e[0]],a=1,c=0,h=e.length;a<h;a++)Sr(e[a],e[c])>t&&(o.push(e[a]),c=a);return c<h-1&&o.push(e[h-1]),o}var In;function An(e,t,o,a,c){var h=a?In:Qe(e,o),m=Qe(t,o),y,w,A;for(In=m;;){if(!(h|m))return[e,t];if(h&m)return!1;y=h||m,w=Nt(e,t,y,o,c),A=Qe(w,o),y===h?(e=w,h=A):(t=w,m=A)}}function Nt(e,t,o,a,c){var h=t.x-e.x,m=t.y-e.y,y=a.min,w=a.max,A,N;return o&8?(A=e.x+h*(w.y-e.y)/m,N=w.y):o&4?(A=e.x+h*(y.y-e.y)/m,N=y.y):o&2?(A=w.x,N=e.y+m*(w.x-e.x)/h):o&1&&(A=y.x,N=e.y+m*(y.x-e.x)/h),new H(A,N,c)}function Qe(e,t){var o=0;return e.x<t.min.x?o|=1:e.x>t.max.x&&(o|=2),e.y<t.min.y?o|=4:e.y>t.max.y&&(o|=8),o}function Sr(e,t){var o=t.x-e.x,a=t.y-e.y;return o*o+a*a}function St(e,t,o,a){var c=t.x,h=t.y,m=o.x-c,y=o.y-h,w=m*m+y*y,A;return w>0&&(A=((e.x-c)*m+(e.y-h)*y)/w,A>1?(c=o.x,h=o.y):A>0&&(c+=m*A,h+=y*A)),m=e.x-c,y=e.y-h,a?m*m+y*y:new H(c,h)}function ze(e){return!Z(e[0])||typeof e[0][0]!="object"&&typeof e[0][0]<"u"}function En(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ze(e)}function Bn(e,t){var o,a,c,h,m,y,w,A;if(!e||e.length===0)throw new Error("latlngs not passed");ze(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var N=ee([0,0]),G=ue(e),Q=G.getNorthWest().distanceTo(G.getSouthWest())*G.getNorthEast().distanceTo(G.getNorthWest());Q<1700&&(N=zi(e));var be=e.length,me=[];for(o=0;o<be;o++){var Te=ee(e[o]);me.push(t.project(ee([Te.lat-N.lat,Te.lng-N.lng])))}for(o=0,a=0;o<be-1;o++)a+=me[o].distanceTo(me[o+1])/2;if(a===0)A=me[0];else for(o=0,h=0;o<be-1;o++)if(m=me[o],y=me[o+1],c=m.distanceTo(y),h+=c,h>a){w=(h-a)/c,A=[y.x-w*(y.x-m.x),y.y-w*(y.y-m.y)];break}var Se=t.unproject(q(A));return ee([Se.lat+N.lat,Se.lng+N.lng])}var jr={__proto__:null,simplify:Rn,pointToSegmentDistance:Mn,closestPointOnSegment:vr,clipSegment:An,_getEdgeIntersection:Nt,_getBitCode:Qe,_sqClosestPointOnSegment:St,isFlat:ze,_flat:En,polylineCenter:Bn},Li={project:function(e){return new H(e.lng,e.lat)},unproject:function(e){return new re(e.y,e.x)},bounds:new ne([-180,-90],[180,90])},Pi={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ne([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(e){var t=Math.PI/180,o=this.R,a=e.lat*t,c=this.R_MINOR/o,h=Math.sqrt(1-c*c),m=h*Math.sin(a),y=Math.tan(Math.PI/4-a/2)/Math.pow((1-m)/(1+m),h/2);return a=-o*Math.log(Math.max(y,1e-10)),new H(e.lng*t*o,a)},unproject:function(e){for(var t=180/Math.PI,o=this.R,a=this.R_MINOR/o,c=Math.sqrt(1-a*a),h=Math.exp(-e.y/o),m=Math.PI/2-2*Math.atan(h),y=0,w=.1,A;y<15&&Math.abs(w)>1e-7;y++)A=c*Math.sin(m),A=Math.pow((1-A)/(1+A),c/2),w=Math.PI/2-2*Math.atan(h*A)-m,m+=w;return new re(m*t,e.x*t/o)}},Cr={__proto__:null,LonLat:Li,Mercator:Pi,SphericalMercator:he},kr=d({},Re,{code:"EPSG:3395",projection:Pi,transformation:function(){var e=.5/(Math.PI*Pi.R);return ft(e,.5,-e,.5)}()}),On=d({},Re,{code:"EPSG:4326",projection:Li,transformation:ft(1/180,1,-1/180,.5)}),zr=d({},Pe,{projection:Li,transformation:ft(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var o=t.lng-e.lng,a=t.lat-e.lat;return Math.sqrt(o*o+a*a)},infinite:!0});Pe.Earth=Re,Pe.EPSG3395=kr,Pe.EPSG3857=oi,Pe.EPSG900913=Io,Pe.EPSG4326=On,Pe.Simple=zr;var Ae=te.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[g(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[g(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var o=this.getEvents();t.on(o,this),this.once("remove",function(){t.off(o,this)},this)}this.onAdd(t),this.fire("add"),t.fire("layeradd",{layer:this})}}});ie.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var t=g(e);return this._layers[t]?this:(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e),this)},removeLayer:function(e){var t=g(e);return this._layers[t]?(this._loaded&&e.onRemove(this),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return g(e)in this._layers},eachLayer:function(e,t){for(var o in this._layers)e.call(t,this._layers[o]);return this},_addLayers:function(e){e=e?Z(e)?e:[e]:[];for(var t=0,o=e.length;t<o;t++)this.addLayer(e[t])},_addZoomLimit:function(e){(!isNaN(e.options.maxZoom)||!isNaN(e.options.minZoom))&&(this._zoomBoundLayers[g(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var t=g(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,t=-1/0,o=this._getZoomSpan();for(var a in this._zoomBoundLayers){var c=this._zoomBoundLayers[a].options;e=c.minZoom===void 0?e:Math.min(e,c.minZoom),t=c.maxZoom===void 0?t:Math.max(t,c.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=e===1/0?void 0:e,o!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var rt=Ae.extend({initialize:function(e,t){k(this,t),this._layers={};var o,a;if(e)for(o=0,a=e.length;o<a;o++)this.addLayer(e[o])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){var t=typeof e=="number"?e:this.getLayerId(e);return t in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t=Array.prototype.slice.call(arguments,1),o,a;for(o in this._layers)a=this._layers[o],a[e]&&a[e].apply(a,t);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var o in this._layers)e.call(t,this._layers[o]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return g(e)}}),Tr=function(e,t){return new rt(e,t)},qe=rt.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),rt.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),rt.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new ve;for(var t in this._layers){var o=this._layers[t];e.extend(o.getBounds?o.getBounds():o.getLatLng())}return e}}),Lr=function(e,t){return new qe(e,t)},st=P.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){k(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var o=this._getIconUrl(e);if(!o){if(e==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var a=this._createImg(o,t&&t.tagName==="IMG"?t:null);return this._setIconStyles(a,e),(this.options.crossOrigin||this.options.crossOrigin==="")&&(a.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),a},_setIconStyles:function(e,t){var o=this.options,a=o[t+"Size"];typeof a=="number"&&(a=[a,a]);var c=q(a),h=q(t==="shadow"&&o.shadowAnchor||o.iconAnchor||c&&c.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(o.className||""),h&&(e.style.marginLeft=-h.x+"px",e.style.marginTop=-h.y+"px"),c&&(e.style.width=c.x+"px",e.style.height=c.y+"px")},_createImg:function(e,t){return t=t||document.createElement("img"),t.src=e,t},_getIconUrl:function(e){return F.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function Pr(e){return new st(e)}var jt=st.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return typeof jt.imagePath!="string"&&(jt.imagePath=this._detectIconPath()),(this.options.imagePath||jt.imagePath)+st.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var t=function(o,a,c){var h=a.exec(o);return h&&h[c]};return e=t(e,/^url\((['"])?(.+)\1\)$/,2),e&&t(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=oe("div","leaflet-default-icon-path",document.body),t=gt(e,"background-image")||gt(e,"backgroundImage");if(document.body.removeChild(e),t=this._stripUrl(t),t)return t;var o=document.querySelector('link[href$="leaflet.css"]');return o?o.href.substring(0,o.href.length-11-1):""}}),Dn=Oe.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new Ue(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),J(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&pe(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,o=t._map,a=this._marker.options.autoPanSpeed,c=this._marker.options.autoPanPadding,h=Ke(t._icon),m=o.getPixelBounds(),y=o.getPixelOrigin(),w=ae(m.min._subtract(y).add(c),m.max._subtract(y).subtract(c));if(!w.contains(h)){var A=q((Math.max(w.max.x,h.x)-w.max.x)/(m.max.x-w.max.x)-(Math.min(w.min.x,h.x)-w.min.x)/(m.min.x-w.min.x),(Math.max(w.max.y,h.y)-w.max.y)/(m.max.y-w.max.y)-(Math.min(w.min.y,h.y)-w.min.y)/(m.min.y-w.min.y)).multiplyBy(a);o.panBy(A,{animate:!1}),this._draggable._newPos._add(A),this._draggable._startPos._add(A),fe(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=_(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(C(this._panRequest),this._panRequest=_(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,o=t._shadow,a=Ke(t._icon),c=t._map.layerPointToLatLng(a);o&&fe(o,a),t._latlng=c,e.latlng=c,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){C(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),Zt=Ae.extend({options:{icon:new jt,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){k(this,t),this._latlng=ee(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=ee(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),o=e.icon.createIcon(this._icon),a=!1;o!==this._icon&&(this._icon&&this._removeIcon(),a=!0,e.title&&(o.title=e.title),o.tagName==="IMG"&&(o.alt=e.alt||"")),J(o,t),e.keyboard&&(o.tabIndex="0",o.setAttribute("role","button")),this._icon=o,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Y(o,"focus",this._panOnFocus,this);var c=e.icon.createShadow(this._shadow),h=!1;c!==this._shadow&&(this._removeShadow(),h=!0),c&&(J(c,t),c.alt=""),this._shadow=c,e.opacity<1&&this._updateOpacity(),a&&this.getPane().appendChild(this._icon),this._initInteraction(),c&&h&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&le(this._icon,"focus",this._panOnFocus,this),ce(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ce(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&fe(this._icon,e),this._shadow&&fe(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(J(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Dn)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Dn(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&ke(this._icon,e),this._shadow&&ke(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var t=this.options.icon.options,o=t.iconSize?q(t.iconSize):q(0,0),a=t.iconAnchor?q(t.iconAnchor):q(0,0);e.panInside(this._latlng,{paddingTopLeft:a,paddingBottomRight:o.subtract(a)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Rr(e,t){return new Zt(e,t)}var Ge=Ae.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return k(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),$t=Ge.extend({options:{fill:!0,radius:10},initialize:function(e,t){k(this,t),this._latlng=ee(e),this._radius=this.options.radius},setLatLng:function(e){var t=this._latlng;return this._latlng=ee(e),this.redraw(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return Ge.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,o=this._clickTolerance(),a=[e+o,t+o];this._pxBounds=new ne(this._point.subtract(a),this._point.add(a))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Mr(e,t){return new $t(e,t)}var Ri=$t.extend({initialize:function(e,t,o){if(typeof t=="number"&&(t=d({},o,{radius:t})),k(this,t),this._latlng=ee(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new ve(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:Ge.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,o=this._map,a=o.options.crs;if(a.distance===Re.distance){var c=Math.PI/180,h=this._mRadius/Re.R/c,m=o.project([t+h,e]),y=o.project([t-h,e]),w=m.add(y).divideBy(2),A=o.unproject(w).lat,N=Math.acos((Math.cos(h*c)-Math.sin(t*c)*Math.sin(A*c))/(Math.cos(t*c)*Math.cos(A*c)))/c;(isNaN(N)||N===0)&&(N=h/Math.cos(Math.PI/180*t)),this._point=w.subtract(o.getPixelOrigin()),this._radius=isNaN(N)?0:w.x-o.project([A,e-N]).x,this._radiusY=w.y-m.y}else{var G=a.unproject(a.project(this._latlng).subtract([this._mRadius,0]));this._point=o.latLngToLayerPoint(this._latlng),this._radius=this._point.x-o.latLngToLayerPoint(G).x}this._updateBounds()}});function Ir(e,t,o){return new Ri(e,t,o)}var Ne=Ge.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){k(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t=1/0,o=null,a=St,c,h,m=0,y=this._parts.length;m<y;m++)for(var w=this._parts[m],A=1,N=w.length;A<N;A++){c=w[A-1],h=w[A];var G=a(e,c,h,!0);G<t&&(t=G,o=a(e,c,h))}return o&&(o.distance=Math.sqrt(t)),o},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Bn(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t=t||this._defaultShape(),e=ee(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new ve,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return ze(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],o=ze(e),a=0,c=e.length;a<c;a++)o?(t[a]=ee(e[a]),this._bounds.extend(t[a])):t[a]=this._convertLatLngs(e[a]);return t},_project:function(){var e=new ne;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),t=new H(e,e);this._rawPxBounds&&(this._pxBounds=new ne([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)]))},_projectLatlngs:function(e,t,o){var a=e[0]instanceof re,c=e.length,h,m;if(a){for(m=[],h=0;h<c;h++)m[h]=this._map.latLngToLayerPoint(e[h]),o.extend(m[h]);t.push(m)}else for(h=0;h<c;h++)this._projectLatlngs(e[h],t,o)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}var t=this._parts,o,a,c,h,m,y,w;for(o=0,c=0,h=this._rings.length;o<h;o++)for(w=this._rings[o],a=0,m=w.length;a<m-1;a++)y=An(w[a],w[a+1],e,a,!0),y&&(t[c]=t[c]||[],t[c].push(y[0]),(y[1]!==w[a+1]||a===m-2)&&(t[c].push(y[1]),c++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,o=0,a=e.length;o<a;o++)e[o]=Rn(e[o],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var o,a,c,h,m,y,w=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(o=0,h=this._parts.length;o<h;o++)for(y=this._parts[o],a=0,m=y.length,c=m-1;a<m;c=a++)if(!(!t&&a===0)&&Mn(e,y[c],y[a])<=w)return!0;return!1}});function Ar(e,t){return new Ne(e,t)}Ne._flat=En;var at=Ne.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Pn(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(e){var t=Ne.prototype._convertLatLngs.call(this,e),o=t.length;return o>=2&&t[0]instanceof re&&t[0].equals(t[o-1])&&t.pop(),t},_setLatLngs:function(e){Ne.prototype._setLatLngs.call(this,e),ze(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ze(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,o=new H(t,t);if(e=new ne(e.min.subtract(o),e.max.add(o)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}for(var a=0,c=this._rings.length,h;a<c;a++)h=Ln(this._rings[a],e,!0),h.length&&this._parts.push(h)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t=!1,o,a,c,h,m,y,w,A;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(h=0,w=this._parts.length;h<w;h++)for(o=this._parts[h],m=0,A=o.length,y=A-1;m<A;y=m++)a=o[m],c=o[y],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(t=!t);return t||Ne.prototype._containsPoint.call(this,e,!0)}});function Er(e,t){return new at(e,t)}var Ze=qe.extend({initialize:function(e,t){k(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t=Z(e)?e:e.features,o,a,c;if(t){for(o=0,a=t.length;o<a;o++)c=t[o],(c.geometries||c.geometry||c.features||c.coordinates)&&this.addData(c);return this}var h=this.options;if(h.filter&&!h.filter(e))return this;var m=Ft(e,h);return m?(m.feature=Gt(e),m.defaultOptions=m.options,this.resetStyle(m),h.onEachFeature&&h.onEachFeature(e,m),this.addLayer(m)):this},resetStyle:function(e){return e===void 0?this.eachLayer(this.resetStyle,this):(e.options=d({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(e,t){e.setStyle&&(typeof t=="function"&&(t=t(e.feature)),e.setStyle(t))}});function Ft(e,t){var o=e.type==="Feature"?e.geometry:e,a=o?o.coordinates:null,c=[],h=t&&t.pointToLayer,m=t&&t.coordsToLatLng||Mi,y,w,A,N;if(!a&&!o)return null;switch(o.type){case"Point":return y=m(a),Wn(h,e,y,t);case"MultiPoint":for(A=0,N=a.length;A<N;A++)y=m(a[A]),c.push(Wn(h,e,y,t));return new qe(c);case"LineString":case"MultiLineString":return w=Ht(a,o.type==="LineString"?0:1,m),new Ne(w,t);case"Polygon":case"MultiPolygon":return w=Ht(a,o.type==="Polygon"?1:2,m),new at(w,t);case"GeometryCollection":for(A=0,N=o.geometries.length;A<N;A++){var G=Ft({geometry:o.geometries[A],type:"Feature",properties:e.properties},t);G&&c.push(G)}return new qe(c);case"FeatureCollection":for(A=0,N=o.features.length;A<N;A++){var Q=Ft(o.features[A],t);Q&&c.push(Q)}return new qe(c);default:throw new Error("Invalid GeoJSON object.")}}function Wn(e,t,o,a){return e?e(t,o):new Zt(o,a&&a.markersInheritOptions&&a)}function Mi(e){return new re(e[1],e[0],e[2])}function Ht(e,t,o){for(var a=[],c=0,h=e.length,m;c<h;c++)m=t?Ht(e[c],t-1,o):(o||Mi)(e[c]),a.push(m);return a}function Ii(e,t){return e=ee(e),e.alt!==void 0?[I(e.lng,t),I(e.lat,t),I(e.alt,t)]:[I(e.lng,t),I(e.lat,t)]}function Ut(e,t,o,a){for(var c=[],h=0,m=e.length;h<m;h++)c.push(t?Ut(e[h],ze(e[h])?0:t-1,o,a):Ii(e[h],a));return!t&&o&&c.length>0&&c.push(c[0].slice()),c}function lt(e,t){return e.feature?d({},e.feature,{geometry:t}):Gt(t)}function Gt(e){return e.type==="Feature"||e.type==="FeatureCollection"?e:{type:"Feature",properties:{},geometry:e}}var Ai={toGeoJSON:function(e){return lt(this,{type:"Point",coordinates:Ii(this.getLatLng(),e)})}};Zt.include(Ai),Ri.include(Ai),$t.include(Ai),Ne.include({toGeoJSON:function(e){var t=!ze(this._latlngs),o=Ut(this._latlngs,t?1:0,!1,e);return lt(this,{type:(t?"Multi":"")+"LineString",coordinates:o})}}),at.include({toGeoJSON:function(e){var t=!ze(this._latlngs),o=t&&!ze(this._latlngs[0]),a=Ut(this._latlngs,o?2:t?1:0,!0,e);return t||(a=[a]),lt(this,{type:(o?"Multi":"")+"Polygon",coordinates:a})}}),rt.include({toMultiPoint:function(e){var t=[];return this.eachLayer(function(o){t.push(o.toGeoJSON(e).geometry.coordinates)}),lt(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(t==="MultiPoint")return this.toMultiPoint(e);var o=t==="GeometryCollection",a=[];return this.eachLayer(function(c){if(c.toGeoJSON){var h=c.toGeoJSON(e);if(o)a.push(h.geometry);else{var m=Gt(h);m.type==="FeatureCollection"?a.push.apply(a,m.features):a.push(m)}}}),o?lt(this,{geometries:a,type:"GeometryCollection"}):{type:"FeatureCollection",features:a}}});function qn(e,t){return new Ze(e,t)}var Br=qn,Vt=Ae.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,t,o){this._url=e,this._bounds=ue(t),k(this,o)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(J(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){ce(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&nt(this._image),this},bringToBack:function(){return this._map&&ot(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=ue(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e=this._url.tagName==="IMG",t=this._image=e?this._url:oe("img");if(J(t,"leaflet-image-layer"),this._zoomAnimated&&J(t,"leaflet-zoom-animated"),this.options.className&&J(t,this.options.className),t.onselectstart=b,t.onmousemove=b,t.onload=u(this.fire,this,"load"),t.onerror=u(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(t.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e){this._url=t.src;return}t.src=this._url,t.alt=this.options.alt},_animateZoom:function(e){var t=this._map.getZoomScale(e.zoom),o=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;Ve(this._image,o,t)},_reset:function(){var e=this._image,t=new ne(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),o=t.getSize();fe(e,t.min),e.style.width=o.x+"px",e.style.height=o.y+"px"},_updateOpacity:function(){ke(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),Or=function(e,t,o){return new Vt(e,t,o)},Nn=Vt.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e=this._url.tagName==="VIDEO",t=this._image=e?this._url:oe("video");if(J(t,"leaflet-image-layer"),this._zoomAnimated&&J(t,"leaflet-zoom-animated"),this.options.className&&J(t,this.options.className),t.onselectstart=b,t.onmousemove=b,t.onloadeddata=u(this.fire,this,"load"),e){for(var o=t.getElementsByTagName("source"),a=[],c=0;c<o.length;c++)a.push(o[c].src);this._url=o.length>0?a:[t.src];return}Z(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(t.style,"objectFit")&&(t.style.objectFit="fill"),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop,t.muted=!!this.options.muted,t.playsInline=!!this.options.playsInline;for(var h=0;h<this._url.length;h++){var m=oe("source");m.src=this._url[h],t.appendChild(m)}}});function Dr(e,t,o){return new Nn(e,t,o)}var Zn=Vt.extend({_initImage:function(){var e=this._image=this._url;J(e,"leaflet-image-layer"),this._zoomAnimated&&J(e,"leaflet-zoom-animated"),this.options.className&&J(e,this.options.className),e.onselectstart=b,e.onmousemove=b}});function Wr(e,t,o){return new Zn(e,t,o)}var De=Ae.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(e,t){e&&(e instanceof re||Z(e))?(this._latlng=ee(e),k(this,t)):(k(this,e),this._source=t),this.options.content&&(this._content=this.options.content)},openOn:function(e){return e=arguments.length?e:this._source._map,e.hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&ke(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&ke(this._container,1),this.bringToFront(),this.options.interactive&&(J(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(ke(this._container,0),this._removeTimeout=setTimeout(u(ce,void 0,this._container),200)):ce(this._container),this.options.interactive&&(pe(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=ee(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&nt(this._container),this},bringToBack:function(){return this._map&&ot(this._container),this},_prepareOpen:function(e){var t=this._source;if(!t._map)return!1;if(t instanceof qe){t=null;var o=this._source._layers;for(var a in o)if(o[a]._map){t=o[a];break}if(!t)return!1;this._source=t}if(!e)if(t.getCenter)e=t.getCenter();else if(t.getLatLng)e=t.getLatLng();else if(t.getBounds)e=t.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,t=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof t=="string")e.innerHTML=t;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=q(this.options.offset),o=this._getAnchor();this._zoomAnimated?fe(this._container,e.add(o)):t=t.add(e).add(o);var a=this._containerBottom=-t.y,c=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=a+"px",this._container.style.left=c+"px"}},_getAnchor:function(){return[0,0]}});ie.include({_initOverlay:function(e,t,o,a){var c=t;return c instanceof e||(c=new e(a).setContent(t)),o&&c.setLatLng(o),c}}),Ae.include({_initOverlay:function(e,t,o,a){var c=o;return c instanceof e?(k(c,a),c._source=this):(c=t&&!a?t:new e(a,this),c.setContent(o)),c}});var Kt=De.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return e=arguments.length?e:this._source._map,!e.hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,De.prototype.openOn.call(this,e)},onAdd:function(e){De.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Ge||this._source.on("preclick",Ye))},onRemove:function(e){De.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Ge||this._source.off("preclick",Ye))},getEvents:function(){var e=De.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",t=this._container=oe("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),o=this._wrapper=oe("div",e+"-content-wrapper",t);if(this._contentNode=oe("div",e+"-content",o),bt(t),Si(this._contentNode),Y(t,"contextmenu",Ye),this._tipContainer=oe("div",e+"-tip-container",t),this._tip=oe("div",e+"-tip",this._tipContainer),this.options.closeButton){var a=this._closeButton=oe("a",e+"-close-button",t);a.setAttribute("role","button"),a.setAttribute("aria-label","Close popup"),a.href="#close",a.innerHTML='<span aria-hidden="true">&#215;</span>',Y(a,"click",function(c){ye(c),this.close()},this)}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var o=e.offsetWidth;o=Math.min(o,this.options.maxWidth),o=Math.max(o,this.options.minWidth),t.width=o+1+"px",t.whiteSpace="",t.height="";var a=e.offsetHeight,c=this.options.maxHeight,h="leaflet-popup-scrolled";c&&a>c?(t.height=c+"px",J(e,h)):pe(e,h),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),o=this._getAnchor();fe(this._container,t.add(o))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var e=this._map,t=parseInt(gt(this._container,"marginBottom"),10)||0,o=this._container.offsetHeight+t,a=this._containerWidth,c=new H(this._containerLeft,-o-this._containerBottom);c._add(Ke(this._container));var h=e.layerPointToContainerPoint(c),m=q(this.options.autoPanPadding),y=q(this.options.autoPanPaddingTopLeft||m),w=q(this.options.autoPanPaddingBottomRight||m),A=e.getSize(),N=0,G=0;h.x+a+w.x>A.x&&(N=h.x+a-A.x+w.x),h.x-N-y.x<0&&(N=h.x-y.x),h.y+o+w.y>A.y&&(G=h.y+o-A.y+w.y),h.y-G-y.y<0&&(G=h.y-y.y),(N||G)&&(this.options.keepInView&&(this._autopanning=!0),e.fire("autopanstart").panBy([N,G]))}},_getAnchor:function(){return q(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),qr=function(e,t){return new Kt(e,t)};ie.mergeOptions({closePopupOnClick:!0}),ie.include({openPopup:function(e,t,o){return this._initOverlay(Kt,e,t,o).openOn(this),this},closePopup:function(e){return e=arguments.length?e:this._popup,e&&e.close(),this}}),Ae.include({bindPopup:function(e,t){return this._popup=this._initOverlay(Kt,this._popup,e,t),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&(this instanceof qe||(this._popup._source=this),this._popup._prepareOpen(e||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(!(!this._popup||!this._map)){Je(e);var t=e.layer||e.target;if(this._popup._source===t&&!(t instanceof Ge)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng);return}this._popup._source=t,this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){e.originalEvent.keyCode===13&&this._openPopup(e)}});var Yt=De.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){De.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){De.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=De.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip",t=e+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=oe("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+g(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var t,o,a=this._map,c=this._container,h=a.latLngToContainerPoint(a.getCenter()),m=a.layerPointToContainerPoint(e),y=this.options.direction,w=c.offsetWidth,A=c.offsetHeight,N=q(this.options.offset),G=this._getAnchor();y==="top"?(t=w/2,o=A):y==="bottom"?(t=w/2,o=0):y==="center"?(t=w/2,o=A/2):y==="right"?(t=0,o=A/2):y==="left"?(t=w,o=A/2):m.x<h.x?(y="right",t=0,o=A/2):(y="left",t=w+(N.x+G.x)*2,o=A/2),e=e.subtract(q(t,o,!0)).add(N).add(G),pe(c,"leaflet-tooltip-right"),pe(c,"leaflet-tooltip-left"),pe(c,"leaflet-tooltip-top"),pe(c,"leaflet-tooltip-bottom"),J(c,"leaflet-tooltip-"+y),fe(c,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&ke(this._container,e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)},_getAnchor:function(){return q(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Nr=function(e,t){return new Yt(e,t)};ie.include({openTooltip:function(e,t,o){return this._initOverlay(Yt,e,t,o).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),Ae.include({bindTooltip:function(e,t){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Yt,this._tooltip,e,t),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(!(!e&&this._tooltipHandlersAdded)){var t=e?"off":"on",o={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?o.add=this._openTooltip:(o.mouseover=this._openTooltip,o.mouseout=this.closeTooltip,o.click=this._openTooltip,this._map?this._addFocusListeners():o.add=this._addFocusListeners),this._tooltip.options.sticky&&(o.mousemove=this._moveTooltip),this[t](o),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&(this instanceof qe||(this._tooltip._source=this),this._tooltip._prepareOpen(e)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(e){var t=typeof e.getElement=="function"&&e.getElement();t&&(Y(t,"focus",function(){this._tooltip._source=e,this.openTooltip()},this),Y(t,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(e){var t=typeof e.getElement=="function"&&e.getElement();t&&t.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(e){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var t=this;this._map.once("moveend",function(){t._openOnceFlag=!1,t._openTooltip(e)});return}this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0)}},_moveTooltip:function(e){var t=e.latlng,o,a;this._tooltip.options.sticky&&e.originalEvent&&(o=this._map.mouseEventToContainerPoint(e.originalEvent),a=this._map.containerPointToLayerPoint(o),t=this._map.layerPointToLatLng(a)),this._tooltip.setLatLng(t)}});var $n=st.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var t=e&&e.tagName==="DIV"?e:document.createElement("div"),o=this.options;if(o.html instanceof Element?(Bt(t),t.appendChild(o.html)):t.innerHTML=o.html!==!1?o.html:"",o.bgPos){var a=q(o.bgPos);t.style.backgroundPosition=-a.x+"px "+-a.y+"px"}return this._setIconStyles(t,"icon"),t},createShadow:function(){return null}});function Zr(e){return new $n(e)}st.Default=jt;var Ct=Ae.extend({options:{tileSize:256,opacity:1,updateWhenIdle:F.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){k(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),ce(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(nt(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(ot(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=f(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof H?e:new H(e,e)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var t=this.getPane().children,o=-e(-1/0,1/0),a=0,c=t.length,h;a<c;a++)h=t[a].style.zIndex,t[a]!==this._container&&h&&(o=e(o,+h));isFinite(o)&&(this.options.zIndex=o+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!F.ielt9){ke(this._container,this.options.opacity);var e=+new Date,t=!1,o=!1;for(var a in this._tiles){var c=this._tiles[a];if(!(!c.current||!c.loaded)){var h=Math.min(1,(e-c.loaded)/200);ke(c.el,h),h<1?t=!0:(c.active?o=!0:this._onOpaqueTile(c),c.active=!0)}}o&&!this._noPrune&&this._pruneTiles(),t&&(C(this._fadeFrame),this._fadeFrame=_(this._updateOpacity,this))}},_onOpaqueTile:b,_initContainer:function(){this._container||(this._container=oe("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,t=this.options.maxZoom;if(e!==void 0){for(var o in this._levels)o=Number(o),this._levels[o].el.children.length||o===e?(this._levels[o].el.style.zIndex=t-Math.abs(e-o),this._onUpdateLevel(o)):(ce(this._levels[o].el),this._removeTilesAtZoom(o),this._onRemoveLevel(o),delete this._levels[o]);var a=this._levels[e],c=this._map;return a||(a=this._levels[e]={},a.el=oe("div","leaflet-tile-container leaflet-zoom-animated",this._container),a.el.style.zIndex=t,a.origin=c.project(c.unproject(c.getPixelOrigin()),e).round(),a.zoom=e,this._setZoomTransform(a,c.getCenter(),c.getZoom()),b(a.el.offsetWidth),this._onCreateLevel(a)),this._level=a,a}},_onUpdateLevel:b,_onRemoveLevel:b,_onCreateLevel:b,_pruneTiles:function(){if(this._map){var e,t,o=this._map.getZoom();if(o>this.options.maxZoom||o<this.options.minZoom){this._removeAllTiles();return}for(e in this._tiles)t=this._tiles[e],t.retain=t.current;for(e in this._tiles)if(t=this._tiles[e],t.current&&!t.active){var a=t.coords;this._retainParent(a.x,a.y,a.z,a.z-5)||this._retainChildren(a.x,a.y,a.z,a.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}},_removeTilesAtZoom:function(e){for(var t in this._tiles)this._tiles[t].coords.z===e&&this._removeTile(t)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)ce(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,t,o,a){var c=Math.floor(e/2),h=Math.floor(t/2),m=o-1,y=new H(+c,+h);y.z=+m;var w=this._tileCoordsToKey(y),A=this._tiles[w];return A&&A.active?(A.retain=!0,!0):(A&&A.loaded&&(A.retain=!0),m>a?this._retainParent(c,h,m,a):!1)},_retainChildren:function(e,t,o,a){for(var c=2*e;c<2*e+2;c++)for(var h=2*t;h<2*t+2;h++){var m=new H(c,h);m.z=o+1;var y=this._tileCoordsToKey(m),w=this._tiles[y];if(w&&w.active){w.retain=!0;continue}else w&&w.loaded&&(w.retain=!0);o+1<a&&this._retainChildren(c,h,o+1,a)}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var t=this.options;return t.minNativeZoom!==void 0&&e<t.minNativeZoom?t.minNativeZoom:t.maxNativeZoom!==void 0&&t.maxNativeZoom<e?t.maxNativeZoom:e},_setView:function(e,t,o,a){var c=Math.round(t);this.options.maxZoom!==void 0&&c>this.options.maxZoom||this.options.minZoom!==void 0&&c<this.options.minZoom?c=void 0:c=this._clampZoom(c);var h=this.options.updateWhenZooming&&c!==this._tileZoom;(!a||h)&&(this._tileZoom=c,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),c!==void 0&&this._update(e),o||this._pruneTiles(),this._noPrune=!!o),this._setZoomTransforms(e,t)},_setZoomTransforms:function(e,t){for(var o in this._levels)this._setZoomTransform(this._levels[o],e,t)},_setZoomTransform:function(e,t,o){var a=this._map.getZoomScale(o,e.zoom),c=e.origin.multiplyBy(a).subtract(this._map._getNewPixelOrigin(t,o)).round();F.any3d?Ve(e.el,c,a):fe(e.el,c)},_resetGrid:function(){var e=this._map,t=e.options.crs,o=this._tileSize=this.getTileSize(),a=this._tileZoom,c=this._map.getPixelWorldBounds(this._tileZoom);c&&(this._globalTileRange=this._pxBoundsToTileRange(c)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],a).x/o.x),Math.ceil(e.project([0,t.wrapLng[1]],a).x/o.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],a).y/o.x),Math.ceil(e.project([t.wrapLat[1],0],a).y/o.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(e){var t=this._map,o=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),a=t.getZoomScale(o,this._tileZoom),c=t.project(e,this._tileZoom).floor(),h=t.getSize().divideBy(a*2);return new ne(c.subtract(h),c.add(h))},_update:function(e){var t=this._map;if(t){var o=this._clampZoom(t.getZoom());if(e===void 0&&(e=t.getCenter()),this._tileZoom!==void 0){var a=this._getTiledPixelBounds(e),c=this._pxBoundsToTileRange(a),h=c.getCenter(),m=[],y=this.options.keepBuffer,w=new ne(c.getBottomLeft().subtract([y,-y]),c.getTopRight().add([y,-y]));if(!(isFinite(c.min.x)&&isFinite(c.min.y)&&isFinite(c.max.x)&&isFinite(c.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var A in this._tiles){var N=this._tiles[A].coords;(N.z!==this._tileZoom||!w.contains(new H(N.x,N.y)))&&(this._tiles[A].current=!1)}if(Math.abs(o-this._tileZoom)>1){this._setView(e,o);return}for(var G=c.min.y;G<=c.max.y;G++)for(var Q=c.min.x;Q<=c.max.x;Q++){var be=new H(Q,G);if(be.z=this._tileZoom,!!this._isValidTile(be)){var me=this._tiles[this._tileCoordsToKey(be)];me?me.current=!0:m.push(be)}}if(m.sort(function(Se,ct){return Se.distanceTo(h)-ct.distanceTo(h)}),m.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Te=document.createDocumentFragment();for(Q=0;Q<m.length;Q++)this._addTile(m[Q],Te);this._level.el.appendChild(Te)}}}},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var o=this._globalTileRange;if(!t.wrapLng&&(e.x<o.min.x||e.x>o.max.x)||!t.wrapLat&&(e.y<o.min.y||e.y>o.max.y))return!1}if(!this.options.bounds)return!0;var a=this._tileCoordsToBounds(e);return ue(this.options.bounds).overlaps(a)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var t=this._map,o=this.getTileSize(),a=e.scaleBy(o),c=a.add(o),h=t.unproject(a,e.z),m=t.unproject(c,e.z);return[h,m]},_tileCoordsToBounds:function(e){var t=this._tileCoordsToNwSe(e),o=new ve(t[0],t[1]);return this.options.noWrap||(o=this._map.wrapLatLngBounds(o)),o},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var t=e.split(":"),o=new H(+t[0],+t[1]);return o.z=+t[2],o},_removeTile:function(e){var t=this._tiles[e];t&&(ce(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){J(e,"leaflet-tile");var t=this.getTileSize();e.style.width=t.x+"px",e.style.height=t.y+"px",e.onselectstart=b,e.onmousemove=b,F.ielt9&&this.options.opacity<1&&ke(e,this.options.opacity)},_addTile:function(e,t){var o=this._getTilePos(e),a=this._tileCoordsToKey(e),c=this.createTile(this._wrapCoords(e),u(this._tileReady,this,e));this._initTile(c),this.createTile.length<2&&_(u(this._tileReady,this,e,null,c)),fe(c,o),this._tiles[a]={el:c,coords:e,current:!0},t.appendChild(c),this.fire("tileloadstart",{tile:c,coords:e})},_tileReady:function(e,t,o){t&&this.fire("tileerror",{error:t,tile:o,coords:e});var a=this._tileCoordsToKey(e);o=this._tiles[a],o&&(o.loaded=+new Date,this._map._fadeAnimated?(ke(o.el,0),C(this._fadeFrame),this._fadeFrame=_(this._updateOpacity,this)):(o.active=!0,this._pruneTiles()),t||(J(o.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:o.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),F.ielt9||!this._map._fadeAnimated?_(this._pruneTiles,this):setTimeout(u(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var t=new H(this._wrapX?M(e.x,this._wrapX):e.x,this._wrapY?M(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToTileRange:function(e){var t=this.getTileSize();return new ne(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function $r(e){return new Ct(e)}var dt=Ct.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,t){this._url=e,t=k(this,t),t.detectRetina&&F.retina&&t.maxZoom>0?(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom=Math.min(t.maxZoom,t.minZoom+1)):(t.zoomOffset++,t.maxZoom=Math.max(t.minZoom,t.maxZoom-1)),t.minZoom=Math.max(0,t.minZoom)):t.zoomReverse?t.minZoom=Math.min(t.maxZoom,t.minZoom):t.maxZoom=Math.max(t.minZoom,t.maxZoom),typeof t.subdomains=="string"&&(t.subdomains=t.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,t){return this._url===e&&t===void 0&&(t=!0),this._url=e,t||this.redraw(),this},createTile:function(e,t){var o=document.createElement("img");return Y(o,"load",u(this._tileOnLoad,this,t,o)),Y(o,"error",u(this._tileOnError,this,t,o)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(o.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(o.referrerPolicy=this.options.referrerPolicy),o.alt="",o.src=this.getTileUrl(e),o},getTileUrl:function(e){var t={r:F.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var o=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=o),t["-y"]=o}return O(this._url,d(t,this.options))},_tileOnLoad:function(e,t){F.ielt9?setTimeout(u(e,this,null,t),0):e(null,t)},_tileOnError:function(e,t,o){var a=this.options.errorTileUrl;a&&t.getAttribute("src")!==a&&(t.src=a),e(o,t)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,t=this.options.maxZoom,o=this.options.zoomReverse,a=this.options.zoomOffset;return o&&(e=t-e),e+a},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&(t=this._tiles[e].el,t.onload=b,t.onerror=b,!t.complete)){t.src=z;var o=this._tiles[e].coords;ce(t),delete this._tiles[e],this.fire("tileabort",{tile:t,coords:o})}},_removeTile:function(e){var t=this._tiles[e];if(t)return t.el.setAttribute("src",z),Ct.prototype._removeTile.call(this,e)},_tileReady:function(e,t,o){if(!(!this._map||o&&o.getAttribute("src")===z))return Ct.prototype._tileReady.call(this,e,t,o)}});function Fn(e,t){return new dt(e,t)}var Hn=dt.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,t){this._url=e;var o=d({},this.defaultWmsParams);for(var a in t)a in this.options||(o[a]=t[a]);t=k(this,t);var c=t.detectRetina&&F.retina?2:1,h=this.getTileSize();o.width=h.x*c,o.height=h.y*c,this.wmsParams=o},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,dt.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToNwSe(e),o=this._crs,a=ae(o.project(t[0]),o.project(t[1])),c=a.min,h=a.max,m=(this._wmsVersion>=1.3&&this._crs===On?[c.y,c.x,h.y,h.x]:[c.x,c.y,h.x,h.y]).join(","),y=dt.prototype.getTileUrl.call(this,e);return y+R(this.wmsParams,y,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+m},setParams:function(e,t){return d(this.wmsParams,e),t||this.redraw(),this}});function Fr(e,t){return new Hn(e,t)}dt.WMS=Hn,Fn.wms=Fr;var $e=Ae.extend({options:{padding:.1},initialize:function(e){k(this,e),g(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),J(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var o=this._map.getZoomScale(t,this._zoom),a=this._map.getSize().multiplyBy(.5+this.options.padding),c=this._map.project(this._center,t),h=a.multiplyBy(-o).add(c).subtract(this._map._getNewPixelOrigin(e,t));F.any3d?Ve(this._container,h,o):fe(this._container,h)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var e in this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,t=this._map.getSize(),o=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new ne(o,o.add(t.multiplyBy(1+e*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Un=$e.extend({options:{tolerance:0},getEvents:function(){var e=$e.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){$e.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");Y(e,"mousemove",this._onMouseMove,this),Y(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Y(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){C(this._redrawRequest),delete this._ctx,ce(this._container),le(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var e;this._redrawBounds=null;for(var t in this._layers)e=this._layers[t],e._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){$e.prototype._update.call(this);var e=this._bounds,t=this._container,o=e.getSize(),a=F.retina?2:1;fe(t,e.min),t.width=a*o.x,t.height=a*o.y,t.style.width=o.x+"px",t.style.height=o.y+"px",F.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){$e.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[g(e)]=e;var t=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var t=e._order,o=t.next,a=t.prev;o?o.prev=a:this._drawLast=a,a?a.next=o:this._drawFirst=o,delete e._order,delete this._layers[g(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if(typeof e.options.dashArray=="string"){var t=e.options.dashArray.split(/[, ]+/),o=[],a,c;for(c=0;c<t.length;c++){if(a=Number(t[c]),isNaN(a))return;o.push(a)}e.options._dashArray=o}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||_(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var t=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ne,this._redrawBounds.extend(e._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(e._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var t=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,t=this._redrawBounds;if(this._ctx.save(),t){var o=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,o.x,o.y),this._ctx.clip()}this._drawing=!0;for(var a=this._drawFirst;a;a=a.next)e=a.layer,(!t||e._pxBounds&&e._pxBounds.intersects(t))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,t){if(this._drawing){var o,a,c,h,m=e._parts,y=m.length,w=this._ctx;if(y){for(w.beginPath(),o=0;o<y;o++){for(a=0,c=m[o].length;a<c;a++)h=m[o][a],w[a?"lineTo":"moveTo"](h.x,h.y);t&&w.closePath()}this._fillStroke(w,e)}}},_updateCircle:function(e){if(!(!this._drawing||e._empty())){var t=e._point,o=this._ctx,a=Math.max(Math.round(e._radius),1),c=(Math.max(Math.round(e._radiusY),1)||a)/a;c!==1&&(o.save(),o.scale(1,c)),o.beginPath(),o.arc(t.x,t.y/c,a,0,Math.PI*2,!1),c!==1&&o.restore(),this._fillStroke(o,e)}},_fillStroke:function(e,t){var o=t.options;o.fill&&(e.globalAlpha=o.fillOpacity,e.fillStyle=o.fillColor||o.color,e.fill(o.fillRule||"evenodd")),o.stroke&&o.weight!==0&&(e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.globalAlpha=o.opacity,e.lineWidth=o.weight,e.strokeStyle=o.color,e.lineCap=o.lineCap,e.lineJoin=o.lineJoin,e.stroke())},_onClick:function(e){for(var t=this._map.mouseEventToLayerPoint(e),o,a,c=this._drawFirst;c;c=c.next)o=c.layer,o.options.interactive&&o._containsPoint(t)&&(!(e.type==="click"||e.type==="preclick")||!this._map._draggableMoved(o))&&(a=o);this._fireEvent(a?[a]:!1,e)},_onMouseMove:function(e){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var t=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,t)}},_handleMouseOut:function(e){var t=this._hoveredLayer;t&&(pe(this._container,"leaflet-interactive"),this._fireEvent([t],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,t){if(!this._mouseHoverThrottled){for(var o,a,c=this._drawFirst;c;c=c.next)o=c.layer,o.options.interactive&&o._containsPoint(t)&&(a=o);a!==this._hoveredLayer&&(this._handleMouseOut(e),a&&(J(this._container,"leaflet-interactive"),this._fireEvent([a],e,"mouseover"),this._hoveredLayer=a)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,e),this._mouseHoverThrottled=!0,setTimeout(u(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(e,t,o){this._map._fireDOMEvent(t,o||t.type,e)},_bringToFront:function(e){var t=e._order;if(t){var o=t.next,a=t.prev;if(o)o.prev=a;else return;a?a.next=o:o&&(this._drawFirst=o),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(e)}},_bringToBack:function(e){var t=e._order;if(t){var o=t.next,a=t.prev;if(a)a.next=o;else return;o?o.prev=a:a&&(this._drawLast=a),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(e)}}});function Gn(e){return F.canvas?new Un(e):null}var kt=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch{}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Hr={_initContainer:function(){this._container=oe("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||($e.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var t=e._container=kt("shape");J(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",e._path=kt("path"),t.appendChild(e._path),this._updateStyle(e),this._layers[g(e)]=e},_addPath:function(e){var t=e._container;this._container.appendChild(t),e.options.interactive&&e.addInteractiveTarget(t)},_removePath:function(e){var t=e._container;ce(t),e.removeInteractiveTarget(t),delete this._layers[g(e)]},_updateStyle:function(e){var t=e._stroke,o=e._fill,a=e.options,c=e._container;c.stroked=!!a.stroke,c.filled=!!a.fill,a.stroke?(t||(t=e._stroke=kt("stroke")),c.appendChild(t),t.weight=a.weight+"px",t.color=a.color,t.opacity=a.opacity,a.dashArray?t.dashStyle=Z(a.dashArray)?a.dashArray.join(" "):a.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=a.lineCap.replace("butt","flat"),t.joinstyle=a.lineJoin):t&&(c.removeChild(t),e._stroke=null),a.fill?(o||(o=e._fill=kt("fill")),c.appendChild(o),o.color=a.fillColor||a.color,o.opacity=a.fillOpacity):o&&(c.removeChild(o),e._fill=null)},_updateCircle:function(e){var t=e._point.round(),o=Math.round(e._radius),a=Math.round(e._radiusY||o);this._setPath(e,e._empty()?"M0 0":"AL "+t.x+","+t.y+" "+o+","+a+" 0,"+65535*360)},_setPath:function(e,t){e._path.v=t},_bringToFront:function(e){nt(e._container)},_bringToBack:function(e){ot(e._container)}},Jt=F.vml?kt:Yi,zt=$e.extend({_initContainer:function(){this._container=Jt("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Jt("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){ce(this._container),le(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){$e.prototype._update.call(this);var e=this._bounds,t=e.getSize(),o=this._container;(!this._svgSize||!this._svgSize.equals(t))&&(this._svgSize=t,o.setAttribute("width",t.x),o.setAttribute("height",t.y)),fe(o,e.min),o.setAttribute("viewBox",[e.min.x,e.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(e){var t=e._path=Jt("path");e.options.className&&J(t,e.options.className),e.options.interactive&&J(t,"leaflet-interactive"),this._updateStyle(e),this._layers[g(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){ce(e._path),e.removeInteractiveTarget(e._path),delete this._layers[g(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,o=e.options;t&&(o.stroke?(t.setAttribute("stroke",o.color),t.setAttribute("stroke-opacity",o.opacity),t.setAttribute("stroke-width",o.weight),t.setAttribute("stroke-linecap",o.lineCap),t.setAttribute("stroke-linejoin",o.lineJoin),o.dashArray?t.setAttribute("stroke-dasharray",o.dashArray):t.removeAttribute("stroke-dasharray"),o.dashOffset?t.setAttribute("stroke-dashoffset",o.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),o.fill?(t.setAttribute("fill",o.fillColor||o.color),t.setAttribute("fill-opacity",o.fillOpacity),t.setAttribute("fill-rule",o.fillRule||"evenodd")):t.setAttribute("fill","none"))},_updatePoly:function(e,t){this._setPath(e,Ji(e._parts,t))},_updateCircle:function(e){var t=e._point,o=Math.max(Math.round(e._radius),1),a=Math.max(Math.round(e._radiusY),1)||o,c="a"+o+","+a+" 0 1,0 ",h=e._empty()?"M0 0":"M"+(t.x-o)+","+t.y+c+o*2+",0 "+c+-o*2+",0 ";this._setPath(e,h)},_setPath:function(e,t){e._path.setAttribute("d",t)},_bringToFront:function(e){nt(e._path)},_bringToBack:function(e){ot(e._path)}});F.vml&&zt.include(Hr);function Vn(e){return F.svg||F.vml?new zt(e):null}ie.include({getRenderer:function(e){var t=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return t||(t=this._renderer=this._createRenderer()),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(e){if(e==="overlayPane"||e===void 0)return!1;var t=this._paneRenderers[e];return t===void 0&&(t=this._createRenderer({pane:e}),this._paneRenderers[e]=t),t},_createRenderer:function(e){return this.options.preferCanvas&&Gn(e)||Vn(e)}});var Kn=at.extend({initialize:function(e,t){at.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return e=ue(e),[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function Ur(e,t){return new Kn(e,t)}zt.create=Jt,zt.pointsToPath=Ji,Ze.geometryToLayer=Ft,Ze.coordsToLatLng=Mi,Ze.coordsToLatLngs=Ht,Ze.latLngToCoords=Ii,Ze.latLngsToCoords=Ut,Ze.getFeature=lt,Ze.asFeature=Gt,ie.mergeOptions({boxZoom:!0});var Yn=Oe.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){Y(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){le(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){ce(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||e.which!==1&&e.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),_t(),xi(),this._startPoint=this._map.mouseEventToContainerPoint(e),Y(document,{contextmenu:Je,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=oe("div","leaflet-zoom-box",this._container),J(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var t=new ne(this._point,this._startPoint),o=t.getSize();fe(this._box,t.min),this._box.style.width=o.x+"px",this._box.style.height=o.y+"px"},_finish:function(){this._moved&&(ce(this._box),pe(this._container,"leaflet-crosshair")),yt(),mi(),le(document,{contextmenu:Je,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if(!(e.which!==1&&e.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(u(this._resetState,this),0);var t=new ve(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t})}},_onKeyDown:function(e){e.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});ie.addInitHook("addHandler","boxZoom",Yn),ie.mergeOptions({doubleClickZoom:!0});var Jn=Oe.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,o=t.getZoom(),a=t.options.zoomDelta,c=e.originalEvent.shiftKey?o-a:o+a;t.options.doubleClickZoom==="center"?t.setZoom(c):t.setZoomAround(e.containerPoint,c)}});ie.addInitHook("addHandler","doubleClickZoom",Jn),ie.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Qn=Oe.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new Ue(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}J(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){pe(this._map._container,"leaflet-grab"),pe(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=ue(this._map.options.maxBounds);this._offsetLimit=ae(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var t=this._lastTime=+new Date,o=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(o),this._times.push(t),this._prunePositions(t)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,t){return e-(e-t)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var e=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;e.x<t.min.x&&(e.x=this._viscousLimit(e.x,t.min.x)),e.y<t.min.y&&(e.y=this._viscousLimit(e.y,t.min.y)),e.x>t.max.x&&(e.x=this._viscousLimit(e.x,t.max.x)),e.y>t.max.y&&(e.y=this._viscousLimit(e.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,t=Math.round(e/2),o=this._initialWorldOffset,a=this._draggable._newPos.x,c=(a-t+o)%e+t-o,h=(a+t+o)%e-t-o,m=Math.abs(c+o)<Math.abs(h+o)?c:h;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=m},_onDragEnd:function(e){var t=this._map,o=t.options,a=!o.inertia||e.noInertia||this._times.length<2;if(t.fire("dragend",e),a)t.fire("moveend");else{this._prunePositions(+new Date);var c=this._lastPos.subtract(this._positions[0]),h=(this._lastTime-this._times[0])/1e3,m=o.easeLinearity,y=c.multiplyBy(m/h),w=y.distanceTo([0,0]),A=Math.min(o.inertiaMaxSpeed,w),N=y.multiplyBy(A/w),G=A/(o.inertiaDeceleration*m),Q=N.multiplyBy(-G/2).round();!Q.x&&!Q.y?t.fire("moveend"):(Q=t._limitOffset(Q,t.options.maxBounds),_(function(){t.panBy(Q,{duration:G,easeLinearity:m,noMoveStart:!0,animate:!0})}))}}});ie.addInitHook("addHandler","dragging",Qn),ie.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Xn=Oe.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),Y(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),le(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,t=document.documentElement,o=e.scrollTop||t.scrollTop,a=e.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(a,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var t=this._panKeys={},o=this.keyCodes,a,c;for(a=0,c=o.left.length;a<c;a++)t[o.left[a]]=[-1*e,0];for(a=0,c=o.right.length;a<c;a++)t[o.right[a]]=[e,0];for(a=0,c=o.down.length;a<c;a++)t[o.down[a]]=[0,e];for(a=0,c=o.up.length;a<c;a++)t[o.up[a]]=[0,-1*e]},_setZoomDelta:function(e){var t=this._zoomKeys={},o=this.keyCodes,a,c;for(a=0,c=o.zoomIn.length;a<c;a++)t[o.zoomIn[a]]=e;for(a=0,c=o.zoomOut.length;a<c;a++)t[o.zoomOut[a]]=-e},_addHooks:function(){Y(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){le(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t=e.keyCode,o=this._map,a;if(t in this._panKeys){if(!o._panAnim||!o._panAnim._inProgress)if(a=this._panKeys[t],e.shiftKey&&(a=q(a).multiplyBy(3)),o.options.maxBounds&&(a=o._limitOffset(q(a),o.options.maxBounds)),o.options.worldCopyJump){var c=o.wrapLatLng(o.unproject(o.project(o.getCenter()).add(a)));o.panTo(c)}else o.panBy(a)}else if(t in this._zoomKeys)o.setZoom(o.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[t]);else if(t===27&&o._popup&&o._popup.options.closeOnEscapeKey)o.closePopup();else return;Je(e)}}});ie.addInitHook("addHandler","keyboard",Xn),ie.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var eo=Oe.extend({addHooks:function(){Y(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){le(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var t=jn(e),o=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var a=Math.max(o-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(u(this._performZoom,this),a),Je(e)},_performZoom:function(){var e=this._map,t=e.getZoom(),o=this._map.options.zoomSnap||0;e._stop();var a=this._delta/(this._map.options.wheelPxPerZoomLevel*4),c=4*Math.log(2/(1+Math.exp(-Math.abs(a))))/Math.LN2,h=o?Math.ceil(c/o)*o:c,m=e._limitZoom(t+(this._delta>0?h:-h))-t;this._delta=0,this._startTime=null,m&&(e.options.scrollWheelZoom==="center"?e.setZoom(t+m):e.setZoomAround(this._lastMousePos,t+m))}});ie.addInitHook("addHandler","scrollWheelZoom",eo);var Gr=600;ie.mergeOptions({tapHold:F.touchNative&&F.safari&&F.mobile,tapTolerance:15});var to=Oe.extend({addHooks:function(){Y(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){le(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),e.touches.length===1){var t=e.touches[0];this._startPos=this._newPos=new H(t.clientX,t.clientY),this._holdTimeout=setTimeout(u(function(){this._cancel(),this._isTapValid()&&(Y(document,"touchend",ye),Y(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",t))},this),Gr),Y(document,"touchend touchcancel contextmenu",this._cancel,this),Y(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){le(document,"touchend",ye),le(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),le(document,"touchend touchcancel contextmenu",this._cancel,this),le(document,"touchmove",this._onMove,this)},_onMove:function(e){var t=e.touches[0];this._newPos=new H(t.clientX,t.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,t){var o=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});o._simulated=!0,t.target.dispatchEvent(o)}});ie.addInitHook("addHandler","tapHold",to),ie.mergeOptions({touchZoom:F.touch,bounceAtZoomLimits:!0});var io=Oe.extend({addHooks:function(){J(this._map._container,"leaflet-touch-zoom"),Y(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){pe(this._map._container,"leaflet-touch-zoom"),le(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(!(!e.touches||e.touches.length!==2||t._animatingZoom||this._zooming)){var o=t.mouseEventToContainerPoint(e.touches[0]),a=t.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),t.options.touchZoom!=="center"&&(this._pinchStartLatLng=t.containerPointToLatLng(o.add(a)._divideBy(2))),this._startDist=o.distanceTo(a),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),Y(document,"touchmove",this._onTouchMove,this),Y(document,"touchend touchcancel",this._onTouchEnd,this),ye(e)}},_onTouchMove:function(e){if(!(!e.touches||e.touches.length!==2||!this._zooming)){var t=this._map,o=t.mouseEventToContainerPoint(e.touches[0]),a=t.mouseEventToContainerPoint(e.touches[1]),c=o.distanceTo(a)/this._startDist;if(this._zoom=t.getScaleZoom(c,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&c<1||this._zoom>t.getMaxZoom()&&c>1)&&(this._zoom=t._limitZoom(this._zoom)),t.options.touchZoom==="center"){if(this._center=this._startLatLng,c===1)return}else{var h=o._add(a)._divideBy(2)._subtract(this._centerPoint);if(c===1&&h.x===0&&h.y===0)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(h),this._zoom)}this._moved||(t._moveStart(!0,!1),this._moved=!0),C(this._animRequest);var m=u(t._move,t,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=_(m,this,!0),ye(e)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,C(this._animRequest),le(document,"touchmove",this._onTouchMove,this),le(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});ie.addInitHook("addHandler","touchZoom",io),ie.BoxZoom=Yn,ie.DoubleClickZoom=Jn,ie.Drag=Qn,ie.Keyboard=Xn,ie.ScrollWheelZoom=eo,ie.TapHold=to,ie.TouchZoom=io,r.Bounds=ne,r.Browser=F,r.CRS=Pe,r.Canvas=Un,r.Circle=Ri,r.CircleMarker=$t,r.Class=P,r.Control=Ie,r.DivIcon=$n,r.DivOverlay=De,r.DomEvent=ur,r.DomUtil=dr,r.Draggable=Ue,r.Evented=te,r.FeatureGroup=qe,r.GeoJSON=Ze,r.GridLayer=Ct,r.Handler=Oe,r.Icon=st,r.ImageOverlay=Vt,r.LatLng=re,r.LatLngBounds=ve,r.Layer=Ae,r.LayerGroup=rt,r.LineUtil=jr,r.Map=ie,r.Marker=Zt,r.Mixin=_r,r.Path=Ge,r.Point=H,r.PolyUtil=yr,r.Polygon=at,r.Polyline=Ne,r.Popup=Kt,r.PosAnimation=Cn,r.Projection=Cr,r.Rectangle=Kn,r.Renderer=$e,r.SVG=zt,r.SVGOverlay=Zn,r.TileLayer=dt,r.Tooltip=Yt,r.Transformation=We,r.Util=B,r.VideoOverlay=Nn,r.bind=u,r.bounds=ae,r.canvas=Gn,r.circle=Ir,r.circleMarker=Mr,r.control=wt,r.divIcon=Zr,r.extend=d,r.featureGroup=Lr,r.geoJSON=qn,r.geoJson=Br,r.gridLayer=$r,r.icon=Pr,r.imageOverlay=Or,r.latLng=ee,r.latLngBounds=ue,r.layerGroup=Tr,r.map=pr,r.marker=Rr,r.point=q,r.polygon=Er,r.polyline=Ar,r.popup=qr,r.rectangle=Ur,r.setOptions=k,r.stamp=g,r.svg=Vn,r.svgOverlay=Wr,r.tileLayer=Fn,r.tooltip=Nr,r.transformation=ft,r.version=l,r.videoOverlay=Dr;var Vr=window.L;r.noConflict=function(){return window.L=Vr,this},window.L=r})})(Ni,Ni.exports);var It=Ni.exports;const Gi=as(It);function Vi(n,s,r){return Object.freeze({instance:n,context:s,container:r})}function Ki(n,s){return s==null?function(l,d){const p=D.useRef();return p.current||(p.current=n(l,d)),p}:function(l,d){const p=D.useRef();p.current||(p.current=n(l,d));const u=D.useRef(l),{instance:x}=p.current;return D.useEffect(function(){u.current!==l&&(s(x,l,u.current),u.current=l)},[x,l,d]),p}}function Ro(n,s){D.useEffect(function(){return(s.layerContainer??s.map).addLayer(n.instance),function(){var p;(p=s.layerContainer)==null||p.removeLayer(n.instance),s.map.removeLayer(n.instance)}},[s,n])}function Mo(n){return function(r){const l=Hi(),d=n(Ui(r,l),l);return da(l.map,r.attribution),Po(d.current,r.eventHandlers),Ro(d.current,l),d}}function fa(n,s){const r=D.useRef();D.useEffect(function(){if(s.pathOptions!==r.current){const d=s.pathOptions??{};n.instance.setStyle(d),r.current=d}},[n,s])}function xa(n){return function(r){const l=Hi(),d=n(Ui(r,l),l);return Po(d.current,r.eventHandlers),Ro(d.current,l),fa(d.current,r),d}}function ma(n,s){const r=Ki(n,s),l=Mo(r);return Lo(l)}function ga(n,s){const r=Ki(n,s),l=xa(r);return Lo(l)}function _a(n,s){const r=Ki(n,s),l=Mo(r);return ha(l)}function ya(n,s,r){const{opacity:l,zIndex:d}=s;l!=null&&l!==r.opacity&&n.setOpacity(l),d!=null&&d!==r.zIndex&&n.setZIndex(d)}function va(){return Hi().map}const ba=ga(function({center:s,children:r,...l},d){const p=new It.Circle(s,l);return Vi(p,ko(d,{overlayContainer:p}))},ca);function Zi(){return Zi=Object.assign||function(n){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(n[l]=r[l])}return n},Zi.apply(this,arguments)}function wa({bounds:n,boundsOptions:s,center:r,children:l,className:d,id:p,placeholder:u,style:x,whenReady:g,zoom:f,...M},b){const[I]=D.useState({className:d,id:p,style:x}),[j,S]=D.useState(null);D.useImperativeHandle(b,()=>(j==null?void 0:j.map)??null,[j]);const k=D.useCallback(v=>{if(v!==null&&j===null){const O=new It.Map(v,M);r!=null&&f!=null?O.setView(r,f):n!=null&&O.fitBounds(n,s),g!=null&&O.whenReady(g),S(pa(O))}},[]);D.useEffect(()=>()=>{j==null||j.map.remove()},[j]);const R=j?He.createElement(To,{value:j},l):u??null;return He.createElement("div",Zi({},I,{ref:k}),R)}const Sa=D.forwardRef(wa),ja=ma(function({position:s,...r},l){const d=new It.Marker(s,r);return Vi(d,ko(l,{overlayContainer:d}))},function(s,r,l){r.position!==l.position&&s.setLatLng(r.position),r.icon!=null&&r.icon!==l.icon&&s.setIcon(r.icon),r.zIndexOffset!=null&&r.zIndexOffset!==l.zIndexOffset&&s.setZIndexOffset(r.zIndexOffset),r.opacity!=null&&r.opacity!==l.opacity&&s.setOpacity(r.opacity),s.dragging!=null&&r.draggable!==l.draggable&&(r.draggable===!0?s.dragging.enable():s.dragging.disable())}),Ca=_a(function({url:s,...r},l){const d=new It.TileLayer(s,Ui(r,l));return Vi(d,l)},function(s,r,l){ya(s,r,l);const{url:d}=r;d!=null&&d!==l.url&&s.setUrl(d)});delete Gi.Icon.Default.prototype._getIconUrl;Gi.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const ii=({width:n="100%",height:s="20px"})=>i.jsx("div",{style:{width:n,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),ka=({status:n,theme:s})=>{const r={Draft:{bg:s.textMuted,text:"#fff"},Scheduled:{bg:s.warning,text:"#fff"},Sending:{bg:s.primary,text:"#fff"},Completed:{bg:s.success,text:"#fff"},Cancelled:{bg:s.danger,text:"#fff"}},l=r[n]||r.Draft;return i.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${l.bg}20`,color:l.bg,borderRadius:"20px",fontSize:"11px",fontWeight:"500"},children:n})},za=({template:n,onSave:s,onClose:r,theme:l})=>{const[d,p]=D.useState((n==null?void 0:n.name)||""),[u,x]=D.useState((n==null?void 0:n.subject)||""),[g,f]=D.useState((n==null?void 0:n.body_html)||(n==null?void 0:n.body_text)||""),[M,b]=D.useState((n==null?void 0:n.category)||"general"),[I,j]=D.useState(!1),S=async()=>{j(!0);try{const v=await s({name:d,subject:u,body_html:g,body_text:g.replace(/<[^>]*>/g,""),category:M});r(v)}catch(v){console.error("Failed to save template:",v)}finally{j(!1)}},k=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],R=v=>{f(g+v)};return i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:200},onClick:()=>r(null)}),i.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxWidth:"95vw",maxHeight:"90vh",backgroundColor:l.bgCard,borderRadius:"16px",border:`1px solid ${l.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[i.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${l.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:l.text,margin:0},children:n?"Edit Template":"Create New Template"}),i.jsx("button",{onClick:()=>r(null),style:{background:"none",border:"none",color:l.textMuted,cursor:"pointer",fontSize:"20px"},children:"×"})]}),i.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Template Name"}),i.jsx("input",{type:"text",value:d,onChange:v=>p(v.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Category"}),i.jsxs("select",{value:M,onChange:v=>b(v.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"},children:[i.jsx("option",{value:"general",children:"General"}),i.jsx("option",{value:"welcome",children:"Welcome"}),i.jsx("option",{value:"renewal",children:"Renewal"}),i.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),i.jsx("option",{value:"engagement",children:"Engagement"}),i.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),i.jsx("input",{type:"text",value:u,onChange:v=>x(v.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:k.map(v=>i.jsx("button",{onClick:()=>R(v.key),style:{padding:"4px 10px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"6px",color:l.textSecondary,cursor:"pointer",fontSize:"11px"},children:v.label},v.key))})]}),i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Email Body"}),i.jsx("textarea",{value:g,onChange:v=>f(v.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:10,style:{width:"100%",padding:"12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),i.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${l.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[i.jsx("button",{onClick:()=>r(null),style:{padding:"10px 20px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),i.jsx("button",{onClick:S,disabled:I||!d||!u,style:{padding:"10px 20px",backgroundColor:l.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:I?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:I||!d||!u?.6:1},children:I?"Creating...":"Create & Select"})]})]})]})},Ta=({batch:n,onView:s,theme:r})=>{var d;const l=n.total_recipients>0?Math.round(n.emails_sent/n.total_recipients*100):0;return i.jsxs("div",{style:{padding:"16px",backgroundColor:r.bgCard,borderRadius:"10px",border:`1px solid ${r.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px"},children:[i.jsxs("div",{style:{flex:1},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"6px"},children:[i.jsx("span",{style:{fontWeight:"600",color:r.text},children:n.name||"Untitled Batch"}),i.jsx(ka,{status:n.status,theme:r})]}),i.jsx("p",{style:{fontSize:"13px",color:r.textSecondary,margin:0},children:n.subject||"No subject"}),i.jsxs("p",{style:{fontSize:"12px",color:r.textMuted,margin:"4px 0 0"},children:[((d=n.template)==null?void 0:d.name)||"Custom email"," • ",n.total_recipients||0," recipients"]})]}),n.status!=="Draft"&&i.jsxs("div",{style:{textAlign:"right",minWidth:"100px"},children:[i.jsxs("div",{style:{fontSize:"18px",fontWeight:"600",color:r.text},children:[l,"%"]}),i.jsxs("div",{style:{fontSize:"11px",color:r.textMuted},children:[n.emails_sent||0," / ",n.total_recipients||0," sent"]})]}),i.jsx("button",{onClick:()=>s(n),style:{padding:"8px 16px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.text,cursor:"pointer",fontSize:"13px"},children:"View"})]})},La=({currentStep:n,steps:s,theme:r})=>i.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"24px"},children:s.map((l,d)=>i.jsxs(He.Fragment,{children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:d<=n?r.primary:r.bgHover,color:d<=n?"#fff":r.textMuted,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"13px",fontWeight:"600"},children:d<n?"✓":d+1}),i.jsx("span",{style:{fontSize:"14px",fontWeight:d===n?"600":"400",color:d<=n?r.text:r.textMuted},children:l})]}),d<s.length-1&&i.jsx("div",{style:{flex:1,height:"2px",backgroundColor:d<n?r.primary:r.border,minWidth:"40px"}})]},l))}),Pa=({selectedTemplate:n,onSelect:s,onCreateNew:r,templates:l,isLoading:d,theme:p})=>{const[u,x]=D.useState(""),g=D.useMemo(()=>l?u?l.filter(f=>f.name.toLowerCase().includes(u.toLowerCase())||f.subject.toLowerCase().includes(u.toLowerCase())):l:[],[l,u]);return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:p.text,margin:0},children:"Select an Email Template"}),i.jsxs("button",{onClick:r,style:{padding:"8px 16px",backgroundColor:p.bgHover,border:`1px solid ${p.border}`,borderRadius:"8px",color:p.text,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:"+"})," Create New Template"]})]}),i.jsxs("div",{style:{position:"relative",marginBottom:"16px"},children:[i.jsx("input",{type:"text",placeholder:"Search templates...",value:u,onChange:f=>x(f.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:p.bgInput,border:`1px solid ${p.border}`,borderRadius:"8px",color:p.text,fontSize:"14px"}}),i.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:p.textMuted},children:"🔍"})]}),d?i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"},children:Array.from({length:4}).map((f,M)=>i.jsxs("div",{style:{padding:"16px",backgroundColor:p.bgCard,borderRadius:"10px",border:`1px solid ${p.border}`},children:[i.jsx(ii,{width:"120px",height:"16px"}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(ii,{width:"200px",height:"14px"})})]},M))}):i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px",maxHeight:"400px",overflow:"auto"},children:g.map(f=>i.jsxs("div",{onClick:()=>s(f),style:{padding:"16px",backgroundColor:p.bgCard,borderRadius:"10px",border:`2px solid ${(n==null?void 0:n.id)===f.id?p.primary:p.border}`,cursor:"pointer",transition:"border-color 0.15s"},children:[i.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:p.text,marginBottom:"4px"},children:f.name}),i.jsx("div",{style:{fontSize:"13px",color:p.textSecondary},children:f.subject}),i.jsx("div",{style:{marginTop:"8px",padding:"4px 8px",backgroundColor:`${p.primary}15`,color:p.primary,borderRadius:"4px",fontSize:"11px",display:"inline-block",textTransform:"capitalize"},children:f.category||"General"})]},f.id))}),!d&&g.length===0&&i.jsx("div",{style:{textAlign:"center",padding:"40px",color:p.textMuted},children:u?"No templates match your search":"No templates available. Create one to get started!"})]})},uo=[{value:"account_status",label:"Account Status",type:"select",options:[{value:"customer",label:"Customer"},{value:"prospect",label:"Prospect"},{value:"prior_customer",label:"Prior Customer"},{value:"lead",label:"Lead"}]},{value:"policy_type",label:"Policy Type",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"policy_count",label:"Number of Policies",type:"number"},{value:"policy_expiration",label:"Policy Expiration",type:"date"},{value:"location",label:"Location",type:"location"},{value:"state",label:"State",type:"select",options:[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}]},{value:"city",label:"City",type:"text"}],Ra={select:[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"is_any",label:"is any of"}],number:[{value:"equals",label:"equals"},{value:"greater_than",label:"greater than"},{value:"less_than",label:"less than"},{value:"at_least",label:"at least"}],date:[{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"between",label:"is between"},{value:"in_next_days",label:"is in the next"}],location:[{value:"within_radius",label:"is within"}],text:[{value:"contains",label:"contains"},{value:"equals",label:"equals"},{value:"starts_with",label:"starts with"}]},Ma=[5,10,15,25,50,100],Ia=({center:n,radiusMeters:s})=>{const r=va();return D.useEffect(()=>{if(n&&s&&r){const l=s/111320,d=Gi.latLngBounds([n[0]-l,n[1]-l],[n[0]+l,n[1]+l]);r.fitBounds(d,{padding:[20,20]})}},[r,n,s]),null},Aa=({location:n,radius:s,onClose:r,theme:l})=>{if(!n)return null;const d=parseFloat(n.lat),p=parseFloat(n.lng),u=s*1609.34;return i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",zIndex:1e3},onClick:r}),i.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"600px",maxWidth:"95vw",backgroundColor:l.bgCard,borderRadius:"16px",border:`1px solid ${l.border}`,zIndex:1001,overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[i.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${l.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{children:[i.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:l.text},children:"Location Radius Preview"}),i.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:l.textSecondary},children:["📍 ",n.display]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsxs("div",{style:{padding:"6px 12px",backgroundColor:`${l.primary}15`,color:l.primary,borderRadius:"6px",fontWeight:"600",fontSize:"14px"},children:[s," mile radius"]}),i.jsx("button",{onClick:r,style:{background:"none",border:"none",color:l.textMuted,cursor:"pointer",fontSize:"24px",lineHeight:1},children:"×"})]})]}),i.jsx("div",{style:{height:"400px"},children:i.jsxs(Sa,{center:[d,p],zoom:10,style:{height:"100%",width:"100%"},children:[i.jsx(Ca,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),i.jsx(ba,{center:[d,p],radius:u,pathOptions:{color:l.primary,fillColor:l.primary,fillOpacity:.2,weight:3}}),i.jsx(ja,{position:[d,p]}),i.jsx(Ia,{center:[d,p],radiusMeters:u})]})}),i.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${l.border}`,backgroundColor:l.bgHover,fontSize:"12px",color:l.textSecondary,textAlign:"center"},children:"Recipients within this area will be included in your campaign"})]})]})},Ea=({location:n,radius:s,theme:r})=>{const[l,d]=D.useState(!1);return n?i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{marginTop:"12px",borderRadius:"8px",overflow:"hidden",border:`1px solid ${r.border}`},children:i.jsxs("div",{style:{padding:"12px 16px",backgroundColor:r.bgHover,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx("span",{style:{fontSize:"20px"},children:"📍"}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:r.text},children:n.display}),i.jsxs("div",{style:{fontSize:"12px",color:r.textSecondary},children:[s," mile radius"]})]})]}),i.jsx("button",{onClick:()=>d(!0),style:{padding:"8px 16px",backgroundColor:r.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"🗺️ View Map"})]})}),l&&i.jsx(Aa,{location:n,radius:s,onClose:()=>d(!1),theme:r})]}):null},Ba=({rule:n,index:s,onUpdate:r,onRemove:l,theme:d})=>{const p=uo.find(f=>f.value===n.field),u=p?Ra[p.type]:[],x={padding:"8px 12px",backgroundColor:d.bgInput,border:`1px solid ${d.border}`,borderRadius:"6px",color:d.text,fontSize:"13px",minWidth:"140px"},g={padding:"8px 12px",backgroundColor:d.bgInput,border:`1px solid ${d.border}`,borderRadius:"6px",color:d.text,fontSize:"13px",width:"120px"};return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:d.bgCard,borderRadius:"8px",border:`1px solid ${d.border}`,flexWrap:"wrap"},children:[s>0&&i.jsx("span",{style:{fontSize:"12px",color:d.primary,fontWeight:"600",padding:"4px 8px",backgroundColor:`${d.primary}15`,borderRadius:"4px"},children:"AND"}),i.jsxs("select",{value:n.field||"",onChange:f=>r(s,{...n,field:f.target.value,operator:"",value:""}),style:x,children:[i.jsx("option",{value:"",children:"Select field..."}),uo.map(f=>i.jsx("option",{value:f.value,children:f.label},f.value))]}),n.field&&i.jsxs("select",{value:n.operator||"",onChange:f=>r(s,{...n,operator:f.target.value}),style:x,children:[i.jsx("option",{value:"",children:"Select condition..."}),u.map(f=>i.jsx("option",{value:f.value,children:f.label},f.value))]}),n.field&&n.operator&&i.jsxs(i.Fragment,{children:[(p==null?void 0:p.type)==="select"&&n.operator!=="is_any"&&i.jsxs("select",{value:n.value||"",onChange:f=>r(s,{...n,value:f.target.value}),style:x,children:[i.jsx("option",{value:"",children:"Select value..."}),p.options.map(f=>i.jsx("option",{value:f.value,children:f.label},f.value))]}),(p==null?void 0:p.type)==="select"&&n.operator==="is_any"&&i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:p.options.map(f=>i.jsx("button",{onClick:()=>{const M=n.value?n.value.split(","):[],b=M.includes(f.value)?M.filter(I=>I!==f.value):[...M,f.value];r(s,{...n,value:b.join(",")})},style:{padding:"4px 10px",backgroundColor:(n.value||"").split(",").includes(f.value)?d.primary:d.bgHover,color:(n.value||"").split(",").includes(f.value)?"#fff":d.text,border:`1px solid ${(n.value||"").split(",").includes(f.value)?d.primary:d.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:f.label},f.value))}),(p==null?void 0:p.type)==="number"&&i.jsx("input",{type:"number",value:n.value||"",onChange:f=>r(s,{...n,value:f.target.value}),placeholder:"0",style:g}),(p==null?void 0:p.type)==="date"&&n.operator==="in_next_days"&&i.jsxs(i.Fragment,{children:[i.jsx("input",{type:"number",value:n.value||"",onChange:f=>r(s,{...n,value:f.target.value}),placeholder:"30",style:{...g,width:"70px"}}),i.jsx("span",{style:{fontSize:"13px",color:d.textSecondary},children:"days"})]}),(p==null?void 0:p.type)==="date"&&n.operator==="between"&&i.jsxs(i.Fragment,{children:[i.jsx("input",{type:"date",value:n.value||"",onChange:f=>r(s,{...n,value:f.target.value}),style:g}),i.jsx("span",{style:{fontSize:"13px",color:d.textSecondary},children:"and"}),i.jsx("input",{type:"date",value:n.value2||"",onChange:f=>r(s,{...n,value2:f.target.value}),style:g})]}),(p==null?void 0:p.type)==="date"&&(n.operator==="before"||n.operator==="after")&&i.jsx("input",{type:"date",value:n.value||"",onChange:f=>r(s,{...n,value:f.target.value}),style:g}),(p==null?void 0:p.type)==="text"&&i.jsx("input",{type:"text",value:n.value||"",onChange:f=>r(s,{...n,value:f.target.value}),placeholder:`Enter ${p.label.toLowerCase()}...`,style:{...g,width:"160px"}}),(p==null?void 0:p.type)==="location"&&i.jsx(Oa,{rule:n,onUpdate:f=>r(s,{...n,...f}),theme:d})]}),i.jsx("button",{onClick:()=>l(s),style:{marginLeft:"auto",padding:"6px 10px",backgroundColor:"transparent",border:"none",color:d.textMuted,cursor:"pointer",fontSize:"16px",borderRadius:"4px"},title:"Remove filter",children:"×"})]})},Oa=({rule:n,onUpdate:s,theme:r})=>{const[l,d]=D.useState(n.locationDisplay||""),[p,u]=D.useState(!1),[x,g]=D.useState([]),[f,M]=D.useState(!1),b={padding:"8px 12px",backgroundColor:r.bgInput,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.text,fontSize:"13px"},I=async S=>{if(S.length<3){g([]);return}u(!0);try{const R=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&q=${encodeURIComponent(S)}&limit=5`,{headers:{"Accept-Language":"en"}})).json();g(R.map(v=>({display:v.display_name,lat:v.lat,lng:v.lon,type:v.type}))),M(!0)}catch(k){console.error("Geocoding error:",k),g([])}finally{u(!1)}};He.useEffect(()=>{const S=setTimeout(()=>{l&&l!==n.locationDisplay&&I(l)},300);return()=>clearTimeout(S)},[l]);const j=S=>{d(S.display.split(",").slice(0,2).join(",")),s({value:`${S.lat},${S.lng}`,locationDisplay:S.display.split(",").slice(0,2).join(","),locationData:S}),M(!1)};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",flex:1,minWidth:"300px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[i.jsxs("div",{style:{position:"relative",flex:1,minWidth:"200px"},children:[i.jsx("input",{type:"text",value:l,onChange:S=>d(S.target.value),onFocus:()=>x.length>0&&M(!0),placeholder:"Enter zip code, city, or address...",style:{...b,width:"100%",paddingRight:"30px"}}),p&&i.jsx("span",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:r.textMuted,fontSize:"12px"},children:"..."}),f&&x.length>0&&i.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:r.bgCard,border:`1px solid ${r.border}`,borderRadius:"6px",marginTop:"4px",zIndex:100,maxHeight:"200px",overflow:"auto",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:x.map((S,k)=>i.jsxs("button",{onClick:()=>j(S),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderBottom:k<x.length-1?`1px solid ${r.border}`:"none",color:r.text,fontSize:"12px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"flex-start",gap:"8px"},onMouseEnter:R=>R.target.style.backgroundColor=r.bgHover,onMouseLeave:R=>R.target.style.backgroundColor="transparent",children:[i.jsx("span",{children:"📍"}),i.jsx("span",{style:{lineHeight:"1.4"},children:S.display})]},k))})]}),i.jsx("span",{style:{fontSize:"13px",color:r.textSecondary},children:"of"}),i.jsx("select",{value:n.radius||"25",onChange:S=>s({radius:S.target.value}),style:{...b,minWidth:"100px"},children:Ma.map(S=>i.jsxs("option",{value:S,children:[S," miles"]},S))})]}),n.locationData&&i.jsx(Ea,{location:n.locationData,radius:parseInt(n.radius||"25",10),theme:r})]})},Da=({breakdown:n,isLoading:s,theme:r})=>{const[l,d]=D.useState(!1);return s?i.jsx("div",{style:{padding:"12px 16px",backgroundColor:r.bgHover,borderRadius:"8px",marginTop:"12px",fontSize:"13px",color:r.textSecondary},children:"Loading location data..."}):!n||n.total===0?null:i.jsxs("div",{style:{marginTop:"12px",backgroundColor:r.bgCard,borderRadius:"8px",border:`1px solid ${r.border}`,overflow:"hidden"},children:[i.jsxs("button",{onClick:()=>d(!l),style:{width:"100%",padding:"12px 16px",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",color:r.text},children:[i.jsx("span",{style:{fontSize:"13px",fontWeight:"500"},children:"📊 View Recipients by Location"}),i.jsx("span",{style:{fontSize:"12px",color:r.textSecondary},children:l?"▲":"▼"})]}),l&&i.jsxs("div",{style:{padding:"0 16px 16px"},children:[i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:r.textSecondary,marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"By State"}),i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:n.byState.map(({state:p,count:u})=>i.jsxs("div",{style:{padding:"6px 10px",backgroundColor:r.bgHover,borderRadius:"6px",fontSize:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{style:{fontWeight:"500",color:r.text},children:p}),i.jsx("span",{style:{backgroundColor:r.primary,color:"#fff",padding:"2px 6px",borderRadius:"10px",fontSize:"11px",fontWeight:"600"},children:u})]},p))})]}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:r.textSecondary,marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Top Cities"}),i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:n.byCity.slice(0,8).map(({city:p,count:u})=>i.jsxs("div",{style:{padding:"6px 10px",backgroundColor:r.bgHover,borderRadius:"6px",fontSize:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{style:{color:r.text},children:p}),i.jsx("span",{style:{backgroundColor:`${r.primary}30`,color:r.primary,padding:"2px 6px",borderRadius:"10px",fontSize:"11px",fontWeight:"600"},children:u})]},p))})]})]})]})},Wa=({filterConfig:n,setFilterConfig:s,recipientCount:r,isLoading:l,locationBreakdown:d,isLoadingBreakdown:p,theme:u})=>{const x=n.rules||[],g=()=>{s({...n,rules:[...x,{field:"",operator:"",value:""}]})},f=(j,S)=>{const k=[...x];k[j]=S,s({...n,rules:k})},M=j=>{const S=x.filter((k,R)=>R!==j);s({...n,rules:S})},b=()=>{s({...n,rules:[],search:""})},I=x.filter(j=>j.field&&j.operator&&j.value).length;return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:u.text,margin:0},children:"Filter Recipients"}),(x.length>0||n.search)&&i.jsx("button",{onClick:b,style:{padding:"6px 12px",backgroundColor:"transparent",border:`1px solid ${u.border}`,borderRadius:"6px",color:u.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Clear all"})]}),i.jsxs("div",{style:{padding:"16px",backgroundColor:u.bgHover,borderRadius:"12px",marginBottom:"16px"},children:[x.length===0?i.jsx("div",{style:{textAlign:"center",padding:"20px",color:u.textMuted,fontSize:"14px"},children:"No filters applied. All accounts with valid emails will be included."}):i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:x.map((j,S)=>i.jsx(Ba,{rule:j,index:S,onUpdate:f,onRemove:M,theme:u},S))}),i.jsxs("button",{onClick:g,style:{width:"100%",padding:"10px",backgroundColor:u.bgCard,border:`1px dashed ${u.border}`,borderRadius:"8px",color:u.primary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[i.jsx("span",{children:"+"})," Add Filter"]})]}),I>0&&i.jsxs("div",{style:{padding:"12px 16px",backgroundColor:`${u.primary}10`,borderRadius:"8px",marginBottom:"16px",fontSize:"13px",color:u.text},children:[i.jsx("strong",{children:I})," filter",I!==1?"s":""," applied",i.jsx("span",{style:{color:u.textSecondary},children:" — results update automatically"})]}),i.jsxs("div",{style:{padding:"16px",backgroundColor:u.bgCard,borderRadius:"12px",border:`1px solid ${u.border}`,marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:u.text,display:"block",marginBottom:"8px"},children:"Search by Name or Email"}),i.jsx("input",{type:"text",placeholder:"Type to search...",value:n.search||"",onChange:j=>s({...n,search:j.target.value}),style:{width:"100%",padding:"10px 12px",backgroundColor:u.bgInput,border:`1px solid ${u.border}`,borderRadius:"8px",color:u.text,fontSize:"14px"}})]}),i.jsxs("div",{style:{padding:"20px",backgroundColor:`${u.primary}10`,borderRadius:"12px",border:`1px solid ${u.primary}30`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:u.text},children:"Matching Recipients"}),i.jsx("div",{style:{fontSize:"12px",color:u.textSecondary},children:"Accounts with valid emails who haven't opted out"})]}),i.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:u.primary},children:l?"...":(r||0).toLocaleString()})]}),i.jsx(Da,{breakdown:d,isLoading:p,theme:u})]})},qa=({template:n,filterConfig:s,subject:r,setSubject:l,name:d,setName:p,recipients:u,isLoadingRecipients:x,theme:g})=>i.jsxs("div",{children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:g.text,marginBottom:"16px"},children:"Review & Send"}),i.jsxs("div",{style:{padding:"20px",backgroundColor:g.bgCard,borderRadius:"12px",border:`1px solid ${g.border}`,marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:g.text,display:"block",marginBottom:"6px"},children:"Campaign Name"}),i.jsx("input",{type:"text",placeholder:"e.g., December Newsletter",value:d,onChange:f=>p(f.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:g.bgInput,border:`1px solid ${g.border}`,borderRadius:"8px",color:g.text,fontSize:"14px"}})]}),i.jsxs("div",{style:{padding:"20px",backgroundColor:g.bgCard,borderRadius:"12px",border:`1px solid ${g.border}`,marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:g.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),i.jsx("input",{type:"text",placeholder:"Email subject...",value:r,onChange:f=>l(f.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:g.bgInput,border:`1px solid ${g.border}`,borderRadius:"8px",color:g.text,fontSize:"14px"}}),i.jsxs("p",{style:{fontSize:"12px",color:g.textMuted,marginTop:"6px"},children:["Use merge fields like ","{{first_name}}"," for personalization"]})]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[i.jsxs("div",{style:{padding:"16px",backgroundColor:g.bgCard,borderRadius:"12px",border:`1px solid ${g.border}`},children:[i.jsx("div",{style:{fontSize:"12px",color:g.textMuted,marginBottom:"4px"},children:"Template"}),i.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:g.text},children:n==null?void 0:n.name})]}),i.jsxs("div",{style:{padding:"16px",backgroundColor:g.bgCard,borderRadius:"12px",border:`1px solid ${g.border}`},children:[i.jsx("div",{style:{fontSize:"12px",color:g.textMuted,marginBottom:"4px"},children:"Recipients"}),i.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:g.text},children:[x?"...":((u==null?void 0:u.length)||0).toLocaleString()," accounts"]})]})]}),u&&u.length>0&&i.jsxs("div",{style:{padding:"16px",backgroundColor:g.bgCard,borderRadius:"12px",border:`1px solid ${g.border}`},children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:g.text,marginBottom:"12px"},children:"Preview Recipients (first 10)"}),i.jsx("div",{style:{maxHeight:"200px",overflow:"auto"},children:u.slice(0,10).map((f,M)=>i.jsxs("div",{style:{padding:"8px 0",borderBottom:M<Math.min(9,u.length-1)?`1px solid ${g.border}`:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"13px",color:g.text},children:f.primary_contact_first_name?`${f.primary_contact_first_name} ${f.primary_contact_last_name||""}`:f.name}),i.jsx("div",{style:{fontSize:"12px",color:g.textMuted},children:f.person_email||f.email})]}),i.jsx("span",{style:{padding:"2px 8px",backgroundColor:g.bgHover,color:g.textSecondary,borderRadius:"4px",fontSize:"11px",textTransform:"capitalize"},children:f.account_status})]},f.account_unique_id))}),u.length>10&&i.jsxs("div",{style:{fontSize:"12px",color:g.textMuted,marginTop:"8px",textAlign:"center"},children:["+",u.length-10," more recipients"]})]})]}),Na=({t:n})=>{const{userId:s}=_e(),[r,l]=D.useState(!1),[d,p]=D.useState(!1),[u,x]=D.useState(0),[g,f]=D.useState(null),[M,b]=D.useState({rules:[],search:"",notOptedOut:!0}),[I,j]=D.useState(""),[S,k]=D.useState(""),[R,v]=D.useState(!1),[O,Z]=D.useState(null),[E,z]=D.useState(null),{data:W,isLoading:K,refetch:V}=fo(),{data:se,isLoading:X,refetch:_}=Es(),{data:C,isLoading:B}=Os(u>=1?M:null),{data:P,isLoading:$}=Ds(u>=1?M:null),{data:U,isLoading:te}=Bs(u===2?M:null,{limit:100}),{createBatch:H,scheduleBatch:we}=Ws(),{createTemplate:q}=xo(),ne=["Select Template","Filter Recipients","Review & Send"],ae=he=>{f(he),j(he.subject||"")},ve=async he=>{const We=await q.mutateAsync(he);return await V(),We},ue=he=>{p(!1),he&&(f(he),j(he.subject||""))},re=()=>{u<2&&x(u+1)},ee=()=>{u>0&&x(u-1)},Pe=async()=>{if(!(!g||!I)){v(!0),Z(null);try{const he=await H.mutateAsync({name:S||`Mass Email - ${new Date().toLocaleDateString()}`,subject:I,template_id:g.id,filter_config:M,total_recipients:C||0});await we.mutateAsync({batchId:he.id}),z(`Successfully scheduled ${C} emails for sending!`),l(!1),Re(),_()}catch(he){Z(he.message||"Failed to send mass email")}finally{v(!1)}}},Re=()=>{x(0),f(null),b({rules:[],search:"",notOptedOut:!0}),j(""),k("")},Me=()=>u===0?!!g:u===1?(C||0)>0:u===2?!!I&&!!S:!1;return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Mass Email"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px",margin:0},children:"Send one-off emails to filtered recipients"})]}),!r&&i.jsxs("button",{onClick:()=>l(!0),style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:"+"})," New Campaign"]})]}),E&&i.jsxs("div",{style:{padding:"16px",backgroundColor:`${n.success}15`,border:`1px solid ${n.success}30`,borderRadius:"8px",marginBottom:"24px",color:n.success,fontSize:"14px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[E,i.jsx("button",{onClick:()=>z(null),style:{background:"none",border:"none",color:n.success,cursor:"pointer"},children:"×"})]}),r?i.jsxs("div",{style:{backgroundColor:n.bgCard,borderRadius:"16px",border:`1px solid ${n.border}`,padding:"24px"},children:[i.jsx(La,{currentStep:u,steps:ne,theme:n}),O&&i.jsx("div",{style:{padding:"12px 16px",backgroundColor:`${n.danger}15`,border:`1px solid ${n.danger}30`,borderRadius:"8px",marginBottom:"16px",color:n.danger,fontSize:"14px"},children:O}),i.jsxs("div",{style:{minHeight:"300px"},children:[u===0&&i.jsx(Pa,{selectedTemplate:g,onSelect:ae,onCreateNew:()=>p(!0),templates:W,isLoading:K,theme:n}),u===1&&i.jsx(Wa,{filterConfig:M,setFilterConfig:b,recipientCount:C,isLoading:B,locationBreakdown:P,isLoadingBreakdown:$,theme:n}),u===2&&i.jsx(qa,{template:g,filterConfig:M,subject:I,setSubject:j,name:S,setName:k,recipients:U,isLoadingRecipients:te,theme:n})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"24px",borderTop:`1px solid ${n.border}`,marginTop:"24px"},children:[i.jsx("button",{onClick:()=>{u===0?(l(!1),Re()):ee()},style:{padding:"10px 20px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,cursor:"pointer",fontSize:"14px"},children:u===0?"Cancel":"Back"}),u<2?i.jsx("button",{onClick:re,disabled:!Me(),style:{padding:"10px 24px",backgroundColor:Me()?n.primary:n.bgHover,border:"none",borderRadius:"8px",color:Me()?"#fff":n.textMuted,cursor:Me()?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500"},children:"Continue"}):i.jsx("button",{onClick:Pe,disabled:!Me()||R,style:{padding:"10px 24px",backgroundColor:Me()&&!R?n.success:n.bgHover,border:"none",borderRadius:"8px",color:Me()&&!R?"#fff":n.textMuted,cursor:Me()&&!R?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px"},children:R?"Sending...":"Send Emails"})]})]}):i.jsx(i.Fragment,{children:i.jsxs("div",{style:{marginBottom:"24px"},children:[i.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Recent Campaigns"}),X?i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:Array.from({length:3}).map((he,We)=>i.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgCard,borderRadius:"10px",border:`1px solid ${n.border}`},children:[i.jsx(ii,{width:"200px",height:"18px"}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(ii,{width:"300px",height:"14px"})})]},We))}):se&&se.length>0?i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:se.map(he=>i.jsx(Ta,{batch:he,onView:We=>console.log("View batch:",We),theme:n},he.id))}):i.jsxs("div",{style:{padding:"60px 20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"📧"}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"8px"},children:"No campaigns yet"}),i.jsx("p",{style:{fontSize:"14px",color:n.textSecondary,marginBottom:"24px"},children:"Create your first mass email campaign to reach your clients."}),i.jsx("button",{onClick:()=>l(!0),style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Campaign"})]})]})}),d&&i.jsx(za,{template:null,onSave:ve,onClose:ue,theme:n})]})},Za=D.createContext(),Wi={light:{bg:"#f8fafc",bgCard:"#ffffff",bgSidebar:"#ffffff",bgHover:"#f1f5f9",bgInput:"#ffffff",border:"#e2e8f0",borderLight:"#f1f5f9",text:"#1e293b",textSecondary:"#64748b",textMuted:"#94a3b8",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},dark:{bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"}},$a=D.createContext(),Fa=()=>{const{userId:n}=_e(),s=po();ht();const[r,l]=D.useState(!1),[d,p]=D.useState({id:n,name:"Logan Johns",email:"info@isgdfw.com",org:"ISG"}),u=r?Wi.dark:Wi.light,g=(()=>{const M=s.pathname.split("/").slice(2).join("/");return M.startsWith("automations/")?"automations":M.startsWith("accounts/")?"accounts":M||"dashboard"})(),f=[{id:"dashboard",label:"Dashboard",icon:"📊",path:`/${n}/dashboard`},{id:"automations",label:"Automations",icon:"⚡",path:`/${n}/automations`},{id:"templates",label:"Templates",icon:"📝",path:`/${n}/templates`},{id:"mass-email",label:"Mass Email",icon:"📧",path:`/${n}/mass-email`},{id:"accounts",label:"Accounts",icon:"👥",path:`/${n}/accounts`},{id:"settings",label:"Settings",icon:"⚙️",path:`/${n}/settings`}];return i.jsx(Za.Provider,{value:{isDark:r,setIsDark:l,t:u,themes:Wi},children:i.jsx($a.Provider,{value:{userId:n,currentUser:d,setCurrentUser:p},children:i.jsxs("div",{style:{fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",backgroundColor:u.bg,minHeight:"100vh",display:"flex",color:u.text},children:[i.jsxs("div",{style:{width:"220px",backgroundColor:u.bgSidebar,borderRight:`1px solid ${u.border}`,display:"flex",flexDirection:"column",position:"fixed",top:0,left:0,bottom:0},children:[i.jsx("div",{style:{padding:"20px 16px",borderBottom:`1px solid ${u.border}`},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:u.primary,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"18px"},children:"📧"}),i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:"700",fontSize:"14px",color:u.text},children:"Email Automation"}),i.jsx("div",{style:{fontSize:"11px",color:u.textMuted},children:"Marketing System"})]})]})}),i.jsxs("div",{style:{flex:1,padding:"12px 8px"},children:[i.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:u.textMuted,padding:"8px 12px",textTransform:"uppercase"},children:"Navigation"}),f.map(M=>i.jsxs(tt,{to:M.path,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:g===M.id?`${u.primary}15`:"transparent",border:"none",borderRadius:"8px",color:g===M.id?u.primary:u.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:g===M.id?"600":"400",textAlign:"left",alignItems:"center",gap:"10px",marginBottom:"2px",textDecoration:"none"},children:[i.jsx("span",{children:M.icon})," ",M.label]},M.id)),i.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:u.textMuted,padding:"16px 12px 8px",textTransform:"uppercase"},children:"Admin"}),i.jsxs(tt,{to:`/${n}/timeline`,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:g==="timeline"?`${u.primary}15`:"transparent",border:"none",borderRadius:"8px",color:g==="timeline"?u.primary:u.textSecondary,cursor:"pointer",fontSize:"13px",textAlign:"left",alignItems:"center",gap:"10px",textDecoration:"none"},children:[i.jsx("span",{children:"📈"})," Timeline",i.jsx("span",{style:{marginLeft:"auto",padding:"2px 8px",backgroundColor:u.bgHover,borderRadius:"4px",fontSize:"10px",color:u.textMuted},children:"Admin"})]})]}),i.jsxs("div",{style:{padding:"16px",borderTop:`1px solid ${u.border}`,display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:u.bgHover,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:"👤"}),i.jsxs("div",{style:{flex:1},children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:u.text},children:d.name}),i.jsx("div",{style:{fontSize:"11px",color:u.textMuted},children:d.email})]}),i.jsx(tt,{to:`/${n}/settings`,style:{color:u.textMuted,fontSize:"16px",textDecoration:"none"},children:"⚙️"})]})]}),i.jsxs("div",{style:{flex:1,marginLeft:"220px"},children:[i.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${u.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:u.bgCard},children:[i.jsxs("div",{style:{fontSize:"11px",color:u.textMuted},children:["User: ",n==null?void 0:n.substring(0,8),"..."]}),i.jsx("button",{onClick:()=>l(!r),style:{padding:"8px 12px",backgroundColor:u.bgHover,border:`1px solid ${u.border}`,borderRadius:"8px",color:u.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:r?"☀️ Light":"🌙 Dark"})]}),i.jsx("div",{style:{padding:"24px"},children:i.jsxs(ho,{children:[i.jsx(je,{path:"dashboard",element:i.jsx(ao,{t:u})}),i.jsx(je,{path:"automations",element:i.jsx(Hs,{t:u})}),i.jsx(je,{path:"automations/new",element:i.jsx(co,{t:u})}),i.jsx(je,{path:"automations/:automationId",element:i.jsx(co,{t:u})}),i.jsx(je,{path:"templates",element:i.jsx(Vs,{t:u})}),i.jsx(je,{path:"mass-email",element:i.jsx(Na,{t:u})}),i.jsx(je,{path:"accounts",element:i.jsx(Qs,{t:u})}),i.jsx(je,{path:"accounts/:accountId",element:i.jsx(ia,{t:u})}),i.jsx(je,{path:"settings",element:i.jsx(ra,{t:u})}),i.jsx(je,{path:"timeline",element:i.jsx(Ha,{t:u})}),i.jsx(je,{path:"*",element:i.jsx(ao,{t:u})})]})})]})]})})})},Ha=({t:n})=>i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Activity Timeline"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px"},children:"View all email activity across your organization"}),i.jsxs("div",{style:{marginTop:"24px",padding:"60px",textAlign:"center",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"📈"}),i.jsx("p",{style:{color:n.textMuted},children:"Timeline view coming soon..."})]})]}),Ua=()=>{const n=ht();return D.useEffect(()=>{n("/0056g000004jvyVAAQ/dashboard")},[n]),i.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"'Inter', sans-serif"},children:i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"32px",marginBottom:"16px"},children:"⏳"}),i.jsx("div",{children:"Loading..."})]})})},Ga=()=>i.jsxs(os,{client:us,children:[i.jsx(ls,{children:i.jsxs(ho,{children:[i.jsx(je,{path:"/",element:i.jsx(Ua,{})}),i.jsx(je,{path:"/:userId/*",element:i.jsx(Fa,{})})]})}),i.jsx(cs,{initialIsOpen:!1})]});qi.createRoot(document.getElementById("root")).render(i.jsx(He.StrictMode,{children:i.jsx(Ga,{})}));
