import{j as r}from"./query-BgC-0ePs.js";import{e as _,u as L,r as y}from"./vendor-CvdBrt7H.js";import"./index-laD0T8Yw.js";import{u as H,a as F}from"./useAccounts-OopLnqh2.js";import"./supabase-GtAdROLV.js";import"./accounts-BqGB46ES.js";import"./useEffectiveOwner-BN9vJCNM.js";const w=({width:e="100%",height:l="20px"})=>r.jsx("div",{style:{width:e,height:l,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),N=({type:e,theme:l})=>{const o=(e||"").toLowerCase();let s=o;(o==="prior_customer"||o.startsWith("prior"))&&(s="prior"),o.startsWith("customer")&&(s="customer"),o.startsWith("prospect")&&(s="prospect"),o.startsWith("lead")&&(s="lead");const p={customer:{bg:`${l.success}20`,text:l.success,label:"Customer"},prospect:{bg:`${l.primary}20`,text:l.primary,label:"Prospect"},prior:{bg:`${l.textMuted}20`,text:l.textMuted,label:"Prior Customer"},lead:{bg:`${l.warning}20`,text:l.warning,label:"Lead"}},t=p[s]||p.prospect;return r.jsx("span",{style:{padding:"4px 10px",backgroundColor:t.bg,color:t.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:t.label||e||"Unknown"})},O=({policyType:e,status:l,theme:o})=>{const s=l==="active";return r.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"3px 8px",backgroundColor:s?`${o.success}10`:`${o.textMuted}10`,borderRadius:"6px",fontSize:"11px",color:s?o.success:o.textMuted},children:[s?"âœ“":"â—‹"," ",e]})},E=({client:e,onClick:l,theme:o})=>{var s,p,t;return r.jsxs("tr",{style:{borderTop:`1px solid ${o.border}`,cursor:"pointer"},onClick:l,onMouseOver:d=>d.currentTarget.style.backgroundColor=o.bgHover,onMouseOut:d=>d.currentTarget.style.backgroundColor="transparent",children:[r.jsx("td",{style:{padding:"14px 16px"},children:r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[r.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:o.bgHover,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",color:o.textMuted},children:((s=e.name)==null?void 0:s.charAt(0).toUpperCase())||"?"}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:o.text},children:e.name}),r.jsx("div",{style:{fontSize:"12px",color:o.textMuted},children:e.person_email||e.email||"â€”"})]})]})}),r.jsx("td",{style:{padding:"14px 16px"},children:r.jsx(N,{type:e.account_status||"Prospect",theme:o})}),r.jsx("td",{style:{padding:"14px 16px"},children:r.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",alignItems:"center"},children:((p=e.policies)==null?void 0:p.length)>0?r.jsxs(r.Fragment,{children:[e.policies.slice(0,3).map((d,a)=>r.jsx(O,{policyType:d.policy_type||"Policy",status:d.status,theme:o},a)),e.policies.length>3&&r.jsxs("span",{style:{fontSize:"11px",color:o.textMuted},children:["+",e.policies.length-3," more"]})]}):r.jsx("span",{style:{fontSize:"13px",color:o.textMuted},children:"No policies"})})}),r.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:o.textSecondary,textAlign:"center"},children:e.policy_count||((t=e.policies)==null?void 0:t.length)||0}),r.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:r.jsxs("div",{style:{display:"flex",gap:"6px",justifyContent:"flex-end"},children:[r.jsx("button",{onClick:d=>{d.stopPropagation()},style:{padding:"6px 12px",backgroundColor:o.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:"ðŸ“§ Email"}),r.jsx("button",{onClick:d=>{d.stopPropagation(),l()},style:{padding:"6px 12px",backgroundColor:o.bgHover,border:`1px solid ${o.border}`,borderRadius:"6px",color:o.textSecondary,cursor:"pointer",fontSize:"12px"},children:"View"})]})})]})},v=({label:e,value:l,icon:o,color:s,theme:p,onClick:t,active:d})=>r.jsxs("div",{onClick:t,style:{padding:"16px",backgroundColor:d?`${s}15`:p.bgCard,borderRadius:"10px",border:`2px solid ${d?s:p.border}`,textAlign:"center",cursor:t?"pointer":"default",transition:"all 0.2s ease",transform:d?"scale(1.02)":"scale(1)"},onMouseOver:a=>{t&&(a.currentTarget.style.borderColor=s,a.currentTarget.style.transform="scale(1.02)")},onMouseOut:a=>{t&&!d&&(a.currentTarget.style.borderColor=p.border,a.currentTarget.style.transform="scale(1)")},children:[r.jsx("div",{style:{fontSize:"24px",marginBottom:"4px"},children:o}),r.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:s||p.text},children:l}),r.jsx("div",{style:{fontSize:"12px",color:p.textSecondary},children:e})]}),J=({t:e})=>{const{userId:l}=_(),o=L(),[s,p]=y.useState(""),[t,d]=y.useState("all"),[a,P]=y.useState("name"),[$,A]=y.useState("asc"),[n,f]=y.useState(1),j=25,M=y.useMemo(()=>{const i={limit:j,offset:(n-1)*j};return t!=="all"&&t!=="expiring"&&(i.status=t),t==="expiring"&&(i.expiring=!0,i.limit=100,i.offset=0),s.length>=2&&(i.search=s),i},[t,n,s]),{data:m,isLoading:R,error:W}=H(M),{data:T,isLoading:C}=F(),S=(m==null?void 0:m.accounts)||[],z=(m==null?void 0:m.total)||0,x=Math.ceil(z/j),k=y.useMemo(()=>!S||S.length===0?[]:[...S].sort((i,h)=>{let c=i[a],b=h[a];return a==="name"&&(c=(c==null?void 0:c.toLowerCase())||"",b=(b==null?void 0:b.toLowerCase())||""),a==="policy_count"&&(c=i.policy_count||0,b=h.policy_count||0),$==="asc"?c>b?1:-1:c<b?1:-1}),[S,a,$]),u=i=>{d(i),f(1)},I=i=>{p(i),f(1)},B=i=>{o(`/${l}/accounts/${i}`)},g=T||{Customer:0,Prospect:0,Prior:0,total:0,expiring:0};return r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[r.jsxs("div",{children:[r.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Accounts"}),r.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"View and manage your account database"})]}),r.jsxs("div",{style:{display:"flex",gap:"12px"},children:[r.jsx("button",{onClick:()=>{},style:{padding:"10px 16px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:"ðŸ“¤ Export"}),r.jsx("button",{style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"+ Add Account"})]})]}),W&&r.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load accounts. Please try refreshing the page."}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"16px",marginBottom:"24px"},children:[r.jsx(v,{label:"Total Accounts",value:C?"...":g.total,icon:"ðŸ“Š",color:e.text,theme:e,onClick:()=>u("all"),active:t==="all"}),r.jsx(v,{label:"Customers",value:C?"...":g.Customer,icon:"ðŸ‘¥",color:e.success,theme:e,onClick:()=>u(t==="Customer"?"all":"Customer"),active:t==="Customer"}),r.jsx(v,{label:"Prospects",value:C?"...":g.Prospect,icon:"ðŸŽ¯",color:e.primary,theme:e,onClick:()=>u(t==="Prospect"?"all":"Prospect"),active:t==="Prospect"}),r.jsx(v,{label:"Prior Customers",value:C?"...":g.Prior,icon:"ðŸ“",color:e.textMuted,theme:e,onClick:()=>u(t==="Prior"?"all":"Prior"),active:t==="Prior"}),r.jsx(v,{label:"Expiring in 30d",value:C?"...":g.expiring,icon:"âš ï¸",color:e.warning,theme:e,onClick:()=>u(t==="expiring"?"all":"expiring"),active:t==="expiring"})]}),r.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"20px",alignItems:"center",flexWrap:"wrap"},children:[r.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"350px"},children:[r.jsx("input",{type:"text",placeholder:"Search by name, email, or phone...",value:s,onChange:i=>I(i.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px"}}),r.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:e.textMuted},children:"ðŸ”"})]}),r.jsxs("select",{value:t,onChange:i=>u(i.target.value),style:{padding:"10px 12px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px",minWidth:"150px"},children:[r.jsx("option",{value:"all",children:"All Types"}),r.jsx("option",{value:"Customer",children:"Customers"}),r.jsx("option",{value:"Prospect",children:"Prospects"}),r.jsx("option",{value:"Prior",children:"Prior Customers"}),r.jsx("option",{value:"Lead",children:"Leads"}),r.jsx("option",{value:"expiring",children:"Expiring Policies"})]}),r.jsxs("select",{value:`${a}-${$}`,onChange:i=>{const[h,c]=i.target.value.split("-");P(h),A(c)},style:{padding:"10px 12px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px",minWidth:"150px"},children:[r.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),r.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),r.jsx("option",{value:"created_at-desc",children:"Newest First"}),r.jsx("option",{value:"created_at-asc",children:"Oldest First"})]}),r.jsx("span",{style:{fontSize:"13px",color:e.textMuted,marginLeft:"auto"},children:t==="expiring"?`${k.length} account${k.length!==1?"s":""} with expiring policies`:`Showing ${(n-1)*j+1}-${Math.min(n*j,z)} of ${z} account${z!==1?"s":""}`})]}),R?r.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,padding:"20px"},children:Array.from({length:5}).map((i,h)=>r.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:h>0?`1px solid ${e.border}`:"none"},children:[r.jsx(w,{width:"40px",height:"40px"}),r.jsxs("div",{style:{flex:1},children:[r.jsx(w,{width:"200px",height:"16px"}),r.jsx("div",{style:{marginTop:"8px"},children:r.jsx(w,{width:"150px",height:"12px"})})]})]},h))}):k.length>0?r.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,overflow:"hidden"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{backgroundColor:e.bgHover},children:[r.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Account"}),r.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Type"}),r.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Policies"}),r.jsx("th",{style:{padding:"14px 16px",textAlign:"center",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"# Policies"}),r.jsx("th",{style:{padding:"14px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Actions"})]})}),r.jsx("tbody",{children:k.map(i=>r.jsx(E,{client:i,onClick:()=>B(i.account_unique_id),theme:e},i.id))})]})}):r.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[r.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ‘¥"}),r.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:s?"No accounts found":"No accounts yet"}),r.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:s?"Try adjusting your search criteria.":"Your accounts will appear here once synced from Salesforce."})]}),x>1&&t!=="expiring"&&r.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginTop:"24px",padding:"16px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[r.jsx("button",{onClick:()=>f(1),disabled:n===1,style:{padding:"8px 12px",backgroundColor:n===1?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:n===1?e.textMuted:e.text,cursor:n===1?"not-allowed":"pointer",fontSize:"13px"},children:"âŸ¨âŸ¨ First"}),r.jsx("button",{onClick:()=>f(i=>Math.max(1,i-1)),disabled:n===1,style:{padding:"8px 12px",backgroundColor:n===1?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:n===1?e.textMuted:e.text,cursor:n===1?"not-allowed":"pointer",fontSize:"13px"},children:"âŸ¨ Prev"}),r.jsxs("span",{style:{padding:"8px 16px",fontSize:"14px",color:e.text,fontWeight:"500"},children:["Page ",n," of ",x]}),r.jsx("button",{onClick:()=>f(i=>Math.min(x,i+1)),disabled:n===x,style:{padding:"8px 12px",backgroundColor:n===x?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:n===x?e.textMuted:e.text,cursor:n===x?"not-allowed":"pointer",fontSize:"13px"},children:"Next âŸ©"}),r.jsx("button",{onClick:()=>f(x),disabled:n===x,style:{padding:"8px 12px",backgroundColor:n===x?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:n===x?e.textMuted:e.text,cursor:n===x?"not-allowed":"pointer",fontSize:"13px"},children:"Last âŸ©âŸ©"})]}),g.expiring>0&&t!=="expiring"&&r.jsxs("div",{style:{marginTop:"24px",padding:"16px 20px",backgroundColor:`${e.warning}10`,border:`1px solid ${e.warning}30`,borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[r.jsx("span",{style:{fontSize:"24px"},children:"âš ï¸"}),r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:e.text},children:[g.expiring," account",g.expiring!==1?"s have":" has"," policies expiring in the next 30 days"]}),r.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Consider setting up renewal reminders for these accounts."})]})]}),r.jsx("button",{onClick:()=>u("expiring"),style:{padding:"8px 16px",backgroundColor:e.warning,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"View Expiring"})]})]})};export{J as default};
