import{j as e}from"./query-BgC-0ePs.js";import{e as fe,u as ve,r as b,f as D}from"./vendor-CvdBrt7H.js";import{u as je,b as Se}from"./useTemplates-BV1KRl1Y.js";import"./index-laD0T8Yw.js";import{b as Ce,c as we,a as ke,d as ze,u as Y,e as _e}from"./useMassEmails-dmaXbuhX.js";import{u as Re}from"./useSenderDomains-BmYMCls7.js";import"./useEffectiveOwner-BN9vJCNM.js";import"./supabase-GtAdROLV.js";import"./massEmails-cdFsY1gu.js";import"./senderDomains-D32G31A3.js";const $e=void 0,N=({width:o="100%",height:i="20px"})=>e.jsx("div",{style:{width:o,height:i,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),We=({status:o,theme:i})=>{const r={Draft:{bg:i.textMuted,text:"#fff"},Scheduled:{bg:i.warning,text:"#fff"},Sending:{bg:i.primary,text:"#fff"},Completed:{bg:i.success,text:"#fff"},Cancelled:{bg:i.danger,text:"#fff"}},l=r[o]||r.Draft;return e.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${l.bg}20`,color:l.bg,borderRadius:"20px",fontSize:"11px",fontWeight:"500"},children:o})},Me=({template:o,onSave:i,onClose:r,theme:l})=>{const[t,n]=b.useState((o==null?void 0:o.name)||""),[g,c]=b.useState((o==null?void 0:o.subject)||""),[x,a]=b.useState((o==null?void 0:o.body_html)||(o==null?void 0:o.body_text)||""),[m,y]=b.useState((o==null?void 0:o.category)||"general"),[d,j]=b.useState(!1),s=async()=>{j(!0);try{const u=await i({name:t,subject:g,body_html:x,body_text:x.replace(/<[^>]*>/g,""),category:m});r(u)}catch(u){console.error("Failed to save template:",u)}finally{j(!1)}},f=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],p=u=>{a(x+u)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:200},onClick:()=>r(null)}),e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxWidth:"95vw",maxHeight:"90vh",backgroundColor:l.bgCard,borderRadius:"16px",border:`1px solid ${l.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${l.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:l.text,margin:0},children:o?"Edit Template":"Create New Template"}),e.jsx("button",{onClick:()=>r(null),style:{background:"none",border:"none",color:l.textMuted,cursor:"pointer",fontSize:"20px"},children:"Ã—"})]}),e.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Template Name"}),e.jsx("input",{type:"text",value:t,onChange:u=>n(u.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Category"}),e.jsxs("select",{value:m,onChange:u=>y(u.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"},children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"welcome",children:"Welcome"}),e.jsx("option",{value:"renewal",children:"Renewal"}),e.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),e.jsx("option",{value:"engagement",children:"Engagement"}),e.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),e.jsx("input",{type:"text",value:g,onChange:u=>c(u.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:f.map(u=>e.jsx("button",{onClick:()=>p(u.key),style:{padding:"4px 10px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"6px",color:l.textSecondary,cursor:"pointer",fontSize:"11px"},children:u.label},u.key))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Email Body"}),e.jsx("textarea",{value:x,onChange:u=>a(u.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:10,style:{width:"100%",padding:"12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),e.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${l.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[e.jsx("button",{onClick:()=>r(null),style:{padding:"10px 20px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),e.jsx("button",{onClick:s,disabled:d||!t||!g,style:{padding:"10px 20px",backgroundColor:l.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:d?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:d||!t||!g?.6:1},children:d?"Creating...":"Create & Select"})]})]})]})},Te=({batch:o,onView:i,theme:r})=>{var t;const l=o.total_recipients>0?Math.round(o.emails_sent/o.total_recipients*100):0;return e.jsxs("div",{style:{padding:"16px",backgroundColor:r.bgCard,borderRadius:"10px",border:`1px solid ${r.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"6px"},children:[e.jsx("span",{style:{fontWeight:"600",color:r.text},children:o.name||"Untitled Batch"}),e.jsx(We,{status:o.status,theme:r})]}),e.jsx("p",{style:{fontSize:"13px",color:r.textSecondary,margin:0},children:o.subject||"No subject"}),e.jsxs("p",{style:{fontSize:"12px",color:r.textMuted,margin:"4px 0 0"},children:[((t=o.template)==null?void 0:t.name)||"Custom email"," â€¢ ",o.total_recipients||0," recipients"]})]}),o.status!=="Draft"&&e.jsxs("div",{style:{textAlign:"right",minWidth:"100px"},children:[e.jsxs("div",{style:{fontSize:"18px",fontWeight:"600",color:r.text},children:[l,"%"]}),e.jsxs("div",{style:{fontSize:"11px",color:r.textMuted},children:[o.emails_sent||0," / ",o.total_recipients||0," sent"]})]}),e.jsx("button",{onClick:()=>i(o),style:{padding:"8px 16px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.text,cursor:"pointer",fontSize:"13px"},children:"View"})]})},Be=({currentStep:o,steps:i,theme:r})=>e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"24px"},children:i.map((l,t)=>e.jsxs(D.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:t<=o?r.primary:r.bgHover,color:t<=o?"#fff":r.textMuted,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"13px",fontWeight:"600"},children:t<o?"âœ“":t+1}),e.jsx("span",{style:{fontSize:"14px",fontWeight:t===o?"600":"400",color:t<=o?r.text:r.textMuted},children:l})]}),t<i.length-1&&e.jsx("div",{style:{flex:1,height:"2px",backgroundColor:t<o?r.primary:r.border,minWidth:"40px"}})]},l))}),Ie=({selectedTemplate:o,onSelect:i,onCreateNew:r,templates:l,isLoading:t,theme:n})=>{const[g,c]=b.useState(""),x=b.useMemo(()=>l?g?l.filter(a=>a.name.toLowerCase().includes(g.toLowerCase())||a.subject.toLowerCase().includes(g.toLowerCase())):l:[],[l,g]);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Select an Email Template"}),e.jsxs("button",{onClick:r,style:{padding:"8px 16px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{children:"+"})," Create New Template"]})]}),e.jsxs("div",{style:{position:"relative",marginBottom:"16px"},children:[e.jsx("input",{type:"text",placeholder:"Search templates...",value:g,onChange:a=>c(a.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"}}),e.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:n.textMuted},children:"ðŸ”"})]}),t?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"},children:Array.from({length:4}).map((a,m)=>e.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgCard,borderRadius:"10px",border:`1px solid ${n.border}`},children:[e.jsx(N,{width:"120px",height:"16px"}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(N,{width:"200px",height:"14px"})})]},m))}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px",maxHeight:"400px",overflow:"auto"},children:x.map(a=>e.jsxs("div",{onClick:()=>i(a),style:{padding:"16px",backgroundColor:n.bgCard,borderRadius:"10px",border:`2px solid ${(o==null?void 0:o.id)===a.id?n.primary:n.border}`,cursor:"pointer",transition:"border-color 0.15s"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:n.text,marginBottom:"4px"},children:a.name}),e.jsx("div",{style:{fontSize:"13px",color:n.textSecondary},children:a.subject}),e.jsx("div",{style:{marginTop:"8px",padding:"4px 8px",backgroundColor:`${n.primary}15`,color:n.primary,borderRadius:"4px",fontSize:"11px",display:"inline-block",textTransform:"capitalize"},children:a.category||"General"})]},a.id))}),!t&&x.length===0&&e.jsx("div",{style:{textAlign:"center",padding:"40px",color:n.textMuted},children:g?"No templates match your search":"No templates available. Create one to get started!"})]})},O=[{value:"account_status",label:"Account Status",type:"select",options:[{value:"customer",label:"Customer"},{value:"prospect",label:"Prospect"},{value:"prior_customer",label:"Prior Customer"},{value:"lead",label:"Lead"}]},{value:"policy_type",label:"Policy Type",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"active_policy_type",label:"Has Active Policy",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"policy_status",label:"Policy Status",type:"select",options:[{value:"active",label:"Active"},{value:"cancelled",label:"Cancelled"},{value:"expired",label:"Expired"}]},{value:"policy_class",label:"Policy Class",type:"select",options:[{value:"Personal",label:"Personal"},{value:"Commercial",label:"Commercial"}]},{value:"policy_count",label:"Number of Policies",type:"number"},{value:"policy_effective",label:"Policy Effective Date",type:"date"},{value:"policy_expiration",label:"Policy Expiration",type:"date"},{value:"location",label:"Location",type:"location"},{value:"state",label:"State",type:"select",options:[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}]},{value:"city",label:"City",type:"text"},{value:"zip_code",label:"ZIP Code",type:"text"},{value:"email_domain",label:"Email Domain",type:"text"},{value:"last_email_sent",label:"Last Email Sent",type:"date"},{value:"account_created",label:"Account Created",type:"date"}],q={select:[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"is_any",label:"is any of"}],number:[{value:"equals",label:"equals"},{value:"greater_than",label:"greater than"},{value:"less_than",label:"less than"},{value:"at_least",label:"at least"},{value:"at_most",label:"at most"},{value:"between",label:"is between"}],date:[{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"between",label:"is between"},{value:"in_next_days",label:"is in the next"},{value:"in_last_days",label:"was in the last"}],location:[{value:"within_radius",label:"is within"}],text:[{value:"contains",label:"contains"},{value:"not_contains",label:"does not contain"},{value:"equals",label:"equals"},{value:"not_equals",label:"does not equal"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"},{value:"is_empty",label:"is empty"},{value:"is_not_empty",label:"is not empty"}]},Ae=[5,10,15,25,50,100],Le=(o,i)=>{const l=(q[o]||[]).find(t=>t.value===i);return(l==null?void 0:l.label)||i},K=o=>{const i=O.find(n=>n.value===o.field);if(!i)return null;const r=i.label,l=Le(i.type,o.operator);let t=o.value;if(i.type==="select"&&i.options)if(o.operator==="is_any")t=(o.value||"").split(",").map(g=>{const c=i.options.find(x=>x.value===g);return(c==null?void 0:c.label)||g}).join(", ");else{const n=i.options.find(g=>g.value===o.value);t=(n==null?void 0:n.label)||o.value}return o.operator==="is_empty"||o.operator==="is_not_empty"?`${r} ${l}`:o.operator==="between"&&o.value2?`${r} ${l} ${o.value} and ${o.value2}`:o.operator==="in_next_days"||o.operator==="in_last_days"?`${r} ${l} ${o.value} days`:o.operator==="within_radius"?`${r} within ${o.radius||25} miles of ${o.locationDisplay||"location"}`:`${r} ${l} ${t}`},De=({recipients:o,filterConfig:i,isLoading:r,onClose:l,theme:t})=>{var f;const[n,g]=b.useState(""),[c,x]=b.useState(1),a=20,m=(i==null?void 0:i.groups)||(((f=i==null?void 0:i.rules)==null?void 0:f.length)>0?[{rules:i.rules}]:[]),y=m.some(p=>{var u;return(u=p.rules)==null?void 0:u.some(C=>C.field&&C.operator)}),d=b.useMemo(()=>{if(!o)return[];if(!n)return o;const p=n.toLowerCase();return o.filter(u=>(u.name||"").toLowerCase().includes(p)||(u.person_email||u.email||"").toLowerCase().includes(p)||(u.primary_contact_first_name||"").toLowerCase().includes(p)||(u.primary_contact_last_name||"").toLowerCase().includes(p))},[o,n]),j=Math.ceil(d.length/a),s=d.slice((c-1)*a,c*a);return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",zIndex:1e3},onClick:l}),e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"900px",maxWidth:"95vw",maxHeight:"85vh",backgroundColor:t.bgCard,borderRadius:"16px",border:`1px solid ${t.border}`,zIndex:1001,display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${t.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"18px",fontWeight:"600",color:t.text},children:"Matching Recipients"}),e.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:t.textSecondary},children:r?"Loading...":`${d.length.toLocaleString()} accounts match your criteria`})]}),e.jsx("button",{onClick:l,style:{background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:"24px",lineHeight:1,padding:"4px"},children:"Ã—"})]}),y&&e.jsxs("div",{style:{padding:"12px 20px",backgroundColor:t.bgHover,borderBottom:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:t.textSecondary,marginBottom:"8px",textTransform:"uppercase"},children:"Active Filters"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:m.map((p,u)=>e.jsxs(D.Fragment,{children:[u>0&&e.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#f59e0b20",color:"#f59e0b",borderRadius:"4px",fontSize:"11px",fontWeight:"700"},children:"OR"}),(p.rules||[]).filter(C=>C.field&&C.operator).map((C,k)=>e.jsxs(D.Fragment,{children:[k>0&&e.jsx("span",{style:{fontSize:"11px",color:t.textMuted,alignSelf:"center"},children:"AND"}),e.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${t.primary}15`,color:t.primary,borderRadius:"4px",fontSize:"12px",fontWeight:"500"},children:K(C)})]},`${u}-${k}`))]},u))})]}),e.jsx("div",{style:{padding:"12px 20px",borderBottom:`1px solid ${t.border}`},children:e.jsx("input",{type:"text",placeholder:"Search recipients...",value:n,onChange:p=>{g(p.target.value),x(1)},style:{width:"100%",padding:"10px 12px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px"}})}),e.jsx("div",{style:{flex:1,overflow:"auto",padding:"0 20px"},children:r?e.jsx("div",{style:{padding:"40px",textAlign:"center",color:t.textMuted},children:"Loading recipients..."}):s.length===0?e.jsx("div",{style:{padding:"40px",textAlign:"center",color:t.textMuted},children:n?"No recipients match your search":"No recipients found"}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`2px solid ${t.border}`},children:[e.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:t.textSecondary,textTransform:"uppercase"},children:"Name"}),e.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:t.textSecondary,textTransform:"uppercase"},children:"Email"}),e.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:t.textSecondary,textTransform:"uppercase"},children:"Status"}),y&&m.length>0&&e.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:t.textSecondary,textTransform:"uppercase"},children:"Matched Groups"})]})}),e.jsx("tbody",{children:s.map((p,u)=>e.jsxs("tr",{style:{borderBottom:`1px solid ${t.border}`,backgroundColor:u%2===0?"transparent":t.bgHover},children:[e.jsxs("td",{style:{padding:"12px 8px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:t.text},children:p.primary_contact_first_name?`${p.primary_contact_first_name} ${p.primary_contact_last_name||""}`.trim():p.name||"N/A"}),p.name&&p.primary_contact_first_name&&e.jsx("div",{style:{fontSize:"12px",color:t.textMuted},children:p.name})]}),e.jsx("td",{style:{padding:"12px 8px",fontSize:"13px",color:t.textSecondary},children:p.person_email||p.email||"N/A"}),e.jsx("td",{style:{padding:"12px 8px"},children:e.jsx("span",{style:{padding:"3px 8px",backgroundColor:t.bgHover,color:t.text,borderRadius:"4px",fontSize:"12px",textTransform:"capitalize"},children:p.account_status||"N/A"})}),y&&m.length>0&&e.jsx("td",{style:{padding:"12px 8px"},children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[(p._matchedGroups||[]).map(C=>{var k,M;return e.jsxs("span",{style:{padding:"2px 8px",backgroundColor:`${t.success}20`,color:t.success,borderRadius:"4px",fontSize:"11px",fontWeight:"600",display:"inline-flex",alignItems:"center",gap:"4px",cursor:"help"},title:((M=(k=m[C])==null?void 0:k.rules)==null?void 0:M.filter(z=>z.field&&z.operator).map(z=>K(z)).join(" AND "))||`Group ${C+1}`,children:["Group ",C+1,e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{opacity:.7},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})]},C)}),(!p._matchedGroups||p._matchedGroups.length===0)&&e.jsx("span",{style:{fontSize:"11px",color:t.textMuted},children:m.length===0?"No filters":"All"})]})})]},p.account_unique_id||u))})]})}),j>1&&e.jsxs("div",{style:{padding:"12px 20px",borderTop:`1px solid ${t.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{fontSize:"13px",color:t.textSecondary},children:["Showing ",(c-1)*a+1,"-",Math.min(c*a,d.length)," of ",d.length]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:()=>x(p=>Math.max(1,p-1)),disabled:c===1,style:{padding:"6px 12px",backgroundColor:c===1?t.bgHover:t.bgCard,border:`1px solid ${t.border}`,borderRadius:"6px",color:c===1?t.textMuted:t.text,cursor:c===1?"not-allowed":"pointer",fontSize:"13px"},children:"Previous"}),e.jsxs("span",{style:{padding:"6px 12px",fontSize:"13px",color:t.textSecondary},children:["Page ",c," of ",j]}),e.jsx("button",{onClick:()=>x(p=>Math.min(j,p+1)),disabled:c===j,style:{padding:"6px 12px",backgroundColor:c===j?t.bgHover:t.bgCard,border:`1px solid ${t.border}`,borderRadius:"6px",color:c===j?t.textMuted:t.text,cursor:c===j?"not-allowed":"pointer",fontSize:"13px"},children:"Next"})]})]})]})]})},Ne=({lat:o,lng:i,radiusMiles:r,theme:l})=>{const t=b.useRef(null),n=b.useRef(null),g=b.useRef(null),c=b.useRef(null);b.useEffect(()=>{var m;if((m=window.google)!=null&&m.maps)a();else{const y=document.createElement("script");y.src=`https://maps.googleapis.com/maps/api/js?key=${$e}`,y.async=!0,y.defer=!0,y.onload=()=>a(),document.head.appendChild(y)}function a(){var j;if(!t.current||!((j=window.google)!=null&&j.maps))return;const y={lat:o,lng:i},d=r*1609.34;n.current=new window.google.maps.Map(t.current,{center:y,zoom:x(r),mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,styles:[{featureType:"poi",stylers:[{visibility:"off"}]}]}),g.current=new window.google.maps.Circle({map:n.current,center:y,radius:d,fillColor:l.primary,fillOpacity:.2,strokeColor:l.primary,strokeWeight:2}),c.current=new window.google.maps.Marker({map:n.current,position:y}),n.current.fitBounds(g.current.getBounds())}return()=>{g.current&&g.current.setMap(null),c.current&&c.current.setMap(null)}},[o,i,r,l.primary]);function x(a){return a<=5?12:a<=15?11:a<=25?10:a<=50?9:8}return e.jsx("div",{ref:t,style:{width:"100%",height:"100%"}})},He=({location:o,radius:i,onClose:r,theme:l})=>{if(!o)return null;const t=parseFloat(o.lat),n=parseFloat(o.lng);return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",zIndex:1e3},onClick:r}),e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"600px",maxWidth:"95vw",backgroundColor:l.bgCard,borderRadius:"16px",border:`1px solid ${l.border}`,zIndex:1001,overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${l.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:l.text},children:"Location Radius Preview"}),e.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:l.textSecondary},children:["ðŸ“ ",o.display]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsxs("div",{style:{padding:"6px 12px",backgroundColor:`${l.primary}15`,color:l.primary,borderRadius:"6px",fontWeight:"600",fontSize:"14px"},children:[i," mile radius"]}),e.jsx("button",{onClick:r,style:{background:"none",border:"none",color:l.textMuted,cursor:"pointer",fontSize:"24px",lineHeight:1},children:"Ã—"})]})]}),e.jsx("div",{style:{height:"400px"},children:e.jsx(Ne,{lat:t,lng:n,radiusMiles:i,theme:l})}),e.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${l.border}`,backgroundColor:l.bgHover,fontSize:"12px",color:l.textSecondary,textAlign:"center"},children:"Recipients within this area will be included in your campaign"})]})]})},Ee=({location:o,radius:i,theme:r})=>{const[l,t]=b.useState(!1);return o?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:"12px",borderRadius:"8px",overflow:"hidden",border:`1px solid ${r.border}`},children:e.jsxs("div",{style:{padding:"12px 16px",backgroundColor:r.bgHover,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{style:{fontSize:"20px"},children:"ðŸ“"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:r.text},children:o.display}),e.jsxs("div",{style:{fontSize:"12px",color:r.textSecondary},children:[i," mile radius"]})]})]}),e.jsx("button",{onClick:()=>t(!0),style:{padding:"8px 16px",backgroundColor:r.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"ðŸ—ºï¸ View Map"})]})}),l&&e.jsx(He,{location:o,radius:i,onClose:()=>t(!1),theme:r})]}):null},Pe=({rule:o,index:i,onUpdate:r,onRemove:l,theme:t})=>{const n=O.find(a=>a.value===o.field),g=n?q[n.type]:[],c={padding:"8px 12px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"6px",color:t.text,fontSize:"13px",minWidth:"140px"},x={padding:"8px 12px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"6px",color:t.text,fontSize:"13px",width:"120px"};return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:t.bgCard,borderRadius:"8px",border:`1px solid ${t.border}`,flexWrap:"wrap"},children:[i>0&&e.jsx("span",{style:{fontSize:"12px",color:t.primary,fontWeight:"600",padding:"4px 8px",backgroundColor:`${t.primary}15`,borderRadius:"4px"},children:"AND"}),e.jsxs("select",{value:o.field||"",onChange:a=>r(i,{...o,field:a.target.value,operator:"",value:""}),style:c,children:[e.jsx("option",{value:"",children:"Select field..."}),O.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),o.field&&e.jsxs("select",{value:o.operator||"",onChange:a=>r(i,{...o,operator:a.target.value}),style:c,children:[e.jsx("option",{value:"",children:"Select condition..."}),g.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),o.field&&o.operator&&e.jsxs(e.Fragment,{children:[(n==null?void 0:n.type)==="select"&&o.operator!=="is_any"&&e.jsxs("select",{value:o.value||"",onChange:a=>r(i,{...o,value:a.target.value}),style:c,children:[e.jsx("option",{value:"",children:"Select value..."}),n.options.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),(n==null?void 0:n.type)==="select"&&o.operator==="is_any"&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:n.options.map(a=>e.jsx("button",{onClick:()=>{const m=o.value?o.value.split(","):[],y=m.includes(a.value)?m.filter(d=>d!==a.value):[...m,a.value];r(i,{...o,value:y.join(",")})},style:{padding:"4px 10px",backgroundColor:(o.value||"").split(",").includes(a.value)?t.primary:t.bgHover,color:(o.value||"").split(",").includes(a.value)?"#fff":t.text,border:`1px solid ${(o.value||"").split(",").includes(a.value)?t.primary:t.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:a.label},a.value))}),(n==null?void 0:n.type)==="number"&&o.operator!=="between"&&e.jsx("input",{type:"number",value:o.value||"",onChange:a=>r(i,{...o,value:a.target.value}),placeholder:"0",style:x}),(n==null?void 0:n.type)==="number"&&o.operator==="between"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:o.value||"",onChange:a=>r(i,{...o,value:a.target.value}),placeholder:"Min",style:{...x,width:"80px"}}),e.jsx("span",{style:{fontSize:"13px",color:t.textSecondary},children:"and"}),e.jsx("input",{type:"number",value:o.value2||"",onChange:a=>r(i,{...o,value2:a.target.value}),placeholder:"Max",style:{...x,width:"80px"}})]}),(n==null?void 0:n.type)==="date"&&o.operator==="in_next_days"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:o.value||"",onChange:a=>r(i,{...o,value:a.target.value}),placeholder:"30",style:{...x,width:"70px"}}),e.jsx("span",{style:{fontSize:"13px",color:t.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&o.operator==="in_last_days"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:o.value||"",onChange:a=>r(i,{...o,value:a.target.value}),placeholder:"30",style:{...x,width:"70px"}}),e.jsx("span",{style:{fontSize:"13px",color:t.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&o.operator==="between"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"date",value:o.value||"",onChange:a=>r(i,{...o,value:a.target.value}),style:x}),e.jsx("span",{style:{fontSize:"13px",color:t.textSecondary},children:"and"}),e.jsx("input",{type:"date",value:o.value2||"",onChange:a=>r(i,{...o,value2:a.target.value}),style:x})]}),(n==null?void 0:n.type)==="date"&&(o.operator==="before"||o.operator==="after")&&e.jsx("input",{type:"date",value:o.value||"",onChange:a=>r(i,{...o,value:a.target.value}),style:x}),(n==null?void 0:n.type)==="text"&&!["is_empty","is_not_empty"].includes(o.operator)&&e.jsx("input",{type:"text",value:o.value||"",onChange:a=>r(i,{...o,value:a.target.value}),placeholder:`Enter ${n.label.toLowerCase()}...`,style:{...x,width:"160px"}}),(n==null?void 0:n.type)==="location"&&e.jsx(Ge,{rule:o,onUpdate:a=>r(i,{...o,...a}),theme:t})]}),e.jsx("button",{onClick:()=>l(i),style:{marginLeft:"auto",padding:"6px 10px",backgroundColor:"transparent",border:"none",color:t.textMuted,cursor:"pointer",fontSize:"16px",borderRadius:"4px"},title:"Remove filter",children:"Ã—"})]})},Ge=({rule:o,onUpdate:i,theme:r})=>{const[l,t]=b.useState(o.locationDisplay||""),[n,g]=b.useState(!1),[c,x]=b.useState([]),[a,m]=b.useState(!1),y={padding:"8px 12px",backgroundColor:r.bgInput,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.text,fontSize:"13px"},d=async s=>{if(s.length<3){x([]);return}g(!0);try{const p=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&q=${encodeURIComponent(s)}&limit=5`,{headers:{"Accept-Language":"en"}})).json();x(p.map(u=>({display:u.display_name,lat:u.lat,lng:u.lon,type:u.type}))),m(!0)}catch(f){console.error("Geocoding error:",f),x([])}finally{g(!1)}};D.useEffect(()=>{const s=setTimeout(()=>{l&&l!==o.locationDisplay&&d(l)},300);return()=>clearTimeout(s)},[l]);const j=s=>{t(s.display.split(",").slice(0,2).join(",")),i({value:`${s.lat},${s.lng}`,locationDisplay:s.display.split(",").slice(0,2).join(","),locationData:s}),m(!1)};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",flex:1,minWidth:"300px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:"200px"},children:[e.jsx("input",{type:"text",value:l,onChange:s=>t(s.target.value),onFocus:()=>c.length>0&&m(!0),placeholder:"Enter zip code, city, or address...",style:{...y,width:"100%",paddingRight:"30px"}}),n&&e.jsx("span",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:r.textMuted,fontSize:"12px"},children:"..."}),a&&c.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:r.bgCard,border:`1px solid ${r.border}`,borderRadius:"6px",marginTop:"4px",zIndex:100,maxHeight:"200px",overflow:"auto",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:c.map((s,f)=>e.jsxs("button",{onClick:()=>j(s),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderBottom:f<c.length-1?`1px solid ${r.border}`:"none",color:r.text,fontSize:"12px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"flex-start",gap:"8px"},onMouseEnter:p=>p.target.style.backgroundColor=r.bgHover,onMouseLeave:p=>p.target.style.backgroundColor="transparent",children:[e.jsx("span",{children:"ðŸ“"}),e.jsx("span",{style:{lineHeight:"1.4"},children:s.display})]},f))})]}),e.jsx("span",{style:{fontSize:"13px",color:r.textSecondary},children:"of"}),e.jsx("select",{value:o.radius||"25",onChange:s=>i({radius:s.target.value}),style:{...y,minWidth:"100px"},children:Ae.map(s=>e.jsxs("option",{value:s,children:[s," miles"]},s))})]}),o.locationData&&e.jsx(Ee,{location:o.locationData,radius:parseInt(o.radius||"25",10),theme:r})]})},Fe=({breakdown:o,isLoading:i,theme:r})=>{const[l,t]=b.useState(!1);return i?e.jsx("div",{style:{padding:"12px 16px",backgroundColor:r.bgHover,borderRadius:"8px",marginTop:"12px",fontSize:"13px",color:r.textSecondary},children:"Loading location data..."}):!o||o.byCity.length===0?null:e.jsxs("div",{style:{marginTop:"12px",backgroundColor:r.bgCard,borderRadius:"8px",border:`1px solid ${r.border}`,overflow:"hidden"},children:[e.jsxs("button",{onClick:()=>t(!l),style:{width:"100%",padding:"12px 16px",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",color:r.text},children:[e.jsx("span",{style:{fontSize:"13px",fontWeight:"500"},children:"ðŸ“Š View Recipients by City"}),e.jsx("span",{style:{fontSize:"12px",color:r.textSecondary},children:l?"â–²":"â–¼"})]}),l&&e.jsx("div",{style:{padding:"0 16px 16px"},children:e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:o.byCity.map(({city:n,count:g})=>e.jsxs("div",{style:{padding:"6px 10px",backgroundColor:r.bgHover,borderRadius:"6px",fontSize:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{color:r.text},children:n}),e.jsx("span",{style:{backgroundColor:r.primary,color:"#fff",padding:"2px 6px",borderRadius:"10px",fontSize:"11px",fontWeight:"600"},children:g})]},n))})})]})},Oe=({group:o,groupIndex:i,onUpdateGroup:r,onRemoveGroup:l,onAddRule:t,onUpdateRule:n,onRemoveRule:g,showOrLabel:c,theme:x})=>{const a=o.rules||[];return e.jsxs("div",{style:{padding:"16px",backgroundColor:x.bgCard,borderRadius:"12px",border:`2px solid ${x.border}`,position:"relative"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsxs("span",{style:{fontSize:"12px",fontWeight:"600",color:x.textSecondary,textTransform:"uppercase",letterSpacing:"0.5px"},children:["Group ",i+1]}),e.jsx("button",{onClick:()=>l(i),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:x.textMuted,cursor:"pointer",fontSize:"12px",borderRadius:"4px"},title:"Remove group",children:"Remove Group"})]}),a.length===0?e.jsx("div",{style:{textAlign:"center",padding:"12px",color:x.textMuted,fontSize:"13px"},children:"Add filters to this group"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:a.map((m,y)=>e.jsx(Pe,{rule:m,index:y,onUpdate:(d,j)=>n(i,d,j),onRemove:d=>g(i,d),theme:x},y))}),e.jsxs("button",{onClick:()=>t(i),style:{width:"100%",padding:"8px",backgroundColor:x.bgHover,border:`1px dashed ${x.border}`,borderRadius:"6px",color:x.primary,cursor:"pointer",fontSize:"12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[e.jsx("span",{children:"+"})," Add Filter to Group"]})]})},Ve=({filterConfig:o,setFilterConfig:i,recipientCount:r,isLoading:l,isFetching:t,locationBreakdown:n,isLoadingBreakdown:g,includeRoleAccounts:c,setIncludeRoleAccounts:x,roleUserCount:a,previewRecipients:m,isLoadingPreview:y,theme:d})=>{var I;const[j,s]=b.useState(!1),f=o.groups||(((I=o.rules)==null?void 0:I.length)>0?[{rules:o.rules}]:[]),p=f.length>0,u=()=>{const h=[...f,{rules:[{field:"",operator:"",value:""}]}];i({...o,groups:h,rules:void 0})},C=h=>{const S=f.filter((v,_)=>_!==h);i({...o,groups:S,rules:void 0})},k=h=>{const S=[...f];S[h]={...S[h],rules:[...S[h].rules||[],{field:"",operator:"",value:""}]},i({...o,groups:S,rules:void 0})},M=(h,S,v)=>{const _=[...f],T=[..._[h].rules||[]];T[S]=v,_[h]={..._[h],rules:T},i({...o,groups:_,rules:void 0})},z=(h,S)=>{const v=[...f];v[h]={...v[h],rules:v[h].rules.filter((_,T)=>T!==S)},v[h].rules.length===0&&v.splice(h,1),i({...o,groups:v,rules:void 0})},L=()=>{i({...o,groups:[],rules:void 0,search:""})},R=f.reduce((h,S)=>h+(S.rules||[]).filter(v=>v.field&&v.operator&&(v.value||["is_empty","is_not_empty"].includes(v.operator))).length,0);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:d.text,margin:0},children:"Filter Recipients"}),(p||o.search)&&e.jsx("button",{onClick:L,style:{padding:"6px 12px",backgroundColor:"transparent",border:`1px solid ${d.border}`,borderRadius:"6px",color:d.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Clear all"})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:d.bgCard,borderRadius:"12px",border:`1px solid ${d.border}`,marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:d.textSecondary,marginBottom:"10px"},children:"Quick Filters"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[{label:"Renewals (30 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"30"}},{label:"New Customers (90 days)",filter:{field:"account_created",operator:"in_last_days",value:"90"}},{label:"Not Emailed (30 days)",filter:{field:"last_email_sent",operator:"before",value:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0]}},{label:"Active Customers",filter:{field:"account_status",operator:"is",value:"customer"}},{label:"Cross-Sell: Auto Only",filters:[{field:"active_policy_type",operator:"is",value:"Auto"},{field:"active_policy_type",operator:"is_not",value:"Home"}]},{label:"Cross-Sell: Home Only",filters:[{field:"active_policy_type",operator:"is",value:"Home"},{field:"active_policy_type",operator:"is_not",value:"Auto"}]},{label:"Prior Customers (90 days)",filters:[{field:"account_status",operator:"is",value:"prior_customer"},{field:"last_email_sent",operator:"before",value:new Date(Date.now()-90*24*60*60*1e3).toISOString().split("T")[0]}]},{label:"Prospects (90 days)",filters:[{field:"account_status",operator:"is",value:"prospect"},{field:"last_email_sent",operator:"before",value:new Date(Date.now()-90*24*60*60*1e3).toISOString().split("T")[0]}]}].map((h,S)=>e.jsxs("button",{onClick:()=>{if(h.filters){const v={rules:h.filters};i({...o,groups:[...f,v],rules:void 0})}else{const v={rules:[h.filter]};i({...o,groups:[...f,v],rules:void 0})}},style:{padding:"6px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"16px",color:d.text,cursor:"pointer",fontSize:"12px",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:v=>{v.target.style.backgroundColor=d.primary+"20",v.target.style.borderColor=d.primary,v.target.style.color=d.primary},onMouseLeave:v=>{v.target.style.backgroundColor=d.bgHover,v.target.style.borderColor=d.border,v.target.style.color=d.text},children:["+ ",h.label]},S))})]}),e.jsx("div",{style:{padding:"16px",backgroundColor:d.bgCard,borderRadius:"12px",border:`1px solid ${d.border}`,marginBottom:"16px",display:"flex",alignItems:"center",gap:"12px"},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",flex:1},children:[e.jsx("input",{type:"checkbox",checked:c,onChange:h=>x(h.target.checked),style:{width:"18px",height:"18px",cursor:"pointer",accentColor:d.primary}}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:d.text},children:"Include accounts from users in my role"}),e.jsx("p",{style:{fontSize:"12px",color:d.textSecondary,margin:"2px 0 0"},children:c&&a>1?`Includes accounts from ${a} users with the same role`:"When enabled, includes accounts from all users with the same role as you"})]})]})}),e.jsxs("div",{style:{padding:"16px",backgroundColor:d.bgHover,borderRadius:"12px",marginBottom:"16px"},children:[p?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},children:f.map((h,S)=>e.jsxs("div",{children:[S>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"8px 0",gap:"12px"},children:[e.jsx("div",{style:{flex:1,height:"1px",backgroundColor:d.border}}),e.jsx("span",{style:{fontSize:"12px",fontWeight:"700",color:"#f59e0b",padding:"4px 12px",backgroundColor:"#f59e0b20",borderRadius:"4px",textTransform:"uppercase",letterSpacing:"1px"},children:"OR"}),e.jsx("div",{style:{flex:1,height:"1px",backgroundColor:d.border}})]}),e.jsx(Oe,{group:h,groupIndex:S,onRemoveGroup:C,onAddRule:k,onUpdateRule:M,onRemoveRule:z,showOrLabel:S>0,theme:d})]},S))}):e.jsx("div",{style:{textAlign:"center",padding:"20px",color:d.textMuted,fontSize:"14px"},children:"No filters applied. All accounts with valid emails will be included."}),e.jsx("div",{style:{display:"flex",gap:"8px"},children:e.jsxs("button",{onClick:u,style:{flex:1,padding:"10px",backgroundColor:d.bgCard,border:`1px dashed ${d.border}`,borderRadius:"8px",color:d.primary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[e.jsx("span",{children:"+"})," ",p?"Add OR Group":"Add Filter Group"]})})]}),R>0&&e.jsxs("div",{style:{padding:"12px 16px",backgroundColor:`${d.primary}10`,borderRadius:"8px",marginBottom:"16px",fontSize:"13px",color:d.text},children:[e.jsx("strong",{children:R})," filter",R!==1?"s":""," in ",e.jsx("strong",{children:f.length})," group",f.length!==1?"s":"",f.length>1&&e.jsx("span",{style:{color:d.textSecondary},children:" (groups combined with OR)"}),e.jsx("span",{style:{color:d.textSecondary},children:" â€” results update automatically"})]}),e.jsxs("button",{onClick:()=>s(!0),disabled:l||r===0,style:{width:"100%",padding:"20px",backgroundColor:`${d.primary}10`,borderRadius:"12px",border:`1px solid ${d.primary}30`,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:l||r===0?"default":"pointer",textAlign:"left",transition:"all 0.2s"},onMouseEnter:h=>{!l&&r>0&&(h.currentTarget.style.backgroundColor=`${d.primary}18`,h.currentTarget.style.borderColor=`${d.primary}50`)},onMouseLeave:h=>{h.currentTarget.style.backgroundColor=`${d.primary}10`,h.currentTarget.style.borderColor=`${d.primary}30`},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:d.text},children:"Matching Recipients"}),e.jsx("div",{style:{fontSize:"12px",color:d.textSecondary},children:t&&r!==void 0?"Updating count...":r>0?"Click to view matching accounts":"Accounts with valid emails who haven't opted out"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:d.primary,opacity:t?.6:1,transition:"opacity 0.2s"},children:l?"...":(r??0).toLocaleString()}),!l&&r>0&&e.jsx("div",{style:{padding:"6px 10px",backgroundColor:d.primary,color:"#fff",borderRadius:"6px",fontSize:"12px",fontWeight:"500"},children:"View"})]})]}),e.jsx(Fe,{breakdown:n,isLoading:g,theme:d}),j&&e.jsx(De,{recipients:m,filterConfig:o,isLoading:y,onClose:()=>s(!1),theme:d})]})},Ye=({template:o,filterConfig:i,subject:r,setSubject:l,name:t,setName:n,scheduleOption:g,setScheduleOption:c,scheduledDate:x,setScheduledDate:a,scheduledTime:m,setScheduledTime:y,recipients:d,isLoadingRecipients:j,theme:s})=>{const f=new Date().toISOString().split("T")[0];return e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:s.text,marginBottom:"16px"},children:"Review & Send"}),e.jsxs("div",{style:{padding:"20px",backgroundColor:s.bgCard,borderRadius:"12px",border:`1px solid ${s.border}`,marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:s.text,display:"block",marginBottom:"6px"},children:"Campaign Name"}),e.jsx("input",{type:"text",placeholder:"e.g., December Newsletter",value:t,onChange:p=>n(p.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:s.bgInput,border:`1px solid ${s.border}`,borderRadius:"8px",color:s.text,fontSize:"14px"}})]}),e.jsxs("div",{style:{padding:"20px",backgroundColor:s.bgCard,borderRadius:"12px",border:`1px solid ${s.border}`,marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:s.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),e.jsx("input",{type:"text",placeholder:"Email subject...",value:r,onChange:p=>l(p.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:s.bgInput,border:`1px solid ${s.border}`,borderRadius:"8px",color:s.text,fontSize:"14px"}}),e.jsxs("p",{style:{fontSize:"12px",color:s.textMuted,marginTop:"6px"},children:["Use merge fields like ","{{first_name}}"," for personalization"]})]}),e.jsxs("div",{style:{padding:"20px",backgroundColor:s.bgCard,borderRadius:"12px",border:`1px solid ${s.border}`,marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:s.text,display:"block",marginBottom:"12px"},children:"When to Send"}),e.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:[e.jsxs("button",{type:"button",onClick:()=>c("now"),style:{flex:1,padding:"12px 16px",backgroundColor:g==="now"?`${s.primary}15`:s.bgHover,border:`2px solid ${g==="now"?s.primary:s.border}`,borderRadius:"8px",color:g==="now"?s.primary:s.text,cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"18px"},children:"âš¡"}),"Send Now"]}),e.jsxs("button",{type:"button",onClick:()=>c("scheduled"),style:{flex:1,padding:"12px 16px",backgroundColor:g==="scheduled"?`${s.primary}15`:s.bgHover,border:`2px solid ${g==="scheduled"?s.primary:s.border}`,borderRadius:"8px",color:g==="scheduled"?s.primary:s.text,cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"18px"},children:"ðŸ“…"}),"Schedule for Later"]})]}),g==="scheduled"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",padding:"16px",backgroundColor:s.bgHover,borderRadius:"8px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"12px",color:s.textSecondary,display:"block",marginBottom:"6px"},children:"Date"}),e.jsx("input",{type:"date",value:x,onChange:p=>a(p.target.value),min:f,style:{width:"100%",padding:"10px 12px",backgroundColor:s.bgInput,border:`1px solid ${s.border}`,borderRadius:"8px",color:s.text,fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"12px",color:s.textSecondary,display:"block",marginBottom:"6px"},children:"Time"}),e.jsx("input",{type:"time",value:m,onChange:p=>y(p.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:s.bgInput,border:`1px solid ${s.border}`,borderRadius:"8px",color:s.text,fontSize:"14px"}})]}),e.jsx("div",{style:{gridColumn:"1 / -1"},children:e.jsx("p",{style:{fontSize:"12px",color:s.textMuted,margin:0},children:"Emails will be sent at the scheduled time in your local timezone"})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[e.jsxs("div",{style:{padding:"16px",backgroundColor:s.bgCard,borderRadius:"12px",border:`1px solid ${s.border}`},children:[e.jsx("div",{style:{fontSize:"12px",color:s.textMuted,marginBottom:"4px"},children:"Template"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:s.text},children:o==null?void 0:o.name})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:s.bgCard,borderRadius:"12px",border:`1px solid ${s.border}`},children:[e.jsx("div",{style:{fontSize:"12px",color:s.textMuted,marginBottom:"4px"},children:"Recipients"}),e.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:s.text},children:[j?"...":((d==null?void 0:d.length)||0).toLocaleString()," accounts"]})]})]}),d&&d.length>0&&e.jsxs("div",{style:{padding:"16px",backgroundColor:s.bgCard,borderRadius:"12px",border:`1px solid ${s.border}`},children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:s.text,marginBottom:"12px"},children:"Preview Recipients (first 10)"}),e.jsx("div",{style:{maxHeight:"200px",overflow:"auto"},children:d.slice(0,10).map((p,u)=>e.jsxs("div",{style:{padding:"8px 0",borderBottom:u<Math.min(9,d.length-1)?`1px solid ${s.border}`:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"13px",color:s.text},children:p.primary_contact_first_name?`${p.primary_contact_first_name} ${p.primary_contact_last_name||""}`:p.name}),e.jsx("div",{style:{fontSize:"12px",color:s.textMuted},children:p.person_email||p.email})]}),e.jsx("span",{style:{padding:"2px 8px",backgroundColor:s.bgHover,color:s.textSecondary,borderRadius:"4px",fontSize:"11px",textTransform:"capitalize"},children:p.account_status})]},p.account_unique_id))}),d.length>10&&e.jsxs("div",{style:{fontSize:"12px",color:s.textMuted,marginTop:"8px",textAlign:"center"},children:["+",d.length-10," more recipients"]})]})]})},ro=({t:o})=>{const{userId:i}=fe(),r=ve(),[l,t]=b.useState(!1),[n,g]=b.useState(!1),[c,x]=b.useState(0),[a,m]=b.useState(null),[y,d]=b.useState({rules:[],search:"",notOptedOut:!0}),[j,s]=b.useState(!1),[f,p]=b.useState(""),[u,C]=b.useState(""),[k,M]=b.useState("now"),[z,L]=b.useState(""),[R,I]=b.useState("09:00"),[h,S]=b.useState(!1),[v,_]=b.useState(null),[T,H]=b.useState(null),{data:E,isLoading:P}=Re(),B=((E==null?void 0:E.length)||0)>0,{data:U,isLoading:Z,refetch:J}=je(),{data:G,isLoading:Q,refetch:X}=Ce(),{data:F}=we(j),{data:A,isLoading:ee,isFetching:oe}=ke(c>=1?y:null,j),{data:te,isLoading:re}=ze(c>=1?y:null,j),{data:le,isLoading:ae}=Y(c>=1?y:null,{limit:500}),{data:ne,isLoading:se}=Y(c===2?y:null,{limit:100}),{createBatch:ie,scheduleBatch:de}=_e(),{createTemplate:pe}=Se(),ce=["Select Template","Filter Recipients","Review & Send"],xe=w=>{m(w),p(w.subject||"")},ue=async w=>{const W=await pe.mutateAsync(w);return await J(),W},ge=w=>{g(!1),w&&(m(w),p(w.subject||""))},he=()=>{c<2&&x(c+1)},be=()=>{c>0&&x(c-1)},ye=async()=>{if(!(!a||!f)){if(k==="scheduled"){if(!z||!R){_("Please select a date and time for the scheduled send");return}if(new Date(`${z}T${R}`)<=new Date){_("Scheduled time must be in the future");return}}S(!0),_(null);try{const w=await ie.mutateAsync({name:u||`Mass Email - ${new Date().toLocaleDateString()}`,subject:f,template_id:a.id,filter_config:y,total_recipients:A||0});let W=null;if(k==="scheduled"&&z&&R&&(W=new Date(`${z}T${R}`).toISOString()),await de.mutateAsync({batchId:w.id,scheduledFor:W}),k==="scheduled"){const me=new Date(`${z}T${R}`).toLocaleString();H(`Successfully scheduled ${A} emails for ${me}`)}else H(`Successfully scheduled ${A} emails for sending!`);t(!1),V(),X()}catch(w){_(w.message||"Failed to send mass email")}finally{S(!1)}}},V=()=>{x(0),m(null),d({rules:[],search:"",notOptedOut:!0}),s(!1),p(""),C(""),M("now"),L(""),I("09:00")},$=()=>c===0?!!a:c===1?(A||0)>0:c===2?!!f&&!!u:!1;return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:o.text,marginBottom:"4px"},children:"Mass Email"}),e.jsx("p",{style:{color:o.textSecondary,fontSize:"14px",margin:0},children:"Send one-off emails to filtered recipients"})]}),!l&&e.jsxs("button",{onClick:()=>B?t(!0):null,disabled:P||!B,title:B?"":"You need a verified sender domain to create campaigns",style:{padding:"10px 20px",backgroundColor:B?o.primary:o.textMuted,border:"none",borderRadius:"8px",color:"#fff",cursor:B?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px",opacity:P?.7:1},children:[e.jsx("span",{children:"+"})," New Campaign"]})]}),!P&&!B&&!l&&e.jsxs("div",{style:{padding:"20px",backgroundColor:`${o.warning}15`,border:`1px solid ${o.warning}30`,borderRadius:"12px",marginBottom:"24px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"600",color:o.text,marginBottom:"4px"},children:"Sender Domain Required"}),e.jsx("div",{style:{fontSize:"14px",color:o.textSecondary},children:"You need to add and verify a sender domain before you can send mass emails. This ensures emails are delivered from your agency's domain."})]}),e.jsx("button",{onClick:()=>r("/settings"),style:{padding:"10px 20px",backgroundColor:o.warning,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",whiteSpace:"nowrap"},children:"Add Domain"})]}),T&&e.jsxs("div",{style:{padding:"16px",backgroundColor:`${o.success}15`,border:`1px solid ${o.success}30`,borderRadius:"8px",marginBottom:"24px",color:o.success,fontSize:"14px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[T,e.jsx("button",{onClick:()=>H(null),style:{background:"none",border:"none",color:o.success,cursor:"pointer"},children:"Ã—"})]}),l?e.jsxs("div",{style:{backgroundColor:o.bgCard,borderRadius:"16px",border:`1px solid ${o.border}`,padding:"24px"},children:[e.jsx(Be,{currentStep:c,steps:ce,theme:o}),v&&e.jsx("div",{style:{padding:"12px 16px",backgroundColor:`${o.danger}15`,border:`1px solid ${o.danger}30`,borderRadius:"8px",marginBottom:"16px",color:o.danger,fontSize:"14px"},children:v}),e.jsxs("div",{style:{minHeight:"300px"},children:[c===0&&e.jsx(Ie,{selectedTemplate:a,onSelect:xe,onCreateNew:()=>g(!0),templates:U,isLoading:Z,theme:o}),c===1&&e.jsx(Ve,{filterConfig:y,setFilterConfig:d,recipientCount:A,isLoading:ee,isFetching:oe,locationBreakdown:te,isLoadingBreakdown:re,includeRoleAccounts:j,setIncludeRoleAccounts:s,roleUserCount:(F==null?void 0:F.length)||1,previewRecipients:le,isLoadingPreview:ae,theme:o}),c===2&&e.jsx(Ye,{template:a,filterConfig:y,subject:f,setSubject:p,name:u,setName:C,scheduleOption:k,setScheduleOption:M,scheduledDate:z,setScheduledDate:L,scheduledTime:R,setScheduledTime:I,recipients:ne,isLoadingRecipients:se,theme:o})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"24px",borderTop:`1px solid ${o.border}`,marginTop:"24px"},children:[e.jsx("button",{onClick:()=>{c===0?(t(!1),V()):be()},style:{padding:"10px 20px",backgroundColor:o.bgHover,border:`1px solid ${o.border}`,borderRadius:"8px",color:o.text,cursor:"pointer",fontSize:"14px"},children:c===0?"Cancel":"Back"}),c<2?e.jsx("button",{onClick:he,disabled:!$(),style:{padding:"10px 24px",backgroundColor:$()?o.primary:o.bgHover,border:"none",borderRadius:"8px",color:$()?"#fff":o.textMuted,cursor:$()?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500"},children:"Continue"}):e.jsx("button",{onClick:ye,disabled:!$()||h,style:{padding:"10px 24px",backgroundColor:$()&&!h?o.success:o.bgHover,border:"none",borderRadius:"8px",color:$()&&!h?"#fff":o.textMuted,cursor:$()&&!h?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px"},children:h?k==="scheduled"?"Scheduling...":"Sending...":k==="scheduled"?"Schedule Emails":"Send Emails"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:o.text,marginBottom:"16px"},children:"Recent Campaigns"}),Q?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:Array.from({length:3}).map((w,W)=>e.jsxs("div",{style:{padding:"16px",backgroundColor:o.bgCard,borderRadius:"10px",border:`1px solid ${o.border}`},children:[e.jsx(N,{width:"200px",height:"18px"}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(N,{width:"300px",height:"14px"})})]},W))}):G&&G.length>0?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:G.map(w=>e.jsx(Te,{batch:w,onView:W=>console.log("View batch:",W),theme:o},w.id))}):e.jsxs("div",{style:{padding:"60px 20px",backgroundColor:o.bgCard,borderRadius:"12px",border:`1px solid ${o.border}`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ“§"}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:o.text,marginBottom:"8px"},children:"No campaigns yet"}),e.jsx("p",{style:{fontSize:"14px",color:o.textSecondary,marginBottom:"24px"},children:"Create your first mass email campaign to reach your clients."}),e.jsx("button",{onClick:()=>t(!0),style:{padding:"10px 20px",backgroundColor:o.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Campaign"})]})]})}),n&&e.jsx(Me,{template:null,onSave:ue,onClose:ge,theme:o})]})};export{ro as default};
