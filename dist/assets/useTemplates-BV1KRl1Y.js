import{u as p,b as w,c as m}from"./query-BgC-0ePs.js";import{s as l}from"./index-laD0T8Yw.js";import{a as i,g as f,u as y}from"./useEffectiveOwner-BN9vJCNM.js";const u={async getAll(t,a={}){const{category:e,isDefault:r,search:s}=a;let n=l.from("email_templates").select("*").order("is_default",{ascending:!1}).order("name");n=i(n,t),e&&(n=n.eq("category",e)),typeof r=="boolean"&&(n=n.eq("is_default",r)),s&&(n=n.or(`name.ilike.%${s}%,subject.ilike.%${s}%`));const{data:d,error:c}=await n;if(c)throw c;return d},async getById(t,a){let e=l.from("email_templates").select("*").eq("id",a);e=i(e,t);const{data:r,error:s}=await e.single();if(s)throw s;return r},async getByDefaultKey(t,a){let e=l.from("email_templates").select("*").eq("default_key",a);e=i(e,t);const{data:r,error:s}=await e.single();if(s)throw s;return r},async create(t,a){const e=f(t),{data:r,error:s}=await l.from("email_templates").insert({owner_id:e,is_default:!1,...a}).select().single();if(s)throw s;return r},async update(t,a,e){let r=l.from("email_templates").update({...e,updated_at:new Date().toISOString()}).eq("id",a);r=i(r,t);const{data:s,error:n}=await r.select().single();if(n)throw n;return s},async delete(t,a){let e=l.from("email_templates").delete().eq("id",a).eq("is_default",!1);e=i(e,t);const{error:r}=await e;if(r)throw r;return!0},async duplicate(t,a){const e=await this.getById(t,a),r=f(t),{data:s,error:n}=await l.from("email_templates").insert({owner_id:r,is_default:!1,default_key:null,name:`${e.name} (Copy)`,subject:e.subject,body_html:e.body_html,body_text:e.body_text,category:e.category,merge_fields:e.merge_fields}).select().single();if(n)throw n;return s},async getByCategory(t,a){let e=l.from("email_templates").select("*").eq("category",a).order("is_default",{ascending:!1}).order("name");e=i(e,t);const{data:r,error:s}=await e;if(s)throw s;return r},async getCategories(t){let a=l.from("email_templates").select("category").not("category","is",null);a=i(a,t);const{data:e,error:r}=await a;if(r)throw r;return[...new Set(e.map(s=>s.category))]},async resetToDefault(t,a){return this.getById(t,a)}};function b(t={}){const{ownerIds:a,filterKey:e}=y();return p({queryKey:["templates",e,t],queryFn:()=>u.getAll(a,t),enabled:a.length>0})}function I(){const{ownerIds:t,filterKey:a}=y();return p({queryKey:["templates",a,"categories"],queryFn:()=>u.getCategories(t),enabled:t.length>0})}function T(){const{ownerIds:t,filterKey:a}=y(),e=w(),r=()=>{e.invalidateQueries({queryKey:["templates"]})},s=m({mutationFn:o=>u.create(t,o),onSuccess:r}),n=m({mutationFn:({templateId:o,updates:g})=>u.update(t,o,g),onSuccess:o=>{r(),e.setQueryData(["template",a,o.id],o)}}),d=m({mutationFn:o=>u.delete(t,o),onSuccess:r}),c=m({mutationFn:o=>u.duplicate(t,o),onSuccess:r});return{createTemplate:s,updateTemplate:n,deleteTemplate:d,duplicateTemplate:c}}export{I as a,T as b,b as u};
