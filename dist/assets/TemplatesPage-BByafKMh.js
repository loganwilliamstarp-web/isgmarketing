import{j as e}from"./query-BgC-0ePs.js";import{e as B,r as s}from"./vendor-CvdBrt7H.js";import{u as $,a as I,b as E}from"./useTemplates-BV1KRl1Y.js";import"./index-laD0T8Yw.js";import"./useEffectiveOwner-BN9vJCNM.js";import"./supabase-GtAdROLV.js";const f=({width:o="100%",height:x="20px"})=>e.jsx("div",{style:{width:o,height:x,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),M=({template:o,onSave:x,onClose:c,theme:t})=>{const[r,g]=s.useState((o==null?void 0:o.name)||""),[i,u]=s.useState((o==null?void 0:o.subject)||""),[a,d]=s.useState((o==null?void 0:o.body_html)||(o==null?void 0:o.body_text)||""),[b,h]=s.useState((o==null?void 0:o.category)||"general"),[p,y]=s.useState(!1),j=async()=>{y(!0);try{await x({name:r,subject:i,body_html:a,body_text:a.replace(/<[^>]*>/g,""),category:b}),c()}catch(l){console.error("Failed to save template:",l)}finally{y(!1)}},v=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],C=l=>{d(a+l)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:100},onClick:c}),e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxHeight:"90vh",backgroundColor:t.bgCard,borderRadius:"16px",border:`1px solid ${t.border}`,zIndex:101,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${t.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:t.text,margin:0},children:o?"Edit Template":"Create Template"}),e.jsx("button",{onClick:c,style:{background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:"20px"},children:"Ã—"})]}),e.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:t.text,display:"block",marginBottom:"6px"},children:"Template Name"}),e.jsx("input",{type:"text",value:r,onChange:l=>g(l.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:t.text,display:"block",marginBottom:"6px"},children:"Category"}),e.jsxs("select",{value:b,onChange:l=>h(l.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px"},children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"welcome",children:"Welcome"}),e.jsx("option",{value:"renewal",children:"Renewal"}),e.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),e.jsx("option",{value:"engagement",children:"Engagement"}),e.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:t.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),e.jsx("input",{type:"text",value:i,onChange:l=>u(l.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px"}})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:t.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:v.map(l=>e.jsx("button",{onClick:()=>C(l.key),style:{padding:"4px 10px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"6px",color:t.textSecondary,cursor:"pointer",fontSize:"11px"},children:l.label},l.key))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:t.text,display:"block",marginBottom:"6px"},children:"Email Body"}),e.jsx("textarea",{value:a,onChange:l=>d(l.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:12,style:{width:"100%",padding:"12px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),e.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${t.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[e.jsx("button",{onClick:c,style:{padding:"10px 20px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),e.jsx("button",{onClick:j,disabled:p||!r||!i,style:{padding:"10px 20px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:p?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:p||!r||!i?.6:1},children:p?"Saving...":o?"Save Changes":"Create Template"})]})]})]})},A=({template:o,onEdit:x,onDuplicate:c,onDelete:t,theme:r})=>{var a,d;const[g,i]=s.useState(!1),u={welcome:r.success,renewal:r.warning,cross_sell:r.primary,engagement:r.purple,policy_update:"#06b6d4",general:r.textMuted};return e.jsxs("div",{style:{padding:"20px",backgroundColor:r.bgCard,borderRadius:"12px",border:`1px solid ${r.border}`,position:"relative"},children:[e.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px"},children:[e.jsx("button",{onClick:()=>i(!g),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:r.textMuted,cursor:"pointer",fontSize:"16px"},children:"â‹®"}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,zIndex:10},onClick:()=>i(!1)}),e.jsxs("div",{style:{position:"absolute",top:"100%",right:0,backgroundColor:r.bgCard,border:`1px solid ${r.border}`,borderRadius:"8px",padding:"4px",zIndex:11,minWidth:"140px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("button",{onClick:()=>{x(o),i(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:r.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:"âœï¸ Edit"}),e.jsx("button",{onClick:()=>{c(o),i(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:r.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:"ðŸ“‹ Duplicate"}),e.jsx("button",{onClick:()=>{t(o.id),i(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:r.danger,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:"ðŸ—‘ï¸ Delete"})]})]})]}),e.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${u[o.category]||r.textMuted}15`,color:u[o.category]||r.textMuted,borderRadius:"20px",fontSize:"11px",fontWeight:"500",marginBottom:"12px",textTransform:"capitalize"},children:((a=o.category)==null?void 0:a.replace("_"," "))||"General"}),e.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:r.text,marginBottom:"6px"},children:o.name}),e.jsx("p",{style:{fontSize:"13px",color:r.textSecondary,marginBottom:"8px"},children:o.subject}),e.jsxs("p",{style:{fontSize:"12px",color:r.textMuted,marginBottom:"12px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:[(d=o.body_text)==null?void 0:d.substring(0,100),"..."]}),e.jsxs("div",{style:{display:"flex",gap:"16px",paddingTop:"12px",borderTop:`1px solid ${r.border}`,fontSize:"11px",color:r.textMuted},children:[e.jsxs("span",{children:["ðŸ“§ ",o.usage_count||0," sent"]}),e.jsxs("span",{children:["ðŸ“¬ ",o.open_rate?`${Math.round(o.open_rate)}%`:"â€”"," opens"]})]}),e.jsx("button",{onClick:()=>x(o),style:{marginTop:"12px",width:"100%",padding:"10px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"8px",color:r.text,cursor:"pointer",fontSize:"13px"},children:"Edit Template"})]})},O=({t:o})=>{const{userId:x}=B(),[c,t]=s.useState("my"),[r,g]=s.useState("all"),[i,u]=s.useState(""),[a,d]=s.useState(!1),[b,h]=s.useState(null),{data:p,isLoading:y,error:j}=$(),{data:v}=I(),{createTemplate:C,updateTemplate:l,deleteTemplate:k,duplicateTemplate:w}=E(),m=(p==null?void 0:p.filter(n=>!(r!=="all"&&n.category!==r||i&&!n.name.toLowerCase().includes(i.toLowerCase())&&!n.subject.toLowerCase().includes(i.toLowerCase()))))||[],S=()=>{h(null),d(!0)},z=n=>{h(n),d(!0)},T=async n=>{b?await l.mutateAsync({id:b.id,...n}):await C.mutateAsync(n)},R=async n=>{await w.mutateAsync(n.id)},_=async n=>{window.confirm("Are you sure you want to delete this template?")&&await k.mutateAsync(n)};return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:o.text,marginBottom:"4px"},children:"Email Templates"}),e.jsx("p",{style:{color:o.textSecondary,fontSize:"14px",margin:0},children:"Create and manage reusable email templates"})]}),e.jsxs("button",{onClick:S,style:{padding:"10px 20px",backgroundColor:o.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{children:"+"})," Create Template"]})]}),j&&e.jsx("div",{style:{padding:"16px",backgroundColor:`${o.danger}15`,border:`1px solid ${o.danger}30`,borderRadius:"8px",marginBottom:"24px",color:o.danger,fontSize:"14px"},children:"Failed to load templates. Please try refreshing the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"24px",alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"300px"},children:[e.jsx("input",{type:"text",placeholder:"Search templates...",value:i,onChange:n=>u(n.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:o.bgInput,border:`1px solid ${o.border}`,borderRadius:"8px",color:o.text,fontSize:"14px"}}),e.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:o.textMuted},children:"ðŸ”"})]}),e.jsxs("select",{value:r,onChange:n=>g(n.target.value),style:{padding:"10px 12px",backgroundColor:o.bgInput,border:`1px solid ${o.border}`,borderRadius:"8px",color:o.text,fontSize:"14px",minWidth:"150px"},children:[e.jsx("option",{value:"all",children:"All Categories"}),e.jsx("option",{value:"welcome",children:"Welcome"}),e.jsx("option",{value:"renewal",children:"Renewal"}),e.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),e.jsx("option",{value:"engagement",children:"Engagement"}),e.jsx("option",{value:"policy_update",children:"Policy Update"}),e.jsx("option",{value:"general",children:"General"})]}),e.jsxs("span",{style:{fontSize:"13px",color:o.textMuted},children:[m.length," template",m.length!==1?"s":""]})]}),y?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:Array.from({length:6}).map((n,W)=>e.jsxs("div",{style:{padding:"20px",backgroundColor:o.bgCard,borderRadius:"12px",border:`1px solid ${o.border}`},children:[e.jsx(f,{width:"80px",height:"20px"}),e.jsx("div",{style:{marginTop:"12px"},children:e.jsx(f,{width:"180px",height:"18px"})}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(f,{width:"220px",height:"14px"})}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(f,{height:"40px"})})]},W))}):m.length>0?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:m.map(n=>e.jsx(A,{template:n,onEdit:z,onDuplicate:R,onDelete:_,theme:o},n.id))}):e.jsxs("div",{style:{padding:"60px 20px",backgroundColor:o.bgCard,borderRadius:"12px",border:`1px solid ${o.border}`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ“"}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:o.text,marginBottom:"8px"},children:i||r!=="all"?"No templates found":"No templates yet"}),e.jsx("p",{style:{fontSize:"14px",color:o.textSecondary,marginBottom:"24px"},children:i||r!=="all"?"Try adjusting your search or filter criteria.":"Create your first email template to get started."}),!i&&r==="all"&&e.jsx("button",{onClick:S,style:{padding:"10px 20px",backgroundColor:o.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Template"})]}),a&&e.jsx(M,{template:b,onSave:T,onClose:()=>d(!1),theme:o})]})};export{O as default};
