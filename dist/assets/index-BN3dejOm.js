import{Q as ss,u as ye,a as ii,b as de,j as n,c as as}from"./query-BHFOmHtL.js";import{a as ls,u as ge,L as tt,b as ft,r as O,R as Fe,c as ho,d as ds,g as cs,B as us,e as fo,f as je}from"./vendor-fFS1ukCR.js";import{c as ps}from"./supabase-GtAdROLV.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))l(d);new MutationObserver(d=>{for(const u of d)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&l(p)}).observe(document,{childList:!0,subtree:!0});function r(d){const u={};return d.integrity&&(u.integrity=d.integrity),d.referrerPolicy&&(u.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?u.credentials="include":d.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function l(d){if(d.ep)return;d.ep=!0;const u=r(d);fetch(d.href,u)}})();var qi={},so=ls;qi.createRoot=so.createRoot,qi.hydrateRoot=so.hydrateRoot;var hs=function(){return null};const fs=new ss({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*30,retry:1,refetchOnWindowFocus:!0,refetchOnMount:!0},mutations:{retry:0}}}),xs=void 0,ms=void 0;throw new Error("Missing Supabase environment variables");const T=ps(xs,ms),pt={async getAll(i,s={}){const{category:r,isDefault:l,search:d}=s;let u=T.from("email_templates").select("*").eq("owner_id",i).order("is_default",{ascending:!1}).order("name");r&&(u=u.eq("category",r)),typeof l=="boolean"&&(u=u.eq("is_default",l)),d&&(u=u.or(`name.ilike.%${d}%,subject.ilike.%${d}%`));const{data:p,error:f}=await u;if(f)throw f;return p},async getById(i,s){const{data:r,error:l}=await T.from("email_templates").select("*").eq("owner_id",i).eq("id",s).single();if(l)throw l;return r},async getByDefaultKey(i,s){const{data:r,error:l}=await T.from("email_templates").select("*").eq("owner_id",i).eq("default_key",s).single();if(l)throw l;return r},async create(i,s){const{data:r,error:l}=await T.from("email_templates").insert({owner_id:i,is_default:!1,...s}).select().single();if(l)throw l;return r},async update(i,s,r){const{data:l,error:d}=await T.from("email_templates").update({...r,updated_at:new Date().toISOString()}).eq("owner_id",i).eq("id",s).select().single();if(d)throw d;return l},async delete(i,s){const{error:r}=await T.from("email_templates").delete().eq("owner_id",i).eq("id",s).eq("is_default",!1);if(r)throw r;return!0},async duplicate(i,s){const r=await this.getById(i,s),{data:l,error:d}=await T.from("email_templates").insert({owner_id:i,is_default:!1,default_key:null,name:`${r.name} (Copy)`,subject:r.subject,body_html:r.body_html,body_text:r.body_text,category:r.category,merge_fields:r.merge_fields}).select().single();if(d)throw d;return l},async getByCategory(i,s){const{data:r,error:l}=await T.from("email_templates").select("*").eq("owner_id",i).eq("category",s).order("is_default",{ascending:!1}).order("name");if(l)throw l;return r},async getCategories(i){const{data:s,error:r}=await T.from("email_templates").select("category").eq("owner_id",i).not("category","is",null);if(r)throw r;return[...new Set(s.map(l=>l.category))]},async resetToDefault(i,s){return this.getById(i,s)}},$i=()=>{const{userId:i}=ge();return i};function xo(i={}){const s=$i();return ye({queryKey:["templates",s,i],queryFn:()=>pt.getAll(s,i),enabled:!!s})}function gs(){const i=$i();return ye({queryKey:["templates",i,"categories"],queryFn:()=>pt.getCategories(i),enabled:!!i})}function mo(){const i=$i(),s=ii(),r=()=>{s.invalidateQueries({queryKey:["templates",i]})},l=de({mutationFn:f=>pt.create(i,f),onSuccess:r}),d=de({mutationFn:({templateId:f,updates:m})=>pt.update(i,f,m),onSuccess:f=>{r(),s.setQueryData(["template",i,f.id],f)}}),u=de({mutationFn:f=>pt.delete(i,f),onSuccess:r}),p=de({mutationFn:f=>pt.duplicate(i,f),onSuccess:r});return{createTemplate:l,updateTemplate:d,deleteTemplate:u,duplicateTemplate:p}}const Ce={async getAll(i,s={}){const{status:r,category:l,search:d}=s;let u=T.from("automations").select(`
        *,
        _count:automation_enrollments(count)
      `).eq("owner_id",i).order("is_default",{ascending:!1}).order("name");r&&(u=u.eq("status",r)),l&&(u=u.eq("category",l)),d&&(u=u.or(`name.ilike.%${d}%,description.ilike.%${d}%`));const{data:p,error:f}=await u;if(f)throw f;return p},async getAllWithStats(i){const{data:s,error:r}=await T.from("automations").select("*").eq("owner_id",i).order("is_default",{ascending:!1}).order("name");if(r)throw r;const l=s.map(f=>f.id),{data:d,error:u}=await T.from("automation_enrollments").select("automation_id, status").in("automation_id",l);if(u)throw u;const p={};return d.forEach(f=>{p[f.automation_id]||(p[f.automation_id]={total:0,active:0,completed:0,exited:0}),p[f.automation_id].total++,p[f.automation_id][f.status.toLowerCase()]++}),s.map(f=>({...f,enrollmentStats:p[f.id]||{total:0,active:0,completed:0,exited:0}}))},async getById(i,s){const{data:r,error:l}=await T.from("automations").select("*").eq("owner_id",i).eq("id",s).single();if(l)throw l;return r},async getByIdWithDetails(i,s){const r=await this.getById(i,s),{data:l,error:d}=await T.from("automation_enrollments").select("status").eq("automation_id",s);if(d)throw d;const u={total:l.length,active:l.filter(x=>x.status==="Active").length,completed:l.filter(x=>x.status==="Completed").length,exited:l.filter(x=>x.status==="Exited").length,paused:l.filter(x=>x.status==="Paused").length},{data:p,error:f}=await T.from("email_logs").select("status, open_count, click_count").eq("automation_id",s);if(f)throw f;const m={sent:p.length,delivered:p.filter(x=>x.status==="Delivered"||x.status==="Opened"||x.status==="Clicked").length,opened:p.filter(x=>x.open_count>0).length,clicked:p.filter(x=>x.click_count>0).length,bounced:p.filter(x=>x.status==="Bounced").length};return{...r,enrollmentStats:u,emailSummary:m}},async getByDefaultKey(i,s){const{data:r,error:l}=await T.from("automations").select("*").eq("owner_id",i).eq("default_key",s).single();if(l)throw l;return r},async create(i,s){const{data:r,error:l}=await T.from("automations").insert({owner_id:i,is_default:!1,status:"Draft",...s}).select().single();if(l)throw l;return r},async update(i,s,r){const{data:l,error:d}=await T.from("automations").update({...r,updated_at:new Date().toISOString()}).eq("owner_id",i).eq("id",s).select().single();if(d)throw d;return l},async updateStatus(i,s,r){return this.update(i,s,{status:r})},async activate(i,s){return this.updateStatus(i,s,"active")},async pause(i,s){return this.updateStatus(i,s,"paused")},async archive(i,s){return this.updateStatus(i,s,"archived")},async delete(i,s){const{error:r}=await T.from("automations").delete().eq("owner_id",i).eq("id",s).eq("is_default",!1);if(r)throw r;return!0},async duplicate(i,s){const r=await this.getById(i,s),{data:l,error:d}=await T.from("automations").insert({owner_id:i,is_default:!1,default_key:null,name:`${r.name} (Copy)`,description:r.description,category:r.category,status:"Draft",send_time:r.send_time,timezone:r.timezone,frequency:r.frequency,max_enrollments:r.max_enrollments,enrollment_cooldown_days:r.enrollment_cooldown_days,distribute_evenly:r.distribute_evenly,filter_config:r.filter_config,nodes:r.nodes}).select().single();if(d)throw d;return l},async updateFilters(i,s,r){return this.update(i,s,{filter_config:r})},async updateNodes(i,s,r){return this.update(i,s,{nodes:r})},async updateSchedule(i,s,r){const{sendTime:l,timezone:d,frequency:u}=r;return this.update(i,s,{send_time:l,timezone:d,frequency:u})},async updateEnrollmentRules(i,s,r){const{maxEnrollments:l,cooldownDays:d,distributeEvenly:u}=r;return this.update(i,s,{max_enrollments:l,enrollment_cooldown_days:d,distribute_evenly:u})},async getByStatus(i,s){const{data:r,error:l}=await T.from("automations").select("*").eq("owner_id",i).eq("status",s).order("name");if(l)throw l;return r},async getActive(i){return this.getByStatus(i,"Active")},async getCategories(i){const{data:s,error:r}=await T.from("automations").select("category").eq("owner_id",i).not("category","is",null);if(r)throw r;return[...new Set(s.map(l=>l.category))]}},Fi=()=>{const{userId:i}=ge();return i};function _s(){const i=Fi();return ye({queryKey:["automations",i,"withStats"],queryFn:()=>Ce.getAllWithStats(i),enabled:!!i})}function ys(i){const s=Fi();return ye({queryKey:["automation",s,i],queryFn:()=>Ce.getById(s,i),enabled:!!s&&!!i})}function go(){const i=Fi(),s=ii(),r=()=>{s.invalidateQueries({queryKey:["automations",i]})},l=de({mutationFn:S=>Ce.create(i,S),onSuccess:r}),d=de({mutationFn:({automationId:S,updates:j})=>Ce.update(i,S,j),onSuccess:S=>{r(),s.setQueryData(["automation",i,S.id],S)}}),u=de({mutationFn:S=>Ce.delete(i,S),onSuccess:r}),p=de({mutationFn:S=>Ce.duplicate(i,S),onSuccess:r}),f=de({mutationFn:S=>Ce.activate(i,S),onSuccess:S=>{r(),s.setQueryData(["automation",i,S.id],S)}}),m=de({mutationFn:S=>Ce.pause(i,S),onSuccess:S=>{r(),s.setQueryData(["automation",i,S.id],S)}}),x=de({mutationFn:S=>Ce.archive(i,S),onSuccess:r}),M=de({mutationFn:({automationId:S,filterConfig:j})=>Ce.updateFilters(i,S,j),onSuccess:S=>{s.setQueryData(["automation",i,S.id],S)}}),w=de({mutationFn:({automationId:S,nodes:j})=>Ce.updateNodes(i,S,j),onSuccess:S=>{s.setQueryData(["automation",i,S.id],S)}}),I=de({mutationFn:({automationId:S,scheduleConfig:j})=>Ce.updateSchedule(i,S,j),onSuccess:S=>{s.setQueryData(["automation",i,S.id],S)}}),P=de({mutationFn:({automationId:S,rules:j})=>Ce.updateEnrollmentRules(i,S,j),onSuccess:S=>{s.setQueryData(["automation",i,S.id],S)}});return{createAutomation:l,updateAutomation:d,deleteAutomation:u,duplicateAutomation:p,activateAutomation:f,pauseAutomation:m,archiveAutomation:x,updateFilters:M,updateNodes:w,updateSchedule:I,updateEnrollmentRules:P}}const vs={async getByAutomation(i,s={}){const{status:r,limit:l=50,offset:d=0}=s;let u=T.from("automation_enrollments").select(`
        *,
        account:accounts(
          account_unique_id,
          name,
          person_email,
          email,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("automation_id",i).order("enrolled_at",{ascending:!1}).range(d,d+l-1);r&&(u=u.eq("status",r));const{data:p,error:f}=await u;if(f)throw f;return p},async getByAccount(i,s={}){const{status:r}=s;let l=T.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category, status)
      `).eq("account_id",i).order("enrolled_at",{ascending:!1});r&&(l=l.eq("status",r));const{data:d,error:u}=await l;if(u)throw u;return d},async getById(i){const{data:s,error:r}=await T.from("automation_enrollments").select(`
        *,
        account:accounts(*),
        automation:automations(*)
      `).eq("id",i).single();if(r)throw r;return s},async getStats(i){const{data:s,error:r}=await T.from("automation_enrollments").select("status, emails_sent, emails_opened, emails_clicked").eq("automation_id",i);if(r)throw r;const l={total:s.length,active:0,completed:0,exited:0,paused:0,totalEmailsSent:0,totalOpens:0,totalClicks:0};return s.forEach(d=>{l[d.status.toLowerCase()]++,l.totalEmailsSent+=d.emails_sent||0,l.totalOpens+=d.emails_opened||0,l.totalClicks+=d.emails_clicked||0}),l},async canEnroll(i,s){const{data:r,error:l}=await T.rpc("can_enroll_in_automation",{p_account_id:i,p_automation_id:s});if(l)throw l;return r},async enroll(i,s,r={}){var x;if(!await this.canEnroll(s,i))throw new Error("Account cannot be enrolled in this automation");const{data:d,error:u}=await T.from("automations").select("nodes").eq("id",i).single();if(u)throw u;const p=(x=d.nodes)==null?void 0:x[0],{data:f,error:m}=await T.from("automation_enrollments").insert({automation_id:i,account_id:s,status:"Active",current_node_id:(p==null?void 0:p.id)||null,metadata:r}).select().single();if(m)throw m;return f},async bulkEnroll(i,s){const r={enrolled:[],skipped:[],errors:[]};for(const l of s)try{if(await this.canEnroll(l,i)){const u=await this.enroll(i,l);r.enrolled.push(u)}else r.skipped.push(l)}catch(d){r.errors.push({accountId:l,error:d.message})}return r},async exit(i,s="manual"){const{data:r,error:l}=await T.from("automation_enrollments").update({status:"Exited",exit_reason:s,exited_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",i).select().single();if(l)throw l;return r},async pause(i){const{data:s,error:r}=await T.from("automation_enrollments").update({status:"Paused",updated_at:new Date().toISOString()}).eq("id",i).select().single();if(r)throw r;return s},async resume(i){const{data:s,error:r}=await T.from("automation_enrollments").update({status:"Active",updated_at:new Date().toISOString()}).eq("id",i).select().single();if(r)throw r;return s},async complete(i){const{data:s,error:r}=await T.from("automation_enrollments").update({status:"Completed",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",i).select().single();if(r)throw r;return s},async updateProgress(i,s,r=null){const{data:l,error:d}=await T.from("automation_enrollments").update({current_node_id:s,current_branch:r,last_action_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",i).select().single();if(d)throw d;return l},async setNextAction(i,s){const{data:r,error:l}=await T.from("automation_enrollments").update({next_action_at:s,updated_at:new Date().toISOString()}).eq("id",i).select().single();if(l)throw l;return r},async incrementEmailSent(i){const{data:s,error:r}=await T.rpc("increment_enrollment_email_sent",{p_enrollment_id:i});if(r){const{data:l}=await T.from("automation_enrollments").select("emails_sent").eq("id",i).single();return T.from("automation_enrollments").update({emails_sent:((l==null?void 0:l.emails_sent)||0)+1}).eq("id",i)}return s},async getReadyForAction(){const{data:i,error:s}=await T.from("automation_enrollments").select(`
        *,
        automation:automations(*),
        account:accounts(*)
      `).eq("status","Active").lte("next_action_at",new Date().toISOString()).order("next_action_at");if(s)throw s;return i},async getHistory(i){const{data:s,error:r}=await T.from("enrollment_history").select(`
        *,
        email_log:email_logs(id, subject, status, sent_at, first_opened_at, first_clicked_at)
      `).eq("enrollment_id",i).order("created_at",{ascending:!0});if(r)throw r;return s},async logHistory(i,s){const{data:r,error:l}=await T.from("enrollment_history").insert({enrollment_id:i,...s}).select().single();if(l)throw l;return r}};function bs(i,s={}){return ye({queryKey:["enrollments","account",i,s],queryFn:()=>vs.getByAccount(i,s),enabled:!!i,staleTime:3e4})}const ei={async getAll(i,s={}){const{status:r,automationId:l,accountId:d,limit:u=50,offset:p=0,startDate:f,endDate:m}=s;let x=T.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email, primary_contact_first_name),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",i).order("created_at",{ascending:!1}).range(p,p+u-1);r&&(x=x.eq("status",r)),l&&(x=x.eq("automation_id",l)),d&&(x=x.eq("account_id",d)),f&&(x=x.gte("sent_at",f)),m&&(x=x.lte("sent_at",m));const{data:M,error:w}=await x;if(w)throw w;return M},async getById(i,s){const{data:r,error:l}=await T.from("email_logs").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name),
        enrollment:automation_enrollments(id, status)
      `).eq("owner_id",i).eq("id",s).single();if(l)throw l;return r},async getByIdWithEvents(i,s){const r=await this.getById(i,s),{data:l,error:d}=await T.from("email_events").select("*").eq("email_log_id",s).order("event_timestamp",{ascending:!0});if(d)throw d;return{...r,events:l}},async getByAccount(i,s,r={}){const{limit:l=20}=r,{data:d,error:u}=await T.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",i).eq("account_id",s).order("created_at",{ascending:!1}).limit(l);if(u)throw u;return d},async getByAutomation(i,s,r={}){const{limit:l=50,offset:d=0,status:u}=r;let p=T.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",i).eq("automation_id",s).order("created_at",{ascending:!1}).range(d,d+l-1);u&&(p=p.eq("status",u));const{data:f,error:m}=await p;if(m)throw m;return f},async create(i,s){const{data:r,error:l}=await T.from("email_logs").insert({owner_id:i,status:"Queued",...s}).select().single();if(l)throw l;return r},async updateStatus(i,s,r,l={}){const{data:d,error:u}=await T.from("email_logs").update({status:r,...l,updated_at:new Date().toISOString()}).eq("owner_id",i).eq("id",s).select().single();if(u)throw u;return d},async markSent(i,s,r){return this.updateStatus(i,s,"Sent",{sent_at:new Date().toISOString(),sendgrid_message_id:r})},async markFailed(i,s,r,l=null){return this.updateStatus(i,s,"Failed",{failed_at:new Date().toISOString(),error_message:r,error_code:l})},async getRecentOpens(i,s=10){const{data:r,error:l}=await T.from("email_logs").select(`
        id, subject, first_opened_at, open_count,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",i).not("first_opened_at","is",null).order("first_opened_at",{ascending:!1}).limit(s);if(l)throw l;return r},async getRecentClicks(i,s=10){const{data:r,error:l}=await T.from("email_logs").select(`
        id, subject, first_clicked_at, click_count,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",i).not("first_clicked_at","is",null).order("first_clicked_at",{ascending:!1}).limit(s);if(l)throw l;return r},async getBounces(i,s={}){const{limit:r=50,offset:l=0}=s,{data:d,error:u}=await T.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",i).eq("status","Bounced").order("bounced_at",{ascending:!1}).range(l,l+r-1);if(u)throw u;return d},async getStats(i,s,r,l=null){const{data:d,error:u}=await T.rpc("get_email_stats",{p_owner_id:i,p_start_date:s,p_end_date:r,p_automation_id:l});if(u)throw u;return(d==null?void 0:d[0])||{total_sent:0,total_delivered:0,total_opened:0,unique_opens:0,total_clicked:0,unique_clicks:0,total_bounced:0,open_rate:0,click_rate:0}},async getDailyStats(i,s,r,l=null){let d=T.from("email_stats_daily").select("*").eq("owner_id",i).gte("stat_date",s).lte("stat_date",r).order("stat_date");l?d=d.eq("automation_id",l):d=d.is("automation_id",null);const{data:u,error:p}=await d;if(p)throw p;return u},async getComparisonStats(i,s=30){const r=new Date,l=new Date(r);l.setDate(l.getDate()-s);const d=new Date(l);d.setDate(d.getDate()-s);const[u,p]=await Promise.all([this.getStats(i,l.toISOString().split("T")[0],r.toISOString().split("T")[0]),this.getStats(i,d.toISOString().split("T")[0],l.toISOString().split("T")[0])]),f=(m,x)=>x===0?m>0?100:0:((m-x)/x*100).toFixed(1);return{current:u,previous:p,changes:{sent:f(u.total_sent,p.total_sent),delivered:f(u.total_delivered,p.total_delivered),opened:f(u.unique_opens,p.unique_opens),clicked:f(u.unique_clicks,p.unique_clicks),bounced:f(u.total_bounced,p.total_bounced)}}}},ws=()=>{const{userId:i}=ge();return i};function Ss(i,s={}){const r=ws();return ye({queryKey:["emailLogs",r,"account",i,s],queryFn:()=>ei.getByAccount(r,i,s),enabled:!!r&&!!i,staleTime:3e4})}const _o={async getRecent(i,s={}){const{category:r,limit:l=20,offset:d=0}=s;let u=T.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name),
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).eq("owner_id",i).order("created_at",{ascending:!1}).range(d,d+l-1);r&&(u=u.eq("event_category",r));const{data:p,error:f}=await u;if(f)throw f;return p},async getByAccount(i,s,r=20){const{data:l,error:d}=await T.from("activity_log").select(`
        *,
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).eq("owner_id",i).eq("account_id",s).order("created_at",{ascending:!1}).limit(r);if(d)throw d;return l},async getByAutomation(i,s,r=50){const{data:l,error:d}=await T.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("owner_id",i).eq("automation_id",s).order("created_at",{ascending:!1}).limit(r);if(d)throw d;return l},async getByType(i,s,r={}){const{limit:l=50,offset:d=0}=r,{data:u,error:p}=await T.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("owner_id",i).eq("event_type",s).order("created_at",{ascending:!1}).range(d,d+l-1);if(p)throw p;return u},async log(i,s){const{data:r,error:l}=await T.from("activity_log").insert({owner_id:i,...s}).select().single();if(l)throw l;return r},async logEmailSent(i,s,r,l=null){return this.log(i,{event_type:"email_sent",event_category:"email",title:"Email sent",email_log_id:s,account_id:r,automation_id:l,actor_type:l?"automation":"user"})},async logEmailOpened(i,s,r){return this.log(i,{event_type:"email_opened",event_category:"email",title:"Email opened",email_log_id:s,account_id:r,actor_type:"system"})},async logEmailClicked(i,s,r,l=null){return this.log(i,{event_type:"email_clicked",event_category:"email",title:"Email link clicked",email_log_id:s,account_id:r,actor_type:"system",event_data:l?{url:l}:{}})},async logEnrollment(i,s,r,l){return this.log(i,{event_type:"enrollment_created",event_category:"automation",title:`Enrolled in ${l}`,automation_id:s,account_id:r,actor_type:"automation"})},async logAutomationCompleted(i,s,r,l){return this.log(i,{event_type:"automation_completed",event_category:"automation",title:`Completed ${l}`,automation_id:s,account_id:r,actor_type:"automation"})},async logUnsubscribe(i,s,r,l=null){return this.log(i,{event_type:"unsubscribed",event_category:"account",title:r==="all"?"Unsubscribed from all emails":"Unsubscribed from automation",account_id:s,automation_id:l,actor_type:"system",severity:"warning"})},async logBounce(i,s,r,l){return this.log(i,{event_type:"email_bounced",event_category:"email",title:`Email bounced (${l})`,email_log_id:s,account_id:r,actor_type:"system",severity:"warning",event_data:{bounce_type:l}})},async getStats(i,s=7){const r=new Date;r.setDate(r.getDate()-s);const{data:l,error:d}=await T.from("activity_log").select("event_type, event_category").eq("owner_id",i).gte("created_at",r.toISOString());if(d)throw d;const u={total:l.length,byType:{},byCategory:{}};return l.forEach(p=>{u.byType[p.event_type]=(u.byType[p.event_type]||0)+1,u.byCategory[p.event_category]=(u.byCategory[p.event_category]||0)+1}),u}},yo={async getAll(i,s={}){const{status:r,automationId:l,limit:d=50,offset:u=0}=s;let p=T.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",i).order("scheduled_for",{ascending:!0}).range(u,u+d-1);r&&(p=p.eq("status",r)),l&&(p=p.eq("automation_id",l));const{data:f,error:m}=await p;if(m)throw m;return f},async getUpcoming(i,s=10){const{data:r,error:l}=await T.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        automation:automations(id, name)
      `).eq("owner_id",i).eq("status","Pending").gte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0}).limit(s);if(l)throw l;return r},async getReadyToSend(){const{data:i,error:s}=await T.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name, owner_id)
      `).eq("status","Pending").lte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0});if(s)throw s;return i},async getById(i,s){const{data:r,error:l}=await T.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name)
      `).eq("owner_id",i).eq("id",s).single();if(l)throw l;return r},async create(i,s){const{data:r,error:l}=await T.from("scheduled_emails").insert({owner_id:i,status:"Pending",...s}).select().single();if(l)throw l;return r},async createBatch(i,s){const r=s.map(u=>({owner_id:i,status:"Pending",...u})),{data:l,error:d}=await T.from("scheduled_emails").insert(r).select();if(d)throw d;return l},async update(i,s,r){const{data:l,error:d}=await T.from("scheduled_emails").update({...r,updated_at:new Date().toISOString()}).eq("owner_id",i).eq("id",s).select().single();if(d)throw d;return l},async cancel(i,s){return this.update(i,s,{status:"Cancelled"})},async reschedule(i,s,r){return this.update(i,s,{scheduled_for:r,status:"Pending",attempts:0})},async markProcessing(i){const{data:s,error:r}=await T.from("scheduled_emails").update({status:"Processing",last_attempt_at:new Date().toISOString(),attempts:T.sql`attempts + 1`,updated_at:new Date().toISOString()}).eq("id",i).select().single();if(r)throw r;return s},async markSent(i,s){const{data:r,error:l}=await T.from("scheduled_emails").update({status:"Sent",email_log_id:s,updated_at:new Date().toISOString()}).eq("id",i).select().single();if(l)throw l;return r},async markFailed(i,s){const{data:r,error:l}=await T.from("scheduled_emails").select("attempts, max_attempts").eq("id",i).single();if(l)throw l;const d=r.attempts<r.max_attempts,{data:u,error:p}=await T.from("scheduled_emails").update({status:d?"Pending":"Failed",error_message:s,updated_at:new Date().toISOString()}).eq("id",i).select().single();if(p)throw p;return u},async delete(i,s){const{error:r}=await T.from("scheduled_emails").delete().eq("owner_id",i).eq("id",s);if(r)throw r;return!0},async getStats(i){const{data:s,error:r}=await T.from("scheduled_emails").select("status, scheduled_for").eq("owner_id",i);if(r)throw r;const l=new Date,d={pending:0,processing:0,sent:0,failed:0,cancelled:0,upcomingToday:0,upcomingThisWeek:0},u=new Date(l);u.setHours(23,59,59,999);const p=new Date(l);return p.setDate(p.getDate()+7),s.forEach(f=>{if(d[f.status.toLowerCase()]++,f.status==="Pending"){const m=new Date(f.scheduled_for);m<=u&&d.upcomingToday++,m<=p&&d.upcomingThisWeek++}}),d}},Rt={async getAll(i,s={}){const{status:r,search:l,limit:d=25,offset:u=0,expiring:p=!1}=s;let f=T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",i);if(r){let q=r;r.toLowerCase()==="prior"&&(q="prior_customer"),f=f.ilike("account_status",q)}l&&(f=f.or(`name.ilike.%${l}%,person_email.ilike.%${l}%,email.ilike.%${l}%`));const{count:m,error:x}=await f;if(x)throw x;let M=T.from("accounts").select("*").eq("owner_id",i).order("name").range(u,u+d-1);if(r){let q=r;r.toLowerCase()==="prior"&&(q="prior_customer"),M=M.ilike("account_status",q)}l&&(M=M.or(`name.ilike.%${l}%,person_email.ilike.%${l}%,email.ilike.%${l}%`));const{data:w,error:I}=await M;if(I)throw I;if(!w||w.length===0)return{accounts:[],total:m||0};const P=w.map(q=>q.account_unique_id).filter(Boolean),j=new Date().toISOString().split("T")[0],C=new Date;C.setDate(C.getDate()+30);const b=C.toISOString().split("T")[0];if(P.length>0){const{data:q,error:Z}=await T.from("policies").select("account_id, policy_lob, policy_status, expiration_date").in("account_id",P);if(!Z&&q){const E={};q.forEach(k=>{var V;E[k.account_id]||(E[k.account_id]=[]);const D=k.expiration_date&&k.expiration_date>=j&&k.expiration_date<=b;E[k.account_id].push({policy_type:k.policy_lob,status:((V=k.policy_status)==null?void 0:V.toLowerCase())||"unknown",expiration_date:k.expiration_date,is_expiring:D})}),w.forEach(k=>{k.policies=E[k.account_unique_id]||[],k.policy_count=k.policies.length,k.has_expiring_policy=k.policies.some(D=>D.is_expiring),k.expiring_policy_count=k.policies.filter(D=>D.is_expiring).length})}}if(p){const q=w.filter(Z=>Z.has_expiring_policy);return{accounts:q,total:q.length,isExpiringFilter:!0}}return{accounts:w,total:m||0}},async getStats(i){const{count:s,error:r}=await T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",i);if(r)throw r;const{count:l}=await T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",i).ilike("account_status","customer"),{count:d}=await T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",i).ilike("account_status","prospect"),{count:u}=await T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",i).ilike("account_status","prior_customer"),{count:p}=await T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",i).ilike("account_status","lead");let f=0;const m=new Date().toISOString().split("T")[0],x=new Date;x.setDate(x.getDate()+30);const M=x.toISOString().split("T")[0],{count:w}=await T.from("policies").select("*",{count:"exact",head:!0}).gte("expiration_date",m).lte("expiration_date",M);if(w&&w>0){const{data:I}=await T.from("policies").select("account_id").gte("expiration_date",m).lte("expiration_date",M).limit(5e3);if(I&&I.length>0){const P=[...new Set(I.map(S=>S.account_id).filter(Boolean))];if(P.length>0){let S=0;const j=100;for(let C=0;C<P.length;C+=j){const b=P.slice(C,C+j),{count:q}=await T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",i).in("account_unique_id",b);S+=q||0}f=S}}}return{Customer:l||0,Prospect:d||0,Prior:u||0,Lead:p||0,total:s||0,expiring:f}},async getById(i){const{data:s,error:r}=await T.from("accounts").select("*").eq("account_unique_id",i).single();if(r)throw r;return s},async getByIdWithPolicies(i){const{data:s,error:r}=await T.from("accounts").select("*").eq("account_unique_id",i).single();if(r)throw r;if(!s)return null;const{data:l,error:d}=await T.from("policies").select("*").eq("account_id",i).order("expiration_date",{ascending:!1});if(d)return console.error("Error fetching policies:",d),{...s,policies:[]};if(l&&l.length>0){const u=[...new Set(l.map(p=>p.carrier_id).filter(Boolean))];if(u.length>0){const{data:p,error:f}=await T.from("carriers").select("id, name").in("id",u);if(p&&p.length>0){const m={};p.forEach(x=>{m[x.id]=x.name}),l.forEach(x=>{x.carrier_id&&m[x.carrier_id]&&(x.carrier={name:m[x.carrier_id]})})}}}return{...s,policies:l||[]}},async getByIdWithEmailHistory(i,s){const r=await this.getByIdWithPolicies(s),{data:l,error:d}=await T.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",i).eq("account_id",s).order("created_at",{ascending:!1}).limit(20);if(d)throw d;const{data:u,error:p}=await T.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category)
      `).eq("account_id",s).order("enrolled_at",{ascending:!1});if(p)throw p;return{...r,emailLogs:l,enrollments:u}},async search(i,s,r=20){const{data:l,error:d}=await T.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name").eq("owner_id",i).or(`name.ilike.%${s}%,person_email.ilike.%${s}%,email.ilike.%${s}%,primary_contact_first_name.ilike.%${s}%,primary_contact_last_name.ilike.%${s}%`).limit(r);if(d)throw d;return l},async getByStatus(i,s,r={}){const{limit:l=50,offset:d=0}=r,{data:u,error:p}=await T.from("accounts").select("*").eq("owner_id",i).eq("account_status",s).order("name").range(d,d+l-1);if(p)throw p;return u},async getCustomers(i,s={}){return this.getByStatus(i,"customer",s)},async getProspects(i,s={}){return this.getByStatus(i,"prospect",s)},async getPriorCustomers(i,s={}){return this.getByStatus(i,"prior_customer",s)},async getWithExpiringPolicies(i,s=45){const r=new Date;r.setDate(r.getDate()+s);const{data:l,error:d}=await T.from("policies").select(`
        policy_unique_id,
        policy_lob,
        expiration_date,
        policy_status,
        account_id,
        account:accounts!policies_account_id_fkey(
          account_unique_id,
          name,
          person_email,
          email,
          owner_id,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("policy_status","Active").lte("expiration_date",r.toISOString().split("T")[0]).gte("expiration_date",new Date().toISOString().split("T")[0]).order("expiration_date");if(d)throw d;return l.filter(u=>{var p;return((p=u.account)==null?void 0:p.owner_id)===i})},async getCounts(i){const{data:s,error:r}=await T.from("accounts").select("account_status").eq("owner_id",i);if(r)throw r;const l={total:s.length,customer:0,prospect:0,prior_customer:0,other:0};return s.forEach(d=>{var p;const u=((p=d.account_status)==null?void 0:p.toLowerCase().replace(" ","_"))||"other";l[u]!==void 0?l[u]++:l.other++}),l},getEmail(i){return i.person_email||i.email},getDisplayName(i){return i.primary_contact_first_name?`${i.primary_contact_first_name} ${i.primary_contact_last_name||""}`.trim():i.name},canReceiveMarketing(i){return i.user_subscribed_to_marketing!==!1&&i.person_has_opted_out_of_email!==!0&&(i.person_email||i.email)},async getEligibleForAutomation(i,s){let r=T.from("accounts").select("*").eq("owner_id",i).or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false").not("person_email","is",null);const{data:l,error:d}=await r;if(d)throw d;const u=l.map(x=>x.account_unique_id),{data:p,error:f}=await T.from("policies").select("*").in("account_id",u);if(f)throw f;return l.map(x=>({...x,policies:p.filter(M=>M.account_id===x.account_unique_id)})).filter(x=>this.canReceiveMarketing(x))}},vo={async getDashboardData(i,s={}){const{days:r=30}=s,[l,d,u,p,f,m,x]=await Promise.all([ei.getComparisonStats(i,r),_o.getRecent(i,{limit:10}),yo.getUpcoming(i,5),ei.getRecentOpens(i,5),ei.getRecentClicks(i,5),Rt.getCounts(i),this.getAutomationStats(i)]);return{emailStats:l.current,emailChanges:l.changes,recentActivity:d,scheduledEmails:u,recentOpens:p,recentClicks:f,accountCounts:m,automationStats:x}},async getAutomationStats(i){const{data:s,error:r}=await T.from("automations").select(`
        id,
        name,
        status,
        stats
      `).eq("owner_id",i).eq("status","Active");if(r)throw r;const l=s.map(f=>f.id),{data:d,error:u}=await T.from("automation_enrollments").select("automation_id, status").in("automation_id",l);if(u)throw u;const p={};return d.forEach(f=>{p[f.automation_id]||(p[f.automation_id]={active:0,total:0}),p[f.automation_id].total++,f.status==="Active"&&p[f.automation_id].active++}),{total:s.length,active:s.filter(f=>f.status==="Active").length,automations:s.map(f=>{var m,x;return{...f,enrollmentCount:((m=p[f.id])==null?void 0:m.total)||0,activeEnrollments:((x=p[f.id])==null?void 0:x.active)||0}})}},async getEmailPerformanceOverTime(i,s=30){const r=new Date;r.setDate(r.getDate()-s);const{data:l,error:d}=await T.from("email_stats_daily").select("*").eq("owner_id",i).is("automation_id",null).gte("stat_date",r.toISOString().split("T")[0]).order("stat_date");if(d)throw d;return l},async getTopAutomations(i,s=5){const{data:r,error:l}=await T.from("automations").select("id, name, stats").eq("owner_id",i).eq("status","Active");if(l)throw l;return r.map(u=>{var p,f,m,x,M;return{...u,sent:((p=u.stats)==null?void 0:p.sent)||0,opened:((f=u.stats)==null?void 0:f.opened)||0,clicked:((m=u.stats)==null?void 0:m.clicked)||0,openRate:((x=u.stats)==null?void 0:x.sent)>0?(((M=u.stats)==null?void 0:M.opened)||0)/u.stats.sent*100:0}}).sort((u,p)=>p.openRate-u.openRate).slice(0,s)},async getAccountsNeedingAttention(i){const{data:s,error:r}=await T.from("email_logs").select(`
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",i).eq("status","Bounced").not("account_id","is",null).limit(10);if(r)throw r;const l=await Rt.getWithExpiringPolicies(i,30);return{bouncedEmails:s.map(d=>d.account).filter((d,u,p)=>p.findIndex(f=>f.account_unique_id===d.account_unique_id)===u),expiringPolicies:l.slice(0,10)}},async getQuickStats(i){const s=new Date().toISOString().split("T")[0],r=new Date;r.setDate(r.getDate()-30);const[{count:l},{count:d},{count:u},{count:p}]=await Promise.all([T.from("email_logs").select("*",{count:"exact",head:!0}).eq("owner_id",i).gte("sent_at",s),T.from("email_logs").select("*",{count:"exact",head:!0}).eq("owner_id",i).gte("first_opened_at",s),T.from("automations").select("*",{count:"exact",head:!0}).eq("owner_id",i).eq("status","Active"),T.from("scheduled_emails").select("*",{count:"exact",head:!0}).eq("owner_id",i).eq("status","Pending")]);return{emailsToday:l||0,opensToday:d||0,activeAutomations:u||0,pendingScheduled:p||0}}},bo=()=>{const{userId:i}=ge();return i};function wo(){const i=bo();return ye({queryKey:["dashboard",i,"quick"],queryFn:()=>vo.getQuickStats(i),enabled:!!i,staleTime:1e4,refetchInterval:3e4})}function js(i=30){const s=bo();return ye({queryKey:["dashboard",s,"performance",i],queryFn:()=>vo.getEmailPerformanceOverTime(s,i),enabled:!!s})}const ut={async get(i){const{data:s,error:r}=await T.from("user_settings").select("*").eq("user_id",i).single();if(r&&r.code!=="PGRST116")throw r;return s},async getWithUser(i){const{data:s,error:r}=await T.from("user_settings").select(`
        *,
        user:users(user_unique_id, email, first_name, last_name, role_name, profile_name)
      `).eq("user_id",i).single();if(r&&r.code!=="PGRST116")throw r;return s},async create(i,s={}){const{data:r,error:l}=await T.from("user_settings").insert({user_id:i,...s}).select().single();if(l)throw l;return r},async update(i,s){const{data:r,error:l}=await T.from("user_settings").update({...s,updated_at:new Date().toISOString()}).eq("user_id",i).select().single();if(l)throw l;return r},async updateSignature(i,s){const{signatureName:r,signatureTitle:l,signaturePhone:d,signatureEmail:u,signatureMessage:p}=s;return this.update(i,{signature_name:r,signature_title:l,signature_phone:d,signature_email:u,signature_message:p})},async updateAgencyInfo(i,s){const{agencyName:r,agencyAddress:l,agencyPhone:d,agencyWebsite:u}=s;return this.update(i,{agency_name:r,agency_address:l,agency_phone:d,agency_website:u})},async updateEmailSettings(i,s){const{fromName:r,fromEmail:l,replyToEmail:d,defaultSendTime:u,timezone:p,dailySendLimit:f}=s;return this.update(i,{from_name:r,from_email:l,reply_to_email:d,default_send_time:u,timezone:p,daily_send_limit:f})},async updatePreferences(i,s){const r=await this.get(i);return this.update(i,{preferences:{...r==null?void 0:r.preferences,...s}})},async getSignatureHtml(i){const s=await this.get(i);if(!s)return"";const{signature_name:r,signature_title:l,signature_phone:d,signature_email:u,signature_message:p}=s;let f='<table style="margin-top: 20px; font-family: Arial, sans-serif;">';return f+="<tr><td>",r&&(f+=`<strong style="font-size: 14px;">${r}</strong><br>`),l&&(f+=`<span style="color: #666;">${l}</span><br>`),d&&(f+=`<span>${d}</span><br>`),u&&(f+=`<a href="mailto:${u}" style="color: #0066cc;">${u}</a><br>`),p&&(f+=`<p style="margin-top: 10px; font-style: italic; color: #666;">${p}</p>`),f+="</td></tr></table>",f},async getUnsubscribeFooterHtml(i,s,r=null){const l=await this.get(i),d="https://your-app.com",u=`${d}/unsubscribe?type=automation&id=${s}&aid=${r}`,p=`${d}/unsubscribe?type=all&id=${s}`;let f=`
      <table style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; width: 100%; font-family: Arial, sans-serif;">
        <tr>
          <td style="text-align: center; font-size: 12px; color: #666;">
    `;return r&&(f+=`<a href="${u}" style="color: #666;">Unsubscribe from these emails</a> &nbsp;|&nbsp; `),f+=`<a href="${p}" style="color: #666;">Unsubscribe from all emails</a>`,(l!=null&&l.agency_name||l!=null&&l.agency_address)&&(f+="<br><br>",l.agency_name&&(f+=l.agency_name),l.agency_address&&(f+=` | ${l.agency_address}`)),f+=`
          </td>
        </tr>
      </table>
    `,f}},So=()=>{const{userId:i}=ge();return i};function Cs(){const i=So();return ye({queryKey:["userSettings",i],queryFn:()=>ut.get(i),enabled:!!i})}function ks(){const i=So(),s=ii(),r=()=>{s.invalidateQueries({queryKey:["userSettings",i]})},l=de({mutationFn:m=>ut.update(i,m),onSuccess:r}),d=de({mutationFn:m=>ut.updateSignature(i,m),onSuccess:r}),u=de({mutationFn:m=>ut.updateAgencyInfo(i,m),onSuccess:r}),p=de({mutationFn:m=>ut.updateEmailSettings(i,m),onSuccess:r}),f=de({mutationFn:m=>ut.updatePreferences(i,m),onSuccess:r});return{updateSettings:l,updateSignature:d,updateAgencyInfo:u,updateEmailSettings:p,updatePreferences:f}}const jo=()=>{const{userId:i}=ge();return i};function zs(i={}){const s=jo();return ye({queryKey:["accounts",s,i],queryFn:()=>Rt.getAll(s,i),enabled:!!s,staleTime:3e4})}function Ts(i){return ye({queryKey:["account",i,"policies"],queryFn:()=>Rt.getByIdWithPolicies(i),enabled:!!i,staleTime:3e4})}function Ps(){const i=jo();return ye({queryKey:["accounts",i,"stats"],queryFn:()=>Rt.getStats(i),enabled:!!i})}const Ls=()=>{const{userId:i}=ge();return i};function Rs(i,s=20){const r=Ls();return ye({queryKey:["activity",r,"account",i],queryFn:()=>_o.getByAccount(r,i,s),enabled:!!r&&!!i,staleTime:3e4})}const Ms=()=>{const{userId:i}=ge();return i};function Is(i=10){const s=Ms();return ye({queryKey:["scheduledEmails",s,"upcoming",i],queryFn:()=>yo.getUpcoming(s,i),enabled:!!s})}const As=(i,s,r,l)=>{const u=(r-i)*Math.PI/180,p=(l-s)*Math.PI/180,f=Math.sin(u/2)*Math.sin(u/2)+Math.cos(i*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(p/2)*Math.sin(p/2);return 3959*(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)))},ht={},Co=i=>new Promise(s=>setTimeout(s,i)),ao=async(i,s,r=5e3)=>{const l=new AbortController,d=setTimeout(()=>l.abort(),r);try{const u=await fetch(i,{...s,signal:l.signal});return clearTimeout(d),u}catch(u){throw clearTimeout(d),u}},Es=async(i,s=!1)=>{var r;if(ht[i])return ht[i];try{const d=await(await ao(`https://photon.komoot.io/api/?q=${encodeURIComponent(i)}&limit=1&lang=en`,{},3e3)).json();if(((r=d==null?void 0:d.features)==null?void 0:r.length)>0){const u=d.features[0].geometry.coordinates,p={lat:u[1],lng:u[0]};return ht[i]=p,p}}catch{}try{s||await Co(100);const d=await(await ao(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&q=${encodeURIComponent(i)}&limit=1`,{headers:{"User-Agent":"ISGMarketing/1.0"}},3e3)).json();if(d&&d.length>0){const u={lat:parseFloat(d[0].lat),lng:parseFloat(d[0].lon)};return ht[i]=u,u}}catch(l){l.name!=="AbortError"&&console.error("Geocoding error:",l)}return null},Bs=async(i,s=10)=>{const r={},l=[...new Set(i.filter(Boolean))],d=[];for(const u of l)ht[u]?r[u]=ht[u]:d.push(u);if(d.length===0)return r;for(let u=0;u<d.length;u+=s){const p=d.slice(u,u+s),f=await Promise.all(p.map(m=>Es(m,!0)));p.forEach((m,x)=>{f[x]&&(r[m]=f[x])}),u+s<d.length&&await Co(100)}return r},Ge={async getAll(i,s={}){const{status:r,limit:l=50,offset:d=0}=s;let u=T.from("mass_email_batches").select(`
        *,
        template:email_templates(id, name, subject)
      `).eq("owner_id",i).order("created_at",{ascending:!1}).range(d,d+l-1);r&&(u=u.eq("status",r));const{data:p,error:f}=await u;if(f)throw f;return p},async getById(i,s){const{data:r,error:l}=await T.from("mass_email_batches").select(`
        *,
        template:email_templates(*)
      `).eq("owner_id",i).eq("id",s).single();if(l)throw l;return r},async create(i,s){const{data:r,error:l}=await T.from("mass_email_batches").insert({owner_id:i,status:"Draft",...s}).select().single();if(l)throw l;return r},async update(i,s,r){const{data:l,error:d}=await T.from("mass_email_batches").update({...r,updated_at:new Date().toISOString()}).eq("owner_id",i).eq("id",s).select().single();if(d)throw d;return l},async delete(i,s){const{error:r}=await T.from("mass_email_batches").delete().eq("owner_id",i).eq("id",s).eq("status","Draft");if(r)throw r;return!0},async getRecipients(i,s,r={}){const{limit:l=100,offset:d=0}=r,{rules:u=[],notOptedOut:p=!0,search:f=""}=s||{},m=u.filter(E=>E.field==="account_status"&&E.value),x=u.filter(E=>E.field==="policy_type"&&E.value),M=u.filter(E=>E.field==="policy_count"&&E.value),w=u.filter(E=>E.field==="policy_expiration"&&E.value),I=u.filter(E=>E.field==="location"&&E.value),P=u.filter(E=>E.field==="state"&&E.value),S=u.filter(E=>E.field==="city"&&E.value);let j=T.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name, person_has_opted_out_of_email, billing_city, billing_state, billing_postal_code, billing_street").eq("owner_id",i);if(m.length>0){const E=m[0];if(E.operator==="is")j=j.eq("account_status",E.value);else if(E.operator==="is_not")j=j.neq("account_status",E.value);else if(E.operator==="is_any"){const k=E.value.split(",").filter(D=>D);k.length>0&&(j=j.in("account_status",k))}}p&&(j=j.or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false")),f&&(j=j.or(`name.ilike.%${f}%,person_email.ilike.%${f}%,email.ilike.%${f}%`)),j=j.order("name").range(d,d+l-1);const{data:C,error:b}=await j;if(b)throw b;let q=C.filter(E=>{const k=E.person_email||E.email;return k&&k.includes("@")});if((x.length>0||M.length>0||w.length>0)&&q.length>0){const E=q.map(K=>K.account_unique_id),{data:k,error:D}=await T.from("policies").select("account_id, policy_lob, expiration_date, policy_status").in("account_id",E);if(D)throw D;const V={};k.forEach(K=>{V[K.account_id]||(V[K.account_id]=[]),V[K.account_id].push(K)}),q=q.filter(K=>{const ae=V[K.account_unique_id]||[];for(const _ of M){const z=ae.length,B=parseInt(_.value,10);if(_.operator==="equals"&&z!==B||_.operator==="greater_than"&&z<=B||_.operator==="less_than"&&z>=B||_.operator==="at_least"&&z<B)return!1}for(const _ of x){const z=_.operator==="is_any"?_.value.split(","):[_.value],B=ae.some(R=>z.some($=>{var U;return(U=R.policy_lob)==null?void 0:U.toLowerCase().includes($.toLowerCase())}));if(_.operator==="is"&&!B||_.operator==="is_any"&&!B||_.operator==="is_not"&&B)return!1}const X=new Date().toISOString().split("T")[0];for(const _ of w)if(_.operator==="in_next_days"){const z=parseInt(_.value,10),B=new Date;B.setDate(B.getDate()+z);const R=B.toISOString().split("T")[0];if(!ae.some(U=>U.expiration_date&&U.expiration_date>=X&&U.expiration_date<=R))return!1}else if(_.operator==="before"){if(!ae.some(B=>B.expiration_date&&B.expiration_date<_.value))return!1}else if(_.operator==="after"){if(!ae.some(B=>B.expiration_date&&B.expiration_date>_.value))return!1}else if(_.operator==="between"&&!ae.some(B=>B.expiration_date&&B.expiration_date>=_.value&&B.expiration_date<=(_.value2||_.value)))return!1;return!0})}if(P.length>0&&q.length>0&&(q=q.filter(E=>{for(const k of P){const D=(E.billing_state||"").toUpperCase();if(k.operator==="is"){if(D!==k.value.toUpperCase())return!1}else if(k.operator==="is_not"){if(D===k.value.toUpperCase())return!1}else if(k.operator==="is_any"&&!k.value.split(",").map(K=>K.toUpperCase()).includes(D))return!1}return!0})),S.length>0&&q.length>0&&(q=q.filter(E=>{for(const k of S){const D=(E.billing_city||"").toLowerCase(),V=(k.value||"").toLowerCase();if(k.operator==="contains"){if(!D.includes(V))return!1}else if(k.operator==="equals"){if(D!==V)return!1}else if(k.operator==="starts_with"&&!D.startsWith(V))return!1}return!0})),I.length>0&&q.length>0)for(const E of I){const[k,D]=E.value.split(",").map(parseFloat),V=parseInt(E.radius||"25",10),K={};q.forEach(_=>{const z=(_.billing_postal_code||"").trim(),B=(_.billing_city||"").trim(),R=(_.billing_state||"").trim();let $="";z&&R?$=`${z}, ${R}, USA`:B&&R?$=`${B}, ${R}, USA`:z&&($=`${z}, USA`),$&&(K[_.account_unique_id]=$)});const ae=[...new Set(Object.values(K))],X=await Bs(ae);q=q.filter(_=>{const z=K[_.account_unique_id];if(!z)return!1;const B=X[z];return B?As(k,D,B.lat,B.lng)<=V:!1})}return q},async getRecipientStats(i,s){const{rules:r=[],notOptedOut:l=!0,search:d=""}=s||{},u=r.filter(C=>C.field==="policy_type"&&C.value),p=r.filter(C=>C.field==="policy_count"&&C.value),f=r.filter(C=>C.field==="policy_expiration"&&C.value),m=r.filter(C=>C.field==="location"&&C.value),x=r.filter(C=>C.field==="city"&&C.value),M=u.length>0||p.length>0||f.length>0||m.length>0||x.length>0;let w,I;if(M)w=await this.getRecipients(i,s,{limit:1e4}),I=w.length;else{let C=T.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",i),b=T.from("accounts").select("billing_city, billing_state").eq("owner_id",i);const q=r.filter(D=>D.field==="account_status"&&D.value);if(q.length>0){const D=q[0];if(D.operator==="is")C=C.eq("account_status",D.value),b=b.eq("account_status",D.value);else if(D.operator==="is_not")C=C.neq("account_status",D.value),b=b.neq("account_status",D.value);else if(D.operator==="is_any"){const V=D.value.split(",").filter(K=>K);V.length>0&&(C=C.in("account_status",V),b=b.in("account_status",V))}}const Z=r.filter(D=>D.field==="state"&&D.value);if(Z.length>0){const D=Z[0];if(D.operator==="is")C=C.ilike("billing_state",D.value),b=b.ilike("billing_state",D.value);else if(D.operator==="is_not")C=C.not("billing_state","ilike",D.value),b=b.not("billing_state","ilike",D.value);else if(D.operator==="is_any"){const V=D.value.split(",").filter(K=>K);V.length>0&&(C=C.in("billing_state",V),b=b.in("billing_state",V))}}l&&(C=C.or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false"),b=b.or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false")),d&&(C=C.or(`name.ilike.%${d}%,person_email.ilike.%${d}%,email.ilike.%${d}%`));const[E,k]=await Promise.all([C,b]);if(E.error)throw E.error;if(k.error)throw k.error;I=E.count||0,w=k.data||[]}const P={},S=C=>C?C.toLowerCase().replace(/\b\w/g,b=>b.toUpperCase()):"";w.forEach(C=>{const b=(C.billing_state||"").trim(),q=(C.billing_city||"").trim();if(q&&b){const Z=S(q),E=b.length===2?b.toUpperCase():S(b),k=`${Z}, ${E}`;P[k]=(P[k]||0)+1}});const j=Object.entries(P).map(([C,b])=>({city:C,count:b})).sort((C,b)=>b.count-C.count).slice(0,10);return{count:I,breakdown:{total:w.length,byCity:j}}},async countRecipients(i,s){return(await this.getRecipientStats(i,s)).count},async getRecipientLocationBreakdown(i,s){return(await this.getRecipientStats(i,s)).breakdown},async scheduleBatch(i,s,r=null){const l=await this.getById(i,s);if(!l)throw new Error("Batch not found");if(l.status!=="Draft")throw new Error("Can only schedule draft batches");const d=await this.getRecipients(i,l.filter_config,{limit:1e4});if(d.length===0)throw new Error("No recipients match the filter");const u=r||new Date().toISOString(),p=d.map(x=>({owner_id:i,account_id:x.account_unique_id,template_id:l.template_id,recipient_email:x.person_email||x.email,recipient_name:x.primary_contact_first_name?`${x.primary_contact_first_name} ${x.primary_contact_last_name||""}`.trim():x.name,subject:l.subject,scheduled_for:u,status:"Pending",batch_id:s})),f=100;let m=0;for(let x=0;x<p.length;x+=f){const M=p.slice(x,x+f),{data:w,error:I}=await T.from("scheduled_emails").insert(M).select();if(I)throw I;m+=w.length}return await this.update(i,s,{status:r?"Scheduled":"Sending",total_recipients:d.length,scheduled_for:u,started_at:r?null:new Date().toISOString()}),{scheduled:m,total:d.length,scheduledFor:u}},async cancelBatch(i,s){await this.update(i,s,{status:"Cancelled"});const{error:r}=await T.from("scheduled_emails").update({status:"Cancelled"}).eq("owner_id",i).eq("batch_id",s).eq("status","Pending");if(r)throw r;return!0},async getBatchStats(i,s){const{data:r,error:l}=await T.from("scheduled_emails").select("status").eq("owner_id",i).eq("batch_id",s);if(l)throw l;const d={pending:0,sent:0,failed:0,cancelled:0,total:r.length};return r.forEach(u=>{const p=u.status.toLowerCase();d[p]!==void 0&&d[p]++}),d},async getAllWithStats(i,s={}){const r=await this.getAll(i,s);return await Promise.all(r.map(async d=>{if(d.status==="Draft")return{...d,stats:null};const u=await this.getBatchStats(i,d.id);return{...d,stats:u}}))}},ni=()=>{const{userId:i}=ge();return i};function Os(i={}){const s=ni();return ye({queryKey:["massEmails",s,"withStats",i],queryFn:()=>Ge.getAllWithStats(s,i),enabled:!!s})}function Ds(i,s={}){const r=ni();return ye({queryKey:["massEmailRecipients",r,i,s],queryFn:()=>Ge.getRecipients(r,i,s),enabled:!!r&&!!i})}function ko(i){var l;const s=ni(),r=i?{rules:(l=i.rules)==null?void 0:l.map(d=>({field:d.field,operator:d.operator,value:d.value,value2:d.value2,radius:d.radius})),search:i.search,notOptedOut:i.notOptedOut}:null;return ye({queryKey:["massEmailRecipientStats",s,r],queryFn:()=>Ge.getRecipientStats(s,i),enabled:!!s&&!!i,staleTime:3e4,gcTime:6e4,placeholderData:d=>d})}function Ws(i){const{data:s,isLoading:r,isFetching:l,error:d}=ko(i);return{data:s==null?void 0:s.count,isLoading:r,isFetching:l,error:d}}function qs(i){const{data:s,isLoading:r,isFetching:l,error:d}=ko(i);return{data:s==null?void 0:s.breakdown,isLoading:r,isFetching:l,error:d}}function Ns(){const i=ni(),s=ii(),r=()=>{s.invalidateQueries({queryKey:["massEmails",i]})},l=de({mutationFn:m=>Ge.create(i,m),onSuccess:r}),d=de({mutationFn:({batchId:m,updates:x})=>Ge.update(i,m,x),onSuccess:r}),u=de({mutationFn:m=>Ge.delete(i,m),onSuccess:r}),p=de({mutationFn:({batchId:m,scheduledFor:x})=>Ge.scheduleBatch(i,m,x),onSuccess:()=>{r(),s.invalidateQueries({queryKey:["scheduledEmails",i]})}}),f=de({mutationFn:m=>Ge.cancelBatch(i,m),onSuccess:()=>{r(),s.invalidateQueries({queryKey:["scheduledEmails",i]})}});return{createBatch:l,updateBatch:d,deleteBatch:u,scheduleBatch:p,cancelBatch:f}}const et=({width:i="100%",height:s="20px"})=>n.jsx("div",{style:{width:i,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite"}}),Jt=({label:i,value:s,change:r,icon:l,positive:d,isLoading:u,theme:p})=>n.jsxs("div",{style:{padding:"20px",backgroundColor:p.bgCard,borderRadius:"12px",border:`1px solid ${p.border}`},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[n.jsx("span",{style:{color:p.textSecondary,fontSize:"13px"},children:i}),n.jsx("span",{style:{fontSize:"20px"},children:l})]}),u?n.jsx(et,{height:"32px",width:"80px"}):n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:p.text,marginBottom:"4px"},children:s}),r&&n.jsx("span",{style:{fontSize:"12px",color:d?p.success:p.danger},children:r})]})]}),Zs=({email:i,theme:s,userId:r})=>{var l,d,u;return n.jsx("div",{style:{padding:"14px",backgroundColor:s.bg,borderRadius:"8px",border:`1px solid ${s.border}`},children:n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[n.jsxs("div",{children:[n.jsxs("div",{style:{fontSize:"11px",color:s.textMuted,marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[n.jsx("span",{children:""})," ",new Date(i.scheduled_for).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]}),n.jsx(tt,{to:`/${r}/clients/${i.account_id}`,style:{fontSize:"14px",fontWeight:"600",color:s.text,textDecoration:"none"},children:((l=i.accounts)==null?void 0:l.name)||"Unknown Account"}),n.jsx("div",{style:{fontSize:"12px",color:s.textSecondary,marginTop:"2px"},children:((d=i.email_templates)==null?void 0:d.subject)||"No subject"}),n.jsx("span",{style:{display:"inline-block",marginTop:"6px",padding:"3px 8px",backgroundColor:s.bgHover,borderRadius:"4px",fontSize:"11px",color:s.textSecondary},children:((u=i.email_templates)==null?void 0:u.name)||"Unknown Template"})]}),n.jsxs("div",{style:{display:"flex",gap:"6px"},children:[n.jsx("button",{style:{padding:"6px 10px",backgroundColor:s.bgHover,border:`1px solid ${s.border}`,borderRadius:"6px",color:s.textSecondary,cursor:"pointer",fontSize:"12px"},children:""}),n.jsx("button",{style:{padding:"6px 10px",backgroundColor:s.bgHover,border:`1px solid ${s.border}`,borderRadius:"6px",color:s.textSecondary,cursor:"pointer",fontSize:"12px"},children:""})]})]})})},$s=({label:i,you:s,avg:r,theme:l})=>n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[n.jsx("span",{style:{fontSize:"12px",color:l.textSecondary},children:i}),n.jsxs("span",{style:{fontSize:"12px",color:l.textMuted},children:[s,"% vs ",r,"%"]})]}),n.jsxs("div",{style:{display:"flex",gap:"4px",height:"24px"},children:[n.jsx("div",{style:{width:`${Math.min(s,100)}%`,backgroundColor:l.primary,borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:n.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[s,"%"]})}),n.jsx("div",{style:{width:`${Math.min(r,100)}%`,backgroundColor:"#14b8a6",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:n.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[r,"%"]})})]})]}),lo=({t:i})=>{const{userId:s}=ge(),{data:r,isLoading:l,error:d}=wo(),{data:u,isLoading:p}=Is(7),{data:f,isLoading:m}=js(30),x=[{label:"Open Rate",you:(r==null?void 0:r.openRate)||0,avg:32},{label:"Click Rate",you:(r==null?void 0:r.clickRate)||0,avg:8},{label:"Response Rate",you:(r==null?void 0:r.responseRate)||8,avg:5}],M=I=>I>=1e3?`${(I/1e3).toFixed(1)}k`:(I==null?void 0:I.toLocaleString())||"0",w=I=>`${Math.round(I||0)}%`;return n.jsxs("div",{children:[n.jsxs("div",{style:{marginBottom:"24px"},children:[n.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:i.text,marginBottom:"4px"},children:"Dashboard"}),n.jsx("p",{style:{color:i.textSecondary,fontSize:"14px",margin:0},children:"Overview of your email campaigns and performance"})]}),d&&n.jsx("div",{style:{padding:"16px",backgroundColor:`${i.danger}15`,border:`1px solid ${i.danger}30`,borderRadius:"8px",marginBottom:"24px",color:i.danger,fontSize:"14px"},children:"Failed to load dashboard data. Please try refreshing the page."}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"24px"},children:[n.jsx(Jt,{label:"Emails Sent",value:M(r==null?void 0:r.emailsSent),change:r!=null&&r.emailsSentChange?`${r.emailsSentChange>0?"+":""}${r.emailsSentChange}%`:null,icon:"",positive:(r==null?void 0:r.emailsSentChange)>0,isLoading:l,theme:i}),n.jsx(Jt,{label:"Open Rate",value:w(r==null?void 0:r.openRate),change:r!=null&&r.openRateChange?`${r.openRateChange>0?"+":""}${r.openRateChange}%`:null,icon:"",positive:(r==null?void 0:r.openRateChange)>0,isLoading:l,theme:i}),n.jsx(Jt,{label:"Click Rate",value:w(r==null?void 0:r.clickRate),change:r!=null&&r.clickRateChange?`${r.clickRateChange>0?"+":""}${r.clickRateChange}%`:null,icon:"",positive:(r==null?void 0:r.clickRateChange)>0,isLoading:l,theme:i}),n.jsx(Jt,{label:"Scheduled",value:M(r==null?void 0:r.scheduledCount),change:null,icon:"",positive:null,isLoading:l,theme:i})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[n.jsxs("div",{style:{padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:i.text,margin:0},children:"Upcoming Scheduled Emails"}),n.jsx(tt,{to:`/${s}/scheduled`,style:{fontSize:"12px",color:i.primary,textDecoration:"none"},children:"View all "})]}),n.jsx("p",{style:{fontSize:"12px",color:i.textSecondary,marginBottom:"16px"},children:"Emails scheduled to be sent in the next 7 days"}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:p?Array.from({length:3}).map((I,P)=>n.jsxs("div",{style:{padding:"14px",backgroundColor:i.bg,borderRadius:"8px",border:`1px solid ${i.border}`},children:[n.jsx(et,{height:"12px",width:"120px"}),n.jsx("div",{style:{marginTop:"8px"},children:n.jsx(et,{height:"16px",width:"180px"})}),n.jsx("div",{style:{marginTop:"4px"},children:n.jsx(et,{height:"12px",width:"220px"})})]},P)):(u==null?void 0:u.length)>0?u.slice(0,5).map(I=>n.jsx(Zs,{email:I,theme:i,userId:s},I.id)):n.jsxs("div",{style:{padding:"40px 20px",textAlign:"center",color:i.textMuted,fontSize:"14px"},children:[n.jsx("div",{style:{fontSize:"32px",marginBottom:"8px"},children:""}),"No scheduled emails in the next 7 days"]})})]}),n.jsxs("div",{style:{padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:i.text,marginBottom:"4px"},children:"Performance Comparison"}),n.jsx("p",{style:{fontSize:"12px",color:i.textSecondary,marginBottom:"16px"},children:"Your metrics compared to industry averages"}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:l?Array.from({length:3}).map((I,P)=>n.jsxs("div",{children:[n.jsx(et,{height:"12px",width:"100px"}),n.jsx("div",{style:{marginTop:"8px"},children:n.jsx(et,{height:"24px"})})]},P)):x.map((I,P)=>n.jsx($s,{label:I.label,you:I.you,avg:I.avg,theme:i},P))}),n.jsxs("div",{style:{display:"flex",gap:"16px",marginTop:"16px",justifyContent:"center"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[n.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:i.primary,borderRadius:"2px"}}),n.jsx("span",{style:{fontSize:"11px",color:i.textSecondary},children:"You"})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[n.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"#14b8a6",borderRadius:"2px"}}),n.jsx("span",{style:{fontSize:"11px",color:i.textSecondary},children:"Industry Avg"})]})]})]})]}),n.jsxs("div",{style:{marginTop:"20px",padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:i.text,margin:0},children:"Recent Email Activity"}),n.jsx(tt,{to:`/${s}/activity`,style:{fontSize:"12px",color:i.primary,textDecoration:"none"},children:"View all "})]}),m?n.jsx(et,{height:"200px"}):(f==null?void 0:f.length)>0?n.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"4px",height:"200px",padding:"20px 0"},children:f.slice(-14).map((I,P)=>{const S=Math.max(...f.map(C=>C.sent||0),1),j=(I.sent||0)/S*150;return n.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[n.jsx("div",{style:{width:"100%",height:`${j}px`,backgroundColor:i.primary,borderRadius:"4px 4px 0 0",minHeight:"4px"},title:`${I.sent||0} sent on ${I.date}`}),n.jsx("span",{style:{fontSize:"9px",color:i.textMuted},children:new Date(I.date).toLocaleDateString("en-US",{weekday:"short"}).charAt(0)})]},P)})}):n.jsx("div",{style:{padding:"40px 20px",textAlign:"center",color:i.textMuted,fontSize:"14px"},children:"No email activity data yet"})]})]})},Bi=({width:i="100%",height:s="20px"})=>n.jsx("div",{style:{width:i,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Fs=[{id:"welcome",name:"Welcome Series",desc:"Send a series of welcome emails to new clients over their first 30 days",icon:"",category:"Onboarding",defaultNodes:[{type:"trigger",config:{frequency:"daily",time:"09:00"}},{type:"send_email",config:{templateKey:"welcome_email"}},{type:"delay",config:{days:3}},{type:"send_email",config:{templateKey:"getting_started"}}]},{id:"renewal",name:"Renewal Reminder",desc:"Automated reminders for upcoming policy renewals with customizable timing",icon:"",category:"Retention",defaultNodes:[{type:"trigger",config:{frequency:"daily",time:"09:00"}},{type:"send_email",config:{templateKey:"renewal_30_day"}},{type:"delay",config:{days:14}},{type:"condition",config:{type:"email_opened"}}]},{id:"engagement",name:"Engagement Campaign",desc:"Re-engage inactive clients with targeted email sequences",icon:"",category:"Engagement",defaultNodes:[{type:"trigger",config:{frequency:"weekly",time:"10:00"}},{type:"send_email",config:{templateKey:"reengagement"}}]},{id:"policy_update",name:"Policy Update Alert",desc:"Notify clients about important policy changes and updates",icon:"",category:"Communication",defaultNodes:[{type:"trigger",config:{frequency:"immediate"}},{type:"send_email",config:{templateKey:"policy_update"}}]}],Hs=({template:i,onUse:s,theme:r})=>n.jsxs("div",{style:{padding:"20px",backgroundColor:r.bgCard,borderRadius:"12px",border:`1px solid ${r.border}`},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[n.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:r.bgHover,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:i.icon}),n.jsx("span",{style:{padding:"4px 10px",backgroundColor:r.bgHover,borderRadius:"20px",fontSize:"11px",color:r.textSecondary},children:i.category})]}),n.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:r.text,marginBottom:"6px"},children:i.name}),n.jsx("p",{style:{fontSize:"13px",color:r.textSecondary,marginBottom:"16px",lineHeight:"1.5"},children:i.desc}),n.jsx("button",{onClick:()=>s(i),style:{width:"100%",padding:"10px",backgroundColor:r.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Use Template"})]}),Us=({automation:i,onEdit:s,onToggle:r,theme:l})=>{var p;const d=i.stats||{},u=i.status==="active";return n.jsxs("tr",{style:{borderTop:`1px solid ${l.border}`},children:[n.jsx("td",{style:{padding:"14px 16px"},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[n.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:l.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px"},children:""}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:l.text},children:i.name}),i.description&&n.jsx("div",{style:{fontSize:"12px",color:l.textMuted},children:i.description})]})]})}),n.jsx("td",{style:{padding:"14px 16px"},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[n.jsx("button",{onClick:()=>r(i.id,u?"pause":"activate"),style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:u?l.success:l.bgHover,cursor:"pointer",position:"relative",transition:"background-color 0.2s",flexShrink:0},children:n.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:u?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})}),n.jsx("span",{style:{fontSize:"12px",color:u?l.success:l.textMuted,fontWeight:"500"},children:u?"Active":i.status==="draft"?"Draft":"Paused"})]})}),n.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:l.textSecondary},children:((p=d.totalSent)==null?void 0:p.toLocaleString())||0}),n.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:l.textSecondary},children:d.openRate?`${Math.round(d.openRate)}%`:""}),n.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:l.textSecondary},children:d.clickRate?`${Math.round(d.clickRate)}%`:""}),n.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:l.textSecondary},children:d.activeEnrollments||0}),n.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:n.jsx("button",{onClick:()=>s(i.id),style:{padding:"6px 12px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"6px",color:l.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Edit"})})]})},Gs=({t:i})=>{const{userId:s}=ge(),r=ft(),[l,d]=O.useState("my"),{data:u,isLoading:p,error:f}=_s(),{activateAutomation:m,pauseAutomation:x}=go(),M=()=>{r(`/${s}/automations/new`)},w=async b=>{r(`/${s}/automations/new`,{state:{templateId:b.id,templateName:b.name,defaultNodes:b.defaultNodes}})},I=b=>{r(`/${s}/automations/${b}`)},P=async(b,q)=>{try{q==="activate"?await m.mutateAsync(b):await x.mutateAsync(b)}catch(Z){console.error(`Failed to ${q} automation:`,Z)}},S=(u==null?void 0:u.filter(b=>b.status==="active"))||[],j=(u==null?void 0:u.filter(b=>b.status==="paused"))||[],C=(u==null?void 0:u.filter(b=>b.status==="draft"))||[];return n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[n.jsxs("div",{children:[n.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:i.text,marginBottom:"4px"},children:"Automations"}),n.jsx("p",{style:{color:i.textSecondary,fontSize:"14px",margin:0},children:"Create and manage automated email workflows"})]}),n.jsxs("button",{onClick:M,style:{padding:"10px 20px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[n.jsx("span",{children:"+"})," Create Custom"]})]}),f&&n.jsx("div",{style:{padding:"16px",backgroundColor:`${i.danger}15`,border:`1px solid ${i.danger}30`,borderRadius:"8px",marginBottom:"24px",color:i.danger,fontSize:"14px"},children:"Failed to load automations. Please try refreshing the page."}),!p&&u&&n.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"24px",padding:"16px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsxs("div",{style:{textAlign:"center",flex:1},children:[n.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:i.success},children:S.length}),n.jsx("div",{style:{fontSize:"12px",color:i.textSecondary},children:"Active"})]}),n.jsx("div",{style:{width:"1px",backgroundColor:i.border}}),n.jsxs("div",{style:{textAlign:"center",flex:1},children:[n.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:i.warning},children:j.length}),n.jsx("div",{style:{fontSize:"12px",color:i.textSecondary},children:"Paused"})]}),n.jsx("div",{style:{width:"1px",backgroundColor:i.border}}),n.jsxs("div",{style:{textAlign:"center",flex:1},children:[n.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:i.textMuted},children:C.length}),n.jsx("div",{style:{fontSize:"12px",color:i.textSecondary},children:"Drafts"})]}),n.jsx("div",{style:{width:"1px",backgroundColor:i.border}}),n.jsxs("div",{style:{textAlign:"center",flex:1},children:[n.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:i.primary},children:u.reduce((b,q)=>{var Z;return b+(((Z=q.stats)==null?void 0:Z.totalSent)||0)},0).toLocaleString()}),n.jsx("div",{style:{fontSize:"12px",color:i.textSecondary},children:"Total Sent"})]})]}),n.jsxs("div",{style:{display:"flex",gap:"0",marginBottom:"24px",backgroundColor:i.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:[n.jsxs("button",{onClick:()=>d("my"),style:{padding:"10px 20px",backgroundColor:l==="my"?i.bgCard:"transparent",border:"none",borderRadius:"8px",color:l==="my"?i.text:i.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:l==="my"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:["My Automations ",u&&`(${u.length})`]}),n.jsx("button",{onClick:()=>d("templates"),style:{padding:"10px 20px",backgroundColor:l==="templates"?i.bgCard:"transparent",border:"none",borderRadius:"8px",color:l==="templates"?i.text:i.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:l==="templates"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:"Templates"})]}),l==="templates"&&n.jsxs(n.Fragment,{children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:i.text,marginBottom:"16px"},children:"Pre-built Templates"}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:Fs.map(b=>n.jsx(Hs,{template:b,onUse:w,theme:i},b.id))})]}),l==="my"&&n.jsx(n.Fragment,{children:p?n.jsx("div",{style:{backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`,padding:"20px"},children:Array.from({length:3}).map((b,q)=>n.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:q>0?`1px solid ${i.border}`:"none"},children:[n.jsx(Bi,{width:"36px",height:"36px"}),n.jsxs("div",{style:{flex:1},children:[n.jsx(Bi,{width:"200px",height:"16px"}),n.jsx("div",{style:{marginTop:"8px"},children:n.jsx(Bi,{width:"120px",height:"12px"})})]})]},q))}):(u==null?void 0:u.length)>0?n.jsx("div",{style:{backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`,overflow:"hidden"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{backgroundColor:i.bgHover},children:[n.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:i.textSecondary},children:"Automation"}),n.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:i.textSecondary},children:"Status"}),n.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:i.textSecondary},children:"Sent"}),n.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:i.textSecondary},children:"Open Rate"}),n.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:i.textSecondary},children:"Click Rate"}),n.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:i.textSecondary},children:"Enrolled"}),n.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:i.textSecondary},children:"Actions"})]})}),n.jsx("tbody",{children:u.map(b=>n.jsx(Us,{automation:b,onEdit:I,onToggle:P,theme:i},b.id))})]})}):n.jsxs("div",{style:{padding:"60px 20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),n.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:i.text,marginBottom:"8px"},children:"No automations yet"}),n.jsx("p",{style:{fontSize:"14px",color:i.textSecondary,marginBottom:"24px"},children:"Create your first automation to start sending targeted emails automatically."}),n.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[n.jsx("button",{onClick:()=>d("templates"),style:{padding:"10px 20px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,cursor:"pointer",fontSize:"14px"},children:"Browse Templates"}),n.jsx("button",{onClick:M,style:{padding:"10px 20px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Custom"})]})]})})]})},Xt=({width:i="100%",height:s="20px"})=>n.jsx("div",{style:{width:i,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Vs=({template:i,onSave:s,onClose:r,theme:l})=>{const[d,u]=O.useState((i==null?void 0:i.name)||""),[p,f]=O.useState((i==null?void 0:i.subject)||""),[m,x]=O.useState((i==null?void 0:i.body_html)||(i==null?void 0:i.body_text)||""),[M,w]=O.useState((i==null?void 0:i.category)||"general"),[I,P]=O.useState(!1),S=async()=>{P(!0);try{await s({name:d,subject:p,body_html:m,body_text:m.replace(/<[^>]*>/g,""),category:M}),r()}catch(b){console.error("Failed to save template:",b)}finally{P(!1)}},j=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],C=b=>{x(m+b)};return n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:100},onClick:r}),n.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxHeight:"90vh",backgroundColor:l.bgCard,borderRadius:"16px",border:`1px solid ${l.border}`,zIndex:101,display:"flex",flexDirection:"column",overflow:"hidden"},children:[n.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${l.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:l.text,margin:0},children:i?"Edit Template":"Create Template"}),n.jsx("button",{onClick:r,style:{background:"none",border:"none",color:l.textMuted,cursor:"pointer",fontSize:"20px"},children:""})]}),n.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Template Name"}),n.jsx("input",{type:"text",value:d,onChange:b=>u(b.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Category"}),n.jsxs("select",{value:M,onChange:b=>w(b.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"},children:[n.jsx("option",{value:"general",children:"General"}),n.jsx("option",{value:"welcome",children:"Welcome"}),n.jsx("option",{value:"renewal",children:"Renewal"}),n.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),n.jsx("option",{value:"engagement",children:"Engagement"}),n.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),n.jsxs("div",{style:{marginBottom:"16px"},children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),n.jsx("input",{type:"text",value:p,onChange:b=>f(b.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),n.jsxs("div",{style:{marginBottom:"16px"},children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),n.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:j.map(b=>n.jsx("button",{onClick:()=>C(b.key),style:{padding:"4px 10px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"6px",color:l.textSecondary,cursor:"pointer",fontSize:"11px"},children:b.label},b.key))})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Email Body"}),n.jsx("textarea",{value:m,onChange:b=>x(b.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:12,style:{width:"100%",padding:"12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),n.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${l.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[n.jsx("button",{onClick:r,style:{padding:"10px 20px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),n.jsx("button",{onClick:S,disabled:I||!d||!p,style:{padding:"10px 20px",backgroundColor:l.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:I?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:I||!d||!p?.6:1},children:I?"Saving...":i?"Save Changes":"Create Template"})]})]})]})},Ks=({template:i,onEdit:s,onDuplicate:r,onDelete:l,theme:d})=>{var m,x;const[u,p]=O.useState(!1),f={welcome:d.success,renewal:d.warning,cross_sell:d.primary,engagement:d.purple,policy_update:"#06b6d4",general:d.textMuted};return n.jsxs("div",{style:{padding:"20px",backgroundColor:d.bgCard,borderRadius:"12px",border:`1px solid ${d.border}`,position:"relative"},children:[n.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px"},children:[n.jsx("button",{onClick:()=>p(!u),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:d.textMuted,cursor:"pointer",fontSize:"16px"},children:""}),u&&n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{position:"fixed",inset:0,zIndex:10},onClick:()=>p(!1)}),n.jsxs("div",{style:{position:"absolute",top:"100%",right:0,backgroundColor:d.bgCard,border:`1px solid ${d.border}`,borderRadius:"8px",padding:"4px",zIndex:11,minWidth:"140px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[n.jsx("button",{onClick:()=>{s(i),p(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:d.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:" Edit"}),n.jsx("button",{onClick:()=>{r(i),p(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:d.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:" Duplicate"}),n.jsx("button",{onClick:()=>{l(i.id),p(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:d.danger,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:" Delete"})]})]})]}),n.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${f[i.category]||d.textMuted}15`,color:f[i.category]||d.textMuted,borderRadius:"20px",fontSize:"11px",fontWeight:"500",marginBottom:"12px",textTransform:"capitalize"},children:((m=i.category)==null?void 0:m.replace("_"," "))||"General"}),n.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:d.text,marginBottom:"6px"},children:i.name}),n.jsx("p",{style:{fontSize:"13px",color:d.textSecondary,marginBottom:"8px"},children:i.subject}),n.jsxs("p",{style:{fontSize:"12px",color:d.textMuted,marginBottom:"12px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:[(x=i.body_text)==null?void 0:x.substring(0,100),"..."]}),n.jsxs("div",{style:{display:"flex",gap:"16px",paddingTop:"12px",borderTop:`1px solid ${d.border}`,fontSize:"11px",color:d.textMuted},children:[n.jsxs("span",{children:[" ",i.usage_count||0," sent"]}),n.jsxs("span",{children:[" ",i.open_rate?`${Math.round(i.open_rate)}%`:""," opens"]})]}),n.jsx("button",{onClick:()=>s(i),style:{marginTop:"12px",width:"100%",padding:"10px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,cursor:"pointer",fontSize:"13px"},children:"Edit Template"})]})},Ys=({t:i})=>{const{userId:s}=ge(),[r,l]=O.useState("my"),[d,u]=O.useState("all"),[p,f]=O.useState(""),[m,x]=O.useState(!1),[M,w]=O.useState(null),{data:I,isLoading:P,error:S}=xo(),{data:j}=gs(),{createTemplate:C,updateTemplate:b,deleteTemplate:q,duplicateTemplate:Z}=mo(),E=(I==null?void 0:I.filter(X=>!(d!=="all"&&X.category!==d||p&&!X.name.toLowerCase().includes(p.toLowerCase())&&!X.subject.toLowerCase().includes(p.toLowerCase()))))||[],k=()=>{w(null),x(!0)},D=X=>{w(X),x(!0)},V=async X=>{M?await b.mutateAsync({id:M.id,...X}):await C.mutateAsync(X)},K=async X=>{await Z.mutateAsync(X.id)},ae=async X=>{window.confirm("Are you sure you want to delete this template?")&&await q.mutateAsync(X)};return n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[n.jsxs("div",{children:[n.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:i.text,marginBottom:"4px"},children:"Email Templates"}),n.jsx("p",{style:{color:i.textSecondary,fontSize:"14px",margin:0},children:"Create and manage reusable email templates"})]}),n.jsxs("button",{onClick:k,style:{padding:"10px 20px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[n.jsx("span",{children:"+"})," Create Template"]})]}),S&&n.jsx("div",{style:{padding:"16px",backgroundColor:`${i.danger}15`,border:`1px solid ${i.danger}30`,borderRadius:"8px",marginBottom:"24px",color:i.danger,fontSize:"14px"},children:"Failed to load templates. Please try refreshing the page."}),n.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"24px",alignItems:"center"},children:[n.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"300px"},children:[n.jsx("input",{type:"text",placeholder:"Search templates...",value:p,onChange:X=>f(X.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px"}}),n.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:i.textMuted},children:""})]}),n.jsxs("select",{value:d,onChange:X=>u(X.target.value),style:{padding:"10px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px",minWidth:"150px"},children:[n.jsx("option",{value:"all",children:"All Categories"}),n.jsx("option",{value:"welcome",children:"Welcome"}),n.jsx("option",{value:"renewal",children:"Renewal"}),n.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),n.jsx("option",{value:"engagement",children:"Engagement"}),n.jsx("option",{value:"policy_update",children:"Policy Update"}),n.jsx("option",{value:"general",children:"General"})]}),n.jsxs("span",{style:{fontSize:"13px",color:i.textMuted},children:[E.length," template",E.length!==1?"s":""]})]}),P?n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:Array.from({length:6}).map((X,_)=>n.jsxs("div",{style:{padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsx(Xt,{width:"80px",height:"20px"}),n.jsx("div",{style:{marginTop:"12px"},children:n.jsx(Xt,{width:"180px",height:"18px"})}),n.jsx("div",{style:{marginTop:"8px"},children:n.jsx(Xt,{width:"220px",height:"14px"})}),n.jsx("div",{style:{marginTop:"8px"},children:n.jsx(Xt,{height:"40px"})})]},_))}):E.length>0?n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:E.map(X=>n.jsx(Ks,{template:X,onEdit:D,onDuplicate:K,onDelete:ae,theme:i},X.id))}):n.jsxs("div",{style:{padding:"60px 20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),n.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:i.text,marginBottom:"8px"},children:p||d!=="all"?"No templates found":"No templates yet"}),n.jsx("p",{style:{fontSize:"14px",color:i.textSecondary,marginBottom:"24px"},children:p||d!=="all"?"Try adjusting your search or filter criteria.":"Create your first email template to get started."}),!p&&d==="all"&&n.jsx("button",{onClick:k,style:{padding:"10px 20px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Template"})]}),m&&n.jsx(Vs,{template:M,onSave:V,onClose:()=>x(!1),theme:i})]})},Oi=({width:i="100%",height:s="20px"})=>n.jsx("div",{style:{width:i,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Qs=({type:i,theme:s})=>{const r=(i||"").toLowerCase();let l=r;(r==="prior_customer"||r.startsWith("prior"))&&(l="prior"),r.startsWith("customer")&&(l="customer"),r.startsWith("prospect")&&(l="prospect"),r.startsWith("lead")&&(l="lead");const d={customer:{bg:`${s.success}20`,text:s.success,label:"Customer"},prospect:{bg:`${s.primary}20`,text:s.primary,label:"Prospect"},prior:{bg:`${s.textMuted}20`,text:s.textMuted,label:"Prior Customer"},lead:{bg:`${s.warning}20`,text:s.warning,label:"Lead"}},u=d[l]||d.prospect;return n.jsx("span",{style:{padding:"4px 10px",backgroundColor:u.bg,color:u.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:u.label||i||"Unknown"})},Js=({policyType:i,status:s,theme:r})=>{const l=s==="active";return n.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"3px 8px",backgroundColor:l?`${r.success}10`:`${r.textMuted}10`,borderRadius:"6px",fontSize:"11px",color:l?r.success:r.textMuted},children:[l?"":""," ",i]})},Xs=({client:i,onClick:s,theme:r})=>{var l,d,u;return n.jsxs("tr",{style:{borderTop:`1px solid ${r.border}`,cursor:"pointer"},onClick:s,onMouseOver:p=>p.currentTarget.style.backgroundColor=r.bgHover,onMouseOut:p=>p.currentTarget.style.backgroundColor="transparent",children:[n.jsx("td",{style:{padding:"14px 16px"},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[n.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:r.bgHover,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",color:r.textMuted},children:((l=i.name)==null?void 0:l.charAt(0).toUpperCase())||"?"}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:r.text},children:i.name}),n.jsx("div",{style:{fontSize:"12px",color:r.textMuted},children:i.person_email||i.email||""})]})]})}),n.jsx("td",{style:{padding:"14px 16px"},children:n.jsx(Qs,{type:i.account_status||"Prospect",theme:r})}),n.jsx("td",{style:{padding:"14px 16px"},children:n.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",alignItems:"center"},children:((d=i.policies)==null?void 0:d.length)>0?n.jsxs(n.Fragment,{children:[i.policies.slice(0,3).map((p,f)=>n.jsx(Js,{policyType:p.policy_type||"Policy",status:p.status,theme:r},f)),i.policies.length>3&&n.jsxs("span",{style:{fontSize:"11px",color:r.textMuted},children:["+",i.policies.length-3," more"]})]}):n.jsx("span",{style:{fontSize:"13px",color:r.textMuted},children:"No policies"})})}),n.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:r.textSecondary,textAlign:"center"},children:i.policy_count||((u=i.policies)==null?void 0:u.length)||0}),n.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:n.jsxs("div",{style:{display:"flex",gap:"6px",justifyContent:"flex-end"},children:[n.jsx("button",{onClick:p=>{p.stopPropagation()},style:{padding:"6px 12px",backgroundColor:r.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:" Email"}),n.jsx("button",{onClick:p=>{p.stopPropagation(),s()},style:{padding:"6px 12px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.textSecondary,cursor:"pointer",fontSize:"12px"},children:"View"})]})})]})},Pt=({label:i,value:s,icon:r,color:l,theme:d,onClick:u,active:p})=>n.jsxs("div",{onClick:u,style:{padding:"16px",backgroundColor:p?`${l}15`:d.bgCard,borderRadius:"10px",border:`2px solid ${p?l:d.border}`,textAlign:"center",cursor:u?"pointer":"default",transition:"all 0.2s ease",transform:p?"scale(1.02)":"scale(1)"},onMouseOver:f=>{u&&(f.currentTarget.style.borderColor=l,f.currentTarget.style.transform="scale(1.02)")},onMouseOut:f=>{u&&!p&&(f.currentTarget.style.borderColor=d.border,f.currentTarget.style.transform="scale(1)")},children:[n.jsx("div",{style:{fontSize:"24px",marginBottom:"4px"},children:r}),n.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:l||d.text},children:s}),n.jsx("div",{style:{fontSize:"12px",color:d.textSecondary},children:i})]}),ea=({t:i})=>{const{userId:s}=ge(),r=ft(),[l,d]=O.useState(""),[u,p]=O.useState("all"),[f,m]=O.useState("name"),[x,M]=O.useState("asc"),[w,I]=O.useState(1),P=25,S=O.useMemo(()=>{const z={limit:P,offset:(w-1)*P};return u!=="all"&&u!=="expiring"&&(z.status=u),u==="expiring"&&(z.expiring=!0,z.limit=100,z.offset=0),l.length>=2&&(z.search=l),z},[u,w,l]),{data:j,isLoading:C,error:b}=zs(S),{data:q,isLoading:Z}=Ps(),E=(j==null?void 0:j.accounts)||[],k=(j==null?void 0:j.total)||0,D=Math.ceil(k/P),V=O.useMemo(()=>!E||E.length===0?[]:[...E].sort((z,B)=>{let R=z[f],$=B[f];return f==="name"&&(R=(R==null?void 0:R.toLowerCase())||"",$=($==null?void 0:$.toLowerCase())||""),f==="policy_count"&&(R=z.policy_count||0,$=B.policy_count||0),x==="asc"?R>$?1:-1:R<$?1:-1}),[E,f,x]),K=z=>{p(z),I(1)},ae=z=>{d(z),I(1)},X=z=>{r(`/${s}/accounts/${z}`)},_=q||{Customer:0,Prospect:0,Prior:0,total:0,expiring:0};return n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[n.jsxs("div",{children:[n.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:i.text,marginBottom:"4px"},children:"Accounts"}),n.jsx("p",{style:{color:i.textSecondary,fontSize:"14px",margin:0},children:"View and manage your account database"})]}),n.jsxs("div",{style:{display:"flex",gap:"12px"},children:[n.jsx("button",{onClick:()=>{},style:{padding:"10px 16px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:" Export"}),n.jsx("button",{style:{padding:"10px 20px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"+ Add Account"})]})]}),b&&n.jsx("div",{style:{padding:"16px",backgroundColor:`${i.danger}15`,border:`1px solid ${i.danger}30`,borderRadius:"8px",marginBottom:"24px",color:i.danger,fontSize:"14px"},children:"Failed to load accounts. Please try refreshing the page."}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"16px",marginBottom:"24px"},children:[n.jsx(Pt,{label:"Total Accounts",value:Z?"...":_.total,icon:"",color:i.text,theme:i,onClick:()=>K("all"),active:u==="all"}),n.jsx(Pt,{label:"Customers",value:Z?"...":_.Customer,icon:"",color:i.success,theme:i,onClick:()=>K(u==="Customer"?"all":"Customer"),active:u==="Customer"}),n.jsx(Pt,{label:"Prospects",value:Z?"...":_.Prospect,icon:"",color:i.primary,theme:i,onClick:()=>K(u==="Prospect"?"all":"Prospect"),active:u==="Prospect"}),n.jsx(Pt,{label:"Prior Customers",value:Z?"...":_.Prior,icon:"",color:i.textMuted,theme:i,onClick:()=>K(u==="Prior"?"all":"Prior"),active:u==="Prior"}),n.jsx(Pt,{label:"Expiring in 30d",value:Z?"...":_.expiring,icon:"",color:i.warning,theme:i,onClick:()=>K(u==="expiring"?"all":"expiring"),active:u==="expiring"})]}),n.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"20px",alignItems:"center",flexWrap:"wrap"},children:[n.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"350px"},children:[n.jsx("input",{type:"text",placeholder:"Search by name, email, or phone...",value:l,onChange:z=>ae(z.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px"}}),n.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:i.textMuted},children:""})]}),n.jsxs("select",{value:u,onChange:z=>K(z.target.value),style:{padding:"10px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px",minWidth:"150px"},children:[n.jsx("option",{value:"all",children:"All Types"}),n.jsx("option",{value:"Customer",children:"Customers"}),n.jsx("option",{value:"Prospect",children:"Prospects"}),n.jsx("option",{value:"Prior",children:"Prior Customers"}),n.jsx("option",{value:"Lead",children:"Leads"}),n.jsx("option",{value:"expiring",children:"Expiring Policies"})]}),n.jsxs("select",{value:`${f}-${x}`,onChange:z=>{const[B,R]=z.target.value.split("-");m(B),M(R)},style:{padding:"10px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px",minWidth:"150px"},children:[n.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),n.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),n.jsx("option",{value:"created_at-desc",children:"Newest First"}),n.jsx("option",{value:"created_at-asc",children:"Oldest First"})]}),n.jsx("span",{style:{fontSize:"13px",color:i.textMuted,marginLeft:"auto"},children:u==="expiring"?`${V.length} account${V.length!==1?"s":""} with expiring policies`:`Showing ${(w-1)*P+1}-${Math.min(w*P,k)} of ${k} account${k!==1?"s":""}`})]}),C?n.jsx("div",{style:{backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`,padding:"20px"},children:Array.from({length:5}).map((z,B)=>n.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:B>0?`1px solid ${i.border}`:"none"},children:[n.jsx(Oi,{width:"40px",height:"40px"}),n.jsxs("div",{style:{flex:1},children:[n.jsx(Oi,{width:"200px",height:"16px"}),n.jsx("div",{style:{marginTop:"8px"},children:n.jsx(Oi,{width:"150px",height:"12px"})})]})]},B))}):V.length>0?n.jsx("div",{style:{backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`,overflow:"hidden"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{backgroundColor:i.bgHover},children:[n.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:i.textSecondary},children:"Account"}),n.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:i.textSecondary},children:"Type"}),n.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:i.textSecondary},children:"Policies"}),n.jsx("th",{style:{padding:"14px 16px",textAlign:"center",fontSize:"12px",fontWeight:"600",color:i.textSecondary},children:"# Policies"}),n.jsx("th",{style:{padding:"14px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:i.textSecondary},children:"Actions"})]})}),n.jsx("tbody",{children:V.map(z=>n.jsx(Xs,{client:z,onClick:()=>X(z.account_unique_id),theme:i},z.id))})]})}):n.jsxs("div",{style:{padding:"60px 20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),n.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:i.text,marginBottom:"8px"},children:l?"No accounts found":"No accounts yet"}),n.jsx("p",{style:{fontSize:"14px",color:i.textSecondary,marginBottom:"24px"},children:l?"Try adjusting your search criteria.":"Your accounts will appear here once synced from Salesforce."})]}),D>1&&u!=="expiring"&&n.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginTop:"24px",padding:"16px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsx("button",{onClick:()=>I(1),disabled:w===1,style:{padding:"8px 12px",backgroundColor:w===1?i.bgHover:i.bg,border:`1px solid ${i.border}`,borderRadius:"6px",color:w===1?i.textMuted:i.text,cursor:w===1?"not-allowed":"pointer",fontSize:"13px"},children:" First"}),n.jsx("button",{onClick:()=>I(z=>Math.max(1,z-1)),disabled:w===1,style:{padding:"8px 12px",backgroundColor:w===1?i.bgHover:i.bg,border:`1px solid ${i.border}`,borderRadius:"6px",color:w===1?i.textMuted:i.text,cursor:w===1?"not-allowed":"pointer",fontSize:"13px"},children:" Prev"}),n.jsxs("span",{style:{padding:"8px 16px",fontSize:"14px",color:i.text,fontWeight:"500"},children:["Page ",w," of ",D]}),n.jsx("button",{onClick:()=>I(z=>Math.min(D,z+1)),disabled:w===D,style:{padding:"8px 12px",backgroundColor:w===D?i.bgHover:i.bg,border:`1px solid ${i.border}`,borderRadius:"6px",color:w===D?i.textMuted:i.text,cursor:w===D?"not-allowed":"pointer",fontSize:"13px"},children:"Next "}),n.jsx("button",{onClick:()=>I(D),disabled:w===D,style:{padding:"8px 12px",backgroundColor:w===D?i.bgHover:i.bg,border:`1px solid ${i.border}`,borderRadius:"6px",color:w===D?i.textMuted:i.text,cursor:w===D?"not-allowed":"pointer",fontSize:"13px"},children:"Last "})]}),_.expiring>0&&u!=="expiring"&&n.jsxs("div",{style:{marginTop:"24px",padding:"16px 20px",backgroundColor:`${i.warning}10`,border:`1px solid ${i.warning}30`,borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[n.jsx("span",{style:{fontSize:"24px"},children:""}),n.jsxs("div",{children:[n.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:i.text},children:[_.expiring," account",_.expiring!==1?"s have":" has"," policies expiring in the next 30 days"]}),n.jsx("div",{style:{fontSize:"12px",color:i.textSecondary},children:"Consider setting up renewal reminders for these accounts."})]})]}),n.jsx("button",{onClick:()=>K("expiring"),style:{padding:"8px 16px",backgroundColor:i.warning,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"View Expiring"})]})]})},Xe=({width:i="100%",height:s="20px"})=>n.jsx("div",{style:{width:i,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),zo=({status:i,theme:s})=>{const r={active:{bg:`${s.success}20`,text:s.success},pending:{bg:`${s.warning}20`,text:s.warning},cancelled:{bg:`${s.danger}20`,text:s.danger},expired:{bg:`${s.textMuted}20`,text:s.textMuted}},l=r[i]||r.pending;return n.jsx("span",{style:{padding:"4px 10px",backgroundColor:l.bg,color:l.text,borderRadius:"20px",fontSize:"11px",fontWeight:"500",textTransform:"capitalize"},children:i})},Lt=({event:i,theme:s})=>{const r={sent:"",delivered:"",opened:"",clicked:"",bounced:"",unsubscribed:""};return n.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"2px 8px",backgroundColor:s.bgHover,borderRadius:"4px",fontSize:"11px",color:s.textSecondary},children:[r[i]||""," ",i]})},ta=({policy:i,theme:s})=>{var p;const r=i.expiration_date?Math.ceil((new Date(i.expiration_date)-new Date)/864e5):null,l=i.policy_lob||i.policy_type||"Unknown",d=i.policy_status||i.status||"unknown",u=((p=i.carrier)==null?void 0:p.name)||i.carrier_name||i.carrier||"";return n.jsxs("div",{style:{padding:"16px",backgroundColor:s.bg,borderRadius:"10px",border:`1px solid ${s.border}`},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[n.jsx("div",{style:{padding:"8px 12px",backgroundColor:`${s.primary}15`,borderRadius:"8px",fontSize:"14px",fontWeight:"600",color:s.primary},children:l}),n.jsx(zo,{status:d.toLowerCase(),theme:s})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",fontSize:"13px"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{color:s.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Policy Number"}),n.jsx("div",{style:{color:s.text},children:i.policy_number||""})]}),n.jsxs("div",{children:[n.jsx("div",{style:{color:s.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Carrier"}),n.jsx("div",{style:{color:s.text},children:u})]}),n.jsxs("div",{children:[n.jsx("div",{style:{color:s.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Effective Date"}),n.jsx("div",{style:{color:s.text},children:i.effective_date?new Date(i.effective_date).toLocaleDateString():""})]}),n.jsxs("div",{children:[n.jsx("div",{style:{color:s.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Expiration"}),n.jsx("div",{style:{color:r!==null&&r>0&&r<=30?s.warning:s.text},children:i.expiration_date?n.jsxs(n.Fragment,{children:[new Date(i.expiration_date).toLocaleDateString(),r!==null&&r>0&&r<=30&&n.jsxs("span",{style:{fontSize:"11px",marginLeft:"6px"},children:["(",r,"d left)"]})]}):""})]})]}),(i.premium||i.annual_premium)&&n.jsxs("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:`1px solid ${s.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsx("span",{style:{fontSize:"12px",color:s.textMuted},children:"Annual Premium"}),n.jsxs("span",{style:{fontSize:"16px",fontWeight:"600",color:s.success},children:["$",(i.premium||i.annual_premium).toLocaleString()]})]})]})},ia=({log:i,theme:s})=>{var r;return n.jsxs("div",{style:{padding:"14px",backgroundColor:s.bg,borderRadius:"8px",border:`1px solid ${s.border}`,marginBottom:"8px"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:s.text},children:((r=i.email_templates)==null?void 0:r.name)||"Direct Email"}),n.jsx("div",{style:{fontSize:"12px",color:s.textSecondary,marginTop:"2px"},children:i.subject})]}),n.jsx("div",{style:{textAlign:"right"},children:n.jsxs("div",{style:{fontSize:"11px",color:s.textMuted},children:[new Date(i.sent_at).toLocaleDateString()," at"," ",new Date(i.sent_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})})]}),n.jsxs("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:[n.jsx(Lt,{event:"sent",theme:s}),i.delivered_at&&n.jsx(Lt,{event:"delivered",theme:s}),i.opened_at&&n.jsx(Lt,{event:"opened",theme:s}),i.clicked_at&&n.jsx(Lt,{event:"clicked",theme:s}),i.bounced_at&&n.jsx(Lt,{event:"bounced",theme:s})]})]})},na=({activity:i,theme:s})=>{const r={email_sent:"",email_opened:"",email_clicked:"",enrollment_started:"",enrollment_completed:"",enrollment_paused:"",note_added:""};return n.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[n.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:s.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:r[i.action_type]||""}),n.jsxs("div",{style:{flex:1},children:[n.jsx("div",{style:{fontSize:"13px",color:s.text},children:i.description}),n.jsx("div",{style:{fontSize:"11px",color:s.textMuted,marginTop:"2px"},children:new Date(i.created_at).toLocaleString()})]})]})},co=({enrollment:i,theme:s,userId:r})=>{var l;return n.jsxs("div",{style:{padding:"14px",backgroundColor:s.bg,borderRadius:"8px",border:`1px solid ${s.border}`,marginBottom:"8px"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsxs("div",{children:[n.jsx(tt,{to:`/${r}/automations/${i.automation_id}`,style:{fontSize:"14px",fontWeight:"500",color:s.text,textDecoration:"none"},children:((l=i.automations)==null?void 0:l.name)||"Unknown Automation"}),n.jsxs("div",{style:{fontSize:"12px",color:s.textMuted,marginTop:"2px"},children:["Started ",new Date(i.enrolled_at).toLocaleDateString()]})]}),n.jsx(zo,{status:i.status==="active"?"active":i.status,theme:s})]}),i.current_node_id&&n.jsxs("div",{style:{marginTop:"10px",padding:"8px 10px",backgroundColor:s.bgHover,borderRadius:"6px",fontSize:"12px",color:s.textSecondary},children:[" Current step: ",i.current_node_name||i.current_node_id]})]})},oa=({t:i})=>{var Z,E;const{userId:s,accountId:r}=ge(),l=ft(),[d,u]=O.useState("overview"),{data:p,isLoading:f,error:m}=Ts(r),{data:x,isLoading:M}=Ss(d==="overview"||d==="emails"?r:null),{data:w,isLoading:I}=Rs(d==="activity"?r:null),{data:P,isLoading:S}=bs(d==="overview"||d==="automations"?r:null),{data:j}=wo(),C={emailsSent:(x==null?void 0:x.length)||0,opened:(x==null?void 0:x.filter(k=>k.opened_at).length)||0,clicked:(x==null?void 0:x.filter(k=>k.clicked_at).length)||0,openRate:(x==null?void 0:x.length)>0?Math.round(x.filter(k=>k.opened_at).length/x.length*100):0,clickRate:(x==null?void 0:x.length)>0?Math.round(x.filter(k=>k.clicked_at).length/x.length*100):0,activeEnrollments:(P==null?void 0:P.filter(k=>k.status==="active").length)||0},b={openRate:(j==null?void 0:j.openRate)||25,clickRate:(j==null?void 0:j.clickRate)||5};if(f)return n.jsxs("div",{children:[n.jsx(Xe,{width:"200px",height:"32px"}),n.jsx("div",{style:{marginTop:"20px"},children:n.jsx(Xe,{height:"200px"})})]});if(m||!p)return n.jsxs("div",{style:{padding:"60px 20px",textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),n.jsx("h2",{style:{color:i.text,marginBottom:"8px"},children:"Account Not Found"}),n.jsx("p",{style:{color:i.textSecondary,marginBottom:"24px"},children:"We couldn't find the account you're looking for."}),n.jsx("button",{onClick:()=>l(`/${s}/accounts`),style:{padding:"10px 20px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Accounts"})]});const q=[{id:"overview",label:"Overview"},{id:"emails",label:`Emails (${(x==null?void 0:x.length)||0})`},{id:"automations",label:`Automations (${(P==null?void 0:P.length)||0})`},{id:"activity",label:"Activity"}];return n.jsxs("div",{children:[n.jsxs("div",{style:{marginBottom:"24px"},children:[n.jsx("button",{onClick:()=>l(`/${s}/accounts`),style:{background:"none",border:"none",color:i.textMuted,cursor:"pointer",fontSize:"14px",marginBottom:"12px",padding:0,display:"flex",alignItems:"center",gap:"6px"},children:" Back to Accounts"}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[n.jsxs("div",{children:[n.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:i.text,marginBottom:"4px"},children:p.name}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(()=>{const k=(p.account_status||"").toLowerCase();let D=k;(k==="prior_customer"||k.startsWith("prior"))&&(D="prior"),k.startsWith("customer")&&(D="customer"),k.startsWith("prospect")&&(D="prospect"),k.startsWith("lead")&&(D="lead");const V={customer:{bg:`${i.success}20`,text:i.success,label:"Customer"},prospect:{bg:`${i.primary}20`,text:i.primary,label:"Prospect"},prior:{bg:`${i.textMuted}20`,text:i.textMuted,label:"Prior Customer"},lead:{bg:`${i.warning}20`,text:i.warning,label:"Lead"}},K=V[D]||V.prospect;return n.jsx("span",{style:{padding:"4px 10px",backgroundColor:K.bg,color:K.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:K.label})})(),p.account_unique_id&&n.jsxs("span",{style:{fontSize:"12px",color:i.textMuted},children:["ID: ",p.account_unique_id]})]})]}),n.jsxs("div",{style:{display:"flex",gap:"8px"},children:[n.jsx("button",{style:{padding:"10px 16px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:" Add Note"}),n.jsx("button",{style:{padding:"10px 16px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:" Send Email"})]})]})]}),n.jsxs("div",{style:{display:"flex",gap:"24px",padding:"16px 20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`,marginBottom:"24px",flexWrap:"wrap"},children:[(p.person_email||p.email)&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n.jsx("span",{style:{fontSize:"16px"},children:""}),n.jsx("a",{href:`mailto:${p.person_email||p.email}`,style:{color:i.primary,textDecoration:"none",fontSize:"14px"},children:p.person_email||p.email})]}),p.phone&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n.jsx("span",{style:{fontSize:"16px"},children:""}),n.jsx("a",{href:`tel:${p.phone}`,style:{color:i.text,textDecoration:"none",fontSize:"14px"},children:p.phone})]}),(p.billing_street||p.billing_city||p.billing_state)&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n.jsx("span",{style:{fontSize:"16px"},children:""}),n.jsx("span",{style:{color:i.textSecondary,fontSize:"14px"},children:[p.billing_street,[p.billing_city,p.billing_state].filter(Boolean).join(", "),p.billing_postal_code].filter(Boolean).join("  ")})]}),p.primary_contact_first_name&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n.jsx("span",{style:{fontSize:"16px"},children:""}),n.jsxs("span",{style:{color:i.textSecondary,fontSize:"14px"},children:[p.primary_contact_first_name," ",p.primary_contact_last_name]})]})]}),n.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:i.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:q.map(k=>n.jsx("button",{onClick:()=>u(k.id),style:{padding:"10px 20px",backgroundColor:d===k.id?i.bgCard:"transparent",border:"none",borderRadius:"8px",color:d===k.id?i.text:i.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:k.label},k.id))}),d==="overview"&&n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[n.jsxs("div",{style:{padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`,display:"flex",flexDirection:"column"},children:[n.jsxs("h3",{style:{fontSize:"16px",fontWeight:"600",color:i.text,marginBottom:"16px",flexShrink:0},children:["Policies (",((Z=p.policies)==null?void 0:Z.length)||0,")"]}),((E=p.policies)==null?void 0:E.length)>0?n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto",flex:1,paddingRight:"8px"},children:p.policies.map((k,D)=>n.jsx(ta,{policy:k,theme:i},D))}):n.jsx("div",{style:{padding:"30px",textAlign:"center",color:i.textMuted},children:"No policies on file"})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[n.jsxs("div",{style:{padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:i.text,marginBottom:"16px"},children:"Email Engagement"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"20px"},children:[n.jsxs("div",{style:{textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:i.primary},children:C.emailsSent}),n.jsx("div",{style:{fontSize:"11px",color:i.textMuted},children:"Sent"})]}),n.jsxs("div",{style:{textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:i.success},children:C.opened}),n.jsx("div",{style:{fontSize:"11px",color:i.textMuted},children:"Opened"})]}),n.jsxs("div",{style:{textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:i.warning},children:C.clicked}),n.jsx("div",{style:{fontSize:"11px",color:i.textMuted},children:"Clicked"})]}),n.jsxs("div",{style:{textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:i.danger},children:(x==null?void 0:x.filter(k=>k.bounced_at).length)||0}),n.jsx("div",{style:{fontSize:"11px",color:i.textMuted},children:"Bounced"})]})]})]}),n.jsxs("div",{style:{padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:i.text,marginBottom:"16px"},children:"Compared to Average"}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[n.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"Open Rate"}),n.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:C.openRate>=b.openRate?i.success:i.danger},children:[C.openRate,"%",C.openRate>=b.openRate?" ":" "]})]}),n.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:i.bgHover,borderRadius:"4px",overflow:"hidden"},children:[n.jsx("div",{style:{position:"absolute",left:`${Math.min(b.openRate,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:i.textMuted,zIndex:2}}),n.jsx("div",{style:{width:`${Math.min(C.openRate,100)}%`,height:"100%",backgroundColor:C.openRate>=b.openRate?i.success:i.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[n.jsx("span",{style:{fontSize:"10px",color:i.textMuted},children:"0%"}),n.jsxs("span",{style:{fontSize:"10px",color:i.textMuted},children:["Avg: ",b.openRate,"%"]}),n.jsx("span",{style:{fontSize:"10px",color:i.textMuted},children:"100%"})]})]}),n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[n.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"Click Rate"}),n.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:C.clickRate>=b.clickRate?i.success:i.danger},children:[C.clickRate,"%",C.clickRate>=b.clickRate?" ":" "]})]}),n.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:i.bgHover,borderRadius:"4px",overflow:"hidden"},children:[n.jsx("div",{style:{position:"absolute",left:`${Math.min(b.clickRate*5,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:i.textMuted,zIndex:2}}),n.jsx("div",{style:{width:`${Math.min(C.clickRate*5,100)}%`,height:"100%",backgroundColor:C.clickRate>=b.clickRate?i.success:i.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[n.jsx("span",{style:{fontSize:"10px",color:i.textMuted},children:"0%"}),n.jsxs("span",{style:{fontSize:"10px",color:i.textMuted},children:["Avg: ",b.clickRate,"%"]}),n.jsx("span",{style:{fontSize:"10px",color:i.textMuted},children:"20%+"})]})]}),n.jsxs("div",{style:{padding:"16px",backgroundColor:i.bg,borderRadius:"10px",textAlign:"center",marginTop:"8px"},children:[n.jsx("div",{style:{fontSize:"11px",color:i.textMuted,marginBottom:"4px"},children:"ENGAGEMENT SCORE"}),n.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:C.openRate>=b.openRate&&C.clickRate>=b.clickRate?i.success:C.openRate>=b.openRate||C.clickRate>=b.clickRate?i.warning:i.danger},children:C.emailsSent===0?"":C.openRate>=b.openRate&&C.clickRate>=b.clickRate?"High":C.openRate>=b.openRate||C.clickRate>=b.clickRate?"Medium":"Low"}),n.jsx("div",{style:{fontSize:"12px",color:i.textSecondary,marginTop:"4px"},children:C.emailsSent===0?"No emails sent yet":C.openRate>=b.openRate?"Above average engagement":"Below average engagement"})]})]})]}),n.jsxs("div",{style:{padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:i.text,marginBottom:"16px"},children:"Active Automations"}),(P==null?void 0:P.filter(k=>k.status==="active").length)>0?P.filter(k=>k.status==="active").map(k=>n.jsx(co,{enrollment:k,theme:i,userId:s},k.id)):n.jsx("div",{style:{padding:"20px",textAlign:"center",color:i.textMuted,fontSize:"13px"},children:"Not enrolled in any automations"})]})]})]}),d==="emails"&&n.jsxs("div",{style:{padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:i.text,marginBottom:"16px"},children:"Email History"}),M?Array.from({length:3}).map((k,D)=>n.jsx("div",{style:{marginBottom:"12px"},children:n.jsx(Xe,{height:"80px"})},D)):(x==null?void 0:x.length)>0?x.map(k=>n.jsx(ia,{log:k,theme:i},k.id)):n.jsx("div",{style:{padding:"40px",textAlign:"center",color:i.textMuted},children:"No emails sent to this client yet"})]}),d==="automations"&&n.jsxs("div",{style:{padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:i.text,margin:0},children:"Automation Enrollments"}),n.jsx("button",{style:{padding:"8px 12px",backgroundColor:i.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:"+ Enroll in Automation"})]}),S?Array.from({length:2}).map((k,D)=>n.jsx("div",{style:{marginBottom:"12px"},children:n.jsx(Xe,{height:"60px"})},D)):(P==null?void 0:P.length)>0?P.map(k=>n.jsx(co,{enrollment:k,theme:i,userId:s},k.id)):n.jsx("div",{style:{padding:"40px",textAlign:"center",color:i.textMuted},children:"Not enrolled in any automations"})]}),d==="activity"&&n.jsxs("div",{style:{padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:i.text,marginBottom:"16px"},children:"Activity Timeline"}),I?Array.from({length:5}).map((k,D)=>n.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[n.jsx(Xe,{width:"32px",height:"32px"}),n.jsxs("div",{style:{flex:1},children:[n.jsx(Xe,{width:"80%",height:"14px"}),n.jsx("div",{style:{marginTop:"4px"},children:n.jsx(Xe,{width:"120px",height:"12px"})})]})]},D)):(w==null?void 0:w.length)>0?n.jsx("div",{style:{borderLeft:`2px solid ${i.border}`,marginLeft:"15px",paddingLeft:"20px"},children:w.map(k=>n.jsx(na,{activity:k,theme:i},k.id))}):n.jsx("div",{style:{padding:"40px",textAlign:"center",color:i.textMuted},children:"No activity recorded yet"})]})]})},Di=({width:i="100%",height:s="20px"})=>n.jsx("div",{style:{width:i,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Le=({label:i,value:s,onChange:r,placeholder:l,type:d="text",disabled:u,hint:p,theme:f})=>n.jsxs("div",{style:{marginBottom:"16px"},children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:f.text,display:"block",marginBottom:"6px"},children:i}),n.jsx("input",{type:d,value:s||"",onChange:m=>r(m.target.value),placeholder:l,disabled:u,style:{width:"100%",padding:"12px",backgroundColor:u?f.bgHover:f.bgInput,border:`1px solid ${f.border}`,borderRadius:"8px",color:f.text,fontSize:"14px",opacity:u?.6:1}}),p&&n.jsx("p",{style:{fontSize:"11px",color:f.textMuted,marginTop:"4px"},children:p})]}),ra=({label:i,value:s,onChange:r,placeholder:l,rows:d=3,disabled:u,theme:p})=>n.jsxs("div",{style:{marginBottom:"16px"},children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:p.text,display:"block",marginBottom:"6px"},children:i}),n.jsx("textarea",{value:s||"",onChange:f=>r(f.target.value),placeholder:l,rows:d,disabled:u,style:{width:"100%",padding:"12px",backgroundColor:u?p.bgHover:p.bgInput,border:`1px solid ${p.border}`,borderRadius:"8px",color:p.text,fontSize:"14px",resize:"vertical",opacity:u?.6:1}})]}),sa=({settings:i,theme:s})=>n.jsxs("div",{style:{padding:"16px",backgroundColor:s.bg,borderRadius:"8px",border:`1px solid ${s.border}`},children:[(i==null?void 0:i.full_name)&&n.jsx("div",{style:{fontWeight:"600",color:s.text},children:i.full_name}),(i==null?void 0:i.job_title)&&n.jsx("div",{style:{color:s.textSecondary,fontSize:"14px"},children:i.job_title}),n.jsx("div",{style:{color:s.textSecondary,fontSize:"14px",marginTop:"4px"},children:[i==null?void 0:i.phone,i==null?void 0:i.email].filter(Boolean).join("  ")}),(i==null?void 0:i.custom_message)&&n.jsx("div",{style:{color:s.textMuted,fontSize:"14px",fontStyle:"italic",marginTop:"8px"},children:i.custom_message}),!(i!=null&&i.full_name)&&!(i!=null&&i.job_title)&&n.jsx("div",{style:{color:s.textMuted,fontSize:"14px"},children:"Fill in your details to see a preview"})]}),aa=({t:i})=>{const{userId:s}=ge(),[r,l]=O.useState("signature"),[d,u]=O.useState(!1),[p,f]=O.useState(null),{data:m,isLoading:x,error:M}=Cs(),{updateSettings:w,updateSignature:I}=ks(),[P,S]=O.useState({full_name:"",job_title:"",phone:"",email:"",custom_message:"",agency_name:"",agency_address:"",agency_phone:"",agency_website:"",default_from_name:"",default_from_email:"",reply_to_email:"",sending_domain:""});O.useEffect(()=>{m&&S({full_name:m.full_name||"",job_title:m.job_title||"",phone:m.phone||"",email:m.email||"",custom_message:m.custom_message||"",agency_name:m.agency_name||"",agency_address:m.agency_address||"",agency_phone:m.agency_phone||"",agency_website:m.agency_website||"",default_from_name:m.default_from_name||"",default_from_email:m.default_from_email||"",reply_to_email:m.reply_to_email||"",sending_domain:m.sending_domain||""})},[m]);const j=Z=>E=>{S(k=>({...k,[Z]:E})),f(null)},C=async()=>{u(!0),f(null);try{await I.mutateAsync({full_name:P.full_name,job_title:P.job_title,phone:P.phone,email:P.email,custom_message:P.custom_message}),f({type:"success",text:"Signature saved successfully!"})}catch{f({type:"error",text:"Failed to save signature. Please try again."})}finally{u(!1)}},b=async()=>{u(!0),f(null);try{await w.mutateAsync(P),f({type:"success",text:"Settings saved successfully!"})}catch{f({type:"error",text:"Failed to save settings. Please try again."})}finally{u(!1)}},q=[{id:"signature",label:"Email Signature",icon:""},{id:"agency",label:"Agency Info",icon:""},{id:"email",label:"Email Settings",icon:""},{id:"integrations",label:"Integrations",icon:""}];return n.jsxs("div",{children:[n.jsxs("div",{style:{marginBottom:"24px"},children:[n.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:i.text,marginBottom:"4px"},children:"Settings"}),n.jsx("p",{style:{color:i.textSecondary,fontSize:"14px",margin:0},children:"Manage your email preferences and configuration"})]}),M&&n.jsx("div",{style:{padding:"16px",backgroundColor:`${i.danger}15`,border:`1px solid ${i.danger}30`,borderRadius:"8px",marginBottom:"24px",color:i.danger,fontSize:"14px"},children:"Failed to load settings. Please try refreshing the page."}),p&&n.jsx("div",{style:{padding:"12px 16px",backgroundColor:p.type==="success"?`${i.success}15`:`${i.danger}15`,border:`1px solid ${p.type==="success"?i.success:i.danger}30`,borderRadius:"8px",marginBottom:"24px",color:p.type==="success"?i.success:i.danger,fontSize:"14px"},children:p.text}),n.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:i.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:q.map(Z=>n.jsxs("button",{onClick:()=>l(Z.id),style:{padding:"10px 20px",backgroundColor:r===Z.id?i.bgCard:"transparent",border:"none",borderRadius:"8px",color:r===Z.id?i.text:i.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[Z.icon," ",Z.label]},Z.id))}),x?n.jsxs("div",{style:{padding:"24px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsx(Di,{width:"200px",height:"24px"}),n.jsx("div",{style:{marginTop:"24px"},children:n.jsx(Di,{height:"40px"})}),n.jsx("div",{style:{marginTop:"16px"},children:n.jsx(Di,{height:"40px"})})]}):n.jsxs(n.Fragment,{children:[r==="signature"&&n.jsxs("div",{style:{padding:"24px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:i.text,marginBottom:"4px"},children:"Your Email Signature"}),n.jsx("p",{style:{fontSize:"13px",color:i.textSecondary,marginBottom:"24px"},children:"This signature will be automatically added to all emails you send through the platform"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[n.jsx(Le,{label:"Full Name",value:P.full_name,onChange:j("full_name"),placeholder:"John Doe",theme:i}),n.jsx(Le,{label:"Job Title",value:P.job_title,onChange:j("job_title"),placeholder:"Insurance Advisor",theme:i}),n.jsx(Le,{label:"Phone Number",value:P.phone,onChange:j("phone"),placeholder:"(555) 123-4567",theme:i}),n.jsx(Le,{label:"Email Address",value:P.email,onChange:j("email"),placeholder:"john.doe@company.com",type:"email",theme:i})]}),n.jsx(ra,{label:"Custom Message (Optional)",value:P.custom_message,onChange:j("custom_message"),placeholder:"Looking forward to serving you!",theme:i}),n.jsxs("div",{style:{marginBottom:"24px"},children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:i.text,display:"block",marginBottom:"8px"},children:"Preview"}),n.jsx(sa,{settings:P,theme:i})]}),n.jsx("button",{onClick:C,disabled:d,style:{padding:"12px 24px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:d?"wait":"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px",opacity:d?.7:1},children:d?" Saving...":" Save Signature"})]}),r==="agency"&&n.jsxs("div",{style:{padding:"24px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:i.text,marginBottom:"4px"},children:"Agency Information"}),n.jsx("p",{style:{fontSize:"13px",color:i.textSecondary,marginBottom:"24px"},children:"Your agency details used in email templates and footers"}),n.jsx(Le,{label:"Agency Name",value:P.agency_name,onChange:j("agency_name"),placeholder:"Insurance Solutions Group",theme:i}),n.jsx(Le,{label:"Address",value:P.agency_address,onChange:j("agency_address"),placeholder:"123 Main Street, Suite 100, Dallas, TX 75201",theme:i}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[n.jsx(Le,{label:"Phone",value:P.agency_phone,onChange:j("agency_phone"),placeholder:"(555) 000-0000",theme:i}),n.jsx(Le,{label:"Website",value:P.agency_website,onChange:j("agency_website"),placeholder:"https://www.example.com",theme:i})]}),n.jsx("button",{onClick:b,disabled:d,style:{padding:"12px 24px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:d?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:d?.7:1},children:d?" Saving...":" Save Agency Info"})]}),r==="email"&&n.jsxs("div",{style:{padding:"24px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[n.jsxs("div",{children:[n.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:i.text,marginBottom:"4px"},children:"Email Configuration"}),n.jsx("p",{style:{fontSize:"13px",color:i.textSecondary},children:"Configure your sending domain and default email settings"})]}),n.jsx("span",{style:{padding:"4px 10px",backgroundColor:i.bgHover,borderRadius:"20px",fontSize:"11px",color:i.textSecondary},children:"Admin Only"})]}),n.jsx(Le,{label:"Sending Domain",value:P.sending_domain,onChange:j("sending_domain"),placeholder:"emails.yourcompany.com",hint:"The domain that will be used to send emails. Must be verified in SendGrid.",theme:i}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[n.jsx(Le,{label:"Default From Name",value:P.default_from_name,onChange:j("default_from_name"),placeholder:"Your Company",theme:i}),n.jsx(Le,{label:"Default From Email",value:P.default_from_email,onChange:j("default_from_email"),placeholder:"noreply@yourcompany.com",type:"email",theme:i})]}),n.jsx(Le,{label:"Reply-To Email",value:P.reply_to_email,onChange:j("reply_to_email"),placeholder:"support@yourcompany.com",type:"email",hint:"Where replies will be directed when recipients respond to automated emails.",theme:i}),n.jsx("button",{onClick:b,disabled:d,style:{padding:"12px 24px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:d?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:d?.7:1},children:d?" Saving...":" Save Configuration"})]}),r==="integrations"&&n.jsxs("div",{style:{padding:"24px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:i.text,marginBottom:"24px"},children:"Integrations"}),n.jsx("div",{style:{padding:"20px",backgroundColor:i.bg,borderRadius:"10px",border:`1px solid ${i.border}`,marginBottom:"16px"},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[n.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#1A82E2",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SG"}),n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:"600",color:i.text,marginBottom:"2px"},children:"SendGrid"}),n.jsx("div",{style:{fontSize:"13px",color:i.textSecondary},children:"Email delivery service"})]})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[n.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${i.success}20`,color:i.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),n.jsx("button",{style:{padding:"8px 12px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Configure"})]})]})}),n.jsx("div",{style:{padding:"20px",backgroundColor:i.bg,borderRadius:"10px",border:`1px solid ${i.border}`,marginBottom:"16px"},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[n.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#00A1E0",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SF"}),n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:"600",color:i.text,marginBottom:"2px"},children:"Salesforce"}),n.jsx("div",{style:{fontSize:"13px",color:i.textSecondary},children:"CRM data sync"})]})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[n.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${i.success}20`,color:i.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),n.jsx("button",{style:{padding:"8px 12px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Sync Now"})]})]})}),n.jsxs("div",{style:{padding:"16px",backgroundColor:`${i.primary}10`,borderRadius:"8px",marginTop:"24px"},children:[n.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:i.text,marginBottom:"4px"},children:" Webhook URL"}),n.jsx("div",{style:{fontSize:"12px",color:i.textSecondary,marginBottom:"8px"},children:"Configure this URL in SendGrid to receive email event notifications"}),n.jsxs("code",{style:{display:"block",padding:"8px 12px",backgroundColor:i.bgCard,borderRadius:"6px",fontSize:"12px",color:i.primary,wordBreak:"break-all"},children:["https://your-app-url.com/api/webhooks/sendgrid/",s]})]})]})]})]})},To={bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},la=({onClose:i,t:s=To})=>{const[r,l]=O.useState("simple"),[d,u]=O.useState("OR"),[p,f]=O.useState(""),[m,x]=O.useState(null),M=[{id:1,name:"John Smith",policies:"Auto only  Expires in 52 days",passes:!0,conditions:[{label:"Has policy type: Auto",passes:!0,value:"Auto (Active)"},{label:"Has policy type: Home",passes:!0,value:"None (Excluded)"},{label:"Expiration: 45-60 days",passes:!0,value:"52 days"}],groupResults:[{passes:!0},{passes:!1}]},{id:2,name:"Jane Wilson",policies:"Home only  Expires in 48 days",passes:!0,conditions:[{label:"Has policy type: Home",passes:!0,value:"Home (Active)"},{label:"Has policy type: Auto",passes:!0,value:"None (Excluded)"},{label:"Expiration: 45-60 days",passes:!0,value:"48 days"}],groupResults:[{passes:!1},{passes:!0}]},{id:3,name:"Bob Johnson",policies:"Auto + Home  Expires in 55 days",passes:!1,conditions:[{label:"Has policy type: Auto",passes:!0,value:"Auto (Active)"},{label:"Excludes: Home",passes:!1,reason:"Account has Home policy",value:"Home (Active)"},{label:"Expiration: 45-60 days",passes:!0,value:"55 days"}],groupResults:[{passes:!1},{passes:!1}]},{id:4,name:"Sarah Davis",policies:"Auto only  Expires in 90 days",passes:!1,conditions:[{label:"Has policy type: Auto",passes:!0,value:"Auto (Active)"},{label:"Has policy type: Home",passes:!0,value:"None (Excluded)"},{label:"Expiration: 45-60 days",passes:!1,reason:"Outside timing window",value:"90 days"}],groupResults:[{passes:!1},{passes:!1}]}].filter(_=>_.name.toLowerCase().includes(p.toLowerCase())),[w,I]=O.useState([{id:1,name:"Group 1",logic:"AND",color:s.primary,filters:{include:[{id:1,conditionId:"has_policy_type",label:"Has policy type",icon:"",value:"Auto"}],exclude:[{id:2,conditionId:"has_policy_type",label:"Has policy type",icon:"",value:"Home"}],activity:[]}},{id:2,name:"Group 2",logic:"AND",color:s.purple,filters:{include:[{id:3,conditionId:"has_policy_type",label:"Has policy type",icon:"",value:"Home"}],exclude:[{id:4,conditionId:"has_policy_type",label:"Has policy type",icon:"",value:"Auto"}],activity:[]}}]),[P,S]=O.useState({enabled:!0,field:"expiration_days",min:45,max:60}),j={"Customer Type":{icon:"",color:s.purple,conditions:[{id:"customer_status",label:"Customer status",configType:"select",options:["New","Existing","Prior","Prospect"]},{id:"is_new",label:"Is a new customer",configType:"none"},{id:"is_existing",label:"Is an existing customer",configType:"none"},{id:"is_prior",label:"Is a prior customer",configType:"none"}]},"Policy Bundle":{icon:"",color:s.primary,conditions:[{id:"bundle_status",label:"Bundle status",configType:"select",options:["Monoline","Bundled"]},{id:"policy_count",label:"Number of policies",configType:"number_compare",unit:"policies"}]},Coverage:{icon:"",color:s.success,conditions:[{id:"has_policy_type",label:"Has policy type",configType:"select",options:["Auto","Home","Renters","Umbrella","Life","Any Active"]},{id:"policy_status",label:"Policy status",configType:"select",options:["Active","Pending","Cancelled","Expired"]},{id:"has_active_renewal",label:"Has an active renewal",configType:"none"}]},"Policy Timing":{icon:"",color:s.warning,conditions:[{id:"expiration_days",label:"Expiration date",configType:"days_from_now"},{id:"effective_days",label:"Effective date",configType:"days_ago"},{id:"approaching_renewal",label:"Is approaching renewal",configType:"none"}]},"Email History":{icon:"",color:"#06b6d4",conditions:[{id:"no_email_in",label:"Hasn't received email in",configType:"days_threshold",defaultValue:30},{id:"received_template",label:"Has received email",configType:"select",options:["Welcome","Renewal","Cross Sell","Follow-Up","Feedback"]},{id:"not_received_template",label:"Has NOT received email",configType:"select",options:["Welcome","Renewal","Cross Sell","Follow-Up","Feedback"]}]},Engagement:{icon:"",color:"#8b5cf6",conditions:[{id:"opened_last",label:"Opened last email",configType:"none"},{id:"clicked_last",label:"Clicked last email",configType:"none"},{id:"no_opens_in",label:"Hasn't opened email in",configType:"days_threshold",defaultValue:60}]},Feedback:{icon:"",color:"#eab308",conditions:[{id:"feedback_score",label:"Feedback score",configType:"number_compare",unit:"stars",max:5},{id:"gave_feedback",label:"Has given feedback",configType:"none"},{id:"no_feedback",label:"Has not given feedback",configType:"none"}]}},C=["#3b82f6","#a78bfa","#22c55e","#f59e0b","#ec4899","#06b6d4"],b=()=>{const _=Math.max(...w.map(z=>z.id),0)+1;I([...w,{id:_,name:`Group ${_}`,logic:"AND",color:C[(_-1)%C.length],filters:{include:[],exclude:[],activity:[]}}])},q=_=>{w.length>1&&I(w.filter(z=>z.id!==_))},Z=(_,z,B)=>{I(w.map(R=>R.id===_?{...R,filters:{...R.filters,[z]:[...R.filters[z],{...B,id:Date.now()}]}}:R))},E=(_,z,B,R)=>{I(w.map($=>$.id===_?{...$,filters:{...$.filters,[z]:$.filters[z].map(U=>U.id===B?{...U,...R}:U)}}:$))},k=(_,z,B)=>{I(w.map(R=>R.id===_?{...R,filters:{...R.filters,[z]:R.filters[z].filter($=>$.id!==B)}}:R))},D=_=>{for(const z of Object.values(j)){const B=z.conditions.find(R=>R.id===_);if(B)return B}return null},V=({filter:_,groupId:z,section:B,color:R})=>{const $=D(_.conditionId),U=()=>{if(!$)return null;switch($.configType){case"select":return n.jsx("select",{value:_.value||$.options[0],onChange:te=>E(z,B,_.id,{value:te.target.value}),style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"4px 8px",color:s.text,fontSize:"12px",marginLeft:"6px"},children:$.options.map(te=>n.jsx("option",{value:te,children:te},te))});case"days_threshold":return n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginLeft:"6px"},children:[n.jsx("input",{type:"number",value:_.value||$.defaultValue||30,onChange:te=>E(z,B,_.id,{value:te.target.value}),style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"4px 6px",color:s.text,fontSize:"12px",width:"50px",textAlign:"center"}}),n.jsx("span",{style:{color:s.textMuted,fontSize:"11px"},children:"days"})]});case"number_compare":return n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginLeft:"6px"},children:[n.jsxs("select",{value:_.operator||"at_least",onChange:te=>E(z,B,_.id,{operator:te.target.value}),style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"4px 6px",color:s.text,fontSize:"11px"},children:[n.jsx("option",{value:"equals",children:"equals"}),n.jsx("option",{value:"at_least",children:"at least"}),n.jsx("option",{value:"at_most",children:"at most"})]}),n.jsx("input",{type:"number",value:_.value||1,max:$.max,onChange:te=>E(z,B,_.id,{value:te.target.value}),style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"4px 6px",color:s.text,fontSize:"12px",width:"45px",textAlign:"center"}}),$.unit&&n.jsx("span",{style:{color:s.textMuted,fontSize:"11px"},children:$.unit})]});default:return null}};return n.jsxs("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"4px",padding:"8px 10px",backgroundColor:`${R}12`,borderRadius:"8px",border:`1px solid ${R}25`,fontSize:"13px",color:s.text},children:[n.jsx("span",{style:{opacity:.7},children:_.icon}),n.jsx("span",{children:_.label}),U(),n.jsx("button",{onClick:()=>k(z,B,_.id),style:{background:"none",border:"none",color:s.textMuted,cursor:"pointer",padding:"0 2px",fontSize:"16px",lineHeight:1,marginLeft:"auto"},children:""})]})},K=({groupId:_,section:z,onSelect:B,buttonColor:R})=>{const[$,U]=O.useState(!1),[te,H]=O.useState(null),we=z==="include"?"Add condition":z==="exclude"?"Add exclusion":"Add activity filter";return n.jsxs("div",{style:{position:"relative"},children:[n.jsxs("button",{onClick:()=>U(!$),style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:`1px dashed ${s.borderLight}`,borderRadius:"8px",color:s.textMuted,cursor:"pointer",fontSize:"12px",textAlign:"left",display:"flex",alignItems:"center",gap:"6px"},children:[n.jsx("span",{style:{color:R},children:"+"})," ",we]}),$&&n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:()=>{U(!1),H(null)}}),n.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",backgroundColor:s.bgCard,border:`1px solid ${s.borderLight}`,borderRadius:"12px",zIndex:100,overflow:"hidden",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},children:n.jsxs("div",{style:{display:"flex",maxHeight:"280px"},children:[n.jsx("div",{style:{width:"140px",borderRight:"1px solid #3f3f46",overflowY:"auto"},children:Object.entries(j).map(([W,ne])=>n.jsxs("button",{onClick:()=>H(W),style:{width:"100%",padding:"8px 10px",backgroundColor:te===W?"#27272a":"transparent",border:"none",borderLeft:te===W?`3px solid ${ne.color}`:"3px solid transparent",color:te===W?"#fafafa":"#a1a1aa",cursor:"pointer",fontSize:"11px",textAlign:"left",display:"flex",alignItems:"center",gap:"6px"},children:[n.jsx("span",{children:ne.icon})," ",W]},W))}),n.jsx("div",{style:{flex:1,padding:"6px",overflowY:"auto",minWidth:"180px"},children:te?j[te].conditions.map(W=>n.jsx("button",{onClick:()=>{B({conditionId:W.id,label:W.label,icon:j[te].icon,value:W.options?W.options[0]:W.defaultValue}),U(!1),H(null)},style:{width:"100%",padding:"8px 10px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:s.text,cursor:"pointer",fontSize:"12px",textAlign:"left"},children:W.label},W.id)):n.jsx("div",{style:{padding:"20px 12px",textAlign:"center",color:s.textMuted,fontSize:"11px"},children:" Select category"})})]})})]})]})},ae=()=>n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 0"},children:[n.jsx("div",{style:{height:"14px",width:"2px",backgroundColor:s.borderLight}}),n.jsx("button",{onClick:()=>u(d==="OR"?"AND":"OR"),style:{margin:"0 -1px",padding:"4px 12px",backgroundColor:d==="OR"?"#7c3aed":"#0891b2",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",fontSize:"10px",fontWeight:"700"},children:d}),n.jsx("div",{style:{height:"14px",width:"2px",backgroundColor:s.borderLight}})]}),X=({group:_,index:z})=>n.jsxs("div",{style:{backgroundColor:s.bg,borderRadius:"10px",border:`2px solid ${_.color}30`,overflow:"hidden"},children:[n.jsxs("div",{style:{padding:"8px 12px",backgroundColor:`${_.color}10`,borderBottom:`1px solid ${_.color}20`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"5px",backgroundColor:_.color,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"700",color:"#fff"},children:z+1}),n.jsx("input",{type:"text",value:_.name,onChange:B=>I(w.map(R=>R.id===_.id?{...R,name:B.target.value}:R)),style:{background:"none",border:"none",color:s.text,fontSize:"12px",fontWeight:"600",width:"80px"}})]}),w.length>1&&n.jsx("button",{onClick:()=>q(_.id),style:{background:"none",border:"none",color:s.textMuted,cursor:"pointer",fontSize:"16px"},children:""})]}),n.jsxs("div",{style:{padding:"12px"},children:[n.jsxs("div",{style:{marginBottom:"10px"},children:[n.jsxs("div",{style:{fontSize:"10px",fontWeight:"600",color:s.success,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[n.jsx("span",{children:""})," INCLUDE"]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[_.filters.include.map(B=>n.jsx(V,{filter:B,groupId:_.id,section:"include",color:"#22c55e"},B.id)),n.jsx(K,{groupId:_.id,section:"include",onSelect:B=>Z(_.id,"include",B),buttonColor:"#22c55e"})]})]}),n.jsxs("div",{style:{marginBottom:"10px"},children:[n.jsxs("div",{style:{fontSize:"10px",fontWeight:"600",color:s.danger,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[n.jsx("span",{children:""})," EXCLUDE"]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[_.filters.exclude.map(B=>n.jsx(V,{filter:B,groupId:_.id,section:"exclude",color:"#ef4444"},B.id)),n.jsx(K,{groupId:_.id,section:"exclude",onSelect:B=>Z(_.id,"exclude",B),buttonColor:"#ef4444"})]})]}),n.jsxs("div",{children:[n.jsxs("div",{style:{fontSize:"10px",fontWeight:"600",color:"#06b6d4",marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[n.jsx("span",{children:""})," ACTIVITY"]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[_.filters.activity.map(B=>n.jsx(V,{filter:B,groupId:_.id,section:"activity",color:"#06b6d4"},B.id)),n.jsx(K,{groupId:_.id,section:"activity",onSelect:B=>Z(_.id,"activity",B),buttonColor:"#06b6d4"})]})]})]})]});return n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 280px",gap:"16px",height:"100%"},children:[n.jsxs("div",{style:{overflowY:"auto",paddingRight:"8px"},children:[n.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"16px",backgroundColor:s.bgHover,padding:"3px",borderRadius:"8px",width:"fit-content"},children:[{id:"simple",label:"Guided",icon:""},{id:"advanced",label:"Advanced",icon:""}].map(_=>n.jsxs("button",{onClick:()=>l(_.id),style:{padding:"6px 12px",borderRadius:"6px",border:"none",cursor:"pointer",fontSize:"11px",fontWeight:"500",backgroundColor:r===_.id?"#3b82f6":"transparent",color:r===_.id?"#fff":"#71717a",display:"flex",alignItems:"center",gap:"4px"},children:[n.jsx("span",{children:_.icon})," ",_.label]},_.id))}),r==="simple"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px",padding:"8px 12px",backgroundColor:s.bgHover,borderRadius:"8px"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n.jsx("span",{style:{fontSize:"12px",color:s.textSecondary},children:"Filter Groups"}),w.length>1&&n.jsxs("span",{style:{padding:"2px 6px",backgroundColor:d==="OR"?"#7c3aed25":"#0891b225",borderRadius:"4px",fontSize:"9px",fontWeight:"600",color:d==="OR"?"#a78bfa":"#22d3ee"},children:[w.length," groups  ",d]})]}),n.jsx("button",{onClick:b,style:{padding:"4px 8px",backgroundColor:s.primary,border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer",fontSize:"10px",fontWeight:"500"},children:"+ Add Group"})]}),w.map((_,z)=>n.jsxs(Fe.Fragment,{children:[n.jsx(X,{group:_,index:z}),z<w.length-1&&n.jsx(ae,{})]},_.id)),n.jsxs("div",{style:{marginTop:"16px"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"8px"},children:[n.jsx("span",{style:{fontSize:"11px",color:s.primary},children:""}),n.jsx("span",{style:{fontSize:"12px",fontWeight:"600",color:s.text},children:"Timing"})]}),n.jsx("div",{style:{padding:"12px",backgroundColor:"rgba(59, 130, 246, 0.08)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)"},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[n.jsx("span",{style:{fontSize:"12px",color:s.textSecondary},children:"When"}),n.jsxs("select",{style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px 8px",color:s.text,fontSize:"11px"},children:[n.jsx("option",{children:"Days until expiration"}),n.jsx("option",{children:"Days since effective"}),n.jsx("option",{children:"Days since status change"})]}),n.jsx("span",{style:{fontSize:"12px",color:s.textSecondary},children:"is between"}),n.jsx("input",{type:"number",defaultValue:P.min,style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px",color:s.text,fontSize:"11px",width:"45px",textAlign:"center"}}),n.jsx("span",{style:{fontSize:"12px",color:s.textSecondary},children:"and"}),n.jsx("input",{type:"number",defaultValue:P.max,style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px",color:s.text,fontSize:"11px",width:"45px",textAlign:"center"}}),n.jsx("span",{style:{fontSize:"12px",color:s.textSecondary},children:"days"})]})})]})]}),r==="advanced"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px",padding:"8px 12px",backgroundColor:s.bgHover,borderRadius:"8px"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n.jsx("span",{style:{fontSize:"12px",color:s.textSecondary},children:"Rule Groups"}),n.jsx("button",{onClick:()=>u(d==="OR"?"AND":"OR"),style:{padding:"3px 8px",backgroundColor:d==="OR"?"#7c3aed":"#0891b2",border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer",fontSize:"9px",fontWeight:"700"},children:d}),n.jsx("span",{style:{fontSize:"10px",color:s.textMuted},children:"between groups"})]}),n.jsx("button",{onClick:b,style:{padding:"4px 8px",backgroundColor:s.primary,border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer",fontSize:"10px",fontWeight:"500"},children:"+ Add Group"})]}),w.map((_,z)=>n.jsxs(Fe.Fragment,{children:[n.jsxs("div",{style:{backgroundColor:s.bg,borderRadius:"10px",border:`2px solid ${_.color}30`,marginBottom:z<w.length-1?"0":"16px",overflow:"hidden"},children:[n.jsxs("div",{style:{padding:"8px 12px",backgroundColor:`${_.color}10`,borderBottom:`1px solid ${_.color}20`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"4px",backgroundColor:_.color,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"700",color:"#fff"},children:z+1}),n.jsx("input",{type:"text",value:_.name,onChange:B=>I(w.map(R=>R.id===_.id?{...R,name:B.target.value}:R)),style:{background:"none",border:"none",color:s.text,fontSize:"12px",fontWeight:"600",width:"80px"}})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[n.jsx("span",{style:{fontSize:"10px",color:s.textMuted},children:"Logic:"}),n.jsxs("select",{value:_.logic,onChange:B=>I(w.map(R=>R.id===_.id?{...R,logic:B.target.value}:R)),style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"3px 6px",color:s.text,fontSize:"10px"},children:[n.jsx("option",{value:"AND",children:"AND"}),n.jsx("option",{value:"OR",children:"OR"})]}),w.length>1&&n.jsx("button",{onClick:()=>q(_.id),style:{background:"none",border:"none",color:s.textMuted,cursor:"pointer",fontSize:"14px"},children:""})]})]}),n.jsxs("div",{style:{padding:"10px"},children:[[..._.filters.include,..._.filters.exclude].map((B,R)=>n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 10px",backgroundColor:s.bgHover,borderRadius:"6px",marginBottom:"6px"},children:[n.jsxs("span",{style:{fontSize:"10px",color:s.textMuted,width:"16px",fontFamily:"monospace"},children:[R+1,"."]}),n.jsxs("select",{style:{backgroundColor:s.bgCard,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:s.textSecondary,fontSize:"10px",width:"80px"},children:[n.jsx("option",{children:"Field"}),n.jsx("option",{children:"Relationship"})]}),n.jsxs("select",{style:{backgroundColor:s.bgCard,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:s.text,fontSize:"10px",width:"70px"},children:[n.jsx("option",{children:"Policy"}),n.jsx("option",{children:"Account"}),n.jsx("option",{children:"Contact"})]}),n.jsx("span",{style:{color:s.borderLight,fontSize:"10px"},children:"."}),n.jsxs("select",{style:{backgroundColor:s.bgCard,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:s.text,fontSize:"10px",flex:1},children:[n.jsx("option",{children:"Type"}),n.jsx("option",{children:"Status"}),n.jsx("option",{children:"Premium"}),n.jsx("option",{children:"Effective Date"}),n.jsx("option",{children:"Expiration Date"})]}),n.jsxs("select",{style:{backgroundColor:s.bgCard,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:_.filters.exclude.find($=>$.id===B.id)?"#f87171":"#4ade80",fontSize:"10px",width:"80px"},children:[n.jsx("option",{children:"equals"}),n.jsx("option",{children:"not equals"}),n.jsx("option",{children:"contains"}),n.jsx("option",{children:"is empty"}),n.jsx("option",{children:"is not empty"})]}),n.jsx("input",{type:"text",defaultValue:B.value||"",placeholder:"value",style:{backgroundColor:s.bgCard,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:s.text,fontSize:"10px",width:"70px"}}),n.jsx("button",{onClick:()=>{const $=_.filters.include.find(U=>U.id===B.id)?"include":"exclude";k(_.id,$,B.id)},style:{background:"none",border:"none",color:s.textMuted,cursor:"pointer",fontSize:"12px"},children:""})]},B.id)),n.jsx("button",{onClick:()=>Z(_.id,"include",{label:"New Rule",value:"",icon:""}),style:{width:"100%",padding:"8px",backgroundColor:"transparent",border:`1px dashed ${s.borderLight}`,borderRadius:"6px",color:s.textMuted,cursor:"pointer",fontSize:"10px"},children:"+ Add Rule"})]})]}),z<w.length-1&&n.jsx(ae,{})]},_.id)),n.jsxs("div",{style:{padding:"12px",backgroundColor:"rgba(59, 130, 246, 0.08)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)"},children:[n.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:s.primary,marginBottom:"8px"},children:" Timing Window"}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[n.jsxs("select",{style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px 8px",color:s.text,fontSize:"10px"},children:[n.jsx("option",{children:"Policy.ExpirationDate"}),n.jsx("option",{children:"Policy.EffectiveDate"}),n.jsx("option",{children:"Account.StatusChangeDate"}),n.jsx("option",{children:"EmailActivity.LastSentDate"})]}),n.jsxs("select",{style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px 8px",color:s.text,fontSize:"10px"},children:[n.jsx("option",{children:"days from now between"}),n.jsx("option",{children:"days ago between"})]}),n.jsx("input",{type:"number",defaultValue:"45",style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px",color:s.text,fontSize:"10px",width:"40px",textAlign:"center"}}),n.jsx("span",{style:{color:s.textMuted,fontSize:"10px"},children:"AND"}),n.jsx("input",{type:"number",defaultValue:"60",style:{backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"4px",padding:"6px",color:s.text,fontSize:"10px",width:"40px",textAlign:"center"}})]})]})]})]}),n.jsxs("div",{style:{backgroundColor:s.bg,borderRadius:"10px",padding:"14px",display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:s.textMuted,textTransform:"uppercase",marginBottom:"10px"},children:"Audience Preview"}),n.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"6px",marginBottom:"12px"},children:[n.jsx("span",{style:{fontSize:"32px",fontWeight:"700",color:s.primary,fontFamily:"monospace",lineHeight:1},children:"1,247"}),n.jsx("span",{style:{color:s.textMuted,fontSize:"12px"},children:"match"})]}),n.jsxs("div",{style:{display:"flex",gap:"6px",marginBottom:"12px"},children:[n.jsxs("div",{style:{flex:1,padding:"8px",backgroundColor:s.bgHover,borderRadius:"6px",textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:s.success},children:"2,847"}),n.jsx("div",{style:{fontSize:"9px",color:s.textMuted},children:"Included"})]}),n.jsxs("div",{style:{flex:1,padding:"8px",backgroundColor:s.bgHover,borderRadius:"6px",textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:s.danger},children:"1,600"}),n.jsx("div",{style:{fontSize:"9px",color:s.textMuted},children:"Excluded"})]})]}),w.length>1&&n.jsxs("div",{style:{marginBottom:"10px"},children:[n.jsx("div",{style:{fontSize:"9px",color:s.textMuted,marginBottom:"4px"},children:"By group:"}),w.map((_,z)=>n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px 6px",backgroundColor:s.bgHover,borderRadius:"4px",marginBottom:"3px"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[n.jsx("div",{style:{width:"14px",height:"14px",borderRadius:"3px",backgroundColor:_.color,fontSize:"8px",fontWeight:"700",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},children:z+1}),n.jsx("span",{style:{fontSize:"10px",color:s.textSecondary},children:_.name})]}),n.jsx("span",{style:{fontSize:"11px",fontWeight:"600",color:_.color},children:z===0?"847":"523"})]},_.id))]})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:s.textMuted,textTransform:"uppercase",marginBottom:"8px"},children:" Test with Account"}),n.jsxs("div",{style:{position:"relative",marginBottom:"10px"},children:[n.jsx("input",{type:"text",placeholder:"Search accounts...",value:p,onChange:_=>f(_.target.value),style:{width:"100%",padding:"8px 10px",paddingRight:"30px",backgroundColor:s.bgHover,border:`1px solid ${s.borderLight}`,borderRadius:"6px",color:s.text,fontSize:"11px"}}),n.jsx("span",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:s.textMuted,fontSize:"12px"},children:""})]}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:M.map(_=>n.jsxs("div",{onClick:()=>x(m===_.id?null:_.id),style:{padding:"8px 10px",backgroundColor:_.passes?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",border:`1px solid ${_.passes?"rgba(34, 197, 94, 0.2)":"rgba(239, 68, 68, 0.2)"}`,borderRadius:"6px",cursor:"pointer"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:s.text},children:_.name}),n.jsx("div",{style:{fontSize:"9px",color:s.textMuted},children:_.policies})]}),n.jsx("div",{style:{padding:"3px 8px",backgroundColor:_.passes?"#22c55e":"#ef4444",borderRadius:"4px",fontSize:"9px",fontWeight:"600",color:"#fff"},children:_.passes?" Pass":" Fail"})]}),m===_.id&&n.jsxs("div",{style:{marginTop:"10px",paddingTop:"10px",borderTop:"1px solid rgba(255,255,255,0.1)"},children:[n.jsx("div",{style:{fontSize:"9px",fontWeight:"600",color:s.textMuted,marginBottom:"6px"},children:"CONDITION RESULTS"}),_.conditions.map((z,B)=>n.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"6px",marginBottom:"4px",padding:"4px 6px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"4px"},children:[n.jsx("span",{style:{fontSize:"10px",color:z.passes?"#22c55e":"#ef4444",flexShrink:0},children:z.passes?"":""}),n.jsxs("div",{style:{flex:1},children:[n.jsx("div",{style:{fontSize:"10px",color:s.text},children:z.label}),!z.passes&&z.reason&&n.jsx("div",{style:{fontSize:"9px",color:s.danger,marginTop:"2px"},children:z.reason}),z.value&&n.jsxs("div",{style:{fontSize:"9px",color:s.textMuted,marginTop:"2px"},children:["Actual: ",z.value]})]})]},B)),w.length>1&&n.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.05)"},children:[n.jsx("div",{style:{fontSize:"9px",color:s.textMuted,marginBottom:"4px"},children:"GROUP RESULTS"}),n.jsx("div",{style:{display:"flex",gap:"4px"},children:_.groupResults.map((z,B)=>{var R;return n.jsxs("div",{style:{flex:1,padding:"4px",backgroundColor:z.passes?"rgba(34, 197, 94, 0.15)":"rgba(239, 68, 68, 0.15)",borderRadius:"4px",textAlign:"center"},children:[n.jsxs("div",{style:{fontSize:"9px",fontWeight:"600",color:((R=w[B])==null?void 0:R.color)||"#71717a"},children:["G",B+1]}),n.jsx("div",{style:{fontSize:"10px",color:z.passes?"#22c55e":"#ef4444"},children:z.passes?"":""})]},B)})}),n.jsx("div",{style:{fontSize:"9px",color:s.textMuted,textAlign:"center",marginTop:"4px"},children:d==="OR"?"Needs 1 group to pass":"Needs all groups to pass"})]})]})]},_.id))}),n.jsx("button",{style:{width:"100%",marginTop:"8px",padding:"6px",backgroundColor:"transparent",border:`1px dashed ${s.borderLight}`,borderRadius:"6px",color:s.textMuted,cursor:"pointer",fontSize:"10px"},children:"View all matching records "})]}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:s.textMuted,textTransform:"uppercase",marginBottom:"8px"},children:"Summary"}),n.jsx("div",{style:{fontSize:"10px",color:s.textSecondary,lineHeight:"1.6"},children:w.map((_,z)=>n.jsxs(Fe.Fragment,{children:[n.jsxs("div",{style:{padding:"6px",backgroundColor:`${_.color}10`,borderRadius:"4px",border:`1px solid ${_.color}20`,marginBottom:(z<w.length-1,"0")},children:[n.jsx("div",{style:{fontWeight:"600",color:_.color,marginBottom:"2px",fontSize:"9px"},children:_.name}),n.jsxs("div",{style:{color:s.text,fontSize:"10px"},children:[_.filters.include.map(B=>`${B.label}: ${B.value||""}`).join(" + "),_.filters.exclude.length>0&&n.jsxs("span",{style:{color:s.danger},children:[" "," ",_.filters.exclude.map(B=>`${B.value||B.label}`).join(", ")]})]})]}),z<w.length-1&&n.jsx("div",{style:{textAlign:"center",padding:"3px 0",fontWeight:"700",fontSize:"9px",color:d==="OR"?"#a78bfa":"#22d3ee"},children:d})]},_.id))})]})]})]})},da=[{id:"entry-criteria",type:"entry_criteria",title:"Entry Criteria",subtitle:"Define who enters this automation",config:{filterConfig:{}}},{id:"trigger",type:"trigger",title:"Trigger",subtitle:"Daily at 09:00 (Central)",config:{time:"09:00",timezone:"America/Chicago",frequency:"Daily"}},{id:"node-1",type:"send_email",title:"Send Email",subtitle:"Select template...",config:{template:""}}],ca=({t:i,automation:s,onUpdate:r,onSave:l})=>{var k,D,V,K,ae,X,_,z,B;const d=i||To,u=s!=null&&s.nodes&&s.nodes.length>0?s.nodes:da,[p,f]=O.useState(u),[m,x]=O.useState(null),[M,w]=O.useState(null),[I,P]=O.useState(!1),S={entry_criteria:{icon:"",color:"#8b5cf6",label:"Entry Criteria"},trigger:{icon:"",color:d.primary,label:"Trigger"},send_email:{icon:"",color:d.success,label:"Send Email"},delay:{icon:"",color:d.warning,label:"Delay"},condition:{icon:"",color:d.purple,label:"Condition"},field_condition:{icon:"",color:"#ec4899",label:"Field Check"},update_field:{icon:"",color:"#06b6d4",label:"Update Field"},end:{icon:"",color:d.textMuted,label:"End"}},j=[{type:"send_email",label:"Send Email",desc:"Send an email template",icon:""},{type:"delay",label:"Delay",desc:"Wait before continuing",icon:""},{type:"condition",label:"Email Engagement",desc:"Branch on open/click",icon:""},{type:"field_condition",label:"Field Condition",desc:"Branch on field value",icon:""},{type:"update_field",label:"Update Field",desc:"Update a record field",icon:""},{type:"end",label:"End",desc:"Stop automation",icon:""}],C=(R,$,U=null)=>{var H;const te={id:`node-${Date.now()}`,type:$,title:((H=j.find(we=>we.type===$))==null?void 0:H.label)||$,subtitle:"Configure...",config:{}};if(($==="condition"||$==="field_condition")&&(te.branches={yes:[],no:[]}),U)f(we=>{const W=ne=>ne.map(se=>se.id===R&&se.branches?{...se,branches:{...se.branches,[U]:[...se.branches[U],te]}}:se.branches?{...se,branches:{yes:W(se.branches.yes),no:W(se.branches.no)}}:se);return W(we)});else{const we=p.findIndex(ne=>ne.id===R),W=[...p];W.splice(we+1,0,te),f(W)}w(null),x(te.id)},b=R=>{f($=>$.filter(U=>U.id!==R&&U.id!=="trigger"&&U.id!=="entry-criteria")),m===R&&x(null)},q=({node:R})=>{const $=S[R.type]||S.send_email,U=m===R.id,te=R.type==="entry_criteria",H=R.type==="trigger",we=te||H;return n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[n.jsxs("div",{onClick:()=>{x(R.id),te&&P(!0)},style:{width:"320px",backgroundColor:d.bgCard,border:U?`2px solid ${$.color}`:`1px solid ${d.border}`,borderRadius:"12px",padding:"16px 18px",cursor:"pointer",position:"relative"},children:[!we&&n.jsx("button",{onClick:W=>{W.stopPropagation(),b(R.id)},style:{position:"absolute",top:"8px",right:"8px",background:"none",border:"none",color:d.textMuted,cursor:"pointer",fontSize:"16px"},children:""}),n.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[n.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${$.color}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:$.icon}),n.jsxs("div",{style:{flex:1},children:[n.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:d.text},children:R.title}),n.jsx("div",{style:{fontSize:"12px",color:d.textMuted,marginTop:"2px"},children:R.subtitle})]})]}),te&&n.jsxs("button",{onClick:W=>{W.stopPropagation(),P(!0)},style:{marginTop:"12px",width:"100%",padding:"10px",backgroundColor:d.bgHover,border:`1px solid ${d.borderLight}`,borderRadius:"8px",color:d.textSecondary,cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[n.jsx("span",{children:""})," Edit Entry Criteria"]})]}),!R.branches&&n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[n.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.borderLight}}),n.jsx("button",{onClick:()=>w({afterNodeId:R.id,branch:null}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:d.bgHover,border:`1px solid ${d.borderLight}`,color:d.textMuted,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"}),n.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.borderLight}}),(M==null?void 0:M.afterNodeId)===R.id&&!(M!=null&&M.branch)&&n.jsx(Z,{onSelect:W=>C(R.id,W),onClose:()=>w(null)})]}),R.branches&&n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[n.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.borderLight}}),n.jsxs("div",{style:{display:"flex"},children:[n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[n.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:d.success}}),n.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#22c55e20",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:d.success},children:"YES"})]}),n.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.success}}),R.branches.yes.map(W=>n.jsx(q,{node:W},W.id)),n.jsx("button",{onClick:()=>w({afterNodeId:R.id,branch:"yes"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:d.bgHover,border:"1px dashed #22c55e",color:d.success,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(M==null?void 0:M.afterNodeId)===R.id&&(M==null?void 0:M.branch)==="yes"&&n.jsx(Z,{onSelect:W=>C(R.id,W,"yes"),onClose:()=>w(null)})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[n.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#ef444420",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:d.danger},children:"NO"}),n.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:d.danger}})]}),n.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.danger}}),R.branches.no.map(W=>n.jsx(q,{node:W},W.id)),n.jsx("button",{onClick:()=>w({afterNodeId:R.id,branch:"no"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:d.bgHover,border:"1px dashed #ef4444",color:d.danger,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(M==null?void 0:M.afterNodeId)===R.id&&(M==null?void 0:M.branch)==="no"&&n.jsx(Z,{onSelect:W=>C(R.id,W,"no"),onClose:()=>w(null)})]})]})]})]})},Z=({onSelect:R,onClose:$})=>n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:$}),n.jsx("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"10px",backgroundColor:d.bgCard,border:`1px solid ${d.borderLight}`,borderRadius:"12px",padding:"8px",zIndex:100,width:"240px",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},children:j.map(U=>n.jsxs("button",{onClick:()=>R(U.type),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px",color:d.text,textAlign:"left"},children:[n.jsx("span",{style:{fontSize:"18px"},children:U.icon}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:"13px",fontWeight:"500"},children:U.label}),n.jsx("div",{style:{fontSize:"11px",color:d.textMuted},children:U.desc})]})]},U.type))})]}),E=p.find(R=>R.id===m)||p.flatMap(R=>R.branches?[...R.branches.yes||[],...R.branches.no||[]]:[]).find(R=>R.id===m);return n.jsxs("div",{style:{fontFamily:"'IBM Plex Sans', -apple-system, sans-serif",backgroundColor:d.bg,height:"100%",color:d.text,display:"flex"},children:[n.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[n.jsxs("div",{style:{width:"220px",borderRight:`1px solid ${d.border}`,padding:"16px",backgroundColor:d.bgCard,overflowY:"auto"},children:[n.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:d.textMuted,marginBottom:"12px",textTransform:"uppercase"},children:"Add Nodes"}),j.map(R=>n.jsxs("div",{style:{padding:"12px",backgroundColor:d.bgHover,borderRadius:"8px",marginBottom:"8px",cursor:"grab",display:"flex",alignItems:"center",gap:"10px"},children:[n.jsx("span",{style:{fontSize:"18px"},children:R.icon}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:d.text},children:R.label}),n.jsx("div",{style:{fontSize:"11px",color:d.textMuted},children:R.desc})]})]},R.type))]}),n.jsx("div",{style:{flex:1,padding:"40px",overflowY:"auto",display:"flex",justifyContent:"center"},children:n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[p.map(R=>n.jsx(q,{node:R},R.id)),n.jsx("div",{style:{marginTop:"16px",padding:"8px 18px",backgroundColor:d.bgHover,borderRadius:"20px",fontSize:"12px",color:d.textMuted},children:"End of automation"})]})}),n.jsxs("div",{style:{width:"300px",borderLeft:`1px solid ${d.border}`,backgroundColor:d.bgCard,overflowY:"auto"},children:[n.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${d.border}`,fontSize:"11px",fontWeight:"600",color:d.textMuted,textTransform:"uppercase"},children:"Configuration"}),n.jsx("div",{style:{padding:"18px"},children:E?n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[n.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${((k=S[E.type])==null?void 0:k.color)||d.primary}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:((D=S[E.type])==null?void 0:D.icon)||""}),n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:"600",color:d.text,fontSize:"15px"},children:E.title}),n.jsx("div",{style:{fontSize:"12px",color:d.textMuted},children:((V=S[E.type])==null?void 0:V.label)||"Node"})]})]}),E.type==="entry_criteria"&&n.jsxs("div",{children:[n.jsx("p",{style:{fontSize:"13px",color:d.textSecondary,marginBottom:"16px"},children:"Define which contacts enter this automation based on their attributes and behavior."}),n.jsx("button",{onClick:()=>P(!0),style:{width:"100%",padding:"12px",backgroundColor:d.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Edit Entry Criteria"})]}),E.type==="trigger"&&n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Run Time"}),n.jsx("input",{type:"time",defaultValue:((K=E.config)==null?void 0:K.time)||"09:00",style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px",marginBottom:"16px"}}),n.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Frequency"}),n.jsxs("select",{defaultValue:((ae=E.config)==null?void 0:ae.frequency)||"Daily",style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"},children:[n.jsx("option",{children:"Daily"}),n.jsx("option",{children:"Weekly"}),n.jsx("option",{children:"Monthly"})]})]}),E.type==="send_email"&&n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Email Template"}),n.jsxs("select",{defaultValue:((X=E.config)==null?void 0:X.template)||"",style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"},children:[n.jsx("option",{value:"",children:"Select template..."}),n.jsx("option",{children:"Welcome Email"}),n.jsx("option",{children:"Cross-Sell Introduction"}),n.jsx("option",{children:"Renewal Reminder"}),n.jsx("option",{children:"Follow-Up"}),n.jsx("option",{children:"Re-engagement"})]})]}),E.type==="delay"&&n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Wait Duration"}),n.jsxs("div",{style:{display:"flex",gap:"8px"},children:[n.jsx("input",{type:"number",defaultValue:((_=E.config)==null?void 0:_.duration)||1,min:"1",style:{flex:1,padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"}}),n.jsxs("select",{defaultValue:((z=E.config)==null?void 0:z.unit)||"days",style:{flex:1,padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"},children:[n.jsx("option",{value:"hours",children:"Hours"}),n.jsx("option",{value:"days",children:"Days"}),n.jsx("option",{value:"weeks",children:"Weeks"})]})]})]}),(E.type==="condition"||E.type==="field_condition")&&n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Condition Type"}),n.jsxs("select",{defaultValue:((B=E.config)==null?void 0:B.type)||"email_opened",style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"},children:[n.jsx("option",{value:"email_opened",children:"Email Opened"}),n.jsx("option",{value:"email_clicked",children:"Email Clicked"}),n.jsx("option",{value:"field_value",children:"Field Value"})]})]}),E.type==="end"&&n.jsx("p",{style:{fontSize:"13px",color:d.textSecondary},children:"This node ends the automation flow. Contacts reaching this point will exit the automation."})]}):n.jsxs("div",{style:{textAlign:"center",color:d.textMuted,padding:"30px 0"},children:[n.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:""}),n.jsx("div",{style:{fontSize:"13px"},children:"Select a node to configure"})]})})]})]}),I&&n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",zIndex:200},onClick:()=>P(!1)}),n.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"1000px",height:"80vh",backgroundColor:d.bgCard,borderRadius:"16px",border:`1px solid ${d.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[n.jsxs("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${d.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[n.jsx("h2",{style:{fontSize:"15px",fontWeight:"600",color:d.text,margin:0},children:"Audience Criteria"}),n.jsx("button",{onClick:()=>P(!1),style:{background:"none",border:"none",color:d.textMuted,cursor:"pointer",fontSize:"18px"},children:""})]}),n.jsx("div",{style:{flex:1,padding:"20px",overflow:"hidden"},children:n.jsx(la,{onClose:()=>P(!1),t:d})}),n.jsxs("div",{style:{padding:"12px 20px",borderTop:`1px solid ${d.border}`,display:"flex",justifyContent:"flex-end",gap:"8px",flexShrink:0},children:[n.jsx("button",{onClick:()=>P(!1),style:{padding:"8px 16px",backgroundColor:d.bgHover,border:`1px solid ${d.borderLight}`,borderRadius:"6px",color:d.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Cancel"}),n.jsx("button",{onClick:()=>P(!1),style:{padding:"8px 16px",backgroundColor:d.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px",fontWeight:"500"},children:"Save Criteria"})]})]})]})]})},uo=({t:i})=>{var q,Z;const{userId:s,automationId:r}=ge(),l=ft(),d=ho(),u=!r||r==="new";(q=d.state)!=null&&q.templateName||((Z=d.state)==null||Z.templateId);const{data:p,isLoading:f,error:m}=ys(u?null:r),{createAutomation:x,updateAutomation:M,activateAutomation:w,pauseAutomation:I}=go(),P=async()=>{if(u)return;const E=S.status==="active",k=E?"paused":"active";try{E?await I.mutateAsync(r):await w.mutateAsync(r),j(D=>({...D,status:k}))}catch(D){console.error("Failed to toggle status:",D)}},[S,j]=O.useState({name:"",description:"",category:"general",status:"draft",send_time:"10:00",timezone:"America/Chicago",frequency:"Daily",filter_config:{},nodes:[]});O.useEffect(()=>{p&&j({name:p.name||"",description:p.description||"",category:p.category||"general",status:p.status||"draft",send_time:p.send_time||"10:00",timezone:p.timezone||"America/Chicago",frequency:p.frequency||"Daily",filter_config:p.filter_config||{},nodes:p.nodes||[]})},[p]);const C=async E=>{try{if(u){const k=await x.mutateAsync(E);l(`/${s}/automations/${k.id}`,{replace:!0})}else await M.mutateAsync({automationId:r,updates:E})}catch(k){console.error("Failed to save automation:",k),alert("Failed to save automation. Please try again.")}},b=()=>{l(`/${s}/automations`)};return!u&&f?n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[n.jsx("div",{style:{fontSize:"32px"},children:""}),n.jsx("div",{style:{color:(i==null?void 0:i.textSecondary)||"#a1a1aa"},children:"Loading automation..."})]}):m?n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[n.jsx("div",{style:{fontSize:"48px"},children:""}),n.jsx("h2",{style:{color:(i==null?void 0:i.text)||"#fafafa",margin:0},children:"Automation Not Found"}),n.jsx("p",{style:{color:(i==null?void 0:i.textSecondary)||"#a1a1aa"},children:"We couldn't find the automation you're looking for."}),n.jsx("button",{onClick:b,style:{padding:"10px 20px",backgroundColor:(i==null?void 0:i.primary)||"#3b82f6",border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Automations"})]}):n.jsxs("div",{style:{margin:"-24px",height:"calc(100vh - 49px)",display:"flex",flexDirection:"column"},children:[n.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${(i==null?void 0:i.border)||"#27272a"}`,display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:(i==null?void 0:i.bgCard)||"#18181b",flexShrink:0},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[n.jsx("button",{onClick:b,style:{background:"none",border:"none",color:(i==null?void 0:i.textSecondary)||"#a1a1aa",cursor:"pointer",fontSize:"20px",padding:"4px 8px",display:"flex",alignItems:"center"},children:""}),n.jsx("h1",{style:{fontSize:"16px",fontWeight:"600",color:(i==null?void 0:i.text)||"#fafafa",margin:0},children:u?"Create Automation":`Edit: ${(p==null?void 0:p.name)||"Automation"}`})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[!u&&n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n.jsx("span",{style:{fontSize:"13px",color:(i==null?void 0:i.textSecondary)||"#a1a1aa"},children:S.status==="active"?"Active":"Inactive"}),n.jsx("button",{onClick:P,disabled:w.isPending||I.isPending,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:S.status==="active"?(i==null?void 0:i.success)||"#22c55e":(i==null?void 0:i.bgHover)||"#27272a",cursor:"pointer",position:"relative",transition:"background-color 0.2s",opacity:w.isPending||I.isPending?.6:1},children:n.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:S.status==="active"?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})})]}),n.jsx("button",{onClick:()=>C(S),disabled:x.isPending||M.isPending,style:{padding:"8px 16px",backgroundColor:(i==null?void 0:i.primary)||"#3b82f6",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",opacity:x.isPending||M.isPending?.7:1},children:x.isPending||M.isPending?"Saving...":u?"Create":"Save Changes"})]})]}),n.jsx("div",{style:{flex:1,overflow:"hidden"},children:n.jsx(ca,{t:i,automation:S,onUpdate:j,onSave:C})})]})};function ua(i,s){const r=O.useRef(s);O.useEffect(function(){s!==r.current&&i.attributionControl!=null&&(r.current!=null&&i.attributionControl.removeAttribution(r.current),s!=null&&i.attributionControl.addAttribution(s)),r.current=s},[i,s])}function pa(i,s,r){s.center!==r.center&&i.setLatLng(s.center),s.radius!=null&&s.radius!==r.radius&&i.setRadius(s.radius)}const ha=1;function fa(i){return Object.freeze({__version:ha,map:i})}function Po(i,s){return Object.freeze({...i,...s})}const Lo=O.createContext(null),Ro=Lo.Provider;function Hi(){const i=O.useContext(Lo);if(i==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return i}function Mo(i){function s(r,l){const{instance:d,context:u}=i(r).current;return O.useImperativeHandle(l,()=>d),r.children==null?null:Fe.createElement(Ro,{value:u},r.children)}return O.forwardRef(s)}function xa(i){function s(r,l){const{instance:d}=i(r).current;return O.useImperativeHandle(l,()=>d),null}return O.forwardRef(s)}function Io(i,s){const r=O.useRef();O.useEffect(function(){return s!=null&&i.instance.on(s),r.current=s,function(){r.current!=null&&i.instance.off(r.current),r.current=null}},[i,s])}function Ui(i,s){const r=i.pane??s.pane;return r?{...i,pane:r}:i}var Ni={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(i,s){(function(r,l){l(s)})(ds,function(r){var l="1.9.4";function d(e){var t,o,a,c;for(o=1,a=arguments.length;o<a;o++){c=arguments[o];for(t in c)e[t]=c[t]}return e}var u=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}();function p(e,t){var o=Array.prototype.slice;if(e.bind)return e.bind.apply(e,o.call(arguments,1));var a=o.call(arguments,2);return function(){return e.apply(t,a.length?a.concat(o.call(arguments)):arguments)}}var f=0;function m(e){return"_leaflet_id"in e||(e._leaflet_id=++f),e._leaflet_id}function x(e,t,o){var a,c,h,g;return g=function(){a=!1,c&&(h.apply(o,c),c=!1)},h=function(){a?c=arguments:(e.apply(o,arguments),setTimeout(g,t),a=!0)},h}function M(e,t,o){var a=t[1],c=t[0],h=a-c;return e===a&&o?e:((e-c)%h+h)%h+c}function w(){return!1}function I(e,t){if(t===!1)return e;var o=Math.pow(10,t===void 0?6:t);return Math.round(e*o)/o}function P(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function S(e){return P(e).split(/\s+/)}function j(e,t){Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?u(e.options):{});for(var o in t)e.options[o]=t[o];return e.options}function C(e,t,o){var a=[];for(var c in e)a.push(encodeURIComponent(o?c.toUpperCase():c)+"="+encodeURIComponent(e[c]));return(!t||t.indexOf("?")===-1?"?":"&")+a.join("&")}var b=/\{ *([\w_ -]+) *\}/g;function q(e,t){return e.replace(b,function(o,a){var c=t[a];if(c===void 0)throw new Error("No value provided for variable "+o);return typeof c=="function"&&(c=c(t)),c})}var Z=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function E(e,t){for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1}var k="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function D(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var V=0;function K(e){var t=+new Date,o=Math.max(0,16-(t-V));return V=t+o,window.setTimeout(e,o)}var ae=window.requestAnimationFrame||D("RequestAnimationFrame")||K,X=window.cancelAnimationFrame||D("CancelAnimationFrame")||D("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function _(e,t,o){if(o&&ae===K)e.call(t);else return ae.call(window,p(e,t))}function z(e){e&&X.call(window,e)}var B={__proto__:null,extend:d,create:u,bind:p,get lastId(){return f},stamp:m,throttle:x,wrapNum:M,falseFn:w,formatNum:I,trim:P,splitWords:S,setOptions:j,getParamString:C,template:q,isArray:Z,indexOf:E,emptyImageUrl:k,requestFn:ae,cancelFn:X,requestAnimFrame:_,cancelAnimFrame:z};function R(){}R.extend=function(e){var t=function(){j(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},o=t.__super__=this.prototype,a=u(o);a.constructor=t,t.prototype=a;for(var c in this)Object.prototype.hasOwnProperty.call(this,c)&&c!=="prototype"&&c!=="__super__"&&(t[c]=this[c]);return e.statics&&d(t,e.statics),e.includes&&($(e.includes),d.apply(null,[a].concat(e.includes))),d(a,e),delete a.statics,delete a.includes,a.options&&(a.options=o.options?u(o.options):{},d(a.options,e.options)),a._initHooks=[],a.callInitHooks=function(){if(!this._initHooksCalled){o.callInitHooks&&o.callInitHooks.call(this),this._initHooksCalled=!0;for(var h=0,g=a._initHooks.length;h<g;h++)a._initHooks[h].call(this)}},t},R.include=function(e){var t=this.prototype.options;return d(this.prototype,e),e.options&&(this.prototype.options=t,this.mergeOptions(e.options)),this},R.mergeOptions=function(e){return d(this.prototype.options,e),this},R.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),o=typeof e=="function"?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(o),this};function $(e){if(!(typeof L>"u"||!L||!L.Mixin)){e=Z(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var U={on:function(e,t,o){if(typeof e=="object")for(var a in e)this._on(a,e[a],t);else{e=S(e);for(var c=0,h=e.length;c<h;c++)this._on(e[c],t,o)}return this},off:function(e,t,o){if(!arguments.length)delete this._events;else if(typeof e=="object")for(var a in e)this._off(a,e[a],t);else{e=S(e);for(var c=arguments.length===1,h=0,g=e.length;h<g;h++)c?this._off(e[h]):this._off(e[h],t,o)}return this},_on:function(e,t,o,a){if(typeof t!="function"){console.warn("wrong listener type: "+typeof t);return}if(this._listens(e,t,o)===!1){o===this&&(o=void 0);var c={fn:t,ctx:o};a&&(c.once=!0),this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(c)}},_off:function(e,t,o){var a,c,h;if(this._events&&(a=this._events[e],!!a)){if(arguments.length===1){if(this._firingCount)for(c=0,h=a.length;c<h;c++)a[c].fn=w;delete this._events[e];return}if(typeof t!="function"){console.warn("wrong listener type: "+typeof t);return}var g=this._listens(e,t,o);if(g!==!1){var y=a[g];this._firingCount&&(y.fn=w,this._events[e]=a=a.slice()),a.splice(g,1)}}},fire:function(e,t,o){if(!this.listens(e,o))return this;var a=d({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var c=this._events[e];if(c){this._firingCount=this._firingCount+1||1;for(var h=0,g=c.length;h<g;h++){var y=c[h],v=y.fn;y.once&&this.off(e,v,y.ctx),v.call(y.ctx||this,a)}this._firingCount--}}return o&&this._propagateEvent(a),this},listens:function(e,t,o,a){typeof e!="string"&&console.warn('"string" type argument expected');var c=t;typeof t!="function"&&(a=!!t,c=void 0,o=void 0);var h=this._events&&this._events[e];if(h&&h.length&&this._listens(e,c,o)!==!1)return!0;if(a){for(var g in this._eventParents)if(this._eventParents[g].listens(e,t,o,a))return!0}return!1},_listens:function(e,t,o){if(!this._events)return!1;var a=this._events[e]||[];if(!t)return!!a.length;o===this&&(o=void 0);for(var c=0,h=a.length;c<h;c++)if(a[c].fn===t&&a[c].ctx===o)return c;return!1},once:function(e,t,o){if(typeof e=="object")for(var a in e)this._on(a,e[a],t,!0);else{e=S(e);for(var c=0,h=e.length;c<h;c++)this._on(e[c],t,o,!0)}return this},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[m(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[m(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,d({layer:e.target,propagatedFrom:e.target},e),!0)}};U.addEventListener=U.on,U.removeEventListener=U.clearAllEventListeners=U.off,U.addOneTimeEventListener=U.once,U.fireEvent=U.fire,U.hasEventListeners=U.listens;var te=R.extend(U);function H(e,t,o){this.x=o?Math.round(e):e,this.y=o?Math.round(t):t}var we=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};H.prototype={clone:function(){return new H(this.x,this.y)},add:function(e){return this.clone()._add(W(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(W(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new H(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new H(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=we(this.x),this.y=we(this.y),this},distanceTo:function(e){e=W(e);var t=e.x-this.x,o=e.y-this.y;return Math.sqrt(t*t+o*o)},equals:function(e){return e=W(e),e.x===this.x&&e.y===this.y},contains:function(e){return e=W(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+I(this.x)+", "+I(this.y)+")"}};function W(e,t,o){return e instanceof H?e:Z(e)?new H(e[0],e[1]):e==null?e:typeof e=="object"&&"x"in e&&"y"in e?new H(e.x,e.y):new H(e,t,o)}function ne(e,t){if(e)for(var o=t?[e,t]:e,a=0,c=o.length;a<c;a++)this.extend(o[a])}ne.prototype={extend:function(e){var t,o;if(!e)return this;if(e instanceof H||typeof e[0]=="number"||"x"in e)t=o=W(e);else if(e=se(e),t=e.min,o=e.max,!t||!o)return this;return!this.min&&!this.max?(this.min=t.clone(),this.max=o.clone()):(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(o.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(o.y,this.max.y)),this},getCenter:function(e){return W((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return W(this.min.x,this.max.y)},getTopRight:function(){return W(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,o;return typeof e[0]=="number"||e instanceof H?e=W(e):e=se(e),e instanceof ne?(t=e.min,o=e.max):t=o=e,t.x>=this.min.x&&o.x<=this.max.x&&t.y>=this.min.y&&o.y<=this.max.y},intersects:function(e){e=se(e);var t=this.min,o=this.max,a=e.min,c=e.max,h=c.x>=t.x&&a.x<=o.x,g=c.y>=t.y&&a.y<=o.y;return h&&g},overlaps:function(e){e=se(e);var t=this.min,o=this.max,a=e.min,c=e.max,h=c.x>t.x&&a.x<o.x,g=c.y>t.y&&a.y<o.y;return h&&g},isValid:function(){return!!(this.min&&this.max)},pad:function(e){var t=this.min,o=this.max,a=Math.abs(t.x-o.x)*e,c=Math.abs(t.y-o.y)*e;return se(W(t.x-a,t.y-c),W(o.x+a,o.y+c))},equals:function(e){return e?(e=se(e),this.min.equals(e.getTopLeft())&&this.max.equals(e.getBottomRight())):!1}};function se(e,t){return!e||e instanceof ne?e:new ne(e,t)}function ve(e,t){if(e)for(var o=t?[e,t]:e,a=0,c=o.length;a<c;a++)this.extend(o[a])}ve.prototype={extend:function(e){var t=this._southWest,o=this._northEast,a,c;if(e instanceof re)a=e,c=e;else if(e instanceof ve){if(a=e._southWest,c=e._northEast,!a||!c)return this}else return e?this.extend(ee(e)||ue(e)):this;return!t&&!o?(this._southWest=new re(a.lat,a.lng),this._northEast=new re(c.lat,c.lng)):(t.lat=Math.min(a.lat,t.lat),t.lng=Math.min(a.lng,t.lng),o.lat=Math.max(c.lat,o.lat),o.lng=Math.max(c.lng,o.lng)),this},pad:function(e){var t=this._southWest,o=this._northEast,a=Math.abs(t.lat-o.lat)*e,c=Math.abs(t.lng-o.lng)*e;return new ve(new re(t.lat-a,t.lng-c),new re(o.lat+a,o.lng+c))},getCenter:function(){return new re((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new re(this.getNorth(),this.getWest())},getSouthEast:function(){return new re(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){typeof e[0]=="number"||e instanceof re||"lat"in e?e=ee(e):e=ue(e);var t=this._southWest,o=this._northEast,a,c;return e instanceof ve?(a=e.getSouthWest(),c=e.getNorthEast()):a=c=e,a.lat>=t.lat&&c.lat<=o.lat&&a.lng>=t.lng&&c.lng<=o.lng},intersects:function(e){e=ue(e);var t=this._southWest,o=this._northEast,a=e.getSouthWest(),c=e.getNorthEast(),h=c.lat>=t.lat&&a.lat<=o.lat,g=c.lng>=t.lng&&a.lng<=o.lng;return h&&g},overlaps:function(e){e=ue(e);var t=this._southWest,o=this._northEast,a=e.getSouthWest(),c=e.getNorthEast(),h=c.lat>t.lat&&a.lat<o.lat,g=c.lng>t.lng&&a.lng<o.lng;return h&&g},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return e?(e=ue(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ue(e,t){return e instanceof ve?e:new ve(e,t)}function re(e,t,o){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,o!==void 0&&(this.alt=+o)}re.prototype={equals:function(e,t){if(!e)return!1;e=ee(e);var o=Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng));return o<=(t===void 0?1e-9:t)},toString:function(e){return"LatLng("+I(this.lat,e)+", "+I(this.lng,e)+")"},distanceTo:function(e){return Ee.distance(this,ee(e))},wrap:function(){return Ee.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,o=t/Math.cos(Math.PI/180*this.lat);return ue([this.lat-t,this.lng-o],[this.lat+t,this.lng+o])},clone:function(){return new re(this.lat,this.lng,this.alt)}};function ee(e,t,o){return e instanceof re?e:Z(e)&&typeof e[0]!="object"?e.length===3?new re(e[0],e[1],e[2]):e.length===2?new re(e[0],e[1]):null:e==null?e:typeof e=="object"&&"lat"in e?new re(e.lat,"lng"in e?e.lng:e.lon,e.alt):t===void 0?null:new re(e,t,o)}var Re={latLngToPoint:function(e,t){var o=this.projection.project(e),a=this.scale(t);return this.transformation._transform(o,a)},pointToLatLng:function(e,t){var o=this.scale(t),a=this.transformation.untransform(e,o);return this.projection.unproject(a)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,o=this.scale(e),a=this.transformation.transform(t.min,o),c=this.transformation.transform(t.max,o);return new ne(a,c)},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?M(e.lng,this.wrapLng,!0):e.lng,o=this.wrapLat?M(e.lat,this.wrapLat,!0):e.lat,a=e.alt;return new re(o,t,a)},wrapLatLngBounds:function(e){var t=e.getCenter(),o=this.wrapLatLng(t),a=t.lat-o.lat,c=t.lng-o.lng;if(a===0&&c===0)return e;var h=e.getSouthWest(),g=e.getNorthEast(),y=new re(h.lat-a,h.lng-c),v=new re(g.lat-a,g.lng-c);return new ve(y,v)}},Ee=d({},Re,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var o=Math.PI/180,a=e.lat*o,c=t.lat*o,h=Math.sin((t.lat-e.lat)*o/2),g=Math.sin((t.lng-e.lng)*o/2),y=h*h+Math.cos(a)*Math.cos(c)*g*g,v=2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y));return this.R*v}}),xt=6378137,ke={R:xt,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,o=this.MAX_LATITUDE,a=Math.max(Math.min(o,e.lat),-o),c=Math.sin(a*t);return new H(this.R*e.lng*t,this.R*Math.log((1+c)/(1-c))/2)},unproject:function(e){var t=180/Math.PI;return new re((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:function(){var e=xt*Math.PI;return new ne([-e,-e],[e,e])}()};function he(e,t,o,a){if(Z(e)){this._a=e[0],this._b=e[1],this._c=e[2],this._d=e[3];return}this._a=e,this._b=t,this._c=o,this._d=a}he.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new H((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};function Me(e,t,o,a){return new he(e,t,o,a)}var oi=d({},Ee,{code:"EPSG:3857",projection:ke,transformation:function(){var e=.5/(Math.PI*ke.R);return Me(e,.5,-e,.5)}()}),Bo=d({},oi,{code:"EPSG:900913"});function Yi(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Qi(e,t){var o="",a,c,h,g,y,v;for(a=0,h=e.length;a<h;a++){for(y=e[a],c=0,g=y.length;c<g;c++)v=y[c],o+=(c?"L":"M")+v.x+" "+v.y;o+=t?F.svg?"z":"x":""}return o||"M0 0"}var ri=document.documentElement.style,It="ActiveXObject"in window,Oo=It&&!document.addEventListener,Ji="msLaunchUri"in navigator&&!("documentMode"in document),si=Be("webkit"),Xi=Be("android"),en=Be("android 2")||Be("android 3"),Do=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Wo=Xi&&Be("Google")&&Do<537&&!("AudioNode"in window),ai=!!window.opera,tn=!Ji&&Be("chrome"),nn=Be("gecko")&&!si&&!ai&&!It,qo=!tn&&Be("safari"),on=Be("phantom"),rn="OTransition"in ri,No=navigator.platform.indexOf("Win")===0,sn=It&&"transition"in ri,li="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!en,an="MozPerspective"in ri,Zo=!window.L_DISABLE_3D&&(sn||li||an)&&!rn&&!on,mt=typeof orientation<"u"||Be("mobile"),$o=mt&&si,Fo=mt&&li,ln=!window.PointerEvent&&window.MSPointerEvent,dn=!!(window.PointerEvent||ln),cn="ontouchstart"in window||!!window.TouchEvent,Ho=!window.L_NO_TOUCH&&(cn||dn),Uo=mt&&ai,Go=mt&&nn,Vo=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ko=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",w,t),window.removeEventListener("testPassiveEventSupport",w,t)}catch{}return e}(),Yo=function(){return!!document.createElement("canvas").getContext}(),di=!!(document.createElementNS&&Yi("svg").createSVGRect),Qo=!!di&&function(){var e=document.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Jo=!di&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&typeof t.adj=="object"}catch{return!1}}(),Xo=navigator.platform.indexOf("Mac")===0,er=navigator.platform.indexOf("Linux")===0;function Be(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var F={ie:It,ielt9:Oo,edge:Ji,webkit:si,android:Xi,android23:en,androidStock:Wo,opera:ai,chrome:tn,gecko:nn,safari:qo,phantom:on,opera12:rn,win:No,ie3d:sn,webkit3d:li,gecko3d:an,any3d:Zo,mobile:mt,mobileWebkit:$o,mobileWebkit3d:Fo,msPointer:ln,pointer:dn,touch:Ho,touchNative:cn,mobileOpera:Uo,mobileGecko:Go,retina:Vo,passiveEvents:Ko,canvas:Yo,svg:di,vml:Jo,inlineSvg:Qo,mac:Xo,linux:er},un=F.msPointer?"MSPointerDown":"pointerdown",pn=F.msPointer?"MSPointerMove":"pointermove",hn=F.msPointer?"MSPointerUp":"pointerup",fn=F.msPointer?"MSPointerCancel":"pointercancel",ci={touchstart:un,touchmove:pn,touchend:hn,touchcancel:fn},xn={touchstart:sr,touchmove:At,touchend:At,touchcancel:At},it={},mn=!1;function tr(e,t,o){return t==="touchstart"&&rr(),xn[t]?(o=xn[t].bind(this,o),e.addEventListener(ci[t],o,!1),o):(console.warn("wrong event specified:",t),w)}function ir(e,t,o){if(!ci[t]){console.warn("wrong event specified:",t);return}e.removeEventListener(ci[t],o,!1)}function nr(e){it[e.pointerId]=e}function or(e){it[e.pointerId]&&(it[e.pointerId]=e)}function gn(e){delete it[e.pointerId]}function rr(){mn||(document.addEventListener(un,nr,!0),document.addEventListener(pn,or,!0),document.addEventListener(hn,gn,!0),document.addEventListener(fn,gn,!0),mn=!0)}function At(e,t){if(t.pointerType!==(t.MSPOINTER_TYPE_MOUSE||"mouse")){t.touches=[];for(var o in it)t.touches.push(it[o]);t.changedTouches=[t],e(t)}}function sr(e,t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&_e(t),At(e,t)}function ar(e){var t={},o,a;for(a in e)o=e[a],t[a]=o&&o.bind?o.bind(e):o;return e=t,t.type="dblclick",t.detail=2,t.isTrusted=!1,t._simulated=!0,t}var lr=200;function dr(e,t){e.addEventListener("dblclick",t);var o=0,a;function c(h){if(h.detail!==1){a=h.detail;return}if(!(h.pointerType==="mouse"||h.sourceCapabilities&&!h.sourceCapabilities.firesTouchEvents)){var g=wn(h);if(!(g.some(function(v){return v instanceof HTMLLabelElement&&v.attributes.for})&&!g.some(function(v){return v instanceof HTMLInputElement||v instanceof HTMLSelectElement}))){var y=Date.now();y-o<=lr?(a++,a===2&&t(ar(h))):a=1,o=y}}}return e.addEventListener("click",c),{dblclick:t,simDblclick:c}}function cr(e,t){e.removeEventListener("dblclick",t.dblclick),e.removeEventListener("click",t.simDblclick)}var ui=Ot(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),gt=Ot(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),_n=gt==="webkitTransition"||gt==="OTransition"?gt+"End":"transitionend";function yn(e){return typeof e=="string"?document.getElementById(e):e}function _t(e,t){var o=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!o||o==="auto")&&document.defaultView){var a=document.defaultView.getComputedStyle(e,null);o=a?a[t]:null}return o==="auto"?null:o}function oe(e,t,o){var a=document.createElement(e);return a.className=t||"",o&&o.appendChild(a),a}function ce(e){var t=e.parentNode;t&&t.removeChild(e)}function Et(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function nt(e){var t=e.parentNode;t&&t.lastChild!==e&&t.appendChild(e)}function ot(e){var t=e.parentNode;t&&t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function pi(e,t){if(e.classList!==void 0)return e.classList.contains(t);var o=Bt(e);return o.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(o)}function Q(e,t){if(e.classList!==void 0)for(var o=S(t),a=0,c=o.length;a<c;a++)e.classList.add(o[a]);else if(!pi(e,t)){var h=Bt(e);hi(e,(h?h+" ":"")+t)}}function pe(e,t){e.classList!==void 0?e.classList.remove(t):hi(e,P((" "+Bt(e)+" ").replace(" "+t+" "," ")))}function hi(e,t){e.className.baseVal===void 0?e.className=t:e.className.baseVal=t}function Bt(e){return e.correspondingElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function ze(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&ur(e,t)}function ur(e,t){var o=!1,a="DXImageTransform.Microsoft.Alpha";try{o=e.filters.item(a)}catch{if(t===1)return}t=Math.round(t*100),o?(o.Enabled=t!==100,o.Opacity=t):e.style.filter+=" progid:"+a+"(opacity="+t+")"}function Ot(e){for(var t=document.documentElement.style,o=0;o<e.length;o++)if(e[o]in t)return e[o];return!1}function Ve(e,t,o){var a=t||new H(0,0);e.style[ui]=(F.ie3d?"translate("+a.x+"px,"+a.y+"px)":"translate3d("+a.x+"px,"+a.y+"px,0)")+(o?" scale("+o+")":"")}function fe(e,t){e._leaflet_pos=t,F.any3d?Ve(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function Ke(e){return e._leaflet_pos||new H(0,0)}var yt,vt,fi;if("onselectstart"in document)yt=function(){Y(window,"selectstart",_e)},vt=function(){le(window,"selectstart",_e)};else{var bt=Ot(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);yt=function(){if(bt){var e=document.documentElement.style;fi=e[bt],e[bt]="none"}},vt=function(){bt&&(document.documentElement.style[bt]=fi,fi=void 0)}}function xi(){Y(window,"dragstart",_e)}function mi(){le(window,"dragstart",_e)}var Dt,gi;function _i(e){for(;e.tabIndex===-1;)e=e.parentNode;e.style&&(Wt(),Dt=e,gi=e.style.outlineStyle,e.style.outlineStyle="none",Y(window,"keydown",Wt))}function Wt(){Dt&&(Dt.style.outlineStyle=gi,Dt=void 0,gi=void 0,le(window,"keydown",Wt))}function vn(e){do e=e.parentNode;while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function yi(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}var pr={__proto__:null,TRANSFORM:ui,TRANSITION:gt,TRANSITION_END:_n,get:yn,getStyle:_t,create:oe,remove:ce,empty:Et,toFront:nt,toBack:ot,hasClass:pi,addClass:Q,removeClass:pe,setClass:hi,getClass:Bt,setOpacity:ze,testProp:Ot,setTransform:Ve,setPosition:fe,getPosition:Ke,get disableTextSelection(){return yt},get enableTextSelection(){return vt},disableImageDrag:xi,enableImageDrag:mi,preventOutline:_i,restoreOutline:Wt,getSizedParentNode:vn,getScale:yi};function Y(e,t,o,a){if(t&&typeof t=="object")for(var c in t)bi(e,c,t[c],o);else{t=S(t);for(var h=0,g=t.length;h<g;h++)bi(e,t[h],o,a)}return this}var Oe="_leaflet_events";function le(e,t,o,a){if(arguments.length===1)bn(e),delete e[Oe];else if(t&&typeof t=="object")for(var c in t)wi(e,c,t[c],o);else if(t=S(t),arguments.length===2)bn(e,function(y){return E(t,y)!==-1});else for(var h=0,g=t.length;h<g;h++)wi(e,t[h],o,a);return this}function bn(e,t){for(var o in e[Oe]){var a=o.split(/\d/)[0];(!t||t(a))&&wi(e,a,null,null,o)}}var vi={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function bi(e,t,o,a){var c=t+m(o)+(a?"_"+m(a):"");if(e[Oe]&&e[Oe][c])return this;var h=function(y){return o.call(a||e,y||window.event)},g=h;!F.touchNative&&F.pointer&&t.indexOf("touch")===0?h=tr(e,t,h):F.touch&&t==="dblclick"?h=dr(e,h):"addEventListener"in e?t==="touchstart"||t==="touchmove"||t==="wheel"||t==="mousewheel"?e.addEventListener(vi[t]||t,h,F.passiveEvents?{passive:!1}:!1):t==="mouseenter"||t==="mouseleave"?(h=function(y){y=y||window.event,ji(e,y)&&g(y)},e.addEventListener(vi[t],h,!1)):e.addEventListener(t,g,!1):e.attachEvent("on"+t,h),e[Oe]=e[Oe]||{},e[Oe][c]=h}function wi(e,t,o,a,c){c=c||t+m(o)+(a?"_"+m(a):"");var h=e[Oe]&&e[Oe][c];if(!h)return this;!F.touchNative&&F.pointer&&t.indexOf("touch")===0?ir(e,t,h):F.touch&&t==="dblclick"?cr(e,h):"removeEventListener"in e?e.removeEventListener(vi[t]||t,h,!1):e.detachEvent("on"+t,h),e[Oe][c]=null}function Ye(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function Si(e){return bi(e,"wheel",Ye),this}function wt(e){return Y(e,"mousedown touchstart dblclick contextmenu",Ye),e._leaflet_disable_click=!0,this}function _e(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function Qe(e){return _e(e),Ye(e),this}function wn(e){if(e.composedPath)return e.composedPath();for(var t=[],o=e.target;o;)t.push(o),o=o.parentNode;return t}function Sn(e,t){if(!t)return new H(e.clientX,e.clientY);var o=yi(t),a=o.boundingClientRect;return new H((e.clientX-a.left)/o.x-t.clientLeft,(e.clientY-a.top)/o.y-t.clientTop)}var hr=F.linux&&F.chrome?window.devicePixelRatio:F.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function jn(e){return F.edge?e.wheelDeltaY/2:e.deltaY&&e.deltaMode===0?-e.deltaY/hr:e.deltaY&&e.deltaMode===1?-e.deltaY*20:e.deltaY&&e.deltaMode===2?-e.deltaY*60:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?-e.detail*20:e.detail?e.detail/-32765*60:0}function ji(e,t){var o=t.relatedTarget;if(!o)return!0;try{for(;o&&o!==e;)o=o.parentNode}catch{return!1}return o!==e}var fr={__proto__:null,on:Y,off:le,stopPropagation:Ye,disableScrollPropagation:Si,disableClickPropagation:wt,preventDefault:_e,stop:Qe,getPropagationPath:wn,getMousePosition:Sn,getWheelDelta:jn,isExternalTarget:ji,addListener:Y,removeListener:le},Cn=te.extend({run:function(e,t,o,a){this.stop(),this._el=e,this._inProgress=!0,this._duration=o||.25,this._easeOutPower=1/Math.max(a||.5,.2),this._startPos=Ke(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=_(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,o=this._duration*1e3;t<o?this._runFrame(this._easeOut(t/o),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var o=this._startPos.add(this._offset.multiplyBy(e));t&&o._round(),fe(this._el,o),this.fire("step")},_complete:function(){z(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),ie=te.extend({options:{crs:oi,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,t){t=j(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=p(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),t.zoom!==void 0&&(this._zoom=this._limitZoom(t.zoom)),t.center&&t.zoom!==void 0&&this.setView(ee(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=gt&&F.any3d&&!F.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Y(this._proxy,_n,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,t,o){if(t=t===void 0?this._zoom:this._limitZoom(t),e=this._limitCenter(ee(e),t,this.options.maxBounds),o=o||{},this._stop(),this._loaded&&!o.reset&&o!==!0){o.animate!==void 0&&(o.zoom=d({animate:o.animate},o.zoom),o.pan=d({animate:o.animate,duration:o.duration},o.pan));var a=this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,o.zoom):this._tryAnimatedPan(e,o.pan);if(a)return clearTimeout(this._sizeTimer),this}return this._resetView(e,t,o.pan&&o.pan.noMoveStart),this},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=e,this)},zoomIn:function(e,t){return e=e||(F.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,t)},zoomOut:function(e,t){return e=e||(F.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,t)},setZoomAround:function(e,t,o){var a=this.getZoomScale(t),c=this.getSize().divideBy(2),h=e instanceof H?e:this.latLngToContainerPoint(e),g=h.subtract(c).multiplyBy(1-1/a),y=this.containerPointToLatLng(c.add(g));return this.setView(y,t,{zoom:o})},_getBoundsCenterZoom:function(e,t){t=t||{},e=e.getBounds?e.getBounds():ue(e);var o=W(t.paddingTopLeft||t.padding||[0,0]),a=W(t.paddingBottomRight||t.padding||[0,0]),c=this.getBoundsZoom(e,!1,o.add(a));if(c=typeof t.maxZoom=="number"?Math.min(t.maxZoom,c):c,c===1/0)return{center:e.getCenter(),zoom:c};var h=a.subtract(o).divideBy(2),g=this.project(e.getSouthWest(),c),y=this.project(e.getNorthEast(),c),v=this.unproject(g.add(y).divideBy(2).add(h),c);return{center:v,zoom:c}},fitBounds:function(e,t){if(e=ue(e),!e.isValid())throw new Error("Bounds are not valid.");var o=this._getBoundsCenterZoom(e,t);return this.setView(o.center,o.zoom,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e,t){if(e=W(e).round(),t=t||{},!e.x&&!e.y)return this.fire("moveend");if(t.animate!==!0&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Cn,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart"),t.animate!==!1){Q(this._mapPane,"leaflet-pan-anim");var o=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,o,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,t,o){if(o=o||{},o.animate===!1||!F.any3d)return this.setView(e,t,o);this._stop();var a=this.project(this.getCenter()),c=this.project(e),h=this.getSize(),g=this._zoom;e=ee(e),t=t===void 0?g:t;var y=Math.max(h.x,h.y),v=y*this.getZoomScale(g,t),A=c.distanceTo(a)||1,N=1.42,G=N*N;function J(xe){var Qt=xe?-1:1,is=xe?v:y,ns=v*v-y*y+Qt*G*G*A*A,os=2*is*G*A,Ei=ns/os,ro=Math.sqrt(Ei*Ei+1)-Ei,rs=ro<1e-9?-18:Math.log(ro);return rs}function be(xe){return(Math.exp(xe)-Math.exp(-xe))/2}function me(xe){return(Math.exp(xe)+Math.exp(-xe))/2}function Pe(xe){return be(xe)/me(xe)}var Se=J(0);function ct(xe){return y*(me(Se)/me(Se+N*xe))}function Jr(xe){return y*(me(Se)*Pe(Se+N*xe)-be(Se))/G}function Xr(xe){return 1-Math.pow(1-xe,1.5)}var es=Date.now(),no=(J(1)-Se)/N,ts=o.duration?1e3*o.duration:1e3*no*.8;function oo(){var xe=(Date.now()-es)/ts,Qt=Xr(xe)*no;xe<=1?(this._flyToFrame=_(oo,this),this._move(this.unproject(a.add(c.subtract(a).multiplyBy(Jr(Qt)/A)),g),this.getScaleZoom(y/ct(Qt),g),{flyTo:!0})):this._move(e,t)._moveEnd(!0)}return this._moveStart(!0,o.noMoveStart),oo.call(this),this},flyToBounds:function(e,t){var o=this._getBoundsCenterZoom(e,t);return this.flyTo(o.center,o.zoom,t)},setMaxBounds:function(e){return e=ue(e),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),e.isValid()?(this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(e){var t=this.options.minZoom;return this.options.minZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var t=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,t){this._enforcingBounds=!0;var o=this.getCenter(),a=this._limitCenter(o,this._zoom,ue(e));return o.equals(a)||this.panTo(a,t),this._enforcingBounds=!1,this},panInside:function(e,t){t=t||{};var o=W(t.paddingTopLeft||t.padding||[0,0]),a=W(t.paddingBottomRight||t.padding||[0,0]),c=this.project(this.getCenter()),h=this.project(e),g=this.getPixelBounds(),y=se([g.min.add(o),g.max.subtract(a)]),v=y.getSize();if(!y.contains(h)){this._enforcingBounds=!0;var A=h.subtract(y.getCenter()),N=y.extend(h).getSize().subtract(v);c.x+=A.x<0?-N.x:N.x,c.y+=A.y<0?-N.y:N.y,this.panTo(this.unproject(c),t),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=d({animate:!1,pan:!0},e===!0?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var o=this.getSize(),a=t.divideBy(2).round(),c=o.divideBy(2).round(),h=a.subtract(c);return!h.x&&!h.y?this:(e.animate&&e.pan?this.panBy(h):(e.pan&&this._rawPanBy(h),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(p(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:o}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=d({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=p(this._handleGeolocationResponse,this),o=p(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,o,e):navigator.geolocation.getCurrentPosition(t,o,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var t=e.code,o=e.message||(t===1?"permission denied":t===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+o+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var t=e.coords.latitude,o=e.coords.longitude,a=new re(t,o),c=a.toBounds(e.coords.accuracy*2),h=this._locateOptions;if(h.setView){var g=this.getBoundsZoom(c);this.setView(a,h.maxZoom?Math.min(g,h.maxZoom):g)}var y={latlng:a,bounds:c,timestamp:e.timestamp};for(var v in e.coords)typeof e.coords[v]=="number"&&(y[v]=e.coords[v]);this.fire("locationfound",y)}},addHandler:function(e,t){if(!t)return this;var o=this[e]=new t(this);return this._handlers.push(o),this.options[e]&&o.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),ce(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(z(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var e;for(e in this._layers)this._layers[e].remove();for(e in this._panes)ce(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,t){var o="leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),a=oe("div",o,t||this._mapPane);return e&&(this._panes[e]=a),a},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds(),t=this.unproject(e.getBottomLeft()),o=this.unproject(e.getTopRight());return new ve(t,o)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,o){e=ue(e),o=W(o||[0,0]);var a=this.getZoom()||0,c=this.getMinZoom(),h=this.getMaxZoom(),g=e.getNorthWest(),y=e.getSouthEast(),v=this.getSize().subtract(o),A=se(this.project(y,a),this.project(g,a)).getSize(),N=F.any3d?this.options.zoomSnap:1,G=v.x/A.x,J=v.y/A.y,be=t?Math.max(G,J):Math.min(G,J);return a=this.getScaleZoom(be,a),N&&(a=Math.round(a/(N/100))*(N/100),a=t?Math.ceil(a/N)*N:Math.floor(a/N)*N),Math.max(c,Math.min(h,a))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new H(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,t){var o=this._getTopLeftPoint(e,t);return new ne(o,o.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(e===void 0?this.getZoom():e)},getPane:function(e){return typeof e=="string"?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,t){var o=this.options.crs;return t=t===void 0?this._zoom:t,o.scale(e)/o.scale(t)},getScaleZoom:function(e,t){var o=this.options.crs;t=t===void 0?this._zoom:t;var a=o.zoom(e*o.scale(t));return isNaN(a)?1/0:a},project:function(e,t){return t=t===void 0?this._zoom:t,this.options.crs.latLngToPoint(ee(e),t)},unproject:function(e,t){return t=t===void 0?this._zoom:t,this.options.crs.pointToLatLng(W(e),t)},layerPointToLatLng:function(e){var t=W(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){var t=this.project(ee(e))._round();return t._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(ee(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(ue(e))},distance:function(e,t){return this.options.crs.distance(ee(e),ee(t))},containerPointToLayerPoint:function(e){return W(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return W(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(W(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(ee(e)))},mouseEventToContainerPoint:function(e){return Sn(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=yn(e);if(t){if(t._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Y(t,"scroll",this._onScroll,this),this._containerId=m(t)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&F.any3d,Q(e,"leaflet-container"+(F.touch?" leaflet-touch":"")+(F.retina?" leaflet-retina":"")+(F.ielt9?" leaflet-oldie":"")+(F.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=_t(e,"position");t!=="absolute"&&t!=="relative"&&t!=="fixed"&&t!=="sticky"&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),fe(this._mapPane,new H(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Q(e.markerPane,"leaflet-zoom-hide"),Q(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,t,o){fe(this._mapPane,new H(0,0));var a=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire("viewprereset");var c=this._zoom!==t;this._moveStart(c,o)._move(e,t)._moveEnd(c),this.fire("viewreset"),a&&this.fire("load")},_moveStart:function(e,t){return e&&this.fire("zoomstart"),t||this.fire("movestart"),this},_move:function(e,t,o,a){t===void 0&&(t=this._zoom);var c=this._zoom!==t;return this._zoom=t,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),a?o&&o.pinch&&this.fire("zoom",o):((c||o&&o.pinch)&&this.fire("zoom",o),this.fire("move",o)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return z(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){fe(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[m(this._container)]=this;var t=e?le:Y;t(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&t(window,"resize",this._onResize,this),F.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){z(this._resizeRequest),this._resizeRequest=_(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,t){for(var o=[],a,c=t==="mouseout"||t==="mouseover",h=e.target||e.srcElement,g=!1;h;){if(a=this._targets[m(h)],a&&(t==="click"||t==="preclick")&&this._draggableMoved(a)){g=!0;break}if(a&&a.listens(t,!0)&&(c&&!ji(h,e)||(o.push(a),c))||h===this._container)break;h=h.parentNode}return!o.length&&!g&&!c&&this.listens(t,!0)&&(o=[this]),o},_isClickDisabled:function(e){for(;e&&e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var t=e.target||e.srcElement;if(!(!this._loaded||t._leaflet_disable_events||e.type==="click"&&this._isClickDisabled(t))){var o=e.type;o==="mousedown"&&_i(t),this._fireDOMEvent(e,o)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,t,o){if(e.type==="click"){var a=d({},e);a.type="preclick",this._fireDOMEvent(a,a.type,o)}var c=this._findEventTargets(e,t);if(o){for(var h=[],g=0;g<o.length;g++)o[g].listens(t,!0)&&h.push(o[g]);c=h.concat(c)}if(c.length){t==="contextmenu"&&_e(e);var y=c[0],v={originalEvent:e};if(e.type!=="keypress"&&e.type!=="keydown"&&e.type!=="keyup"){var A=y.getLatLng&&(!y._radius||y._radius<=10);v.containerPoint=A?this.latLngToContainerPoint(y.getLatLng()):this.mouseEventToContainerPoint(e),v.layerPoint=this.containerPointToLayerPoint(v.containerPoint),v.latlng=A?y.getLatLng():this.layerPointToLatLng(v.layerPoint)}for(g=0;g<c.length;g++)if(c[g].fire(t,v,!0),v.originalEvent._stopped||c[g].options.bubblingMouseEvents===!1&&E(this._mouseEvents,t)!==-1)return}},_draggableMoved:function(e){return e=e.dragging&&e.dragging.enabled()?e:this,e.dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on("load",e,t),this},_getMapPanePos:function(){return Ke(this._mapPane)||new H(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,t){var o=e&&t!==void 0?this._getNewPixelOrigin(e,t):this.getPixelOrigin();return o.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,t){var o=this.getSize()._divideBy(2);return this.project(e,t)._subtract(o)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,t,o){var a=this._getNewPixelOrigin(o,t);return this.project(e,t)._subtract(a)},_latLngBoundsToNewLayerBounds:function(e,t,o){var a=this._getNewPixelOrigin(o,t);return se([this.project(e.getSouthWest(),t)._subtract(a),this.project(e.getNorthWest(),t)._subtract(a),this.project(e.getSouthEast(),t)._subtract(a),this.project(e.getNorthEast(),t)._subtract(a)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,o){if(!o)return e;var a=this.project(e,t),c=this.getSize().divideBy(2),h=new ne(a.subtract(c),a.add(c)),g=this._getBoundsOffset(h,o,t);return Math.abs(g.x)<=1&&Math.abs(g.y)<=1?e:this.unproject(a.add(g),t)},_limitOffset:function(e,t){if(!t)return e;var o=this.getPixelBounds(),a=new ne(o.min.add(e),o.max.add(e));return e.add(this._getBoundsOffset(a,t))},_getBoundsOffset:function(e,t,o){var a=se(this.project(t.getNorthEast(),o),this.project(t.getSouthWest(),o)),c=a.min.subtract(e.min),h=a.max.subtract(e.max),g=this._rebound(c.x,-h.x),y=this._rebound(c.y,-h.y);return new H(g,y)},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),o=this.getMaxZoom(),a=F.any3d?this.options.zoomSnap:1;return a&&(e=Math.round(e/a)*a),Math.max(t,Math.min(o,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){pe(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,t){var o=this._getCenterOffset(e)._trunc();return(t&&t.animate)!==!0&&!this.getSize().contains(o)?!1:(this.panBy(o,t),!0)},_createAnimProxy:function(){var e=this._proxy=oe("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",function(t){var o=ui,a=this._proxy.style[o];Ve(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),a===this._proxy.style[o]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){ce(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),t=this.getZoom();Ve(this._proxy,this.project(e,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,o){if(this._animatingZoom)return!0;if(o=o||{},!this._zoomAnimated||o.animate===!1||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var a=this.getZoomScale(t),c=this._getCenterOffset(e)._divideBy(1-1/a);return o.animate!==!0&&!this.getSize().contains(c)?!1:(_(function(){this._moveStart(!0,o.noMoveStart||!1)._animateZoom(e,t,!0)},this),!0)},_animateZoom:function(e,t,o,a){this._mapPane&&(o&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,Q(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:t,noUpdate:a}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(p(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&pe(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function xr(e,t){return new ie(e,t)}var Ie=R.extend({options:{position:"topright"},initialize:function(e){j(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),o=this.getPosition(),a=e._controlCorners[o];return Q(t,"leaflet-control"),o.indexOf("bottom")!==-1?a.insertBefore(t,a.firstChild):a.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(ce(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),St=function(e){return new Ie(e)};ie.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},t="leaflet-",o=this._controlContainer=oe("div",t+"control-container",this._container);function a(c,h){var g=t+c+" "+t+h;e[c+h]=oe("div",g,o)}a("top","left"),a("top","right"),a("bottom","left"),a("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)ce(this._controlCorners[e]);ce(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var kn=Ie.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,o,a){return o<a?-1:a<o?1:0}},initialize:function(e,t,o){j(this,o),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var a in e)this._addLayer(e[a],a);for(a in t)this._addLayer(t[a],a,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return Ie.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(m(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){Q(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(Q(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):pe(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return pe(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=oe("div",e),o=this.options.collapsed;t.setAttribute("aria-haspopup",!0),wt(t),Si(t);var a=this._section=oe("section",e+"-list");o&&(this._map.on("click",this.collapse,this),Y(t,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var c=this._layersLink=oe("a",e+"-toggle",t);c.href="#",c.title="Layers",c.setAttribute("role","button"),Y(c,{keydown:function(h){h.keyCode===13&&this._expandSafely()},click:function(h){_e(h),this._expandSafely()}},this),o||this.expand(),this._baseLayersList=oe("div",e+"-base",a),this._separator=oe("div",e+"-separator",a),this._overlaysList=oe("div",e+"-overlays",a),t.appendChild(a)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&m(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,o){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:o}),this.options.sortLayers&&this._layers.sort(p(function(a,c){return this.options.sortFunction(a.layer,c.layer,a.name,c.name)},this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Et(this._baseLayersList),Et(this._overlaysList),this._layerControlInputs=[];var e,t,o,a,c=0;for(o=0;o<this._layers.length;o++)a=this._layers[o],this._addItem(a),t=t||a.overlay,e=e||!a.overlay,c+=a.overlay?0:1;return this.options.hideSingleBase&&(e=e&&c>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(m(e.target)),o=t.overlay?e.type==="add"?"overlayadd":"overlayremove":e.type==="add"?"baselayerchange":null;o&&this._map.fire(o,t)},_createRadioElement:function(e,t){var o='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",a=document.createElement("div");return a.innerHTML=o,a.firstChild},_addItem:function(e){var t=document.createElement("label"),o=this._map.hasLayer(e.layer),a;e.overlay?(a=document.createElement("input"),a.type="checkbox",a.className="leaflet-control-layers-selector",a.defaultChecked=o):a=this._createRadioElement("leaflet-base-layers_"+m(this),o),this._layerControlInputs.push(a),a.layerId=m(e.layer),Y(a,"click",this._onInputClick,this);var c=document.createElement("span");c.innerHTML=" "+e.name;var h=document.createElement("span");t.appendChild(h),h.appendChild(a),h.appendChild(c);var g=e.overlay?this._overlaysList:this._baseLayersList;return g.appendChild(t),this._checkDisabledLayers(),t},_onInputClick:function(){if(!this._preventClick){var e=this._layerControlInputs,t,o,a=[],c=[];this._handlingClick=!0;for(var h=e.length-1;h>=0;h--)t=e[h],o=this._getLayer(t.layerId).layer,t.checked?a.push(o):t.checked||c.push(o);for(h=0;h<c.length;h++)this._map.hasLayer(c[h])&&this._map.removeLayer(c[h]);for(h=0;h<a.length;h++)this._map.hasLayer(a[h])||this._map.addLayer(a[h]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var e=this._layerControlInputs,t,o,a=this._map.getZoom(),c=e.length-1;c>=0;c--)t=e[c],o=this._getLayer(t.layerId).layer,t.disabled=o.options.minZoom!==void 0&&a<o.options.minZoom||o.options.maxZoom!==void 0&&a>o.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var e=this._section;this._preventClick=!0,Y(e,"click",_e),this.expand();var t=this;setTimeout(function(){le(e,"click",_e),t._preventClick=!1})}}),mr=function(e,t,o){return new kn(e,t,o)},Ci=Ie.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",o=oe("div",t+" leaflet-bar"),a=this.options;return this._zoomInButton=this._createButton(a.zoomInText,a.zoomInTitle,t+"-in",o,this._zoomIn),this._zoomOutButton=this._createButton(a.zoomOutText,a.zoomOutTitle,t+"-out",o,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),o},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,t,o,a,c){var h=oe("a",o,a);return h.innerHTML=e,h.href="#",h.title=t,h.setAttribute("role","button"),h.setAttribute("aria-label",t),wt(h),Y(h,"click",Qe),Y(h,"click",c,this),Y(h,"click",this._refocusOnMap,this),h},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";pe(this._zoomInButton,t),pe(this._zoomOutButton,t),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(Q(this._zoomOutButton,t),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(Q(this._zoomInButton,t),this._zoomInButton.setAttribute("aria-disabled","true"))}});ie.mergeOptions({zoomControl:!0}),ie.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Ci,this.addControl(this.zoomControl))});var gr=function(e){return new Ci(e)},zn=Ie.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t="leaflet-control-scale",o=oe("div",t),a=this.options;return this._addScales(a,t+"-line",o),e.on(a.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),o},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,o){e.metric&&(this._mScale=oe("div",t,o)),e.imperial&&(this._iScale=oe("div",t,o))},_update:function(){var e=this._map,t=e.getSize().y/2,o=e.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(o)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),o=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,o,t/e)},_updateImperial:function(e){var t=e*3.2808399,o,a,c;t>5280?(o=t/5280,a=this._getRoundNum(o),this._updateScale(this._iScale,a+" mi",a/o)):(c=this._getRoundNum(t),this._updateScale(this._iScale,c+" ft",c/t))},_updateScale:function(e,t,o){e.style.width=Math.round(this.options.maxWidth*o)+"px",e.innerHTML=t},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),o=e/t;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,t*o}}),_r=function(e){return new zn(e)},yr='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',ki=Ie.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(F.inlineSvg?yr+" ":"")+"Leaflet</a>"},initialize:function(e){j(this,e),this._attributions={}},onAdd:function(e){e.attributionControl=this,this._container=oe("div","leaflet-control-attribution"),wt(this._container);for(var t in e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",function(){this.removeAttribution(e.layer.getAttribution())},this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var o=[];this.options.prefix&&o.push(this.options.prefix),e.length&&o.push(e.join(", ")),this._container.innerHTML=o.join(' <span aria-hidden="true">|</span> ')}}});ie.mergeOptions({attributionControl:!0}),ie.addInitHook(function(){this.options.attributionControl&&new ki().addTo(this)});var vr=function(e){return new ki(e)};Ie.Layers=kn,Ie.Zoom=Ci,Ie.Scale=zn,Ie.Attribution=ki,St.layers=mr,St.zoom=gr,St.scale=_r,St.attribution=vr;var De=R.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});De.addTo=function(e,t){return e.addHandler(t,this),this};var br={Events:U},Tn=F.touch?"touchstart mousedown":"mousedown",He=te.extend({options:{clickTolerance:3},initialize:function(e,t,o,a){j(this,a),this._element=e,this._dragStartTarget=t||e,this._preventOutline=o},enable:function(){this._enabled||(Y(this._dragStartTarget,Tn,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(He._dragging===this&&this.finishDrag(!0),le(this._dragStartTarget,Tn,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!pi(this._element,"leaflet-zoom-anim"))){if(e.touches&&e.touches.length!==1){He._dragging===this&&this.finishDrag();return}if(!(He._dragging||e.shiftKey||e.which!==1&&e.button!==1&&!e.touches)&&(He._dragging=this,this._preventOutline&&_i(this._element),xi(),yt(),!this._moving)){this.fire("down");var t=e.touches?e.touches[0]:e,o=vn(this._element);this._startPoint=new H(t.clientX,t.clientY),this._startPos=Ke(this._element),this._parentScale=yi(o);var a=e.type==="mousedown";Y(document,a?"mousemove":"touchmove",this._onMove,this),Y(document,a?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(e){if(this._enabled){if(e.touches&&e.touches.length>1){this._moved=!0;return}var t=e.touches&&e.touches.length===1?e.touches[0]:e,o=new H(t.clientX,t.clientY)._subtract(this._startPoint);!o.x&&!o.y||Math.abs(o.x)+Math.abs(o.y)<this.options.clickTolerance||(o.x/=this._parentScale.x,o.y/=this._parentScale.y,_e(e),this._moved||(this.fire("dragstart"),this._moved=!0,Q(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Q(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(o),this._moving=!0,this._lastEvent=e,this._updatePosition())}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),fe(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){pe(document.body,"leaflet-dragging"),this._lastTarget&&(pe(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),le(document,"mousemove touchmove",this._onMove,this),le(document,"mouseup touchend touchcancel",this._onUp,this),mi(),vt();var t=this._moved&&this._moving;this._moving=!1,He._dragging=!1,t&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)})}});function Pn(e,t,o){var a,c=[1,4,2,8],h,g,y,v,A,N,G,J;for(h=0,N=e.length;h<N;h++)e[h]._code=Je(e[h],t);for(y=0;y<4;y++){for(G=c[y],a=[],h=0,N=e.length,g=N-1;h<N;g=h++)v=e[h],A=e[g],v._code&G?A._code&G||(J=qt(A,v,G,t,o),J._code=Je(J,t),a.push(J)):(A._code&G&&(J=qt(A,v,G,t,o),J._code=Je(J,t),a.push(J)),a.push(v));e=a}return e}function Ln(e,t){var o,a,c,h,g,y,v,A,N;if(!e||e.length===0)throw new Error("latlngs not passed");Te(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var G=ee([0,0]),J=ue(e),be=J.getNorthWest().distanceTo(J.getSouthWest())*J.getNorthEast().distanceTo(J.getNorthWest());be<1700&&(G=zi(e));var me=e.length,Pe=[];for(o=0;o<me;o++){var Se=ee(e[o]);Pe.push(t.project(ee([Se.lat-G.lat,Se.lng-G.lng])))}for(y=v=A=0,o=0,a=me-1;o<me;a=o++)c=Pe[o],h=Pe[a],g=c.y*h.x-h.y*c.x,v+=(c.x+h.x)*g,A+=(c.y+h.y)*g,y+=g*3;y===0?N=Pe[0]:N=[v/y,A/y];var ct=t.unproject(W(N));return ee([ct.lat+G.lat,ct.lng+G.lng])}function zi(e){for(var t=0,o=0,a=0,c=0;c<e.length;c++){var h=ee(e[c]);t+=h.lat,o+=h.lng,a++}return ee([t/a,o/a])}var wr={__proto__:null,clipPolygon:Pn,polygonCenter:Ln,centroid:zi};function Rn(e,t){if(!t||!e.length)return e.slice();var o=t*t;return e=Cr(e,o),e=jr(e,o),e}function Mn(e,t,o){return Math.sqrt(jt(e,t,o,!0))}function Sr(e,t,o){return jt(e,t,o)}function jr(e,t){var o=e.length,a=typeof Uint8Array<"u"?Uint8Array:Array,c=new a(o);c[0]=c[o-1]=1,Ti(e,c,t,0,o-1);var h,g=[];for(h=0;h<o;h++)c[h]&&g.push(e[h]);return g}function Ti(e,t,o,a,c){var h=0,g,y,v;for(y=a+1;y<=c-1;y++)v=jt(e[y],e[a],e[c],!0),v>h&&(g=y,h=v);h>o&&(t[g]=1,Ti(e,t,o,a,g),Ti(e,t,o,g,c))}function Cr(e,t){for(var o=[e[0]],a=1,c=0,h=e.length;a<h;a++)kr(e[a],e[c])>t&&(o.push(e[a]),c=a);return c<h-1&&o.push(e[h-1]),o}var In;function An(e,t,o,a,c){var h=a?In:Je(e,o),g=Je(t,o),y,v,A;for(In=g;;){if(!(h|g))return[e,t];if(h&g)return!1;y=h||g,v=qt(e,t,y,o,c),A=Je(v,o),y===h?(e=v,h=A):(t=v,g=A)}}function qt(e,t,o,a,c){var h=t.x-e.x,g=t.y-e.y,y=a.min,v=a.max,A,N;return o&8?(A=e.x+h*(v.y-e.y)/g,N=v.y):o&4?(A=e.x+h*(y.y-e.y)/g,N=y.y):o&2?(A=v.x,N=e.y+g*(v.x-e.x)/h):o&1&&(A=y.x,N=e.y+g*(y.x-e.x)/h),new H(A,N,c)}function Je(e,t){var o=0;return e.x<t.min.x?o|=1:e.x>t.max.x&&(o|=2),e.y<t.min.y?o|=4:e.y>t.max.y&&(o|=8),o}function kr(e,t){var o=t.x-e.x,a=t.y-e.y;return o*o+a*a}function jt(e,t,o,a){var c=t.x,h=t.y,g=o.x-c,y=o.y-h,v=g*g+y*y,A;return v>0&&(A=((e.x-c)*g+(e.y-h)*y)/v,A>1?(c=o.x,h=o.y):A>0&&(c+=g*A,h+=y*A)),g=e.x-c,y=e.y-h,a?g*g+y*y:new H(c,h)}function Te(e){return!Z(e[0])||typeof e[0][0]!="object"&&typeof e[0][0]<"u"}function En(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Te(e)}function Bn(e,t){var o,a,c,h,g,y,v,A;if(!e||e.length===0)throw new Error("latlngs not passed");Te(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var N=ee([0,0]),G=ue(e),J=G.getNorthWest().distanceTo(G.getSouthWest())*G.getNorthEast().distanceTo(G.getNorthWest());J<1700&&(N=zi(e));var be=e.length,me=[];for(o=0;o<be;o++){var Pe=ee(e[o]);me.push(t.project(ee([Pe.lat-N.lat,Pe.lng-N.lng])))}for(o=0,a=0;o<be-1;o++)a+=me[o].distanceTo(me[o+1])/2;if(a===0)A=me[0];else for(o=0,h=0;o<be-1;o++)if(g=me[o],y=me[o+1],c=g.distanceTo(y),h+=c,h>a){v=(h-a)/c,A=[y.x-v*(y.x-g.x),y.y-v*(y.y-g.y)];break}var Se=t.unproject(W(A));return ee([Se.lat+N.lat,Se.lng+N.lng])}var zr={__proto__:null,simplify:Rn,pointToSegmentDistance:Mn,closestPointOnSegment:Sr,clipSegment:An,_getEdgeIntersection:qt,_getBitCode:Je,_sqClosestPointOnSegment:jt,isFlat:Te,_flat:En,polylineCenter:Bn},Pi={project:function(e){return new H(e.lng,e.lat)},unproject:function(e){return new re(e.y,e.x)},bounds:new ne([-180,-90],[180,90])},Li={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ne([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(e){var t=Math.PI/180,o=this.R,a=e.lat*t,c=this.R_MINOR/o,h=Math.sqrt(1-c*c),g=h*Math.sin(a),y=Math.tan(Math.PI/4-a/2)/Math.pow((1-g)/(1+g),h/2);return a=-o*Math.log(Math.max(y,1e-10)),new H(e.lng*t*o,a)},unproject:function(e){for(var t=180/Math.PI,o=this.R,a=this.R_MINOR/o,c=Math.sqrt(1-a*a),h=Math.exp(-e.y/o),g=Math.PI/2-2*Math.atan(h),y=0,v=.1,A;y<15&&Math.abs(v)>1e-7;y++)A=c*Math.sin(g),A=Math.pow((1-A)/(1+A),c/2),v=Math.PI/2-2*Math.atan(h*A)-g,g+=v;return new re(g*t,e.x*t/o)}},Tr={__proto__:null,LonLat:Pi,Mercator:Li,SphericalMercator:ke},Pr=d({},Ee,{code:"EPSG:3395",projection:Li,transformation:function(){var e=.5/(Math.PI*Li.R);return Me(e,.5,-e,.5)}()}),On=d({},Ee,{code:"EPSG:4326",projection:Pi,transformation:Me(1/180,1,-1/180,.5)}),Lr=d({},Re,{projection:Pi,transformation:Me(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var o=t.lng-e.lng,a=t.lat-e.lat;return Math.sqrt(o*o+a*a)},infinite:!0});Re.Earth=Ee,Re.EPSG3395=Pr,Re.EPSG3857=oi,Re.EPSG900913=Bo,Re.EPSG4326=On,Re.Simple=Lr;var Ae=te.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[m(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[m(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var o=this.getEvents();t.on(o,this),this.once("remove",function(){t.off(o,this)},this)}this.onAdd(t),this.fire("add"),t.fire("layeradd",{layer:this})}}});ie.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var t=m(e);return this._layers[t]?this:(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e),this)},removeLayer:function(e){var t=m(e);return this._layers[t]?(this._loaded&&e.onRemove(this),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return m(e)in this._layers},eachLayer:function(e,t){for(var o in this._layers)e.call(t,this._layers[o]);return this},_addLayers:function(e){e=e?Z(e)?e:[e]:[];for(var t=0,o=e.length;t<o;t++)this.addLayer(e[t])},_addZoomLimit:function(e){(!isNaN(e.options.maxZoom)||!isNaN(e.options.minZoom))&&(this._zoomBoundLayers[m(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var t=m(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,t=-1/0,o=this._getZoomSpan();for(var a in this._zoomBoundLayers){var c=this._zoomBoundLayers[a].options;e=c.minZoom===void 0?e:Math.min(e,c.minZoom),t=c.maxZoom===void 0?t:Math.max(t,c.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=e===1/0?void 0:e,o!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var rt=Ae.extend({initialize:function(e,t){j(this,t),this._layers={};var o,a;if(e)for(o=0,a=e.length;o<a;o++)this.addLayer(e[o])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){var t=typeof e=="number"?e:this.getLayerId(e);return t in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t=Array.prototype.slice.call(arguments,1),o,a;for(o in this._layers)a=this._layers[o],a[e]&&a[e].apply(a,t);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var o in this._layers)e.call(t,this._layers[o]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return m(e)}}),Rr=function(e,t){return new rt(e,t)},qe=rt.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),rt.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),rt.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new ve;for(var t in this._layers){var o=this._layers[t];e.extend(o.getBounds?o.getBounds():o.getLatLng())}return e}}),Mr=function(e,t){return new qe(e,t)},st=R.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){j(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var o=this._getIconUrl(e);if(!o){if(e==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var a=this._createImg(o,t&&t.tagName==="IMG"?t:null);return this._setIconStyles(a,e),(this.options.crossOrigin||this.options.crossOrigin==="")&&(a.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),a},_setIconStyles:function(e,t){var o=this.options,a=o[t+"Size"];typeof a=="number"&&(a=[a,a]);var c=W(a),h=W(t==="shadow"&&o.shadowAnchor||o.iconAnchor||c&&c.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(o.className||""),h&&(e.style.marginLeft=-h.x+"px",e.style.marginTop=-h.y+"px"),c&&(e.style.width=c.x+"px",e.style.height=c.y+"px")},_createImg:function(e,t){return t=t||document.createElement("img"),t.src=e,t},_getIconUrl:function(e){return F.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function Ir(e){return new st(e)}var Ct=st.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return typeof Ct.imagePath!="string"&&(Ct.imagePath=this._detectIconPath()),(this.options.imagePath||Ct.imagePath)+st.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var t=function(o,a,c){var h=a.exec(o);return h&&h[c]};return e=t(e,/^url\((['"])?(.+)\1\)$/,2),e&&t(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=oe("div","leaflet-default-icon-path",document.body),t=_t(e,"background-image")||_t(e,"backgroundImage");if(document.body.removeChild(e),t=this._stripUrl(t),t)return t;var o=document.querySelector('link[href$="leaflet.css"]');return o?o.href.substring(0,o.href.length-11-1):""}}),Dn=De.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new He(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Q(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&pe(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,o=t._map,a=this._marker.options.autoPanSpeed,c=this._marker.options.autoPanPadding,h=Ke(t._icon),g=o.getPixelBounds(),y=o.getPixelOrigin(),v=se(g.min._subtract(y).add(c),g.max._subtract(y).subtract(c));if(!v.contains(h)){var A=W((Math.max(v.max.x,h.x)-v.max.x)/(g.max.x-v.max.x)-(Math.min(v.min.x,h.x)-v.min.x)/(g.min.x-v.min.x),(Math.max(v.max.y,h.y)-v.max.y)/(g.max.y-v.max.y)-(Math.min(v.min.y,h.y)-v.min.y)/(g.min.y-v.min.y)).multiplyBy(a);o.panBy(A,{animate:!1}),this._draggable._newPos._add(A),this._draggable._startPos._add(A),fe(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=_(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(z(this._panRequest),this._panRequest=_(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,o=t._shadow,a=Ke(t._icon),c=t._map.layerPointToLatLng(a);o&&fe(o,a),t._latlng=c,e.latlng=c,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){z(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),Nt=Ae.extend({options:{icon:new Ct,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){j(this,t),this._latlng=ee(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=ee(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),o=e.icon.createIcon(this._icon),a=!1;o!==this._icon&&(this._icon&&this._removeIcon(),a=!0,e.title&&(o.title=e.title),o.tagName==="IMG"&&(o.alt=e.alt||"")),Q(o,t),e.keyboard&&(o.tabIndex="0",o.setAttribute("role","button")),this._icon=o,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Y(o,"focus",this._panOnFocus,this);var c=e.icon.createShadow(this._shadow),h=!1;c!==this._shadow&&(this._removeShadow(),h=!0),c&&(Q(c,t),c.alt=""),this._shadow=c,e.opacity<1&&this._updateOpacity(),a&&this.getPane().appendChild(this._icon),this._initInteraction(),c&&h&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&le(this._icon,"focus",this._panOnFocus,this),ce(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ce(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&fe(this._icon,e),this._shadow&&fe(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(Q(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Dn)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Dn(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&ze(this._icon,e),this._shadow&&ze(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var t=this.options.icon.options,o=t.iconSize?W(t.iconSize):W(0,0),a=t.iconAnchor?W(t.iconAnchor):W(0,0);e.panInside(this._latlng,{paddingTopLeft:a,paddingBottomRight:o.subtract(a)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Ar(e,t){return new Nt(e,t)}var Ue=Ae.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return j(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Zt=Ue.extend({options:{fill:!0,radius:10},initialize:function(e,t){j(this,t),this._latlng=ee(e),this._radius=this.options.radius},setLatLng:function(e){var t=this._latlng;return this._latlng=ee(e),this.redraw(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return Ue.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,o=this._clickTolerance(),a=[e+o,t+o];this._pxBounds=new ne(this._point.subtract(a),this._point.add(a))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Er(e,t){return new Zt(e,t)}var Ri=Zt.extend({initialize:function(e,t,o){if(typeof t=="number"&&(t=d({},o,{radius:t})),j(this,t),this._latlng=ee(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new ve(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:Ue.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,o=this._map,a=o.options.crs;if(a.distance===Ee.distance){var c=Math.PI/180,h=this._mRadius/Ee.R/c,g=o.project([t+h,e]),y=o.project([t-h,e]),v=g.add(y).divideBy(2),A=o.unproject(v).lat,N=Math.acos((Math.cos(h*c)-Math.sin(t*c)*Math.sin(A*c))/(Math.cos(t*c)*Math.cos(A*c)))/c;(isNaN(N)||N===0)&&(N=h/Math.cos(Math.PI/180*t)),this._point=v.subtract(o.getPixelOrigin()),this._radius=isNaN(N)?0:v.x-o.project([A,e-N]).x,this._radiusY=v.y-g.y}else{var G=a.unproject(a.project(this._latlng).subtract([this._mRadius,0]));this._point=o.latLngToLayerPoint(this._latlng),this._radius=this._point.x-o.latLngToLayerPoint(G).x}this._updateBounds()}});function Br(e,t,o){return new Ri(e,t,o)}var Ne=Ue.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){j(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t=1/0,o=null,a=jt,c,h,g=0,y=this._parts.length;g<y;g++)for(var v=this._parts[g],A=1,N=v.length;A<N;A++){c=v[A-1],h=v[A];var G=a(e,c,h,!0);G<t&&(t=G,o=a(e,c,h))}return o&&(o.distance=Math.sqrt(t)),o},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Bn(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t=t||this._defaultShape(),e=ee(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new ve,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return Te(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],o=Te(e),a=0,c=e.length;a<c;a++)o?(t[a]=ee(e[a]),this._bounds.extend(t[a])):t[a]=this._convertLatLngs(e[a]);return t},_project:function(){var e=new ne;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),t=new H(e,e);this._rawPxBounds&&(this._pxBounds=new ne([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)]))},_projectLatlngs:function(e,t,o){var a=e[0]instanceof re,c=e.length,h,g;if(a){for(g=[],h=0;h<c;h++)g[h]=this._map.latLngToLayerPoint(e[h]),o.extend(g[h]);t.push(g)}else for(h=0;h<c;h++)this._projectLatlngs(e[h],t,o)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}var t=this._parts,o,a,c,h,g,y,v;for(o=0,c=0,h=this._rings.length;o<h;o++)for(v=this._rings[o],a=0,g=v.length;a<g-1;a++)y=An(v[a],v[a+1],e,a,!0),y&&(t[c]=t[c]||[],t[c].push(y[0]),(y[1]!==v[a+1]||a===g-2)&&(t[c].push(y[1]),c++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,o=0,a=e.length;o<a;o++)e[o]=Rn(e[o],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var o,a,c,h,g,y,v=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(o=0,h=this._parts.length;o<h;o++)for(y=this._parts[o],a=0,g=y.length,c=g-1;a<g;c=a++)if(!(!t&&a===0)&&Mn(e,y[c],y[a])<=v)return!0;return!1}});function Or(e,t){return new Ne(e,t)}Ne._flat=En;var at=Ne.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ln(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(e){var t=Ne.prototype._convertLatLngs.call(this,e),o=t.length;return o>=2&&t[0]instanceof re&&t[0].equals(t[o-1])&&t.pop(),t},_setLatLngs:function(e){Ne.prototype._setLatLngs.call(this,e),Te(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Te(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,o=new H(t,t);if(e=new ne(e.min.subtract(o),e.max.add(o)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}for(var a=0,c=this._rings.length,h;a<c;a++)h=Pn(this._rings[a],e,!0),h.length&&this._parts.push(h)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t=!1,o,a,c,h,g,y,v,A;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(h=0,v=this._parts.length;h<v;h++)for(o=this._parts[h],g=0,A=o.length,y=A-1;g<A;y=g++)a=o[g],c=o[y],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(t=!t);return t||Ne.prototype._containsPoint.call(this,e,!0)}});function Dr(e,t){return new at(e,t)}var Ze=qe.extend({initialize:function(e,t){j(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t=Z(e)?e:e.features,o,a,c;if(t){for(o=0,a=t.length;o<a;o++)c=t[o],(c.geometries||c.geometry||c.features||c.coordinates)&&this.addData(c);return this}var h=this.options;if(h.filter&&!h.filter(e))return this;var g=$t(e,h);return g?(g.feature=Ut(e),g.defaultOptions=g.options,this.resetStyle(g),h.onEachFeature&&h.onEachFeature(e,g),this.addLayer(g)):this},resetStyle:function(e){return e===void 0?this.eachLayer(this.resetStyle,this):(e.options=d({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(e,t){e.setStyle&&(typeof t=="function"&&(t=t(e.feature)),e.setStyle(t))}});function $t(e,t){var o=e.type==="Feature"?e.geometry:e,a=o?o.coordinates:null,c=[],h=t&&t.pointToLayer,g=t&&t.coordsToLatLng||Mi,y,v,A,N;if(!a&&!o)return null;switch(o.type){case"Point":return y=g(a),Wn(h,e,y,t);case"MultiPoint":for(A=0,N=a.length;A<N;A++)y=g(a[A]),c.push(Wn(h,e,y,t));return new qe(c);case"LineString":case"MultiLineString":return v=Ft(a,o.type==="LineString"?0:1,g),new Ne(v,t);case"Polygon":case"MultiPolygon":return v=Ft(a,o.type==="Polygon"?1:2,g),new at(v,t);case"GeometryCollection":for(A=0,N=o.geometries.length;A<N;A++){var G=$t({geometry:o.geometries[A],type:"Feature",properties:e.properties},t);G&&c.push(G)}return new qe(c);case"FeatureCollection":for(A=0,N=o.features.length;A<N;A++){var J=$t(o.features[A],t);J&&c.push(J)}return new qe(c);default:throw new Error("Invalid GeoJSON object.")}}function Wn(e,t,o,a){return e?e(t,o):new Nt(o,a&&a.markersInheritOptions&&a)}function Mi(e){return new re(e[1],e[0],e[2])}function Ft(e,t,o){for(var a=[],c=0,h=e.length,g;c<h;c++)g=t?Ft(e[c],t-1,o):(o||Mi)(e[c]),a.push(g);return a}function Ii(e,t){return e=ee(e),e.alt!==void 0?[I(e.lng,t),I(e.lat,t),I(e.alt,t)]:[I(e.lng,t),I(e.lat,t)]}function Ht(e,t,o,a){for(var c=[],h=0,g=e.length;h<g;h++)c.push(t?Ht(e[h],Te(e[h])?0:t-1,o,a):Ii(e[h],a));return!t&&o&&c.length>0&&c.push(c[0].slice()),c}function lt(e,t){return e.feature?d({},e.feature,{geometry:t}):Ut(t)}function Ut(e){return e.type==="Feature"||e.type==="FeatureCollection"?e:{type:"Feature",properties:{},geometry:e}}var Ai={toGeoJSON:function(e){return lt(this,{type:"Point",coordinates:Ii(this.getLatLng(),e)})}};Nt.include(Ai),Ri.include(Ai),Zt.include(Ai),Ne.include({toGeoJSON:function(e){var t=!Te(this._latlngs),o=Ht(this._latlngs,t?1:0,!1,e);return lt(this,{type:(t?"Multi":"")+"LineString",coordinates:o})}}),at.include({toGeoJSON:function(e){var t=!Te(this._latlngs),o=t&&!Te(this._latlngs[0]),a=Ht(this._latlngs,o?2:t?1:0,!0,e);return t||(a=[a]),lt(this,{type:(o?"Multi":"")+"Polygon",coordinates:a})}}),rt.include({toMultiPoint:function(e){var t=[];return this.eachLayer(function(o){t.push(o.toGeoJSON(e).geometry.coordinates)}),lt(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(t==="MultiPoint")return this.toMultiPoint(e);var o=t==="GeometryCollection",a=[];return this.eachLayer(function(c){if(c.toGeoJSON){var h=c.toGeoJSON(e);if(o)a.push(h.geometry);else{var g=Ut(h);g.type==="FeatureCollection"?a.push.apply(a,g.features):a.push(g)}}}),o?lt(this,{geometries:a,type:"GeometryCollection"}):{type:"FeatureCollection",features:a}}});function qn(e,t){return new Ze(e,t)}var Wr=qn,Gt=Ae.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,t,o){this._url=e,this._bounds=ue(t),j(this,o)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Q(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){ce(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&nt(this._image),this},bringToBack:function(){return this._map&&ot(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=ue(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e=this._url.tagName==="IMG",t=this._image=e?this._url:oe("img");if(Q(t,"leaflet-image-layer"),this._zoomAnimated&&Q(t,"leaflet-zoom-animated"),this.options.className&&Q(t,this.options.className),t.onselectstart=w,t.onmousemove=w,t.onload=p(this.fire,this,"load"),t.onerror=p(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(t.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e){this._url=t.src;return}t.src=this._url,t.alt=this.options.alt},_animateZoom:function(e){var t=this._map.getZoomScale(e.zoom),o=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;Ve(this._image,o,t)},_reset:function(){var e=this._image,t=new ne(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),o=t.getSize();fe(e,t.min),e.style.width=o.x+"px",e.style.height=o.y+"px"},_updateOpacity:function(){ze(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),qr=function(e,t,o){return new Gt(e,t,o)},Nn=Gt.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e=this._url.tagName==="VIDEO",t=this._image=e?this._url:oe("video");if(Q(t,"leaflet-image-layer"),this._zoomAnimated&&Q(t,"leaflet-zoom-animated"),this.options.className&&Q(t,this.options.className),t.onselectstart=w,t.onmousemove=w,t.onloadeddata=p(this.fire,this,"load"),e){for(var o=t.getElementsByTagName("source"),a=[],c=0;c<o.length;c++)a.push(o[c].src);this._url=o.length>0?a:[t.src];return}Z(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(t.style,"objectFit")&&(t.style.objectFit="fill"),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop,t.muted=!!this.options.muted,t.playsInline=!!this.options.playsInline;for(var h=0;h<this._url.length;h++){var g=oe("source");g.src=this._url[h],t.appendChild(g)}}});function Nr(e,t,o){return new Nn(e,t,o)}var Zn=Gt.extend({_initImage:function(){var e=this._image=this._url;Q(e,"leaflet-image-layer"),this._zoomAnimated&&Q(e,"leaflet-zoom-animated"),this.options.className&&Q(e,this.options.className),e.onselectstart=w,e.onmousemove=w}});function Zr(e,t,o){return new Zn(e,t,o)}var We=Ae.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(e,t){e&&(e instanceof re||Z(e))?(this._latlng=ee(e),j(this,t)):(j(this,e),this._source=t),this.options.content&&(this._content=this.options.content)},openOn:function(e){return e=arguments.length?e:this._source._map,e.hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&ze(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&ze(this._container,1),this.bringToFront(),this.options.interactive&&(Q(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(ze(this._container,0),this._removeTimeout=setTimeout(p(ce,void 0,this._container),200)):ce(this._container),this.options.interactive&&(pe(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=ee(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&nt(this._container),this},bringToBack:function(){return this._map&&ot(this._container),this},_prepareOpen:function(e){var t=this._source;if(!t._map)return!1;if(t instanceof qe){t=null;var o=this._source._layers;for(var a in o)if(o[a]._map){t=o[a];break}if(!t)return!1;this._source=t}if(!e)if(t.getCenter)e=t.getCenter();else if(t.getLatLng)e=t.getLatLng();else if(t.getBounds)e=t.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,t=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof t=="string")e.innerHTML=t;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=W(this.options.offset),o=this._getAnchor();this._zoomAnimated?fe(this._container,e.add(o)):t=t.add(e).add(o);var a=this._containerBottom=-t.y,c=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=a+"px",this._container.style.left=c+"px"}},_getAnchor:function(){return[0,0]}});ie.include({_initOverlay:function(e,t,o,a){var c=t;return c instanceof e||(c=new e(a).setContent(t)),o&&c.setLatLng(o),c}}),Ae.include({_initOverlay:function(e,t,o,a){var c=o;return c instanceof e?(j(c,a),c._source=this):(c=t&&!a?t:new e(a,this),c.setContent(o)),c}});var Vt=We.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return e=arguments.length?e:this._source._map,!e.hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,We.prototype.openOn.call(this,e)},onAdd:function(e){We.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Ue||this._source.on("preclick",Ye))},onRemove:function(e){We.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Ue||this._source.off("preclick",Ye))},getEvents:function(){var e=We.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",t=this._container=oe("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),o=this._wrapper=oe("div",e+"-content-wrapper",t);if(this._contentNode=oe("div",e+"-content",o),wt(t),Si(this._contentNode),Y(t,"contextmenu",Ye),this._tipContainer=oe("div",e+"-tip-container",t),this._tip=oe("div",e+"-tip",this._tipContainer),this.options.closeButton){var a=this._closeButton=oe("a",e+"-close-button",t);a.setAttribute("role","button"),a.setAttribute("aria-label","Close popup"),a.href="#close",a.innerHTML='<span aria-hidden="true">&#215;</span>',Y(a,"click",function(c){_e(c),this.close()},this)}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var o=e.offsetWidth;o=Math.min(o,this.options.maxWidth),o=Math.max(o,this.options.minWidth),t.width=o+1+"px",t.whiteSpace="",t.height="";var a=e.offsetHeight,c=this.options.maxHeight,h="leaflet-popup-scrolled";c&&a>c?(t.height=c+"px",Q(e,h)):pe(e,h),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),o=this._getAnchor();fe(this._container,t.add(o))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var e=this._map,t=parseInt(_t(this._container,"marginBottom"),10)||0,o=this._container.offsetHeight+t,a=this._containerWidth,c=new H(this._containerLeft,-o-this._containerBottom);c._add(Ke(this._container));var h=e.layerPointToContainerPoint(c),g=W(this.options.autoPanPadding),y=W(this.options.autoPanPaddingTopLeft||g),v=W(this.options.autoPanPaddingBottomRight||g),A=e.getSize(),N=0,G=0;h.x+a+v.x>A.x&&(N=h.x+a-A.x+v.x),h.x-N-y.x<0&&(N=h.x-y.x),h.y+o+v.y>A.y&&(G=h.y+o-A.y+v.y),h.y-G-y.y<0&&(G=h.y-y.y),(N||G)&&(this.options.keepInView&&(this._autopanning=!0),e.fire("autopanstart").panBy([N,G]))}},_getAnchor:function(){return W(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),$r=function(e,t){return new Vt(e,t)};ie.mergeOptions({closePopupOnClick:!0}),ie.include({openPopup:function(e,t,o){return this._initOverlay(Vt,e,t,o).openOn(this),this},closePopup:function(e){return e=arguments.length?e:this._popup,e&&e.close(),this}}),Ae.include({bindPopup:function(e,t){return this._popup=this._initOverlay(Vt,this._popup,e,t),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&(this instanceof qe||(this._popup._source=this),this._popup._prepareOpen(e||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(!(!this._popup||!this._map)){Qe(e);var t=e.layer||e.target;if(this._popup._source===t&&!(t instanceof Ue)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng);return}this._popup._source=t,this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){e.originalEvent.keyCode===13&&this._openPopup(e)}});var Kt=We.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){We.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){We.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=We.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip",t=e+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=oe("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+m(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var t,o,a=this._map,c=this._container,h=a.latLngToContainerPoint(a.getCenter()),g=a.layerPointToContainerPoint(e),y=this.options.direction,v=c.offsetWidth,A=c.offsetHeight,N=W(this.options.offset),G=this._getAnchor();y==="top"?(t=v/2,o=A):y==="bottom"?(t=v/2,o=0):y==="center"?(t=v/2,o=A/2):y==="right"?(t=0,o=A/2):y==="left"?(t=v,o=A/2):g.x<h.x?(y="right",t=0,o=A/2):(y="left",t=v+(N.x+G.x)*2,o=A/2),e=e.subtract(W(t,o,!0)).add(N).add(G),pe(c,"leaflet-tooltip-right"),pe(c,"leaflet-tooltip-left"),pe(c,"leaflet-tooltip-top"),pe(c,"leaflet-tooltip-bottom"),Q(c,"leaflet-tooltip-"+y),fe(c,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&ze(this._container,e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)},_getAnchor:function(){return W(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Fr=function(e,t){return new Kt(e,t)};ie.include({openTooltip:function(e,t,o){return this._initOverlay(Kt,e,t,o).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),Ae.include({bindTooltip:function(e,t){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Kt,this._tooltip,e,t),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(!(!e&&this._tooltipHandlersAdded)){var t=e?"off":"on",o={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?o.add=this._openTooltip:(o.mouseover=this._openTooltip,o.mouseout=this.closeTooltip,o.click=this._openTooltip,this._map?this._addFocusListeners():o.add=this._addFocusListeners),this._tooltip.options.sticky&&(o.mousemove=this._moveTooltip),this[t](o),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&(this instanceof qe||(this._tooltip._source=this),this._tooltip._prepareOpen(e)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(e){var t=typeof e.getElement=="function"&&e.getElement();t&&(Y(t,"focus",function(){this._tooltip._source=e,this.openTooltip()},this),Y(t,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(e){var t=typeof e.getElement=="function"&&e.getElement();t&&t.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(e){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var t=this;this._map.once("moveend",function(){t._openOnceFlag=!1,t._openTooltip(e)});return}this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0)}},_moveTooltip:function(e){var t=e.latlng,o,a;this._tooltip.options.sticky&&e.originalEvent&&(o=this._map.mouseEventToContainerPoint(e.originalEvent),a=this._map.containerPointToLayerPoint(o),t=this._map.layerPointToLatLng(a)),this._tooltip.setLatLng(t)}});var $n=st.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var t=e&&e.tagName==="DIV"?e:document.createElement("div"),o=this.options;if(o.html instanceof Element?(Et(t),t.appendChild(o.html)):t.innerHTML=o.html!==!1?o.html:"",o.bgPos){var a=W(o.bgPos);t.style.backgroundPosition=-a.x+"px "+-a.y+"px"}return this._setIconStyles(t,"icon"),t},createShadow:function(){return null}});function Hr(e){return new $n(e)}st.Default=Ct;var kt=Ae.extend({options:{tileSize:256,opacity:1,updateWhenIdle:F.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){j(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),ce(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(nt(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(ot(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=x(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof H?e:new H(e,e)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var t=this.getPane().children,o=-e(-1/0,1/0),a=0,c=t.length,h;a<c;a++)h=t[a].style.zIndex,t[a]!==this._container&&h&&(o=e(o,+h));isFinite(o)&&(this.options.zIndex=o+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!F.ielt9){ze(this._container,this.options.opacity);var e=+new Date,t=!1,o=!1;for(var a in this._tiles){var c=this._tiles[a];if(!(!c.current||!c.loaded)){var h=Math.min(1,(e-c.loaded)/200);ze(c.el,h),h<1?t=!0:(c.active?o=!0:this._onOpaqueTile(c),c.active=!0)}}o&&!this._noPrune&&this._pruneTiles(),t&&(z(this._fadeFrame),this._fadeFrame=_(this._updateOpacity,this))}},_onOpaqueTile:w,_initContainer:function(){this._container||(this._container=oe("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,t=this.options.maxZoom;if(e!==void 0){for(var o in this._levels)o=Number(o),this._levels[o].el.children.length||o===e?(this._levels[o].el.style.zIndex=t-Math.abs(e-o),this._onUpdateLevel(o)):(ce(this._levels[o].el),this._removeTilesAtZoom(o),this._onRemoveLevel(o),delete this._levels[o]);var a=this._levels[e],c=this._map;return a||(a=this._levels[e]={},a.el=oe("div","leaflet-tile-container leaflet-zoom-animated",this._container),a.el.style.zIndex=t,a.origin=c.project(c.unproject(c.getPixelOrigin()),e).round(),a.zoom=e,this._setZoomTransform(a,c.getCenter(),c.getZoom()),w(a.el.offsetWidth),this._onCreateLevel(a)),this._level=a,a}},_onUpdateLevel:w,_onRemoveLevel:w,_onCreateLevel:w,_pruneTiles:function(){if(this._map){var e,t,o=this._map.getZoom();if(o>this.options.maxZoom||o<this.options.minZoom){this._removeAllTiles();return}for(e in this._tiles)t=this._tiles[e],t.retain=t.current;for(e in this._tiles)if(t=this._tiles[e],t.current&&!t.active){var a=t.coords;this._retainParent(a.x,a.y,a.z,a.z-5)||this._retainChildren(a.x,a.y,a.z,a.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}},_removeTilesAtZoom:function(e){for(var t in this._tiles)this._tiles[t].coords.z===e&&this._removeTile(t)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)ce(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,t,o,a){var c=Math.floor(e/2),h=Math.floor(t/2),g=o-1,y=new H(+c,+h);y.z=+g;var v=this._tileCoordsToKey(y),A=this._tiles[v];return A&&A.active?(A.retain=!0,!0):(A&&A.loaded&&(A.retain=!0),g>a?this._retainParent(c,h,g,a):!1)},_retainChildren:function(e,t,o,a){for(var c=2*e;c<2*e+2;c++)for(var h=2*t;h<2*t+2;h++){var g=new H(c,h);g.z=o+1;var y=this._tileCoordsToKey(g),v=this._tiles[y];if(v&&v.active){v.retain=!0;continue}else v&&v.loaded&&(v.retain=!0);o+1<a&&this._retainChildren(c,h,o+1,a)}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var t=this.options;return t.minNativeZoom!==void 0&&e<t.minNativeZoom?t.minNativeZoom:t.maxNativeZoom!==void 0&&t.maxNativeZoom<e?t.maxNativeZoom:e},_setView:function(e,t,o,a){var c=Math.round(t);this.options.maxZoom!==void 0&&c>this.options.maxZoom||this.options.minZoom!==void 0&&c<this.options.minZoom?c=void 0:c=this._clampZoom(c);var h=this.options.updateWhenZooming&&c!==this._tileZoom;(!a||h)&&(this._tileZoom=c,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),c!==void 0&&this._update(e),o||this._pruneTiles(),this._noPrune=!!o),this._setZoomTransforms(e,t)},_setZoomTransforms:function(e,t){for(var o in this._levels)this._setZoomTransform(this._levels[o],e,t)},_setZoomTransform:function(e,t,o){var a=this._map.getZoomScale(o,e.zoom),c=e.origin.multiplyBy(a).subtract(this._map._getNewPixelOrigin(t,o)).round();F.any3d?Ve(e.el,c,a):fe(e.el,c)},_resetGrid:function(){var e=this._map,t=e.options.crs,o=this._tileSize=this.getTileSize(),a=this._tileZoom,c=this._map.getPixelWorldBounds(this._tileZoom);c&&(this._globalTileRange=this._pxBoundsToTileRange(c)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],a).x/o.x),Math.ceil(e.project([0,t.wrapLng[1]],a).x/o.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],a).y/o.x),Math.ceil(e.project([t.wrapLat[1],0],a).y/o.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(e){var t=this._map,o=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),a=t.getZoomScale(o,this._tileZoom),c=t.project(e,this._tileZoom).floor(),h=t.getSize().divideBy(a*2);return new ne(c.subtract(h),c.add(h))},_update:function(e){var t=this._map;if(t){var o=this._clampZoom(t.getZoom());if(e===void 0&&(e=t.getCenter()),this._tileZoom!==void 0){var a=this._getTiledPixelBounds(e),c=this._pxBoundsToTileRange(a),h=c.getCenter(),g=[],y=this.options.keepBuffer,v=new ne(c.getBottomLeft().subtract([y,-y]),c.getTopRight().add([y,-y]));if(!(isFinite(c.min.x)&&isFinite(c.min.y)&&isFinite(c.max.x)&&isFinite(c.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var A in this._tiles){var N=this._tiles[A].coords;(N.z!==this._tileZoom||!v.contains(new H(N.x,N.y)))&&(this._tiles[A].current=!1)}if(Math.abs(o-this._tileZoom)>1){this._setView(e,o);return}for(var G=c.min.y;G<=c.max.y;G++)for(var J=c.min.x;J<=c.max.x;J++){var be=new H(J,G);if(be.z=this._tileZoom,!!this._isValidTile(be)){var me=this._tiles[this._tileCoordsToKey(be)];me?me.current=!0:g.push(be)}}if(g.sort(function(Se,ct){return Se.distanceTo(h)-ct.distanceTo(h)}),g.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Pe=document.createDocumentFragment();for(J=0;J<g.length;J++)this._addTile(g[J],Pe);this._level.el.appendChild(Pe)}}}},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var o=this._globalTileRange;if(!t.wrapLng&&(e.x<o.min.x||e.x>o.max.x)||!t.wrapLat&&(e.y<o.min.y||e.y>o.max.y))return!1}if(!this.options.bounds)return!0;var a=this._tileCoordsToBounds(e);return ue(this.options.bounds).overlaps(a)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var t=this._map,o=this.getTileSize(),a=e.scaleBy(o),c=a.add(o),h=t.unproject(a,e.z),g=t.unproject(c,e.z);return[h,g]},_tileCoordsToBounds:function(e){var t=this._tileCoordsToNwSe(e),o=new ve(t[0],t[1]);return this.options.noWrap||(o=this._map.wrapLatLngBounds(o)),o},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var t=e.split(":"),o=new H(+t[0],+t[1]);return o.z=+t[2],o},_removeTile:function(e){var t=this._tiles[e];t&&(ce(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){Q(e,"leaflet-tile");var t=this.getTileSize();e.style.width=t.x+"px",e.style.height=t.y+"px",e.onselectstart=w,e.onmousemove=w,F.ielt9&&this.options.opacity<1&&ze(e,this.options.opacity)},_addTile:function(e,t){var o=this._getTilePos(e),a=this._tileCoordsToKey(e),c=this.createTile(this._wrapCoords(e),p(this._tileReady,this,e));this._initTile(c),this.createTile.length<2&&_(p(this._tileReady,this,e,null,c)),fe(c,o),this._tiles[a]={el:c,coords:e,current:!0},t.appendChild(c),this.fire("tileloadstart",{tile:c,coords:e})},_tileReady:function(e,t,o){t&&this.fire("tileerror",{error:t,tile:o,coords:e});var a=this._tileCoordsToKey(e);o=this._tiles[a],o&&(o.loaded=+new Date,this._map._fadeAnimated?(ze(o.el,0),z(this._fadeFrame),this._fadeFrame=_(this._updateOpacity,this)):(o.active=!0,this._pruneTiles()),t||(Q(o.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:o.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),F.ielt9||!this._map._fadeAnimated?_(this._pruneTiles,this):setTimeout(p(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var t=new H(this._wrapX?M(e.x,this._wrapX):e.x,this._wrapY?M(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToTileRange:function(e){var t=this.getTileSize();return new ne(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function Ur(e){return new kt(e)}var dt=kt.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,t){this._url=e,t=j(this,t),t.detectRetina&&F.retina&&t.maxZoom>0?(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom=Math.min(t.maxZoom,t.minZoom+1)):(t.zoomOffset++,t.maxZoom=Math.max(t.minZoom,t.maxZoom-1)),t.minZoom=Math.max(0,t.minZoom)):t.zoomReverse?t.minZoom=Math.min(t.maxZoom,t.minZoom):t.maxZoom=Math.max(t.minZoom,t.maxZoom),typeof t.subdomains=="string"&&(t.subdomains=t.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,t){return this._url===e&&t===void 0&&(t=!0),this._url=e,t||this.redraw(),this},createTile:function(e,t){var o=document.createElement("img");return Y(o,"load",p(this._tileOnLoad,this,t,o)),Y(o,"error",p(this._tileOnError,this,t,o)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(o.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(o.referrerPolicy=this.options.referrerPolicy),o.alt="",o.src=this.getTileUrl(e),o},getTileUrl:function(e){var t={r:F.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var o=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=o),t["-y"]=o}return q(this._url,d(t,this.options))},_tileOnLoad:function(e,t){F.ielt9?setTimeout(p(e,this,null,t),0):e(null,t)},_tileOnError:function(e,t,o){var a=this.options.errorTileUrl;a&&t.getAttribute("src")!==a&&(t.src=a),e(o,t)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,t=this.options.maxZoom,o=this.options.zoomReverse,a=this.options.zoomOffset;return o&&(e=t-e),e+a},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&(t=this._tiles[e].el,t.onload=w,t.onerror=w,!t.complete)){t.src=k;var o=this._tiles[e].coords;ce(t),delete this._tiles[e],this.fire("tileabort",{tile:t,coords:o})}},_removeTile:function(e){var t=this._tiles[e];if(t)return t.el.setAttribute("src",k),kt.prototype._removeTile.call(this,e)},_tileReady:function(e,t,o){if(!(!this._map||o&&o.getAttribute("src")===k))return kt.prototype._tileReady.call(this,e,t,o)}});function Fn(e,t){return new dt(e,t)}var Hn=dt.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,t){this._url=e;var o=d({},this.defaultWmsParams);for(var a in t)a in this.options||(o[a]=t[a]);t=j(this,t);var c=t.detectRetina&&F.retina?2:1,h=this.getTileSize();o.width=h.x*c,o.height=h.y*c,this.wmsParams=o},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,dt.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToNwSe(e),o=this._crs,a=se(o.project(t[0]),o.project(t[1])),c=a.min,h=a.max,g=(this._wmsVersion>=1.3&&this._crs===On?[c.y,c.x,h.y,h.x]:[c.x,c.y,h.x,h.y]).join(","),y=dt.prototype.getTileUrl.call(this,e);return y+C(this.wmsParams,y,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+g},setParams:function(e,t){return d(this.wmsParams,e),t||this.redraw(),this}});function Gr(e,t){return new Hn(e,t)}dt.WMS=Hn,Fn.wms=Gr;var $e=Ae.extend({options:{padding:.1},initialize:function(e){j(this,e),m(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Q(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var o=this._map.getZoomScale(t,this._zoom),a=this._map.getSize().multiplyBy(.5+this.options.padding),c=this._map.project(this._center,t),h=a.multiplyBy(-o).add(c).subtract(this._map._getNewPixelOrigin(e,t));F.any3d?Ve(this._container,h,o):fe(this._container,h)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var e in this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,t=this._map.getSize(),o=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new ne(o,o.add(t.multiplyBy(1+e*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Un=$e.extend({options:{tolerance:0},getEvents:function(){var e=$e.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){$e.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");Y(e,"mousemove",this._onMouseMove,this),Y(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Y(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){z(this._redrawRequest),delete this._ctx,ce(this._container),le(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var e;this._redrawBounds=null;for(var t in this._layers)e=this._layers[t],e._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){$e.prototype._update.call(this);var e=this._bounds,t=this._container,o=e.getSize(),a=F.retina?2:1;fe(t,e.min),t.width=a*o.x,t.height=a*o.y,t.style.width=o.x+"px",t.style.height=o.y+"px",F.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){$e.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[m(e)]=e;var t=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var t=e._order,o=t.next,a=t.prev;o?o.prev=a:this._drawLast=a,a?a.next=o:this._drawFirst=o,delete e._order,delete this._layers[m(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if(typeof e.options.dashArray=="string"){var t=e.options.dashArray.split(/[, ]+/),o=[],a,c;for(c=0;c<t.length;c++){if(a=Number(t[c]),isNaN(a))return;o.push(a)}e.options._dashArray=o}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||_(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var t=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ne,this._redrawBounds.extend(e._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(e._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var t=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,t=this._redrawBounds;if(this._ctx.save(),t){var o=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,o.x,o.y),this._ctx.clip()}this._drawing=!0;for(var a=this._drawFirst;a;a=a.next)e=a.layer,(!t||e._pxBounds&&e._pxBounds.intersects(t))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,t){if(this._drawing){var o,a,c,h,g=e._parts,y=g.length,v=this._ctx;if(y){for(v.beginPath(),o=0;o<y;o++){for(a=0,c=g[o].length;a<c;a++)h=g[o][a],v[a?"lineTo":"moveTo"](h.x,h.y);t&&v.closePath()}this._fillStroke(v,e)}}},_updateCircle:function(e){if(!(!this._drawing||e._empty())){var t=e._point,o=this._ctx,a=Math.max(Math.round(e._radius),1),c=(Math.max(Math.round(e._radiusY),1)||a)/a;c!==1&&(o.save(),o.scale(1,c)),o.beginPath(),o.arc(t.x,t.y/c,a,0,Math.PI*2,!1),c!==1&&o.restore(),this._fillStroke(o,e)}},_fillStroke:function(e,t){var o=t.options;o.fill&&(e.globalAlpha=o.fillOpacity,e.fillStyle=o.fillColor||o.color,e.fill(o.fillRule||"evenodd")),o.stroke&&o.weight!==0&&(e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.globalAlpha=o.opacity,e.lineWidth=o.weight,e.strokeStyle=o.color,e.lineCap=o.lineCap,e.lineJoin=o.lineJoin,e.stroke())},_onClick:function(e){for(var t=this._map.mouseEventToLayerPoint(e),o,a,c=this._drawFirst;c;c=c.next)o=c.layer,o.options.interactive&&o._containsPoint(t)&&(!(e.type==="click"||e.type==="preclick")||!this._map._draggableMoved(o))&&(a=o);this._fireEvent(a?[a]:!1,e)},_onMouseMove:function(e){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var t=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,t)}},_handleMouseOut:function(e){var t=this._hoveredLayer;t&&(pe(this._container,"leaflet-interactive"),this._fireEvent([t],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,t){if(!this._mouseHoverThrottled){for(var o,a,c=this._drawFirst;c;c=c.next)o=c.layer,o.options.interactive&&o._containsPoint(t)&&(a=o);a!==this._hoveredLayer&&(this._handleMouseOut(e),a&&(Q(this._container,"leaflet-interactive"),this._fireEvent([a],e,"mouseover"),this._hoveredLayer=a)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,e),this._mouseHoverThrottled=!0,setTimeout(p(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(e,t,o){this._map._fireDOMEvent(t,o||t.type,e)},_bringToFront:function(e){var t=e._order;if(t){var o=t.next,a=t.prev;if(o)o.prev=a;else return;a?a.next=o:o&&(this._drawFirst=o),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(e)}},_bringToBack:function(e){var t=e._order;if(t){var o=t.next,a=t.prev;if(a)a.next=o;else return;o?o.prev=a:a&&(this._drawLast=a),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(e)}}});function Gn(e){return F.canvas?new Un(e):null}var zt=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch{}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Vr={_initContainer:function(){this._container=oe("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||($e.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var t=e._container=zt("shape");Q(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",e._path=zt("path"),t.appendChild(e._path),this._updateStyle(e),this._layers[m(e)]=e},_addPath:function(e){var t=e._container;this._container.appendChild(t),e.options.interactive&&e.addInteractiveTarget(t)},_removePath:function(e){var t=e._container;ce(t),e.removeInteractiveTarget(t),delete this._layers[m(e)]},_updateStyle:function(e){var t=e._stroke,o=e._fill,a=e.options,c=e._container;c.stroked=!!a.stroke,c.filled=!!a.fill,a.stroke?(t||(t=e._stroke=zt("stroke")),c.appendChild(t),t.weight=a.weight+"px",t.color=a.color,t.opacity=a.opacity,a.dashArray?t.dashStyle=Z(a.dashArray)?a.dashArray.join(" "):a.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=a.lineCap.replace("butt","flat"),t.joinstyle=a.lineJoin):t&&(c.removeChild(t),e._stroke=null),a.fill?(o||(o=e._fill=zt("fill")),c.appendChild(o),o.color=a.fillColor||a.color,o.opacity=a.fillOpacity):o&&(c.removeChild(o),e._fill=null)},_updateCircle:function(e){var t=e._point.round(),o=Math.round(e._radius),a=Math.round(e._radiusY||o);this._setPath(e,e._empty()?"M0 0":"AL "+t.x+","+t.y+" "+o+","+a+" 0,"+65535*360)},_setPath:function(e,t){e._path.v=t},_bringToFront:function(e){nt(e._container)},_bringToBack:function(e){ot(e._container)}},Yt=F.vml?zt:Yi,Tt=$e.extend({_initContainer:function(){this._container=Yt("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Yt("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){ce(this._container),le(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){$e.prototype._update.call(this);var e=this._bounds,t=e.getSize(),o=this._container;(!this._svgSize||!this._svgSize.equals(t))&&(this._svgSize=t,o.setAttribute("width",t.x),o.setAttribute("height",t.y)),fe(o,e.min),o.setAttribute("viewBox",[e.min.x,e.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(e){var t=e._path=Yt("path");e.options.className&&Q(t,e.options.className),e.options.interactive&&Q(t,"leaflet-interactive"),this._updateStyle(e),this._layers[m(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){ce(e._path),e.removeInteractiveTarget(e._path),delete this._layers[m(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,o=e.options;t&&(o.stroke?(t.setAttribute("stroke",o.color),t.setAttribute("stroke-opacity",o.opacity),t.setAttribute("stroke-width",o.weight),t.setAttribute("stroke-linecap",o.lineCap),t.setAttribute("stroke-linejoin",o.lineJoin),o.dashArray?t.setAttribute("stroke-dasharray",o.dashArray):t.removeAttribute("stroke-dasharray"),o.dashOffset?t.setAttribute("stroke-dashoffset",o.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),o.fill?(t.setAttribute("fill",o.fillColor||o.color),t.setAttribute("fill-opacity",o.fillOpacity),t.setAttribute("fill-rule",o.fillRule||"evenodd")):t.setAttribute("fill","none"))},_updatePoly:function(e,t){this._setPath(e,Qi(e._parts,t))},_updateCircle:function(e){var t=e._point,o=Math.max(Math.round(e._radius),1),a=Math.max(Math.round(e._radiusY),1)||o,c="a"+o+","+a+" 0 1,0 ",h=e._empty()?"M0 0":"M"+(t.x-o)+","+t.y+c+o*2+",0 "+c+-o*2+",0 ";this._setPath(e,h)},_setPath:function(e,t){e._path.setAttribute("d",t)},_bringToFront:function(e){nt(e._path)},_bringToBack:function(e){ot(e._path)}});F.vml&&Tt.include(Vr);function Vn(e){return F.svg||F.vml?new Tt(e):null}ie.include({getRenderer:function(e){var t=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return t||(t=this._renderer=this._createRenderer()),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(e){if(e==="overlayPane"||e===void 0)return!1;var t=this._paneRenderers[e];return t===void 0&&(t=this._createRenderer({pane:e}),this._paneRenderers[e]=t),t},_createRenderer:function(e){return this.options.preferCanvas&&Gn(e)||Vn(e)}});var Kn=at.extend({initialize:function(e,t){at.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return e=ue(e),[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function Kr(e,t){return new Kn(e,t)}Tt.create=Yt,Tt.pointsToPath=Qi,Ze.geometryToLayer=$t,Ze.coordsToLatLng=Mi,Ze.coordsToLatLngs=Ft,Ze.latLngToCoords=Ii,Ze.latLngsToCoords=Ht,Ze.getFeature=lt,Ze.asFeature=Ut,ie.mergeOptions({boxZoom:!0});var Yn=De.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){Y(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){le(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){ce(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||e.which!==1&&e.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),yt(),xi(),this._startPoint=this._map.mouseEventToContainerPoint(e),Y(document,{contextmenu:Qe,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=oe("div","leaflet-zoom-box",this._container),Q(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var t=new ne(this._point,this._startPoint),o=t.getSize();fe(this._box,t.min),this._box.style.width=o.x+"px",this._box.style.height=o.y+"px"},_finish:function(){this._moved&&(ce(this._box),pe(this._container,"leaflet-crosshair")),vt(),mi(),le(document,{contextmenu:Qe,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if(!(e.which!==1&&e.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(p(this._resetState,this),0);var t=new ve(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t})}},_onKeyDown:function(e){e.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});ie.addInitHook("addHandler","boxZoom",Yn),ie.mergeOptions({doubleClickZoom:!0});var Qn=De.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,o=t.getZoom(),a=t.options.zoomDelta,c=e.originalEvent.shiftKey?o-a:o+a;t.options.doubleClickZoom==="center"?t.setZoom(c):t.setZoomAround(e.containerPoint,c)}});ie.addInitHook("addHandler","doubleClickZoom",Qn),ie.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Jn=De.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new He(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}Q(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){pe(this._map._container,"leaflet-grab"),pe(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=ue(this._map.options.maxBounds);this._offsetLimit=se(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var t=this._lastTime=+new Date,o=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(o),this._times.push(t),this._prunePositions(t)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,t){return e-(e-t)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var e=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;e.x<t.min.x&&(e.x=this._viscousLimit(e.x,t.min.x)),e.y<t.min.y&&(e.y=this._viscousLimit(e.y,t.min.y)),e.x>t.max.x&&(e.x=this._viscousLimit(e.x,t.max.x)),e.y>t.max.y&&(e.y=this._viscousLimit(e.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,t=Math.round(e/2),o=this._initialWorldOffset,a=this._draggable._newPos.x,c=(a-t+o)%e+t-o,h=(a+t+o)%e-t-o,g=Math.abs(c+o)<Math.abs(h+o)?c:h;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=g},_onDragEnd:function(e){var t=this._map,o=t.options,a=!o.inertia||e.noInertia||this._times.length<2;if(t.fire("dragend",e),a)t.fire("moveend");else{this._prunePositions(+new Date);var c=this._lastPos.subtract(this._positions[0]),h=(this._lastTime-this._times[0])/1e3,g=o.easeLinearity,y=c.multiplyBy(g/h),v=y.distanceTo([0,0]),A=Math.min(o.inertiaMaxSpeed,v),N=y.multiplyBy(A/v),G=A/(o.inertiaDeceleration*g),J=N.multiplyBy(-G/2).round();!J.x&&!J.y?t.fire("moveend"):(J=t._limitOffset(J,t.options.maxBounds),_(function(){t.panBy(J,{duration:G,easeLinearity:g,noMoveStart:!0,animate:!0})}))}}});ie.addInitHook("addHandler","dragging",Jn),ie.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Xn=De.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),Y(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),le(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,t=document.documentElement,o=e.scrollTop||t.scrollTop,a=e.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(a,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var t=this._panKeys={},o=this.keyCodes,a,c;for(a=0,c=o.left.length;a<c;a++)t[o.left[a]]=[-1*e,0];for(a=0,c=o.right.length;a<c;a++)t[o.right[a]]=[e,0];for(a=0,c=o.down.length;a<c;a++)t[o.down[a]]=[0,e];for(a=0,c=o.up.length;a<c;a++)t[o.up[a]]=[0,-1*e]},_setZoomDelta:function(e){var t=this._zoomKeys={},o=this.keyCodes,a,c;for(a=0,c=o.zoomIn.length;a<c;a++)t[o.zoomIn[a]]=e;for(a=0,c=o.zoomOut.length;a<c;a++)t[o.zoomOut[a]]=-e},_addHooks:function(){Y(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){le(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t=e.keyCode,o=this._map,a;if(t in this._panKeys){if(!o._panAnim||!o._panAnim._inProgress)if(a=this._panKeys[t],e.shiftKey&&(a=W(a).multiplyBy(3)),o.options.maxBounds&&(a=o._limitOffset(W(a),o.options.maxBounds)),o.options.worldCopyJump){var c=o.wrapLatLng(o.unproject(o.project(o.getCenter()).add(a)));o.panTo(c)}else o.panBy(a)}else if(t in this._zoomKeys)o.setZoom(o.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[t]);else if(t===27&&o._popup&&o._popup.options.closeOnEscapeKey)o.closePopup();else return;Qe(e)}}});ie.addInitHook("addHandler","keyboard",Xn),ie.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var eo=De.extend({addHooks:function(){Y(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){le(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var t=jn(e),o=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var a=Math.max(o-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(p(this._performZoom,this),a),Qe(e)},_performZoom:function(){var e=this._map,t=e.getZoom(),o=this._map.options.zoomSnap||0;e._stop();var a=this._delta/(this._map.options.wheelPxPerZoomLevel*4),c=4*Math.log(2/(1+Math.exp(-Math.abs(a))))/Math.LN2,h=o?Math.ceil(c/o)*o:c,g=e._limitZoom(t+(this._delta>0?h:-h))-t;this._delta=0,this._startTime=null,g&&(e.options.scrollWheelZoom==="center"?e.setZoom(t+g):e.setZoomAround(this._lastMousePos,t+g))}});ie.addInitHook("addHandler","scrollWheelZoom",eo);var Yr=600;ie.mergeOptions({tapHold:F.touchNative&&F.safari&&F.mobile,tapTolerance:15});var to=De.extend({addHooks:function(){Y(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){le(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),e.touches.length===1){var t=e.touches[0];this._startPos=this._newPos=new H(t.clientX,t.clientY),this._holdTimeout=setTimeout(p(function(){this._cancel(),this._isTapValid()&&(Y(document,"touchend",_e),Y(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",t))},this),Yr),Y(document,"touchend touchcancel contextmenu",this._cancel,this),Y(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){le(document,"touchend",_e),le(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),le(document,"touchend touchcancel contextmenu",this._cancel,this),le(document,"touchmove",this._onMove,this)},_onMove:function(e){var t=e.touches[0];this._newPos=new H(t.clientX,t.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,t){var o=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});o._simulated=!0,t.target.dispatchEvent(o)}});ie.addInitHook("addHandler","tapHold",to),ie.mergeOptions({touchZoom:F.touch,bounceAtZoomLimits:!0});var io=De.extend({addHooks:function(){Q(this._map._container,"leaflet-touch-zoom"),Y(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){pe(this._map._container,"leaflet-touch-zoom"),le(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(!(!e.touches||e.touches.length!==2||t._animatingZoom||this._zooming)){var o=t.mouseEventToContainerPoint(e.touches[0]),a=t.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),t.options.touchZoom!=="center"&&(this._pinchStartLatLng=t.containerPointToLatLng(o.add(a)._divideBy(2))),this._startDist=o.distanceTo(a),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),Y(document,"touchmove",this._onTouchMove,this),Y(document,"touchend touchcancel",this._onTouchEnd,this),_e(e)}},_onTouchMove:function(e){if(!(!e.touches||e.touches.length!==2||!this._zooming)){var t=this._map,o=t.mouseEventToContainerPoint(e.touches[0]),a=t.mouseEventToContainerPoint(e.touches[1]),c=o.distanceTo(a)/this._startDist;if(this._zoom=t.getScaleZoom(c,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&c<1||this._zoom>t.getMaxZoom()&&c>1)&&(this._zoom=t._limitZoom(this._zoom)),t.options.touchZoom==="center"){if(this._center=this._startLatLng,c===1)return}else{var h=o._add(a)._divideBy(2)._subtract(this._centerPoint);if(c===1&&h.x===0&&h.y===0)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(h),this._zoom)}this._moved||(t._moveStart(!0,!1),this._moved=!0),z(this._animRequest);var g=p(t._move,t,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=_(g,this,!0),_e(e)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,z(this._animRequest),le(document,"touchmove",this._onTouchMove,this),le(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});ie.addInitHook("addHandler","touchZoom",io),ie.BoxZoom=Yn,ie.DoubleClickZoom=Qn,ie.Drag=Jn,ie.Keyboard=Xn,ie.ScrollWheelZoom=eo,ie.TapHold=to,ie.TouchZoom=io,r.Bounds=ne,r.Browser=F,r.CRS=Re,r.Canvas=Un,r.Circle=Ri,r.CircleMarker=Zt,r.Class=R,r.Control=Ie,r.DivIcon=$n,r.DivOverlay=We,r.DomEvent=fr,r.DomUtil=pr,r.Draggable=He,r.Evented=te,r.FeatureGroup=qe,r.GeoJSON=Ze,r.GridLayer=kt,r.Handler=De,r.Icon=st,r.ImageOverlay=Gt,r.LatLng=re,r.LatLngBounds=ve,r.Layer=Ae,r.LayerGroup=rt,r.LineUtil=zr,r.Map=ie,r.Marker=Nt,r.Mixin=br,r.Path=Ue,r.Point=H,r.PolyUtil=wr,r.Polygon=at,r.Polyline=Ne,r.Popup=Vt,r.PosAnimation=Cn,r.Projection=Tr,r.Rectangle=Kn,r.Renderer=$e,r.SVG=Tt,r.SVGOverlay=Zn,r.TileLayer=dt,r.Tooltip=Kt,r.Transformation=he,r.Util=B,r.VideoOverlay=Nn,r.bind=p,r.bounds=se,r.canvas=Gn,r.circle=Br,r.circleMarker=Er,r.control=St,r.divIcon=Hr,r.extend=d,r.featureGroup=Mr,r.geoJSON=qn,r.geoJson=Wr,r.gridLayer=Ur,r.icon=Ir,r.imageOverlay=qr,r.latLng=ee,r.latLngBounds=ue,r.layerGroup=Rr,r.map=xr,r.marker=Ar,r.point=W,r.polygon=Dr,r.polyline=Or,r.popup=$r,r.rectangle=Kr,r.setOptions=j,r.stamp=m,r.svg=Vn,r.svgOverlay=Zr,r.tileLayer=Fn,r.tooltip=Fr,r.transformation=Me,r.version=l,r.videoOverlay=Nr;var Qr=window.L;r.noConflict=function(){return window.L=Qr,this},window.L=r})})(Ni,Ni.exports);var Mt=Ni.exports;const Gi=cs(Mt);function Vi(i,s,r){return Object.freeze({instance:i,context:s,container:r})}function Ki(i,s){return s==null?function(l,d){const u=O.useRef();return u.current||(u.current=i(l,d)),u}:function(l,d){const u=O.useRef();u.current||(u.current=i(l,d));const p=O.useRef(l),{instance:f}=u.current;return O.useEffect(function(){p.current!==l&&(s(f,l,p.current),p.current=l)},[f,l,d]),u}}function Ao(i,s){O.useEffect(function(){return(s.layerContainer??s.map).addLayer(i.instance),function(){var u;(u=s.layerContainer)==null||u.removeLayer(i.instance),s.map.removeLayer(i.instance)}},[s,i])}function Eo(i){return function(r){const l=Hi(),d=i(Ui(r,l),l);return ua(l.map,r.attribution),Io(d.current,r.eventHandlers),Ao(d.current,l),d}}function ma(i,s){const r=O.useRef();O.useEffect(function(){if(s.pathOptions!==r.current){const d=s.pathOptions??{};i.instance.setStyle(d),r.current=d}},[i,s])}function ga(i){return function(r){const l=Hi(),d=i(Ui(r,l),l);return Io(d.current,r.eventHandlers),Ao(d.current,l),ma(d.current,r),d}}function _a(i,s){const r=Ki(i,s),l=Eo(r);return Mo(l)}function ya(i,s){const r=Ki(i,s),l=ga(r);return Mo(l)}function va(i,s){const r=Ki(i,s),l=Eo(r);return xa(l)}function ba(i,s,r){const{opacity:l,zIndex:d}=s;l!=null&&l!==r.opacity&&i.setOpacity(l),d!=null&&d!==r.zIndex&&i.setZIndex(d)}function wa(){return Hi().map}const Sa=ya(function({center:s,children:r,...l},d){const u=new Mt.Circle(s,l);return Vi(u,Po(d,{overlayContainer:u}))},pa);function Zi(){return Zi=Object.assign||function(i){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(i[l]=r[l])}return i},Zi.apply(this,arguments)}function ja({bounds:i,boundsOptions:s,center:r,children:l,className:d,id:u,placeholder:p,style:f,whenReady:m,zoom:x,...M},w){const[I]=O.useState({className:d,id:u,style:f}),[P,S]=O.useState(null);O.useImperativeHandle(w,()=>(P==null?void 0:P.map)??null,[P]);const j=O.useCallback(b=>{if(b!==null&&P===null){const q=new Mt.Map(b,M);r!=null&&x!=null?q.setView(r,x):i!=null&&q.fitBounds(i,s),m!=null&&q.whenReady(m),S(fa(q))}},[]);O.useEffect(()=>()=>{P==null||P.map.remove()},[P]);const C=P?Fe.createElement(Ro,{value:P},l):p??null;return Fe.createElement("div",Zi({},I,{ref:j}),C)}const Ca=O.forwardRef(ja),ka=_a(function({position:s,...r},l){const d=new Mt.Marker(s,r);return Vi(d,Po(l,{overlayContainer:d}))},function(s,r,l){r.position!==l.position&&s.setLatLng(r.position),r.icon!=null&&r.icon!==l.icon&&s.setIcon(r.icon),r.zIndexOffset!=null&&r.zIndexOffset!==l.zIndexOffset&&s.setZIndexOffset(r.zIndexOffset),r.opacity!=null&&r.opacity!==l.opacity&&s.setOpacity(r.opacity),s.dragging!=null&&r.draggable!==l.draggable&&(r.draggable===!0?s.dragging.enable():s.dragging.disable())}),za=va(function({url:s,...r},l){const d=new Mt.TileLayer(s,Ui(r,l));return Vi(d,l)},function(s,r,l){ba(s,r,l);const{url:d}=r;d!=null&&d!==l.url&&s.setUrl(d)});delete Gi.Icon.Default.prototype._getIconUrl;Gi.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const ti=({width:i="100%",height:s="20px"})=>n.jsx("div",{style:{width:i,height:s,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Ta=({status:i,theme:s})=>{const r={Draft:{bg:s.textMuted,text:"#fff"},Scheduled:{bg:s.warning,text:"#fff"},Sending:{bg:s.primary,text:"#fff"},Completed:{bg:s.success,text:"#fff"},Cancelled:{bg:s.danger,text:"#fff"}},l=r[i]||r.Draft;return n.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${l.bg}20`,color:l.bg,borderRadius:"20px",fontSize:"11px",fontWeight:"500"},children:i})},Pa=({template:i,onSave:s,onClose:r,theme:l})=>{const[d,u]=O.useState((i==null?void 0:i.name)||""),[p,f]=O.useState((i==null?void 0:i.subject)||""),[m,x]=O.useState((i==null?void 0:i.body_html)||(i==null?void 0:i.body_text)||""),[M,w]=O.useState((i==null?void 0:i.category)||"general"),[I,P]=O.useState(!1),S=async()=>{P(!0);try{const b=await s({name:d,subject:p,body_html:m,body_text:m.replace(/<[^>]*>/g,""),category:M});r(b)}catch(b){console.error("Failed to save template:",b)}finally{P(!1)}},j=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],C=b=>{x(m+b)};return n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:200},onClick:()=>r(null)}),n.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxWidth:"95vw",maxHeight:"90vh",backgroundColor:l.bgCard,borderRadius:"16px",border:`1px solid ${l.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[n.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${l.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:l.text,margin:0},children:i?"Edit Template":"Create New Template"}),n.jsx("button",{onClick:()=>r(null),style:{background:"none",border:"none",color:l.textMuted,cursor:"pointer",fontSize:"20px"},children:""})]}),n.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Template Name"}),n.jsx("input",{type:"text",value:d,onChange:b=>u(b.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Category"}),n.jsxs("select",{value:M,onChange:b=>w(b.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"},children:[n.jsx("option",{value:"general",children:"General"}),n.jsx("option",{value:"welcome",children:"Welcome"}),n.jsx("option",{value:"renewal",children:"Renewal"}),n.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),n.jsx("option",{value:"engagement",children:"Engagement"}),n.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),n.jsxs("div",{style:{marginBottom:"16px"},children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),n.jsx("input",{type:"text",value:p,onChange:b=>f(b.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),n.jsxs("div",{style:{marginBottom:"16px"},children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),n.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:j.map(b=>n.jsx("button",{onClick:()=>C(b.key),style:{padding:"4px 10px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"6px",color:l.textSecondary,cursor:"pointer",fontSize:"11px"},children:b.label},b.key))})]}),n.jsxs("div",{children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Email Body"}),n.jsx("textarea",{value:m,onChange:b=>x(b.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:10,style:{width:"100%",padding:"12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),n.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${l.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[n.jsx("button",{onClick:()=>r(null),style:{padding:"10px 20px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),n.jsx("button",{onClick:S,disabled:I||!d||!p,style:{padding:"10px 20px",backgroundColor:l.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:I?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:I||!d||!p?.6:1},children:I?"Creating...":"Create & Select"})]})]})]})},La=({batch:i,onView:s,theme:r})=>{var d;const l=i.total_recipients>0?Math.round(i.emails_sent/i.total_recipients*100):0;return n.jsxs("div",{style:{padding:"16px",backgroundColor:r.bgCard,borderRadius:"10px",border:`1px solid ${r.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px"},children:[n.jsxs("div",{style:{flex:1},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"6px"},children:[n.jsx("span",{style:{fontWeight:"600",color:r.text},children:i.name||"Untitled Batch"}),n.jsx(Ta,{status:i.status,theme:r})]}),n.jsx("p",{style:{fontSize:"13px",color:r.textSecondary,margin:0},children:i.subject||"No subject"}),n.jsxs("p",{style:{fontSize:"12px",color:r.textMuted,margin:"4px 0 0"},children:[((d=i.template)==null?void 0:d.name)||"Custom email","  ",i.total_recipients||0," recipients"]})]}),i.status!=="Draft"&&n.jsxs("div",{style:{textAlign:"right",minWidth:"100px"},children:[n.jsxs("div",{style:{fontSize:"18px",fontWeight:"600",color:r.text},children:[l,"%"]}),n.jsxs("div",{style:{fontSize:"11px",color:r.textMuted},children:[i.emails_sent||0," / ",i.total_recipients||0," sent"]})]}),n.jsx("button",{onClick:()=>s(i),style:{padding:"8px 16px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.text,cursor:"pointer",fontSize:"13px"},children:"View"})]})},Ra=({currentStep:i,steps:s,theme:r})=>n.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"24px"},children:s.map((l,d)=>n.jsxs(Fe.Fragment,{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:d<=i?r.primary:r.bgHover,color:d<=i?"#fff":r.textMuted,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"13px",fontWeight:"600"},children:d<i?"":d+1}),n.jsx("span",{style:{fontSize:"14px",fontWeight:d===i?"600":"400",color:d<=i?r.text:r.textMuted},children:l})]}),d<s.length-1&&n.jsx("div",{style:{flex:1,height:"2px",backgroundColor:d<i?r.primary:r.border,minWidth:"40px"}})]},l))}),Ma=({selectedTemplate:i,onSelect:s,onCreateNew:r,templates:l,isLoading:d,theme:u})=>{const[p,f]=O.useState(""),m=O.useMemo(()=>l?p?l.filter(x=>x.name.toLowerCase().includes(p.toLowerCase())||x.subject.toLowerCase().includes(p.toLowerCase())):l:[],[l,p]);return n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:u.text,margin:0},children:"Select an Email Template"}),n.jsxs("button",{onClick:r,style:{padding:"8px 16px",backgroundColor:u.bgHover,border:`1px solid ${u.border}`,borderRadius:"8px",color:u.text,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[n.jsx("span",{children:"+"})," Create New Template"]})]}),n.jsxs("div",{style:{position:"relative",marginBottom:"16px"},children:[n.jsx("input",{type:"text",placeholder:"Search templates...",value:p,onChange:x=>f(x.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:u.bgInput,border:`1px solid ${u.border}`,borderRadius:"8px",color:u.text,fontSize:"14px"}}),n.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:u.textMuted},children:""})]}),d?n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"},children:Array.from({length:4}).map((x,M)=>n.jsxs("div",{style:{padding:"16px",backgroundColor:u.bgCard,borderRadius:"10px",border:`1px solid ${u.border}`},children:[n.jsx(ti,{width:"120px",height:"16px"}),n.jsx("div",{style:{marginTop:"8px"},children:n.jsx(ti,{width:"200px",height:"14px"})})]},M))}):n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px",maxHeight:"400px",overflow:"auto"},children:m.map(x=>n.jsxs("div",{onClick:()=>s(x),style:{padding:"16px",backgroundColor:u.bgCard,borderRadius:"10px",border:`2px solid ${(i==null?void 0:i.id)===x.id?u.primary:u.border}`,cursor:"pointer",transition:"border-color 0.15s"},children:[n.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:u.text,marginBottom:"4px"},children:x.name}),n.jsx("div",{style:{fontSize:"13px",color:u.textSecondary},children:x.subject}),n.jsx("div",{style:{marginTop:"8px",padding:"4px 8px",backgroundColor:`${u.primary}15`,color:u.primary,borderRadius:"4px",fontSize:"11px",display:"inline-block",textTransform:"capitalize"},children:x.category||"General"})]},x.id))}),!d&&m.length===0&&n.jsx("div",{style:{textAlign:"center",padding:"40px",color:u.textMuted},children:p?"No templates match your search":"No templates available. Create one to get started!"})]})},po=[{value:"account_status",label:"Account Status",type:"select",options:[{value:"customer",label:"Customer"},{value:"prospect",label:"Prospect"},{value:"prior_customer",label:"Prior Customer"},{value:"lead",label:"Lead"}]},{value:"policy_type",label:"Policy Type",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"policy_count",label:"Number of Policies",type:"number"},{value:"policy_expiration",label:"Policy Expiration",type:"date"},{value:"location",label:"Location",type:"location"},{value:"state",label:"State",type:"select",options:[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}]},{value:"city",label:"City",type:"text"}],Ia={select:[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"is_any",label:"is any of"}],number:[{value:"equals",label:"equals"},{value:"greater_than",label:"greater than"},{value:"less_than",label:"less than"},{value:"at_least",label:"at least"}],date:[{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"between",label:"is between"},{value:"in_next_days",label:"is in the next"}],location:[{value:"within_radius",label:"is within"}],text:[{value:"contains",label:"contains"},{value:"equals",label:"equals"},{value:"starts_with",label:"starts with"}]},Aa=[5,10,15,25,50,100],Ea=({center:i,radiusMeters:s})=>{const r=wa();return O.useEffect(()=>{if(i&&s&&r){const l=s/111320,d=Gi.latLngBounds([i[0]-l,i[1]-l],[i[0]+l,i[1]+l]);r.fitBounds(d,{padding:[20,20]})}},[r,i,s]),null},Ba=({location:i,radius:s,onClose:r,theme:l})=>{if(!i)return null;const d=parseFloat(i.lat),u=parseFloat(i.lng),p=s*1609.34;return n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",zIndex:1e3},onClick:r}),n.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"600px",maxWidth:"95vw",backgroundColor:l.bgCard,borderRadius:"16px",border:`1px solid ${l.border}`,zIndex:1001,overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[n.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${l.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{children:[n.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:l.text},children:"Location Radius Preview"}),n.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:l.textSecondary},children:[" ",i.display]})]}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[n.jsxs("div",{style:{padding:"6px 12px",backgroundColor:`${l.primary}15`,color:l.primary,borderRadius:"6px",fontWeight:"600",fontSize:"14px"},children:[s," mile radius"]}),n.jsx("button",{onClick:r,style:{background:"none",border:"none",color:l.textMuted,cursor:"pointer",fontSize:"24px",lineHeight:1},children:""})]})]}),n.jsx("div",{style:{height:"400px"},children:n.jsxs(Ca,{center:[d,u],zoom:10,style:{height:"100%",width:"100%"},children:[n.jsx(za,{attribution:' <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),n.jsx(Sa,{center:[d,u],radius:p,pathOptions:{color:l.primary,fillColor:l.primary,fillOpacity:.2,weight:3}}),n.jsx(ka,{position:[d,u]}),n.jsx(Ea,{center:[d,u],radiusMeters:p})]})}),n.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${l.border}`,backgroundColor:l.bgHover,fontSize:"12px",color:l.textSecondary,textAlign:"center"},children:"Recipients within this area will be included in your campaign"})]})]})},Oa=({location:i,radius:s,theme:r})=>{const[l,d]=O.useState(!1);return i?n.jsxs(n.Fragment,{children:[n.jsx("div",{style:{marginTop:"12px",borderRadius:"8px",overflow:"hidden",border:`1px solid ${r.border}`},children:n.jsxs("div",{style:{padding:"12px 16px",backgroundColor:r.bgHover,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[n.jsx("span",{style:{fontSize:"20px"},children:""}),n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:r.text},children:i.display}),n.jsxs("div",{style:{fontSize:"12px",color:r.textSecondary},children:[s," mile radius"]})]})]}),n.jsx("button",{onClick:()=>d(!0),style:{padding:"8px 16px",backgroundColor:r.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:" View Map"})]})}),l&&n.jsx(Ba,{location:i,radius:s,onClose:()=>d(!1),theme:r})]}):null},Da=({rule:i,index:s,onUpdate:r,onRemove:l,theme:d})=>{const u=po.find(x=>x.value===i.field),p=u?Ia[u.type]:[],f={padding:"8px 12px",backgroundColor:d.bgInput,border:`1px solid ${d.border}`,borderRadius:"6px",color:d.text,fontSize:"13px",minWidth:"140px"},m={padding:"8px 12px",backgroundColor:d.bgInput,border:`1px solid ${d.border}`,borderRadius:"6px",color:d.text,fontSize:"13px",width:"120px"};return n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:d.bgCard,borderRadius:"8px",border:`1px solid ${d.border}`,flexWrap:"wrap"},children:[s>0&&n.jsx("span",{style:{fontSize:"12px",color:d.primary,fontWeight:"600",padding:"4px 8px",backgroundColor:`${d.primary}15`,borderRadius:"4px"},children:"AND"}),n.jsxs("select",{value:i.field||"",onChange:x=>r(s,{...i,field:x.target.value,operator:"",value:""}),style:f,children:[n.jsx("option",{value:"",children:"Select field..."}),po.map(x=>n.jsx("option",{value:x.value,children:x.label},x.value))]}),i.field&&n.jsxs("select",{value:i.operator||"",onChange:x=>r(s,{...i,operator:x.target.value}),style:f,children:[n.jsx("option",{value:"",children:"Select condition..."}),p.map(x=>n.jsx("option",{value:x.value,children:x.label},x.value))]}),i.field&&i.operator&&n.jsxs(n.Fragment,{children:[(u==null?void 0:u.type)==="select"&&i.operator!=="is_any"&&n.jsxs("select",{value:i.value||"",onChange:x=>r(s,{...i,value:x.target.value}),style:f,children:[n.jsx("option",{value:"",children:"Select value..."}),u.options.map(x=>n.jsx("option",{value:x.value,children:x.label},x.value))]}),(u==null?void 0:u.type)==="select"&&i.operator==="is_any"&&n.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:u.options.map(x=>n.jsx("button",{onClick:()=>{const M=i.value?i.value.split(","):[],w=M.includes(x.value)?M.filter(I=>I!==x.value):[...M,x.value];r(s,{...i,value:w.join(",")})},style:{padding:"4px 10px",backgroundColor:(i.value||"").split(",").includes(x.value)?d.primary:d.bgHover,color:(i.value||"").split(",").includes(x.value)?"#fff":d.text,border:`1px solid ${(i.value||"").split(",").includes(x.value)?d.primary:d.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:x.label},x.value))}),(u==null?void 0:u.type)==="number"&&n.jsx("input",{type:"number",value:i.value||"",onChange:x=>r(s,{...i,value:x.target.value}),placeholder:"0",style:m}),(u==null?void 0:u.type)==="date"&&i.operator==="in_next_days"&&n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"number",value:i.value||"",onChange:x=>r(s,{...i,value:x.target.value}),placeholder:"30",style:{...m,width:"70px"}}),n.jsx("span",{style:{fontSize:"13px",color:d.textSecondary},children:"days"})]}),(u==null?void 0:u.type)==="date"&&i.operator==="between"&&n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"date",value:i.value||"",onChange:x=>r(s,{...i,value:x.target.value}),style:m}),n.jsx("span",{style:{fontSize:"13px",color:d.textSecondary},children:"and"}),n.jsx("input",{type:"date",value:i.value2||"",onChange:x=>r(s,{...i,value2:x.target.value}),style:m})]}),(u==null?void 0:u.type)==="date"&&(i.operator==="before"||i.operator==="after")&&n.jsx("input",{type:"date",value:i.value||"",onChange:x=>r(s,{...i,value:x.target.value}),style:m}),(u==null?void 0:u.type)==="text"&&n.jsx("input",{type:"text",value:i.value||"",onChange:x=>r(s,{...i,value:x.target.value}),placeholder:`Enter ${u.label.toLowerCase()}...`,style:{...m,width:"160px"}}),(u==null?void 0:u.type)==="location"&&n.jsx(Wa,{rule:i,onUpdate:x=>r(s,{...i,...x}),theme:d})]}),n.jsx("button",{onClick:()=>l(s),style:{marginLeft:"auto",padding:"6px 10px",backgroundColor:"transparent",border:"none",color:d.textMuted,cursor:"pointer",fontSize:"16px",borderRadius:"4px"},title:"Remove filter",children:""})]})},Wa=({rule:i,onUpdate:s,theme:r})=>{const[l,d]=O.useState(i.locationDisplay||""),[u,p]=O.useState(!1),[f,m]=O.useState([]),[x,M]=O.useState(!1),w={padding:"8px 12px",backgroundColor:r.bgInput,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.text,fontSize:"13px"},I=async S=>{if(S.length<3){m([]);return}p(!0);try{const C=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&q=${encodeURIComponent(S)}&limit=5`,{headers:{"Accept-Language":"en"}})).json();m(C.map(b=>({display:b.display_name,lat:b.lat,lng:b.lon,type:b.type}))),M(!0)}catch(j){console.error("Geocoding error:",j),m([])}finally{p(!1)}};Fe.useEffect(()=>{const S=setTimeout(()=>{l&&l!==i.locationDisplay&&I(l)},300);return()=>clearTimeout(S)},[l]);const P=S=>{d(S.display.split(",").slice(0,2).join(",")),s({value:`${S.lat},${S.lng}`,locationDisplay:S.display.split(",").slice(0,2).join(","),locationData:S}),M(!1)};return n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",flex:1,minWidth:"300px"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[n.jsxs("div",{style:{position:"relative",flex:1,minWidth:"200px"},children:[n.jsx("input",{type:"text",value:l,onChange:S=>d(S.target.value),onFocus:()=>f.length>0&&M(!0),placeholder:"Enter zip code, city, or address...",style:{...w,width:"100%",paddingRight:"30px"}}),u&&n.jsx("span",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:r.textMuted,fontSize:"12px"},children:"..."}),x&&f.length>0&&n.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:r.bgCard,border:`1px solid ${r.border}`,borderRadius:"6px",marginTop:"4px",zIndex:100,maxHeight:"200px",overflow:"auto",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:f.map((S,j)=>n.jsxs("button",{onClick:()=>P(S),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderBottom:j<f.length-1?`1px solid ${r.border}`:"none",color:r.text,fontSize:"12px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"flex-start",gap:"8px"},onMouseEnter:C=>C.target.style.backgroundColor=r.bgHover,onMouseLeave:C=>C.target.style.backgroundColor="transparent",children:[n.jsx("span",{children:""}),n.jsx("span",{style:{lineHeight:"1.4"},children:S.display})]},j))})]}),n.jsx("span",{style:{fontSize:"13px",color:r.textSecondary},children:"of"}),n.jsx("select",{value:i.radius||"25",onChange:S=>s({radius:S.target.value}),style:{...w,minWidth:"100px"},children:Aa.map(S=>n.jsxs("option",{value:S,children:[S," miles"]},S))})]}),i.locationData&&n.jsx(Oa,{location:i.locationData,radius:parseInt(i.radius||"25",10),theme:r})]})},qa=({breakdown:i,isLoading:s,theme:r})=>{const[l,d]=O.useState(!1);return s?n.jsx("div",{style:{padding:"12px 16px",backgroundColor:r.bgHover,borderRadius:"8px",marginTop:"12px",fontSize:"13px",color:r.textSecondary},children:"Loading location data..."}):!i||i.byCity.length===0?null:n.jsxs("div",{style:{marginTop:"12px",backgroundColor:r.bgCard,borderRadius:"8px",border:`1px solid ${r.border}`,overflow:"hidden"},children:[n.jsxs("button",{onClick:()=>d(!l),style:{width:"100%",padding:"12px 16px",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",color:r.text},children:[n.jsx("span",{style:{fontSize:"13px",fontWeight:"500"},children:" View Recipients by City"}),n.jsx("span",{style:{fontSize:"12px",color:r.textSecondary},children:l?"":""})]}),l&&n.jsx("div",{style:{padding:"0 16px 16px"},children:n.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:i.byCity.map(({city:u,count:p})=>n.jsxs("div",{style:{padding:"6px 10px",backgroundColor:r.bgHover,borderRadius:"6px",fontSize:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[n.jsx("span",{style:{color:r.text},children:u}),n.jsx("span",{style:{backgroundColor:r.primary,color:"#fff",padding:"2px 6px",borderRadius:"10px",fontSize:"11px",fontWeight:"600"},children:p})]},u))})})]})},Na=({filterConfig:i,setFilterConfig:s,recipientCount:r,isLoading:l,isFetching:d,locationBreakdown:u,isLoadingBreakdown:p,theme:f})=>{const m=i.rules||[],x=()=>{s({...i,rules:[...m,{field:"",operator:"",value:""}]})},M=(S,j)=>{const C=[...m];C[S]=j,s({...i,rules:C})},w=S=>{const j=m.filter((C,b)=>b!==S);s({...i,rules:j})},I=()=>{s({...i,rules:[],search:""})},P=m.filter(S=>S.field&&S.operator&&S.value).length;return n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:f.text,margin:0},children:"Filter Recipients"}),(m.length>0||i.search)&&n.jsx("button",{onClick:I,style:{padding:"6px 12px",backgroundColor:"transparent",border:`1px solid ${f.border}`,borderRadius:"6px",color:f.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Clear all"})]}),n.jsxs("div",{style:{padding:"16px",backgroundColor:f.bgHover,borderRadius:"12px",marginBottom:"16px"},children:[m.length===0?n.jsx("div",{style:{textAlign:"center",padding:"20px",color:f.textMuted,fontSize:"14px"},children:"No filters applied. All accounts with valid emails will be included."}):n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:m.map((S,j)=>n.jsx(Da,{rule:S,index:j,onUpdate:M,onRemove:w,theme:f},j))}),n.jsxs("button",{onClick:x,style:{width:"100%",padding:"10px",backgroundColor:f.bgCard,border:`1px dashed ${f.border}`,borderRadius:"8px",color:f.primary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[n.jsx("span",{children:"+"})," Add Filter"]})]}),P>0&&n.jsxs("div",{style:{padding:"12px 16px",backgroundColor:`${f.primary}10`,borderRadius:"8px",marginBottom:"16px",fontSize:"13px",color:f.text},children:[n.jsx("strong",{children:P})," filter",P!==1?"s":""," applied",n.jsx("span",{style:{color:f.textSecondary},children:"  results update automatically"})]}),n.jsxs("div",{style:{padding:"16px",backgroundColor:f.bgCard,borderRadius:"12px",border:`1px solid ${f.border}`,marginBottom:"16px"},children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:f.text,display:"block",marginBottom:"8px"},children:"Search by Name or Email"}),n.jsx("input",{type:"text",placeholder:"Type to search...",value:i.search||"",onChange:S=>s({...i,search:S.target.value}),style:{width:"100%",padding:"10px 12px",backgroundColor:f.bgInput,border:`1px solid ${f.border}`,borderRadius:"8px",color:f.text,fontSize:"14px"}})]}),n.jsxs("div",{style:{padding:"20px",backgroundColor:`${f.primary}10`,borderRadius:"12px",border:`1px solid ${f.primary}30`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:f.text},children:"Matching Recipients"}),n.jsx("div",{style:{fontSize:"12px",color:f.textSecondary},children:d&&r!==void 0?"Updating count...":"Accounts with valid emails who haven't opted out"})]}),n.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:f.primary,opacity:d?.6:1,transition:"opacity 0.2s"},children:l?"...":(r??0).toLocaleString()})]}),n.jsx(qa,{breakdown:u,isLoading:p,theme:f})]})},Za=({template:i,filterConfig:s,subject:r,setSubject:l,name:d,setName:u,recipients:p,isLoadingRecipients:f,theme:m})=>n.jsxs("div",{children:[n.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:m.text,marginBottom:"16px"},children:"Review & Send"}),n.jsxs("div",{style:{padding:"20px",backgroundColor:m.bgCard,borderRadius:"12px",border:`1px solid ${m.border}`,marginBottom:"16px"},children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:m.text,display:"block",marginBottom:"6px"},children:"Campaign Name"}),n.jsx("input",{type:"text",placeholder:"e.g., December Newsletter",value:d,onChange:x=>u(x.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:m.bgInput,border:`1px solid ${m.border}`,borderRadius:"8px",color:m.text,fontSize:"14px"}})]}),n.jsxs("div",{style:{padding:"20px",backgroundColor:m.bgCard,borderRadius:"12px",border:`1px solid ${m.border}`,marginBottom:"16px"},children:[n.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:m.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),n.jsx("input",{type:"text",placeholder:"Email subject...",value:r,onChange:x=>l(x.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:m.bgInput,border:`1px solid ${m.border}`,borderRadius:"8px",color:m.text,fontSize:"14px"}}),n.jsxs("p",{style:{fontSize:"12px",color:m.textMuted,marginTop:"6px"},children:["Use merge fields like ","{{first_name}}"," for personalization"]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[n.jsxs("div",{style:{padding:"16px",backgroundColor:m.bgCard,borderRadius:"12px",border:`1px solid ${m.border}`},children:[n.jsx("div",{style:{fontSize:"12px",color:m.textMuted,marginBottom:"4px"},children:"Template"}),n.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:m.text},children:i==null?void 0:i.name})]}),n.jsxs("div",{style:{padding:"16px",backgroundColor:m.bgCard,borderRadius:"12px",border:`1px solid ${m.border}`},children:[n.jsx("div",{style:{fontSize:"12px",color:m.textMuted,marginBottom:"4px"},children:"Recipients"}),n.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:m.text},children:[f?"...":((p==null?void 0:p.length)||0).toLocaleString()," accounts"]})]})]}),p&&p.length>0&&n.jsxs("div",{style:{padding:"16px",backgroundColor:m.bgCard,borderRadius:"12px",border:`1px solid ${m.border}`},children:[n.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:m.text,marginBottom:"12px"},children:"Preview Recipients (first 10)"}),n.jsx("div",{style:{maxHeight:"200px",overflow:"auto"},children:p.slice(0,10).map((x,M)=>n.jsxs("div",{style:{padding:"8px 0",borderBottom:M<Math.min(9,p.length-1)?`1px solid ${m.border}`:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:"13px",color:m.text},children:x.primary_contact_first_name?`${x.primary_contact_first_name} ${x.primary_contact_last_name||""}`:x.name}),n.jsx("div",{style:{fontSize:"12px",color:m.textMuted},children:x.person_email||x.email})]}),n.jsx("span",{style:{padding:"2px 8px",backgroundColor:m.bgHover,color:m.textSecondary,borderRadius:"4px",fontSize:"11px",textTransform:"capitalize"},children:x.account_status})]},x.account_unique_id))}),p.length>10&&n.jsxs("div",{style:{fontSize:"12px",color:m.textMuted,marginTop:"8px",textAlign:"center"},children:["+",p.length-10," more recipients"]})]})]}),$a=({t:i})=>{const{userId:s}=ge(),[r,l]=O.useState(!1),[d,u]=O.useState(!1),[p,f]=O.useState(0),[m,x]=O.useState(null),[M,w]=O.useState({rules:[],search:"",notOptedOut:!0}),[I,P]=O.useState(""),[S,j]=O.useState(""),[C,b]=O.useState(!1),[q,Z]=O.useState(null),[E,k]=O.useState(null),{data:D,isLoading:V,refetch:K}=xo(),{data:ae,isLoading:X,refetch:_}=Os(),{data:z,isLoading:B,isFetching:R}=Ws(p>=1?M:null),{data:$,isLoading:U}=qs(p>=1?M:null),{data:te,isLoading:H}=Ds(p===2?M:null,{limit:100}),{createBatch:we,scheduleBatch:W}=Ns(),{createTemplate:ne}=mo(),se=["Select Template","Filter Recipients","Review & Send"],ve=he=>{x(he),P(he.subject||"")},ue=async he=>{const Me=await ne.mutateAsync(he);return await K(),Me},re=he=>{u(!1),he&&(x(he),P(he.subject||""))},ee=()=>{p<2&&f(p+1)},Re=()=>{p>0&&f(p-1)},Ee=async()=>{if(!(!m||!I)){b(!0),Z(null);try{const he=await we.mutateAsync({name:S||`Mass Email - ${new Date().toLocaleDateString()}`,subject:I,template_id:m.id,filter_config:M,total_recipients:z||0});await W.mutateAsync({batchId:he.id}),k(`Successfully scheduled ${z} emails for sending!`),l(!1),xt(),_()}catch(he){Z(he.message||"Failed to send mass email")}finally{b(!1)}}},xt=()=>{f(0),x(null),w({rules:[],search:"",notOptedOut:!0}),P(""),j("")},ke=()=>p===0?!!m:p===1?(z||0)>0:p===2?!!I&&!!S:!1;return n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[n.jsxs("div",{children:[n.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:i.text,marginBottom:"4px"},children:"Mass Email"}),n.jsx("p",{style:{color:i.textSecondary,fontSize:"14px",margin:0},children:"Send one-off emails to filtered recipients"})]}),!r&&n.jsxs("button",{onClick:()=>l(!0),style:{padding:"10px 20px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[n.jsx("span",{children:"+"})," New Campaign"]})]}),E&&n.jsxs("div",{style:{padding:"16px",backgroundColor:`${i.success}15`,border:`1px solid ${i.success}30`,borderRadius:"8px",marginBottom:"24px",color:i.success,fontSize:"14px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[E,n.jsx("button",{onClick:()=>k(null),style:{background:"none",border:"none",color:i.success,cursor:"pointer"},children:""})]}),r?n.jsxs("div",{style:{backgroundColor:i.bgCard,borderRadius:"16px",border:`1px solid ${i.border}`,padding:"24px"},children:[n.jsx(Ra,{currentStep:p,steps:se,theme:i}),q&&n.jsx("div",{style:{padding:"12px 16px",backgroundColor:`${i.danger}15`,border:`1px solid ${i.danger}30`,borderRadius:"8px",marginBottom:"16px",color:i.danger,fontSize:"14px"},children:q}),n.jsxs("div",{style:{minHeight:"300px"},children:[p===0&&n.jsx(Ma,{selectedTemplate:m,onSelect:ve,onCreateNew:()=>u(!0),templates:D,isLoading:V,theme:i}),p===1&&n.jsx(Na,{filterConfig:M,setFilterConfig:w,recipientCount:z,isLoading:B,isFetching:R,locationBreakdown:$,isLoadingBreakdown:U,theme:i}),p===2&&n.jsx(Za,{template:m,filterConfig:M,subject:I,setSubject:P,name:S,setName:j,recipients:te,isLoadingRecipients:H,theme:i})]}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"24px",borderTop:`1px solid ${i.border}`,marginTop:"24px"},children:[n.jsx("button",{onClick:()=>{p===0?(l(!1),xt()):Re()},style:{padding:"10px 20px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,cursor:"pointer",fontSize:"14px"},children:p===0?"Cancel":"Back"}),p<2?n.jsx("button",{onClick:ee,disabled:!ke(),style:{padding:"10px 24px",backgroundColor:ke()?i.primary:i.bgHover,border:"none",borderRadius:"8px",color:ke()?"#fff":i.textMuted,cursor:ke()?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500"},children:"Continue"}):n.jsx("button",{onClick:Ee,disabled:!ke()||C,style:{padding:"10px 24px",backgroundColor:ke()&&!C?i.success:i.bgHover,border:"none",borderRadius:"8px",color:ke()&&!C?"#fff":i.textMuted,cursor:ke()&&!C?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px"},children:C?"Sending...":"Send Emails"})]})]}):n.jsx(n.Fragment,{children:n.jsxs("div",{style:{marginBottom:"24px"},children:[n.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:i.text,marginBottom:"16px"},children:"Recent Campaigns"}),X?n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:Array.from({length:3}).map((he,Me)=>n.jsxs("div",{style:{padding:"16px",backgroundColor:i.bgCard,borderRadius:"10px",border:`1px solid ${i.border}`},children:[n.jsx(ti,{width:"200px",height:"18px"}),n.jsx("div",{style:{marginTop:"8px"},children:n.jsx(ti,{width:"300px",height:"14px"})})]},Me))}):ae&&ae.length>0?n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:ae.map(he=>n.jsx(La,{batch:he,onView:Me=>console.log("View batch:",Me),theme:i},he.id))}):n.jsxs("div",{style:{padding:"60px 20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`,textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),n.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:i.text,marginBottom:"8px"},children:"No campaigns yet"}),n.jsx("p",{style:{fontSize:"14px",color:i.textSecondary,marginBottom:"24px"},children:"Create your first mass email campaign to reach your clients."}),n.jsx("button",{onClick:()=>l(!0),style:{padding:"10px 20px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Campaign"})]})]})}),d&&n.jsx(Pa,{template:null,onSave:ue,onClose:re,theme:i})]})},Fa=O.createContext(),Wi={light:{bg:"#f8fafc",bgCard:"#ffffff",bgSidebar:"#ffffff",bgHover:"#f1f5f9",bgInput:"#ffffff",border:"#e2e8f0",borderLight:"#f1f5f9",text:"#1e293b",textSecondary:"#64748b",textMuted:"#94a3b8",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},dark:{bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"}},Ha=O.createContext(),Ua=()=>{const{userId:i}=ge(),s=ho();ft();const[r,l]=O.useState(!1),[d,u]=O.useState({id:i,name:"Logan Johns",email:"info@isgdfw.com",org:"ISG"}),p=r?Wi.dark:Wi.light,m=(()=>{const M=s.pathname.split("/").slice(2).join("/");return M.startsWith("automations/")?"automations":M.startsWith("accounts/")?"accounts":M||"dashboard"})(),x=[{id:"dashboard",label:"Dashboard",icon:"",path:`/${i}/dashboard`},{id:"automations",label:"Automations",icon:"",path:`/${i}/automations`},{id:"templates",label:"Templates",icon:"",path:`/${i}/templates`},{id:"mass-email",label:"Mass Email",icon:"",path:`/${i}/mass-email`},{id:"accounts",label:"Accounts",icon:"",path:`/${i}/accounts`},{id:"settings",label:"Settings",icon:"",path:`/${i}/settings`}];return n.jsx(Fa.Provider,{value:{isDark:r,setIsDark:l,t:p,themes:Wi},children:n.jsx(Ha.Provider,{value:{userId:i,currentUser:d,setCurrentUser:u},children:n.jsxs("div",{style:{fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",backgroundColor:p.bg,minHeight:"100vh",display:"flex",color:p.text},children:[n.jsxs("div",{style:{width:"220px",backgroundColor:p.bgSidebar,borderRight:`1px solid ${p.border}`,display:"flex",flexDirection:"column",position:"fixed",top:0,left:0,bottom:0},children:[n.jsx("div",{style:{padding:"20px 16px",borderBottom:`1px solid ${p.border}`},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[n.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:p.primary,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"18px"},children:""}),n.jsxs("div",{children:[n.jsx("div",{style:{fontWeight:"700",fontSize:"14px",color:p.text},children:"Email Automation"}),n.jsx("div",{style:{fontSize:"11px",color:p.textMuted},children:"Marketing System"})]})]})}),n.jsxs("div",{style:{flex:1,padding:"12px 8px"},children:[n.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:p.textMuted,padding:"8px 12px",textTransform:"uppercase"},children:"Navigation"}),x.map(M=>n.jsxs(tt,{to:M.path,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:m===M.id?`${p.primary}15`:"transparent",border:"none",borderRadius:"8px",color:m===M.id?p.primary:p.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:m===M.id?"600":"400",textAlign:"left",alignItems:"center",gap:"10px",marginBottom:"2px",textDecoration:"none"},children:[n.jsx("span",{children:M.icon})," ",M.label]},M.id)),n.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:p.textMuted,padding:"16px 12px 8px",textTransform:"uppercase"},children:"Admin"}),n.jsxs(tt,{to:`/${i}/timeline`,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:m==="timeline"?`${p.primary}15`:"transparent",border:"none",borderRadius:"8px",color:m==="timeline"?p.primary:p.textSecondary,cursor:"pointer",fontSize:"13px",textAlign:"left",alignItems:"center",gap:"10px",textDecoration:"none"},children:[n.jsx("span",{children:""})," Timeline",n.jsx("span",{style:{marginLeft:"auto",padding:"2px 8px",backgroundColor:p.bgHover,borderRadius:"4px",fontSize:"10px",color:p.textMuted},children:"Admin"})]})]}),n.jsxs("div",{style:{padding:"16px",borderTop:`1px solid ${p.border}`,display:"flex",alignItems:"center",gap:"10px"},children:[n.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:p.bgHover,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:""}),n.jsxs("div",{style:{flex:1},children:[n.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:p.text},children:d.name}),n.jsx("div",{style:{fontSize:"11px",color:p.textMuted},children:d.email})]}),n.jsx(tt,{to:`/${i}/settings`,style:{color:p.textMuted,fontSize:"16px",textDecoration:"none"},children:""})]})]}),n.jsxs("div",{style:{flex:1,marginLeft:"220px"},children:[n.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${p.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:p.bgCard},children:[n.jsxs("div",{style:{fontSize:"11px",color:p.textMuted},children:["User: ",i==null?void 0:i.substring(0,8),"..."]}),n.jsx("button",{onClick:()=>l(!r),style:{padding:"8px 12px",backgroundColor:p.bgHover,border:`1px solid ${p.border}`,borderRadius:"8px",color:p.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:r?" Light":" Dark"})]}),n.jsx("div",{style:{padding:"24px"},children:n.jsxs(fo,{children:[n.jsx(je,{path:"dashboard",element:n.jsx(lo,{t:p})}),n.jsx(je,{path:"automations",element:n.jsx(Gs,{t:p})}),n.jsx(je,{path:"automations/new",element:n.jsx(uo,{t:p})}),n.jsx(je,{path:"automations/:automationId",element:n.jsx(uo,{t:p})}),n.jsx(je,{path:"templates",element:n.jsx(Ys,{t:p})}),n.jsx(je,{path:"mass-email",element:n.jsx($a,{t:p})}),n.jsx(je,{path:"accounts",element:n.jsx(ea,{t:p})}),n.jsx(je,{path:"accounts/:accountId",element:n.jsx(oa,{t:p})}),n.jsx(je,{path:"settings",element:n.jsx(aa,{t:p})}),n.jsx(je,{path:"timeline",element:n.jsx(Ga,{t:p})}),n.jsx(je,{path:"*",element:n.jsx(lo,{t:p})})]})})]})]})})})},Ga=({t:i})=>n.jsxs("div",{children:[n.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:i.text,marginBottom:"4px"},children:"Activity Timeline"}),n.jsx("p",{style:{color:i.textSecondary,fontSize:"14px"},children:"View all email activity across your organization"}),n.jsxs("div",{style:{marginTop:"24px",padding:"60px",textAlign:"center",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[n.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),n.jsx("p",{style:{color:i.textMuted},children:"Timeline view coming soon..."})]})]}),Va=()=>{const i=ft();return O.useEffect(()=>{i("/0056g000004jvyVAAQ/dashboard")},[i]),n.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"'Inter', sans-serif"},children:n.jsxs("div",{style:{textAlign:"center"},children:[n.jsx("div",{style:{fontSize:"32px",marginBottom:"16px"},children:""}),n.jsx("div",{children:"Loading..."})]})})},Ka=()=>n.jsxs(as,{client:fs,children:[n.jsx(us,{children:n.jsxs(fo,{children:[n.jsx(je,{path:"/",element:n.jsx(Va,{})}),n.jsx(je,{path:"/:userId/*",element:n.jsx(Ua,{})})]})}),n.jsx(hs,{initialIsOpen:!1})]});qi.createRoot(document.getElementById("root")).render(n.jsx(Fe.StrictMode,{children:n.jsx(Ka,{})}));
