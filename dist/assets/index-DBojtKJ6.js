import{Q as qt,j as t,u as re,a as Me,b as Z,c as Wt}from"./query-BbE8ety8.js";import{a as Et,r as C,u as he,b as Lt,c as ct,N as Pt,d as de,L as Ce,R as ke,B as Ot,e as bt,f as se}from"./vendor-BprrjqLD.js";import{c as Ft}from"./supabase-GtAdROLV.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function o(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(a){if(a.ep)return;a.ep=!0;const n=o(a);fetch(a.href,n)}})();var at={},ut=Et;at.createRoot=ut.createRoot,at.hydrateRoot=ut.hydrateRoot;var Nt=function(){return null};const Ht=new qt({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*30,retry:1,refetchOnWindowFocus:!0,refetchOnMount:!0},mutations:{retry:0}}}),Ut=void 0,Gt=void 0;throw new Error("Missing Supabase environment variables");const x=Ft(Ut,Gt),be={async get(e){const{data:r,error:o}=await x.from("user_settings").select("*").eq("user_id",e).single();if(o&&o.code!=="PGRST116")throw o;return r},async getWithUser(e){const{data:r,error:o}=await x.from("user_settings").select(`
        *,
        user:users(user_unique_id, email, first_name, last_name, role_name, profile_name)
      `).eq("user_id",e).single();if(o&&o.code!=="PGRST116")throw o;return r},async create(e,r={}){const{data:o,error:i}=await x.from("user_settings").insert({user_id:e,...r}).select().single();if(i)throw i;return o},async update(e,r){const{data:o,error:i}=await x.from("user_settings").update({...r,updated_at:new Date().toISOString()}).eq("user_id",e).select().single();if(i)throw i;return o},async updateSignature(e,r){const{signatureName:o,signatureTitle:i,signaturePhone:a,signatureEmail:n,signatureMessage:s}=r;return this.update(e,{signature_name:o,signature_title:i,signature_phone:a,signature_email:n,signature_message:s})},async updateAgencyInfo(e,r){const{agencyName:o,agencyAddress:i,agencyPhone:a,agencyWebsite:n}=r;return this.update(e,{agency_name:o,agency_address:i,agency_phone:a,agency_website:n})},async updateEmailSettings(e,r){const{fromName:o,fromEmail:i,replyToEmail:a,defaultSendTime:n,timezone:s,dailySendLimit:l}=r;return this.update(e,{from_name:o,from_email:i,reply_to_email:a,default_send_time:n,timezone:s,daily_send_limit:l})},async updatePreferences(e,r){const o=await this.get(e);return this.update(e,{preferences:{...o==null?void 0:o.preferences,...r}})},async getCurrentUser(e){const{data:r,error:o}=await x.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name").eq("user_unique_id",e).single();if(o&&o.code!=="PGRST116")throw o;return r},async getUserIdsByRole(e){const r=await this.getCurrentUser(e);if(!(r!=null&&r.role_name))return[e];const{data:o,error:i}=await x.from("users").select("user_unique_id").eq("role_name",r.role_name);if(i)throw i;return(o==null?void 0:o.map(a=>a.user_unique_id))||[e]},async getSignatureHtml(e){const r=await this.get(e);if(!r)return"";const{signature_name:o,signature_title:i,signature_phone:a,signature_email:n,signature_message:s}=r;let l='<table style="margin-top: 20px; font-family: Arial, sans-serif;">';return l+="<tr><td>",o&&(l+=`<strong style="font-size: 14px;">${o}</strong><br>`),i&&(l+=`<span style="color: #666;">${i}</span><br>`),a&&(l+=`<span>${a}</span><br>`),n&&(l+=`<a href="mailto:${n}" style="color: #0066cc;">${n}</a><br>`),s&&(l+=`<p style="margin-top: 10px; font-style: italic; color: #666;">${s}</p>`),l+="</td></tr></table>",l},async getUnsubscribeFooterHtml(e,r,o=null){const i=await this.get(e),a="https://your-app.com",n=`${a}/unsubscribe?type=automation&id=${r}&aid=${o}`,s=`${a}/unsubscribe?type=all&id=${r}`;let l=`
      <table style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; width: 100%; font-family: Arial, sans-serif;">
        <tr>
          <td style="text-align: center; font-size: 12px; color: #666;">
    `;return o&&(l+=`<a href="${n}" style="color: #666;">Unsubscribe from these emails</a> &nbsp;|&nbsp; `),l+=`<a href="${s}" style="color: #666;">Unsubscribe from all emails</a>`,(i!=null&&i.agency_name||i!=null&&i.agency_address)&&(l+="<br><br>",i.agency_name&&(l+=i.agency_name),i.agency_address&&(l+=` | ${i.agency_address}`)),l+=`
          </td>
        </tr>
      </table>
    `,l}},ue={async isAdmin(e){const{data:r,error:o}=await x.from("admin_users").select("id").eq("user_id",e).single();if(o&&o.code!=="PGRST116")throw o;return!!r},async getAdminUsers(){const{data:e,error:r}=await x.from("admin_users").select("*").order("created_at");if(r)throw r;return e},async addAdmin(e,r=null){const{data:o,error:i}=await x.from("admin_users").insert({user_id:e,name:r}).select().single();if(i)throw i;return o},async removeAdmin(e){const{error:r}=await x.from("admin_users").delete().eq("user_id",e);if(r)throw r;return!0},async getAllUsers(e=""){let r=x.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name, marketing_cloud_agency_admin").order("first_name");e&&(r=r.or(`first_name.ilike.%${e}%,last_name.ilike.%${e}%,email.ilike.%${e}%`)),r=r.limit(50);const{data:o,error:i}=await r;if(i)throw i;return o||[]},async getUniqueAgencies(){const{data:e,error:r}=await x.from("users").select("profile_name").not("profile_name","is",null).order("profile_name");if(r)throw r;return[...new Set(e==null?void 0:e.map(i=>i.profile_name))].filter(Boolean)},async getUsersByAgency(e){const{data:r,error:o}=await x.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name, marketing_cloud_agency_admin").eq("profile_name",e).order("first_name");if(o)throw o;return r||[]},async getUserIdsByAgency(e){const{data:r,error:o}=await x.from("users").select("user_unique_id").eq("profile_name",e);if(o)throw o;return(r==null?void 0:r.map(i=>i.user_unique_id))||[]},async getAgencyAgents(e,r=null,o=""){let i=x.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name").eq("profile_name",e).order("first_name");r&&(i=i.neq("user_unique_id",r)),o&&(i=i.or(`first_name.ilike.%${o}%,last_name.ilike.%${o}%,email.ilike.%${o}%`)),i=i.limit(50);const{data:a,error:n}=await i;if(n)throw n;return a||[]},async isAgencyAdmin(e){const{data:r,error:o}=await x.from("users").select("marketing_cloud_agency_admin").eq("user_unique_id",e).single();if(o&&o.code!=="PGRST116")throw o;return(r==null?void 0:r.marketing_cloud_agency_admin)===!0},async getUserProfileName(e){const{data:r,error:o}=await x.from("users").select("profile_name").eq("user_unique_id",e).single();if(o&&o.code!=="PGRST116")throw o;return(r==null?void 0:r.profile_name)||null},async getMasterAutomations(){const{data:e,error:r}=await x.from("master_automations").select("*").order("name");if(r)throw r;return e},async getMasterAutomation(e){const{data:r,error:o}=await x.from("master_automations").select("*").eq("default_key",e).single();if(o)throw o;return r},async createMasterAutomation(e){const{data:r,error:o}=await x.from("master_automations").insert(e).select().single();if(o)throw o;return r},async updateMasterAutomation(e,r){const{data:o}=await x.from("master_automations").select("id").eq("default_key",e).single();let i,a;if(o){const n=await x.from("master_automations").update({...r,updated_at:new Date().toISOString()}).eq("default_key",e).select().single();i=n.data,a=n.error}else{const n=await x.from("master_automations").insert({default_key:e,...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();i=n.data,a=n.error}if(a)throw a;return await x.rpc("sync_master_automation_to_users",{p_default_key:e}),i},async deleteMasterAutomation(e){const{error:r}=await x.from("master_automations").delete().eq("default_key",e);if(r)throw r;return!0},async syncMasterAutomation(e){const{data:r,error:o}=await x.rpc("sync_master_automation_to_users",{p_default_key:e});if(o)throw o;return r},async syncAllMasterAutomations(){const{data:e,error:r}=await x.rpc("sync_all_master_automations");if(r)throw r;return e},async getMasterTemplates(){const{data:e,error:r}=await x.from("master_templates").select("*").order("name");if(r)throw r;return e},async getMasterTemplate(e){const{data:r,error:o}=await x.from("master_templates").select("*").eq("default_key",e).single();if(o)throw o;return r},async createMasterTemplate(e){const{data:r,error:o}=await x.from("master_templates").insert(e).select().single();if(o)throw o;return r},async updateMasterTemplate(e,r){const{data:o,error:i}=await x.from("master_templates").update(r).eq("default_key",e).select().single();if(i)throw i;return o},async deleteMasterTemplate(e){const{error:r}=await x.from("master_templates").delete().eq("default_key",e);if(r)throw r;return!0},async syncMasterTemplate(e){const{data:r,error:o}=await x.rpc("sync_master_template_to_users",{p_default_key:e});if(o)throw o;return r},async syncAllMasterTemplates(){const{data:e,error:r}=await x.rpc("sync_all_master_templates");if(r)throw r;return e}},te={detectSalesforceContext(){const e=new URLSearchParams(window.location.search),r=e.get("sfSession"),o=e.get("sfOrg"),i=window.location.pathname.match(/^\/([a-zA-Z0-9]{15,18})/),a=i?i[1]:null,n=window.self!==window.top,s=document.referrer||"",l=s.includes(".salesforce.com")||s.includes(".force.com")||s.includes(".lightning.force.com")||s.includes(".my.salesforce.com");return r&&o&&a?{isFromSalesforce:!0,userId:a,sessionId:r,orgId:o,isInIframe:n,isSalesforceReferrer:l}:n&&l&&a?{isFromSalesforce:!0,userId:a,sessionId:null,orgId:null,isInIframe:n,isSalesforceReferrer:l}:{isFromSalesforce:!1,userId:a,sessionId:null,orgId:null,isInIframe:n,isSalesforceReferrer:l}},async validateSalesforceSession(e,r){if(!e||!r)return null;try{const o=`https://${r.substring(0,15)}.my.salesforce.com`,i=await fetch(`${o}/services/oauth2/userinfo`,{headers:{Authorization:`Bearer ${e}`}});if(!i.ok)return console.warn("Salesforce session validation failed:",i.status),null;const a=await i.json();return{userId:a.user_id,email:a.email,name:a.name,orgId:a.organization_id}}catch(o){return console.warn("Salesforce session validation error:",o),null}},async getUserById(e){const{data:r,error:o}=await x.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name, marketing_cloud_engagement, marketing_cloud_agency_admin").eq("user_unique_id",e);if(o)throw o;return!r||r.length===0||!r.some(n=>n.marketing_cloud_engagement===!0||n.marketing_cloud_agency_admin===!0)?null:r.find(n=>n.marketing_cloud_engagement===!0||n.marketing_cloud_agency_admin===!0)||r[0]},createLocalSession(e){const r={userId:e.user_unique_id,email:e.email,name:`${e.first_name||""} ${e.last_name||""}`.trim()||"User",expiresAt:Date.now()+864e5,source:"salesforce"};return localStorage.setItem("isg_sf_session",JSON.stringify(r)),r},getLocalSession(){const e=localStorage.getItem("isg_sf_session");if(!e)return null;try{const r=JSON.parse(e);return r.expiresAt>Date.now()?r:(localStorage.removeItem("isg_sf_session"),null)}catch{return localStorage.removeItem("isg_sf_session"),null}},clearLocalSession(){localStorage.removeItem("isg_sf_session")},async sendOTP(e){const{error:r}=await x.auth.signInWithOtp({email:e,options:{shouldCreateUser:!0}});if(r)throw r;return!0},async verifyOTP(e,r){const{data:o,error:i}=await x.auth.verifyOtp({email:e,token:r,type:"email"});if(i)throw i;return o},async getUserByEmail(e){const{data:r,error:o}=await x.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name, marketing_cloud_engagement, marketing_cloud_agency_admin").eq("email",e);if(o)throw o;return!r||r.length===0||!r.some(n=>n.marketing_cloud_engagement===!0||n.marketing_cloud_agency_admin===!0)?null:r.find(n=>n.marketing_cloud_engagement===!0||n.marketing_cloud_agency_admin===!0)||r[0]},async getSession(){const{data:{session:e},error:r}=await x.auth.getSession();if(r)throw r;return e},async signOut(){const{error:e}=await x.auth.signOut();if(e)throw e;return!0},onAuthStateChange(e){return x.auth.onAuthStateChange(e)},async isAdmin(e){const{data:r,error:o}=await x.from("admin_users").select("id").eq("user_id",e).single();if(o&&o.code!=="PGRST116")throw o;return!!r},saveLastEmail(e){localStorage.setItem("isg_last_email",e)},getLastEmail(){return localStorage.getItem("isg_last_email")},clearLastEmail(){localStorage.removeItem("isg_last_email")}},vt=C.createContext(),Je={MASTER_ADMIN:"master_admin",AGENCY_ADMIN:"agency_admin",MARKETING_USER:"marketing_user"},ve=()=>{const e=C.useContext(vt);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},Vt=({children:e})=>{const[r,o]=C.useState(!0),[i,a]=C.useState(!1),[n,s]=C.useState(null),[l,c]=C.useState(!1),[d,j]=C.useState(!1),[f,p]=C.useState(null),[v,g]=C.useState({active:!1,originalUserId:null,originalUserName:null,targetUserId:null,targetUserName:null,targetProfileName:null}),[m,y]=C.useState({active:!1,filterType:null,filterValue:null,filterLabel:null,ownerIds:null});C.useEffect(()=>{h();const{data:{subscription:u}}=te.onAuthStateChange(async($,V)=>{$==="SIGNED_OUT"&&(a(!1),s(null),c(!1),g({active:!1,originalUserId:null,originalUserName:null,targetUserId:null,targetUserName:null}))});return()=>u==null?void 0:u.unsubscribe()},[]);const h=async()=>{o(!0);try{const u=te.detectSalesforceContext();if(u.isFromSalesforce&&await w(u)){o(!1);return}const $=te.getLocalSession();if($){const V=await te.getUserById($.userId);if(V){await R(V),o(!1);return}te.clearLocalSession()}await W()}catch(u){console.error("Auth initialization error:",u),a(!1),s(null)}finally{o(!1)}},w=async u=>{try{const{userId:$,sessionId:V,orgId:Y,isSalesforceReferrer:X,isInIframe:D}=u;if(V&&Y){const A=await te.validateSalesforceSession(V,Y);if(A){const S=await te.getUserById(A.userId);if(S)return te.createLocalSession(S),await R(S),!0}}if(D&&X&&$){const A=await te.getUserById($);if(A)return te.createLocalSession(A),await R(A),!0}return!1}catch($){return console.error("Salesforce auth error:",$),!1}},R=async u=>{const $=`${u.first_name||""} ${u.last_name||""}`.trim()||"User";s({id:u.user_unique_id,name:$,email:u.email,profileName:u.profile_name||null}),a(!0);const V=await te.isAdmin(u.user_unique_id);c(V);const Y=u.marketing_cloud_agency_admin===!0;j(Y);let X;V?X=Je.MASTER_ADMIN:Y?X=Je.AGENCY_ADMIN:X=Je.MARKETING_USER,p(X);const D=localStorage.getItem("isg_impersonation");if(D&&(V||Y)){const S=JSON.parse(D);S.originalUserId===u.user_unique_id?g(S):localStorage.removeItem("isg_impersonation")}const A=localStorage.getItem("isg_scope_filter");if(A&&(V||Y)){const S=JSON.parse(A);S.originalUserId===u.user_unique_id?y(S):localStorage.removeItem("isg_scope_filter")}},W=async()=>{var u;try{const $=await te.getSession();if((u=$==null?void 0:$.user)!=null&&u.email){const V=await te.getUserByEmail($.user.email);V?await R(V):(await te.signOut(),a(!1),s(null))}}catch($){console.error("Session check error:",$),a(!1),s(null)}},b=async u=>{await te.sendOTP(u),te.saveLastEmail(u)},_=async(u,$)=>{await te.verifyOTP(u,$);const V=await te.getUserByEmail(u);if(!V)return await te.signOut(),{success:!1,noAccess:!0};const Y=`${V.first_name||""} ${V.last_name||""}`.trim()||"User";s({id:V.user_unique_id,name:Y,email:V.email}),a(!0);const X=await te.isAdmin(V.user_unique_id);return c(X),{success:!0,userId:V.user_unique_id,noAccess:!1}},B=async()=>{await te.signOut(),te.clearLocalSession(),localStorage.removeItem("isg_impersonation"),localStorage.removeItem("isg_scope_filter"),a(!1),s(null),c(!1),j(!1),p(null),g({active:!1,originalUserId:null,originalUserName:null,targetUserId:null,targetUserName:null,targetProfileName:null}),y({active:!1,filterType:null,filterValue:null,filterLabel:null,ownerIds:null})},K=C.useCallback((u,$,V=null)=>{if(!l&&!d||!n)return!1;const Y={active:!0,originalUserId:n.id,originalUserName:n.name,targetUserId:u,targetUserName:$,targetProfileName:V};return g(Y),localStorage.setItem("isg_impersonation",JSON.stringify(Y)),!0},[l,d,n]),T=C.useCallback(()=>{localStorage.removeItem("isg_impersonation"),g({active:!1,originalUserId:null,originalUserName:null,targetUserId:null,targetUserName:null,targetProfileName:null})},[]),P=C.useCallback(()=>v.active&&v.targetUserId?v.targetUserId:(n==null?void 0:n.id)||null,[v,n]),M=C.useCallback(()=>v.active&&v.targetUserName?v.targetUserName:(n==null?void 0:n.name)||null,[v,n]),U=C.useCallback(u=>{if(!n)return;const $={active:u.filterType!==null,filterType:u.filterType,filterValue:u.filterValue,filterLabel:u.filterLabel,ownerIds:u.ownerIds,originalUserId:n.id};y($),$.active?localStorage.setItem("isg_scope_filter",JSON.stringify($)):localStorage.removeItem("isg_scope_filter")},[n]),L=C.useCallback(()=>{localStorage.removeItem("isg_scope_filter"),y({active:!1,filterType:null,filterValue:null,filterLabel:null,ownerIds:null})},[]),N=C.useCallback(()=>v.active&&v.targetUserId?v.targetUserId:m.active&&m.ownerIds&&m.ownerIds.length>0?m.ownerIds.length===1?m.ownerIds[0]:m.ownerIds:(n==null?void 0:n.id)||null,[v,m,n]),H=C.useCallback(()=>m.active||v.active,[m,v]),E={isLoading:r,isAuthenticated:i,user:n,isAdmin:l,isAgencyAdmin:d,userRole:f,impersonating:v,scopeFilter:m,sendOTP:b,verifyOTP:_,logout:B,impersonate:K,exitImpersonation:T,getEffectiveUserId:P,getEffectiveUserName:M,updateScopeFilter:U,clearScopeFilter:L,getEffectiveOwnerIds:N,isViewingFiltered:H,checkSession:W};return t.jsx(vt.Provider,{value:E,children:e})},Kt=()=>{const e=he(),[r]=Lt(),{isAuthenticated:o,user:i,sendOTP:a,verifyOTP:n}=ve(),[s,l]=C.useState("email"),[c,d]=C.useState(""),[j,f]=C.useState(""),[p,v]=C.useState(""),[g,m]=C.useState(!1),[y,h]=C.useState(!1);C.useEffect(()=>{const B=r.get("email"),K=te.getLastEmail();B?d(B):K&&d(K)},[r]),C.useEffect(()=>{o&&(i!=null&&i.id)&&e(`/${i.id}/dashboard`,{replace:!0})},[o,i,e]);const w=async B=>{var K;B.preventDefault(),v(""),m(!0);try{await a(c),h(!0),l("code")}catch(T){console.error("Send OTP error:",T),(K=T.message)!=null&&K.includes("rate limit")?v("Too many attempts. Please wait a moment and try again."):v("Failed to send verification code. Please try again.")}finally{m(!1)}},R=async B=>{var K,T;B.preventDefault(),v(""),m(!0);try{const P=await n(c,j);P.noAccess?l("no-access"):P.success&&e(`/${P.userId}/dashboard`,{replace:!0})}catch(P){console.error("Verify OTP error:",P),(K=P.message)!=null&&K.includes("Invalid")||(T=P.message)!=null&&T.includes("expired")?v("Invalid or expired code. Please try again."):v("Verification failed. Please try again.")}finally{m(!1)}},W=async()=>{v(""),m(!0),f("");try{await a(c),h(!0),v("")}catch(B){console.error("Resend OTP error:",B),v("Failed to resend code. Please try again.")}finally{m(!1)}},b=()=>{l("email"),d(""),f(""),v(""),h(!1),te.clearLastEmail()},_={container:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",padding:"20px"},card:{backgroundColor:"#ffffff",borderRadius:"16px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",padding:"48px",width:"100%",maxWidth:"420px"},logo:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",marginBottom:"32px"},logoIcon:{width:"48px",height:"48px",backgroundColor:"#3b82f6",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"24px"},logoText:{fontWeight:"700",fontSize:"20px",color:"#1e293b"},title:{fontSize:"24px",fontWeight:"700",color:"#1e293b",textAlign:"center",marginBottom:"8px"},subtitle:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},form:{display:"flex",flexDirection:"column",gap:"20px"},inputGroup:{display:"flex",flexDirection:"column",gap:"6px"},label:{fontSize:"14px",fontWeight:"500",color:"#374151"},input:{padding:"12px 16px",fontSize:"16px",border:"1px solid #e2e8f0",borderRadius:"8px",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},button:{padding:"14px 24px",fontSize:"16px",fontWeight:"600",color:"#ffffff",backgroundColor:"#3b82f6",border:"none",borderRadius:"8px",cursor:"pointer",transition:"background-color 0.2s"},buttonDisabled:{backgroundColor:"#94a3b8",cursor:"not-allowed"},error:{padding:"12px 16px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",color:"#dc2626",fontSize:"14px"},link:{color:"#3b82f6",textDecoration:"none",cursor:"pointer",fontSize:"14px"},codeInfo:{textAlign:"center",fontSize:"14px",color:"#64748b"},noAccessIcon:{fontSize:"64px",textAlign:"center",marginBottom:"24px"},noAccessTitle:{fontSize:"20px",fontWeight:"600",color:"#1e293b",textAlign:"center",marginBottom:"12px"},noAccessText:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"24px",lineHeight:"1.6"},secondaryButton:{padding:"12px 24px",fontSize:"14px",fontWeight:"500",color:"#3b82f6",backgroundColor:"transparent",border:"1px solid #3b82f6",borderRadius:"8px",cursor:"pointer",transition:"background-color 0.2s"}};return s==="no-access"?t.jsx("div",{style:_.container,children:t.jsxs("div",{style:_.card,children:[t.jsxs("div",{style:_.logo,children:[t.jsx("div",{style:_.logoIcon,children:"ðŸ“§"}),t.jsx("div",{style:_.logoText,children:"Email Automation"})]}),t.jsx("div",{style:_.noAccessIcon,children:"ðŸ”’"}),t.jsx("div",{style:_.noAccessTitle,children:"Access Denied"}),t.jsxs("div",{style:_.noAccessText,children:["You don't have access to this site.",t.jsx("br",{}),"Contact your administrator for access."]}),t.jsx("button",{onClick:b,style:_.secondaryButton,children:"Try a Different Email"})]})}):s==="code"?t.jsx("div",{style:_.container,children:t.jsxs("div",{style:_.card,children:[t.jsxs("div",{style:_.logo,children:[t.jsx("div",{style:_.logoIcon,children:"ðŸ“§"}),t.jsx("div",{style:_.logoText,children:"Email Automation"})]}),t.jsx("h1",{style:_.title,children:"Check Your Email"}),t.jsxs("p",{style:_.subtitle,children:["We sent a verification code to",t.jsx("br",{}),t.jsx("strong",{children:c})]}),t.jsxs("form",{onSubmit:R,style:_.form,children:[p&&t.jsx("div",{style:_.error,children:p}),t.jsxs("div",{style:_.inputGroup,children:[t.jsx("label",{style:_.label,children:"Verification Code"}),t.jsx("input",{type:"text",value:j,onChange:B=>f(B.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"Enter 6-digit code",style:_.input,autoFocus:!0,maxLength:6,inputMode:"numeric",autoComplete:"one-time-code"})]}),t.jsx("button",{type:"submit",disabled:g||j.length!==6,style:{..._.button,...g||j.length!==6?_.buttonDisabled:{}},children:g?"Verifying...":"Verify Code"}),t.jsxs("div",{style:_.codeInfo,children:["Didn't receive the code?"," ",t.jsx("span",{onClick:g?void 0:W,style:{..._.link,...g?{opacity:.5,cursor:"not-allowed"}:{}},children:"Resend"})]}),t.jsx("div",{style:{textAlign:"center"},children:t.jsx("span",{onClick:b,style:_.link,children:"Use a different email"})})]})]})}):t.jsx("div",{style:_.container,children:t.jsxs("div",{style:_.card,children:[t.jsxs("div",{style:_.logo,children:[t.jsx("div",{style:_.logoIcon,children:"ðŸ“§"}),t.jsx("div",{style:_.logoText,children:"Email Automation"})]}),t.jsx("h1",{style:_.title,children:"Welcome Back"}),t.jsx("p",{style:_.subtitle,children:"Enter your email to receive a verification code"}),t.jsxs("form",{onSubmit:w,style:_.form,children:[p&&t.jsx("div",{style:_.error,children:p}),t.jsxs("div",{style:_.inputGroup,children:[t.jsx("label",{style:_.label,children:"Email Address"}),t.jsx("input",{type:"email",value:c,onChange:B=>d(B.target.value),placeholder:"you@example.com",style:_.input,autoFocus:!0,autoComplete:"email",required:!0})]}),t.jsx("button",{type:"submit",disabled:g||!c,style:{..._.button,...g||!c?_.buttonDisabled:{}},children:g?"Sending...":"Send Verification Code"})]})]})})},Qt=({children:e})=>{const{isLoading:r,isAuthenticated:o}=ve(),i=ct();if(r)return t.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif"},children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{width:"48px",height:"48px",border:"3px solid #e2e8f0",borderTopColor:"#3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 16px"}}),t.jsx("div",{style:{color:"#64748b",fontSize:"14px"},children:"Loading..."}),t.jsx("style",{children:`
            @keyframes spin {
              to { transform: rotate(360deg); }
            }
          `})]})});if(!o){const a=te.detectSalesforceContext();return a.isInIframe&&a.isSalesforceReferrer?t.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif"},children:t.jsxs("div",{style:{textAlign:"center",padding:"40px",maxWidth:"400px"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ”’"}),t.jsx("h2",{style:{fontSize:"20px",fontWeight:"600",color:"#1e293b",marginBottom:"8px"},children:"Access Denied"}),t.jsx("p",{style:{color:"#64748b",fontSize:"14px",lineHeight:"1.5"},children:"Your user account doesn't have access to this application. Please contact your administrator."})]})}):t.jsx(Pt,{to:"/login",state:{from:i},replace:!0})}return e},Yt=()=>{const e=he(),{impersonating:r,exitImpersonation:o,user:i}=ve();if(!r.active)return null;const a=()=>{o(),i!=null&&i.id&&e(`/${i.id}/dashboard`)};return t.jsxs("div",{style:{backgroundColor:"#f59e0b",color:"#ffffff",padding:"10px 24px",display:"flex",alignItems:"center",justifyContent:"center",gap:"16px",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",fontSize:"14px",fontWeight:"500",position:"fixed",top:0,left:0,right:0,zIndex:9999,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:[t.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ‘ï¸"}),"Viewing as: ",t.jsx("strong",{children:r.targetUserName})]}),t.jsx("button",{onClick:a,style:{backgroundColor:"rgba(255, 255, 255, 0.2)",border:"1px solid rgba(255, 255, 255, 0.4)",color:"#ffffff",padding:"6px 16px",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"600",transition:"background-color 0.2s"},onMouseEnter:n=>n.target.style.backgroundColor="rgba(255, 255, 255, 0.3)",onMouseLeave:n=>n.target.style.backgroundColor="rgba(255, 255, 255, 0.2)",children:"Exit Impersonation"})]})},Jt=({t:e})=>{const{userRole:r,user:o,scopeFilter:i,updateScopeFilter:a,clearScopeFilter:n,isAdmin:s,isAgencyAdmin:l}=ve(),[c,d]=C.useState(!1),[j,f]=C.useState(""),[p,v]=C.useState([]),[g,m]=C.useState(!1),y=C.useRef(null),h=C.useRef(null);if(r===Je.MARKETING_USER||!s&&!l)return null;C.useEffect(()=>{const T=P=>{y.current&&!y.current.contains(P.target)&&d(!1)};return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[]);const w=async(T="")=>{m(!0);try{if(s){const P=await ue.getUniqueAgencies(),M=T?P.filter(U=>U.toLowerCase().includes(T.toLowerCase())):P;v(M.map(U=>({type:"agency",value:U,label:U})))}else if(l&&(o!=null&&o.profileName)){const P=await ue.getAgencyAgents(o.profileName,o.id,T);v(P.map(M=>({type:"agent",value:M.user_unique_id,label:`${M.first_name||""} ${M.last_name||""}`.trim()||M.email,email:M.email})))}}catch(P){console.error("Error fetching filter items:",P)}finally{m(!1)}},R=async()=>{d(!0),f(""),await w()},W=T=>{f(T),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{w(T)},300)},b=async()=>{if(s)n();else if(l&&(o!=null&&o.profileName)){const T=await ue.getUserIdsByAgency(o.profileName);a({filterType:"all_agents",filterValue:o.profileName,filterLabel:"All Agents",ownerIds:T})}d(!1),f("")},_=async T=>{if(T.type==="agency"){const P=await ue.getUserIdsByAgency(T.value);a({filterType:"agency",filterValue:T.value,filterLabel:T.label,ownerIds:P})}else T.type==="agent"&&a({filterType:"agent",filterValue:T.value,filterLabel:T.label,ownerIds:[T.value]});d(!1),f("")},B=()=>i.active?i.filterLabel||"Filtered":s?"All Agencies":"My Data",K=()=>s?"All Agencies":"All Agents";return t.jsxs("div",{ref:y,style:{position:"relative"},children:[t.jsxs("button",{onClick:R,style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",backgroundColor:i.active?e.primary+"15":e.bgHover,border:`1px solid ${i.active?e.primary:e.border}`,borderRadius:"8px",color:i.active?e.primary:e.text,cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:[t.jsx("span",{children:s?"ðŸ¢":"ðŸ‘¥"}),t.jsx("span",{children:B()}),t.jsx("span",{style:{fontSize:"10px",opacity:.7},children:"â–¼"})]}),c&&t.jsxs("div",{style:{position:"absolute",top:"100%",left:0,marginTop:"4px",width:"280px",backgroundColor:e.bgCard,border:`1px solid ${e.border}`,borderRadius:"12px",boxShadow:"0 10px 40px rgba(0,0,0,0.15)",zIndex:1e3,overflow:"hidden"},children:[t.jsx("div",{style:{padding:"12px",borderBottom:`1px solid ${e.border}`},children:t.jsx("input",{type:"text",placeholder:s?"Search agencies...":"Search agents...",value:j,onChange:T=>W(T.target.value),autoFocus:!0,style:{width:"100%",padding:"10px 12px",fontSize:"13px",border:`1px solid ${e.border}`,borderRadius:"8px",backgroundColor:e.bgInput,color:e.text,outline:"none"}})}),t.jsxs("div",{style:{maxHeight:"300px",overflowY:"auto"},children:[t.jsxs("button",{onClick:b,style:{width:"100%",padding:"12px 16px",backgroundColor:i.active?"transparent":e.bgHover,border:"none",borderBottom:`1px solid ${e.borderLight}`,color:e.text,cursor:"pointer",textAlign:"left",fontSize:"13px",fontWeight:i.active?"400":"600",display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:s?"ðŸŒ":"ðŸ‘¥"}),t.jsx("span",{children:K()}),!i.active&&t.jsx("span",{style:{marginLeft:"auto",color:e.primary},children:"âœ“"})]}),g&&t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted},children:"Loading..."}),!g&&p.length===0&&t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted},children:j?"No results found":"No items available"}),!g&&p.map((T,P)=>t.jsxs("button",{onClick:()=>_(T),style:{width:"100%",padding:"12px 16px",backgroundColor:i.filterValue===T.value?e.bgHover:"transparent",border:"none",borderBottom:P<p.length-1?`1px solid ${e.borderLight}`:"none",color:e.text,cursor:"pointer",textAlign:"left",fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:T.type==="agency"?"ðŸ¢":"ðŸ‘¤"}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:i.filterValue===T.value?"600":"400"},children:T.label}),T.email&&t.jsx("div",{style:{fontSize:"11px",color:e.textMuted,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:T.email})]}),i.filterValue===T.value&&t.jsx("span",{style:{color:e.primary},children:"âœ“"})]},T.value))]}),i.active&&t.jsx("div",{style:{padding:"12px",borderTop:`1px solid ${e.border}`},children:t.jsx("button",{onClick:()=>{n(),d(!1)},style:{width:"100%",padding:"10px",backgroundColor:"transparent",border:`1px solid ${e.danger}`,borderRadius:"8px",color:e.danger,cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Clear Filter"})})]})]})};function G(e,r,o="owner_id"){return r?Array.isArray(r)?r.length===0?e:r.length===1?e.eq(o,r[0]):e.in(o,r):e.eq(o,r):e}function fe(e){return e?Array.isArray(e)?e.length>0?e[0]:null:e:null}function Zt(e){return e?Array.isArray(e)?e:[e]:[]}const we={async getAll(e,r={}){const{category:o,isDefault:i,search:a}=r;let n=x.from("email_templates").select("*").order("is_default",{ascending:!1}).order("name");n=G(n,e),o&&(n=n.eq("category",o)),typeof i=="boolean"&&(n=n.eq("is_default",i)),a&&(n=n.or(`name.ilike.%${a}%,subject.ilike.%${a}%`));const{data:s,error:l}=await n;if(l)throw l;return s},async getById(e,r){let o=x.from("email_templates").select("*").eq("id",r);o=G(o,e);const{data:i,error:a}=await o.single();if(a)throw a;return i},async getByDefaultKey(e,r){let o=x.from("email_templates").select("*").eq("default_key",r);o=G(o,e);const{data:i,error:a}=await o.single();if(a)throw a;return i},async create(e,r){const o=fe(e),{data:i,error:a}=await x.from("email_templates").insert({owner_id:o,is_default:!1,...r}).select().single();if(a)throw a;return i},async update(e,r,o){let i=x.from("email_templates").update({...o,updated_at:new Date().toISOString()}).eq("id",r);i=G(i,e);const{data:a,error:n}=await i.select().single();if(n)throw n;return a},async delete(e,r){let o=x.from("email_templates").delete().eq("id",r).eq("is_default",!1);o=G(o,e);const{error:i}=await o;if(i)throw i;return!0},async duplicate(e,r){const o=await this.getById(e,r),i=fe(e),{data:a,error:n}=await x.from("email_templates").insert({owner_id:i,is_default:!1,default_key:null,name:`${o.name} (Copy)`,subject:o.subject,body_html:o.body_html,body_text:o.body_text,category:o.category,merge_fields:o.merge_fields}).select().single();if(n)throw n;return a},async getByCategory(e,r){let o=x.from("email_templates").select("*").eq("category",r).order("is_default",{ascending:!1}).order("name");o=G(o,e);const{data:i,error:a}=await o;if(a)throw a;return i},async getCategories(e){let r=x.from("email_templates").select("category").not("category","is",null);r=G(r,e);const{data:o,error:i}=await r;if(i)throw i;return[...new Set(o.map(a=>a.category))]},async resetToDefault(e,r){return this.getById(e,r)}};function ae(){const{userId:e}=de(),{impersonating:r,scopeFilter:o,getEffectiveOwnerIds:i}=ve(),a=i(),n=Array.isArray(a),s=n?a.length>0?a[0]:null:a,l=o.active?`${o.filterType}:${o.filterValue}`:r.active?`impersonate:${r.targetUserId}`:`user:${e}`;return{ownerId:s,ownerIds:n?a:a?[a]:[],isMultiOwner:n,filterKey:l,urlUserId:e}}function pt(e={}){const{ownerIds:r,filterKey:o}=ae();return re({queryKey:["templates",o,e],queryFn:()=>we.getAll(r,e),enabled:r.length>0})}function Xt(){const{ownerIds:e,filterKey:r}=ae();return re({queryKey:["templates",r,"categories"],queryFn:()=>we.getCategories(e),enabled:e.length>0})}function _t(){const{ownerIds:e,filterKey:r}=ae(),o=Me(),i=()=>{o.invalidateQueries({queryKey:["templates"]})},a=Z({mutationFn:c=>we.create(e,c),onSuccess:i}),n=Z({mutationFn:({templateId:c,updates:d})=>we.update(e,c,d),onSuccess:c=>{i(),o.setQueryData(["template",r,c.id],c)}}),s=Z({mutationFn:c=>we.delete(e,c),onSuccess:i}),l=Z({mutationFn:c=>we.duplicate(e,c),onSuccess:i});return{createTemplate:a,updateTemplate:n,deleteTemplate:s,duplicateTemplate:l}}const eo=(e,r,o,i)=>{const n=(o-e)*Math.PI/180,s=(i-r)*Math.PI/180,l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 3959*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},Te={},to=async e=>Te[e]?Te[e]:(console.warn("Google Maps API key not configured"),Te[e]=null,null),oo=async(e,r=10)=>{const o={},i=[...new Set(e.filter(Boolean))],a=[];for(const n of i)Te[n]?o[n]=Te[n]:a.push(n);if(a.length===0)return o;for(let n=0;n<a.length;n+=r){const s=a.slice(n,n+r),l=await Promise.all(s.map(c=>to(c)));s.forEach((c,d)=>{l[d]&&(o[c]=l[d])})}return o},ye={async getAll(e,r={}){const{status:o,limit:i=50,offset:a=0}=r;let n=x.from("mass_email_batches").select(`
        *,
        template:email_templates(id, name, subject)
      `).order("created_at",{ascending:!1}).range(a,a+i-1);n=G(n,e),o&&(n=n.eq("status",o));const{data:s,error:l}=await n;if(l)throw l;return s},async getById(e,r){let o=x.from("mass_email_batches").select(`
        *,
        template:email_templates(*)
      `).eq("id",r);o=G(o,e);const{data:i,error:a}=await o.single();if(a)throw a;return i},async create(e,r){const o=fe(e),{data:i,error:a}=await x.from("mass_email_batches").insert({owner_id:o,status:"Draft",...r}).select().single();if(a)throw a;return i},async update(e,r,o){let i=x.from("mass_email_batches").update({...o,updated_at:new Date().toISOString()}).eq("id",r);i=G(i,e);const{data:a,error:n}=await i.select().single();if(n)throw n;return a},async delete(e,r){let o=x.from("mass_email_batches").delete().eq("id",r).eq("status","Draft");o=G(o,e);const{error:i}=await o;if(i)throw i;return!0},async getRecipients(e,r,o={}){const{limit:i=100,offset:a=0}=o,{rules:n=[],groups:s=[],notOptedOut:l=!0,search:c=""}=r||{};let d=s.length>0?s:n.length>0?[{rules:n}]:[];const j=Array.isArray(e)?e:[e];let f=x.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name, person_has_opted_out_of_email, billing_city, billing_state, billing_postal_code, billing_street, created_at").in("owner_id",j);l&&(f=f.or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false")),c&&(f=f.or(`name.ilike.%${c}%,person_email.ilike.%${c}%,email.ilike.%${c}%`)),d.length===0?f=f.order("name").range(a,a+i-1):f=f.order("name").limit(1e4);const{data:p,error:v}=await f;if(v)throw v;let g=p.filter(L=>{const N=L.person_email||L.email;return N&&N.includes("@")});if(d.length===0)return g;const m=d.some(L=>(L.rules||[]).some(H=>["policy_type","active_policy_type","policy_status","policy_count","policy_expiration","policy_effective","policy_class"].includes(H.field)&&H.value));let y={};if(m&&g.length>0){const L=g.map(E=>E.account_unique_id),{data:N,error:H}=await x.from("policies").select("account_id, policy_lob, expiration_date, effective_date, policy_status").in("account_id",L);if(H)throw H;N.forEach(E=>{y[E.account_id]||(y[E.account_id]=[]),y[E.account_id].push(E)})}let h={};if(g.length>0){const L=g.map(E=>E.account_unique_id),{data:N,error:H}=await x.from("email_logs").select("account_id, sent_at").in("account_id",L).eq("status","sent").order("sent_at",{ascending:!1});if(H)throw H;N==null||N.forEach(E=>{!h[E.account_id]&&E.sent_at&&(h[E.account_id]=E.sent_at)})}const w=d.some(L=>(L.rules||[]).some(H=>H.field==="location"&&H.value));let R={};if(w&&g.length>0){const L={};g.forEach(H=>{const E=(H.billing_postal_code||"").trim(),u=(H.billing_city||"").trim(),$=(H.billing_state||"").trim();let V="";E&&$?V=`${E}, ${$}, USA`:u&&$?V=`${u}, ${$}, USA`:E&&(V=`${E}, USA`),V&&(L[H.account_unique_id]=V)});const N=[...new Set(Object.values(L))];R=await oo(N),g.forEach(H=>{H._locationKey=L[H.account_unique_id]})}const W=(L,N,H)=>{const{field:E,operator:u,value:$,value2:V,radius:Y}=N;if(!E||!u||!["is_empty","is_not_empty"].includes(u)&&!$)return!0;switch(E){case"account_status":{const D=(L.account_status||"").toLowerCase();return u==="is"?D===$.toLowerCase():u==="is_not"?D!==$.toLowerCase():u==="is_any"?$.split(",").map(S=>S.toLowerCase()).includes(D):u==="is_not_any"?!$.split(",").map(S=>S.toLowerCase()).includes(D):!0}case"policy_type":{const D=["is_any","is_not_any"].includes(u)?$.split(","):[$],A=H.some(S=>D.some(I=>{var k;return(k=S.policy_lob)==null?void 0:k.toLowerCase().includes(I.toLowerCase())}));return u==="is"||u==="is_any"?A:u==="is_not"||u==="is_not_any"?!A:!0}case"active_policy_type":{const D=["is_any","is_not_any"].includes(u)?$.split(","):[$],S=H.filter(I=>{var q;return((q=I.policy_status)==null?void 0:q.toLowerCase().trim())==="active"}).some(I=>D.some(k=>{var q;return(q=I.policy_lob)==null?void 0:q.toLowerCase().includes(k.toLowerCase())}));return u==="is"||u==="is_any"?S:u==="is_not"||u==="is_not_any"?!S:!0}case"policy_status":{const D=["is_any","is_not_any"].includes(u)?$.split(","):[$],A=H.some(S=>D.some(I=>{var k;return((k=S.policy_status)==null?void 0:k.toLowerCase())===I.toLowerCase()}));return u==="is"||u==="is_any"?A:u==="is_not"||u==="is_not_any"?!A:!0}case"policy_class":{const D=["is_any","is_not_any"].includes(u)?$.split(","):[$],A=H.some(S=>D.some(I=>{var k;return((k=S.policy_class)==null?void 0:k.toLowerCase())===I.toLowerCase()}));return u==="is"||u==="is_any"?A:u==="is_not"||u==="is_not_any"?!A:!0}case"policy_count":{const D=H.length,A=parseInt($,10),S=V?parseInt(V,10):A;return u==="equals"?D===A:u==="greater_than"?D>A:u==="less_than"?D<A:u==="at_least"?D>=A:u==="at_most"?D<=A:u==="between"?D>=A&&D<=S:!0}case"policy_expiration":{const D=H.filter(S=>{var I;return((I=S.policy_status)==null?void 0:I.toLowerCase().trim())==="active"}),A=new Date().toISOString().split("T")[0];if(u==="in_next_days"){const S=parseInt($,10),I=new Date;I.setDate(I.getDate()+S);const k=I.toISOString().split("T")[0];return D.some(q=>q.expiration_date&&q.expiration_date>=A&&q.expiration_date<=k)}if(u==="in_last_days"){const S=parseInt($,10),I=new Date;I.setDate(I.getDate()-S);const k=I.toISOString().split("T")[0];return D.some(q=>q.expiration_date&&q.expiration_date>=k&&q.expiration_date<=A)}if(u==="more_than_days_future"){const S=parseInt($,10),I=new Date;I.setDate(I.getDate()+S);const k=I.toISOString().split("T")[0];return D.some(q=>q.expiration_date&&q.expiration_date>k)}if(u==="less_than_days_future"){const S=parseInt($,10),I=new Date;I.setDate(I.getDate()+S);const k=I.toISOString().split("T")[0];return D.some(q=>q.expiration_date&&q.expiration_date>=A&&q.expiration_date<k)}if(u==="more_than_days_ago"){const S=parseInt($,10),I=new Date;I.setDate(I.getDate()-S);const k=I.toISOString().split("T")[0];return D.some(q=>q.expiration_date&&q.expiration_date<k)}if(u==="less_than_days_ago"){const S=parseInt($,10),I=new Date;I.setDate(I.getDate()-S);const k=I.toISOString().split("T")[0];return D.some(q=>q.expiration_date&&q.expiration_date>=k&&q.expiration_date<=A)}return u==="before"?D.some(S=>S.expiration_date&&S.expiration_date<$):u==="after"?D.some(S=>S.expiration_date&&S.expiration_date>$):u==="between"?D.some(S=>S.expiration_date&&S.expiration_date>=$&&S.expiration_date<=(V||$)):!0}case"policy_effective":{const D=H.filter(S=>{var I;return((I=S.policy_status)==null?void 0:I.toLowerCase().trim())==="active"}),A=new Date().toISOString().split("T")[0];if(u==="in_next_days"){const S=parseInt($,10),I=new Date;I.setDate(I.getDate()+S);const k=I.toISOString().split("T")[0];return D.some(q=>q.effective_date&&q.effective_date>=A&&q.effective_date<=k)}if(u==="in_last_days"){const S=parseInt($,10),I=new Date;I.setDate(I.getDate()-S);const k=I.toISOString().split("T")[0];return D.some(q=>q.effective_date&&q.effective_date>=k&&q.effective_date<=A)}if(u==="more_than_days_future"){const S=parseInt($,10),I=new Date;I.setDate(I.getDate()+S);const k=I.toISOString().split("T")[0];return D.some(q=>q.effective_date&&q.effective_date>k)}if(u==="less_than_days_future"){const S=parseInt($,10),I=new Date;I.setDate(I.getDate()+S);const k=I.toISOString().split("T")[0];return D.some(q=>q.effective_date&&q.effective_date>=A&&q.effective_date<k)}if(u==="more_than_days_ago"){const S=parseInt($,10),I=new Date;I.setDate(I.getDate()-S);const k=I.toISOString().split("T")[0];return D.some(q=>q.effective_date&&q.effective_date<k)}if(u==="less_than_days_ago"){const S=parseInt($,10),I=new Date;I.setDate(I.getDate()-S);const k=I.toISOString().split("T")[0];return D.some(q=>q.effective_date&&q.effective_date>=k&&q.effective_date<=A)}return u==="before"?D.some(S=>S.effective_date&&S.effective_date<$):u==="after"?D.some(S=>S.effective_date&&S.effective_date>$):u==="between"?D.some(S=>S.effective_date&&S.effective_date>=$&&S.effective_date<=(V||$)):!0}case"state":{const D=(L.billing_state||"").toUpperCase();return u==="is"?D===$.toUpperCase():u==="is_not"?D!==$.toUpperCase():u==="is_any"?$.split(",").map(S=>S.toUpperCase()).includes(D):u==="is_not_any"?!$.split(",").map(S=>S.toUpperCase()).includes(D):!0}case"city":{const D=(L.billing_city||"").toLowerCase(),A=($||"").toLowerCase();return u==="contains"?D.includes(A):u==="not_contains"?!D.includes(A):u==="equals"?D===A:u==="not_equals"?D!==A:u==="starts_with"?D.startsWith(A):u==="ends_with"?D.endsWith(A):u==="is_empty"?D.trim()==="":u==="is_not_empty"?D.trim()!=="":!0}case"zip_code":{const D=(L.billing_postal_code||"").toLowerCase().trim(),A=($||"").toLowerCase().trim();return u==="contains"?D.includes(A):u==="not_contains"?!D.includes(A):u==="equals"?D===A:u==="not_equals"?D!==A:u==="starts_with"?D.startsWith(A):u==="ends_with"?D.endsWith(A):u==="is_empty"?D==="":u==="is_not_empty"?D!=="":!0}case"email_domain":{const D=(L.person_email||L.email||"").toLowerCase(),A=D.includes("@")?D.split("@")[1]:"",S=($||"").toLowerCase().trim();return u==="contains"?A.includes(S):u==="not_contains"?!A.includes(S):u==="equals"?A===S:u==="not_equals"?A!==S:u==="starts_with"?A.startsWith(S):u==="ends_with"?A.endsWith(S):u==="is_empty"?A==="":u==="is_not_empty"?A!=="":!0}case"location":{if(u!=="within_radius"||!$)return!0;const[D,A]=$.split(",").map(parseFloat),S=parseInt(Y||"25",10),I=L._locationKey;if(!I)return!1;const k=R[I];return k?eo(D,A,k.lat,k.lng)<=S:!1}case"last_email_sent":{const D=h[L.account_unique_id],A=new Date().toISOString().split("T")[0];if(!D)return u==="before"?!0:u==="in_last_days"||u==="less_than_days_ago"?!1:u==="more_than_days_ago"?!0:!(u==="in_next_days"||u==="more_than_days_future"||u==="less_than_days_future"||u==="after"||u==="between");const S=D.split("T")[0];if(u==="in_last_days"){const I=parseInt($,10),k=new Date;k.setDate(k.getDate()-I);const q=k.toISOString().split("T")[0];return S>=q&&S<=A}if(u==="more_than_days_ago"){const I=parseInt($,10),k=new Date;k.setDate(k.getDate()-I);const q=k.toISOString().split("T")[0];return S<q}if(u==="less_than_days_ago"){const I=parseInt($,10),k=new Date;k.setDate(k.getDate()-I);const q=k.toISOString().split("T")[0];return S>=q&&S<=A}return u==="before"?S<$:u==="after"?S>$:u==="between"?S>=$&&S<=(V||$):!0}case"account_created":{const D=L.created_at;if(!D)return!1;const A=D.split("T")[0],S=new Date().toISOString().split("T")[0];if(u==="in_next_days"||u==="more_than_days_future"||u==="less_than_days_future")return!1;if(u==="in_last_days"){const I=parseInt($,10),k=new Date;k.setDate(k.getDate()-I);const q=k.toISOString().split("T")[0];return A>=q&&A<=S}if(u==="more_than_days_ago"){const I=parseInt($,10),k=new Date;k.setDate(k.getDate()-I);const q=k.toISOString().split("T")[0];return A<q}if(u==="less_than_days_ago"){const I=parseInt($,10),k=new Date;k.setDate(k.getDate()-I);const q=k.toISOString().split("T")[0];return A>=q&&A<=S}return u==="before"?A<$:u==="after"?A>$:u==="between"?A>=$&&A<=(V||$):!0}default:return!0}},b=(L,N)=>{var Y,X,D;const{field:H,operator:E,value:u,value2:$}=N,V=new Date().toISOString().split("T")[0];switch(H){case"active_policy_type":{if(((Y=L.policy_status)==null?void 0:Y.toLowerCase().trim())!=="active")return!1;const I=(["is_any","is_not_any"].includes(E)?u.split(","):[u]).some(k=>{var q;return(q=L.policy_lob)==null?void 0:q.toLowerCase().includes(k.toLowerCase())});return E==="is"||E==="is_any"?I:E==="is_not"||E==="is_not_any"?!I:!0}case"policy_type":{const S=(["is_any","is_not_any"].includes(E)?u.split(","):[u]).some(I=>{var k;return(k=L.policy_lob)==null?void 0:k.toLowerCase().includes(I.toLowerCase())});return E==="is"||E==="is_any"?S:E==="is_not"||E==="is_not_any"?!S:!0}case"policy_status":{const S=(["is_any","is_not_any"].includes(E)?u.split(","):[u]).some(I=>{var k;return((k=L.policy_status)==null?void 0:k.toLowerCase())===I.toLowerCase()});return E==="is"||E==="is_any"?S:E==="is_not"||E==="is_not_any"?!S:!0}case"policy_class":{const S=(["is_any","is_not_any"].includes(E)?u.split(","):[u]).some(I=>{var k;return((k=L.policy_class)==null?void 0:k.toLowerCase())===I.toLowerCase()});return E==="is"||E==="is_any"?S:E==="is_not"||E==="is_not_any"?!S:!0}case"policy_expiration":{if(((X=L.policy_status)==null?void 0:X.toLowerCase().trim())!=="active")return!1;const S=L.expiration_date;if(!S)return!1;if(E==="in_next_days"){const I=parseInt(u,10),k=new Date;k.setDate(k.getDate()+I);const q=k.toISOString().split("T")[0];return S>=V&&S<=q}if(E==="in_last_days"){const I=parseInt(u,10),k=new Date;k.setDate(k.getDate()-I);const q=k.toISOString().split("T")[0];return S>=q&&S<=V}if(E==="more_than_days_future"){const I=parseInt(u,10),k=new Date;k.setDate(k.getDate()+I);const q=k.toISOString().split("T")[0];return S>q}if(E==="less_than_days_future"){const I=parseInt(u,10),k=new Date;k.setDate(k.getDate()+I);const q=k.toISOString().split("T")[0];return S>=V&&S<q}if(E==="more_than_days_ago"){const I=parseInt(u,10),k=new Date;k.setDate(k.getDate()-I);const q=k.toISOString().split("T")[0];return S<q}if(E==="less_than_days_ago"){const I=parseInt(u,10),k=new Date;k.setDate(k.getDate()-I);const q=k.toISOString().split("T")[0];return S>=q&&S<=V}return E==="before"?S<u:E==="after"?S>u:E==="between"?S>=u&&S<=($||u):!0}case"policy_effective":{if(((D=L.policy_status)==null?void 0:D.toLowerCase().trim())!=="active")return!1;const S=L.effective_date;if(!S)return!1;if(E==="in_next_days"){const I=parseInt(u,10),k=new Date;k.setDate(k.getDate()+I);const q=k.toISOString().split("T")[0];return S>=V&&S<=q}if(E==="in_last_days"){const I=parseInt(u,10),k=new Date;k.setDate(k.getDate()-I);const q=k.toISOString().split("T")[0];return S>=q&&S<=V}if(E==="more_than_days_future"){const I=parseInt(u,10),k=new Date;k.setDate(k.getDate()+I);const q=k.toISOString().split("T")[0];return S>q}if(E==="less_than_days_future"){const I=parseInt(u,10),k=new Date;k.setDate(k.getDate()+I);const q=k.toISOString().split("T")[0];return S>=V&&S<q}if(E==="more_than_days_ago"){const I=parseInt(u,10),k=new Date;k.setDate(k.getDate()-I);const q=k.toISOString().split("T")[0];return S<q}if(E==="less_than_days_ago"){const I=parseInt(u,10),k=new Date;k.setDate(k.getDate()-I);const q=k.toISOString().split("T")[0];return S>=q&&S<=V}return E==="before"?S<u:E==="after"?S>u:E==="between"?S>=u&&S<=($||u):!0}default:return!0}},_=["active_policy_type","policy_type","policy_status","policy_class","policy_expiration","policy_effective"],B=L=>["is_not","is_not_any"].includes(L.operator),K=(L,N)=>{const{field:H,operator:E,value:u}=N,$=["is_any","is_not_any"].includes(E)?u.split(","):[u];return H==="active_policy_type"?!L.filter(X=>{var D;return((D=X.policy_status)==null?void 0:D.toLowerCase().trim())==="active"}).some(X=>$.some(D=>{var A;return(A=X.policy_lob)==null?void 0:A.toLowerCase().includes(D.toLowerCase())})):H==="policy_type"?!L.some(Y=>$.some(X=>{var D;return(D=Y.policy_lob)==null?void 0:D.toLowerCase().includes(X.toLowerCase())})):H==="policy_status"?!L.some(Y=>$.some(X=>{var D;return((D=Y.policy_status)==null?void 0:D.toLowerCase())===X.toLowerCase()})):H==="policy_class"?!L.some(Y=>$.some(X=>{var D;return((D=Y.policy_class)==null?void 0:D.toLowerCase())===X.toLowerCase()})):!0},T=(L,N)=>{const H=N.rules||[];if(H.length===0)return!0;const E=y[L.account_unique_id]||[],u=H.filter(A=>_.includes(A.field)&&A.operator&&A.value&&!B(A)),$=H.filter(A=>_.includes(A.field)&&A.operator&&A.value&&B(A));return!H.filter(A=>!_.includes(A.field)||!A.operator||!A.value).every(A=>W(L,A,E))||!$.every(A=>K(E,A))?!1:u.length===0?!0:E.some(A=>u.every(S=>b(A,S)))},P=new Set,M=[];for(const L of g){const N=[];d.forEach((H,E)=>{T(L,H)&&N.push(E)}),N.length>0&&!P.has(L.account_unique_id)&&(P.add(L.account_unique_id),M.push({...L,_matchedGroups:N,_lastEmailSent:h[L.account_unique_id]||null}))}return M.slice(a,a+i)},async getRecipientStats(e,r){const{rules:o=[],groups:i=[],notOptedOut:a=!0,search:n=""}=r||{},s=i.length>0?i:o.length>0?[{rules:o}]:[];s.length>0;const l=s.length>1,c=s.some(m=>(m.rules||[]).some(h=>["policy_type","active_policy_type","policy_status","policy_class","policy_count","policy_expiration","location","city","zip_code","email_domain"].includes(h.field)&&(h.value||["is_empty","is_not_empty"].includes(h.operator)))),d=l||c;let j,f;d?(j=await this.getRecipients(e,r,{limit:1e4}),f=j.length):(j=await this.getRecipients(e,r,{limit:1e4}),f=j.length);const p={},v=m=>m?m.toLowerCase().replace(/\b\w/g,y=>y.toUpperCase()):"";j.forEach(m=>{const y=(m.billing_state||"").trim(),h=(m.billing_city||"").trim();if(h&&y){const w=v(h),R=y.length===2?y.toUpperCase():v(y),W=`${w}, ${R}`;p[W]=(p[W]||0)+1}});const g=Object.entries(p).map(([m,y])=>({city:m,count:y})).sort((m,y)=>y.count-m.count).slice(0,10);return{count:f,breakdown:{total:j.length,byCity:g}}},async countRecipients(e,r){return(await this.getRecipientStats(e,r)).count},async getRecipientLocationBreakdown(e,r){return(await this.getRecipientStats(e,r)).breakdown},async scheduleBatch(e,r,o=null){const i=fe(e),a=await this.getById(e,r);if(!a)throw new Error("Batch not found");if(a.status!=="Draft")throw new Error("Can only schedule draft batches");const n=await this.getRecipients(e,a.filter_config,{limit:1e4});if(n.length===0)throw new Error("No recipients match the filter");const s=new Set,l=[];let c=0;for(const w of n){const R=(w.person_email||w.email||"").toLowerCase().trim();R&&!s.has(R)?(s.add(R),l.push(w)):R&&c++}if(l.length===0)throw new Error("No valid recipients after deduplication");const d=new Date;d.setDate(d.getDate()-7);const j=d.toISOString();let f=new Set,p=0;if(a.template_id){const{data:w,error:R}=await x.from("email_logs").select("to_email").eq("template_id",a.template_id).gte("sent_at",j).in("status",["Sent","Delivered","Opened","Clicked"]);R?console.warn("Failed to check recent sends, proceeding without template deduplication:",R):w&&(f=new Set(w.map(W=>(W.to_email||"").toLowerCase().trim())))}const v=l.filter(w=>{const R=(w.person_email||w.email||"").toLowerCase().trim();return f.has(R)?(p++,!1):!0});if(v.length===0)throw new Error("No eligible recipients - all have received this template within the last 7 days");const g=o||new Date().toISOString(),m=v.map(w=>({owner_id:i,account_id:w.account_unique_id,template_id:a.template_id,recipient_email:w.person_email||w.email,recipient_name:w.primary_contact_first_name?`${w.primary_contact_first_name} ${w.primary_contact_last_name||""}`.trim():w.name,subject:a.subject,scheduled_for:g,status:"Pending",batch_id:r})),y=100;let h=0;for(let w=0;w<m.length;w+=y){const R=m.slice(w,w+y),{data:W,error:b}=await x.from("scheduled_emails").insert(R).select();if(b)throw b;h+=W.length}return await this.update(e,r,{status:o?"Scheduled":"Sending",total_recipients:v.length,scheduled_for:g,started_at:o?null:new Date().toISOString()}),{scheduled:h,total:v.length,duplicatesRemoved:c,recentlySentSkipped:p,scheduledFor:g}},async cancelBatch(e,r){await this.update(e,r,{status:"Cancelled"});let o=x.from("scheduled_emails").update({status:"Cancelled"}).eq("batch_id",r).eq("status","Pending");o=G(o,e);const{error:i}=await o;if(i)throw i;return!0},async getBatchStats(e,r){let o=x.from("scheduled_emails").select("status").eq("batch_id",r);o=G(o,e);const{data:i,error:a}=await o;if(a)throw a;const n={pending:0,sent:0,failed:0,cancelled:0,total:i.length};return i.forEach(s=>{const l=s.status.toLowerCase();n[l]!==void 0&&n[l]++}),n},async getAllWithStats(e,r={}){const o=await this.getAll(e,r);return await Promise.all(o.map(async a=>{if(a.status==="Draft")return{...a,stats:null};const n=await this.getBatchStats(e,a.id);return{...a,stats:n}}))}},tt={async dailyRefresh(){const e=[];let r=0,o=0,i=0;const{data:a,error:n}=await x.from("automations").select("id, name, owner_id").in("status",["Active","active"]);if(n)return e.push(`Failed to get active automations: ${n.message}`),{automationsProcessed:r,totalAdded:o,totalRemoved:i,errors:e};for(const s of a||[])try{const l=await this.refreshAutomationSchedule(s.id);o+=l.added,i+=l.removed,r++,l.errors.length>0&&e.push(...l.errors.map(c=>`[${s.name}] ${c}`))}catch(l){e.push(`Failed to refresh automation ${s.name}: ${l.message}`)}return{automationsProcessed:r,totalAdded:o,totalRemoved:i,errors:e}},async generateAutomationSchedule(e){var T,P;const r=[];let o=0;const{data:i,error:a}=await x.from("automations").select("*").eq("id",e).single();if(a)throw a;if(!i)throw new Error("Automation not found");const n=i.nodes||[],s=i.filter_config||{groups:[]},l=n.find(M=>M.type==="trigger"),c=((T=l==null?void 0:l.config)==null?void 0:T.time)||"09:00";(P=l==null?void 0:l.config)!=null&&P.timezone;const d=this.extractDateTriggerRules(s);if(d.length===0)return{scheduled:0,errors:["No date-based trigger rules found - automation uses recurring schedule"]};const j=this.removeRelativeDateRules(s);let f;try{if(i.owner_id)f=await ye.getRecipients([i.owner_id],j,{limit:1e4});else{const{data:M,error:U}=await x.from("accounts").select("*").or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false").limit(1e4);if(U)throw U;f=(M||[]).filter(L=>{const N=L.person_email||L.email;return N&&N.includes("@")})}}catch(M){return r.push(`Failed to get matching accounts: ${M.message}`),{scheduled:0,errors:r}}if(!f||f.length===0)return{scheduled:0,errors:["No accounts match the base filter criteria"]};const p=f.map(M=>M.account_unique_id),{data:v,error:g}=await x.from("policies").select("account_id, policy_lob, expiration_date, effective_date, policy_status").in("account_id",p).eq("policy_status","Active");if(g)return r.push(`Failed to get policies: ${g.message}`),{scheduled:0,errors:r};const m=this.calculateTriggerDates(f,v||[],d,i),y=this.buildEmailSchedule(n),h=[...new Set(y.map(M=>M.templateId))],{data:w}=await x.from("email_templates").select("id, from_email, from_name, subject").in("id",h),R={};(w||[]).forEach(M=>{R[M.id]=M});const{data:W}=await x.from("scheduled_emails").select("account_id, template_id, qualification_value").eq("automation_id",e).in("status",["Pending","Processing"]),b=new Set((W||[]).map(M=>`${M.account_id}:${M.template_id}:${M.qualification_value}`)),_=[],B=new Date;B.setHours(0,0,0,0);for(const M of f){const U=m[M.account_unique_id]||[];for(const L of U)for(const N of y){const H=new Date(L.date);H.setDate(H.getDate()+N.daysOffset);const[E,u]=c.split(":").map(Number);if(H.setHours(E,u,0,0),H<B)continue;const $=L.date.toISOString().split("T")[0],V=`${M.account_unique_id}:${N.templateId}:${$}`;if(b.has(V))continue;const Y=R[N.templateId]||{};_.push({owner_id:M.owner_id,automation_id:e,account_id:M.account_unique_id,template_id:N.templateId,recipient_email:M.person_email||M.email,recipient_name:M.primary_contact_first_name?`${M.primary_contact_first_name} ${M.primary_contact_last_name||""}`.trim():M.name,scheduled_for:H.toISOString(),status:"Pending",qualification_value:$,trigger_field:L.field,node_id:N.nodeId,requires_verification:!0,from_email:Y.from_email,from_name:Y.from_name,subject:Y.subject}),b.add(V)}}const K=100;for(let M=0;M<_.length;M+=K){const U=_.slice(M,M+K),{error:L}=await x.from("scheduled_emails").insert(U);L?r.push(`Batch insert error: ${L.message}`):o+=U.length}return{scheduled:o,errors:r}},extractDateTriggerRules(e){var i,a;const r=[],o=(e==null?void 0:e.groups)||[];for(const n of o)for(const s of n.rules||[])["policy_expiration","policy_effective","account_created"].includes(s.field)&&["in_next_days","in_last_days","less_than_days_future","more_than_days_future"].includes(s.operator)&&r.push({field:s.field,operator:s.operator,value:parseInt(s.value,10),policyType:(a=(i=n.rules)==null?void 0:i.find(l=>l.field==="active_policy_type"||l.field==="policy_type"))==null?void 0:a.value});return r},removeRelativeDateRules(e){const r={...e};return r.groups=(e.groups||[]).map(o=>({...o,rules:(o.rules||[]).filter(i=>["policy_expiration","policy_effective","account_created"].includes(i.field)?!["in_next_days","in_last_days","less_than_days_future","more_than_days_future"].includes(i.operator):!0)})),r},calculateTriggerDates(e,r,o,i){const a={},n={};for(const s of r)n[s.account_id]||(n[s.account_id]=[]),n[s.account_id].push(s);for(const s of e){a[s.account_unique_id]=[];const l=n[s.account_unique_id]||[];for(const c of o)if(c.field==="policy_expiration"||c.field==="policy_effective"){const d=c.field==="policy_expiration"?"expiration_date":"effective_date";for(const j of l){if(c.policyType&&!c.policyType.split(",").map(v=>v.toLowerCase().trim()).some(v=>{var g;return(g=j.policy_lob)==null?void 0:g.toLowerCase().includes(v)}))continue;const f=j[d];f&&a[s.account_unique_id].push({field:c.field,date:new Date(f),policyLob:j.policy_lob})}}else c.field==="account_created"&&s.created_at&&a[s.account_unique_id].push({field:c.field,date:new Date(s.created_at)})}return a},buildEmailSchedule(e){const r=[];let o=0;const i=n=>{var s,l,c;for(const d of n){if(d.type==="send_email"&&((s=d.config)!=null&&s.template))r.push({nodeId:d.id,templateId:d.config.template,daysOffset:o});else if(d.type==="delay"){const j=((l=d.config)==null?void 0:l.duration)||0,f=((c=d.config)==null?void 0:c.unit)||"days";f==="days"?o+=j:f==="weeks"?o+=j*7:f==="hours"&&(o+=j/24)}d.branches&&d.branches.yes&&i(d.branches.yes)}},a=e.filter(n=>n.type!=="entry_criteria"&&n.type!=="trigger");return i(a),r},async verifyAccountQualifies(e){const{automation_id:r,account_id:o,qualification_value:i,trigger_field:a}=e,{data:n,error:s}=await x.from("automations").select("*").eq("id",r).single();if(s||!n)return{qualifies:!1,reason:"Automation not found or inactive"};if(n.status!=="Active"&&n.status!=="active")return{qualifies:!1,reason:"Automation is not active"};const{data:l,error:c}=await x.from("accounts").select("*").eq("account_unique_id",o).single();if(c||!l)return{qualifies:!1,reason:"Account not found"};if(l.person_has_opted_out_of_email)return{qualifies:!1,reason:"Account has opted out of email"};if(a==="policy_expiration"||a==="policy_effective"){const d=a==="policy_expiration"?"expiration_date":"effective_date",{data:j}=await x.from("policies").select("*").eq("account_id",o).eq("policy_status","Active").eq(d,i);if(!j||j.length===0)return{qualifies:!1,reason:`Policy with ${a} = ${i} no longer exists or is inactive`}}if(e.template_id){const d=new Date;d.setDate(d.getDate()-7);const{data:j}=await x.from("email_logs").select("id").eq("template_id",e.template_id).ilike("to_email",(l.person_email||l.email||"").trim()).gte("sent_at",d.toISOString()).in("status",["Sent","Delivered","Opened","Clicked"]).limit(1);if(j&&j.length>0)return{qualifies:!1,reason:"Template already sent to this recipient within 7 days"}}return{qualifies:!0}},async getEmailsForVerification(){const e=new Date,r=new Date(e.getTime()+24*60*60*1e3),{data:o,error:i}=await x.from("scheduled_emails").select("*").eq("status","Pending").eq("requires_verification",!0).lte("scheduled_for",r.toISOString()).gte("scheduled_for",e.toISOString()).order("scheduled_for");if(i)throw i;return o||[]},async runVerification(){const e=[];let r=0,o=0;const i=await this.getEmailsForVerification();for(const a of i)try{const n=await this.verifyAccountQualifies(a);n.qualifies?(await x.from("scheduled_emails").update({requires_verification:!1}).eq("id",a.id),r++):(await x.from("scheduled_emails").update({status:"Cancelled",error_message:n.reason}).eq("id",a.id),o++)}catch(n){e.push(`Error verifying email ${a.id}: ${n.message}`)}return{verified:r,cancelled:o,errors:e}},async cleanupAutomationSchedule(e){const{data:r,error:o}=await x.from("scheduled_emails").update({status:"Cancelled",error_message:"Automation deactivated"}).eq("automation_id",e).eq("status","Pending").select("id");if(o)throw o;return{cancelled:(r==null?void 0:r.length)||0}},async refreshAutomationSchedule(e){const r=[];let o=0,i=0;const{data:a}=await x.from("scheduled_emails").select("*").eq("automation_id",e).eq("status","Pending");for(const s of a||[])try{const l=await this.verifyAccountQualifies(s);l.qualifies||(await x.from("scheduled_emails").update({status:"Cancelled",error_message:l.reason}).eq("id",s.id),i++)}catch(l){r.push(`Error checking email ${s.id}: ${l.message}`)}const n=await this.generateAutomationSchedule(e);return o=n.scheduled,r.push(...n.errors),{added:o,removed:i,errors:r}},async handleStatusChange(e,r){return r==="active"||r==="Active"?this.generateAutomationSchedule(e):this.cleanupAutomationSchedule(e)},async handleNewAccount(e,r){const{data:o}=await x.from("automations").select("*").eq("owner_id",r).in("status",["Active","active"]);if(!o||o.length===0)return{scheduled:0};let i=0;for(const a of o){const n=a.filter_config;if(!n)continue;const{data:s}=await x.from("accounts").select("*").eq("account_unique_id",e).single();if(!s)continue;if((await ye.getRecipients([r],n,{limit:1})).some(d=>d.account_unique_id===e)){const d=await this.generateAutomationSchedule(a.id);i+=d.scheduled}}return{scheduled:i}},async handlePolicyChange(e,r){const{data:o}=await x.from("accounts").select("owner_id").eq("account_unique_id",e).single();if(!o)return{updated:0};const{data:i}=await x.from("automations").select("*").eq("owner_id",o.owner_id).in("status",["Active","active"]);if(!i)return{updated:0};let a=0;for(const n of i)this.extractDateTriggerRules(n.filter_config).some(c=>c.field==="policy_expiration"||c.field==="policy_effective")&&(await this.refreshAutomationSchedule(n.id),a++);return{updated:a}}},le={async getAll(e,r={}){const{status:o,category:i,search:a}=r;let n=x.from("automations").select(`
        *,
        _count:automation_enrollments(count)
      `).order("is_default",{ascending:!1}).order("name");n=G(n,e),o&&(n=n.eq("status",o)),i&&(n=n.eq("category",i)),a&&(n=n.or(`name.ilike.%${a}%,description.ilike.%${a}%`));const{data:s,error:l}=await n;if(l)throw l;return s},async getAllWithStats(e){let r=x.from("automations").select("*").order("is_default",{ascending:!1}).order("name");r=G(r,e);const{data:o,error:i}=await r;if(i)throw i;const a=o.map(c=>c.id),{data:n,error:s}=await x.from("automation_enrollments").select("automation_id, status").in("automation_id",a);if(s)throw s;const l={};return n.forEach(c=>{l[c.automation_id]||(l[c.automation_id]={total:0,active:0,completed:0,exited:0}),l[c.automation_id].total++,l[c.automation_id][c.status.toLowerCase()]++}),o.map(c=>({...c,enrollmentStats:l[c.id]||{total:0,active:0,completed:0,exited:0}}))},async getById(e,r){let o=x.from("automations").select("*").eq("id",r);o=G(o,e);const{data:i,error:a}=await o.single();if(a)throw a;return i},async getByIdWithDetails(e,r){const o=await this.getById(e,r),{data:i,error:a}=await x.from("automation_enrollments").select("status").eq("automation_id",r);if(a)throw a;const n={total:i.length,active:i.filter(d=>d.status==="Active").length,completed:i.filter(d=>d.status==="Completed").length,exited:i.filter(d=>d.status==="Exited").length,paused:i.filter(d=>d.status==="Paused").length},{data:s,error:l}=await x.from("email_logs").select("status, open_count, click_count").eq("automation_id",r);if(l)throw l;const c={sent:s.length,delivered:s.filter(d=>d.status==="Delivered"||d.status==="Opened"||d.status==="Clicked").length,opened:s.filter(d=>d.open_count>0).length,clicked:s.filter(d=>d.click_count>0).length,bounced:s.filter(d=>d.status==="Bounced").length};return{...o,enrollmentStats:n,emailSummary:c}},async getByDefaultKey(e,r){let o=x.from("automations").select("*").eq("default_key",r);o=G(o,e);const{data:i,error:a}=await o.single();if(a)throw a;return i},async create(e,r){const o=fe(e),{data:i,error:a}=await x.from("automations").insert({owner_id:o,is_default:!1,status:"Draft",...r}).select().single();if(a)throw a;return i},async update(e,r,o){const i=o.filter_config!==void 0||o.nodes!==void 0||o.send_time!==void 0;let a=x.from("automations").update({...o,updated_at:new Date().toISOString()}).eq("id",r);a=G(a,e);const{data:n,error:s}=await a.select().single();if(s)throw s;if(i&&n&&(n.status==="Active"||n.status==="active"))try{await tt.cleanupAutomationSchedule(r),await tt.generateAutomationSchedule(r)}catch(l){console.warn("Failed to refresh automation schedule after update:",l.message)}return n},async updateStatus(e,r,o){const i=await this.update(e,r,{status:o});try{await tt.handleStatusChange(r,o)}catch(a){console.warn("Failed to handle automation schedule:",a.message)}return i},async activate(e,r){return this.updateStatus(e,r,"active")},async pause(e,r){return this.updateStatus(e,r,"paused")},async archive(e,r){return this.updateStatus(e,r,"archived")},async delete(e,r){let o=x.from("automations").delete().eq("id",r).eq("is_default",!1);o=G(o,e);const{error:i}=await o;if(i)throw i;return!0},async duplicate(e,r){const o=await this.getById(e,r),i=fe(e),{data:a,error:n}=await x.from("automations").insert({owner_id:i,is_default:!1,default_key:null,name:`${o.name} (Copy)`,description:o.description,category:o.category,status:"Draft",send_time:o.send_time,timezone:o.timezone,frequency:o.frequency,max_enrollments:o.max_enrollments,enrollment_cooldown_days:o.enrollment_cooldown_days,distribute_evenly:o.distribute_evenly,filter_config:o.filter_config,nodes:o.nodes}).select().single();if(n)throw n;return a},async updateFilters(e,r,o){return this.update(e,r,{filter_config:o})},async updateNodes(e,r,o){return this.update(e,r,{nodes:o})},async updateSchedule(e,r,o){const{sendTime:i,timezone:a,frequency:n}=o;return this.update(e,r,{send_time:i,timezone:a,frequency:n})},async updateEnrollmentRules(e,r,o){const{maxEnrollments:i,cooldownDays:a,distributeEvenly:n}=o;return this.update(e,r,{max_enrollments:i,enrollment_cooldown_days:a,distribute_evenly:n})},async getByStatus(e,r){let o=x.from("automations").select("*").eq("status",r).order("name");o=G(o,e);const{data:i,error:a}=await o;if(a)throw a;return i},async getActive(e){return this.getByStatus(e,"Active")},async getCategories(e){let r=x.from("automations").select("category").not("category","is",null);r=G(r,e);const{data:o,error:i}=await r;if(i)throw i;return[...new Set(o.map(a=>a.category))]}};function ro(){const{ownerIds:e,filterKey:r}=ae();return re({queryKey:["automations",r,"withStats"],queryFn:()=>le.getAllWithStats(e),enabled:e.length>0})}function no(e){const{ownerIds:r,filterKey:o}=ae();return re({queryKey:["automation",o,e],queryFn:()=>le.getById(r,e),enabled:r.length>0&&!!e})}function St(){const{ownerIds:e,filterKey:r}=ae(),o=Me(),i=()=>{o.invalidateQueries({queryKey:["automations"]})},a=Z({mutationFn:m=>le.create(e,m),onSuccess:i}),n=Z({mutationFn:({automationId:m,updates:y})=>le.update(e,m,y),onSuccess:m=>{i(),o.setQueryData(["automation",r,m.id],m)}}),s=Z({mutationFn:m=>le.delete(e,m),onSuccess:i}),l=Z({mutationFn:m=>le.duplicate(e,m),onSuccess:i}),c=Z({mutationFn:m=>le.activate(e,m),onSuccess:m=>{i(),o.setQueryData(["automation",r,m.id],m)}}),d=Z({mutationFn:m=>le.pause(e,m),onSuccess:m=>{i(),o.setQueryData(["automation",r,m.id],m)}}),j=Z({mutationFn:m=>le.archive(e,m),onSuccess:i}),f=Z({mutationFn:({automationId:m,filterConfig:y})=>le.updateFilters(e,m,y),onSuccess:m=>{o.setQueryData(["automation",r,m.id],m)}}),p=Z({mutationFn:({automationId:m,nodes:y})=>le.updateNodes(e,m,y),onSuccess:m=>{o.setQueryData(["automation",r,m.id],m)}}),v=Z({mutationFn:({automationId:m,scheduleConfig:y})=>le.updateSchedule(e,m,y),onSuccess:m=>{o.setQueryData(["automation",r,m.id],m)}}),g=Z({mutationFn:({automationId:m,rules:y})=>le.updateEnrollmentRules(e,m,y),onSuccess:m=>{o.setQueryData(["automation",r,m.id],m)}});return{createAutomation:a,updateAutomation:n,deleteAutomation:s,duplicateAutomation:l,activateAutomation:c,pauseAutomation:d,archiveAutomation:j,updateFilters:f,updateNodes:p,updateSchedule:v,updateEnrollmentRules:g}}const io={async getByAutomation(e,r={}){const{status:o,limit:i=50,offset:a=0}=r;let n=x.from("automation_enrollments").select(`
        *,
        account:accounts(
          account_unique_id,
          name,
          person_email,
          email,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("automation_id",e).order("enrolled_at",{ascending:!1}).range(a,a+i-1);o&&(n=n.eq("status",o));const{data:s,error:l}=await n;if(l)throw l;return s},async getByAccount(e,r={}){const{status:o}=r;let i=x.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category, status)
      `).eq("account_id",e).order("enrolled_at",{ascending:!1});o&&(i=i.eq("status",o));const{data:a,error:n}=await i;if(n)throw n;return a},async getById(e){const{data:r,error:o}=await x.from("automation_enrollments").select(`
        *,
        account:accounts(*),
        automation:automations(*)
      `).eq("id",e).single();if(o)throw o;return r},async getStats(e){const{data:r,error:o}=await x.from("automation_enrollments").select("status, emails_sent, emails_opened, emails_clicked").eq("automation_id",e);if(o)throw o;const i={total:r.length,active:0,completed:0,exited:0,paused:0,totalEmailsSent:0,totalOpens:0,totalClicks:0};return r.forEach(a=>{i[a.status.toLowerCase()]++,i.totalEmailsSent+=a.emails_sent||0,i.totalOpens+=a.emails_opened||0,i.totalClicks+=a.emails_clicked||0}),i},async canEnroll(e,r){const{data:o,error:i}=await x.rpc("can_enroll_in_automation",{p_account_id:e,p_automation_id:r});if(i)throw i;return o},async enroll(e,r,o={}){var d;if(!await this.canEnroll(r,e))throw new Error("Account cannot be enrolled in this automation");const{data:a,error:n}=await x.from("automations").select("nodes").eq("id",e).single();if(n)throw n;const s=(d=a.nodes)==null?void 0:d[0],{data:l,error:c}=await x.from("automation_enrollments").insert({automation_id:e,account_id:r,status:"Active",current_node_id:(s==null?void 0:s.id)||null,metadata:o}).select().single();if(c)throw c;return l},async bulkEnroll(e,r){const o={enrolled:[],skipped:[],errors:[]};for(const i of r)try{if(await this.canEnroll(i,e)){const n=await this.enroll(e,i);o.enrolled.push(n)}else o.skipped.push(i)}catch(a){o.errors.push({accountId:i,error:a.message})}return o},async exit(e,r="manual"){const{data:o,error:i}=await x.from("automation_enrollments").update({status:"Exited",exit_reason:r,exited_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;return o},async pause(e){const{data:r,error:o}=await x.from("automation_enrollments").update({status:"Paused",updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;return r},async resume(e){const{data:r,error:o}=await x.from("automation_enrollments").update({status:"Active",updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;return r},async complete(e){const{data:r,error:o}=await x.from("automation_enrollments").update({status:"Completed",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;return r},async updateProgress(e,r,o=null){const{data:i,error:a}=await x.from("automation_enrollments").update({current_node_id:r,current_branch:o,last_action_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();if(a)throw a;return i},async setNextAction(e,r){const{data:o,error:i}=await x.from("automation_enrollments").update({next_action_at:r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;return o},async incrementEmailSent(e){const{data:r,error:o}=await x.rpc("increment_enrollment_email_sent",{p_enrollment_id:e});if(o){const{data:i}=await x.from("automation_enrollments").select("emails_sent").eq("id",e).single();return x.from("automation_enrollments").update({emails_sent:((i==null?void 0:i.emails_sent)||0)+1}).eq("id",e)}return r},async getReadyForAction(){const{data:e,error:r}=await x.from("automation_enrollments").select(`
        *,
        automation:automations(*),
        account:accounts(*)
      `).eq("status","Active").lte("next_action_at",new Date().toISOString()).order("next_action_at");if(r)throw r;return e},async getHistory(e){const{data:r,error:o}=await x.from("enrollment_history").select(`
        *,
        email_log:email_logs(id, subject, status, sent_at, first_opened_at, first_clicked_at)
      `).eq("enrollment_id",e).order("created_at",{ascending:!0});if(o)throw o;return r},async logHistory(e,r){const{data:o,error:i}=await x.from("enrollment_history").insert({enrollment_id:e,...r}).select().single();if(i)throw i;return o}};function ao(e,r={}){return re({queryKey:["enrollments","account",e,r],queryFn:()=>io.getByAccount(e,r),enabled:!!e,staleTime:3e4})}const Ze={async getAll(e,r={}){const{status:o,automationId:i,accountId:a,limit:n=50,offset:s=0,startDate:l,endDate:c}=r;let d=x.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email, primary_contact_first_name),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).order("created_at",{ascending:!1}).range(s,s+n-1);d=G(d,e),o&&(d=d.eq("status",o)),i&&(d=d.eq("automation_id",i)),a&&(d=d.eq("account_id",a)),l&&(d=d.gte("sent_at",l)),c&&(d=d.lte("sent_at",c));const{data:j,error:f}=await d;if(f)throw f;return j},async getById(e,r){let o=x.from("email_logs").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name),
        enrollment:automation_enrollments(id, status)
      `).eq("id",r);o=G(o,e);const{data:i,error:a}=await o.single();if(a)throw a;return i},async getByIdWithEvents(e,r){const o=await this.getById(e,r),{data:i,error:a}=await x.from("email_events").select("*").eq("email_log_id",r).order("event_timestamp",{ascending:!0});if(a)throw a;return{...o,events:i}},async getByAccount(e,r,o={}){const{limit:i=20}=o;let a=x.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("account_id",r).order("created_at",{ascending:!1}).limit(i);a=G(a,e);const{data:n,error:s}=await a;if(s)throw s;return n},async getByAutomation(e,r,o={}){const{limit:i=50,offset:a=0,status:n}=o;let s=x.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("automation_id",r).order("created_at",{ascending:!1}).range(a,a+i-1);s=G(s,e),n&&(s=s.eq("status",n));const{data:l,error:c}=await s;if(c)throw c;return l},async create(e,r){const o=fe(e),{data:i,error:a}=await x.from("email_logs").insert({owner_id:o,status:"Queued",...r}).select().single();if(a)throw a;return i},async updateStatus(e,r,o,i={}){let a=x.from("email_logs").update({status:o,...i,updated_at:new Date().toISOString()}).eq("id",r);a=G(a,e);const{data:n,error:s}=await a.select().single();if(s)throw s;return n},async markSent(e,r,o){return this.updateStatus(e,r,"Sent",{sent_at:new Date().toISOString(),sendgrid_message_id:o})},async markFailed(e,r,o,i=null){return this.updateStatus(e,r,"Failed",{failed_at:new Date().toISOString(),error_message:o,error_code:i})},async getRecentOpens(e,r=10){let o=x.from("email_logs").select(`
        id, subject, first_opened_at, open_count,
        account:accounts(account_unique_id, name, person_email)
      `).not("first_opened_at","is",null).order("first_opened_at",{ascending:!1}).limit(r);o=G(o,e);const{data:i,error:a}=await o;if(a)throw a;return i},async getRecentClicks(e,r=10){let o=x.from("email_logs").select(`
        id, subject, first_clicked_at, click_count,
        account:accounts(account_unique_id, name, person_email)
      `).not("first_clicked_at","is",null).order("first_clicked_at",{ascending:!1}).limit(r);o=G(o,e);const{data:i,error:a}=await o;if(a)throw a;return i},async getBounces(e,r={}){const{limit:o=50,offset:i=0}=r;let a=x.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("status","Bounced").order("bounced_at",{ascending:!1}).range(i,i+o-1);a=G(a,e);const{data:n,error:s}=await a;if(s)throw s;return n},async getStats(e,r,o,i=null){const a=fe(e),{data:n,error:s}=await x.rpc("get_email_stats",{p_owner_id:a,p_start_date:r,p_end_date:o,p_automation_id:i});if(s)throw s;return(n==null?void 0:n[0])||{total_sent:0,total_delivered:0,total_opened:0,unique_opens:0,total_clicked:0,unique_clicks:0,total_bounced:0,open_rate:0,click_rate:0}},async getDailyStats(e,r,o,i=null){let a=x.from("email_stats_daily").select("*").gte("stat_date",r).lte("stat_date",o).order("stat_date");a=G(a,e),i?a=a.eq("automation_id",i):a=a.is("automation_id",null);const{data:n,error:s}=await a;if(s)throw s;return n},async getComparisonStats(e,r=30){const o=new Date,i=new Date(o);i.setDate(i.getDate()-r);const a=new Date(i);a.setDate(a.getDate()-r);const[n,s]=await Promise.all([this.getStats(e,i.toISOString().split("T")[0],o.toISOString().split("T")[0]),this.getStats(e,a.toISOString().split("T")[0],i.toISOString().split("T")[0])]),l=(c,d)=>d===0?c>0?100:0:((c-d)/d*100).toFixed(1);return{current:n,previous:s,changes:{sent:l(n.total_sent,s.total_sent),delivered:l(n.total_delivered,s.total_delivered),opened:l(n.unique_opens,s.unique_opens),clicked:l(n.unique_clicks,s.unique_clicks),bounced:l(n.total_bounced,s.total_bounced)}}}};function so(e,r={}){const{ownerIds:o,filterKey:i}=ae();return re({queryKey:["emailLogs",i,"account",e,r],queryFn:()=>Ze.getByAccount(o,e,r),enabled:o.length>0&&!!e,staleTime:3e4})}const jt={async getRecent(e,r={}){const{category:o,limit:i=20,offset:a=0}=r;let n=x.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name),
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).order("created_at",{ascending:!1}).range(a,a+i-1);n=G(n,e),o&&(n=n.eq("event_category",o));const{data:s,error:l}=await n;if(l)throw l;return s},async getByAccount(e,r,o=20){let i=x.from("activity_log").select(`
        *,
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).eq("account_id",r).order("created_at",{ascending:!1}).limit(o);i=G(i,e);const{data:a,error:n}=await i;if(n)throw n;return a},async getByAutomation(e,r,o=50){let i=x.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("automation_id",r).order("created_at",{ascending:!1}).limit(o);i=G(i,e);const{data:a,error:n}=await i;if(n)throw n;return a},async getByType(e,r,o={}){const{limit:i=50,offset:a=0}=o;let n=x.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("event_type",r).order("created_at",{ascending:!1}).range(a,a+i-1);n=G(n,e);const{data:s,error:l}=await n;if(l)throw l;return s},async log(e,r){const o=fe(e),{data:i,error:a}=await x.from("activity_log").insert({owner_id:o,...r}).select().single();if(a)throw a;return i},async logEmailSent(e,r,o,i=null){return this.log(e,{event_type:"email_sent",event_category:"email",title:"Email sent",email_log_id:r,account_id:o,automation_id:i,actor_type:i?"automation":"user"})},async logEmailOpened(e,r,o){return this.log(e,{event_type:"email_opened",event_category:"email",title:"Email opened",email_log_id:r,account_id:o,actor_type:"system"})},async logEmailClicked(e,r,o,i=null){return this.log(e,{event_type:"email_clicked",event_category:"email",title:"Email link clicked",email_log_id:r,account_id:o,actor_type:"system",event_data:i?{url:i}:{}})},async logEnrollment(e,r,o,i){return this.log(e,{event_type:"enrollment_created",event_category:"automation",title:`Enrolled in ${i}`,automation_id:r,account_id:o,actor_type:"automation"})},async logAutomationCompleted(e,r,o,i){return this.log(e,{event_type:"automation_completed",event_category:"automation",title:`Completed ${i}`,automation_id:r,account_id:o,actor_type:"automation"})},async logUnsubscribe(e,r,o,i=null){return this.log(e,{event_type:"unsubscribed",event_category:"account",title:o==="all"?"Unsubscribed from all emails":"Unsubscribed from automation",account_id:r,automation_id:i,actor_type:"system",severity:"warning"})},async logBounce(e,r,o,i){return this.log(e,{event_type:"email_bounced",event_category:"email",title:`Email bounced (${i})`,email_log_id:r,account_id:o,actor_type:"system",severity:"warning",event_data:{bounce_type:i}})},async getStats(e,r=7){const o=new Date;o.setDate(o.getDate()-r);let i=x.from("activity_log").select("event_type, event_category").gte("created_at",o.toISOString());i=G(i,e);const{data:a,error:n}=await i;if(n)throw n;const s={total:a.length,byType:{},byCategory:{}};return a.forEach(l=>{s.byType[l.event_type]=(s.byType[l.event_type]||0)+1,s.byCategory[l.event_category]=(s.byCategory[l.event_category]||0)+1}),s}},wt={async getAll(e,r={}){const{status:o,automationId:i,limit:a=50,offset:n=0}=r;let s=x.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).order("scheduled_for",{ascending:!0}).range(n,n+a-1);s=G(s,e),o&&(s=s.eq("status",o)),i&&(s=s.eq("automation_id",i));const{data:l,error:c}=await s;if(c)throw c;return l},async getUpcoming(e,r=10){let o=x.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        automation:automations(id, name)
      `).eq("status","Pending").gte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0}).limit(r);o=G(o,e);const{data:i,error:a}=await o;if(a)throw a;return i},async getReadyToSend(){const{data:e,error:r}=await x.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name, owner_id)
      `).eq("status","Pending").lte("scheduled_for",new Date().toISOString()).or("requires_verification.is.null,requires_verification.eq.false").order("scheduled_for",{ascending:!0});if(r)throw r;return e},async getById(e,r){let o=x.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name)
      `).eq("id",r);o=G(o,e);const{data:i,error:a}=await o.single();if(a)throw a;return i},async create(e,r){const o=fe(e),{data:i,error:a}=await x.from("scheduled_emails").insert({owner_id:o,status:"Pending",...r}).select().single();if(a)throw a;return i},async createBatch(e,r){const o=fe(e),i=r.map(s=>({owner_id:o,status:"Pending",...s})),{data:a,error:n}=await x.from("scheduled_emails").insert(i).select();if(n)throw n;return a},async update(e,r,o){let i=x.from("scheduled_emails").update({...o,updated_at:new Date().toISOString()}).eq("id",r);i=G(i,e);const{data:a,error:n}=await i.select().single();if(n)throw n;return a},async cancel(e,r){return this.update(e,r,{status:"Cancelled"})},async reschedule(e,r,o){return this.update(e,r,{scheduled_for:o,status:"Pending",attempts:0})},async markProcessing(e){const{data:r,error:o}=await x.from("scheduled_emails").update({status:"Processing",last_attempt_at:new Date().toISOString(),attempts:x.sql`attempts + 1`,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;return r},async markSent(e,r){const{data:o,error:i}=await x.from("scheduled_emails").update({status:"Sent",email_log_id:r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;return o},async markFailed(e,r){const{data:o,error:i}=await x.from("scheduled_emails").select("attempts, max_attempts").eq("id",e).single();if(i)throw i;const a=o.attempts<o.max_attempts,{data:n,error:s}=await x.from("scheduled_emails").update({status:a?"Pending":"Failed",error_message:r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw s;return n},async markSkipped(e,r){const{data:o,error:i}=await x.from("scheduled_emails").update({status:"Cancelled",error_message:r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;return o},async wasRecentlySent(e,r,o=7){if(!e||!r)return!1;const i=new Date;i.setDate(i.getDate()-o);const{data:a,error:n}=await x.from("email_logs").select("id").eq("template_id",e).ilike("to_email",r.trim()).gte("sent_at",i.toISOString()).in("status",["Sent","Delivered","Opened","Clicked"]).limit(1);return n?(console.warn("Failed to check recent sends:",n),!1):a&&a.length>0},async getReadyToSendFiltered(){var i,a;const e=await this.getReadyToSend();if(!e||e.length===0)return{eligible:[],skipped:[]};const r=[],o=[];for(const n of e){const s=n.recipient_email||((i=n.account)==null?void 0:i.person_email)||((a=n.account)==null?void 0:a.email);if(n.template_id&&s&&await this.wasRecentlySent(n.template_id,s)){await this.markSkipped(n.id,"Template already sent to this recipient within 7 days"),o.push(n);continue}r.push(n)}return{eligible:r,skipped:o}},async delete(e,r){let o=x.from("scheduled_emails").delete().eq("id",r);o=G(o,e);const{error:i}=await o;if(i)throw i;return!0},async getStats(e){let r=x.from("scheduled_emails").select("status, scheduled_for");r=G(r,e);const{data:o,error:i}=await r;if(i)throw i;const a=new Date,n={pending:0,processing:0,sent:0,failed:0,cancelled:0,upcomingToday:0,upcomingThisWeek:0},s=new Date(a);s.setHours(23,59,59,999);const l=new Date(a);return l.setDate(l.getDate()+7),o.forEach(c=>{if(n[c.status.toLowerCase()]++,c.status==="Pending"){const d=new Date(c.scheduled_for);d<=s&&n.upcomingToday++,d<=l&&n.upcomingThisWeek++}}),n}},Be={async getAll(e,r={}){const{status:o,search:i,limit:a=25,offset:n=0,expiring:s=!1}=r;let l=x.from("accounts").select("*",{count:"exact",head:!0});if(l=G(l,e),o){let w=o;o.toLowerCase()==="prior"&&(w="prior_customer"),l=l.ilike("account_status",w)}i&&(l=l.or(`name.ilike.%${i}%,person_email.ilike.%${i}%,email.ilike.%${i}%`));const{count:c,error:d}=await l;if(d)throw d;let j=x.from("accounts").select("*").order("name").range(n,n+a-1);if(j=G(j,e),o){let w=o;o.toLowerCase()==="prior"&&(w="prior_customer"),j=j.ilike("account_status",w)}i&&(j=j.or(`name.ilike.%${i}%,person_email.ilike.%${i}%,email.ilike.%${i}%`));const{data:f,error:p}=await j;if(p)throw p;if(!f||f.length===0)return{accounts:[],total:c||0};const v=f.map(w=>w.account_unique_id).filter(Boolean),m=new Date().toISOString().split("T")[0],y=new Date;y.setDate(y.getDate()+30);const h=y.toISOString().split("T")[0];if(v.length>0){const{data:w,error:R}=await x.from("policies").select("account_id, policy_lob, policy_status, expiration_date").in("account_id",v);if(!R&&w){const W={};w.forEach(b=>{var B;W[b.account_id]||(W[b.account_id]=[]);const _=b.expiration_date&&b.expiration_date>=m&&b.expiration_date<=h;W[b.account_id].push({policy_type:b.policy_lob,status:((B=b.policy_status)==null?void 0:B.toLowerCase())||"unknown",expiration_date:b.expiration_date,is_expiring:_})}),f.forEach(b=>{b.policies=W[b.account_unique_id]||[],b.policy_count=b.policies.length,b.has_expiring_policy=b.policies.some(_=>_.is_expiring),b.expiring_policy_count=b.policies.filter(_=>_.is_expiring).length})}}if(s){const w=f.filter(R=>R.has_expiring_policy);return{accounts:w,total:w.length,isExpiringFilter:!0}}return{accounts:f,total:c||0}},async getStats(e){let r=x.from("accounts").select("*",{count:"exact",head:!0});r=G(r,e);const{count:o,error:i}=await r;if(i)throw i;let a=x.from("accounts").select("*",{count:"exact",head:!0}).ilike("account_status","customer");a=G(a,e);const{count:n}=await a;let s=x.from("accounts").select("*",{count:"exact",head:!0}).ilike("account_status","prospect");s=G(s,e);const{count:l}=await s;let c=x.from("accounts").select("*",{count:"exact",head:!0}).ilike("account_status","prior_customer");c=G(c,e);const{count:d}=await c;let j=x.from("accounts").select("*",{count:"exact",head:!0}).ilike("account_status","lead");j=G(j,e);const{count:f}=await j;let p=0;const v=new Date().toISOString().split("T")[0],g=new Date;g.setDate(g.getDate()+30);const m=g.toISOString().split("T")[0],{count:y}=await x.from("policies").select("*",{count:"exact",head:!0}).gte("expiration_date",v).lte("expiration_date",m);if(y&&y>0){const{data:h}=await x.from("policies").select("account_id").gte("expiration_date",v).lte("expiration_date",m).limit(5e3);if(h&&h.length>0){const w=[...new Set(h.map(R=>R.account_id).filter(Boolean))];if(w.length>0){let R=0;const W=100;for(let b=0;b<w.length;b+=W){const _=w.slice(b,b+W);let B=x.from("accounts").select("*",{count:"exact",head:!0}).in("account_unique_id",_);B=G(B,e);const{count:K}=await B;R+=K||0}p=R}}}return{Customer:n||0,Prospect:l||0,Prior:d||0,Lead:f||0,total:o||0,expiring:p}},async getById(e){const{data:r,error:o}=await x.from("accounts").select("*").eq("account_unique_id",e).single();if(o)throw o;return r},async getByIdWithPolicies(e){const{data:r,error:o}=await x.from("accounts").select("*").eq("account_unique_id",e).single();if(o)throw o;if(!r)return null;const{data:i,error:a}=await x.from("policies").select("*").eq("account_id",e).order("expiration_date",{ascending:!1});if(a)return console.error("Error fetching policies:",a),{...r,policies:[]};if(i&&i.length>0){const n=[...new Set(i.map(s=>s.carrier_id).filter(Boolean))];if(n.length>0){const{data:s,error:l}=await x.from("carriers").select("id, name").in("id",n);if(s&&s.length>0){const c={};s.forEach(d=>{c[d.id]=d.name}),i.forEach(d=>{d.carrier_id&&c[d.carrier_id]&&(d.carrier={name:c[d.carrier_id]})})}}}return{...r,policies:i||[]}},async getByIdWithEmailHistory(e,r){const o=await this.getByIdWithPolicies(r);let i=x.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("account_id",r).order("created_at",{ascending:!1}).limit(20);i=G(i,e);const{data:a,error:n}=await i;if(n)throw n;const{data:s,error:l}=await x.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category)
      `).eq("account_id",r).order("enrolled_at",{ascending:!1});if(l)throw l;return{...o,emailLogs:a,enrollments:s}},async search(e,r,o=20){let i=x.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name").or(`name.ilike.%${r}%,person_email.ilike.%${r}%,email.ilike.%${r}%,primary_contact_first_name.ilike.%${r}%,primary_contact_last_name.ilike.%${r}%`).limit(o);i=G(i,e);const{data:a,error:n}=await i;if(n)throw n;return a},async getByStatus(e,r,o={}){const{limit:i=50,offset:a=0}=o;let n=x.from("accounts").select("*").eq("account_status",r).order("name").range(a,a+i-1);n=G(n,e);const{data:s,error:l}=await n;if(l)throw l;return s},async getCustomers(e,r={}){return this.getByStatus(e,"customer",r)},async getProspects(e,r={}){return this.getByStatus(e,"prospect",r)},async getPriorCustomers(e,r={}){return this.getByStatus(e,"prior_customer",r)},async getWithExpiringPolicies(e,r=45){const o=new Date;o.setDate(o.getDate()+r);const i=Zt(e),{data:a,error:n}=await x.from("policies").select(`
        policy_unique_id,
        policy_lob,
        expiration_date,
        policy_status,
        account_id,
        account:accounts!policies_account_id_fkey(
          account_unique_id,
          name,
          person_email,
          email,
          owner_id,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("policy_status","Active").lte("expiration_date",o.toISOString().split("T")[0]).gte("expiration_date",new Date().toISOString().split("T")[0]).order("expiration_date");if(n)throw n;return a.filter(s=>{var l;return((l=s.account)==null?void 0:l.owner_id)&&i.includes(s.account.owner_id)})},async getCounts(e){let r=x.from("accounts").select("account_status");r=G(r,e);const{data:o,error:i}=await r;if(i)throw i;const a={total:o.length,customer:0,prospect:0,prior_customer:0,other:0};return o.forEach(n=>{var l;const s=((l=n.account_status)==null?void 0:l.toLowerCase().replace(" ","_"))||"other";a[s]!==void 0?a[s]++:a.other++}),a},getEmail(e){return e.person_email||e.email},getDisplayName(e){return e.primary_contact_first_name?`${e.primary_contact_first_name} ${e.primary_contact_last_name||""}`.trim():e.name},canReceiveMarketing(e){return e.user_subscribed_to_marketing!==!1&&e.person_has_opted_out_of_email!==!0&&(e.person_email||e.email)},async getEligibleForAutomation(e,r){let o=x.from("accounts").select("*").or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false").not("person_email","is",null);o=G(o,e);const{data:i,error:a}=await o;if(a)throw a;const n=i.map(d=>d.account_unique_id),{data:s,error:l}=await x.from("policies").select("*").in("account_id",n);if(l)throw l;return i.map(d=>({...d,policies:s.filter(j=>j.account_id===d.account_unique_id)})).filter(d=>this.canReceiveMarketing(d))}},Ct={async getDashboardData(e,r={}){const{days:o=30}=r,[i,a,n,s,l,c,d]=await Promise.all([Ze.getComparisonStats(e,o),jt.getRecent(e,{limit:10}),wt.getUpcoming(e,5),Ze.getRecentOpens(e,5),Ze.getRecentClicks(e,5),Be.getCounts(e),this.getAutomationStats(e)]);return{emailStats:i.current,emailChanges:i.changes,recentActivity:a,scheduledEmails:n,recentOpens:s,recentClicks:l,accountCounts:c,automationStats:d}},async getAutomationStats(e){let r=x.from("automations").select(`
        id,
        name,
        status,
        stats
      `).eq("status","Active");r=G(r,e);const{data:o,error:i}=await r;if(i)throw i;const a=o.map(c=>c.id),{data:n,error:s}=await x.from("automation_enrollments").select("automation_id, status").in("automation_id",a);if(s)throw s;const l={};return n.forEach(c=>{l[c.automation_id]||(l[c.automation_id]={active:0,total:0}),l[c.automation_id].total++,c.status==="Active"&&l[c.automation_id].active++}),{total:o.length,active:o.filter(c=>c.status==="Active").length,automations:o.map(c=>{var d,j;return{...c,enrollmentCount:((d=l[c.id])==null?void 0:d.total)||0,activeEnrollments:((j=l[c.id])==null?void 0:j.active)||0}})}},async getEmailPerformanceOverTime(e,r=30){const o=new Date;o.setDate(o.getDate()-r);let i=x.from("email_stats_daily").select("*").is("automation_id",null).gte("stat_date",o.toISOString().split("T")[0]).order("stat_date");i=G(i,e);const{data:a,error:n}=await i;if(n)throw n;return a},async getTopAutomations(e,r=5){let o=x.from("automations").select("id, name, stats").eq("status","Active");o=G(o,e);const{data:i,error:a}=await o;if(a)throw a;return i.map(s=>{var l,c,d,j,f;return{...s,sent:((l=s.stats)==null?void 0:l.sent)||0,opened:((c=s.stats)==null?void 0:c.opened)||0,clicked:((d=s.stats)==null?void 0:d.clicked)||0,openRate:((j=s.stats)==null?void 0:j.sent)>0?(((f=s.stats)==null?void 0:f.opened)||0)/s.stats.sent*100:0}}).sort((s,l)=>l.openRate-s.openRate).slice(0,r)},async getAccountsNeedingAttention(e){let r=x.from("email_logs").select(`
        account:accounts(account_unique_id, name, person_email)
      `).eq("status","Bounced").not("account_id","is",null).limit(10);r=G(r,e);const{data:o,error:i}=await r;if(i)throw i;const a=await Be.getWithExpiringPolicies(e,30);return{bouncedEmails:o.map(n=>n.account).filter((n,s,l)=>l.findIndex(c=>c.account_unique_id===n.account_unique_id)===s),expiringPolicies:a.slice(0,10)}},async getQuickStats(e){const r=new Date().toISOString().split("T")[0],o=new Date;o.setDate(o.getDate()-30);let i=x.from("email_logs").select("*",{count:"exact",head:!0}).gte("sent_at",r);i=G(i,e);let a=x.from("email_logs").select("*",{count:"exact",head:!0}).gte("first_opened_at",r);a=G(a,e);let n=x.from("automations").select("*",{count:"exact",head:!0}).eq("status","Active");n=G(n,e);let s=x.from("scheduled_emails").select("*",{count:"exact",head:!0}).eq("status","Pending");s=G(s,e);const[{count:l},{count:c},{count:d},{count:j}]=await Promise.all([i,a,n,s]);return{emailsToday:l||0,opensToday:c||0,activeAutomations:d||0,pendingScheduled:j||0}}};function kt(){const{ownerIds:e,filterKey:r}=ae();return re({queryKey:["dashboard",r,"quick"],queryFn:()=>Ct.getQuickStats(e),enabled:e.length>0,staleTime:1e4,refetchInterval:3e4})}function lo(e=30){const{ownerIds:r,filterKey:o}=ae();return re({queryKey:["dashboard",o,"performance",e],queryFn:()=>Ct.getEmailPerformanceOverTime(r,e),enabled:r.length>0})}const zt=()=>{const{userId:e}=de();return e};function co(){const e=zt();return re({queryKey:["userSettings",e],queryFn:()=>be.get(e),enabled:!!e})}function po(){const e=zt(),r=Me(),o=()=>{r.invalidateQueries({queryKey:["userSettings",e]})},i=Z({mutationFn:c=>be.update(e,c),onSuccess:o}),a=Z({mutationFn:c=>be.updateSignature(e,c),onSuccess:o}),n=Z({mutationFn:c=>be.updateAgencyInfo(e,c),onSuccess:o}),s=Z({mutationFn:c=>be.updateEmailSettings(e,c),onSuccess:o}),l=Z({mutationFn:c=>be.updatePreferences(e,c),onSuccess:o});return{updateSettings:i,updateSignature:a,updateAgencyInfo:n,updateEmailSettings:s,updatePreferences:l}}function uo(e={}){const{ownerIds:r,filterKey:o}=ae();return re({queryKey:["accounts",o,e],queryFn:()=>Be.getAll(r,e),enabled:r.length>0,staleTime:3e4})}function xo(e){return re({queryKey:["account",e,"policies"],queryFn:()=>Be.getByIdWithPolicies(e),enabled:!!e,staleTime:3e4})}function go(){const{ownerIds:e,filterKey:r}=ae();return re({queryKey:["accounts",r,"stats"],queryFn:()=>Be.getStats(e),enabled:e.length>0})}const fo=()=>{const{userId:e}=de();return e};function mo(e,r=20){const o=fo();return re({queryKey:["activity",o,"account",e],queryFn:()=>jt.getByAccount(o,e,r),enabled:!!o&&!!e,staleTime:3e4})}function yo(e=10){const{ownerIds:r,filterKey:o}=ae();return re({queryKey:["scheduledEmails",o,"upcoming",e],queryFn:()=>wt.getUpcoming(r,e),enabled:r.length>0})}function Rt(e=!1){const{ownerIds:r,filterKey:o}=ae();return re({queryKey:["roleUserIds",o,e],queryFn:async()=>!e||r.length>1?r:be.getUserIdsByRole(r[0]),enabled:r.length>0,staleTime:6e4})}function ho(e={}){const{ownerIds:r,filterKey:o}=ae();return re({queryKey:["massEmails",o,"withStats",e],queryFn:()=>ye.getAllWithStats(r,e),enabled:r.length>0})}function st(e,r={}){const{ownerIds:o,filterKey:i}=ae();return re({queryKey:["massEmailRecipients",i,e,r],queryFn:()=>ye.getRecipients(o,e,r),enabled:o.length>0&&!!e})}function At(e,r=!1){var s,l;const{ownerIds:o,filterKey:i}=ae(),{data:a}=Rt(r),n=e?{rules:(s=e.rules)==null?void 0:s.map(c=>({field:c.field,operator:c.operator,value:c.value,value2:c.value2,radius:c.radius})),groups:(l=e.groups)==null?void 0:l.map(c=>{var d;return{rules:(d=c.rules)==null?void 0:d.map(j=>({field:j.field,operator:j.operator,value:j.value,value2:j.value2,radius:j.radius}))}}),search:e.search,notOptedOut:e.notOptedOut,includeRoleAccounts:r}:null;return re({queryKey:["massEmailRecipientStats",i,n,a],queryFn:()=>ye.getRecipientStats(a||o,e),enabled:o.length>0&&!!e&&!!a,staleTime:3e4,gcTime:6e4,placeholderData:c=>c})}function It(e,r=!1){const{data:o,isLoading:i,isFetching:a,error:n}=At(e,r);return{data:o==null?void 0:o.count,isLoading:i,isFetching:a,error:n}}function bo(e,r=!1){const{data:o,isLoading:i,isFetching:a,error:n}=At(e,r);return{data:o==null?void 0:o.breakdown,isLoading:i,isFetching:a,error:n}}function vo(){const{ownerIds:e}=ae(),r=Me(),o=()=>{r.invalidateQueries({queryKey:["massEmails"]})},i=Z({mutationFn:c=>ye.create(e,c),onSuccess:o}),a=Z({mutationFn:({batchId:c,updates:d})=>ye.update(e,c,d),onSuccess:o}),n=Z({mutationFn:c=>ye.delete(e,c),onSuccess:o}),s=Z({mutationFn:({batchId:c,scheduledFor:d})=>ye.scheduleBatch(e,c,d),onSuccess:()=>{o(),r.invalidateQueries({queryKey:["scheduledEmails"]})}}),l=Z({mutationFn:c=>ye.cancelBatch(e,c),onSuccess:()=>{o(),r.invalidateQueries({queryKey:["scheduledEmails"]})}});return{createBatch:i,updateBatch:a,deleteBatch:n,scheduleBatch:s,cancelBatch:l}}const _o=()=>{const{userId:e}=de();return e};function So(){const e=_o();return re({queryKey:["isAdmin",e],queryFn:()=>ue.isAdmin(e),enabled:!!e,staleTime:5*60*1e3})}function jo(){const e=Me(),r=()=>{e.invalidateQueries({queryKey:["masterAutomations"]}),e.invalidateQueries({queryKey:["masterAutomation"]}),e.invalidateQueries({queryKey:["automations"]}),e.invalidateQueries({queryKey:["automation"]})},o=Z({mutationFn:l=>ue.createMasterAutomation(l),onSuccess:r}),i=Z({mutationFn:({defaultKey:l,updates:c})=>ue.updateMasterAutomation(l,c),onSuccess:r}),a=Z({mutationFn:l=>ue.deleteMasterAutomation(l),onSuccess:r}),n=Z({mutationFn:l=>ue.syncMasterAutomation(l),onSuccess:()=>{e.invalidateQueries({queryKey:["automations"]}),e.invalidateQueries({queryKey:["automation"]})}}),s=Z({mutationFn:()=>ue.syncAllMasterAutomations(),onSuccess:()=>{e.invalidateQueries({queryKey:["automations"]}),e.invalidateQueries({queryKey:["automation"]})}});return{createMasterAutomation:o,updateMasterAutomation:i,deleteMasterAutomation:a,syncMasterAutomation:n,syncAllMasterAutomations:s}}const De={async callEdgeFunction(e,r={}){const{data:{session:o}}=await x.auth.getSession();if(!o)throw new Error("Not authenticated");const a=await fetch(`undefined/functions/v1/sender-domains?action=${e}`,{method:"POST",headers:{Authorization:`Bearer ${o.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(r)}),n=await a.json();if(!a.ok)throw new Error(n.error||"Edge function request failed");return n},async getAll(){return(await this.callEdgeFunction("list")).domains||[]},async getVerifiedDomains(){return(await this.callEdgeFunction("verified")).domains||[]},async addDomain(e,r={}){const{subdomain:o}=r;return(await this.callEdgeFunction("add",{domain:e,subdomain:o||null})).domain},async verifyDomain(e){return await this.callEdgeFunction("verify",{domainId:e})},async updateDefaults(e,r){return(await this.callEdgeFunction("update",{domainId:e,updates:r})).domain},async deleteDomain(e){await this.callEdgeFunction("delete",{domainId:e})}};function $t(){return re({queryKey:["sender-domains","verified"],queryFn:()=>De.getVerifiedDomains(),staleTime:5*60*1e3})}const Se=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite"}}),Qe=({label:e,value:r,change:o,icon:i,positive:a,isLoading:n,theme:s})=>t.jsxs("div",{style:{padding:"20px",backgroundColor:s.bgCard,borderRadius:"12px",border:`1px solid ${s.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[t.jsx("span",{style:{color:s.textSecondary,fontSize:"13px"},children:e}),t.jsx("span",{style:{fontSize:"20px"},children:i})]}),n?t.jsx(Se,{height:"32px",width:"80px"}):t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:s.text,marginBottom:"4px"},children:r}),o&&t.jsx("span",{style:{fontSize:"12px",color:a?s.success:s.danger},children:o})]})]}),wo=({email:e,theme:r,userId:o})=>{var i,a,n;return t.jsx("div",{style:{padding:"14px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"11px",color:r.textMuted,marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[t.jsx("span",{children:"ðŸ•"})," ",new Date(e.scheduled_for).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]}),t.jsx(Ce,{to:`/${o}/clients/${e.account_id}`,style:{fontSize:"14px",fontWeight:"600",color:r.text,textDecoration:"none"},children:((i=e.accounts)==null?void 0:i.name)||"Unknown Account"}),t.jsx("div",{style:{fontSize:"12px",color:r.textSecondary,marginTop:"2px"},children:((a=e.email_templates)==null?void 0:a.subject)||"No subject"}),t.jsx("span",{style:{display:"inline-block",marginTop:"6px",padding:"3px 8px",backgroundColor:r.bgHover,borderRadius:"4px",fontSize:"11px",color:r.textSecondary},children:((n=e.email_templates)==null?void 0:n.name)||"Unknown Template"})]}),t.jsxs("div",{style:{display:"flex",gap:"6px"},children:[t.jsx("button",{style:{padding:"6px 10px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.textSecondary,cursor:"pointer",fontSize:"12px"},children:"âœˆï¸"}),t.jsx("button",{style:{padding:"6px 10px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Ã—"})]})]})})},Co=({label:e,you:r,avg:o,theme:i})=>t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[t.jsx("span",{style:{fontSize:"12px",color:i.textSecondary},children:e}),t.jsxs("span",{style:{fontSize:"12px",color:i.textMuted},children:[r,"% vs ",o,"%"]})]}),t.jsxs("div",{style:{display:"flex",gap:"4px",height:"24px"},children:[t.jsx("div",{style:{width:`${Math.min(r,100)}%`,backgroundColor:i.primary,borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:t.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[r,"%"]})}),t.jsx("div",{style:{width:`${Math.min(o,100)}%`,backgroundColor:"#14b8a6",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:t.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[o,"%"]})})]})]}),xt=({t:e})=>{const{userId:r}=de(),{data:o,isLoading:i,error:a}=kt(),{data:n,isLoading:s}=yo(7),{data:l,isLoading:c}=lo(30),d=[{label:"Open Rate",you:(o==null?void 0:o.openRate)||0,avg:32},{label:"Click Rate",you:(o==null?void 0:o.clickRate)||0,avg:8},{label:"Response Rate",you:(o==null?void 0:o.responseRate)||0,avg:5}],j=p=>p>=1e3?`${(p/1e3).toFixed(1)}k`:(p==null?void 0:p.toLocaleString())||"0",f=p=>`${Math.round(p||0)}%`;return t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Dashboard"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Overview of your email campaigns and performance"})]}),a&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load dashboard data. Please try refreshing the page."}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"24px"},children:[t.jsx(Qe,{label:"Emails Sent",value:j(o==null?void 0:o.emailsSent),change:o!=null&&o.emailsSentChange?`${o.emailsSentChange>0?"+":""}${o.emailsSentChange}%`:null,icon:"ðŸ“§",positive:(o==null?void 0:o.emailsSentChange)>0,isLoading:i,theme:e}),t.jsx(Qe,{label:"Open Rate",value:f(o==null?void 0:o.openRate),change:o!=null&&o.openRateChange?`${o.openRateChange>0?"+":""}${o.openRateChange}%`:null,icon:"ðŸ“¬",positive:(o==null?void 0:o.openRateChange)>0,isLoading:i,theme:e}),t.jsx(Qe,{label:"Click Rate",value:f(o==null?void 0:o.clickRate),change:o!=null&&o.clickRateChange?`${o.clickRateChange>0?"+":""}${o.clickRateChange}%`:null,icon:"ðŸ–±ï¸",positive:(o==null?void 0:o.clickRateChange)>0,isLoading:i,theme:e}),t.jsx(Qe,{label:"Scheduled",value:j(o==null?void 0:o.scheduledCount),change:null,icon:"ðŸ“…",positive:null,isLoading:i,theme:e})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,margin:0},children:"Upcoming Scheduled Emails"}),t.jsx(Ce,{to:`/${r}/scheduled`,style:{fontSize:"12px",color:e.primary,textDecoration:"none"},children:"View all â†’"})]}),t.jsx("p",{style:{fontSize:"12px",color:e.textSecondary,marginBottom:"16px"},children:"Emails scheduled to be sent in the next 7 days"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:s?Array.from({length:3}).map((p,v)=>t.jsxs("div",{style:{padding:"14px",backgroundColor:e.bg,borderRadius:"8px",border:`1px solid ${e.border}`},children:[t.jsx(Se,{height:"12px",width:"120px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Se,{height:"16px",width:"180px"})}),t.jsx("div",{style:{marginTop:"4px"},children:t.jsx(Se,{height:"12px",width:"220px"})})]},v)):(n==null?void 0:n.length)>0?n.slice(0,5).map(p=>t.jsx(wo,{email:p,theme:e,userId:r},p.id)):t.jsxs("div",{style:{padding:"40px 20px",textAlign:"center",color:e.textMuted,fontSize:"14px"},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"8px"},children:"ðŸ“­"}),"No scheduled emails in the next 7 days"]})})]}),t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Performance Comparison"}),t.jsx("p",{style:{fontSize:"12px",color:e.textSecondary,marginBottom:"16px"},children:"Your metrics compared to industry averages"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:i?Array.from({length:3}).map((p,v)=>t.jsxs("div",{children:[t.jsx(Se,{height:"12px",width:"100px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Se,{height:"24px"})})]},v)):d.map((p,v)=>t.jsx(Co,{label:p.label,you:p.you,avg:p.avg,theme:e},v))}),t.jsxs("div",{style:{display:"flex",gap:"16px",marginTop:"16px",justifyContent:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:e.primary,borderRadius:"2px"}}),t.jsx("span",{style:{fontSize:"11px",color:e.textSecondary},children:"You"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"#14b8a6",borderRadius:"2px"}}),t.jsx("span",{style:{fontSize:"11px",color:e.textSecondary},children:"Industry Avg"})]})]})]})]}),t.jsxs("div",{style:{marginTop:"20px",padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,margin:0},children:"Recent Email Activity"}),t.jsx(Ce,{to:`/${r}/activity`,style:{fontSize:"12px",color:e.primary,textDecoration:"none"},children:"View all â†’"})]}),c?t.jsx(Se,{height:"200px"}):(l==null?void 0:l.length)>0?t.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"4px",height:"200px",padding:"20px 0"},children:l.slice(-14).map((p,v)=>{const g=Math.max(...l.map(y=>y.sent||0),1),m=(p.sent||0)/g*150;return t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[t.jsx("div",{style:{width:"100%",height:`${m}px`,backgroundColor:e.primary,borderRadius:"4px 4px 0 0",minHeight:"4px"},title:`${p.sent||0} sent on ${p.date}`}),t.jsx("span",{style:{fontSize:"9px",color:e.textMuted},children:new Date(p.date).toLocaleDateString("en-US",{weekday:"short"}).charAt(0)})]},v)})}):t.jsx("div",{style:{padding:"40px 20px",textAlign:"center",color:e.textMuted,fontSize:"14px"},children:"No email activity data yet"})]})]})},je=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),gt=({automation:e,onEdit:r,onToggle:o,hasVerifiedDomain:i,theme:a})=>{var c;const n=e.stats||{},s=e.status==="active",l=s||i;return t.jsxs("tr",{onClick:()=>r(e.id),style:{borderTop:`1px solid ${a.border}`,cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:d=>d.currentTarget.style.backgroundColor=a.bgHover,onMouseLeave:d=>d.currentTarget.style.backgroundColor="transparent",children:[t.jsx("td",{style:{padding:"14px 16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:a.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px"},children:"âš¡"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:a.text},children:e.name}),e.description&&t.jsx("div",{style:{fontSize:"12px",color:a.textMuted},children:e.description})]})]})}),t.jsx("td",{style:{padding:"14px 16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("button",{onClick:d=>{d.stopPropagation(),l&&o(e.id,s?"pause":"activate")},disabled:!l,title:l?"":"Add a verified sender domain to activate automations",style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:s?a.success:a.bgHover,cursor:l?"pointer":"not-allowed",position:"relative",transition:"background-color 0.2s",flexShrink:0,opacity:l?1:.5},children:t.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:s?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})}),t.jsx("span",{style:{fontSize:"12px",color:s?a.success:a.textMuted,fontWeight:"500"},children:s?"Active":e.status==="draft"?"Draft":"Paused"})]})}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:a.textSecondary},children:((c=n.totalSent)==null?void 0:c.toLocaleString())||0}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:a.textSecondary},children:n.openRate?`${Math.round(n.openRate)}%`:"â€”"}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:a.textSecondary},children:n.clickRate?`${Math.round(n.clickRate)}%`:"â€”"}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:a.textSecondary},children:n.activeEnrollments||0}),t.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:t.jsx("button",{onClick:d=>{d.stopPropagation(),r(e.id)},style:{padding:"6px 12px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"6px",color:a.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Edit"})})]})},ko=({t:e})=>{const{userId:r}=de(),o=he(),[i,a]=C.useState("automations"),{data:n,isLoading:s}=$t(),l=((n==null?void 0:n.length)||0)>0,{data:c,isLoading:d,error:j}=ro(),{activateAutomation:f,pauseAutomation:p}=St(),v=()=>{o(`/${r}/automations/new`)},g=b=>{o(`/${r}/automations/${b}`)},m=async(b,_)=>{try{_==="activate"?await f.mutateAsync(b):await p.mutateAsync(b)}catch(B){console.error(`Failed to ${_} automation:`,B)}},y=(c==null?void 0:c.filter(b=>b.is_default===!0))||[],h=(c==null?void 0:c.filter(b=>b.is_default!==!0))||[],w=(c==null?void 0:c.filter(b=>b.status==="active"))||[],R=(c==null?void 0:c.filter(b=>b.status==="paused"))||[],W=(c==null?void 0:c.filter(b=>b.status==="draft"))||[];return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Automations"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Create and manage automated email workflows"})]}),t.jsxs("button",{onClick:v,style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," Create Custom"]})]}),j&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load automations. Please try refreshing the page."}),!s&&!l&&t.jsxs("div",{style:{padding:"20px",backgroundColor:`${e.warning}15`,border:`1px solid ${e.warning}30`,borderRadius:"12px",marginBottom:"24px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Sender Domain Required"}),t.jsx("div",{style:{fontSize:"14px",color:e.textSecondary},children:"You need to add and verify a sender domain before you can activate automations. This ensures emails are delivered from your agency's domain."})]}),t.jsx("button",{onClick:()=>o(`/${r}/settings`),style:{padding:"10px 20px",backgroundColor:e.warning,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",whiteSpace:"nowrap"},children:"Add Domain"})]}),!d&&c&&t.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"24px",padding:"16px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{textAlign:"center",flex:1},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.success},children:w.length}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Active"})]}),t.jsx("div",{style:{width:"1px",backgroundColor:e.border}}),t.jsxs("div",{style:{textAlign:"center",flex:1},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.warning},children:R.length}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Paused"})]}),t.jsx("div",{style:{width:"1px",backgroundColor:e.border}}),t.jsxs("div",{style:{textAlign:"center",flex:1},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.textMuted},children:W.length}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Drafts"})]}),t.jsx("div",{style:{width:"1px",backgroundColor:e.border}}),t.jsxs("div",{style:{textAlign:"center",flex:1},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.primary},children:c.reduce((b,_)=>{var B;return b+(((B=_.stats)==null?void 0:B.totalSent)||0)},0).toLocaleString()}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Total Sent"})]})]}),t.jsxs("div",{style:{display:"flex",gap:"0",marginBottom:"24px",backgroundColor:e.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:[t.jsxs("button",{onClick:()=>a("automations"),style:{padding:"10px 20px",backgroundColor:i==="automations"?e.bgCard:"transparent",border:"none",borderRadius:"8px",color:i==="automations"?e.text:e.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:i==="automations"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:["Automations ",y.length>0&&`(${y.length})`]}),t.jsxs("button",{onClick:()=>a("my"),style:{padding:"10px 20px",backgroundColor:i==="my"?e.bgCard:"transparent",border:"none",borderRadius:"8px",color:i==="my"?e.text:e.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:i==="my"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:["My Automations ",h.length>0&&`(${h.length})`]})]}),i==="automations"&&t.jsx(t.Fragment,{children:d?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,padding:"20px"},children:Array.from({length:3}).map((b,_)=>t.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:_>0?`1px solid ${e.border}`:"none"},children:[t.jsx(je,{width:"36px",height:"36px"}),t.jsxs("div",{style:{flex:1},children:[t.jsx(je,{width:"200px",height:"16px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(je,{width:"120px",height:"12px"})})]})]},_))}):y.length>0?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,overflow:"hidden"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:e.bgHover},children:[t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Automation"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Status"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Sent"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Open Rate"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Click Rate"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Enrolled"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Actions"})]})}),t.jsx("tbody",{children:y.map(b=>t.jsx(gt,{automation:b,onEdit:g,onToggle:m,hasVerifiedDomain:l,theme:e},b.id))})]})}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"âš¡"}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:"No default automations"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:"Default automations will appear here when available."})]})}),i==="my"&&t.jsx(t.Fragment,{children:d?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,padding:"20px"},children:Array.from({length:3}).map((b,_)=>t.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:_>0?`1px solid ${e.border}`:"none"},children:[t.jsx(je,{width:"36px",height:"36px"}),t.jsxs("div",{style:{flex:1},children:[t.jsx(je,{width:"200px",height:"16px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(je,{width:"120px",height:"12px"})})]})]},_))}):h.length>0?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,overflow:"hidden"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:e.bgHover},children:[t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Automation"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Status"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Sent"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Open Rate"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Click Rate"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Enrolled"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Actions"})]})}),t.jsx("tbody",{children:h.map(b=>t.jsx(gt,{automation:b,onEdit:g,onToggle:m,hasVerifiedDomain:l,theme:e},b.id))})]})}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"âš¡"}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:"No custom automations yet"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:"Create your own automation or clone an existing one to get started."}),t.jsx("button",{onClick:v,style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Custom"})]})})]})},Ye=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),zo=({template:e,onSave:r,onClose:o,theme:i})=>{const[a,n]=C.useState((e==null?void 0:e.name)||""),[s,l]=C.useState((e==null?void 0:e.subject)||""),[c,d]=C.useState((e==null?void 0:e.body_html)||(e==null?void 0:e.body_text)||""),[j,f]=C.useState((e==null?void 0:e.category)||"general"),[p,v]=C.useState(!1),g=async()=>{v(!0);try{await r({name:a,subject:s,body_html:c,body_text:c.replace(/<[^>]*>/g,""),category:j}),o()}catch(h){console.error("Failed to save template:",h)}finally{v(!1)}},m=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],y=h=>{d(c+h)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:100},onClick:o}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxHeight:"90vh",backgroundColor:i.bgCard,borderRadius:"16px",border:`1px solid ${i.border}`,zIndex:101,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${i.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:i.text,margin:0},children:e?"Edit Template":"Create Template"}),t.jsx("button",{onClick:o,style:{background:"none",border:"none",color:i.textMuted,cursor:"pointer",fontSize:"20px"},children:"Ã—"})]}),t.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:i.text,display:"block",marginBottom:"6px"},children:"Template Name"}),t.jsx("input",{type:"text",value:a,onChange:h=>n(h.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:i.text,display:"block",marginBottom:"6px"},children:"Category"}),t.jsxs("select",{value:j,onChange:h=>f(h.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px"},children:[t.jsx("option",{value:"general",children:"General"}),t.jsx("option",{value:"welcome",children:"Welcome"}),t.jsx("option",{value:"renewal",children:"Renewal"}),t.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),t.jsx("option",{value:"engagement",children:"Engagement"}),t.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:i.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),t.jsx("input",{type:"text",value:s,onChange:h=>l(h.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px"}})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:i.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:m.map(h=>t.jsx("button",{onClick:()=>y(h.key),style:{padding:"4px 10px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.textSecondary,cursor:"pointer",fontSize:"11px"},children:h.label},h.key))})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:i.text,display:"block",marginBottom:"6px"},children:"Email Body"}),t.jsx("textarea",{value:c,onChange:h=>d(h.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:12,style:{width:"100%",padding:"12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),t.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${i.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[t.jsx("button",{onClick:o,style:{padding:"10px 20px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),t.jsx("button",{onClick:g,disabled:p||!a||!s,style:{padding:"10px 20px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:p?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:p||!a||!s?.6:1},children:p?"Saving...":e?"Save Changes":"Create Template"})]})]})]})},Ro=({template:e,onEdit:r,onDuplicate:o,onDelete:i,theme:a})=>{var c,d;const[n,s]=C.useState(!1),l={welcome:a.success,renewal:a.warning,cross_sell:a.primary,engagement:a.purple,policy_update:"#06b6d4",general:a.textMuted};return t.jsxs("div",{style:{padding:"20px",backgroundColor:a.bgCard,borderRadius:"12px",border:`1px solid ${a.border}`,position:"relative"},children:[t.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px"},children:[t.jsx("button",{onClick:()=>s(!n),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:a.textMuted,cursor:"pointer",fontSize:"16px"},children:"â‹®"}),n&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,zIndex:10},onClick:()=>s(!1)}),t.jsxs("div",{style:{position:"absolute",top:"100%",right:0,backgroundColor:a.bgCard,border:`1px solid ${a.border}`,borderRadius:"8px",padding:"4px",zIndex:11,minWidth:"140px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[t.jsx("button",{onClick:()=>{r(e),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:a.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:"âœï¸ Edit"}),t.jsx("button",{onClick:()=>{o(e),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:a.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:"ðŸ“‹ Duplicate"}),t.jsx("button",{onClick:()=>{i(e.id),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:a.danger,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:"ðŸ—‘ï¸ Delete"})]})]})]}),t.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${l[e.category]||a.textMuted}15`,color:l[e.category]||a.textMuted,borderRadius:"20px",fontSize:"11px",fontWeight:"500",marginBottom:"12px",textTransform:"capitalize"},children:((c=e.category)==null?void 0:c.replace("_"," "))||"General"}),t.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:a.text,marginBottom:"6px"},children:e.name}),t.jsx("p",{style:{fontSize:"13px",color:a.textSecondary,marginBottom:"8px"},children:e.subject}),t.jsxs("p",{style:{fontSize:"12px",color:a.textMuted,marginBottom:"12px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:[(d=e.body_text)==null?void 0:d.substring(0,100),"..."]}),t.jsxs("div",{style:{display:"flex",gap:"16px",paddingTop:"12px",borderTop:`1px solid ${a.border}`,fontSize:"11px",color:a.textMuted},children:[t.jsxs("span",{children:["ðŸ“§ ",e.usage_count||0," sent"]}),t.jsxs("span",{children:["ðŸ“¬ ",e.open_rate?`${Math.round(e.open_rate)}%`:"â€”"," opens"]})]}),t.jsx("button",{onClick:()=>r(e),style:{marginTop:"12px",width:"100%",padding:"10px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,cursor:"pointer",fontSize:"13px"},children:"Edit Template"})]})},Ao=({t:e})=>{const{userId:r}=de(),[o,i]=C.useState("my"),[a,n]=C.useState("all"),[s,l]=C.useState(""),[c,d]=C.useState(!1),[j,f]=C.useState(null),{data:p,isLoading:v,error:g}=pt(),{data:m}=Xt(),{createTemplate:y,updateTemplate:h,deleteTemplate:w,duplicateTemplate:R}=_t(),W=(p==null?void 0:p.filter(P=>!(a!=="all"&&P.category!==a||s&&!P.name.toLowerCase().includes(s.toLowerCase())&&!P.subject.toLowerCase().includes(s.toLowerCase()))))||[],b=()=>{f(null),d(!0)},_=P=>{f(P),d(!0)},B=async P=>{j?await h.mutateAsync({id:j.id,...P}):await y.mutateAsync(P)},K=async P=>{await R.mutateAsync(P.id)},T=async P=>{window.confirm("Are you sure you want to delete this template?")&&await w.mutateAsync(P)};return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Email Templates"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Create and manage reusable email templates"})]}),t.jsxs("button",{onClick:b,style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," Create Template"]})]}),g&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load templates. Please try refreshing the page."}),t.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"24px",alignItems:"center"},children:[t.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"300px"},children:[t.jsx("input",{type:"text",placeholder:"Search templates...",value:s,onChange:P=>l(P.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px"}}),t.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:e.textMuted},children:"ðŸ”"})]}),t.jsxs("select",{value:a,onChange:P=>n(P.target.value),style:{padding:"10px 12px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px",minWidth:"150px"},children:[t.jsx("option",{value:"all",children:"All Categories"}),t.jsx("option",{value:"welcome",children:"Welcome"}),t.jsx("option",{value:"renewal",children:"Renewal"}),t.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),t.jsx("option",{value:"engagement",children:"Engagement"}),t.jsx("option",{value:"policy_update",children:"Policy Update"}),t.jsx("option",{value:"general",children:"General"})]}),t.jsxs("span",{style:{fontSize:"13px",color:e.textMuted},children:[W.length," template",W.length!==1?"s":""]})]}),v?t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:Array.from({length:6}).map((P,M)=>t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx(Ye,{width:"80px",height:"20px"}),t.jsx("div",{style:{marginTop:"12px"},children:t.jsx(Ye,{width:"180px",height:"18px"})}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Ye,{width:"220px",height:"14px"})}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Ye,{height:"40px"})})]},M))}):W.length>0?t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:W.map(P=>t.jsx(Ro,{template:P,onEdit:_,onDuplicate:K,onDelete:T,theme:e},P.id))}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ“"}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:s||a!=="all"?"No templates found":"No templates yet"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:s||a!=="all"?"Try adjusting your search or filter criteria.":"Create your first email template to get started."}),!s&&a==="all"&&t.jsx("button",{onClick:b,style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Template"})]}),c&&t.jsx(zo,{template:j,onSave:B,onClose:()=>d(!1),theme:e})]})},ot=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Io=({type:e,theme:r})=>{const o=(e||"").toLowerCase();let i=o;(o==="prior_customer"||o.startsWith("prior"))&&(i="prior"),o.startsWith("customer")&&(i="customer"),o.startsWith("prospect")&&(i="prospect"),o.startsWith("lead")&&(i="lead");const a={customer:{bg:`${r.success}20`,text:r.success,label:"Customer"},prospect:{bg:`${r.primary}20`,text:r.primary,label:"Prospect"},prior:{bg:`${r.textMuted}20`,text:r.textMuted,label:"Prior Customer"},lead:{bg:`${r.warning}20`,text:r.warning,label:"Lead"}},n=a[i]||a.prospect;return t.jsx("span",{style:{padding:"4px 10px",backgroundColor:n.bg,color:n.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:n.label||e||"Unknown"})},$o=({policyType:e,status:r,theme:o})=>{const i=r==="active";return t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"3px 8px",backgroundColor:i?`${o.success}10`:`${o.textMuted}10`,borderRadius:"6px",fontSize:"11px",color:i?o.success:o.textMuted},children:[i?"âœ“":"â—‹"," ",e]})},Do=({client:e,onClick:r,theme:o})=>{var i,a,n;return t.jsxs("tr",{style:{borderTop:`1px solid ${o.border}`,cursor:"pointer"},onClick:r,onMouseOver:s=>s.currentTarget.style.backgroundColor=o.bgHover,onMouseOut:s=>s.currentTarget.style.backgroundColor="transparent",children:[t.jsx("td",{style:{padding:"14px 16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:o.bgHover,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",color:o.textMuted},children:((i=e.name)==null?void 0:i.charAt(0).toUpperCase())||"?"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:o.text},children:e.name}),t.jsx("div",{style:{fontSize:"12px",color:o.textMuted},children:e.person_email||e.email||"â€”"})]})]})}),t.jsx("td",{style:{padding:"14px 16px"},children:t.jsx(Io,{type:e.account_status||"Prospect",theme:o})}),t.jsx("td",{style:{padding:"14px 16px"},children:t.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",alignItems:"center"},children:((a=e.policies)==null?void 0:a.length)>0?t.jsxs(t.Fragment,{children:[e.policies.slice(0,3).map((s,l)=>t.jsx($o,{policyType:s.policy_type||"Policy",status:s.status,theme:o},l)),e.policies.length>3&&t.jsxs("span",{style:{fontSize:"11px",color:o.textMuted},children:["+",e.policies.length-3," more"]})]}):t.jsx("span",{style:{fontSize:"13px",color:o.textMuted},children:"No policies"})})}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:o.textSecondary,textAlign:"center"},children:e.policy_count||((n=e.policies)==null?void 0:n.length)||0}),t.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:t.jsxs("div",{style:{display:"flex",gap:"6px",justifyContent:"flex-end"},children:[t.jsx("button",{onClick:s=>{s.stopPropagation()},style:{padding:"6px 12px",backgroundColor:o.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:"ðŸ“§ Email"}),t.jsx("button",{onClick:s=>{s.stopPropagation(),r()},style:{padding:"6px 12px",backgroundColor:o.bgHover,border:`1px solid ${o.border}`,borderRadius:"6px",color:o.textSecondary,cursor:"pointer",fontSize:"12px"},children:"View"})]})})]})},Ie=({label:e,value:r,icon:o,color:i,theme:a,onClick:n,active:s})=>t.jsxs("div",{onClick:n,style:{padding:"16px",backgroundColor:s?`${i}15`:a.bgCard,borderRadius:"10px",border:`2px solid ${s?i:a.border}`,textAlign:"center",cursor:n?"pointer":"default",transition:"all 0.2s ease",transform:s?"scale(1.02)":"scale(1)"},onMouseOver:l=>{n&&(l.currentTarget.style.borderColor=i,l.currentTarget.style.transform="scale(1.02)")},onMouseOut:l=>{n&&!s&&(l.currentTarget.style.borderColor=a.border,l.currentTarget.style.transform="scale(1)")},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"4px"},children:o}),t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:i||a.text},children:r}),t.jsx("div",{style:{fontSize:"12px",color:a.textSecondary},children:e})]}),To=({t:e})=>{const{userId:r}=de(),o=he(),[i,a]=C.useState(""),[n,s]=C.useState("all"),[l,c]=C.useState("name"),[d,j]=C.useState("asc"),[f,p]=C.useState(1),v=25,g=C.useMemo(()=>{const U={limit:v,offset:(f-1)*v};return n!=="all"&&n!=="expiring"&&(U.status=n),n==="expiring"&&(U.expiring=!0,U.limit=100,U.offset=0),i.length>=2&&(U.search=i),U},[n,f,i]),{data:m,isLoading:y,error:h}=uo(g),{data:w,isLoading:R}=go(),W=(m==null?void 0:m.accounts)||[],b=(m==null?void 0:m.total)||0,_=Math.ceil(b/v),B=C.useMemo(()=>!W||W.length===0?[]:[...W].sort((U,L)=>{let N=U[l],H=L[l];return l==="name"&&(N=(N==null?void 0:N.toLowerCase())||"",H=(H==null?void 0:H.toLowerCase())||""),l==="policy_count"&&(N=U.policy_count||0,H=L.policy_count||0),d==="asc"?N>H?1:-1:N<H?1:-1}),[W,l,d]),K=U=>{s(U),p(1)},T=U=>{a(U),p(1)},P=U=>{o(`/${r}/accounts/${U}`)},M=w||{Customer:0,Prospect:0,Prior:0,total:0,expiring:0};return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Accounts"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"View and manage your account database"})]}),t.jsxs("div",{style:{display:"flex",gap:"12px"},children:[t.jsx("button",{onClick:()=>{},style:{padding:"10px 16px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:"ðŸ“¤ Export"}),t.jsx("button",{style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"+ Add Account"})]})]}),h&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load accounts. Please try refreshing the page."}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"16px",marginBottom:"24px"},children:[t.jsx(Ie,{label:"Total Accounts",value:R?"...":M.total,icon:"ðŸ“Š",color:e.text,theme:e,onClick:()=>K("all"),active:n==="all"}),t.jsx(Ie,{label:"Customers",value:R?"...":M.Customer,icon:"ðŸ‘¥",color:e.success,theme:e,onClick:()=>K(n==="Customer"?"all":"Customer"),active:n==="Customer"}),t.jsx(Ie,{label:"Prospects",value:R?"...":M.Prospect,icon:"ðŸŽ¯",color:e.primary,theme:e,onClick:()=>K(n==="Prospect"?"all":"Prospect"),active:n==="Prospect"}),t.jsx(Ie,{label:"Prior Customers",value:R?"...":M.Prior,icon:"ðŸ“",color:e.textMuted,theme:e,onClick:()=>K(n==="Prior"?"all":"Prior"),active:n==="Prior"}),t.jsx(Ie,{label:"Expiring in 30d",value:R?"...":M.expiring,icon:"âš ï¸",color:e.warning,theme:e,onClick:()=>K(n==="expiring"?"all":"expiring"),active:n==="expiring"})]}),t.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"20px",alignItems:"center",flexWrap:"wrap"},children:[t.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"350px"},children:[t.jsx("input",{type:"text",placeholder:"Search by name, email, or phone...",value:i,onChange:U=>T(U.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px"}}),t.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:e.textMuted},children:"ðŸ”"})]}),t.jsxs("select",{value:n,onChange:U=>K(U.target.value),style:{padding:"10px 12px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px",minWidth:"150px"},children:[t.jsx("option",{value:"all",children:"All Types"}),t.jsx("option",{value:"Customer",children:"Customers"}),t.jsx("option",{value:"Prospect",children:"Prospects"}),t.jsx("option",{value:"Prior",children:"Prior Customers"}),t.jsx("option",{value:"Lead",children:"Leads"}),t.jsx("option",{value:"expiring",children:"Expiring Policies"})]}),t.jsxs("select",{value:`${l}-${d}`,onChange:U=>{const[L,N]=U.target.value.split("-");c(L),j(N)},style:{padding:"10px 12px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px",minWidth:"150px"},children:[t.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),t.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),t.jsx("option",{value:"created_at-desc",children:"Newest First"}),t.jsx("option",{value:"created_at-asc",children:"Oldest First"})]}),t.jsx("span",{style:{fontSize:"13px",color:e.textMuted,marginLeft:"auto"},children:n==="expiring"?`${B.length} account${B.length!==1?"s":""} with expiring policies`:`Showing ${(f-1)*v+1}-${Math.min(f*v,b)} of ${b} account${b!==1?"s":""}`})]}),y?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,padding:"20px"},children:Array.from({length:5}).map((U,L)=>t.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:L>0?`1px solid ${e.border}`:"none"},children:[t.jsx(ot,{width:"40px",height:"40px"}),t.jsxs("div",{style:{flex:1},children:[t.jsx(ot,{width:"200px",height:"16px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(ot,{width:"150px",height:"12px"})})]})]},L))}):B.length>0?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,overflow:"hidden"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:e.bgHover},children:[t.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Account"}),t.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Type"}),t.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Policies"}),t.jsx("th",{style:{padding:"14px 16px",textAlign:"center",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"# Policies"}),t.jsx("th",{style:{padding:"14px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Actions"})]})}),t.jsx("tbody",{children:B.map(U=>t.jsx(Do,{client:U,onClick:()=>P(U.account_unique_id),theme:e},U.id))})]})}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ‘¥"}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:i?"No accounts found":"No accounts yet"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:i?"Try adjusting your search criteria.":"Your accounts will appear here once synced from Salesforce."})]}),_>1&&n!=="expiring"&&t.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginTop:"24px",padding:"16px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("button",{onClick:()=>p(1),disabled:f===1,style:{padding:"8px 12px",backgroundColor:f===1?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:f===1?e.textMuted:e.text,cursor:f===1?"not-allowed":"pointer",fontSize:"13px"},children:"âŸ¨âŸ¨ First"}),t.jsx("button",{onClick:()=>p(U=>Math.max(1,U-1)),disabled:f===1,style:{padding:"8px 12px",backgroundColor:f===1?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:f===1?e.textMuted:e.text,cursor:f===1?"not-allowed":"pointer",fontSize:"13px"},children:"âŸ¨ Prev"}),t.jsxs("span",{style:{padding:"8px 16px",fontSize:"14px",color:e.text,fontWeight:"500"},children:["Page ",f," of ",_]}),t.jsx("button",{onClick:()=>p(U=>Math.min(_,U+1)),disabled:f===_,style:{padding:"8px 12px",backgroundColor:f===_?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:f===_?e.textMuted:e.text,cursor:f===_?"not-allowed":"pointer",fontSize:"13px"},children:"Next âŸ©"}),t.jsx("button",{onClick:()=>p(_),disabled:f===_,style:{padding:"8px 12px",backgroundColor:f===_?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:f===_?e.textMuted:e.text,cursor:f===_?"not-allowed":"pointer",fontSize:"13px"},children:"Last âŸ©âŸ©"})]}),M.expiring>0&&n!=="expiring"&&t.jsxs("div",{style:{marginTop:"24px",padding:"16px 20px",backgroundColor:`${e.warning}10`,border:`1px solid ${e.warning}30`,borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("span",{style:{fontSize:"24px"},children:"âš ï¸"}),t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:e.text},children:[M.expiring," account",M.expiring!==1?"s have":" has"," policies expiring in the next 30 days"]}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Consider setting up renewal reminders for these accounts."})]})]}),t.jsx("button",{onClick:()=>K("expiring"),style:{padding:"8px 16px",backgroundColor:e.warning,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"View Expiring"})]})]})},_e=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Dt=({status:e,theme:r})=>{const o={active:{bg:`${r.success}20`,text:r.success},pending:{bg:`${r.warning}20`,text:r.warning},cancelled:{bg:`${r.danger}20`,text:r.danger},expired:{bg:`${r.textMuted}20`,text:r.textMuted}},i=o[e]||o.pending;return t.jsx("span",{style:{padding:"4px 10px",backgroundColor:i.bg,color:i.text,borderRadius:"20px",fontSize:"11px",fontWeight:"500",textTransform:"capitalize"},children:e})},$e=({event:e,theme:r})=>{const o={sent:"ðŸ“¤",delivered:"âœ…",opened:"ðŸ“¬",clicked:"ðŸ–±ï¸",bounced:"âŒ",unsubscribed:"ðŸš«"};return t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"2px 8px",backgroundColor:r.bgHover,borderRadius:"4px",fontSize:"11px",color:r.textSecondary},children:[o[e]||"ðŸ“§"," ",e]})},Bo=({policy:e,theme:r})=>{var s;const o=e.expiration_date?Math.ceil((new Date(e.expiration_date)-new Date)/864e5):null,i=e.policy_lob||e.policy_type||"Unknown",a=e.policy_status||e.status||"unknown",n=((s=e.carrier)==null?void 0:s.name)||e.carrier_name||e.carrier||"â€”";return t.jsxs("div",{style:{padding:"16px",backgroundColor:r.bg,borderRadius:"10px",border:`1px solid ${r.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[t.jsx("div",{style:{padding:"8px 12px",backgroundColor:`${r.primary}15`,borderRadius:"8px",fontSize:"14px",fontWeight:"600",color:r.primary},children:i}),t.jsx(Dt,{status:a.toLowerCase(),theme:r})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",fontSize:"13px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Policy Number"}),t.jsx("div",{style:{color:r.text},children:e.policy_number||"â€”"})]}),t.jsxs("div",{children:[t.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Carrier"}),t.jsx("div",{style:{color:r.text},children:n})]}),t.jsxs("div",{children:[t.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Effective Date"}),t.jsx("div",{style:{color:r.text},children:e.effective_date?new Date(e.effective_date).toLocaleDateString():"â€”"})]}),t.jsxs("div",{children:[t.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Expiration"}),t.jsx("div",{style:{color:o!==null&&o>0&&o<=30?r.warning:r.text},children:e.expiration_date?t.jsxs(t.Fragment,{children:[new Date(e.expiration_date).toLocaleDateString(),o!==null&&o>0&&o<=30&&t.jsxs("span",{style:{fontSize:"11px",marginLeft:"6px"},children:["(",o,"d left)"]})]}):"â€”"})]})]}),(e.premium||e.annual_premium)&&t.jsxs("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:`1px solid ${r.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{style:{fontSize:"12px",color:r.textMuted},children:"Annual Premium"}),t.jsxs("span",{style:{fontSize:"16px",fontWeight:"600",color:r.success},children:["$",(e.premium||e.annual_premium).toLocaleString()]})]})]})},Mo=({log:e,theme:r})=>{var o;return t.jsxs("div",{style:{padding:"14px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`,marginBottom:"8px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:r.text},children:((o=e.email_templates)==null?void 0:o.name)||"Direct Email"}),t.jsx("div",{style:{fontSize:"12px",color:r.textSecondary,marginTop:"2px"},children:e.subject})]}),t.jsx("div",{style:{textAlign:"right"},children:t.jsxs("div",{style:{fontSize:"11px",color:r.textMuted},children:[new Date(e.sent_at).toLocaleDateString()," at"," ",new Date(e.sent_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})})]}),t.jsxs("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:[t.jsx($e,{event:"sent",theme:r}),e.delivered_at&&t.jsx($e,{event:"delivered",theme:r}),e.opened_at&&t.jsx($e,{event:"opened",theme:r}),e.clicked_at&&t.jsx($e,{event:"clicked",theme:r}),e.bounced_at&&t.jsx($e,{event:"bounced",theme:r})]})]})},qo=({activity:e,theme:r})=>{const o={email_sent:"ðŸ“¤",email_opened:"ðŸ“¬",email_clicked:"ðŸ–±ï¸",enrollment_started:"â–¶ï¸",enrollment_completed:"âœ…",enrollment_paused:"â¸ï¸",note_added:"ðŸ“"};return t.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[t.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:r.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:o[e.action_type]||"ðŸ“Œ"}),t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"13px",color:r.text},children:e.description}),t.jsx("div",{style:{fontSize:"11px",color:r.textMuted,marginTop:"2px"},children:new Date(e.created_at).toLocaleString()})]})]})},ft=({enrollment:e,theme:r,userId:o})=>{var i;return t.jsxs("div",{style:{padding:"14px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`,marginBottom:"8px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx(Ce,{to:`/${o}/automations/${e.automation_id}`,style:{fontSize:"14px",fontWeight:"500",color:r.text,textDecoration:"none"},children:((i=e.automations)==null?void 0:i.name)||"Unknown Automation"}),t.jsxs("div",{style:{fontSize:"12px",color:r.textMuted,marginTop:"2px"},children:["Started ",new Date(e.enrolled_at).toLocaleDateString()]})]}),t.jsx(Dt,{status:e.status==="active"?"active":e.status,theme:r})]}),e.current_node_id&&t.jsxs("div",{style:{marginTop:"10px",padding:"8px 10px",backgroundColor:r.bgHover,borderRadius:"6px",fontSize:"12px",color:r.textSecondary},children:["ðŸ“ Current step: ",e.current_node_name||e.current_node_id]})]})},Wo=({t:e})=>{var R,W;const{userId:r,accountId:o}=de(),i=he(),[a,n]=C.useState("overview"),{data:s,isLoading:l,error:c}=xo(o),{data:d,isLoading:j}=so(a==="overview"||a==="emails"?o:null),{data:f,isLoading:p}=mo(a==="activity"?o:null),{data:v,isLoading:g}=ao(a==="overview"||a==="automations"?o:null),{data:m}=kt(),y={emailsSent:(d==null?void 0:d.length)||0,opened:(d==null?void 0:d.filter(b=>b.opened_at).length)||0,clicked:(d==null?void 0:d.filter(b=>b.clicked_at).length)||0,openRate:(d==null?void 0:d.length)>0?Math.round(d.filter(b=>b.opened_at).length/d.length*100):0,clickRate:(d==null?void 0:d.length)>0?Math.round(d.filter(b=>b.clicked_at).length/d.length*100):0,activeEnrollments:(v==null?void 0:v.filter(b=>b.status==="active").length)||0},h={openRate:(m==null?void 0:m.openRate)||25,clickRate:(m==null?void 0:m.clickRate)||5};if(l)return t.jsxs("div",{children:[t.jsx(_e,{width:"200px",height:"32px"}),t.jsx("div",{style:{marginTop:"20px"},children:t.jsx(_e,{height:"200px"})})]});if(c||!s)return t.jsxs("div",{style:{padding:"60px 20px",textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ˜•"}),t.jsx("h2",{style:{color:e.text,marginBottom:"8px"},children:"Account Not Found"}),t.jsx("p",{style:{color:e.textSecondary,marginBottom:"24px"},children:"We couldn't find the account you're looking for."}),t.jsx("button",{onClick:()=>i(`/${r}/accounts`),style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Accounts"})]});const w=[{id:"overview",label:"Overview"},{id:"emails",label:`Emails (${(d==null?void 0:d.length)||0})`},{id:"automations",label:`Automations (${(v==null?void 0:v.length)||0})`},{id:"activity",label:"Activity"}];return t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("button",{onClick:()=>i(`/${r}/accounts`),style:{background:"none",border:"none",color:e.textMuted,cursor:"pointer",fontSize:"14px",marginBottom:"12px",padding:0,display:"flex",alignItems:"center",gap:"6px"},children:"â† Back to Accounts"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:s.name}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(()=>{const b=(s.account_status||"").toLowerCase();let _=b;(b==="prior_customer"||b.startsWith("prior"))&&(_="prior"),b.startsWith("customer")&&(_="customer"),b.startsWith("prospect")&&(_="prospect"),b.startsWith("lead")&&(_="lead");const B={customer:{bg:`${e.success}20`,text:e.success,label:"Customer"},prospect:{bg:`${e.primary}20`,text:e.primary,label:"Prospect"},prior:{bg:`${e.textMuted}20`,text:e.textMuted,label:"Prior Customer"},lead:{bg:`${e.warning}20`,text:e.warning,label:"Lead"}},K=B[_]||B.prospect;return t.jsx("span",{style:{padding:"4px 10px",backgroundColor:K.bg,color:K.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:K.label})})(),s.account_unique_id&&t.jsxs("span",{style:{fontSize:"12px",color:e.textMuted},children:["ID: ",s.account_unique_id]})]})]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("button",{style:{padding:"10px 16px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:"ðŸ“ Add Note"}),t.jsx("button",{style:{padding:"10px 16px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"ðŸ“§ Send Email"})]})]})]}),t.jsxs("div",{style:{display:"flex",gap:"24px",padding:"16px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,marginBottom:"24px",flexWrap:"wrap"},children:[(s.person_email||s.email)&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ“§"}),t.jsx("a",{href:`mailto:${s.person_email||s.email}`,style:{color:e.primary,textDecoration:"none",fontSize:"14px"},children:s.person_email||s.email})]}),s.phone&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ“±"}),t.jsx("a",{href:`tel:${s.phone}`,style:{color:e.text,textDecoration:"none",fontSize:"14px"},children:s.phone})]}),(s.billing_street||s.billing_city||s.billing_state)&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ“"}),t.jsx("span",{style:{color:e.textSecondary,fontSize:"14px"},children:[s.billing_street,[s.billing_city,s.billing_state].filter(Boolean).join(", "),s.billing_postal_code].filter(Boolean).join(" â€¢ ")})]}),s.primary_contact_first_name&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ‘¤"}),t.jsxs("span",{style:{color:e.textSecondary,fontSize:"14px"},children:[s.primary_contact_first_name," ",s.primary_contact_last_name]})]})]}),t.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:e.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:w.map(b=>t.jsx("button",{onClick:()=>n(b.id),style:{padding:"10px 20px",backgroundColor:a===b.id?e.bgCard:"transparent",border:"none",borderRadius:"8px",color:a===b.id?e.text:e.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:b.label},b.id))}),a==="overview"&&t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,display:"flex",flexDirection:"column"},children:[t.jsxs("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px",flexShrink:0},children:["Policies (",((R=s.policies)==null?void 0:R.length)||0,")"]}),((W=s.policies)==null?void 0:W.length)>0?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto",flex:1,paddingRight:"8px"},children:s.policies.map((b,_)=>t.jsx(Bo,{policy:b,theme:e},_))}):t.jsx("div",{style:{padding:"30px",textAlign:"center",color:e.textMuted},children:"No policies on file"})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Email Engagement"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"20px"},children:[t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.primary},children:y.emailsSent}),t.jsx("div",{style:{fontSize:"11px",color:e.textMuted},children:"Sent"})]}),t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.success},children:y.opened}),t.jsx("div",{style:{fontSize:"11px",color:e.textMuted},children:"Opened"})]}),t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.warning},children:y.clicked}),t.jsx("div",{style:{fontSize:"11px",color:e.textMuted},children:"Clicked"})]}),t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.danger},children:(d==null?void 0:d.filter(b=>b.bounced_at).length)||0}),t.jsx("div",{style:{fontSize:"11px",color:e.textMuted},children:"Bounced"})]})]})]}),t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Compared to Average"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:e.textSecondary},children:"Open Rate"}),t.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:y.openRate>=h.openRate?e.success:e.danger},children:[y.openRate,"%",y.openRate>=h.openRate?" â†‘":" â†“"]})]}),t.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:e.bgHover,borderRadius:"4px",overflow:"hidden"},children:[t.jsx("div",{style:{position:"absolute",left:`${Math.min(h.openRate,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:e.textMuted,zIndex:2}}),t.jsx("div",{style:{width:`${Math.min(y.openRate,100)}%`,height:"100%",backgroundColor:y.openRate>=h.openRate?e.success:e.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[t.jsx("span",{style:{fontSize:"10px",color:e.textMuted},children:"0%"}),t.jsxs("span",{style:{fontSize:"10px",color:e.textMuted},children:["Avg: ",h.openRate,"%"]}),t.jsx("span",{style:{fontSize:"10px",color:e.textMuted},children:"100%"})]})]}),t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:e.textSecondary},children:"Click Rate"}),t.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:y.clickRate>=h.clickRate?e.success:e.danger},children:[y.clickRate,"%",y.clickRate>=h.clickRate?" â†‘":" â†“"]})]}),t.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:e.bgHover,borderRadius:"4px",overflow:"hidden"},children:[t.jsx("div",{style:{position:"absolute",left:`${Math.min(h.clickRate*5,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:e.textMuted,zIndex:2}}),t.jsx("div",{style:{width:`${Math.min(y.clickRate*5,100)}%`,height:"100%",backgroundColor:y.clickRate>=h.clickRate?e.success:e.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[t.jsx("span",{style:{fontSize:"10px",color:e.textMuted},children:"0%"}),t.jsxs("span",{style:{fontSize:"10px",color:e.textMuted},children:["Avg: ",h.clickRate,"%"]}),t.jsx("span",{style:{fontSize:"10px",color:e.textMuted},children:"20%+"})]})]}),t.jsxs("div",{style:{padding:"16px",backgroundColor:e.bg,borderRadius:"10px",textAlign:"center",marginTop:"8px"},children:[t.jsx("div",{style:{fontSize:"11px",color:e.textMuted,marginBottom:"4px"},children:"ENGAGEMENT SCORE"}),t.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:y.openRate>=h.openRate&&y.clickRate>=h.clickRate?e.success:y.openRate>=h.openRate||y.clickRate>=h.clickRate?e.warning:e.danger},children:y.emailsSent===0?"â€”":y.openRate>=h.openRate&&y.clickRate>=h.clickRate?"High":y.openRate>=h.openRate||y.clickRate>=h.clickRate?"Medium":"Low"}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary,marginTop:"4px"},children:y.emailsSent===0?"No emails sent yet":y.openRate>=h.openRate?"Above average engagement":"Below average engagement"})]})]})]}),t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Active Automations"}),(v==null?void 0:v.filter(b=>b.status==="active").length)>0?v.filter(b=>b.status==="active").map(b=>t.jsx(ft,{enrollment:b,theme:e,userId:r},b.id)):t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted,fontSize:"13px"},children:"Not enrolled in any automations"})]})]})]}),a==="emails"&&t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Email History"}),j?Array.from({length:3}).map((b,_)=>t.jsx("div",{style:{marginBottom:"12px"},children:t.jsx(_e,{height:"80px"})},_)):(d==null?void 0:d.length)>0?d.map(b=>t.jsx(Mo,{log:b,theme:e},b.id)):t.jsx("div",{style:{padding:"40px",textAlign:"center",color:e.textMuted},children:"No emails sent to this client yet"})]}),a==="automations"&&t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,margin:0},children:"Automation Enrollments"}),t.jsx("button",{style:{padding:"8px 12px",backgroundColor:e.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:"+ Enroll in Automation"})]}),g?Array.from({length:2}).map((b,_)=>t.jsx("div",{style:{marginBottom:"12px"},children:t.jsx(_e,{height:"60px"})},_)):(v==null?void 0:v.length)>0?v.map(b=>t.jsx(ft,{enrollment:b,theme:e,userId:r},b.id)):t.jsx("div",{style:{padding:"40px",textAlign:"center",color:e.textMuted},children:"Not enrolled in any automations"})]}),a==="activity"&&t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Activity Timeline"}),p?Array.from({length:5}).map((b,_)=>t.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[t.jsx(_e,{width:"32px",height:"32px"}),t.jsxs("div",{style:{flex:1},children:[t.jsx(_e,{width:"80%",height:"14px"}),t.jsx("div",{style:{marginTop:"4px"},children:t.jsx(_e,{width:"120px",height:"12px"})})]})]},_)):(f==null?void 0:f.length)>0?t.jsx("div",{style:{borderLeft:`2px solid ${e.border}`,marginLeft:"15px",paddingLeft:"20px"},children:f.map(b=>t.jsx(qo,{activity:b,theme:e},b.id))}):t.jsx("div",{style:{padding:"40px",textAlign:"center",color:e.textMuted},children:"No activity recorded yet"})]})]})},Tt=({status:e,theme:r})=>{const o={verified:{bg:`${r.success}20`,color:r.success,label:"Verified"},pending:{bg:`${r.warning}20`,color:r.warning,label:"Pending DNS"},failed:{bg:`${r.danger}20`,color:r.danger,label:"Failed"}},i=o[e]||o.pending;return t.jsx("span",{style:{padding:"4px 10px",backgroundColor:i.bg,color:i.color,borderRadius:"20px",fontSize:"11px",fontWeight:"500"},children:i.label})},rt=({record:e,theme:r})=>{const[o,i]=C.useState(!1),a=n=>{navigator.clipboard.writeText(n),i(!0),setTimeout(()=>i(!1),2e3)};return t.jsxs("div",{style:{padding:"12px",backgroundColor:r.bg,borderRadius:"8px",marginBottom:"8px",border:`1px solid ${e.valid?r.success:r.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[t.jsxs("span",{style:{fontSize:"11px",fontWeight:"600",color:r.textSecondary,textTransform:"uppercase"},children:[e.type," Record"]}),e.valid?t.jsx("span",{style:{color:r.success,fontSize:"12px"},children:"Valid"}):t.jsx("span",{style:{color:r.warning,fontSize:"12px"},children:"Not verified"})]}),t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("div",{style:{fontSize:"11px",color:r.textMuted,marginBottom:"2px"},children:"Host / Name:"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",backgroundColor:r.bgCard,padding:"8px 12px",borderRadius:"6px"},children:[t.jsx("code",{style:{fontSize:"12px",color:r.text,flex:1,wordBreak:"break-all"},children:e.host}),t.jsx("button",{onClick:()=>a(e.host),style:{padding:"4px 8px",backgroundColor:"transparent",border:`1px solid ${r.border}`,borderRadius:"4px",color:r.textSecondary,cursor:"pointer",fontSize:"11px"},children:o?"Copied!":"Copy"})]})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"11px",color:r.textMuted,marginBottom:"2px"},children:"Value / Points to:"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",backgroundColor:r.bgCard,padding:"8px 12px",borderRadius:"6px"},children:[t.jsx("code",{style:{fontSize:"12px",color:r.text,flex:1,wordBreak:"break-all"},children:e.data}),t.jsx("button",{onClick:()=>a(e.data),style:{padding:"4px 8px",backgroundColor:"transparent",border:`1px solid ${r.border}`,borderRadius:"4px",color:r.textSecondary,cursor:"pointer",fontSize:"11px"},children:"Copy"})]})]}),e.reason&&!e.valid&&t.jsx("div",{style:{marginTop:"8px",padding:"8px",backgroundColor:`${r.warning}10`,borderRadius:"4px",fontSize:"11px",color:r.warning},children:e.reason})]})},Eo=({isOpen:e,onClose:r,onAdd:o,theme:i})=>{const[a,n]=C.useState(""),[s,l]=C.useState(!1),[c,d]=C.useState(null),j=async f=>{f.preventDefault(),l(!0),d(null);try{await o(a,{subdomain:"mail"}),n(""),r()}catch(p){d(p.message)}finally{l(!1)}};return e?t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:t.jsxs("div",{style:{backgroundColor:i.bgCard,borderRadius:"12px",padding:"24px",width:"100%",maxWidth:"500px",boxShadow:"0 20px 40px rgba(0,0,0,0.3)"},children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:i.text,marginBottom:"16px"},children:"Add Sender Domain"}),t.jsxs("form",{onSubmit:j,children:[t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:i.text,display:"block",marginBottom:"6px"},children:"Domain"}),t.jsx("input",{type:"text",value:a,onChange:f=>n(f.target.value),placeholder:"youragency.com",required:!0,style:{width:"100%",padding:"12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px"}}),t.jsx("p",{style:{fontSize:"11px",color:i.textMuted,marginTop:"4px"},children:"Enter your agency's domain (without www or https)"})]}),c&&t.jsx("div",{style:{padding:"12px",backgroundColor:`${i.danger}15`,border:`1px solid ${i.danger}30`,borderRadius:"8px",marginBottom:"16px",color:i.danger,fontSize:"13px"},children:c}),t.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[t.jsx("button",{type:"button",onClick:r,style:{padding:"10px 20px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),t.jsx("button",{type:"submit",disabled:s||!a,style:{padding:"10px 20px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:s?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:s||!a?.7:1},children:s?"Adding...":"Add Domain"})]})]})]})}):null},Lo=({domain:e,onVerify:r,onDelete:o,isVerifying:i,theme:a})=>{const[n,s]=C.useState(!1),l=e.dns_records||{};return t.jsxs("div",{style:{padding:"20px",backgroundColor:a.bgCard,borderRadius:"12px",border:`1px solid ${a.border}`,marginTop:"16px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"20px"},children:[t.jsxs("div",{children:[t.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:a.text,marginBottom:"4px"},children:e.domain}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx(Tt,{status:e.status,theme:a}),e.verified_at&&t.jsxs("span",{style:{fontSize:"12px",color:a.textMuted},children:["Verified ",new Date(e.verified_at).toLocaleDateString()]})]})]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.status!=="verified"&&t.jsx("button",{onClick:()=>r(e.id),disabled:i,style:{padding:"8px 16px",backgroundColor:a.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:i?"wait":"pointer",fontSize:"13px",fontWeight:"500",opacity:i?.7:1},children:i?"Verifying...":"Verify DNS"}),t.jsx("button",{onClick:()=>s(!0),style:{padding:"8px 16px",backgroundColor:"transparent",border:`1px solid ${a.danger}`,borderRadius:"6px",color:a.danger,cursor:"pointer",fontSize:"13px"},children:"Remove"})]})]}),e.status!=="verified"&&t.jsxs("div",{style:{padding:"16px",backgroundColor:`${a.primary}10`,borderRadius:"8px",marginBottom:"20px"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:a.text,marginBottom:"8px"},children:"Setup Instructions"}),t.jsxs("ol",{style:{margin:0,paddingLeft:"20px",color:a.textSecondary,fontSize:"13px",lineHeight:"1.6"},children:[t.jsx("li",{children:"Log in to your domain registrar (GoDaddy, Namecheap, Cloudflare, etc.)"}),t.jsxs("li",{children:["Navigate to DNS settings for ",t.jsx("strong",{children:e.domain})]}),t.jsx("li",{children:"Add the CNAME records shown below"}),t.jsx("li",{children:"Wait 5-10 minutes for DNS propagation"}),t.jsx("li",{children:'Click "Verify DNS" to confirm setup'})]})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:a.text,marginBottom:"12px"},children:"Required DNS Records"}),l.mail_cname&&t.jsx(rt,{record:{...l.mail_cname,type:"CNAME"},theme:a}),l.dkim1&&t.jsx(rt,{record:{...l.dkim1,type:"CNAME"},theme:a}),l.dkim2&&t.jsx(rt,{record:{...l.dkim2,type:"CNAME"},theme:a}),!l.mail_cname&&!l.dkim1&&!l.dkim2&&t.jsx("div",{style:{color:a.textMuted,fontSize:"13px",fontStyle:"italic"},children:"DNS records will appear here after domain is added"})]}),e.status==="verified"&&t.jsxs("div",{style:{padding:"16px",backgroundColor:a.bg,borderRadius:"8px",marginTop:"16px"},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:a.text,marginBottom:"8px"},children:"Default Sender Settings"}),t.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:[t.jsxs("div",{children:["From Email: ",t.jsx("strong",{children:e.default_from_email||`noreply@${e.domain}`})]}),e.default_from_name&&t.jsxs("div",{children:["From Name: ",t.jsx("strong",{children:e.default_from_name})]})]})]}),n&&t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:t.jsxs("div",{style:{backgroundColor:a.bgCard,borderRadius:"12px",padding:"24px",maxWidth:"400px"},children:[t.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:a.text,marginBottom:"12px"},children:"Remove Domain?"}),t.jsxs("p",{style:{fontSize:"14px",color:a.textSecondary,marginBottom:"20px"},children:["This will remove ",t.jsx("strong",{children:e.domain})," from your account. You won't be able to send emails from this domain."]}),t.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[t.jsx("button",{onClick:()=>s(!1),style:{padding:"10px 20px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),t.jsx("button",{onClick:()=>{o(e.id),s(!1)},style:{padding:"10px 20px",backgroundColor:a.danger,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Remove Domain"})]})]})})]})},Po=({theme:e})=>{const[r,o]=C.useState([]),[i,a]=C.useState(!0),[n,s]=C.useState(null),[l,c]=C.useState(!1),[d,j]=C.useState(null),[f,p]=C.useState(null);C.useEffect(()=>{v()},[]);const v=async()=>{a(!0),s(null);try{const w=await De.getAll();o(w)}catch(w){s(w.message)}finally{a(!1)}},g=async(w,R)=>{const W=await De.addDomain(w,R);o(b=>[W,...b]),j(W.id)},m=async w=>{p(w);try{const R=await De.verifyDomain(w);o(W=>W.map(b=>b.id===w?R.domain:b)),R.valid}catch(R){s(R.message)}finally{p(null)}},y=async w=>{try{await De.deleteDomain(w),o(R=>R.filter(W=>W.id!==w)),d===w&&j(null)}catch(R){s(R.message)}},h=r.find(w=>w.id===d);return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Sender Domains"}),t.jsx("p",{style:{fontSize:"13px",color:e.textSecondary},children:"Configure your agency's sending domains for email delivery"})]}),t.jsx("button",{onClick:()=>c(!0),style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"+ Add Domain"})]}),n&&t.jsxs("div",{style:{padding:"12px 16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"16px",color:e.danger,fontSize:"13px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n,t.jsx("button",{onClick:()=>s(null),style:{backgroundColor:"transparent",border:"none",color:e.danger,cursor:"pointer",fontSize:"18px"},children:"x"})]}),i?t.jsx("div",{style:{padding:"40px",textAlign:"center",color:e.textSecondary},children:"Loading domains..."}):r.length===0?t.jsxs("div",{style:{padding:"40px",textAlign:"center",backgroundColor:e.bg,borderRadius:"12px",border:`1px dashed ${e.border}`},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:"@"}),t.jsx("div",{style:{fontSize:"16px",fontWeight:"500",color:e.text,marginBottom:"8px"},children:"No sender domains configured"}),t.jsx("div",{style:{fontSize:"13px",color:e.textSecondary,marginBottom:"20px"},children:"Add your agency's domain to start sending emails from your own address"}),t.jsx("button",{onClick:()=>c(!0),style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Add Your First Domain"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{backgroundColor:e.bg,borderRadius:"12px",border:`1px solid ${e.border}`,overflow:"hidden"},children:r.map((w,R)=>t.jsxs("div",{onClick:()=>j(d===w.id?null:w.id),style:{padding:"16px 20px",borderBottom:R<r.length-1?`1px solid ${e.border}`:"none",cursor:"pointer",backgroundColor:d===w.id?e.bgHover:"transparent",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",backgroundColor:w.status==="verified"?`${e.success}20`:`${e.warning}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px"},children:w.status==="verified"?"@":"..."}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"500",color:e.text},children:w.domain}),t.jsx("div",{style:{fontSize:"12px",color:e.textMuted},children:w.default_from_email||`noreply@${w.domain}`})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx(Tt,{status:w.status,theme:e}),t.jsx("span",{style:{color:e.textMuted,fontSize:"18px",transform:d===w.id?"rotate(180deg)":"none",transition:"transform 0.2s"},children:"v"})]})]},w.id))}),h&&t.jsx(Lo,{domain:h,onVerify:m,onDelete:y,isVerifying:f===h.id,theme:e})]}),t.jsx(Eo,{isOpen:l,onClose:()=>c(!1),onAdd:g,theme:e})]})},nt=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),pe=({label:e,value:r,onChange:o,placeholder:i,type:a="text",disabled:n,hint:s,theme:l})=>t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:e}),t.jsx("input",{type:a,value:r||"",onChange:c=>o(c.target.value),placeholder:i,disabled:n,style:{width:"100%",padding:"12px",backgroundColor:n?l.bgHover:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px",opacity:n?.6:1}}),s&&t.jsx("p",{style:{fontSize:"11px",color:l.textMuted,marginTop:"4px"},children:s})]}),Oo=({label:e,value:r,onChange:o,placeholder:i,rows:a=3,disabled:n,theme:s})=>t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:s.text,display:"block",marginBottom:"6px"},children:e}),t.jsx("textarea",{value:r||"",onChange:l=>o(l.target.value),placeholder:i,rows:a,disabled:n,style:{width:"100%",padding:"12px",backgroundColor:n?s.bgHover:s.bgInput,border:`1px solid ${s.border}`,borderRadius:"8px",color:s.text,fontSize:"14px",resize:"vertical",opacity:n?.6:1}})]}),Fo=({settings:e,theme:r})=>t.jsxs("div",{style:{padding:"16px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`},children:[(e==null?void 0:e.full_name)&&t.jsx("div",{style:{fontWeight:"600",color:r.text},children:e.full_name}),(e==null?void 0:e.job_title)&&t.jsx("div",{style:{color:r.textSecondary,fontSize:"14px"},children:e.job_title}),t.jsx("div",{style:{color:r.textSecondary,fontSize:"14px",marginTop:"4px"},children:[e==null?void 0:e.phone,e==null?void 0:e.email].filter(Boolean).join(" Â· ")}),(e==null?void 0:e.custom_message)&&t.jsx("div",{style:{color:r.textMuted,fontSize:"14px",fontStyle:"italic",marginTop:"8px"},children:e.custom_message}),!(e!=null&&e.full_name)&&!(e!=null&&e.job_title)&&t.jsx("div",{style:{color:r.textMuted,fontSize:"14px"},children:"Fill in your details to see a preview"})]}),No=({t:e})=>{const{userId:r}=de(),[o,i]=C.useState("signature"),[a,n]=C.useState(!1),[s,l]=C.useState(null),{data:c,isLoading:d,error:j}=co(),{updateSettings:f,updateSignature:p}=po(),[v,g]=C.useState({full_name:"",job_title:"",phone:"",email:"",custom_message:"",agency_name:"",agency_address:"",agency_phone:"",agency_website:"",default_from_name:"",default_from_email:"",reply_to_email:"",sending_domain:""});C.useEffect(()=>{c&&g({full_name:c.full_name||"",job_title:c.job_title||"",phone:c.phone||"",email:c.email||"",custom_message:c.custom_message||"",agency_name:c.agency_name||"",agency_address:c.agency_address||"",agency_phone:c.agency_phone||"",agency_website:c.agency_website||"",default_from_name:c.default_from_name||"",default_from_email:c.default_from_email||"",reply_to_email:c.reply_to_email||"",sending_domain:c.sending_domain||""})},[c]);const m=R=>W=>{g(b=>({...b,[R]:W})),l(null)},y=async()=>{n(!0),l(null);try{await p.mutateAsync({full_name:v.full_name,job_title:v.job_title,phone:v.phone,email:v.email,custom_message:v.custom_message}),l({type:"success",text:"Signature saved successfully!"})}catch{l({type:"error",text:"Failed to save signature. Please try again."})}finally{n(!1)}},h=async()=>{n(!0),l(null);try{await f.mutateAsync(v),l({type:"success",text:"Settings saved successfully!"})}catch{l({type:"error",text:"Failed to save settings. Please try again."})}finally{n(!1)}},w=[{id:"signature",label:"Email Signature",icon:"ðŸ‘¤"},{id:"agency",label:"Agency Info",icon:"ðŸ¢"},{id:"domains",label:"Sender Domains",icon:"@"},{id:"email",label:"Email Settings",icon:"ðŸ“§"},{id:"integrations",label:"Integrations",icon:"ðŸ”—"}];return t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Settings"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Manage your email preferences and configuration"})]}),j&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load settings. Please try refreshing the page."}),s&&t.jsx("div",{style:{padding:"12px 16px",backgroundColor:s.type==="success"?`${e.success}15`:`${e.danger}15`,border:`1px solid ${s.type==="success"?e.success:e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:s.type==="success"?e.success:e.danger,fontSize:"14px"},children:s.text}),t.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:e.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:w.map(R=>t.jsxs("button",{onClick:()=>i(R.id),style:{padding:"10px 20px",backgroundColor:o===R.id?e.bgCard:"transparent",border:"none",borderRadius:"8px",color:o===R.id?e.text:e.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[R.icon," ",R.label]},R.id))}),d?t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx(nt,{width:"200px",height:"24px"}),t.jsx("div",{style:{marginTop:"24px"},children:t.jsx(nt,{height:"40px"})}),t.jsx("div",{style:{marginTop:"16px"},children:t.jsx(nt,{height:"40px"})})]}):t.jsxs(t.Fragment,{children:[o==="signature"&&t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Your Email Signature"}),t.jsx("p",{style:{fontSize:"13px",color:e.textSecondary,marginBottom:"24px"},children:"This signature will be automatically added to all emails you send through the platform"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[t.jsx(pe,{label:"Full Name",value:v.full_name,onChange:m("full_name"),placeholder:"John Doe",theme:e}),t.jsx(pe,{label:"Job Title",value:v.job_title,onChange:m("job_title"),placeholder:"Insurance Advisor",theme:e}),t.jsx(pe,{label:"Phone Number",value:v.phone,onChange:m("phone"),placeholder:"(555) 123-4567",theme:e}),t.jsx(pe,{label:"Email Address",value:v.email,onChange:m("email"),placeholder:"john.doe@company.com",type:"email",theme:e})]}),t.jsx(Oo,{label:"Custom Message (Optional)",value:v.custom_message,onChange:m("custom_message"),placeholder:"Looking forward to serving you!",theme:e}),t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:e.text,display:"block",marginBottom:"8px"},children:"Preview"}),t.jsx(Fo,{settings:v,theme:e})]}),t.jsx("button",{onClick:y,disabled:a,style:{padding:"12px 24px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:a?"wait":"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px",opacity:a?.7:1},children:a?"ðŸ’¾ Saving...":"ðŸ’¾ Save Signature"})]}),o==="agency"&&t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Agency Information"}),t.jsx("p",{style:{fontSize:"13px",color:e.textSecondary,marginBottom:"24px"},children:"Your agency details used in email templates and footers"}),t.jsx(pe,{label:"Agency Name",value:v.agency_name,onChange:m("agency_name"),placeholder:"Insurance Solutions Group",theme:e}),t.jsx(pe,{label:"Address",value:v.agency_address,onChange:m("agency_address"),placeholder:"123 Main Street, Suite 100, Dallas, TX 75201",theme:e}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[t.jsx(pe,{label:"Phone",value:v.agency_phone,onChange:m("agency_phone"),placeholder:"(555) 000-0000",theme:e}),t.jsx(pe,{label:"Website",value:v.agency_website,onChange:m("agency_website"),placeholder:"https://www.example.com",theme:e})]}),t.jsx("button",{onClick:h,disabled:a,style:{padding:"12px 24px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:a?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:a?.7:1},children:a?"ðŸ’¾ Saving...":"ðŸ’¾ Save Agency Info"})]}),o==="domains"&&t.jsx("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:t.jsx(Po,{theme:e})}),o==="email"&&t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Email Configuration"}),t.jsx("p",{style:{fontSize:"13px",color:e.textSecondary},children:"Configure your sending domain and default email settings"})]}),t.jsx("span",{style:{padding:"4px 10px",backgroundColor:e.bgHover,borderRadius:"20px",fontSize:"11px",color:e.textSecondary},children:"Admin Only"})]}),t.jsx(pe,{label:"Sending Domain",value:v.sending_domain,onChange:m("sending_domain"),placeholder:"emails.yourcompany.com",hint:"The domain that will be used to send emails. Must be verified in SendGrid.",theme:e}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[t.jsx(pe,{label:"Default From Name",value:v.default_from_name,onChange:m("default_from_name"),placeholder:"Your Company",theme:e}),t.jsx(pe,{label:"Default From Email",value:v.default_from_email,onChange:m("default_from_email"),placeholder:"noreply@yourcompany.com",type:"email",theme:e})]}),t.jsx(pe,{label:"Reply-To Email",value:v.reply_to_email,onChange:m("reply_to_email"),placeholder:"support@yourcompany.com",type:"email",hint:"Where replies will be directed when recipients respond to automated emails.",theme:e}),t.jsx("button",{onClick:h,disabled:a,style:{padding:"12px 24px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:a?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:a?.7:1},children:a?"ðŸ’¾ Saving...":"ðŸ’¾ Save Configuration"})]}),o==="integrations"&&t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"24px"},children:"Integrations"}),t.jsx("div",{style:{padding:"20px",backgroundColor:e.bg,borderRadius:"10px",border:`1px solid ${e.border}`,marginBottom:"16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[t.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#1A82E2",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SG"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"600",color:e.text,marginBottom:"2px"},children:"SendGrid"}),t.jsx("div",{style:{fontSize:"13px",color:e.textSecondary},children:"Email delivery service"})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${e.success}20`,color:e.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),t.jsx("button",{style:{padding:"8px 12px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"6px",color:e.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Configure"})]})]})}),t.jsx("div",{style:{padding:"20px",backgroundColor:e.bg,borderRadius:"10px",border:`1px solid ${e.border}`,marginBottom:"16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[t.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#00A1E0",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SF"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"600",color:e.text,marginBottom:"2px"},children:"Salesforce"}),t.jsx("div",{style:{fontSize:"13px",color:e.textSecondary},children:"CRM data sync"})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${e.success}20`,color:e.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),t.jsx("button",{style:{padding:"8px 12px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"6px",color:e.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Sync Now"})]})]})}),t.jsxs("div",{style:{padding:"16px",backgroundColor:`${e.primary}10`,borderRadius:"8px",marginTop:"24px"},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:e.text,marginBottom:"4px"},children:"ðŸ“Œ Webhook URL"}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary,marginBottom:"8px"},children:"Configure this URL in SendGrid to receive email event notifications"}),t.jsxs("code",{style:{display:"block",padding:"8px 12px",backgroundColor:e.bgCard,borderRadius:"6px",fontSize:"12px",color:e.primary,wordBreak:"break-all"},children:["https://your-app-url.com/api/webhooks/sendgrid/",r]})]})]})]})]})},lt=[{value:"account_status",label:"Account Status",type:"select",options:[{value:"customer",label:"Customer"},{value:"prospect",label:"Prospect"},{value:"prior_customer",label:"Prior Customer"},{value:"lead",label:"Lead"}]},{value:"policy_type",label:"Policy Type",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"active_policy_type",label:"Has Active Policy",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"policy_status",label:"Policy Status",type:"select",options:[{value:"active",label:"Active"},{value:"pending active",label:"Pending Active"},{value:"cancelled",label:"Cancelled"},{value:"expired",label:"Expired"}]},{value:"policy_class",label:"Policy Class",type:"select",options:[{value:"Personal",label:"Personal"},{value:"Commercial",label:"Commercial"}]},{value:"policy_count",label:"Number of Policies",type:"number"},{value:"policy_term",label:"Policy Term",type:"select",options:[{value:"6",label:"6 Months"},{value:"12",label:"12 Months"}]},{value:"policy_effective",label:"Policy Effective Date",type:"date"},{value:"policy_expiration",label:"Policy Expiration",type:"date"},{value:"state",label:"State",type:"select",options:[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}]},{value:"city",label:"City",type:"text"},{value:"zip_code",label:"ZIP Code",type:"text"},{value:"email_domain",label:"Email Domain",type:"text"},{value:"last_email_sent",label:"Last Email Sent",type:"date"},{value:"account_created",label:"Account Created",type:"date"}],Bt={select:[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"is_any",label:"is any of"},{value:"is_not_any",label:"is not any of"}],number:[{value:"equals",label:"equals"},{value:"greater_than",label:"greater than"},{value:"less_than",label:"less than"},{value:"at_least",label:"at least"},{value:"at_most",label:"at most"},{value:"between",label:"is between"}],date:[{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"between",label:"is between"},{value:"in_next_days",label:"is in the next"},{value:"in_last_days",label:"was in the last"},{value:"more_than_days_future",label:"is more than X days from now"},{value:"less_than_days_future",label:"is less than X days from now"},{value:"more_than_days_ago",label:"was more than X days ago"},{value:"less_than_days_ago",label:"was less than X days ago"}],text:[{value:"contains",label:"contains"},{value:"not_contains",label:"does not contain"},{value:"equals",label:"equals"},{value:"not_equals",label:"does not equal"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"},{value:"is_empty",label:"is empty"},{value:"is_not_empty",label:"is not empty"}]},Ho=[{label:"Renewals (30 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"30"}},{label:"Renewals (60 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"60"}},{label:"Renewals (90 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"90"}},{label:"New Customers (90 days)",filter:{field:"account_created",operator:"in_last_days",value:"90"}},{label:"Active Customers",filter:{field:"account_status",operator:"is",value:"customer"}},{label:"Cross-Sell: Auto Only",filters:[{field:"active_policy_type",operator:"is",value:"Auto"},{field:"active_policy_type",operator:"is_not",value:"Home"}]},{label:"Cross-Sell: Home Only",filters:[{field:"active_policy_type",operator:"is",value:"Home"},{field:"active_policy_type",operator:"is_not",value:"Auto"}]},{label:"Prior Customers",filter:{field:"account_status",operator:"is",value:"prior_customer"}},{label:"Prospects",filter:{field:"account_status",operator:"is",value:"prospect"}}],Uo=(e,r)=>{const i=(Bt[e]||[]).find(a=>a.value===r);return(i==null?void 0:i.label)||r},mt=e=>{const r=lt.find(n=>n.value===e.field);if(!r)return null;const o=r.label,i=Uo(r.type,e.operator);let a=e.value;if(r.type==="select"&&r.options)if(e.operator==="is_any"||e.operator==="is_not_any")a=(e.value||"").split(",").map(s=>{const l=r.options.find(c=>c.value===s);return(l==null?void 0:l.label)||s}).join(", ");else{const n=r.options.find(s=>s.value===e.value);a=(n==null?void 0:n.label)||e.value}return e.operator==="is_empty"||e.operator==="is_not_empty"?`${o} ${i}`:e.operator==="between"&&e.value2?`${o} ${i} ${e.value} and ${e.value2}`:e.operator==="in_next_days"||e.operator==="in_last_days"?`${o} ${i} ${e.value} days`:e.operator==="more_than_days_future"?`${o} is more than ${e.value} days from now`:e.operator==="less_than_days_future"?`${o} is less than ${e.value} days from now`:e.operator==="more_than_days_ago"?`${o} was more than ${e.value} days ago`:e.operator==="less_than_days_ago"?`${o} was less than ${e.value} days ago`:`${o} ${i} ${a}`},Go=({rule:e,index:r,onUpdate:o,onRemove:i,theme:a})=>{const n=lt.find(d=>d.value===e.field),s=n?Bt[n.type]:[],l={padding:"8px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"6px",color:a.text,fontSize:"13px",minWidth:"140px"},c={padding:"8px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"6px",color:a.text,fontSize:"13px",width:"120px"};return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:a.bgCard,borderRadius:"8px",border:`1px solid ${a.border}`,flexWrap:"wrap"},children:[r>0&&t.jsx("span",{style:{fontSize:"12px",color:a.primary,fontWeight:"600",padding:"4px 8px",backgroundColor:`${a.primary}15`,borderRadius:"4px"},children:"AND"}),t.jsxs("select",{value:e.field||"",onChange:d=>o(r,{...e,field:d.target.value,operator:"",value:""}),style:l,children:[t.jsx("option",{value:"",children:"Select field..."}),lt.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))]}),e.field&&t.jsxs("select",{value:e.operator||"",onChange:d=>o(r,{...e,operator:d.target.value}),style:l,children:[t.jsx("option",{value:"",children:"Select condition..."}),s.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))]}),e.field&&e.operator&&t.jsxs(t.Fragment,{children:[(n==null?void 0:n.type)==="select"&&!["is_any","is_not_any"].includes(e.operator)&&t.jsxs("select",{value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),style:l,children:[t.jsx("option",{value:"",children:"Select value..."}),n.options.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))]}),(n==null?void 0:n.type)==="select"&&["is_any","is_not_any"].includes(e.operator)&&t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:n.options.map(d=>t.jsx("button",{onClick:()=>{const j=e.value?e.value.split(","):[],f=j.includes(d.value)?j.filter(p=>p!==d.value):[...j,d.value];o(r,{...e,value:f.join(",")})},style:{padding:"4px 10px",backgroundColor:(e.value||"").split(",").includes(d.value)?a.primary:a.bgHover,color:(e.value||"").split(",").includes(d.value)?"#fff":a.text,border:`1px solid ${(e.value||"").split(",").includes(d.value)?a.primary:a.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:d.label},d.value))}),(n==null?void 0:n.type)==="number"&&e.operator!=="between"&&t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"0",style:c}),(n==null?void 0:n.type)==="number"&&e.operator==="between"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"Min",style:{...c,width:"80px"}}),t.jsx("span",{style:{fontSize:"13px",color:a.textSecondary},children:"and"}),t.jsx("input",{type:"number",value:e.value2||"",onChange:d=>o(r,{...e,value2:d.target.value}),placeholder:"Max",style:{...c,width:"80px"}})]}),(n==null?void 0:n.type)==="date"&&e.operator==="in_next_days"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"30",style:{...c,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:a.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&e.operator==="in_last_days"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"30",style:{...c,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:a.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&e.operator==="between"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"date",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),style:c}),t.jsx("span",{style:{fontSize:"13px",color:a.textSecondary},children:"and"}),t.jsx("input",{type:"date",value:e.value2||"",onChange:d=>o(r,{...e,value2:d.target.value}),style:c})]}),(n==null?void 0:n.type)==="date"&&(e.operator==="before"||e.operator==="after")&&t.jsx("input",{type:"date",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),style:c}),(n==null?void 0:n.type)==="date"&&["more_than_days_future","less_than_days_future","more_than_days_ago","less_than_days_ago"].includes(e.operator)&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"30",min:"1",style:{...c,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:a.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="text"&&!["is_empty","is_not_empty"].includes(e.operator)&&t.jsx("input",{type:"text",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:`Enter ${n.label.toLowerCase()}...`,style:{...c,width:"160px"}})]}),t.jsx("button",{onClick:()=>i(r),style:{marginLeft:"auto",padding:"6px 10px",backgroundColor:"transparent",border:"none",color:a.textMuted,cursor:"pointer",fontSize:"16px",borderRadius:"4px"},title:"Remove filter",children:"Ã—"})]})},Vo=({group:e,groupIndex:r,onRemoveGroup:o,onDuplicateGroup:i,onAddRule:a,onUpdateRule:n,onRemoveRule:s,theme:l})=>{const c=e.rules||[];return t.jsxs("div",{style:{padding:"16px",backgroundColor:l.bgCard,borderRadius:"12px",border:`2px solid ${l.border}`,position:"relative"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[t.jsxs("span",{style:{fontSize:"12px",fontWeight:"600",color:l.textSecondary,textTransform:"uppercase",letterSpacing:"0.5px"},children:["Group ",r+1]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i&&t.jsxs("button",{onClick:()=>i(r),style:{padding:"4px 8px",backgroundColor:"transparent",border:`1px solid ${l.border}`,color:l.textSecondary,cursor:"pointer",fontSize:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"4px"},title:"Duplicate group",children:[t.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),t.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),"Duplicate"]}),t.jsx("button",{onClick:()=>o(r),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:l.textMuted,cursor:"pointer",fontSize:"12px",borderRadius:"4px"},title:"Remove group",children:"Remove"})]})]}),c.length===0?t.jsx("div",{style:{textAlign:"center",padding:"12px",color:l.textMuted,fontSize:"13px"},children:"Add filters to this group"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:c.map((d,j)=>t.jsx(Go,{rule:d,index:j,onUpdate:(f,p)=>n(r,f,p),onRemove:f=>s(r,f),theme:l},j))}),t.jsxs("button",{onClick:()=>a(r),style:{width:"100%",padding:"8px",backgroundColor:l.bgHover,border:`1px dashed ${l.border}`,borderRadius:"6px",color:l.primary,cursor:"pointer",fontSize:"12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[t.jsx("span",{children:"+"})," Add Filter to Group"]})]})},Ko=({groups:e,onApplyFilter:r,theme:o,filters:i=Ho})=>t.jsxs("div",{style:{padding:"16px",backgroundColor:o.bgCard,borderRadius:"12px",border:`1px solid ${o.border}`,marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:o.textSecondary,marginBottom:"10px"},children:"Quick Filters"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:i.map((a,n)=>t.jsxs("button",{onClick:()=>r(a),style:{padding:"6px 12px",backgroundColor:o.bgHover,border:`1px solid ${o.border}`,borderRadius:"16px",color:o.text,cursor:"pointer",fontSize:"12px",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:s=>{s.target.style.backgroundColor=o.primary+"20",s.target.style.borderColor=o.primary,s.target.style.color=o.primary},onMouseLeave:s=>{s.target.style.backgroundColor=o.bgHover,s.target.style.borderColor=o.border,s.target.style.color=o.text},children:["+ ",a.label]},n))})]}),Qo=({filterConfig:e,setFilterConfig:r,recipientCount:o,isLoading:i,onPreviewClick:a,showQuickFilters:n=!0,theme:s})=>{var w;const l=(e==null?void 0:e.groups)||(((w=e==null?void 0:e.rules)==null?void 0:w.length)>0?[{rules:e.rules}]:[]),c=l.length>0,d=()=>{const R=[...l,{rules:[{field:"",operator:"",value:""}]}];r({...e,groups:R,rules:void 0})},j=R=>{const W=l.filter((b,_)=>_!==R);r({...e,groups:W,rules:void 0})},f=R=>{const b={rules:(l[R].rules||[]).map(B=>({...B}))},_=[...l];_.splice(R+1,0,b),r({...e,groups:_,rules:void 0})},p=R=>{const W=[...l];W[R]={...W[R],rules:[...W[R].rules||[],{field:"",operator:"",value:""}]},r({...e,groups:W,rules:void 0})},v=(R,W,b)=>{const _=[...l],B=[..._[R].rules||[]];B[W]=b,_[R]={..._[R],rules:B},r({...e,groups:_,rules:void 0})},g=(R,W)=>{const b=[...l];b[R]={...b[R],rules:b[R].rules.filter((_,B)=>B!==W)},b[R].rules.length===0&&b.splice(R,1),r({...e,groups:b,rules:void 0})},m=()=>{r({...e,groups:[],rules:void 0})},y=R=>{if(R.filters){const W={rules:R.filters};r({...e,groups:[...l,W],rules:void 0})}else{const W={rules:[R.filter]};r({...e,groups:[...l,W],rules:void 0})}},h=l.reduce((R,W)=>R+(W.rules||[]).filter(b=>b.field&&b.operator&&(b.value||["is_empty","is_not_empty"].includes(b.operator))).length,0);return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:s.text,margin:0},children:"Filter Recipients"}),c&&t.jsx("button",{onClick:m,style:{padding:"6px 12px",backgroundColor:"transparent",border:`1px solid ${s.border}`,borderRadius:"6px",color:s.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Clear all"})]}),n&&t.jsx(Ko,{groups:l,onApplyFilter:y,theme:s}),t.jsxs("div",{style:{padding:"16px",backgroundColor:s.bgHover,borderRadius:"12px",marginBottom:"16px"},children:[c?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},children:l.map((R,W)=>t.jsxs("div",{children:[W>0&&t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"8px 0",gap:"12px"},children:[t.jsx("div",{style:{flex:1,height:"1px",backgroundColor:s.border}}),t.jsx("span",{style:{fontSize:"12px",fontWeight:"700",color:"#f59e0b",padding:"4px 12px",backgroundColor:"#f59e0b20",borderRadius:"4px",textTransform:"uppercase",letterSpacing:"1px"},children:"OR"}),t.jsx("div",{style:{flex:1,height:"1px",backgroundColor:s.border}})]}),t.jsx(Vo,{group:R,groupIndex:W,onRemoveGroup:j,onDuplicateGroup:f,onAddRule:p,onUpdateRule:v,onRemoveRule:g,theme:s})]},W))}):t.jsx("div",{style:{textAlign:"center",padding:"20px",color:s.textMuted,fontSize:"14px"},children:"No filters applied. All matching records will be included."}),t.jsxs("button",{onClick:d,style:{width:"100%",padding:"10px",backgroundColor:s.bgCard,border:`1px dashed ${s.border}`,borderRadius:"8px",color:s.primary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," ",c?"Add OR Group":"Add Filter Group"]})]}),h>0&&t.jsxs("div",{style:{padding:"12px 16px",backgroundColor:`${s.primary}10`,borderRadius:"8px",marginBottom:"16px",fontSize:"13px",color:s.text},children:[t.jsx("strong",{children:h})," filter",h!==1?"s":""," in ",t.jsx("strong",{children:l.length})," group",l.length!==1?"s":"",l.length>1&&t.jsx("span",{style:{color:s.textSecondary},children:" (groups combined with OR)"})]}),o!==void 0&&t.jsxs("button",{onClick:a,disabled:i||o===0||!a,style:{width:"100%",padding:"20px",backgroundColor:`${s.primary}10`,borderRadius:"12px",border:`1px solid ${s.primary}30`,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:i||o===0||!a?"default":"pointer",textAlign:"left",transition:"all 0.2s"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:s.text},children:"Matching Recipients"}),t.jsx("div",{style:{fontSize:"12px",color:s.textSecondary},children:o>0&&a?"Click to view matching accounts":"Accounts matching your criteria"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:s.primary},children:i?"...":(o??0).toLocaleString()}),!i&&o>0&&a&&t.jsx("div",{style:{padding:"6px 10px",backgroundColor:s.primary,color:"#fff",borderRadius:"6px",fontSize:"12px",fontWeight:"500"},children:"View"})]})]})]})},Yo={bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},Jo=[{id:"entry-criteria",type:"entry_criteria",title:"Entry Criteria",subtitle:"Define who enters this automation",config:{filterConfig:{groups:[]},reentry:{enabled:!1,type:"never",days:30},pacing:{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}}},{id:"trigger",type:"trigger",title:"Trigger",subtitle:"Daily at 09:00 (Central)",config:{time:"09:00",timezone:"America/Chicago",frequency:"Daily"}},{id:"node-1",type:"send_email",title:"Send Email",subtitle:"Select template...",config:{template:""}}],Zo=({t:e,automation:r,onUpdate:o,onSave:i,canEdit:a=!0})=>{var qe,We,Ee,Le,Pe,Oe,Fe,Ne,He,Ue,Ge,Ve,Ae,xe,ne,ge,Ke;const n=e||Yo,s=()=>{if(!(r!=null&&r.nodes)||r.nodes.length===0)return Jo;const z=r.nodes.some(Q=>Q.type==="entry_criteria"),O={id:"entry-criteria",type:"entry_criteria",title:"Entry Criteria",subtitle:"Define who enters this automation",config:{filterConfig:r.filter_config||{groups:[]},reentry:{enabled:!1,type:"never",days:30},pacing:{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}}};let F=r.nodes.map(Q=>{var ie,ee,ce;return Q.type==="entry_criteria"?{...Q,config:{...Q.config,filterConfig:((ie=Q.config)==null?void 0:ie.filterConfig)||r.filter_config||{groups:[]},reentry:((ee=Q.config)==null?void 0:ee.reentry)||{enabled:!1,type:"never",days:30},pacing:((ce=Q.config)==null?void 0:ce.pacing)||{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}}}:Q});return z||(F=[O,...F]),F},[l,c]=C.useState(s),[d,j]=C.useState(null),[f,p]=C.useState(null),[v,g]=C.useState(!1),[m,y]=C.useState(!1),[h,w]=C.useState(null),{data:R=[],isLoading:W}=pt(),b=(r==null?void 0:r.nodeStats)||{},_=l.find(z=>z.type==="entry_criteria"),[B,K]=C.useState(((qe=_==null?void 0:_.config)==null?void 0:qe.filterConfig)||{groups:[]}),[T,P]=C.useState(((We=_==null?void 0:_.config)==null?void 0:We.reentry)||{enabled:!1,type:"never",days:30}),[M,U]=C.useState(((Ee=_==null?void 0:_.config)==null?void 0:Ee.pacing)||{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}),L=z=>{K(z),c(O=>O.map(F=>F.type==="entry_criteria"?{...F,config:{...F.config,filterConfig:z}}:F))},N=z=>{P(z),c(O=>O.map(F=>F.type==="entry_criteria"?{...F,config:{...F.config,reentry:z}}:F))},H=z=>{U(z),c(O=>O.map(F=>F.type==="entry_criteria"?{...F,config:{...F.config,pacing:z}}:F))},E=C.useRef(null);C.useEffect(()=>(o&&(E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{o(z=>({...z,nodes:l,filter_config:B}))},100)),()=>{E.current&&clearTimeout(E.current)}),[l,B,T,M]);const u=(Le=B==null?void 0:B.groups)==null?void 0:Le.some(z=>{var O;return(O=z.rules)==null?void 0:O.some(F=>F.field&&F.operator)}),{data:$,isLoading:V}=st(m&&u?B:null,{limit:500}),{data:Y,isLoading:X}=It(u?B:null),D={entry_criteria:{icon:"ðŸŽ¯",color:"#8b5cf6",label:"Entry Criteria"},trigger:{icon:"âš¡",color:n.primary,label:"Trigger"},send_email:{icon:"ðŸ“§",color:n.success,label:"Send Email"},delay:{icon:"â±",color:n.warning,label:"Delay"},condition:{icon:"ðŸ”€",color:n.purple,label:"Condition"},field_condition:{icon:"ðŸ“‹",color:"#ec4899",label:"Field Check"},update_field:{icon:"âœï¸",color:"#06b6d4",label:"Update Field"},end:{icon:"ðŸ",color:n.textMuted,label:"End"}},A=[{type:"send_email",label:"Send Email",desc:"Send an email template",icon:"ðŸ“§"},{type:"delay",label:"Delay",desc:"Wait before continuing",icon:"â±"},{type:"condition",label:"Email Engagement",desc:"Branch on open/click",icon:"ðŸ“¬"},{type:"field_condition",label:"Field Condition",desc:"Branch on field value",icon:"ðŸ”€"},{type:"update_field",label:"Update Field",desc:"Update a record field",icon:"âœï¸"},{type:"end",label:"End",desc:"Stop automation",icon:"ðŸ"}],S=(z,O,F=null)=>{var ie;const Q={id:`node-${Date.now()}`,type:O,title:((ie=A.find(ee=>ee.type===O))==null?void 0:ie.label)||O,subtitle:"Configure...",config:{}};if((O==="condition"||O==="field_condition")&&(Q.branches={yes:[],no:[]}),F)c(ee=>{const ce=oe=>oe.map(me=>me.id===z&&me.branches?{...me,branches:{...me.branches,[F]:[...me.branches[F],Q]}}:me.branches?{...me,branches:{yes:ce(me.branches.yes),no:ce(me.branches.no)}}:me);return ce(ee)});else{const ee=l.findIndex(oe=>oe.id===z),ce=[...l];ce.splice(ee+1,0,Q),c(ce)}p(null),j(Q.id)},I=z=>{c(O=>O.filter(F=>F.id!==z&&F.id!=="trigger"&&F.id!=="entry-criteria")),d===z&&j(null)},k=(z,O)=>{c(F=>{const Q=ie=>ie.map(ee=>ee.id===z?{...ee,...O}:ee.branches?{...ee,branches:{yes:Q(ee.branches.yes||[]),no:Q(ee.branches.no||[])}}:ee);return Q(F)})},q=()=>{const z=(B==null?void 0:B.groups)||[],O=z.reduce((F,Q)=>{var ie;return F+(((ie=Q.rules)==null?void 0:ie.filter(ee=>ee.field&&ee.operator).length)||0)},0);return O===0?"No filters defined":`${O} filter${O!==1?"s":""} in ${z.length} group${z.length!==1?"s":""}`},et=(z,O)=>{const F=b[z]||{};return O==="entry_criteria"?F.entered?`${F.entered.toLocaleString()} entered`:null:O==="trigger"?F.processed?`${F.processed.toLocaleString()} processed`:null:O==="send_email"&&F.sent?`${F.sent.toLocaleString()} sent`:O==="delay"?F.waiting?`${F.waiting.toLocaleString()} waiting`:null:(O==="condition"||O==="field_condition")&&F.evaluated?`${F.evaluated.toLocaleString()} evaluated`:null},ze=({node:z})=>{const O=D[z.type]||D.send_email,F=d===z.id,Q=z.type==="entry_criteria",ie=z.type==="trigger",ee=Q||ie,ce=et(z.id,z.type);return t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[t.jsxs("div",{onClick:()=>{j(z.id)},style:{width:"320px",backgroundColor:n.bgCard,border:F?`2px solid ${O.color}`:`1px solid ${n.border}`,borderRadius:"12px",padding:"16px 18px",cursor:"pointer",position:"relative"},children:[ce&&t.jsx("div",{style:{position:"absolute",top:"-10px",right:"12px",padding:"4px 10px",backgroundColor:O.color,color:"#fff",borderRadius:"12px",fontSize:"11px",fontWeight:"600",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:ce}),!ee&&t.jsx("button",{onClick:oe=>{oe.stopPropagation(),I(z.id)},style:{position:"absolute",top:"8px",right:"8px",background:"none",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"16px"},children:"Ã—"}),t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[t.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${O.color}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:O.icon}),t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:n.text},children:z.title}),t.jsx("div",{style:{fontSize:"12px",color:n.textMuted,marginTop:"2px"},children:Q?q():z.subtitle})]})]}),Q&&t.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[t.jsxs("button",{onClick:oe=>{oe.stopPropagation(),g(!0)},style:{flex:1,padding:"10px",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,borderRadius:"8px",color:n.textSecondary,cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:"ðŸŽ¯"})," Edit Criteria"]}),t.jsxs("button",{onClick:oe=>{oe.stopPropagation(),y(!0)},style:{flex:1,padding:"10px",backgroundColor:n.primary+"15",border:`1px solid ${n.primary}40`,borderRadius:"8px",color:n.primary,cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:"ðŸ‘¥"})," Preview ",u&&Y!==void 0&&!X&&t.jsx("span",{style:{backgroundColor:n.primary,color:"#fff",padding:"2px 6px",borderRadius:"10px",fontSize:"10px",fontWeight:"600"},children:Y})]})]})]}),!z.branches&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.borderLight}}),t.jsx("button",{onClick:()=>p({afterNodeId:z.id,branch:null}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,color:n.textMuted,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"}),t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.borderLight}}),(f==null?void 0:f.afterNodeId)===z.id&&!(f!=null&&f.branch)&&t.jsx(Re,{onSelect:oe=>S(z.id,oe),onClose:()=>p(null)})]}),z.branches&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.borderLight}}),t.jsxs("div",{style:{display:"flex"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:n.success}}),t.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#22c55e20",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:n.success},children:"YES"})]}),t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.success}}),z.branches.yes.map(oe=>t.jsx(ze,{node:oe},oe.id)),t.jsx("button",{onClick:()=>p({afterNodeId:z.id,branch:"yes"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:n.bgHover,border:"1px dashed #22c55e",color:n.success,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(f==null?void 0:f.afterNodeId)===z.id&&(f==null?void 0:f.branch)==="yes"&&t.jsx(Re,{onSelect:oe=>S(z.id,oe,"yes"),onClose:()=>p(null)})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#ef444420",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:n.danger},children:"NO"}),t.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:n.danger}})]}),t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.danger}}),z.branches.no.map(oe=>t.jsx(ze,{node:oe},oe.id)),t.jsx("button",{onClick:()=>p({afterNodeId:z.id,branch:"no"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:n.bgHover,border:"1px dashed #ef4444",color:n.danger,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(f==null?void 0:f.afterNodeId)===z.id&&(f==null?void 0:f.branch)==="no"&&t.jsx(Re,{onSelect:oe=>S(z.id,oe,"no"),onClose:()=>p(null)})]})]})]})]})},Re=({onSelect:z,onClose:O})=>t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:O}),t.jsx("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"10px",backgroundColor:n.bgCard,border:`1px solid ${n.borderLight}`,borderRadius:"12px",padding:"8px",zIndex:100,width:"240px",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},children:A.map(F=>t.jsxs("button",{onClick:()=>z(F.type),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px",color:n.text,textAlign:"left"},children:[t.jsx("span",{style:{fontSize:"18px"},children:F.icon}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500"},children:F.label}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:F.desc})]})]},F.type))})]}),J=l.find(z=>z.id===d)||l.flatMap(z=>z.branches?[...z.branches.yes||[],...z.branches.no||[]]:[]).find(z=>z.id===d);return t.jsxs("div",{style:{fontFamily:"'IBM Plex Sans', -apple-system, sans-serif",backgroundColor:n.bg,height:"100%",color:n.text,display:"flex"},children:[t.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[t.jsxs("div",{style:{width:"220px",borderRight:`1px solid ${n.border}`,padding:"16px",backgroundColor:n.bgCard,overflowY:"auto"},children:[t.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:n.textMuted,marginBottom:"12px",textTransform:"uppercase"},children:"Add Nodes"}),A.map(z=>t.jsxs("div",{style:{padding:"12px",backgroundColor:n.bgHover,borderRadius:"8px",marginBottom:"8px",cursor:"grab",display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{fontSize:"18px"},children:z.icon}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:n.text},children:z.label}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:z.desc})]})]},z.type))]}),t.jsx("div",{style:{flex:1,padding:"40px",overflowY:"auto",display:"flex",justifyContent:"center"},children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[l.map(z=>t.jsx(ze,{node:z},z.id)),t.jsx("div",{style:{marginTop:"16px",padding:"8px 18px",backgroundColor:n.bgHover,borderRadius:"20px",fontSize:"12px",color:n.textMuted},children:"End of automation"})]})}),t.jsxs("div",{style:{width:"300px",borderLeft:`1px solid ${n.border}`,backgroundColor:n.bgCard,overflowY:"auto"},children:[t.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${n.border}`,fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase"},children:"Configuration"}),t.jsx("div",{style:{padding:"18px"},children:J?t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[t.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${((Pe=D[J.type])==null?void 0:Pe.color)||n.primary}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:((Oe=D[J.type])==null?void 0:Oe.icon)||"ðŸ“§"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"600",color:n.text,fontSize:"15px"},children:J.title}),t.jsx("div",{style:{fontSize:"12px",color:n.textMuted},children:((Fe=D[J.type])==null?void 0:Fe.label)||"Node"})]})]}),J.type==="entry_criteria"&&t.jsxs("div",{children:[t.jsx("p",{style:{fontSize:"13px",color:n.textSecondary,marginBottom:"16px"},children:"Define which accounts enter this automation based on their attributes."}),((B==null?void 0:B.groups)||[]).length>0&&t.jsxs("div",{style:{padding:"12px",backgroundColor:n.bgHover,borderRadius:"8px",marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:n.textMuted,marginBottom:"8px",textTransform:"uppercase"},children:"Current Filters"}),B.groups.map((z,O)=>t.jsxs("div",{style:{marginBottom:O<B.groups.length-1?"8px":0},children:[O>0&&t.jsx("div",{style:{fontSize:"10px",color:"#f59e0b",fontWeight:"700",textAlign:"center",margin:"6px 0"},children:"OR"}),(z.rules||[]).filter(F=>F.field&&F.operator).map((F,Q)=>t.jsx("div",{style:{padding:"4px 8px",backgroundColor:`${n.primary}15`,borderRadius:"4px",fontSize:"11px",color:n.text,marginBottom:"4px"},children:mt(F)},Q))]},O))]}),t.jsx("button",{onClick:()=>g(!0),style:{width:"100%",padding:"12px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",marginBottom:"20px"},children:"Edit Entry Criteria"}),t.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgHover,borderRadius:"8px",marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:n.text,marginBottom:"12px"},children:"Re-entry Rules"}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",marginBottom:"12px"},children:[t.jsx("input",{type:"checkbox",checked:T.enabled,onChange:z=>N({...T,enabled:z.target.checked}),style:{width:"16px",height:"16px",accentColor:n.primary}}),t.jsx("span",{style:{fontSize:"13px",color:n.textSecondary},children:"Allow contacts to re-enter"})]}),T.enabled&&t.jsx("div",{style:{marginLeft:"26px"},children:t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px",cursor:"pointer"},children:[t.jsx("input",{type:"radio",name:"reentryType",checked:T.type==="after_days",onChange:()=>N({...T,type:"after_days"}),style:{accentColor:n.primary}}),t.jsx("span",{style:{fontSize:"12px",color:n.textSecondary},children:"After"}),t.jsx("input",{type:"number",value:T.days,onChange:z=>N({...T,days:parseInt(z.target.value)||1}),min:"1",style:{width:"60px",padding:"4px 8px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"4px",color:n.text,fontSize:"12px"}}),t.jsx("span",{style:{fontSize:"12px",color:n.textSecondary},children:"days"})]})}),!T.enabled&&t.jsx("p",{style:{fontSize:"11px",color:n.textMuted,margin:0},children:"Contacts can only enter this automation once"})]}),t.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgHover,borderRadius:"8px"},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:n.text,marginBottom:"12px"},children:"Enrollment Pacing"}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",marginBottom:"12px"},children:[t.jsx("input",{type:"checkbox",checked:M.enabled,onChange:z=>H({...M,enabled:z.target.checked}),style:{width:"16px",height:"16px",accentColor:n.primary}}),t.jsx("span",{style:{fontSize:"13px",color:n.textSecondary},children:"Spread enrollments over time"})]}),M.enabled&&t.jsxs("div",{style:{marginLeft:"26px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[t.jsx("span",{style:{fontSize:"12px",color:n.textSecondary},children:"Spread over"}),t.jsx("input",{type:"number",value:M.spreadOverDays,onChange:z=>H({...M,spreadOverDays:parseInt(z.target.value)||1}),min:"1",max:"365",style:{width:"60px",padding:"4px 8px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"4px",color:n.text,fontSize:"12px"}}),t.jsx("span",{style:{fontSize:"12px",color:n.textSecondary},children:"days"})]}),t.jsx("div",{style:{fontSize:"11px",color:n.textSecondary,marginBottom:"8px"},children:"Run on these days:"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[{value:"sun",label:"Sun"},{value:"mon",label:"Mon"},{value:"tue",label:"Tue"},{value:"wed",label:"Wed"},{value:"thu",label:"Thu"},{value:"fri",label:"Fri"},{value:"sat",label:"Sat"}].map(z=>t.jsx("button",{onClick:()=>{const O=M.allowedDays||[],F=O.includes(z.value)?O.filter(Q=>Q!==z.value):[...O,z.value];H({...M,allowedDays:F})},style:{padding:"4px 8px",backgroundColor:(M.allowedDays||[]).includes(z.value)?n.primary:n.bgCard,color:(M.allowedDays||[]).includes(z.value)?"#fff":n.textSecondary,border:`1px solid ${(M.allowedDays||[]).includes(z.value)?n.primary:n.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px",fontWeight:"500"},children:z.label},z.value))})]}),!M.enabled&&t.jsx("p",{style:{fontSize:"11px",color:n.textMuted,margin:0},children:"All matching contacts will be enrolled immediately"})]})]}),J.type==="trigger"&&t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Run Time"}),t.jsx("input",{type:"time",value:((Ne=J.config)==null?void 0:Ne.time)||"09:00",onChange:z=>{var ie,ee;const O=z.target.value,F=((ie=J.config)==null?void 0:ie.frequency)||"Daily",Q=((ee=J.config)==null?void 0:ee.timezone)||"America/Chicago";k(d,{config:{...J.config,time:O},subtitle:`${F} at ${O} (${Q.split("/")[1]||Q})`})},style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px",marginBottom:"16px"}}),t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Frequency"}),t.jsxs("select",{value:((He=J.config)==null?void 0:He.frequency)||"Daily",onChange:z=>{var ie,ee;const O=z.target.value,F=((ie=J.config)==null?void 0:ie.time)||"09:00",Q=((ee=J.config)==null?void 0:ee.timezone)||"America/Chicago";k(d,{config:{...J.config,frequency:O},subtitle:`${O} at ${F} (${Q.split("/")[1]||Q})`})},style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[t.jsx("option",{value:"Daily",children:"Daily"}),t.jsx("option",{value:"Weekly",children:"Weekly"}),t.jsx("option",{value:"Monthly",children:"Monthly"})]})]}),J.type==="send_email"&&t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Email Template"}),t.jsxs("select",{value:((Ue=J.config)==null?void 0:Ue.template)||"",onChange:z=>{const O=R.find(F=>F.id===z.target.value);k(d,{config:{...J.config,template:z.target.value,templateName:(O==null?void 0:O.name)||""},subtitle:(O==null?void 0:O.name)||"Select template..."})},style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[t.jsx("option",{value:"",children:W?"Loading templates...":"Select template..."}),R.map(z=>t.jsx("option",{value:z.id,children:z.name},z.id))]})]}),J.type==="delay"&&t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Wait Duration"}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("input",{type:"number",value:((Ge=J.config)==null?void 0:Ge.duration)||1,min:"1",onChange:z=>{var Q;const O=parseInt(z.target.value,10)||1,F=((Q=J.config)==null?void 0:Q.unit)||"days";k(d,{config:{...J.config,duration:O},subtitle:`Wait ${O} ${F}`})},style:{flex:1,padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"}}),t.jsxs("select",{value:((Ve=J.config)==null?void 0:Ve.unit)||"days",onChange:z=>{var Q;const O=z.target.value,F=((Q=J.config)==null?void 0:Q.duration)||1;k(d,{config:{...J.config,unit:O},subtitle:`Wait ${F} ${O}`})},style:{flex:1,padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[t.jsx("option",{value:"hours",children:"Hours"}),t.jsx("option",{value:"days",children:"Days"}),t.jsx("option",{value:"weeks",children:"Weeks"})]})]})]}),(J.type==="condition"||J.type==="field_condition")&&t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Condition Type"}),t.jsxs("select",{value:((Ae=J.config)==null?void 0:Ae.type)||"email_opened",onChange:z=>{const O=z.target.value,F={email_opened:"If email opened",email_clicked:"If email clicked",field_value:"If field matches"};k(d,{config:{...J.config,type:O},subtitle:F[O]||"Configure condition..."})},style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[t.jsx("option",{value:"email_opened",children:"Email Opened"}),t.jsx("option",{value:"email_clicked",children:"Email Clicked"}),t.jsx("option",{value:"field_value",children:"Field Value"})]})]}),J.type==="end"&&t.jsx("p",{style:{fontSize:"13px",color:n.textSecondary},children:"This node ends the automation flow. Contacts reaching this point will exit the automation."})]}):t.jsxs("div",{style:{textAlign:"center",color:n.textMuted,padding:"30px 0"},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:"ðŸ‘†"}),t.jsx("div",{style:{fontSize:"13px"},children:"Select a node to configure"})]})})]})]}),v&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",zIndex:200},onClick:()=>g(!1)}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"900px",maxWidth:"95vw",maxHeight:"85vh",backgroundColor:n.bgCard,borderRadius:"16px",border:`1px solid ${n.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${n.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[t.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Entry Criteria"}),t.jsx("button",{onClick:()=>g(!1),style:{background:"none",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"18px"},children:"Ã—"})]}),t.jsx("div",{style:{flex:1,padding:"20px",overflow:"auto"},children:t.jsx(Qo,{filterConfig:B,setFilterConfig:L,showQuickFilters:!0,theme:n})}),t.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${n.border}`,display:"flex",justifyContent:"flex-end",gap:"8px",flexShrink:0},children:a?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>g(!1),style:{padding:"10px 20px",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,borderRadius:"8px",color:n.textSecondary,cursor:"pointer",fontSize:"13px"},children:"Cancel"}),t.jsx("button",{onClick:()=>g(!1),style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Save Criteria"})]}):t.jsx("button",{onClick:()=>g(!1),style:{padding:"10px 20px",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,borderRadius:"8px",color:n.textSecondary,cursor:"pointer",fontSize:"13px"},children:"Close"})})]})]}),m&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",zIndex:200},onClick:()=>y(!1)}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxWidth:"95vw",maxHeight:"85vh",backgroundColor:n.bgCard,borderRadius:"16px",border:`1px solid ${n.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${n.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[t.jsxs("div",{children:[t.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Preview Potential Enrollees"}),t.jsx("p",{style:{fontSize:"12px",color:n.textMuted,margin:"4px 0 0"},children:"Contacts matching your entry criteria who would enter this automation"})]}),t.jsx("button",{onClick:()=>y(!1),style:{background:"none",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"20px"},children:"Ã—"})]}),t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${n.border}`,display:"flex",gap:"24px",backgroundColor:n.bgHover},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.primary},children:V?"...":($==null?void 0:$.length)||0}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted,textTransform:"uppercase"},children:"Matching Contacts"})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.success},children:((xe=B==null?void 0:B.groups)==null?void 0:xe.length)||0}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted,textTransform:"uppercase"},children:"Filter Groups"})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.textSecondary},children:((ne=B==null?void 0:B.groups)==null?void 0:ne.reduce((z,O)=>{var F;return z+(((F=O.rules)==null?void 0:F.filter(Q=>Q.field&&Q.operator).length)||0)},0))||0}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted,textTransform:"uppercase"},children:"Active Filters"})]})]}),t.jsxs("div",{style:{flex:1,overflow:"auto",padding:"0"},children:[V?t.jsx("div",{style:{textAlign:"center",padding:"40px",color:n.textMuted},children:t.jsx("div",{style:{fontSize:"14px"},children:"Loading potential enrollees..."})}):u?$&&$.length>0?t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:n.bgHover},children:[t.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${n.border}`},children:"Contact"}),t.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${n.border}`},children:"Account Type"}),t.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${n.border}`},children:"Last Email"}),t.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${n.border}`},children:"Matched Groups"})]})}),t.jsx("tbody",{children:$.map(z=>t.jsxs("tr",{style:{borderBottom:`1px solid ${n.border}`},children:[t.jsxs("td",{style:{padding:"12px 20px"},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:n.text},children:z.name||z.account_name}),t.jsx("div",{style:{fontSize:"12px",color:n.textMuted},children:z.email})]}),t.jsx("td",{style:{padding:"12px 20px",fontSize:"13px",color:n.textSecondary},children:z.account_type||"â€”"}),t.jsx("td",{style:{padding:"12px 20px",fontSize:"13px",color:n.textSecondary},children:z._lastEmailSent?new Date(z._lastEmailSent).toLocaleDateString():"Never"}),t.jsx("td",{style:{padding:"12px 20px",position:"relative"},children:z._matchedGroups&&z._matchedGroups.length>0?t.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:z._matchedGroups.map(O=>t.jsxs("span",{style:{padding:"2px 8px",borderRadius:"10px",fontSize:"11px",fontWeight:"600",backgroundColor:(h==null?void 0:h.contactId)===z.id&&(h==null?void 0:h.groupIndex)===O?n.primary:`${n.primary}20`,color:(h==null?void 0:h.contactId)===z.id&&(h==null?void 0:h.groupIndex)===O?"#fff":n.primary,cursor:"default",transition:"all 0.15s ease",position:"relative"},onMouseEnter:F=>{const Q=F.target.getBoundingClientRect();w({contactId:z.id,groupIndex:O,x:Q.left,y:Q.bottom+8})},onMouseLeave:()=>{w(null)},children:["Group ",O+1]},O))}):t.jsx("span",{style:{fontSize:"12px",color:n.textMuted},children:"â€”"})})]},z.id))})]}):t.jsxs("div",{style:{textAlign:"center",padding:"40px",color:n.textMuted},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:"ðŸ‘¥"}),t.jsx("div",{style:{fontSize:"14px"},children:"No contacts match your current filters"})]}):t.jsxs("div",{style:{textAlign:"center",padding:"40px",color:n.textMuted},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:"ðŸŽ¯"}),t.jsx("div",{style:{fontSize:"14px"},children:"Add filters to see who would enter this automation"})]}),h&&((ge=B==null?void 0:B.groups)==null?void 0:ge[h.groupIndex])&&t.jsxs("div",{style:{position:"fixed",left:h.x,top:h.y,backgroundColor:n.bgCard,border:`1px solid ${n.border}`,borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e4,maxWidth:"300px",pointerEvents:"none"},children:[t.jsxs("div",{style:{fontSize:"11px",fontWeight:"600",color:n.textMuted,marginBottom:"8px",textTransform:"uppercase"},children:["Group ",h.groupIndex+1," Criteria"]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:(Ke=B.groups[h.groupIndex].rules)==null?void 0:Ke.filter(z=>z.field&&z.operator).map((z,O)=>t.jsx("div",{style:{fontSize:"12px",color:n.text},children:mt(z)},O))})]})]}),t.jsxs("div",{style:{padding:"12px 20px",borderTop:`1px solid ${n.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0,backgroundColor:n.bgHover},children:[t.jsx("span",{style:{fontSize:"12px",color:n.textMuted},children:V?"Loading...":`Showing ${($==null?void 0:$.length)||0} potential enrollee${(($==null?void 0:$.length)||0)!==1?"s":""}`}),t.jsx("button",{onClick:()=>y(!1),style:{padding:"8px 16px",backgroundColor:n.bgCard,border:`1px solid ${n.borderLight}`,borderRadius:"6px",color:n.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Close"})]})]})]})]})},yt=({t:e})=>{var U,L;const{userId:r,automationId:o}=de(),i=he(),a=ct(),n=!o||o==="new";(U=a.state)!=null&&U.templateName||((L=a.state)==null||L.templateId);const{data:s=!1,isLoading:l}=So(),{data:c,isLoading:d,error:j}=no(n?null:o),f=(c==null?void 0:c.is_default)===!0,p=n||!f||s,{createAutomation:v,updateAutomation:g,activateAutomation:m,pauseAutomation:y,duplicateAutomation:h}=St(),{updateMasterAutomation:w}=jo(),R=async()=>{if(n)return;const N=W.status==="active",H=N?"paused":"active";try{N?await y.mutateAsync(o):await m.mutateAsync(o),b(E=>({...E,status:H}))}catch(E){console.error("Failed to toggle status:",E)}},[W,b]=C.useState({name:"",description:"",category:"general",status:"draft",send_time:"10:00",timezone:"America/Chicago",frequency:"Daily",filter_config:{},nodes:[]});C.useEffect(()=>{c&&b({name:c.name||"",description:c.description||"",category:c.category||"general",status:c.status||"draft",send_time:c.send_time||"10:00",timezone:c.timezone||"America/Chicago",frequency:c.frequency||"Daily",filter_config:c.filter_config||{},nodes:c.nodes||[]})},[c]);const _=async N=>{if(!p){alert('You cannot edit default automations. Use "Clone & Edit" to create your own copy.');return}try{if(n){const H=await v.mutateAsync(N);i(`/${r}/automations/${H.id}`,{replace:!0})}else s&&f&&(c!=null&&c.default_key)?await w.mutateAsync({defaultKey:c.default_key,updates:{name:N.name,description:N.description,category:N.category,send_time:N.send_time,timezone:N.timezone,frequency:N.frequency,filter_config:N.filter_config,nodes:N.nodes}}):await g.mutateAsync({automationId:o,updates:N})}catch(H){console.error("Failed to save automation:",H),alert("Failed to save automation. Please try again.")}},B=async()=>{try{const N=await h.mutateAsync(o);i(`/${r}/automations/${N.id}`,{replace:!0})}catch(N){console.error("Failed to clone automation:",N),alert("Failed to clone automation. Please try again.")}},K=()=>{i(`/${r}/automations`)},[T,P]=C.useState(null),M=n||c&&T===c.updated_at;return C.useEffect(()=>{c!=null&&c.updated_at&&P(c.updated_at)},[c==null?void 0:c.updated_at]),!n&&(d||l||!M)?t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[t.jsx("div",{style:{fontSize:"32px"},children:"â³"}),t.jsx("div",{style:{color:(e==null?void 0:e.textSecondary)||"#a1a1aa"},children:"Loading automation..."})]}):j?t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[t.jsx("div",{style:{fontSize:"48px"},children:"ðŸ˜•"}),t.jsx("h2",{style:{color:(e==null?void 0:e.text)||"#fafafa",margin:0},children:"Automation Not Found"}),t.jsx("p",{style:{color:(e==null?void 0:e.textSecondary)||"#a1a1aa"},children:"We couldn't find the automation you're looking for."}),t.jsx("button",{onClick:K,style:{padding:"10px 20px",backgroundColor:(e==null?void 0:e.primary)||"#3b82f6",border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Automations"})]}):t.jsxs("div",{style:{margin:"-24px",height:"calc(100vh - 49px)",display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${(e==null?void 0:e.border)||"#27272a"}`,display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:(e==null?void 0:e.bgCard)||"#18181b",flexShrink:0},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[t.jsx("button",{onClick:K,style:{background:"none",border:"none",color:(e==null?void 0:e.textSecondary)||"#a1a1aa",cursor:"pointer",fontSize:"20px",padding:"4px 8px",display:"flex",alignItems:"center"},children:"â†"}),t.jsx("h1",{style:{fontSize:"16px",fontWeight:"600",color:(e==null?void 0:e.text)||"#fafafa",margin:0},children:n?"Create Automation":p?`Edit: ${(c==null?void 0:c.name)||"Automation"}`:`View: ${(c==null?void 0:c.name)||"Automation"}`}),f&&t.jsx("span",{style:{padding:"4px 8px",backgroundColor:`${(e==null?void 0:e.primary)||"#3b82f6"}20`,color:(e==null?void 0:e.primary)||"#3b82f6",borderRadius:"4px",fontSize:"11px",fontWeight:"600",textTransform:"uppercase"},children:"Default"}),!p&&t.jsx("span",{style:{padding:"4px 8px",backgroundColor:`${(e==null?void 0:e.warning)||"#f59e0b"}20`,color:(e==null?void 0:e.warning)||"#f59e0b",borderRadius:"4px",fontSize:"11px",fontWeight:"600"},children:"Read Only"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[!n&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"13px",color:(e==null?void 0:e.textSecondary)||"#a1a1aa"},children:W.status==="active"?"Active":"Inactive"}),t.jsx("button",{onClick:R,disabled:m.isPending||y.isPending,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:W.status==="active"?(e==null?void 0:e.success)||"#22c55e":(e==null?void 0:e.bgHover)||"#27272a",cursor:"pointer",position:"relative",transition:"background-color 0.2s",opacity:m.isPending||y.isPending?.6:1},children:t.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:W.status==="active"?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})})]}),!p&&t.jsx("button",{onClick:B,disabled:h.isPending,style:{padding:"8px 16px",backgroundColor:(e==null?void 0:e.bgHover)||"#27272a",border:`1px solid ${(e==null?void 0:e.border)||"#3f3f46"}`,borderRadius:"6px",color:(e==null?void 0:e.text)||"#fafafa",cursor:"pointer",fontSize:"13px",fontWeight:"500",opacity:h.isPending?.7:1},children:h.isPending?"Cloning...":"Clone & Edit"}),p&&t.jsx("button",{onClick:()=>_(W),disabled:v.isPending||g.isPending||w.isPending,style:{padding:"8px 16px",backgroundColor:(e==null?void 0:e.primary)||"#3b82f6",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",opacity:v.isPending||g.isPending||w.isPending?.7:1},children:v.isPending||g.isPending||w.isPending?"Saving...":n?"Create":"Save Changes"})]})]}),t.jsx("div",{style:{flex:1,overflow:"hidden"},children:t.jsx(Zo,{t:e,automation:W,onUpdate:b,onSave:_,canEdit:p},`${o||"new"}-${(c==null?void 0:c.updated_at)||"new"}`)})]})},Xo=void 0,Xe=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),er=({status:e,theme:r})=>{const o={Draft:{bg:r.textMuted,text:"#fff"},Scheduled:{bg:r.warning,text:"#fff"},Sending:{bg:r.primary,text:"#fff"},Completed:{bg:r.success,text:"#fff"},Cancelled:{bg:r.danger,text:"#fff"}},i=o[e]||o.Draft;return t.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${i.bg}20`,color:i.bg,borderRadius:"20px",fontSize:"11px",fontWeight:"500"},children:e})},tr=({template:e,onSave:r,onClose:o,theme:i})=>{const[a,n]=C.useState((e==null?void 0:e.name)||""),[s,l]=C.useState((e==null?void 0:e.subject)||""),[c,d]=C.useState((e==null?void 0:e.body_html)||(e==null?void 0:e.body_text)||""),[j,f]=C.useState((e==null?void 0:e.category)||"general"),[p,v]=C.useState(!1),g=async()=>{v(!0);try{const h=await r({name:a,subject:s,body_html:c,body_text:c.replace(/<[^>]*>/g,""),category:j});o(h)}catch(h){console.error("Failed to save template:",h)}finally{v(!1)}},m=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],y=h=>{d(c+h)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:200},onClick:()=>o(null)}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxWidth:"95vw",maxHeight:"90vh",backgroundColor:i.bgCard,borderRadius:"16px",border:`1px solid ${i.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${i.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:i.text,margin:0},children:e?"Edit Template":"Create New Template"}),t.jsx("button",{onClick:()=>o(null),style:{background:"none",border:"none",color:i.textMuted,cursor:"pointer",fontSize:"20px"},children:"Ã—"})]}),t.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:i.text,display:"block",marginBottom:"6px"},children:"Template Name"}),t.jsx("input",{type:"text",value:a,onChange:h=>n(h.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:i.text,display:"block",marginBottom:"6px"},children:"Category"}),t.jsxs("select",{value:j,onChange:h=>f(h.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px"},children:[t.jsx("option",{value:"general",children:"General"}),t.jsx("option",{value:"welcome",children:"Welcome"}),t.jsx("option",{value:"renewal",children:"Renewal"}),t.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),t.jsx("option",{value:"engagement",children:"Engagement"}),t.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:i.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),t.jsx("input",{type:"text",value:s,onChange:h=>l(h.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px"}})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:i.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:m.map(h=>t.jsx("button",{onClick:()=>y(h.key),style:{padding:"4px 10px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.textSecondary,cursor:"pointer",fontSize:"11px"},children:h.label},h.key))})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:i.text,display:"block",marginBottom:"6px"},children:"Email Body"}),t.jsx("textarea",{value:c,onChange:h=>d(h.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:10,style:{width:"100%",padding:"12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),t.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${i.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[t.jsx("button",{onClick:()=>o(null),style:{padding:"10px 20px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),t.jsx("button",{onClick:g,disabled:p||!a||!s,style:{padding:"10px 20px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:p?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:p||!a||!s?.6:1},children:p?"Creating...":"Create & Select"})]})]})]})},or=({batch:e,onView:r,theme:o})=>{var a;const i=e.total_recipients>0?Math.round(e.emails_sent/e.total_recipients*100):0;return t.jsxs("div",{style:{padding:"16px",backgroundColor:o.bgCard,borderRadius:"10px",border:`1px solid ${o.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"6px"},children:[t.jsx("span",{style:{fontWeight:"600",color:o.text},children:e.name||"Untitled Batch"}),t.jsx(er,{status:e.status,theme:o})]}),t.jsx("p",{style:{fontSize:"13px",color:o.textSecondary,margin:0},children:e.subject||"No subject"}),t.jsxs("p",{style:{fontSize:"12px",color:o.textMuted,margin:"4px 0 0"},children:[((a=e.template)==null?void 0:a.name)||"Custom email"," â€¢ ",e.total_recipients||0," recipients"]})]}),e.status!=="Draft"&&t.jsxs("div",{style:{textAlign:"right",minWidth:"100px"},children:[t.jsxs("div",{style:{fontSize:"18px",fontWeight:"600",color:o.text},children:[i,"%"]}),t.jsxs("div",{style:{fontSize:"11px",color:o.textMuted},children:[e.emails_sent||0," / ",e.total_recipients||0," sent"]})]}),t.jsx("button",{onClick:()=>r(e),style:{padding:"8px 16px",backgroundColor:o.bgHover,border:`1px solid ${o.border}`,borderRadius:"6px",color:o.text,cursor:"pointer",fontSize:"13px"},children:"View"})]})},rr=({currentStep:e,steps:r,theme:o})=>t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"24px"},children:r.map((i,a)=>t.jsxs(ke.Fragment,{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:a<=e?o.primary:o.bgHover,color:a<=e?"#fff":o.textMuted,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"13px",fontWeight:"600"},children:a<e?"âœ“":a+1}),t.jsx("span",{style:{fontSize:"14px",fontWeight:a===e?"600":"400",color:a<=e?o.text:o.textMuted},children:i})]}),a<r.length-1&&t.jsx("div",{style:{flex:1,height:"2px",backgroundColor:a<e?o.primary:o.border,minWidth:"40px"}})]},i))}),nr=({selectedTemplate:e,onSelect:r,onCreateNew:o,templates:i,isLoading:a,theme:n})=>{const[s,l]=C.useState(""),c=C.useMemo(()=>i?s?i.filter(d=>d.name.toLowerCase().includes(s.toLowerCase())||d.subject.toLowerCase().includes(s.toLowerCase())):i:[],[i,s]);return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Select an Email Template"}),t.jsxs("button",{onClick:o,style:{padding:"8px 16px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," Create New Template"]})]}),t.jsxs("div",{style:{position:"relative",marginBottom:"16px"},children:[t.jsx("input",{type:"text",placeholder:"Search templates...",value:s,onChange:d=>l(d.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"}}),t.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:n.textMuted},children:"ðŸ”"})]}),a?t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"},children:Array.from({length:4}).map((d,j)=>t.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgCard,borderRadius:"10px",border:`1px solid ${n.border}`},children:[t.jsx(Xe,{width:"120px",height:"16px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Xe,{width:"200px",height:"14px"})})]},j))}):t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px",maxHeight:"400px",overflow:"auto"},children:c.map(d=>t.jsxs("div",{onClick:()=>r(d),style:{padding:"16px",backgroundColor:n.bgCard,borderRadius:"10px",border:`2px solid ${(e==null?void 0:e.id)===d.id?n.primary:n.border}`,cursor:"pointer",transition:"border-color 0.15s"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:n.text,marginBottom:"4px"},children:d.name}),t.jsx("div",{style:{fontSize:"13px",color:n.textSecondary},children:d.subject}),t.jsx("div",{style:{marginTop:"8px",padding:"4px 8px",backgroundColor:`${n.primary}15`,color:n.primary,borderRadius:"4px",fontSize:"11px",display:"inline-block",textTransform:"capitalize"},children:d.category||"General"})]},d.id))}),!a&&c.length===0&&t.jsx("div",{style:{textAlign:"center",padding:"40px",color:n.textMuted},children:s?"No templates match your search":"No templates available. Create one to get started!"})]})},dt=[{value:"account_status",label:"Account Status",type:"select",options:[{value:"customer",label:"Customer"},{value:"prospect",label:"Prospect"},{value:"prior_customer",label:"Prior Customer"},{value:"lead",label:"Lead"}]},{value:"policy_type",label:"Policy Type",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"active_policy_type",label:"Has Active Policy",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"policy_status",label:"Policy Status",type:"select",options:[{value:"active",label:"Active"},{value:"cancelled",label:"Cancelled"},{value:"expired",label:"Expired"}]},{value:"policy_class",label:"Policy Class",type:"select",options:[{value:"Personal",label:"Personal"},{value:"Commercial",label:"Commercial"}]},{value:"policy_count",label:"Number of Policies",type:"number"},{value:"policy_effective",label:"Policy Effective Date",type:"date"},{value:"policy_expiration",label:"Policy Expiration",type:"date"},{value:"location",label:"Location",type:"location"},{value:"state",label:"State",type:"select",options:[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}]},{value:"city",label:"City",type:"text"},{value:"zip_code",label:"ZIP Code",type:"text"},{value:"email_domain",label:"Email Domain",type:"text"},{value:"last_email_sent",label:"Last Email Sent",type:"date"},{value:"account_created",label:"Account Created",type:"date"}],Mt={select:[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"is_any",label:"is any of"}],number:[{value:"equals",label:"equals"},{value:"greater_than",label:"greater than"},{value:"less_than",label:"less than"},{value:"at_least",label:"at least"},{value:"at_most",label:"at most"},{value:"between",label:"is between"}],date:[{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"between",label:"is between"},{value:"in_next_days",label:"is in the next"},{value:"in_last_days",label:"was in the last"}],location:[{value:"within_radius",label:"is within"}],text:[{value:"contains",label:"contains"},{value:"not_contains",label:"does not contain"},{value:"equals",label:"equals"},{value:"not_equals",label:"does not equal"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"},{value:"is_empty",label:"is empty"},{value:"is_not_empty",label:"is not empty"}]},ir=[5,10,15,25,50,100],ar=(e,r)=>{const i=(Mt[e]||[]).find(a=>a.value===r);return(i==null?void 0:i.label)||r},ht=e=>{const r=dt.find(n=>n.value===e.field);if(!r)return null;const o=r.label,i=ar(r.type,e.operator);let a=e.value;if(r.type==="select"&&r.options)if(e.operator==="is_any")a=(e.value||"").split(",").map(s=>{const l=r.options.find(c=>c.value===s);return(l==null?void 0:l.label)||s}).join(", ");else{const n=r.options.find(s=>s.value===e.value);a=(n==null?void 0:n.label)||e.value}return e.operator==="is_empty"||e.operator==="is_not_empty"?`${o} ${i}`:e.operator==="between"&&e.value2?`${o} ${i} ${e.value} and ${e.value2}`:e.operator==="in_next_days"||e.operator==="in_last_days"?`${o} ${i} ${e.value} days`:e.operator==="within_radius"?`${o} within ${e.radius||25} miles of ${e.locationDisplay||"location"}`:`${o} ${i} ${a}`},sr=({recipients:e,filterConfig:r,isLoading:o,onClose:i,theme:a})=>{var m;const[n,s]=C.useState(""),[l,c]=C.useState(1),d=20,j=(r==null?void 0:r.groups)||(((m=r==null?void 0:r.rules)==null?void 0:m.length)>0?[{rules:r.rules}]:[]),f=j.some(y=>{var h;return(h=y.rules)==null?void 0:h.some(w=>w.field&&w.operator)}),p=C.useMemo(()=>{if(!e)return[];if(!n)return e;const y=n.toLowerCase();return e.filter(h=>(h.name||"").toLowerCase().includes(y)||(h.person_email||h.email||"").toLowerCase().includes(y)||(h.primary_contact_first_name||"").toLowerCase().includes(y)||(h.primary_contact_last_name||"").toLowerCase().includes(y))},[e,n]),v=Math.ceil(p.length/d),g=p.slice((l-1)*d,l*d);return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",zIndex:1e3},onClick:i}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"900px",maxWidth:"95vw",maxHeight:"85vh",backgroundColor:a.bgCard,borderRadius:"16px",border:`1px solid ${a.border}`,zIndex:1001,display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${a.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{margin:0,fontSize:"18px",fontWeight:"600",color:a.text},children:"Matching Recipients"}),t.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:a.textSecondary},children:o?"Loading...":`${p.length.toLocaleString()} accounts match your criteria`})]}),t.jsx("button",{onClick:i,style:{background:"none",border:"none",color:a.textMuted,cursor:"pointer",fontSize:"24px",lineHeight:1,padding:"4px"},children:"Ã—"})]}),f&&t.jsxs("div",{style:{padding:"12px 20px",backgroundColor:a.bgHover,borderBottom:`1px solid ${a.border}`},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:a.textSecondary,marginBottom:"8px",textTransform:"uppercase"},children:"Active Filters"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:j.map((y,h)=>t.jsxs(ke.Fragment,{children:[h>0&&t.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#f59e0b20",color:"#f59e0b",borderRadius:"4px",fontSize:"11px",fontWeight:"700"},children:"OR"}),(y.rules||[]).filter(w=>w.field&&w.operator).map((w,R)=>t.jsxs(ke.Fragment,{children:[R>0&&t.jsx("span",{style:{fontSize:"11px",color:a.textMuted,alignSelf:"center"},children:"AND"}),t.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${a.primary}15`,color:a.primary,borderRadius:"4px",fontSize:"12px",fontWeight:"500"},children:ht(w)})]},`${h}-${R}`))]},h))})]}),t.jsx("div",{style:{padding:"12px 20px",borderBottom:`1px solid ${a.border}`},children:t.jsx("input",{type:"text",placeholder:"Search recipients...",value:n,onChange:y=>{s(y.target.value),c(1)},style:{width:"100%",padding:"10px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"}})}),t.jsx("div",{style:{flex:1,overflow:"auto",padding:"0 20px"},children:o?t.jsx("div",{style:{padding:"40px",textAlign:"center",color:a.textMuted},children:"Loading recipients..."}):g.length===0?t.jsx("div",{style:{padding:"40px",textAlign:"center",color:a.textMuted},children:n?"No recipients match your search":"No recipients found"}):t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{borderBottom:`2px solid ${a.border}`},children:[t.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:a.textSecondary,textTransform:"uppercase"},children:"Name"}),t.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:a.textSecondary,textTransform:"uppercase"},children:"Email"}),t.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:a.textSecondary,textTransform:"uppercase"},children:"Status"}),f&&j.length>0&&t.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:a.textSecondary,textTransform:"uppercase"},children:"Matched Groups"})]})}),t.jsx("tbody",{children:g.map((y,h)=>t.jsxs("tr",{style:{borderBottom:`1px solid ${a.border}`,backgroundColor:h%2===0?"transparent":a.bgHover},children:[t.jsxs("td",{style:{padding:"12px 8px"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:a.text},children:y.primary_contact_first_name?`${y.primary_contact_first_name} ${y.primary_contact_last_name||""}`.trim():y.name||"N/A"}),y.name&&y.primary_contact_first_name&&t.jsx("div",{style:{fontSize:"12px",color:a.textMuted},children:y.name})]}),t.jsx("td",{style:{padding:"12px 8px",fontSize:"13px",color:a.textSecondary},children:y.person_email||y.email||"N/A"}),t.jsx("td",{style:{padding:"12px 8px"},children:t.jsx("span",{style:{padding:"3px 8px",backgroundColor:a.bgHover,color:a.text,borderRadius:"4px",fontSize:"12px",textTransform:"capitalize"},children:y.account_status||"N/A"})}),f&&j.length>0&&t.jsx("td",{style:{padding:"12px 8px"},children:t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[(y._matchedGroups||[]).map(w=>{var R,W;return t.jsxs("span",{style:{padding:"2px 8px",backgroundColor:`${a.success}20`,color:a.success,borderRadius:"4px",fontSize:"11px",fontWeight:"600",display:"inline-flex",alignItems:"center",gap:"4px",cursor:"help"},title:((W=(R=j[w])==null?void 0:R.rules)==null?void 0:W.filter(b=>b.field&&b.operator).map(b=>ht(b)).join(" AND "))||`Group ${w+1}`,children:["Group ",w+1,t.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{opacity:.7},children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),t.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})]},w)}),(!y._matchedGroups||y._matchedGroups.length===0)&&t.jsx("span",{style:{fontSize:"11px",color:a.textMuted},children:j.length===0?"No filters":"All"})]})})]},y.account_unique_id||h))})]})}),v>1&&t.jsxs("div",{style:{padding:"12px 20px",borderTop:`1px solid ${a.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{fontSize:"13px",color:a.textSecondary},children:["Showing ",(l-1)*d+1,"-",Math.min(l*d,p.length)," of ",p.length]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("button",{onClick:()=>c(y=>Math.max(1,y-1)),disabled:l===1,style:{padding:"6px 12px",backgroundColor:l===1?a.bgHover:a.bgCard,border:`1px solid ${a.border}`,borderRadius:"6px",color:l===1?a.textMuted:a.text,cursor:l===1?"not-allowed":"pointer",fontSize:"13px"},children:"Previous"}),t.jsxs("span",{style:{padding:"6px 12px",fontSize:"13px",color:a.textSecondary},children:["Page ",l," of ",v]}),t.jsx("button",{onClick:()=>c(y=>Math.min(v,y+1)),disabled:l===v,style:{padding:"6px 12px",backgroundColor:l===v?a.bgHover:a.bgCard,border:`1px solid ${a.border}`,borderRadius:"6px",color:l===v?a.textMuted:a.text,cursor:l===v?"not-allowed":"pointer",fontSize:"13px"},children:"Next"})]})]})]})]})},lr=({lat:e,lng:r,radiusMiles:o,theme:i})=>{const a=C.useRef(null),n=C.useRef(null),s=C.useRef(null),l=C.useRef(null);C.useEffect(()=>{var j;if((j=window.google)!=null&&j.maps)d();else{const f=document.createElement("script");f.src=`https://maps.googleapis.com/maps/api/js?key=${Xo}`,f.async=!0,f.defer=!0,f.onload=()=>d(),document.head.appendChild(f)}function d(){var v;if(!a.current||!((v=window.google)!=null&&v.maps))return;const f={lat:e,lng:r},p=o*1609.34;n.current=new window.google.maps.Map(a.current,{center:f,zoom:c(o),mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,styles:[{featureType:"poi",stylers:[{visibility:"off"}]}]}),s.current=new window.google.maps.Circle({map:n.current,center:f,radius:p,fillColor:i.primary,fillOpacity:.2,strokeColor:i.primary,strokeWeight:2}),l.current=new window.google.maps.Marker({map:n.current,position:f}),n.current.fitBounds(s.current.getBounds())}return()=>{s.current&&s.current.setMap(null),l.current&&l.current.setMap(null)}},[e,r,o,i.primary]);function c(d){return d<=5?12:d<=15?11:d<=25?10:d<=50?9:8}return t.jsx("div",{ref:a,style:{width:"100%",height:"100%"}})},dr=({location:e,radius:r,onClose:o,theme:i})=>{if(!e)return null;const a=parseFloat(e.lat),n=parseFloat(e.lng);return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",zIndex:1e3},onClick:o}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"600px",maxWidth:"95vw",backgroundColor:i.bgCard,borderRadius:"16px",border:`1px solid ${i.border}`,zIndex:1001,overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${i.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:i.text},children:"Location Radius Preview"}),t.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:i.textSecondary},children:["ðŸ“ ",e.display]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsxs("div",{style:{padding:"6px 12px",backgroundColor:`${i.primary}15`,color:i.primary,borderRadius:"6px",fontWeight:"600",fontSize:"14px"},children:[r," mile radius"]}),t.jsx("button",{onClick:o,style:{background:"none",border:"none",color:i.textMuted,cursor:"pointer",fontSize:"24px",lineHeight:1},children:"Ã—"})]})]}),t.jsx("div",{style:{height:"400px"},children:t.jsx(lr,{lat:a,lng:n,radiusMiles:r,theme:i})}),t.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${i.border}`,backgroundColor:i.bgHover,fontSize:"12px",color:i.textSecondary,textAlign:"center"},children:"Recipients within this area will be included in your campaign"})]})]})},cr=({location:e,radius:r,theme:o})=>{const[i,a]=C.useState(!1);return e?t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{marginTop:"12px",borderRadius:"8px",overflow:"hidden",border:`1px solid ${o.border}`},children:t.jsxs("div",{style:{padding:"12px 16px",backgroundColor:o.bgHover,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{fontSize:"20px"},children:"ðŸ“"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:o.text},children:e.display}),t.jsxs("div",{style:{fontSize:"12px",color:o.textSecondary},children:[r," mile radius"]})]})]}),t.jsx("button",{onClick:()=>a(!0),style:{padding:"8px 16px",backgroundColor:o.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"ðŸ—ºï¸ View Map"})]})}),i&&t.jsx(dr,{location:e,radius:r,onClose:()=>a(!1),theme:o})]}):null},pr=({rule:e,index:r,onUpdate:o,onRemove:i,theme:a})=>{const n=dt.find(d=>d.value===e.field),s=n?Mt[n.type]:[],l={padding:"8px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"6px",color:a.text,fontSize:"13px",minWidth:"140px"},c={padding:"8px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"6px",color:a.text,fontSize:"13px",width:"120px"};return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:a.bgCard,borderRadius:"8px",border:`1px solid ${a.border}`,flexWrap:"wrap"},children:[r>0&&t.jsx("span",{style:{fontSize:"12px",color:a.primary,fontWeight:"600",padding:"4px 8px",backgroundColor:`${a.primary}15`,borderRadius:"4px"},children:"AND"}),t.jsxs("select",{value:e.field||"",onChange:d=>o(r,{...e,field:d.target.value,operator:"",value:""}),style:l,children:[t.jsx("option",{value:"",children:"Select field..."}),dt.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))]}),e.field&&t.jsxs("select",{value:e.operator||"",onChange:d=>o(r,{...e,operator:d.target.value}),style:l,children:[t.jsx("option",{value:"",children:"Select condition..."}),s.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))]}),e.field&&e.operator&&t.jsxs(t.Fragment,{children:[(n==null?void 0:n.type)==="select"&&e.operator!=="is_any"&&t.jsxs("select",{value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),style:l,children:[t.jsx("option",{value:"",children:"Select value..."}),n.options.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))]}),(n==null?void 0:n.type)==="select"&&e.operator==="is_any"&&t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:n.options.map(d=>t.jsx("button",{onClick:()=>{const j=e.value?e.value.split(","):[],f=j.includes(d.value)?j.filter(p=>p!==d.value):[...j,d.value];o(r,{...e,value:f.join(",")})},style:{padding:"4px 10px",backgroundColor:(e.value||"").split(",").includes(d.value)?a.primary:a.bgHover,color:(e.value||"").split(",").includes(d.value)?"#fff":a.text,border:`1px solid ${(e.value||"").split(",").includes(d.value)?a.primary:a.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:d.label},d.value))}),(n==null?void 0:n.type)==="number"&&e.operator!=="between"&&t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"0",style:c}),(n==null?void 0:n.type)==="number"&&e.operator==="between"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"Min",style:{...c,width:"80px"}}),t.jsx("span",{style:{fontSize:"13px",color:a.textSecondary},children:"and"}),t.jsx("input",{type:"number",value:e.value2||"",onChange:d=>o(r,{...e,value2:d.target.value}),placeholder:"Max",style:{...c,width:"80px"}})]}),(n==null?void 0:n.type)==="date"&&e.operator==="in_next_days"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"30",style:{...c,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:a.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&e.operator==="in_last_days"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"30",style:{...c,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:a.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&e.operator==="between"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"date",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),style:c}),t.jsx("span",{style:{fontSize:"13px",color:a.textSecondary},children:"and"}),t.jsx("input",{type:"date",value:e.value2||"",onChange:d=>o(r,{...e,value2:d.target.value}),style:c})]}),(n==null?void 0:n.type)==="date"&&(e.operator==="before"||e.operator==="after")&&t.jsx("input",{type:"date",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),style:c}),(n==null?void 0:n.type)==="text"&&!["is_empty","is_not_empty"].includes(e.operator)&&t.jsx("input",{type:"text",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:`Enter ${n.label.toLowerCase()}...`,style:{...c,width:"160px"}}),(n==null?void 0:n.type)==="location"&&t.jsx(ur,{rule:e,onUpdate:d=>o(r,{...e,...d}),theme:a})]}),t.jsx("button",{onClick:()=>i(r),style:{marginLeft:"auto",padding:"6px 10px",backgroundColor:"transparent",border:"none",color:a.textMuted,cursor:"pointer",fontSize:"16px",borderRadius:"4px"},title:"Remove filter",children:"Ã—"})]})},ur=({rule:e,onUpdate:r,theme:o})=>{const[i,a]=C.useState(e.locationDisplay||""),[n,s]=C.useState(!1),[l,c]=C.useState([]),[d,j]=C.useState(!1),f={padding:"8px 12px",backgroundColor:o.bgInput,border:`1px solid ${o.border}`,borderRadius:"6px",color:o.text,fontSize:"13px"},p=async g=>{if(g.length<3){c([]);return}s(!0);try{const y=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&q=${encodeURIComponent(g)}&limit=5`,{headers:{"Accept-Language":"en"}})).json();c(y.map(h=>({display:h.display_name,lat:h.lat,lng:h.lon,type:h.type}))),j(!0)}catch(m){console.error("Geocoding error:",m),c([])}finally{s(!1)}};ke.useEffect(()=>{const g=setTimeout(()=>{i&&i!==e.locationDisplay&&p(i)},300);return()=>clearTimeout(g)},[i]);const v=g=>{a(g.display.split(",").slice(0,2).join(",")),r({value:`${g.lat},${g.lng}`,locationDisplay:g.display.split(",").slice(0,2).join(","),locationData:g}),j(!1)};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",flex:1,minWidth:"300px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[t.jsxs("div",{style:{position:"relative",flex:1,minWidth:"200px"},children:[t.jsx("input",{type:"text",value:i,onChange:g=>a(g.target.value),onFocus:()=>l.length>0&&j(!0),placeholder:"Enter zip code, city, or address...",style:{...f,width:"100%",paddingRight:"30px"}}),n&&t.jsx("span",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:o.textMuted,fontSize:"12px"},children:"..."}),d&&l.length>0&&t.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:o.bgCard,border:`1px solid ${o.border}`,borderRadius:"6px",marginTop:"4px",zIndex:100,maxHeight:"200px",overflow:"auto",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:l.map((g,m)=>t.jsxs("button",{onClick:()=>v(g),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderBottom:m<l.length-1?`1px solid ${o.border}`:"none",color:o.text,fontSize:"12px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"flex-start",gap:"8px"},onMouseEnter:y=>y.target.style.backgroundColor=o.bgHover,onMouseLeave:y=>y.target.style.backgroundColor="transparent",children:[t.jsx("span",{children:"ðŸ“"}),t.jsx("span",{style:{lineHeight:"1.4"},children:g.display})]},m))})]}),t.jsx("span",{style:{fontSize:"13px",color:o.textSecondary},children:"of"}),t.jsx("select",{value:e.radius||"25",onChange:g=>r({radius:g.target.value}),style:{...f,minWidth:"100px"},children:ir.map(g=>t.jsxs("option",{value:g,children:[g," miles"]},g))})]}),e.locationData&&t.jsx(cr,{location:e.locationData,radius:parseInt(e.radius||"25",10),theme:o})]})},xr=({breakdown:e,isLoading:r,theme:o})=>{const[i,a]=C.useState(!1);return r?t.jsx("div",{style:{padding:"12px 16px",backgroundColor:o.bgHover,borderRadius:"8px",marginTop:"12px",fontSize:"13px",color:o.textSecondary},children:"Loading location data..."}):!e||e.byCity.length===0?null:t.jsxs("div",{style:{marginTop:"12px",backgroundColor:o.bgCard,borderRadius:"8px",border:`1px solid ${o.border}`,overflow:"hidden"},children:[t.jsxs("button",{onClick:()=>a(!i),style:{width:"100%",padding:"12px 16px",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",color:o.text},children:[t.jsx("span",{style:{fontSize:"13px",fontWeight:"500"},children:"ðŸ“Š View Recipients by City"}),t.jsx("span",{style:{fontSize:"12px",color:o.textSecondary},children:i?"â–²":"â–¼"})]}),i&&t.jsx("div",{style:{padding:"0 16px 16px"},children:t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:e.byCity.map(({city:n,count:s})=>t.jsxs("div",{style:{padding:"6px 10px",backgroundColor:o.bgHover,borderRadius:"6px",fontSize:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{style:{color:o.text},children:n}),t.jsx("span",{style:{backgroundColor:o.primary,color:"#fff",padding:"2px 6px",borderRadius:"10px",fontSize:"11px",fontWeight:"600"},children:s})]},n))})})]})},gr=({group:e,groupIndex:r,onUpdateGroup:o,onRemoveGroup:i,onAddRule:a,onUpdateRule:n,onRemoveRule:s,showOrLabel:l,theme:c})=>{const d=e.rules||[];return t.jsxs("div",{style:{padding:"16px",backgroundColor:c.bgCard,borderRadius:"12px",border:`2px solid ${c.border}`,position:"relative"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[t.jsxs("span",{style:{fontSize:"12px",fontWeight:"600",color:c.textSecondary,textTransform:"uppercase",letterSpacing:"0.5px"},children:["Group ",r+1]}),t.jsx("button",{onClick:()=>i(r),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:c.textMuted,cursor:"pointer",fontSize:"12px",borderRadius:"4px"},title:"Remove group",children:"Remove Group"})]}),d.length===0?t.jsx("div",{style:{textAlign:"center",padding:"12px",color:c.textMuted,fontSize:"13px"},children:"Add filters to this group"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:d.map((j,f)=>t.jsx(pr,{rule:j,index:f,onUpdate:(p,v)=>n(r,p,v),onRemove:p=>s(r,p),theme:c},f))}),t.jsxs("button",{onClick:()=>a(r),style:{width:"100%",padding:"8px",backgroundColor:c.bgHover,border:`1px dashed ${c.border}`,borderRadius:"6px",color:c.primary,cursor:"pointer",fontSize:"12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[t.jsx("span",{children:"+"})," Add Filter to Group"]})]})},fr=({filterConfig:e,setFilterConfig:r,recipientCount:o,isLoading:i,isFetching:a,locationBreakdown:n,isLoadingBreakdown:s,includeRoleAccounts:l,setIncludeRoleAccounts:c,roleUserCount:d,previewRecipients:j,isLoadingPreview:f,theme:p})=>{var K;const[v,g]=C.useState(!1),m=e.groups||(((K=e.rules)==null?void 0:K.length)>0?[{rules:e.rules}]:[]),y=m.length>0,h=()=>{const T=[...m,{rules:[{field:"",operator:"",value:""}]}];r({...e,groups:T,rules:void 0})},w=T=>{const P=m.filter((M,U)=>U!==T);r({...e,groups:P,rules:void 0})},R=T=>{const P=[...m];P[T]={...P[T],rules:[...P[T].rules||[],{field:"",operator:"",value:""}]},r({...e,groups:P,rules:void 0})},W=(T,P,M)=>{const U=[...m],L=[...U[T].rules||[]];L[P]=M,U[T]={...U[T],rules:L},r({...e,groups:U,rules:void 0})},b=(T,P)=>{const M=[...m];M[T]={...M[T],rules:M[T].rules.filter((U,L)=>L!==P)},M[T].rules.length===0&&M.splice(T,1),r({...e,groups:M,rules:void 0})},_=()=>{r({...e,groups:[],rules:void 0,search:""})},B=m.reduce((T,P)=>T+(P.rules||[]).filter(M=>M.field&&M.operator&&(M.value||["is_empty","is_not_empty"].includes(M.operator))).length,0);return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:p.text,margin:0},children:"Filter Recipients"}),(y||e.search)&&t.jsx("button",{onClick:_,style:{padding:"6px 12px",backgroundColor:"transparent",border:`1px solid ${p.border}`,borderRadius:"6px",color:p.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Clear all"})]}),t.jsxs("div",{style:{padding:"16px",backgroundColor:p.bgCard,borderRadius:"12px",border:`1px solid ${p.border}`,marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:p.textSecondary,marginBottom:"10px"},children:"Quick Filters"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[{label:"Renewals (30 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"30"}},{label:"New Customers (90 days)",filter:{field:"account_created",operator:"in_last_days",value:"90"}},{label:"Not Emailed (30 days)",filter:{field:"last_email_sent",operator:"before",value:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0]}},{label:"Active Customers",filter:{field:"account_status",operator:"is",value:"customer"}},{label:"Cross-Sell: Auto Only",filters:[{field:"active_policy_type",operator:"is",value:"Auto"},{field:"active_policy_type",operator:"is_not",value:"Home"}]},{label:"Cross-Sell: Home Only",filters:[{field:"active_policy_type",operator:"is",value:"Home"},{field:"active_policy_type",operator:"is_not",value:"Auto"}]},{label:"Prior Customers (90 days)",filters:[{field:"account_status",operator:"is",value:"prior_customer"},{field:"last_email_sent",operator:"before",value:new Date(Date.now()-90*24*60*60*1e3).toISOString().split("T")[0]}]},{label:"Prospects (90 days)",filters:[{field:"account_status",operator:"is",value:"prospect"},{field:"last_email_sent",operator:"before",value:new Date(Date.now()-90*24*60*60*1e3).toISOString().split("T")[0]}]}].map((T,P)=>t.jsxs("button",{onClick:()=>{if(T.filters){const M={rules:T.filters};r({...e,groups:[...m,M],rules:void 0})}else{const M={rules:[T.filter]};r({...e,groups:[...m,M],rules:void 0})}},style:{padding:"6px 12px",backgroundColor:p.bgHover,border:`1px solid ${p.border}`,borderRadius:"16px",color:p.text,cursor:"pointer",fontSize:"12px",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:M=>{M.target.style.backgroundColor=p.primary+"20",M.target.style.borderColor=p.primary,M.target.style.color=p.primary},onMouseLeave:M=>{M.target.style.backgroundColor=p.bgHover,M.target.style.borderColor=p.border,M.target.style.color=p.text},children:["+ ",T.label]},P))})]}),t.jsx("div",{style:{padding:"16px",backgroundColor:p.bgCard,borderRadius:"12px",border:`1px solid ${p.border}`,marginBottom:"16px",display:"flex",alignItems:"center",gap:"12px"},children:t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",flex:1},children:[t.jsx("input",{type:"checkbox",checked:l,onChange:T=>c(T.target.checked),style:{width:"18px",height:"18px",cursor:"pointer",accentColor:p.primary}}),t.jsxs("div",{children:[t.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:p.text},children:"Include accounts from users in my role"}),t.jsx("p",{style:{fontSize:"12px",color:p.textSecondary,margin:"2px 0 0"},children:l&&d>1?`Includes accounts from ${d} users with the same role`:"When enabled, includes accounts from all users with the same role as you"})]})]})}),t.jsxs("div",{style:{padding:"16px",backgroundColor:p.bgHover,borderRadius:"12px",marginBottom:"16px"},children:[y?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},children:m.map((T,P)=>t.jsxs("div",{children:[P>0&&t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"8px 0",gap:"12px"},children:[t.jsx("div",{style:{flex:1,height:"1px",backgroundColor:p.border}}),t.jsx("span",{style:{fontSize:"12px",fontWeight:"700",color:"#f59e0b",padding:"4px 12px",backgroundColor:"#f59e0b20",borderRadius:"4px",textTransform:"uppercase",letterSpacing:"1px"},children:"OR"}),t.jsx("div",{style:{flex:1,height:"1px",backgroundColor:p.border}})]}),t.jsx(gr,{group:T,groupIndex:P,onRemoveGroup:w,onAddRule:R,onUpdateRule:W,onRemoveRule:b,showOrLabel:P>0,theme:p})]},P))}):t.jsx("div",{style:{textAlign:"center",padding:"20px",color:p.textMuted,fontSize:"14px"},children:"No filters applied. All accounts with valid emails will be included."}),t.jsx("div",{style:{display:"flex",gap:"8px"},children:t.jsxs("button",{onClick:h,style:{flex:1,padding:"10px",backgroundColor:p.bgCard,border:`1px dashed ${p.border}`,borderRadius:"8px",color:p.primary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," ",y?"Add OR Group":"Add Filter Group"]})})]}),B>0&&t.jsxs("div",{style:{padding:"12px 16px",backgroundColor:`${p.primary}10`,borderRadius:"8px",marginBottom:"16px",fontSize:"13px",color:p.text},children:[t.jsx("strong",{children:B})," filter",B!==1?"s":""," in ",t.jsx("strong",{children:m.length})," group",m.length!==1?"s":"",m.length>1&&t.jsx("span",{style:{color:p.textSecondary},children:" (groups combined with OR)"}),t.jsx("span",{style:{color:p.textSecondary},children:" â€” results update automatically"})]}),t.jsxs("button",{onClick:()=>g(!0),disabled:i||o===0,style:{width:"100%",padding:"20px",backgroundColor:`${p.primary}10`,borderRadius:"12px",border:`1px solid ${p.primary}30`,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:i||o===0?"default":"pointer",textAlign:"left",transition:"all 0.2s"},onMouseEnter:T=>{!i&&o>0&&(T.currentTarget.style.backgroundColor=`${p.primary}18`,T.currentTarget.style.borderColor=`${p.primary}50`)},onMouseLeave:T=>{T.currentTarget.style.backgroundColor=`${p.primary}10`,T.currentTarget.style.borderColor=`${p.primary}30`},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:p.text},children:"Matching Recipients"}),t.jsx("div",{style:{fontSize:"12px",color:p.textSecondary},children:a&&o!==void 0?"Updating count...":o>0?"Click to view matching accounts":"Accounts with valid emails who haven't opted out"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:p.primary,opacity:a?.6:1,transition:"opacity 0.2s"},children:i?"...":(o??0).toLocaleString()}),!i&&o>0&&t.jsx("div",{style:{padding:"6px 10px",backgroundColor:p.primary,color:"#fff",borderRadius:"6px",fontSize:"12px",fontWeight:"500"},children:"View"})]})]}),t.jsx(xr,{breakdown:n,isLoading:s,theme:p}),v&&t.jsx(sr,{recipients:j,filterConfig:e,isLoading:f,onClose:()=>g(!1),theme:p})]})},mr=({template:e,filterConfig:r,subject:o,setSubject:i,name:a,setName:n,scheduleOption:s,setScheduleOption:l,scheduledDate:c,setScheduledDate:d,scheduledTime:j,setScheduledTime:f,recipients:p,isLoadingRecipients:v,theme:g})=>{const m=new Date().toISOString().split("T")[0];return t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:g.text,marginBottom:"16px"},children:"Review & Send"}),t.jsxs("div",{style:{padding:"20px",backgroundColor:g.bgCard,borderRadius:"12px",border:`1px solid ${g.border}`,marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:g.text,display:"block",marginBottom:"6px"},children:"Campaign Name"}),t.jsx("input",{type:"text",placeholder:"e.g., December Newsletter",value:a,onChange:y=>n(y.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:g.bgInput,border:`1px solid ${g.border}`,borderRadius:"8px",color:g.text,fontSize:"14px"}})]}),t.jsxs("div",{style:{padding:"20px",backgroundColor:g.bgCard,borderRadius:"12px",border:`1px solid ${g.border}`,marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:g.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),t.jsx("input",{type:"text",placeholder:"Email subject...",value:o,onChange:y=>i(y.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:g.bgInput,border:`1px solid ${g.border}`,borderRadius:"8px",color:g.text,fontSize:"14px"}}),t.jsxs("p",{style:{fontSize:"12px",color:g.textMuted,marginTop:"6px"},children:["Use merge fields like ","{{first_name}}"," for personalization"]})]}),t.jsxs("div",{style:{padding:"20px",backgroundColor:g.bgCard,borderRadius:"12px",border:`1px solid ${g.border}`,marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:g.text,display:"block",marginBottom:"12px"},children:"When to Send"}),t.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:[t.jsxs("button",{type:"button",onClick:()=>l("now"),style:{flex:1,padding:"12px 16px",backgroundColor:s==="now"?`${g.primary}15`:g.bgHover,border:`2px solid ${s==="now"?g.primary:g.border}`,borderRadius:"8px",color:s==="now"?g.primary:g.text,cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"18px"},children:"âš¡"}),"Send Now"]}),t.jsxs("button",{type:"button",onClick:()=>l("scheduled"),style:{flex:1,padding:"12px 16px",backgroundColor:s==="scheduled"?`${g.primary}15`:g.bgHover,border:`2px solid ${s==="scheduled"?g.primary:g.border}`,borderRadius:"8px",color:s==="scheduled"?g.primary:g.text,cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"18px"},children:"ðŸ“…"}),"Schedule for Later"]})]}),s==="scheduled"&&t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",padding:"16px",backgroundColor:g.bgHover,borderRadius:"8px"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"12px",color:g.textSecondary,display:"block",marginBottom:"6px"},children:"Date"}),t.jsx("input",{type:"date",value:c,onChange:y=>d(y.target.value),min:m,style:{width:"100%",padding:"10px 12px",backgroundColor:g.bgInput,border:`1px solid ${g.border}`,borderRadius:"8px",color:g.text,fontSize:"14px"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"12px",color:g.textSecondary,display:"block",marginBottom:"6px"},children:"Time"}),t.jsx("input",{type:"time",value:j,onChange:y=>f(y.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:g.bgInput,border:`1px solid ${g.border}`,borderRadius:"8px",color:g.text,fontSize:"14px"}})]}),t.jsx("div",{style:{gridColumn:"1 / -1"},children:t.jsx("p",{style:{fontSize:"12px",color:g.textMuted,margin:0},children:"Emails will be sent at the scheduled time in your local timezone"})})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[t.jsxs("div",{style:{padding:"16px",backgroundColor:g.bgCard,borderRadius:"12px",border:`1px solid ${g.border}`},children:[t.jsx("div",{style:{fontSize:"12px",color:g.textMuted,marginBottom:"4px"},children:"Template"}),t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:g.text},children:e==null?void 0:e.name})]}),t.jsxs("div",{style:{padding:"16px",backgroundColor:g.bgCard,borderRadius:"12px",border:`1px solid ${g.border}`},children:[t.jsx("div",{style:{fontSize:"12px",color:g.textMuted,marginBottom:"4px"},children:"Recipients"}),t.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:g.text},children:[v?"...":((p==null?void 0:p.length)||0).toLocaleString()," accounts"]})]})]}),p&&p.length>0&&t.jsxs("div",{style:{padding:"16px",backgroundColor:g.bgCard,borderRadius:"12px",border:`1px solid ${g.border}`},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:g.text,marginBottom:"12px"},children:"Preview Recipients (first 10)"}),t.jsx("div",{style:{maxHeight:"200px",overflow:"auto"},children:p.slice(0,10).map((y,h)=>t.jsxs("div",{style:{padding:"8px 0",borderBottom:h<Math.min(9,p.length-1)?`1px solid ${g.border}`:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",color:g.text},children:y.primary_contact_first_name?`${y.primary_contact_first_name} ${y.primary_contact_last_name||""}`:y.name}),t.jsx("div",{style:{fontSize:"12px",color:g.textMuted},children:y.person_email||y.email})]}),t.jsx("span",{style:{padding:"2px 8px",backgroundColor:g.bgHover,color:g.textSecondary,borderRadius:"4px",fontSize:"11px",textTransform:"capitalize"},children:y.account_status})]},y.account_unique_id))}),p.length>10&&t.jsxs("div",{style:{fontSize:"12px",color:g.textMuted,marginTop:"8px",textAlign:"center"},children:["+",p.length-10," more recipients"]})]})]})},yr=({t:e})=>{const{userId:r}=de(),o=he(),[i,a]=C.useState(!1),[n,s]=C.useState(!1),[l,c]=C.useState(0),[d,j]=C.useState(null),[f,p]=C.useState({rules:[],search:"",notOptedOut:!0}),[v,g]=C.useState(!1),[m,y]=C.useState(""),[h,w]=C.useState(""),[R,W]=C.useState("now"),[b,_]=C.useState(""),[B,K]=C.useState("09:00"),[T,P]=C.useState(!1),[M,U]=C.useState(null),[L,N]=C.useState(null),{data:H,isLoading:E}=$t(),u=((H==null?void 0:H.length)||0)>0,{data:$,isLoading:V,refetch:Y}=pt(),{data:X,isLoading:D,refetch:A}=ho(),{data:S}=Rt(v),{data:I,isLoading:k,isFetching:q}=It(l>=1?f:null,v),{data:et,isLoading:ze}=bo(l>=1?f:null,v),{data:Re,isLoading:J}=st(l>=1?f:null,{limit:500}),{data:qe,isLoading:We}=st(l===2?f:null,{limit:100}),{createBatch:Ee,scheduleBatch:Le}=vo(),{createTemplate:Pe}=_t(),Oe=["Select Template","Filter Recipients","Review & Send"],Fe=ne=>{j(ne),y(ne.subject||"")},Ne=async ne=>{const ge=await Pe.mutateAsync(ne);return await Y(),ge},He=ne=>{s(!1),ne&&(j(ne),y(ne.subject||""))},Ue=()=>{l<2&&c(l+1)},Ge=()=>{l>0&&c(l-1)},Ve=async()=>{if(!(!d||!m)){if(R==="scheduled"){if(!b||!B){U("Please select a date and time for the scheduled send");return}if(new Date(`${b}T${B}`)<=new Date){U("Scheduled time must be in the future");return}}P(!0),U(null);try{const ne=await Ee.mutateAsync({name:h||`Mass Email - ${new Date().toLocaleDateString()}`,subject:m,template_id:d.id,filter_config:f,total_recipients:I||0});let ge=null;if(R==="scheduled"&&b&&B&&(ge=new Date(`${b}T${B}`).toISOString()),await Le.mutateAsync({batchId:ne.id,scheduledFor:ge}),R==="scheduled"){const Ke=new Date(`${b}T${B}`).toLocaleString();N(`Successfully scheduled ${I} emails for ${Ke}`)}else N(`Successfully scheduled ${I} emails for sending!`);a(!1),Ae(),A()}catch(ne){U(ne.message||"Failed to send mass email")}finally{P(!1)}}},Ae=()=>{c(0),j(null),p({rules:[],search:"",notOptedOut:!0}),g(!1),y(""),w(""),W("now"),_(""),K("09:00")},xe=()=>l===0?!!d:l===1?(I||0)>0:l===2?!!m&&!!h:!1;return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Mass Email"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Send one-off emails to filtered recipients"})]}),!i&&t.jsxs("button",{onClick:()=>u?a(!0):null,disabled:E||!u,title:u?"":"You need a verified sender domain to create campaigns",style:{padding:"10px 20px",backgroundColor:u?e.primary:e.textMuted,border:"none",borderRadius:"8px",color:"#fff",cursor:u?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px",opacity:E?.7:1},children:[t.jsx("span",{children:"+"})," New Campaign"]})]}),!E&&!u&&!i&&t.jsxs("div",{style:{padding:"20px",backgroundColor:`${e.warning}15`,border:`1px solid ${e.warning}30`,borderRadius:"12px",marginBottom:"24px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Sender Domain Required"}),t.jsx("div",{style:{fontSize:"14px",color:e.textSecondary},children:"You need to add and verify a sender domain before you can send mass emails. This ensures emails are delivered from your agency's domain."})]}),t.jsx("button",{onClick:()=>o("/settings"),style:{padding:"10px 20px",backgroundColor:e.warning,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",whiteSpace:"nowrap"},children:"Add Domain"})]}),L&&t.jsxs("div",{style:{padding:"16px",backgroundColor:`${e.success}15`,border:`1px solid ${e.success}30`,borderRadius:"8px",marginBottom:"24px",color:e.success,fontSize:"14px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[L,t.jsx("button",{onClick:()=>N(null),style:{background:"none",border:"none",color:e.success,cursor:"pointer"},children:"Ã—"})]}),i?t.jsxs("div",{style:{backgroundColor:e.bgCard,borderRadius:"16px",border:`1px solid ${e.border}`,padding:"24px"},children:[t.jsx(rr,{currentStep:l,steps:Oe,theme:e}),M&&t.jsx("div",{style:{padding:"12px 16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"16px",color:e.danger,fontSize:"14px"},children:M}),t.jsxs("div",{style:{minHeight:"300px"},children:[l===0&&t.jsx(nr,{selectedTemplate:d,onSelect:Fe,onCreateNew:()=>s(!0),templates:$,isLoading:V,theme:e}),l===1&&t.jsx(fr,{filterConfig:f,setFilterConfig:p,recipientCount:I,isLoading:k,isFetching:q,locationBreakdown:et,isLoadingBreakdown:ze,includeRoleAccounts:v,setIncludeRoleAccounts:g,roleUserCount:(S==null?void 0:S.length)||1,previewRecipients:Re,isLoadingPreview:J,theme:e}),l===2&&t.jsx(mr,{template:d,filterConfig:f,subject:m,setSubject:y,name:h,setName:w,scheduleOption:R,setScheduleOption:W,scheduledDate:b,setScheduledDate:_,scheduledTime:B,setScheduledTime:K,recipients:qe,isLoadingRecipients:We,theme:e})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"24px",borderTop:`1px solid ${e.border}`,marginTop:"24px"},children:[t.jsx("button",{onClick:()=>{l===0?(a(!1),Ae()):Ge()},style:{padding:"10px 20px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,cursor:"pointer",fontSize:"14px"},children:l===0?"Cancel":"Back"}),l<2?t.jsx("button",{onClick:Ue,disabled:!xe(),style:{padding:"10px 24px",backgroundColor:xe()?e.primary:e.bgHover,border:"none",borderRadius:"8px",color:xe()?"#fff":e.textMuted,cursor:xe()?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500"},children:"Continue"}):t.jsx("button",{onClick:Ve,disabled:!xe()||T,style:{padding:"10px 24px",backgroundColor:xe()&&!T?e.success:e.bgHover,border:"none",borderRadius:"8px",color:xe()&&!T?"#fff":e.textMuted,cursor:xe()&&!T?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px"},children:T?R==="scheduled"?"Scheduling...":"Sending...":R==="scheduled"?"Schedule Emails":"Send Emails"})]})]}):t.jsx(t.Fragment,{children:t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Recent Campaigns"}),D?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:Array.from({length:3}).map((ne,ge)=>t.jsxs("div",{style:{padding:"16px",backgroundColor:e.bgCard,borderRadius:"10px",border:`1px solid ${e.border}`},children:[t.jsx(Xe,{width:"200px",height:"18px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Xe,{width:"300px",height:"14px"})})]},ge))}):X&&X.length>0?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:X.map(ne=>t.jsx(or,{batch:ne,onView:ge=>console.log("View batch:",ge),theme:e},ne.id))}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ“§"}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:"No campaigns yet"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:"Create your first mass email campaign to reach your clients."}),t.jsx("button",{onClick:()=>a(!0),style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Campaign"})]})]})}),n&&t.jsx(tr,{template:null,onSave:Ne,onClose:He,theme:e})]})},hr=C.createContext(),it={light:{bg:"#f8fafc",bgCard:"#ffffff",bgSidebar:"#ffffff",bgHover:"#f1f5f9",bgInput:"#ffffff",border:"#e2e8f0",borderLight:"#f1f5f9",text:"#1e293b",textSecondary:"#64748b",textMuted:"#94a3b8",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},dark:{bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"}},br=C.createContext(),vr=({t:e})=>{const r=he(),{isAdmin:o,isAgencyAdmin:i,user:a,impersonate:n,impersonating:s}=ve(),[l,c]=C.useState(!1),[d,j]=C.useState(""),[f,p]=C.useState([]),[v,g]=C.useState(!1),m=ke.useRef(null);if(!o&&!i)return null;const y=async(_="")=>{g(!0);try{if(o){const B=await ue.getAllUsers(_);p(B)}else if(i&&(a!=null&&a.profileName)){const B=await ue.getAgencyAgents(a.profileName,a.id,_);p(B)}}catch(B){console.error("Error fetching users:",B)}finally{g(!1)}},h=async()=>{c(!0),await y()},w=_=>{j(_),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{y(_)},300)},R=_=>{const B=`${_.first_name||""} ${_.last_name||""}`.trim()||_.email;n(_.user_unique_id,B,_.profile_name),c(!1),j(""),r(`/${_.user_unique_id}/dashboard`)},W=()=>o?"View As User":"View As Agent",b=()=>o?"Select a user to impersonate":"Select an agent in your agency to impersonate";return t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:h,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",color:e.textSecondary,cursor:"pointer",fontSize:"13px",textAlign:"left",alignItems:"center",gap:"10px"},children:[t.jsx("span",{children:"ðŸ‘ï¸"})," ",W(),s.active&&t.jsx("span",{style:{marginLeft:"auto",padding:"2px 6px",backgroundColor:e.warning,borderRadius:"4px",fontSize:"9px",color:"#fff",fontWeight:"600"},children:"ACTIVE"})]}),l&&t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>c(!1),children:t.jsxs("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",width:"400px",maxHeight:"500px",overflow:"hidden",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:_=>_.stopPropagation(),children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:e.text},children:W()}),t.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:e.textMuted},children:b()})]}),t.jsx("div",{style:{padding:"12px 20px"},children:t.jsx("input",{type:"text",placeholder:"Search by name or email...",value:d,onChange:_=>w(_.target.value),style:{width:"100%",padding:"10px 12px",fontSize:"14px",border:`1px solid ${e.border}`,borderRadius:"8px",backgroundColor:e.bgInput,color:e.text,outline:"none"},autoFocus:!0})}),t.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",padding:"0 12px 12px"},children:v?t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted},children:"Loading..."}):f.length===0?t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted},children:"No users found"}):f.map(_=>{const B=`${_.first_name||""} ${_.last_name||""}`.trim()||"Unknown";return t.jsxs("button",{onClick:()=>R(_),style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",textAlign:"left",alignItems:"center",gap:"12px",marginBottom:"4px"},onMouseEnter:K=>K.currentTarget.style.backgroundColor=e.bgHover,onMouseLeave:K=>K.currentTarget.style.backgroundColor="transparent",children:[t.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:e.bgHover,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",flexShrink:0},children:"ðŸ‘¤"}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:e.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:B}),t.jsx("div",{style:{fontSize:"12px",color:e.textMuted,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:_.email})]})]},_.user_unique_id)})}),t.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${e.border}`,display:"flex",justifyContent:"flex-end"},children:t.jsx("button",{onClick:()=>c(!1),style:{padding:"8px 16px",fontSize:"13px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"6px",color:e.text,cursor:"pointer"},children:"Cancel"})})]})})]})},_r=()=>{const{userId:e}=de(),r=ct(),o=he(),[i,a]=C.useState(!1),{user:n,isAdmin:s,impersonating:l,logout:c}=ve(),{data:d}=re({queryKey:["currentUser",e],queryFn:()=>be.getCurrentUser(e),enabled:!!e}),[j,f]=C.useState({id:e,name:"",email:"",org:""});C.useEffect(()=>{d&&f({id:e,name:`${d.first_name||""} ${d.last_name||""}`.trim()||"Unknown User",email:d.email||"",org:d.profile_name||""})},[d,e]),C.useEffect(()=>{n&&e&&!l.active&&n.id!==e&&!s&&o(`/${n.id}/dashboard`,{replace:!0})},[n,e,s,l.active,o]);const p=i?it.dark:it.light,g=(()=>{const w=r.pathname.split("/").slice(2).join("/");return w.startsWith("automations/")?"automations":w.startsWith("accounts/")?"accounts":w||"dashboard"})(),m=[{id:"dashboard",label:"Dashboard",icon:"ðŸ“Š",path:`/${e}/dashboard`},{id:"automations",label:"Automations",icon:"âš¡",path:`/${e}/automations`},{id:"templates",label:"Templates",icon:"ðŸ“",path:`/${e}/templates`},{id:"mass-email",label:"Mass Email",icon:"ðŸ“§",path:`/${e}/mass-email`},{id:"accounts",label:"Accounts",icon:"ðŸ‘¥",path:`/${e}/accounts`},{id:"settings",label:"Settings",icon:"âš™ï¸",path:`/${e}/settings`}],y=async()=>{await c(),o("/login")},h=l.active?"44px":"0px";return t.jsx(hr.Provider,{value:{isDark:i,setIsDark:a,t:p,themes:it},children:t.jsxs(br.Provider,{value:{userId:e,currentUser:j,setCurrentUser:f},children:[t.jsx(Yt,{}),t.jsxs("div",{style:{fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",backgroundColor:p.bg,minHeight:"100vh",display:"flex",color:p.text,paddingTop:h},children:[t.jsxs("div",{style:{width:"220px",backgroundColor:p.bgSidebar,borderRight:`1px solid ${p.border}`,display:"flex",flexDirection:"column",position:"fixed",top:h,left:0,bottom:0},children:[t.jsx("div",{style:{padding:"20px 16px",borderBottom:`1px solid ${p.border}`},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:p.primary,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"18px"},children:"ðŸ“§"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"700",fontSize:"14px",color:p.text},children:"Email Automation"}),t.jsx("div",{style:{fontSize:"11px",color:p.textMuted},children:"Marketing System"})]})]})}),t.jsxs("div",{style:{flex:1,padding:"12px 8px",overflowY:"auto"},children:[t.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:p.textMuted,padding:"8px 12px",textTransform:"uppercase"},children:"Navigation"}),m.map(w=>t.jsxs(Ce,{to:w.path,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:g===w.id?`${p.primary}15`:"transparent",border:"none",borderRadius:"8px",color:g===w.id?p.primary:p.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:g===w.id?"600":"400",textAlign:"left",alignItems:"center",gap:"10px",marginBottom:"2px",textDecoration:"none"},children:[t.jsx("span",{children:w.icon})," ",w.label]},w.id)),t.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:p.textMuted,padding:"16px 12px 8px",textTransform:"uppercase"},children:"Admin"}),t.jsxs(Ce,{to:`/${e}/timeline`,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:g==="timeline"?`${p.primary}15`:"transparent",border:"none",borderRadius:"8px",color:g==="timeline"?p.primary:p.textSecondary,cursor:"pointer",fontSize:"13px",textAlign:"left",alignItems:"center",gap:"10px",textDecoration:"none"},children:[t.jsx("span",{children:"ðŸ“ˆ"})," Timeline",t.jsx("span",{style:{marginLeft:"auto",padding:"2px 8px",backgroundColor:p.bgHover,borderRadius:"4px",fontSize:"10px",color:p.textMuted},children:"Admin"})]}),t.jsx(vr,{t:p})]}),t.jsxs("div",{style:{padding:"16px",borderTop:`1px solid ${p.border}`},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"12px"},children:[t.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:p.bgHover,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:"ðŸ‘¤"}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:p.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l.active?j.name:n==null?void 0:n.name}),t.jsx("div",{style:{fontSize:"11px",color:p.textMuted,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l.active?j.email:n==null?void 0:n.email})]})]}),t.jsxs("button",{onClick:y,style:{width:"100%",padding:"8px 12px",fontSize:"13px",backgroundColor:"transparent",border:`1px solid ${p.border}`,borderRadius:"6px",color:p.textSecondary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:"ðŸšª"})," Sign Out"]})]})]}),t.jsxs("div",{style:{flex:1,marginLeft:"220px"},children:[t.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${p.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:p.bgCard},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[t.jsx("div",{style:{fontSize:"11px",color:p.textMuted},children:l.active?t.jsxs("span",{children:["Viewing as: ",t.jsx("strong",{children:j.name})]}):t.jsxs("span",{children:["User: ",e==null?void 0:e.substring(0,8),"..."]})}),t.jsx(Jt,{t:p})]}),t.jsx("button",{onClick:()=>a(!i),style:{padding:"8px 12px",backgroundColor:p.bgHover,border:`1px solid ${p.border}`,borderRadius:"8px",color:p.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:i?"â˜€ï¸ Light":"ðŸŒ™ Dark"})]}),t.jsx("div",{style:{padding:"24px"},children:t.jsxs(bt,{children:[t.jsx(se,{path:"dashboard",element:t.jsx(xt,{t:p})}),t.jsx(se,{path:"automations",element:t.jsx(ko,{t:p})}),t.jsx(se,{path:"automations/new",element:t.jsx(yt,{t:p})}),t.jsx(se,{path:"automations/:automationId",element:t.jsx(yt,{t:p})}),t.jsx(se,{path:"templates",element:t.jsx(Ao,{t:p})}),t.jsx(se,{path:"mass-email",element:t.jsx(yr,{t:p})}),t.jsx(se,{path:"accounts",element:t.jsx(To,{t:p})}),t.jsx(se,{path:"accounts/:accountId",element:t.jsx(Wo,{t:p})}),t.jsx(se,{path:"settings",element:t.jsx(No,{t:p})}),t.jsx(se,{path:"timeline",element:t.jsx(Sr,{t:p})}),t.jsx(se,{path:"*",element:t.jsx(xt,{t:p})})]})})]})]})]})})},Sr=({t:e})=>t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Activity Timeline"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px"},children:"View all email activity across your organization"}),t.jsxs("div",{style:{marginTop:"24px",padding:"60px",textAlign:"center",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ“ˆ"}),t.jsx("p",{style:{color:e.textMuted},children:"Timeline view coming soon..."})]})]}),jr=()=>{const e=he(),{isAuthenticated:r,isLoading:o,user:i}=ve();return C.useEffect(()=>{o||(r&&(i!=null&&i.id)?e(`/${i.id}/dashboard`,{replace:!0}):e("/login",{replace:!0}))},[r,o,i,e]),t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"'Inter', sans-serif"},children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"16px"},children:"â³"}),t.jsx("div",{children:"Loading..."})]})})},wr=()=>t.jsxs(Wt,{client:Ht,children:[t.jsx(Ot,{children:t.jsx(Vt,{children:t.jsxs(bt,{children:[t.jsx(se,{path:"/login",element:t.jsx(Kt,{})}),t.jsx(se,{path:"/",element:t.jsx(jr,{})}),t.jsx(se,{path:"/:userId/*",element:t.jsx(Qt,{children:t.jsx(_r,{})})})]})})}),t.jsx(Nt,{initialIsOpen:!1})]});at.createRoot(document.getElementById("root")).render(t.jsx(ke.StrictMode,{children:t.jsx(wr,{})}));
