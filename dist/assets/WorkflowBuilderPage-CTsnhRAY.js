import{u as Re,b as $e,c as G,j as e}from"./query-BgC-0ePs.js";import{e as Se,r as R,u as Ae,c as Me}from"./vendor-CvdBrt7H.js";import{b as O}from"./index-laD0T8Yw.js";import{b as Ie,a as We}from"./useAutomations-DUarEmo4.js";import{u as De}from"./useTemplates-BV1KRl1Y.js";import{u as Le,a as Be}from"./useMassEmails-dmaXbuhX.js";import"./supabase-GtAdROLV.js";import"./useEffectiveOwner-BN9vJCNM.js";import"./massEmails-cdFsY1gu.js";const He=()=>{const{userId:o}=Se();return o};function Ne(){const o=He();return Re({queryKey:["isAdmin",o],queryFn:()=>O.isAdmin(o),enabled:!!o,staleTime:5*60*1e3})}function Ee(){const o=$e(),i=()=>{o.invalidateQueries({queryKey:["masterAutomations"]}),o.invalidateQueries({queryKey:["masterAutomation"]}),o.invalidateQueries({queryKey:["automations"]}),o.invalidateQueries({queryKey:["automation"]})},d=G({mutationFn:c=>O.createMasterAutomation(c),onSuccess:i}),v=G({mutationFn:({defaultKey:c,updates:n})=>O.updateMasterAutomation(c,n),onSuccess:i}),x=G({mutationFn:c=>O.deleteMasterAutomation(c),onSuccess:i}),t=G({mutationFn:c=>O.syncMasterAutomation(c),onSuccess:()=>{o.invalidateQueries({queryKey:["automations"]}),o.invalidateQueries({queryKey:["automation"]})}}),u=G({mutationFn:()=>O.syncAllMasterAutomations(),onSuccess:()=>{o.invalidateQueries({queryKey:["automations"]}),o.invalidateQueries({queryKey:["automation"]})}});return{createMasterAutomation:d,updateMasterAutomation:v,deleteMasterAutomation:x,syncMasterAutomation:t,syncAllMasterAutomations:u}}const oe=[{value:"account_status",label:"Account Status",type:"select",options:[{value:"customer",label:"Customer"},{value:"prospect",label:"Prospect"},{value:"prior_customer",label:"Prior Customer"},{value:"lead",label:"Lead"}]},{value:"policy_type",label:"Policy Type",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"active_policy_type",label:"Has Active Policy",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"policy_status",label:"Policy Status",type:"select",options:[{value:"active",label:"Active"},{value:"pending active",label:"Pending Active"},{value:"cancelled",label:"Cancelled"},{value:"expired",label:"Expired"}]},{value:"policy_class",label:"Policy Class",type:"select",options:[{value:"Personal",label:"Personal"},{value:"Commercial",label:"Commercial"}]},{value:"policy_count",label:"Number of Policies",type:"number"},{value:"policy_term",label:"Policy Term",type:"select",options:[{value:"6",label:"6 Months"},{value:"12",label:"12 Months"}]},{value:"policy_effective",label:"Policy Effective Date",type:"date"},{value:"policy_expiration",label:"Policy Expiration",type:"date"},{value:"state",label:"State",type:"select",options:[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}]},{value:"city",label:"City",type:"text"},{value:"zip_code",label:"ZIP Code",type:"text"},{value:"email_domain",label:"Email Domain",type:"text"},{value:"last_email_sent",label:"Last Email Sent",type:"date"},{value:"account_created",label:"Account Created",type:"date"}],Ce={select:[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"is_any",label:"is any of"},{value:"is_not_any",label:"is not any of"}],number:[{value:"equals",label:"equals"},{value:"greater_than",label:"greater than"},{value:"less_than",label:"less than"},{value:"at_least",label:"at least"},{value:"at_most",label:"at most"},{value:"between",label:"is between"}],date:[{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"between",label:"is between"},{value:"in_next_days",label:"is in the next"},{value:"in_last_days",label:"was in the last"},{value:"more_than_days_future",label:"is more than X days from now"},{value:"less_than_days_future",label:"is less than X days from now"},{value:"more_than_days_ago",label:"was more than X days ago"},{value:"less_than_days_ago",label:"was less than X days ago"},{value:"exactly_days_future",label:"is exactly X days from now"},{value:"exactly_days_ago",label:"was exactly X days ago"}],text:[{value:"contains",label:"contains"},{value:"not_contains",label:"does not contain"},{value:"equals",label:"equals"},{value:"not_equals",label:"does not equal"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"},{value:"is_empty",label:"is empty"},{value:"is_not_empty",label:"is not empty"}]},Fe=[{label:"Renewals (30 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"30"}},{label:"Renewals (60 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"60"}},{label:"Renewals (90 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"90"}},{label:"New Customers (90 days)",filter:{field:"account_created",operator:"in_last_days",value:"90"}},{label:"Active Customers",filter:{field:"account_status",operator:"is",value:"customer"}},{label:"Cross-Sell: Auto Only",filters:[{field:"active_policy_type",operator:"is",value:"Auto"},{field:"active_policy_type",operator:"is_not",value:"Home"}]},{label:"Cross-Sell: Home Only",filters:[{field:"active_policy_type",operator:"is",value:"Home"},{field:"active_policy_type",operator:"is_not",value:"Auto"}]},{label:"Prior Customers",filter:{field:"account_status",operator:"is",value:"prior_customer"}},{label:"Prospects",filter:{field:"account_status",operator:"is",value:"prospect"}}],Pe=(o,i)=>{const v=(Ce[o]||[]).find(x=>x.value===i);return(v==null?void 0:v.label)||i},je=o=>{const i=oe.find(t=>t.value===o.field);if(!i)return null;const d=i.label,v=Pe(i.type,o.operator);let x=o.value;if(i.type==="select"&&i.options)if(o.operator==="is_any"||o.operator==="is_not_any")x=(o.value||"").split(",").map(u=>{const c=i.options.find(n=>n.value===u);return(c==null?void 0:c.label)||u}).join(", ");else{const t=i.options.find(u=>u.value===o.value);x=(t==null?void 0:t.label)||o.value}return o.operator==="is_empty"||o.operator==="is_not_empty"?`${d} ${v}`:o.operator==="between"&&o.value2?`${d} ${v} ${o.value} and ${o.value2}`:o.operator==="in_next_days"||o.operator==="in_last_days"?`${d} ${v} ${o.value} days`:o.operator==="more_than_days_future"?`${d} is more than ${o.value} days from now`:o.operator==="less_than_days_future"?`${d} is less than ${o.value} days from now`:o.operator==="more_than_days_ago"?`${d} was more than ${o.value} days ago`:o.operator==="less_than_days_ago"?`${d} was less than ${o.value} days ago`:o.operator==="exactly_days_future"?`${d} is exactly ${o.value} days from now`:o.operator==="exactly_days_ago"?`${d} was exactly ${o.value} days ago`:`${d} ${v} ${x}`},Te=({rule:o,index:i,onUpdate:d,onRemove:v,theme:x})=>{const t=oe.find(s=>s.value===o.field),u=t?Ce[t.type]:[],c={padding:"8px 12px",backgroundColor:x.bgInput,border:`1px solid ${x.border}`,borderRadius:"6px",color:x.text,fontSize:"13px",minWidth:"140px"},n={padding:"8px 12px",backgroundColor:x.bgInput,border:`1px solid ${x.border}`,borderRadius:"6px",color:x.text,fontSize:"13px",width:"120px"};return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:x.bgCard,borderRadius:"8px",border:`1px solid ${x.border}`,flexWrap:"wrap"},children:[i>0&&e.jsx("span",{style:{fontSize:"12px",color:x.primary,fontWeight:"600",padding:"4px 8px",backgroundColor:`${x.primary}15`,borderRadius:"4px"},children:"AND"}),e.jsxs("select",{value:o.field||"",onChange:s=>d(i,{...o,field:s.target.value,operator:"",value:""}),style:c,children:[e.jsx("option",{value:"",children:"Select field..."}),oe.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),o.field&&e.jsxs("select",{value:o.operator||"",onChange:s=>d(i,{...o,operator:s.target.value}),style:c,children:[e.jsx("option",{value:"",children:"Select condition..."}),u.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),o.field&&o.operator&&e.jsxs(e.Fragment,{children:[(t==null?void 0:t.type)==="select"&&!["is_any","is_not_any"].includes(o.operator)&&e.jsxs("select",{value:o.value||"",onChange:s=>d(i,{...o,value:s.target.value}),style:c,children:[e.jsx("option",{value:"",children:"Select value..."}),t.options.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),(t==null?void 0:t.type)==="select"&&["is_any","is_not_any"].includes(o.operator)&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:t.options.map(s=>e.jsx("button",{onClick:()=>{const $=o.value?o.value.split(","):[],b=$.includes(s.value)?$.filter(k=>k!==s.value):[...$,s.value];d(i,{...o,value:b.join(",")})},style:{padding:"4px 10px",backgroundColor:(o.value||"").split(",").includes(s.value)?x.primary:x.bgHover,color:(o.value||"").split(",").includes(s.value)?"#fff":x.text,border:`1px solid ${(o.value||"").split(",").includes(s.value)?x.primary:x.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:s.label},s.value))}),(t==null?void 0:t.type)==="number"&&o.operator!=="between"&&e.jsx("input",{type:"number",value:o.value||"",onChange:s=>d(i,{...o,value:s.target.value}),placeholder:"0",style:n}),(t==null?void 0:t.type)==="number"&&o.operator==="between"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:o.value||"",onChange:s=>d(i,{...o,value:s.target.value}),placeholder:"Min",style:{...n,width:"80px"}}),e.jsx("span",{style:{fontSize:"13px",color:x.textSecondary},children:"and"}),e.jsx("input",{type:"number",value:o.value2||"",onChange:s=>d(i,{...o,value2:s.target.value}),placeholder:"Max",style:{...n,width:"80px"}})]}),(t==null?void 0:t.type)==="date"&&o.operator==="in_next_days"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:o.value||"",onChange:s=>d(i,{...o,value:s.target.value}),placeholder:"30",style:{...n,width:"70px"}}),e.jsx("span",{style:{fontSize:"13px",color:x.textSecondary},children:"days"})]}),(t==null?void 0:t.type)==="date"&&o.operator==="in_last_days"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:o.value||"",onChange:s=>d(i,{...o,value:s.target.value}),placeholder:"30",style:{...n,width:"70px"}}),e.jsx("span",{style:{fontSize:"13px",color:x.textSecondary},children:"days"})]}),(t==null?void 0:t.type)==="date"&&o.operator==="between"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"date",value:o.value||"",onChange:s=>d(i,{...o,value:s.target.value}),style:n}),e.jsx("span",{style:{fontSize:"13px",color:x.textSecondary},children:"and"}),e.jsx("input",{type:"date",value:o.value2||"",onChange:s=>d(i,{...o,value2:s.target.value}),style:n})]}),(t==null?void 0:t.type)==="date"&&(o.operator==="before"||o.operator==="after")&&e.jsx("input",{type:"date",value:o.value||"",onChange:s=>d(i,{...o,value:s.target.value}),style:n}),(t==null?void 0:t.type)==="date"&&["more_than_days_future","less_than_days_future","more_than_days_ago","less_than_days_ago","exactly_days_future","exactly_days_ago"].includes(o.operator)&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:o.value||"",onChange:s=>d(i,{...o,value:s.target.value}),placeholder:"30",min:"1",style:{...n,width:"70px"}}),e.jsx("span",{style:{fontSize:"13px",color:x.textSecondary},children:"days"})]}),(t==null?void 0:t.type)==="text"&&!["is_empty","is_not_empty"].includes(o.operator)&&e.jsx("input",{type:"text",value:o.value||"",onChange:s=>d(i,{...o,value:s.target.value}),placeholder:`Enter ${t.label.toLowerCase()}...`,style:{...n,width:"160px"}})]}),e.jsx("button",{onClick:()=>v(i),style:{marginLeft:"auto",padding:"6px 10px",backgroundColor:"transparent",border:"none",color:x.textMuted,cursor:"pointer",fontSize:"16px",borderRadius:"4px"},title:"Remove filter",children:"Ã—"})]})},Oe=({group:o,groupIndex:i,onRemoveGroup:d,onDuplicateGroup:v,onAddRule:x,onUpdateRule:t,onRemoveRule:u,theme:c})=>{const n=o.rules||[];return e.jsxs("div",{style:{padding:"16px",backgroundColor:c.bgCard,borderRadius:"12px",border:`2px solid ${c.border}`,position:"relative"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsxs("span",{style:{fontSize:"12px",fontWeight:"600",color:c.textSecondary,textTransform:"uppercase",letterSpacing:"0.5px"},children:["Group ",i+1]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[v&&e.jsxs("button",{onClick:()=>v(i),style:{padding:"4px 8px",backgroundColor:"transparent",border:`1px solid ${c.border}`,color:c.textSecondary,cursor:"pointer",fontSize:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"4px"},title:"Duplicate group",children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),"Duplicate"]}),e.jsx("button",{onClick:()=>d(i),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:c.textMuted,cursor:"pointer",fontSize:"12px",borderRadius:"4px"},title:"Remove group",children:"Remove"})]})]}),n.length===0?e.jsx("div",{style:{textAlign:"center",padding:"12px",color:c.textMuted,fontSize:"13px"},children:"Add filters to this group"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:n.map((s,$)=>e.jsx(Te,{rule:s,index:$,onUpdate:(b,k)=>t(i,b,k),onRemove:b=>u(i,b),theme:c},$))}),e.jsxs("button",{onClick:()=>x(i),style:{width:"100%",padding:"8px",backgroundColor:c.bgHover,border:`1px dashed ${c.border}`,borderRadius:"6px",color:c.primary,cursor:"pointer",fontSize:"12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[e.jsx("span",{children:"+"})," Add Filter to Group"]})]})},qe=({groups:o,onApplyFilter:i,theme:d,filters:v=Fe})=>e.jsxs("div",{style:{padding:"16px",backgroundColor:d.bgCard,borderRadius:"12px",border:`1px solid ${d.border}`,marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:d.textSecondary,marginBottom:"10px"},children:"Quick Filters"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:v.map((x,t)=>e.jsxs("button",{onClick:()=>i(x),style:{padding:"6px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"16px",color:d.text,cursor:"pointer",fontSize:"12px",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:u=>{u.target.style.backgroundColor=d.primary+"20",u.target.style.borderColor=d.primary,u.target.style.color=d.primary},onMouseLeave:u=>{u.target.style.backgroundColor=d.bgHover,u.target.style.borderColor=d.border,u.target.style.color=d.text},children:["+ ",x.label]},t))})]}),Ge=({filterConfig:o,setFilterConfig:i,recipientCount:d,isLoading:v,onPreviewClick:x,showQuickFilters:t=!0,theme:u})=>{var B;const c=(o==null?void 0:o.groups)||(((B=o==null?void 0:o.rules)==null?void 0:B.length)>0?[{rules:o.rules}]:[]),n=c.length>0,s=()=>{const g=[...c,{rules:[{field:"",operator:"",value:""}]}];i({...o,groups:g,rules:void 0})},$=g=>{const h=c.filter((C,S)=>S!==g);i({...o,groups:h,rules:void 0})},b=g=>{const C={rules:(c[g].rules||[]).map(y=>({...y}))},S=[...c];S.splice(g+1,0,C),i({...o,groups:S,rules:void 0})},k=g=>{const h=[...c];h[g]={...h[g],rules:[...h[g].rules||[],{field:"",operator:"",value:""}]},i({...o,groups:h,rules:void 0})},F=(g,h,C)=>{const S=[...c],y=[...S[g].rules||[]];y[h]=C,S[g]={...S[g],rules:y},i({...o,groups:S,rules:void 0})},A=(g,h)=>{const C=[...c];C[g]={...C[g],rules:C[g].rules.filter((S,y)=>y!==h)},C[g].rules.length===0&&C.splice(g,1),i({...o,groups:C,rules:void 0})},P=()=>{i({...o,groups:[],rules:void 0})},L=g=>{if(g.filters){const h={rules:g.filters};i({...o,groups:[...c,h],rules:void 0})}else{const h={rules:[g.filter]};i({...o,groups:[...c,h],rules:void 0})}},m=c.reduce((g,h)=>g+(h.rules||[]).filter(C=>C.field&&C.operator&&(C.value||["is_empty","is_not_empty"].includes(C.operator))).length,0);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:u.text,margin:0},children:"Filter Recipients"}),n&&e.jsx("button",{onClick:P,style:{padding:"6px 12px",backgroundColor:"transparent",border:`1px solid ${u.border}`,borderRadius:"6px",color:u.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Clear all"})]}),t&&e.jsx(qe,{groups:c,onApplyFilter:L,theme:u}),e.jsxs("div",{style:{padding:"16px",backgroundColor:u.bgHover,borderRadius:"12px",marginBottom:"16px"},children:[n?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},children:c.map((g,h)=>e.jsxs("div",{children:[h>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"8px 0",gap:"12px"},children:[e.jsx("div",{style:{flex:1,height:"1px",backgroundColor:u.border}}),e.jsx("span",{style:{fontSize:"12px",fontWeight:"700",color:"#f59e0b",padding:"4px 12px",backgroundColor:"#f59e0b20",borderRadius:"4px",textTransform:"uppercase",letterSpacing:"1px"},children:"OR"}),e.jsx("div",{style:{flex:1,height:"1px",backgroundColor:u.border}})]}),e.jsx(Oe,{group:g,groupIndex:h,onRemoveGroup:$,onDuplicateGroup:b,onAddRule:k,onUpdateRule:F,onRemoveRule:A,theme:u})]},h))}):e.jsx("div",{style:{textAlign:"center",padding:"20px",color:u.textMuted,fontSize:"14px"},children:"No filters applied. All matching records will be included."}),e.jsxs("button",{onClick:s,style:{width:"100%",padding:"10px",backgroundColor:u.bgCard,border:`1px dashed ${u.border}`,borderRadius:"8px",color:u.primary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[e.jsx("span",{children:"+"})," ",n?"Add OR Group":"Add Filter Group"]})]}),m>0&&e.jsxs("div",{style:{padding:"12px 16px",backgroundColor:`${u.primary}10`,borderRadius:"8px",marginBottom:"16px",fontSize:"13px",color:u.text},children:[e.jsx("strong",{children:m})," filter",m!==1?"s":""," in ",e.jsx("strong",{children:c.length})," group",c.length!==1?"s":"",c.length>1&&e.jsx("span",{style:{color:u.textSecondary},children:" (groups combined with OR)"})]}),d!==void 0&&e.jsxs("button",{onClick:x,disabled:v||d===0||!x,style:{width:"100%",padding:"20px",backgroundColor:`${u.primary}10`,borderRadius:"12px",border:`1px solid ${u.primary}30`,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:v||d===0||!x?"default":"pointer",textAlign:"left",transition:"all 0.2s"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:u.text},children:"Matching Recipients"}),e.jsx("div",{style:{fontSize:"12px",color:u.textSecondary},children:d>0&&x?"Click to view matching accounts":"Accounts matching your criteria"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:u.primary},children:v?"...":(d??0).toLocaleString()}),!v&&d>0&&x&&e.jsx("div",{style:{padding:"6px 10px",backgroundColor:u.primary,color:"#fff",borderRadius:"6px",fontSize:"12px",fontWeight:"500"},children:"View"})]})]})]})},Ke={bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},Qe=[{id:"entry-criteria",type:"entry_criteria",title:"Entry Criteria",subtitle:"Define who enters this automation",config:{filterConfig:{groups:[]},reentry:{enabled:!1,type:"never",days:30},pacing:{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}}},{id:"trigger",type:"trigger",title:"Trigger",subtitle:"Daily at 09:00 (Central)",config:{time:"09:00",timezone:"America/Chicago",frequency:"Daily"}},{id:"node-1",type:"send_email",title:"Send Email",subtitle:"Select template...",config:{template:""}}],Ve=({t:o,automation:i,onUpdate:d,onSave:v,canEdit:x=!0})=>{var re,ae,ie,ne,se,de,ce,pe,xe,ue,ye,ge,be,he,fe,ve,me;const t=o||Ke,u=()=>{if(!(i!=null&&i.nodes)||i.nodes.length===0)return Qe;const l=i.nodes.some(p=>p.type==="entry_criteria"),r={id:"entry-criteria",type:"entry_criteria",title:"Entry Criteria",subtitle:"Define who enters this automation",config:{filterConfig:i.filter_config||{groups:[]},reentry:{enabled:!1,type:"never",days:30},pacing:{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}}};let a=i.nodes.map(p=>{var z,j,W;return p.type==="entry_criteria"?{...p,config:{...p.config,filterConfig:((z=p.config)==null?void 0:z.filterConfig)||i.filter_config||{groups:[]},reentry:((j=p.config)==null?void 0:j.reentry)||{enabled:!1,type:"never",days:30},pacing:((W=p.config)==null?void 0:W.pacing)||{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}}}:p});return l||(a=[r,...a]),a},[c,n]=R.useState(u),[s,$]=R.useState(null),[b,k]=R.useState(null),[F,A]=R.useState(!1),[P,L]=R.useState(!1),[m,B]=R.useState(null),{data:g=[],isLoading:h}=De(),C=(i==null?void 0:i.nodeStats)||{},S=c.find(l=>l.type==="entry_criteria"),[y,K]=R.useState(((re=S==null?void 0:S.config)==null?void 0:re.filterConfig)||{groups:[]}),[D,X]=R.useState(((ae=S==null?void 0:S.config)==null?void 0:ae.reentry)||{enabled:!1,type:"never",days:30}),[M,Q]=R.useState(((ie=S==null?void 0:S.config)==null?void 0:ie.pacing)||{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}),V=l=>{K(l),n(r=>r.map(a=>a.type==="entry_criteria"?{...a,config:{...a.config,filterConfig:l}}:a))},_=l=>{X(l),n(r=>r.map(a=>a.type==="entry_criteria"?{...a,config:{...a.config,reentry:l}}:a))},N=l=>{Q(l),n(r=>r.map(a=>a.type==="entry_criteria"?{...a,config:{...a.config,pacing:l}}:a))},E=R.useRef(null);R.useEffect(()=>(d&&(E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{d(l=>({...l,nodes:c,filter_config:y}))},100)),()=>{E.current&&clearTimeout(E.current)}),[c,y,D,M]);const Y=(ne=y==null?void 0:y.groups)==null?void 0:ne.some(l=>{var r;return(r=l.rules)==null?void 0:r.some(a=>a.field&&a.operator)}),{data:I,isLoading:J}=Le(P&&Y?y:null,{limit:500}),{data:le,isLoading:_e}=Be(Y?y:null),q={entry_criteria:{icon:"ðŸŽ¯",color:"#8b5cf6",label:"Entry Criteria"},trigger:{icon:"âš¡",color:t.primary,label:"Trigger"},send_email:{icon:"ðŸ“§",color:t.success,label:"Send Email"},delay:{icon:"â±",color:t.warning,label:"Delay"},condition:{icon:"ðŸ”€",color:t.purple,label:"Condition"},field_condition:{icon:"ðŸ“‹",color:"#ec4899",label:"Field Check"},update_field:{icon:"âœï¸",color:"#06b6d4",label:"Update Field"},end:{icon:"ðŸ",color:t.textMuted,label:"End"}},Z=[{type:"send_email",label:"Send Email",desc:"Send an email template",icon:"ðŸ“§"},{type:"delay",label:"Delay",desc:"Wait before continuing",icon:"â±"},{type:"condition",label:"Email Engagement",desc:"Branch on open/click",icon:"ðŸ“¬"},{type:"field_condition",label:"Field Condition",desc:"Branch on field value",icon:"ðŸ”€"},{type:"update_field",label:"Update Field",desc:"Update a record field",icon:"âœï¸"},{type:"end",label:"End",desc:"Stop automation",icon:"ðŸ"}],U=(l,r,a=null)=>{var z;const p={id:`node-${Date.now()}`,type:r,title:((z=Z.find(j=>j.type===r))==null?void 0:z.label)||r,subtitle:"Configure...",config:{}};if((r==="condition"||r==="field_condition")&&(p.branches={yes:[],no:[]}),a)n(j=>{const W=w=>w.map(H=>H.id===l&&H.branches?{...H,branches:{...H.branches,[a]:[...H.branches[a],p]}}:H.branches?{...H,branches:{yes:W(H.branches.yes),no:W(H.branches.no)}}:H);return W(j)});else{const j=c.findIndex(w=>w.id===l),W=[...c];W.splice(j+1,0,p),n(W)}k(null),$(p.id)},we=l=>{n(r=>r.filter(a=>a.id!==l&&a.id!=="trigger"&&a.id!=="entry-criteria")),s===l&&$(null)},T=(l,r)=>{n(a=>{const p=z=>z.map(j=>j.id===l?{...j,...r}:j.branches?{...j,branches:{yes:p(j.branches.yes||[]),no:p(j.branches.no||[])}}:j);return p(a)})},ke=()=>{const l=(y==null?void 0:y.groups)||[],r=l.reduce((a,p)=>{var z;return a+(((z=p.rules)==null?void 0:z.filter(j=>j.field&&j.operator).length)||0)},0);return r===0?"No filters defined":`${r} filter${r!==1?"s":""} in ${l.length} group${l.length!==1?"s":""}`},ze=(l,r)=>{const a=C[l]||{};return r==="entry_criteria"?a.entered?`${a.entered.toLocaleString()} entered`:null:r==="trigger"?a.processed?`${a.processed.toLocaleString()} processed`:null:r==="send_email"&&a.sent?`${a.sent.toLocaleString()} sent`:r==="delay"?a.waiting?`${a.waiting.toLocaleString()} waiting`:null:(r==="condition"||r==="field_condition")&&a.evaluated?`${a.evaluated.toLocaleString()} evaluated`:null},ee=({node:l})=>{const r=q[l.type]||q.send_email,a=s===l.id,p=l.type==="entry_criteria",z=l.type==="trigger",j=p||z,W=ze(l.id,l.type);return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs("div",{onClick:()=>{$(l.id)},style:{width:"320px",backgroundColor:t.bgCard,border:a?`2px solid ${r.color}`:`1px solid ${t.border}`,borderRadius:"12px",padding:"16px 18px",cursor:"pointer",position:"relative"},children:[W&&e.jsx("div",{style:{position:"absolute",top:"-10px",right:"12px",padding:"4px 10px",backgroundColor:r.color,color:"#fff",borderRadius:"12px",fontSize:"11px",fontWeight:"600",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:W}),!j&&e.jsx("button",{onClick:w=>{w.stopPropagation(),we(l.id)},style:{position:"absolute",top:"8px",right:"8px",background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:"16px"},children:"Ã—"}),e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${r.color}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:r.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:t.text},children:l.title}),e.jsx("div",{style:{fontSize:"12px",color:t.textMuted,marginTop:"2px"},children:p?ke():l.subtitle})]})]}),p&&e.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[e.jsxs("button",{onClick:w=>{w.stopPropagation(),A(!0)},style:{flex:1,padding:"10px",backgroundColor:t.bgHover,border:`1px solid ${t.borderLight}`,borderRadius:"8px",color:t.textSecondary,cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[e.jsx("span",{children:"ðŸŽ¯"})," Edit Criteria"]}),e.jsxs("button",{onClick:w=>{w.stopPropagation(),L(!0)},style:{flex:1,padding:"10px",backgroundColor:t.primary+"15",border:`1px solid ${t.primary}40`,borderRadius:"8px",color:t.primary,cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[e.jsx("span",{children:"ðŸ‘¥"})," Preview ",Y&&le!==void 0&&!_e&&e.jsx("span",{style:{backgroundColor:t.primary,color:"#fff",padding:"2px 6px",borderRadius:"10px",fontSize:"10px",fontWeight:"600"},children:le})]})]})]}),!l.branches&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[e.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:t.borderLight}}),e.jsx("button",{onClick:()=>k({afterNodeId:l.id,branch:null}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:t.bgHover,border:`1px solid ${t.borderLight}`,color:t.textMuted,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"}),e.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:t.borderLight}}),(b==null?void 0:b.afterNodeId)===l.id&&!(b!=null&&b.branch)&&e.jsx(te,{onSelect:w=>U(l.id,w),onClose:()=>k(null)})]}),l.branches&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:t.borderLight}}),e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:t.success}}),e.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#22c55e20",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:t.success},children:"YES"})]}),e.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:t.success}}),l.branches.yes.map(w=>e.jsx(ee,{node:w},w.id)),e.jsx("button",{onClick:()=>k({afterNodeId:l.id,branch:"yes"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:t.bgHover,border:"1px dashed #22c55e",color:t.success,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(b==null?void 0:b.afterNodeId)===l.id&&(b==null?void 0:b.branch)==="yes"&&e.jsx(te,{onSelect:w=>U(l.id,w,"yes"),onClose:()=>k(null)})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#ef444420",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:t.danger},children:"NO"}),e.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:t.danger}})]}),e.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:t.danger}}),l.branches.no.map(w=>e.jsx(ee,{node:w},w.id)),e.jsx("button",{onClick:()=>k({afterNodeId:l.id,branch:"no"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:t.bgHover,border:"1px dashed #ef4444",color:t.danger,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(b==null?void 0:b.afterNodeId)===l.id&&(b==null?void 0:b.branch)==="no"&&e.jsx(te,{onSelect:w=>U(l.id,w,"no"),onClose:()=>k(null)})]})]})]})]})},te=({onSelect:l,onClose:r})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:r}),e.jsx("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"10px",backgroundColor:t.bgCard,border:`1px solid ${t.borderLight}`,borderRadius:"12px",padding:"8px",zIndex:100,width:"240px",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},children:Z.map(a=>e.jsxs("button",{onClick:()=>l(a.type),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px",color:t.text,textAlign:"left"},children:[e.jsx("span",{style:{fontSize:"18px"},children:a.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"500"},children:a.label}),e.jsx("div",{style:{fontSize:"11px",color:t.textMuted},children:a.desc})]})]},a.type))})]}),f=c.find(l=>l.id===s)||c.flatMap(l=>l.branches?[...l.branches.yes||[],...l.branches.no||[]]:[]).find(l=>l.id===s);return e.jsxs("div",{style:{fontFamily:"'IBM Plex Sans', -apple-system, sans-serif",backgroundColor:t.bg,height:"100%",color:t.text,display:"flex"},children:[e.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[e.jsxs("div",{style:{width:"220px",borderRight:`1px solid ${t.border}`,padding:"16px",backgroundColor:t.bgCard,overflowY:"auto"},children:[e.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:t.textMuted,marginBottom:"12px",textTransform:"uppercase"},children:"Add Nodes"}),Z.map(l=>e.jsxs("div",{style:{padding:"12px",backgroundColor:t.bgHover,borderRadius:"8px",marginBottom:"8px",cursor:"grab",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{style:{fontSize:"18px"},children:l.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:t.text},children:l.label}),e.jsx("div",{style:{fontSize:"11px",color:t.textMuted},children:l.desc})]})]},l.type))]}),e.jsx("div",{style:{flex:1,padding:"40px",overflowY:"auto",display:"flex",justifyContent:"center"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[c.map(l=>e.jsx(ee,{node:l},l.id)),e.jsx("div",{style:{marginTop:"16px",padding:"8px 18px",backgroundColor:t.bgHover,borderRadius:"20px",fontSize:"12px",color:t.textMuted},children:"End of automation"})]})}),e.jsxs("div",{style:{width:"300px",borderLeft:`1px solid ${t.border}`,backgroundColor:t.bgCard,overflowY:"auto"},children:[e.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${t.border}`,fontSize:"11px",fontWeight:"600",color:t.textMuted,textTransform:"uppercase"},children:"Configuration"}),e.jsx("div",{style:{padding:"18px"},children:f?e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${((se=q[f.type])==null?void 0:se.color)||t.primary}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:((de=q[f.type])==null?void 0:de.icon)||"ðŸ“§"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"600",color:t.text,fontSize:"15px"},children:f.title}),e.jsx("div",{style:{fontSize:"12px",color:t.textMuted},children:((ce=q[f.type])==null?void 0:ce.label)||"Node"})]})]}),f.type==="entry_criteria"&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"13px",color:t.textSecondary,marginBottom:"16px"},children:"Define which accounts enter this automation based on their attributes."}),((y==null?void 0:y.groups)||[]).length>0&&e.jsxs("div",{style:{padding:"12px",backgroundColor:t.bgHover,borderRadius:"8px",marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:t.textMuted,marginBottom:"8px",textTransform:"uppercase"},children:"Current Filters"}),y.groups.map((l,r)=>e.jsxs("div",{style:{marginBottom:r<y.groups.length-1?"8px":0},children:[r>0&&e.jsx("div",{style:{fontSize:"10px",color:"#f59e0b",fontWeight:"700",textAlign:"center",margin:"6px 0"},children:"OR"}),(l.rules||[]).filter(a=>a.field&&a.operator).map((a,p)=>e.jsx("div",{style:{padding:"4px 8px",backgroundColor:`${t.primary}15`,borderRadius:"4px",fontSize:"11px",color:t.text,marginBottom:"4px"},children:je(a)},p))]},r))]}),e.jsx("button",{onClick:()=>A(!0),style:{width:"100%",padding:"12px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",marginBottom:"20px"},children:"Edit Entry Criteria"}),e.jsxs("div",{style:{padding:"16px",backgroundColor:t.bgHover,borderRadius:"8px",marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:t.text,marginBottom:"12px"},children:"Re-entry Rules"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",marginBottom:"12px"},children:[e.jsx("input",{type:"checkbox",checked:D.enabled,onChange:l=>_({...D,enabled:l.target.checked}),style:{width:"16px",height:"16px",accentColor:t.primary}}),e.jsx("span",{style:{fontSize:"13px",color:t.textSecondary},children:"Allow contacts to re-enter"})]}),D.enabled&&e.jsx("div",{style:{marginLeft:"26px"},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px",cursor:"pointer"},children:[e.jsx("input",{type:"radio",name:"reentryType",checked:D.type==="after_days",onChange:()=>_({...D,type:"after_days"}),style:{accentColor:t.primary}}),e.jsx("span",{style:{fontSize:"12px",color:t.textSecondary},children:"After"}),e.jsx("input",{type:"number",value:D.days,onChange:l=>_({...D,days:parseInt(l.target.value)||1}),min:"1",style:{width:"60px",padding:"4px 8px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"4px",color:t.text,fontSize:"12px"}}),e.jsx("span",{style:{fontSize:"12px",color:t.textSecondary},children:"days"})]})}),!D.enabled&&e.jsx("p",{style:{fontSize:"11px",color:t.textMuted,margin:0},children:"Contacts can only enter this automation once"})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:t.bgHover,borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:t.text,marginBottom:"12px"},children:"Enrollment Pacing"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",marginBottom:"12px"},children:[e.jsx("input",{type:"checkbox",checked:M.enabled,onChange:l=>N({...M,enabled:l.target.checked}),style:{width:"16px",height:"16px",accentColor:t.primary}}),e.jsx("span",{style:{fontSize:"13px",color:t.textSecondary},children:"Spread enrollments over time"})]}),M.enabled&&e.jsxs("div",{style:{marginLeft:"26px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[e.jsx("span",{style:{fontSize:"12px",color:t.textSecondary},children:"Spread over"}),e.jsx("input",{type:"number",value:M.spreadOverDays,onChange:l=>N({...M,spreadOverDays:parseInt(l.target.value)||1}),min:"1",max:"365",style:{width:"60px",padding:"4px 8px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"4px",color:t.text,fontSize:"12px"}}),e.jsx("span",{style:{fontSize:"12px",color:t.textSecondary},children:"days"})]}),e.jsx("div",{style:{fontSize:"11px",color:t.textSecondary,marginBottom:"8px"},children:"Run on these days:"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[{value:"sun",label:"Sun"},{value:"mon",label:"Mon"},{value:"tue",label:"Tue"},{value:"wed",label:"Wed"},{value:"thu",label:"Thu"},{value:"fri",label:"Fri"},{value:"sat",label:"Sat"}].map(l=>e.jsx("button",{onClick:()=>{const r=M.allowedDays||[],a=r.includes(l.value)?r.filter(p=>p!==l.value):[...r,l.value];N({...M,allowedDays:a})},style:{padding:"4px 8px",backgroundColor:(M.allowedDays||[]).includes(l.value)?t.primary:t.bgCard,color:(M.allowedDays||[]).includes(l.value)?"#fff":t.textSecondary,border:`1px solid ${(M.allowedDays||[]).includes(l.value)?t.primary:t.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px",fontWeight:"500"},children:l.label},l.value))})]}),!M.enabled&&e.jsx("p",{style:{fontSize:"11px",color:t.textMuted,margin:0},children:"All matching contacts will be enrolled immediately"})]})]}),f.type==="trigger"&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"12px",color:t.textSecondary,marginBottom:"6px"},children:"Run Time"}),e.jsx("input",{type:"time",value:((pe=f.config)==null?void 0:pe.time)||"09:00",onChange:l=>{var z,j;const r=l.target.value,a=((z=f.config)==null?void 0:z.frequency)||"Daily",p=((j=f.config)==null?void 0:j.timezone)||"America/Chicago";T(s,{config:{...f.config,time:r},subtitle:`${a} at ${r} (${p.split("/")[1]||p})`})},style:{width:"100%",padding:"10px 12px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px",marginBottom:"16px"}}),e.jsx("label",{style:{display:"block",fontSize:"12px",color:t.textSecondary,marginBottom:"6px"},children:"Frequency"}),e.jsxs("select",{value:((xe=f.config)==null?void 0:xe.frequency)||"Daily",onChange:l=>{var z,j;const r=l.target.value,a=((z=f.config)==null?void 0:z.time)||"09:00",p=((j=f.config)==null?void 0:j.timezone)||"America/Chicago";T(s,{config:{...f.config,frequency:r},subtitle:`${r} at ${a} (${p.split("/")[1]||p})`})},style:{width:"100%",padding:"10px 12px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px"},children:[e.jsx("option",{value:"Daily",children:"Daily"}),e.jsx("option",{value:"Weekly",children:"Weekly"}),e.jsx("option",{value:"Monthly",children:"Monthly"})]})]}),f.type==="send_email"&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"12px",color:t.textSecondary,marginBottom:"6px"},children:"Email Template"}),e.jsxs("select",{value:((ue=f.config)==null?void 0:ue.template)||"",onChange:l=>{const r=g.find(a=>a.id===l.target.value);T(s,{config:{...f.config,template:l.target.value,templateName:(r==null?void 0:r.name)||""},subtitle:(r==null?void 0:r.name)||"Select template..."})},style:{width:"100%",padding:"10px 12px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px"},children:[e.jsx("option",{value:"",children:h?"Loading templates...":"Select template..."}),g.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),f.type==="delay"&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"12px",color:t.textSecondary,marginBottom:"6px"},children:"Wait Duration"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("input",{type:"number",value:((ye=f.config)==null?void 0:ye.duration)||1,min:"1",onChange:l=>{var p;const r=parseInt(l.target.value,10)||1,a=((p=f.config)==null?void 0:p.unit)||"days";T(s,{config:{...f.config,duration:r},subtitle:`Wait ${r} ${a}`})},style:{flex:1,padding:"10px 12px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px"}}),e.jsxs("select",{value:((ge=f.config)==null?void 0:ge.unit)||"days",onChange:l=>{var p;const r=l.target.value,a=((p=f.config)==null?void 0:p.duration)||1;T(s,{config:{...f.config,unit:r},subtitle:`Wait ${a} ${r}`})},style:{flex:1,padding:"10px 12px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px"},children:[e.jsx("option",{value:"hours",children:"Hours"}),e.jsx("option",{value:"days",children:"Days"}),e.jsx("option",{value:"weeks",children:"Weeks"})]})]})]}),(f.type==="condition"||f.type==="field_condition")&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"12px",color:t.textSecondary,marginBottom:"6px"},children:"Condition Type"}),e.jsxs("select",{value:((be=f.config)==null?void 0:be.type)||"email_opened",onChange:l=>{const r=l.target.value,a={email_opened:"If email opened",email_clicked:"If email clicked",field_value:"If field matches"};T(s,{config:{...f.config,type:r},subtitle:a[r]||"Configure condition..."})},style:{width:"100%",padding:"10px 12px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px"},children:[e.jsx("option",{value:"email_opened",children:"Email Opened"}),e.jsx("option",{value:"email_clicked",children:"Email Clicked"}),e.jsx("option",{value:"field_value",children:"Field Value"})]})]}),f.type==="end"&&e.jsx("p",{style:{fontSize:"13px",color:t.textSecondary},children:"This node ends the automation flow. Contacts reaching this point will exit the automation."})]}):e.jsxs("div",{style:{textAlign:"center",color:t.textMuted,padding:"30px 0"},children:[e.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:"ðŸ‘†"}),e.jsx("div",{style:{fontSize:"13px"},children:"Select a node to configure"})]})})]})]}),F&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",zIndex:200},onClick:()=>A(!1)}),e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"900px",maxWidth:"95vw",maxHeight:"85vh",backgroundColor:t.bgCard,borderRadius:"16px",border:`1px solid ${t.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${t.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[e.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:t.text,margin:0},children:"Entry Criteria"}),e.jsx("button",{onClick:()=>A(!1),style:{background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:"18px"},children:"Ã—"})]}),e.jsx("div",{style:{flex:1,padding:"20px",overflow:"auto"},children:e.jsx(Ge,{filterConfig:y,setFilterConfig:V,showQuickFilters:!0,theme:t})}),e.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${t.border}`,display:"flex",justifyContent:"flex-end",gap:"8px",flexShrink:0},children:x?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>A(!1),style:{padding:"10px 20px",backgroundColor:t.bgHover,border:`1px solid ${t.borderLight}`,borderRadius:"8px",color:t.textSecondary,cursor:"pointer",fontSize:"13px"},children:"Cancel"}),e.jsx("button",{onClick:()=>A(!1),style:{padding:"10px 20px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Save Criteria"})]}):e.jsx("button",{onClick:()=>A(!1),style:{padding:"10px 20px",backgroundColor:t.bgHover,border:`1px solid ${t.borderLight}`,borderRadius:"8px",color:t.textSecondary,cursor:"pointer",fontSize:"13px"},children:"Close"})})]})]}),P&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",zIndex:200},onClick:()=>L(!1)}),e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxWidth:"95vw",maxHeight:"85vh",backgroundColor:t.bgCard,borderRadius:"16px",border:`1px solid ${t.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${t.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:t.text,margin:0},children:"Preview Potential Enrollees"}),e.jsx("p",{style:{fontSize:"12px",color:t.textMuted,margin:"4px 0 0"},children:"Contacts matching your entry criteria who would enter this automation"})]}),e.jsx("button",{onClick:()=>L(!1),style:{background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:"20px"},children:"Ã—"})]}),e.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${t.border}`,display:"flex",gap:"24px",backgroundColor:t.bgHover},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.primary},children:J?"...":(I==null?void 0:I.length)||0}),e.jsx("div",{style:{fontSize:"11px",color:t.textMuted,textTransform:"uppercase"},children:"Matching Contacts"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.success},children:((he=y==null?void 0:y.groups)==null?void 0:he.length)||0}),e.jsx("div",{style:{fontSize:"11px",color:t.textMuted,textTransform:"uppercase"},children:"Filter Groups"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.textSecondary},children:((fe=y==null?void 0:y.groups)==null?void 0:fe.reduce((l,r)=>{var a;return l+(((a=r.rules)==null?void 0:a.filter(p=>p.field&&p.operator).length)||0)},0))||0}),e.jsx("div",{style:{fontSize:"11px",color:t.textMuted,textTransform:"uppercase"},children:"Active Filters"})]})]}),e.jsxs("div",{style:{flex:1,overflow:"auto",padding:"0"},children:[J?e.jsx("div",{style:{textAlign:"center",padding:"40px",color:t.textMuted},children:e.jsx("div",{style:{fontSize:"14px"},children:"Loading potential enrollees..."})}):Y?I&&I.length>0?e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:t.bgHover},children:[e.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:t.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${t.border}`},children:"Contact"}),e.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:t.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${t.border}`},children:"Account Type"}),e.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:t.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${t.border}`},children:"Last Email"}),e.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:t.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${t.border}`},children:"Matched Groups"})]})}),e.jsx("tbody",{children:I.map(l=>e.jsxs("tr",{style:{borderBottom:`1px solid ${t.border}`},children:[e.jsxs("td",{style:{padding:"12px 20px"},children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:t.text},children:l.name||l.account_name}),e.jsx("div",{style:{fontSize:"12px",color:t.textMuted},children:l.email})]}),e.jsx("td",{style:{padding:"12px 20px",fontSize:"13px",color:t.textSecondary},children:l.account_type||"â€”"}),e.jsx("td",{style:{padding:"12px 20px",fontSize:"13px",color:t.textSecondary},children:l._lastEmailSent?new Date(l._lastEmailSent).toLocaleDateString():"Never"}),e.jsx("td",{style:{padding:"12px 20px",position:"relative"},children:l._matchedGroups&&l._matchedGroups.length>0?e.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:l._matchedGroups.map(r=>e.jsxs("span",{style:{padding:"2px 8px",borderRadius:"10px",fontSize:"11px",fontWeight:"600",backgroundColor:(m==null?void 0:m.contactId)===l.id&&(m==null?void 0:m.groupIndex)===r?t.primary:`${t.primary}20`,color:(m==null?void 0:m.contactId)===l.id&&(m==null?void 0:m.groupIndex)===r?"#fff":t.primary,cursor:"default",transition:"all 0.15s ease",position:"relative"},onMouseEnter:a=>{const p=a.target.getBoundingClientRect();B({contactId:l.id,groupIndex:r,x:p.left,y:p.bottom+8})},onMouseLeave:()=>{B(null)},children:["Group ",r+1]},r))}):e.jsx("span",{style:{fontSize:"12px",color:t.textMuted},children:"â€”"})})]},l.id))})]}):e.jsxs("div",{style:{textAlign:"center",padding:"40px",color:t.textMuted},children:[e.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:"ðŸ‘¥"}),e.jsx("div",{style:{fontSize:"14px"},children:"No contacts match your current filters"})]}):e.jsxs("div",{style:{textAlign:"center",padding:"40px",color:t.textMuted},children:[e.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:"ðŸŽ¯"}),e.jsx("div",{style:{fontSize:"14px"},children:"Add filters to see who would enter this automation"})]}),m&&((ve=y==null?void 0:y.groups)==null?void 0:ve[m.groupIndex])&&e.jsxs("div",{style:{position:"fixed",left:m.x,top:m.y,backgroundColor:t.bgCard,border:`1px solid ${t.border}`,borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e4,maxWidth:"300px",pointerEvents:"none"},children:[e.jsxs("div",{style:{fontSize:"11px",fontWeight:"600",color:t.textMuted,marginBottom:"8px",textTransform:"uppercase"},children:["Group ",m.groupIndex+1," Criteria"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:(me=y.groups[m.groupIndex].rules)==null?void 0:me.filter(l=>l.field&&l.operator).map((l,r)=>e.jsx("div",{style:{fontSize:"12px",color:t.text},children:je(l)},r))})]})]}),e.jsxs("div",{style:{padding:"12px 20px",borderTop:`1px solid ${t.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0,backgroundColor:t.bgHover},children:[e.jsx("span",{style:{fontSize:"12px",color:t.textMuted},children:J?"Loading...":`Showing ${(I==null?void 0:I.length)||0} potential enrollee${((I==null?void 0:I.length)||0)!==1?"s":""}`}),e.jsx("button",{onClick:()=>L(!1),style:{padding:"8px 16px",backgroundColor:t.bgCard,border:`1px solid ${t.borderLight}`,borderRadius:"6px",color:t.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Close"})]})]})]})]})},rt=({t:o})=>{var Q,V;const{userId:i,automationId:d}=Se(),v=Ae(),x=Me(),t=!d||d==="new";(Q=x.state)!=null&&Q.templateName||((V=x.state)==null||V.templateId);const{data:u=!1,isLoading:c}=Ne(),{data:n,isLoading:s,error:$}=Ie(t?null:d),b=(n==null?void 0:n.is_default)===!0,k=t||!b||u,{createAutomation:F,updateAutomation:A,activateAutomation:P,pauseAutomation:L,duplicateAutomation:m}=We(),{updateMasterAutomation:B}=Ee(),g=async()=>{if(t)return;const _=h.status==="active",N=_?"paused":"active";try{_?await L.mutateAsync(d):await P.mutateAsync(d),C(E=>({...E,status:N}))}catch(E){console.error("Failed to toggle status:",E)}},[h,C]=R.useState({name:"",description:"",category:"general",status:"draft",send_time:"10:00",timezone:"America/Chicago",frequency:"Daily",filter_config:{},nodes:[]});R.useEffect(()=>{n&&C({name:n.name||"",description:n.description||"",category:n.category||"general",status:n.status||"draft",send_time:n.send_time||"10:00",timezone:n.timezone||"America/Chicago",frequency:n.frequency||"Daily",filter_config:n.filter_config||{},nodes:n.nodes||[]})},[n]);const S=async _=>{if(!k){alert('You cannot edit default automations. Use "Clone & Edit" to create your own copy.');return}try{if(t){const N=await F.mutateAsync(_);v(`/${i}/automations/${N.id}`,{replace:!0})}else u&&b&&(n!=null&&n.default_key)?await B.mutateAsync({defaultKey:n.default_key,updates:{name:_.name,description:_.description,category:_.category,send_time:_.send_time,timezone:_.timezone,frequency:_.frequency,filter_config:_.filter_config,nodes:_.nodes}}):await A.mutateAsync({automationId:d,updates:_})}catch(N){console.error("Failed to save automation:",N),alert("Failed to save automation. Please try again.")}},y=async()=>{try{const _=await m.mutateAsync(d);v(`/${i}/automations/${_.id}`,{replace:!0})}catch(_){console.error("Failed to clone automation:",_),alert("Failed to clone automation. Please try again.")}},K=()=>{v(`/${i}/automations`)},[D,X]=R.useState(null),M=t||n&&D===n.updated_at;return R.useEffect(()=>{n!=null&&n.updated_at&&X(n.updated_at)},[n==null?void 0:n.updated_at]),!t&&(s||c||!M)?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[e.jsx("div",{style:{fontSize:"32px"},children:"â³"}),e.jsx("div",{style:{color:(o==null?void 0:o.textSecondary)||"#a1a1aa"},children:"Loading automation..."})]}):$?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[e.jsx("div",{style:{fontSize:"48px"},children:"ðŸ˜•"}),e.jsx("h2",{style:{color:(o==null?void 0:o.text)||"#fafafa",margin:0},children:"Automation Not Found"}),e.jsx("p",{style:{color:(o==null?void 0:o.textSecondary)||"#a1a1aa"},children:"We couldn't find the automation you're looking for."}),e.jsx("button",{onClick:K,style:{padding:"10px 20px",backgroundColor:(o==null?void 0:o.primary)||"#3b82f6",border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Automations"})]}):e.jsxs("div",{style:{margin:"-24px",height:"calc(100vh - 49px)",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${(o==null?void 0:o.border)||"#27272a"}`,display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:(o==null?void 0:o.bgCard)||"#18181b",flexShrink:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("button",{onClick:K,style:{background:"none",border:"none",color:(o==null?void 0:o.textSecondary)||"#a1a1aa",cursor:"pointer",fontSize:"20px",padding:"4px 8px",display:"flex",alignItems:"center"},children:"â†"}),e.jsx("h1",{style:{fontSize:"16px",fontWeight:"600",color:(o==null?void 0:o.text)||"#fafafa",margin:0},children:t?"Create Automation":k?`Edit: ${(n==null?void 0:n.name)||"Automation"}`:`View: ${(n==null?void 0:n.name)||"Automation"}`}),b&&e.jsx("span",{style:{padding:"4px 8px",backgroundColor:`${(o==null?void 0:o.primary)||"#3b82f6"}20`,color:(o==null?void 0:o.primary)||"#3b82f6",borderRadius:"4px",fontSize:"11px",fontWeight:"600",textTransform:"uppercase"},children:"Default"}),!k&&e.jsx("span",{style:{padding:"4px 8px",backgroundColor:`${(o==null?void 0:o.warning)||"#f59e0b"}20`,color:(o==null?void 0:o.warning)||"#f59e0b",borderRadius:"4px",fontSize:"11px",fontWeight:"600"},children:"Read Only"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[!t&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"13px",color:(o==null?void 0:o.textSecondary)||"#a1a1aa"},children:h.status==="active"?"Active":"Inactive"}),e.jsx("button",{onClick:g,disabled:P.isPending||L.isPending,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:h.status==="active"?(o==null?void 0:o.success)||"#22c55e":(o==null?void 0:o.bgHover)||"#27272a",cursor:"pointer",position:"relative",transition:"background-color 0.2s",opacity:P.isPending||L.isPending?.6:1},children:e.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:h.status==="active"?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})})]}),!k&&e.jsx("button",{onClick:y,disabled:m.isPending,style:{padding:"8px 16px",backgroundColor:(o==null?void 0:o.bgHover)||"#27272a",border:`1px solid ${(o==null?void 0:o.border)||"#3f3f46"}`,borderRadius:"6px",color:(o==null?void 0:o.text)||"#fafafa",cursor:"pointer",fontSize:"13px",fontWeight:"500",opacity:m.isPending?.7:1},children:m.isPending?"Cloning...":"Clone & Edit"}),k&&e.jsx("button",{onClick:()=>S(h),disabled:F.isPending||A.isPending||B.isPending,style:{padding:"8px 16px",backgroundColor:(o==null?void 0:o.primary)||"#3b82f6",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",opacity:F.isPending||A.isPending||B.isPending?.7:1},children:F.isPending||A.isPending||B.isPending?"Saving...":t?"Create":"Save Changes"})]})]}),e.jsx("div",{style:{flex:1,overflow:"hidden"},children:e.jsx(Ve,{t:o,automation:h,onUpdate:C,onSave:S,canEdit:k},`${d||"new"}-${(n==null?void 0:n.updated_at)||"new"}`)})]})};export{rt as default};
