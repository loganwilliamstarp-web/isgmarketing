import{Q as kt,u as Z,a as Me,b as K,j as t,c as zt}from"./query-CW7cajfZ.js";import{a as Rt,u as ee,L as he,b as fe,r as A,c as dt,R as Ce,B as $t,d as ct,e as re}from"./vendor-CJJr1Dh-.js";import{c as Dt}from"./supabase-GtAdROLV.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function o(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(i){if(i.ep)return;i.ep=!0;const n=o(i);fetch(i.href,n)}})();var Pe={},rt=Rt;Pe.createRoot=rt.createRoot,Pe.hydrateRoot=rt.hydrateRoot;var At=function(){return null};const It=new kt({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*30,retry:1,refetchOnWindowFocus:!0,refetchOnMount:!0},mutations:{retry:0}}}),Tt=void 0,Wt=void 0;throw new Error("Missing Supabase environment variables");const y=Dt(Tt,Wt),pe={async get(e){const{data:r,error:o}=await y.from("user_settings").select("*").eq("user_id",e).single();if(o&&o.code!=="PGRST116")throw o;return r},async getWithUser(e){const{data:r,error:o}=await y.from("user_settings").select(`
        *,
        user:users(user_unique_id, email, first_name, last_name, role_name, profile_name)
      `).eq("user_id",e).single();if(o&&o.code!=="PGRST116")throw o;return r},async create(e,r={}){const{data:o,error:a}=await y.from("user_settings").insert({user_id:e,...r}).select().single();if(a)throw a;return o},async update(e,r){const{data:o,error:a}=await y.from("user_settings").update({...r,updated_at:new Date().toISOString()}).eq("user_id",e).select().single();if(a)throw a;return o},async updateSignature(e,r){const{signatureName:o,signatureTitle:a,signaturePhone:i,signatureEmail:n,signatureMessage:s}=r;return this.update(e,{signature_name:o,signature_title:a,signature_phone:i,signature_email:n,signature_message:s})},async updateAgencyInfo(e,r){const{agencyName:o,agencyAddress:a,agencyPhone:i,agencyWebsite:n}=r;return this.update(e,{agency_name:o,agency_address:a,agency_phone:i,agency_website:n})},async updateEmailSettings(e,r){const{fromName:o,fromEmail:a,replyToEmail:i,defaultSendTime:n,timezone:s,dailySendLimit:l}=r;return this.update(e,{from_name:o,from_email:a,reply_to_email:i,default_send_time:n,timezone:s,daily_send_limit:l})},async updatePreferences(e,r){const o=await this.get(e);return this.update(e,{preferences:{...o==null?void 0:o.preferences,...r}})},async getCurrentUser(e){const{data:r,error:o}=await y.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name").eq("user_unique_id",e).single();if(o&&o.code!=="PGRST116")throw o;return r},async getUserIdsByRole(e){const r=await this.getCurrentUser(e);if(!(r!=null&&r.role_name))return[e];const{data:o,error:a}=await y.from("users").select("user_unique_id").eq("role_name",r.role_name);if(a)throw a;return(o==null?void 0:o.map(i=>i.user_unique_id))||[e]},async getSignatureHtml(e){const r=await this.get(e);if(!r)return"";const{signature_name:o,signature_title:a,signature_phone:i,signature_email:n,signature_message:s}=r;let l='<table style="margin-top: 20px; font-family: Arial, sans-serif;">';return l+="<tr><td>",o&&(l+=`<strong style="font-size: 14px;">${o}</strong><br>`),a&&(l+=`<span style="color: #666;">${a}</span><br>`),i&&(l+=`<span>${i}</span><br>`),n&&(l+=`<a href="mailto:${n}" style="color: #0066cc;">${n}</a><br>`),s&&(l+=`<p style="margin-top: 10px; font-style: italic; color: #666;">${s}</p>`),l+="</td></tr></table>",l},async getUnsubscribeFooterHtml(e,r,o=null){const a=await this.get(e),i="https://your-app.com",n=`${i}/unsubscribe?type=automation&id=${r}&aid=${o}`,s=`${i}/unsubscribe?type=all&id=${r}`;let l=`
      <table style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; width: 100%; font-family: Arial, sans-serif;">
        <tr>
          <td style="text-align: center; font-size: 12px; color: #666;">
    `;return o&&(l+=`<a href="${n}" style="color: #666;">Unsubscribe from these emails</a> &nbsp;|&nbsp; `),l+=`<a href="${s}" style="color: #666;">Unsubscribe from all emails</a>`,(a!=null&&a.agency_name||a!=null&&a.agency_address)&&(l+="<br><br>",a.agency_name&&(l+=a.agency_name),a.agency_address&&(l+=` | ${a.agency_address}`)),l+=`
          </td>
        </tr>
      </table>
    `,l}},me={async getAll(e,r={}){const{category:o,isDefault:a,search:i}=r;let n=y.from("email_templates").select("*").eq("owner_id",e).order("is_default",{ascending:!1}).order("name");o&&(n=n.eq("category",o)),typeof a=="boolean"&&(n=n.eq("is_default",a)),i&&(n=n.or(`name.ilike.%${i}%,subject.ilike.%${i}%`));const{data:s,error:l}=await n;if(l)throw l;return s},async getById(e,r){const{data:o,error:a}=await y.from("email_templates").select("*").eq("owner_id",e).eq("id",r).single();if(a)throw a;return o},async getByDefaultKey(e,r){const{data:o,error:a}=await y.from("email_templates").select("*").eq("owner_id",e).eq("default_key",r).single();if(a)throw a;return o},async create(e,r){const{data:o,error:a}=await y.from("email_templates").insert({owner_id:e,is_default:!1,...r}).select().single();if(a)throw a;return o},async update(e,r,o){const{data:a,error:i}=await y.from("email_templates").update({...o,updated_at:new Date().toISOString()}).eq("owner_id",e).eq("id",r).select().single();if(i)throw i;return a},async delete(e,r){const{error:o}=await y.from("email_templates").delete().eq("owner_id",e).eq("id",r).eq("is_default",!1);if(o)throw o;return!0},async duplicate(e,r){const o=await this.getById(e,r),{data:a,error:i}=await y.from("email_templates").insert({owner_id:e,is_default:!1,default_key:null,name:`${o.name} (Copy)`,subject:o.subject,body_html:o.body_html,body_text:o.body_text,category:o.category,merge_fields:o.merge_fields}).select().single();if(i)throw i;return a},async getByCategory(e,r){const{data:o,error:a}=await y.from("email_templates").select("*").eq("owner_id",e).eq("category",r).order("is_default",{ascending:!1}).order("name");if(a)throw a;return o},async getCategories(e){const{data:r,error:o}=await y.from("email_templates").select("category").eq("owner_id",e).not("category","is",null);if(o)throw o;return[...new Set(r.map(a=>a.category))]},async resetToDefault(e,r){return this.getById(e,r)}},He=()=>{const{userId:e}=ee();return e};function Ge(e={}){const r=He();return Z({queryKey:["templates",r,e],queryFn:()=>me.getAll(r,e),enabled:!!r})}function Mt(){const e=He();return Z({queryKey:["templates",e,"categories"],queryFn:()=>me.getCategories(e),enabled:!!e})}function pt(){const e=He(),r=Me(),o=()=>{r.invalidateQueries({queryKey:["templates",e]})},a=K({mutationFn:l=>me.create(e,l),onSuccess:o}),i=K({mutationFn:({templateId:l,updates:c})=>me.update(e,l,c),onSuccess:l=>{o(),r.setQueryData(["template",e,l.id],l)}}),n=K({mutationFn:l=>me.delete(e,l),onSuccess:o}),s=K({mutationFn:l=>me.duplicate(e,l),onSuccess:o});return{createTemplate:a,updateTemplate:i,deleteTemplate:n,duplicateTemplate:s}}const ne={async getAll(e,r={}){const{status:o,category:a,search:i}=r;let n=y.from("automations").select(`
        *,
        _count:automation_enrollments(count)
      `).eq("owner_id",e).order("is_default",{ascending:!1}).order("name");o&&(n=n.eq("status",o)),a&&(n=n.eq("category",a)),i&&(n=n.or(`name.ilike.%${i}%,description.ilike.%${i}%`));const{data:s,error:l}=await n;if(l)throw l;return s},async getAllWithStats(e){const{data:r,error:o}=await y.from("automations").select("*").eq("owner_id",e).order("is_default",{ascending:!1}).order("name");if(o)throw o;const a=r.map(l=>l.id),{data:i,error:n}=await y.from("automation_enrollments").select("automation_id, status").in("automation_id",a);if(n)throw n;const s={};return i.forEach(l=>{s[l.automation_id]||(s[l.automation_id]={total:0,active:0,completed:0,exited:0}),s[l.automation_id].total++,s[l.automation_id][l.status.toLowerCase()]++}),r.map(l=>({...l,enrollmentStats:s[l.id]||{total:0,active:0,completed:0,exited:0}}))},async getById(e,r){const{data:o,error:a}=await y.from("automations").select("*").eq("owner_id",e).eq("id",r).single();if(a)throw a;return o},async getByIdWithDetails(e,r){const o=await this.getById(e,r),{data:a,error:i}=await y.from("automation_enrollments").select("status").eq("automation_id",r);if(i)throw i;const n={total:a.length,active:a.filter(d=>d.status==="Active").length,completed:a.filter(d=>d.status==="Completed").length,exited:a.filter(d=>d.status==="Exited").length,paused:a.filter(d=>d.status==="Paused").length},{data:s,error:l}=await y.from("email_logs").select("status, open_count, click_count").eq("automation_id",r);if(l)throw l;const c={sent:s.length,delivered:s.filter(d=>d.status==="Delivered"||d.status==="Opened"||d.status==="Clicked").length,opened:s.filter(d=>d.open_count>0).length,clicked:s.filter(d=>d.click_count>0).length,bounced:s.filter(d=>d.status==="Bounced").length};return{...o,enrollmentStats:n,emailSummary:c}},async getByDefaultKey(e,r){const{data:o,error:a}=await y.from("automations").select("*").eq("owner_id",e).eq("default_key",r).single();if(a)throw a;return o},async create(e,r){const{data:o,error:a}=await y.from("automations").insert({owner_id:e,is_default:!1,status:"Draft",...r}).select().single();if(a)throw a;return o},async update(e,r,o){const{data:a,error:i}=await y.from("automations").update({...o,updated_at:new Date().toISOString()}).eq("owner_id",e).eq("id",r).select().single();if(i)throw i;return a},async updateStatus(e,r,o){return this.update(e,r,{status:o})},async activate(e,r){return this.updateStatus(e,r,"active")},async pause(e,r){return this.updateStatus(e,r,"paused")},async archive(e,r){return this.updateStatus(e,r,"archived")},async delete(e,r){const{error:o}=await y.from("automations").delete().eq("owner_id",e).eq("id",r).eq("is_default",!1);if(o)throw o;return!0},async duplicate(e,r){const o=await this.getById(e,r),{data:a,error:i}=await y.from("automations").insert({owner_id:e,is_default:!1,default_key:null,name:`${o.name} (Copy)`,description:o.description,category:o.category,status:"Draft",send_time:o.send_time,timezone:o.timezone,frequency:o.frequency,max_enrollments:o.max_enrollments,enrollment_cooldown_days:o.enrollment_cooldown_days,distribute_evenly:o.distribute_evenly,filter_config:o.filter_config,nodes:o.nodes}).select().single();if(i)throw i;return a},async updateFilters(e,r,o){return this.update(e,r,{filter_config:o})},async updateNodes(e,r,o){return this.update(e,r,{nodes:o})},async updateSchedule(e,r,o){const{sendTime:a,timezone:i,frequency:n}=o;return this.update(e,r,{send_time:a,timezone:i,frequency:n})},async updateEnrollmentRules(e,r,o){const{maxEnrollments:a,cooldownDays:i,distributeEvenly:n}=o;return this.update(e,r,{max_enrollments:a,enrollment_cooldown_days:i,distribute_evenly:n})},async getByStatus(e,r){const{data:o,error:a}=await y.from("automations").select("*").eq("owner_id",e).eq("status",r).order("name");if(a)throw a;return o},async getActive(e){return this.getByStatus(e,"Active")},async getCategories(e){const{data:r,error:o}=await y.from("automations").select("category").eq("owner_id",e).not("category","is",null);if(o)throw o;return[...new Set(r.map(a=>a.category))]}},Ue=()=>{const{userId:e}=ee();return e};function Bt(){const e=Ue();return Z({queryKey:["automations",e,"withStats"],queryFn:()=>ne.getAllWithStats(e),enabled:!!e})}function qt(e){const r=Ue();return Z({queryKey:["automation",r,e],queryFn:()=>ne.getById(r,e),enabled:!!r&&!!e})}function ut(){const e=Ue(),r=Me(),o=()=>{r.invalidateQueries({queryKey:["automations",e]})},a=K({mutationFn:m=>ne.create(e,m),onSuccess:o}),i=K({mutationFn:({automationId:m,updates:C})=>ne.update(e,m,C),onSuccess:m=>{o(),r.setQueryData(["automation",e,m.id],m)}}),n=K({mutationFn:m=>ne.delete(e,m),onSuccess:o}),s=K({mutationFn:m=>ne.duplicate(e,m),onSuccess:o}),l=K({mutationFn:m=>ne.activate(e,m),onSuccess:m=>{o(),r.setQueryData(["automation",e,m.id],m)}}),c=K({mutationFn:m=>ne.pause(e,m),onSuccess:m=>{o(),r.setQueryData(["automation",e,m.id],m)}}),d=K({mutationFn:m=>ne.archive(e,m),onSuccess:o}),k=K({mutationFn:({automationId:m,filterConfig:C})=>ne.updateFilters(e,m,C),onSuccess:m=>{r.setQueryData(["automation",e,m.id],m)}}),g=K({mutationFn:({automationId:m,nodes:C})=>ne.updateNodes(e,m,C),onSuccess:m=>{r.setQueryData(["automation",e,m.id],m)}}),u=K({mutationFn:({automationId:m,scheduleConfig:C})=>ne.updateSchedule(e,m,C),onSuccess:m=>{r.setQueryData(["automation",e,m.id],m)}}),w=K({mutationFn:({automationId:m,rules:C})=>ne.updateEnrollmentRules(e,m,C),onSuccess:m=>{r.setQueryData(["automation",e,m.id],m)}});return{createAutomation:a,updateAutomation:i,deleteAutomation:n,duplicateAutomation:s,activateAutomation:l,pauseAutomation:c,archiveAutomation:d,updateFilters:k,updateNodes:g,updateSchedule:u,updateEnrollmentRules:w}}const Et={async getByAutomation(e,r={}){const{status:o,limit:a=50,offset:i=0}=r;let n=y.from("automation_enrollments").select(`
        *,
        account:accounts(
          account_unique_id,
          name,
          person_email,
          email,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("automation_id",e).order("enrolled_at",{ascending:!1}).range(i,i+a-1);o&&(n=n.eq("status",o));const{data:s,error:l}=await n;if(l)throw l;return s},async getByAccount(e,r={}){const{status:o}=r;let a=y.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category, status)
      `).eq("account_id",e).order("enrolled_at",{ascending:!1});o&&(a=a.eq("status",o));const{data:i,error:n}=await a;if(n)throw n;return i},async getById(e){const{data:r,error:o}=await y.from("automation_enrollments").select(`
        *,
        account:accounts(*),
        automation:automations(*)
      `).eq("id",e).single();if(o)throw o;return r},async getStats(e){const{data:r,error:o}=await y.from("automation_enrollments").select("status, emails_sent, emails_opened, emails_clicked").eq("automation_id",e);if(o)throw o;const a={total:r.length,active:0,completed:0,exited:0,paused:0,totalEmailsSent:0,totalOpens:0,totalClicks:0};return r.forEach(i=>{a[i.status.toLowerCase()]++,a.totalEmailsSent+=i.emails_sent||0,a.totalOpens+=i.emails_opened||0,a.totalClicks+=i.emails_clicked||0}),a},async canEnroll(e,r){const{data:o,error:a}=await y.rpc("can_enroll_in_automation",{p_account_id:e,p_automation_id:r});if(a)throw a;return o},async enroll(e,r,o={}){var d;if(!await this.canEnroll(r,e))throw new Error("Account cannot be enrolled in this automation");const{data:i,error:n}=await y.from("automations").select("nodes").eq("id",e).single();if(n)throw n;const s=(d=i.nodes)==null?void 0:d[0],{data:l,error:c}=await y.from("automation_enrollments").insert({automation_id:e,account_id:r,status:"Active",current_node_id:(s==null?void 0:s.id)||null,metadata:o}).select().single();if(c)throw c;return l},async bulkEnroll(e,r){const o={enrolled:[],skipped:[],errors:[]};for(const a of r)try{if(await this.canEnroll(a,e)){const n=await this.enroll(e,a);o.enrolled.push(n)}else o.skipped.push(a)}catch(i){o.errors.push({accountId:a,error:i.message})}return o},async exit(e,r="manual"){const{data:o,error:a}=await y.from("automation_enrollments").update({status:"Exited",exit_reason:r,exited_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();if(a)throw a;return o},async pause(e){const{data:r,error:o}=await y.from("automation_enrollments").update({status:"Paused",updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;return r},async resume(e){const{data:r,error:o}=await y.from("automation_enrollments").update({status:"Active",updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;return r},async complete(e){const{data:r,error:o}=await y.from("automation_enrollments").update({status:"Completed",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;return r},async updateProgress(e,r,o=null){const{data:a,error:i}=await y.from("automation_enrollments").update({current_node_id:r,current_branch:o,last_action_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;return a},async setNextAction(e,r){const{data:o,error:a}=await y.from("automation_enrollments").update({next_action_at:r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(a)throw a;return o},async incrementEmailSent(e){const{data:r,error:o}=await y.rpc("increment_enrollment_email_sent",{p_enrollment_id:e});if(o){const{data:a}=await y.from("automation_enrollments").select("emails_sent").eq("id",e).single();return y.from("automation_enrollments").update({emails_sent:((a==null?void 0:a.emails_sent)||0)+1}).eq("id",e)}return r},async getReadyForAction(){const{data:e,error:r}=await y.from("automation_enrollments").select(`
        *,
        automation:automations(*),
        account:accounts(*)
      `).eq("status","Active").lte("next_action_at",new Date().toISOString()).order("next_action_at");if(r)throw r;return e},async getHistory(e){const{data:r,error:o}=await y.from("enrollment_history").select(`
        *,
        email_log:email_logs(id, subject, status, sent_at, first_opened_at, first_clicked_at)
      `).eq("enrollment_id",e).order("created_at",{ascending:!0});if(o)throw o;return r},async logHistory(e,r){const{data:o,error:a}=await y.from("enrollment_history").insert({enrollment_id:e,...r}).select().single();if(a)throw a;return o}};function Lt(e,r={}){return Z({queryKey:["enrollments","account",e,r],queryFn:()=>Et.getByAccount(e,r),enabled:!!e,staleTime:3e4})}const Te={async getAll(e,r={}){const{status:o,automationId:a,accountId:i,limit:n=50,offset:s=0,startDate:l,endDate:c}=r;let d=y.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email, primary_contact_first_name),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",e).order("created_at",{ascending:!1}).range(s,s+n-1);o&&(d=d.eq("status",o)),a&&(d=d.eq("automation_id",a)),i&&(d=d.eq("account_id",i)),l&&(d=d.gte("sent_at",l)),c&&(d=d.lte("sent_at",c));const{data:k,error:g}=await d;if(g)throw g;return k},async getById(e,r){const{data:o,error:a}=await y.from("email_logs").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name),
        enrollment:automation_enrollments(id, status)
      `).eq("owner_id",e).eq("id",r).single();if(a)throw a;return o},async getByIdWithEvents(e,r){const o=await this.getById(e,r),{data:a,error:i}=await y.from("email_events").select("*").eq("email_log_id",r).order("event_timestamp",{ascending:!0});if(i)throw i;return{...o,events:a}},async getByAccount(e,r,o={}){const{limit:a=20}=o,{data:i,error:n}=await y.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",e).eq("account_id",r).order("created_at",{ascending:!1}).limit(a);if(n)throw n;return i},async getByAutomation(e,r,o={}){const{limit:a=50,offset:i=0,status:n}=o;let s=y.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",e).eq("automation_id",r).order("created_at",{ascending:!1}).range(i,i+a-1);n&&(s=s.eq("status",n));const{data:l,error:c}=await s;if(c)throw c;return l},async create(e,r){const{data:o,error:a}=await y.from("email_logs").insert({owner_id:e,status:"Queued",...r}).select().single();if(a)throw a;return o},async updateStatus(e,r,o,a={}){const{data:i,error:n}=await y.from("email_logs").update({status:o,...a,updated_at:new Date().toISOString()}).eq("owner_id",e).eq("id",r).select().single();if(n)throw n;return i},async markSent(e,r,o){return this.updateStatus(e,r,"Sent",{sent_at:new Date().toISOString(),sendgrid_message_id:o})},async markFailed(e,r,o,a=null){return this.updateStatus(e,r,"Failed",{failed_at:new Date().toISOString(),error_message:o,error_code:a})},async getRecentOpens(e,r=10){const{data:o,error:a}=await y.from("email_logs").select(`
        id, subject, first_opened_at, open_count,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",e).not("first_opened_at","is",null).order("first_opened_at",{ascending:!1}).limit(r);if(a)throw a;return o},async getRecentClicks(e,r=10){const{data:o,error:a}=await y.from("email_logs").select(`
        id, subject, first_clicked_at, click_count,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",e).not("first_clicked_at","is",null).order("first_clicked_at",{ascending:!1}).limit(r);if(a)throw a;return o},async getBounces(e,r={}){const{limit:o=50,offset:a=0}=r,{data:i,error:n}=await y.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",e).eq("status","Bounced").order("bounced_at",{ascending:!1}).range(a,a+o-1);if(n)throw n;return i},async getStats(e,r,o,a=null){const{data:i,error:n}=await y.rpc("get_email_stats",{p_owner_id:e,p_start_date:r,p_end_date:o,p_automation_id:a});if(n)throw n;return(i==null?void 0:i[0])||{total_sent:0,total_delivered:0,total_opened:0,unique_opens:0,total_clicked:0,unique_clicks:0,total_bounced:0,open_rate:0,click_rate:0}},async getDailyStats(e,r,o,a=null){let i=y.from("email_stats_daily").select("*").eq("owner_id",e).gte("stat_date",r).lte("stat_date",o).order("stat_date");a?i=i.eq("automation_id",a):i=i.is("automation_id",null);const{data:n,error:s}=await i;if(s)throw s;return n},async getComparisonStats(e,r=30){const o=new Date,a=new Date(o);a.setDate(a.getDate()-r);const i=new Date(a);i.setDate(i.getDate()-r);const[n,s]=await Promise.all([this.getStats(e,a.toISOString().split("T")[0],o.toISOString().split("T")[0]),this.getStats(e,i.toISOString().split("T")[0],a.toISOString().split("T")[0])]),l=(c,d)=>d===0?c>0?100:0:((c-d)/d*100).toFixed(1);return{current:n,previous:s,changes:{sent:l(n.total_sent,s.total_sent),delivered:l(n.total_delivered,s.total_delivered),opened:l(n.unique_opens,s.unique_opens),clicked:l(n.unique_clicks,s.unique_clicks),bounced:l(n.total_bounced,s.total_bounced)}}}},Pt=()=>{const{userId:e}=ee();return e};function Ot(e,r={}){const o=Pt();return Z({queryKey:["emailLogs",o,"account",e,r],queryFn:()=>Te.getByAccount(o,e,r),enabled:!!o&&!!e,staleTime:3e4})}const xt={async getRecent(e,r={}){const{category:o,limit:a=20,offset:i=0}=r;let n=y.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name),
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).eq("owner_id",e).order("created_at",{ascending:!1}).range(i,i+a-1);o&&(n=n.eq("event_category",o));const{data:s,error:l}=await n;if(l)throw l;return s},async getByAccount(e,r,o=20){const{data:a,error:i}=await y.from("activity_log").select(`
        *,
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).eq("owner_id",e).eq("account_id",r).order("created_at",{ascending:!1}).limit(o);if(i)throw i;return a},async getByAutomation(e,r,o=50){const{data:a,error:i}=await y.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("owner_id",e).eq("automation_id",r).order("created_at",{ascending:!1}).limit(o);if(i)throw i;return a},async getByType(e,r,o={}){const{limit:a=50,offset:i=0}=o,{data:n,error:s}=await y.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("owner_id",e).eq("event_type",r).order("created_at",{ascending:!1}).range(i,i+a-1);if(s)throw s;return n},async log(e,r){const{data:o,error:a}=await y.from("activity_log").insert({owner_id:e,...r}).select().single();if(a)throw a;return o},async logEmailSent(e,r,o,a=null){return this.log(e,{event_type:"email_sent",event_category:"email",title:"Email sent",email_log_id:r,account_id:o,automation_id:a,actor_type:a?"automation":"user"})},async logEmailOpened(e,r,o){return this.log(e,{event_type:"email_opened",event_category:"email",title:"Email opened",email_log_id:r,account_id:o,actor_type:"system"})},async logEmailClicked(e,r,o,a=null){return this.log(e,{event_type:"email_clicked",event_category:"email",title:"Email link clicked",email_log_id:r,account_id:o,actor_type:"system",event_data:a?{url:a}:{}})},async logEnrollment(e,r,o,a){return this.log(e,{event_type:"enrollment_created",event_category:"automation",title:`Enrolled in ${a}`,automation_id:r,account_id:o,actor_type:"automation"})},async logAutomationCompleted(e,r,o,a){return this.log(e,{event_type:"automation_completed",event_category:"automation",title:`Completed ${a}`,automation_id:r,account_id:o,actor_type:"automation"})},async logUnsubscribe(e,r,o,a=null){return this.log(e,{event_type:"unsubscribed",event_category:"account",title:o==="all"?"Unsubscribed from all emails":"Unsubscribed from automation",account_id:r,automation_id:a,actor_type:"system",severity:"warning"})},async logBounce(e,r,o,a){return this.log(e,{event_type:"email_bounced",event_category:"email",title:`Email bounced (${a})`,email_log_id:r,account_id:o,actor_type:"system",severity:"warning",event_data:{bounce_type:a}})},async getStats(e,r=7){const o=new Date;o.setDate(o.getDate()-r);const{data:a,error:i}=await y.from("activity_log").select("event_type, event_category").eq("owner_id",e).gte("created_at",o.toISOString());if(i)throw i;const n={total:a.length,byType:{},byCategory:{}};return a.forEach(s=>{n.byType[s.event_type]=(n.byType[s.event_type]||0)+1,n.byCategory[s.event_category]=(n.byCategory[s.event_category]||0)+1}),n}},gt={async getAll(e,r={}){const{status:o,automationId:a,limit:i=50,offset:n=0}=r;let s=y.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",e).order("scheduled_for",{ascending:!0}).range(n,n+i-1);o&&(s=s.eq("status",o)),a&&(s=s.eq("automation_id",a));const{data:l,error:c}=await s;if(c)throw c;return l},async getUpcoming(e,r=10){const{data:o,error:a}=await y.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        automation:automations(id, name)
      `).eq("owner_id",e).eq("status","Pending").gte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0}).limit(r);if(a)throw a;return o},async getReadyToSend(){const{data:e,error:r}=await y.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name, owner_id)
      `).eq("status","Pending").lte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0});if(r)throw r;return e},async getById(e,r){const{data:o,error:a}=await y.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name)
      `).eq("owner_id",e).eq("id",r).single();if(a)throw a;return o},async create(e,r){const{data:o,error:a}=await y.from("scheduled_emails").insert({owner_id:e,status:"Pending",...r}).select().single();if(a)throw a;return o},async createBatch(e,r){const o=r.map(n=>({owner_id:e,status:"Pending",...n})),{data:a,error:i}=await y.from("scheduled_emails").insert(o).select();if(i)throw i;return a},async update(e,r,o){const{data:a,error:i}=await y.from("scheduled_emails").update({...o,updated_at:new Date().toISOString()}).eq("owner_id",e).eq("id",r).select().single();if(i)throw i;return a},async cancel(e,r){return this.update(e,r,{status:"Cancelled"})},async reschedule(e,r,o){return this.update(e,r,{scheduled_for:o,status:"Pending",attempts:0})},async markProcessing(e){const{data:r,error:o}=await y.from("scheduled_emails").update({status:"Processing",last_attempt_at:new Date().toISOString(),attempts:y.sql`attempts + 1`,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;return r},async markSent(e,r){const{data:o,error:a}=await y.from("scheduled_emails").update({status:"Sent",email_log_id:r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(a)throw a;return o},async markFailed(e,r){const{data:o,error:a}=await y.from("scheduled_emails").select("attempts, max_attempts").eq("id",e).single();if(a)throw a;const i=o.attempts<o.max_attempts,{data:n,error:s}=await y.from("scheduled_emails").update({status:i?"Pending":"Failed",error_message:r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw s;return n},async delete(e,r){const{error:o}=await y.from("scheduled_emails").delete().eq("owner_id",e).eq("id",r);if(o)throw o;return!0},async getStats(e){const{data:r,error:o}=await y.from("scheduled_emails").select("status, scheduled_for").eq("owner_id",e);if(o)throw o;const a=new Date,i={pending:0,processing:0,sent:0,failed:0,cancelled:0,upcomingToday:0,upcomingThisWeek:0},n=new Date(a);n.setHours(23,59,59,999);const s=new Date(a);return s.setDate(s.getDate()+7),r.forEach(l=>{if(i[l.status.toLowerCase()]++,l.status==="Pending"){const c=new Date(l.scheduled_for);c<=n&&i.upcomingToday++,c<=s&&i.upcomingThisWeek++}}),i}},ke={async getAll(e,r={}){const{status:o,search:a,limit:i=25,offset:n=0,expiring:s=!1}=r;let l=y.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",e);if(o){let M=o;o.toLowerCase()==="prior"&&(M="prior_customer"),l=l.ilike("account_status",M)}a&&(l=l.or(`name.ilike.%${a}%,person_email.ilike.%${a}%,email.ilike.%${a}%`));const{count:c,error:d}=await l;if(d)throw d;let k=y.from("accounts").select("*").eq("owner_id",e).order("name").range(n,n+i-1);if(o){let M=o;o.toLowerCase()==="prior"&&(M="prior_customer"),k=k.ilike("account_status",M)}a&&(k=k.or(`name.ilike.%${a}%,person_email.ilike.%${a}%,email.ilike.%${a}%`));const{data:g,error:u}=await k;if(u)throw u;if(!g||g.length===0)return{accounts:[],total:c||0};const w=g.map(M=>M.account_unique_id).filter(Boolean),C=new Date().toISOString().split("T")[0],v=new Date;v.setDate(v.getDate()+30);const p=v.toISOString().split("T")[0];if(w.length>0){const{data:M,error:$}=await y.from("policies").select("account_id, policy_lob, policy_status, expiration_date").in("account_id",w);if(!$&&M){const E={};M.forEach(j=>{var O;E[j.account_id]||(E[j.account_id]=[]);const W=j.expiration_date&&j.expiration_date>=C&&j.expiration_date<=p;E[j.account_id].push({policy_type:j.policy_lob,status:((O=j.policy_status)==null?void 0:O.toLowerCase())||"unknown",expiration_date:j.expiration_date,is_expiring:W})}),g.forEach(j=>{j.policies=E[j.account_unique_id]||[],j.policy_count=j.policies.length,j.has_expiring_policy=j.policies.some(W=>W.is_expiring),j.expiring_policy_count=j.policies.filter(W=>W.is_expiring).length})}}if(s){const M=g.filter($=>$.has_expiring_policy);return{accounts:M,total:M.length,isExpiringFilter:!0}}return{accounts:g,total:c||0}},async getStats(e){const{count:r,error:o}=await y.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",e);if(o)throw o;const{count:a}=await y.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",e).ilike("account_status","customer"),{count:i}=await y.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",e).ilike("account_status","prospect"),{count:n}=await y.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",e).ilike("account_status","prior_customer"),{count:s}=await y.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",e).ilike("account_status","lead");let l=0;const c=new Date().toISOString().split("T")[0],d=new Date;d.setDate(d.getDate()+30);const k=d.toISOString().split("T")[0],{count:g}=await y.from("policies").select("*",{count:"exact",head:!0}).gte("expiration_date",c).lte("expiration_date",k);if(g&&g>0){const{data:u}=await y.from("policies").select("account_id").gte("expiration_date",c).lte("expiration_date",k).limit(5e3);if(u&&u.length>0){const w=[...new Set(u.map(m=>m.account_id).filter(Boolean))];if(w.length>0){let m=0;const C=100;for(let v=0;v<w.length;v+=C){const p=w.slice(v,v+C),{count:M}=await y.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",e).in("account_unique_id",p);m+=M||0}l=m}}}return{Customer:a||0,Prospect:i||0,Prior:n||0,Lead:s||0,total:r||0,expiring:l}},async getById(e){const{data:r,error:o}=await y.from("accounts").select("*").eq("account_unique_id",e).single();if(o)throw o;return r},async getByIdWithPolicies(e){const{data:r,error:o}=await y.from("accounts").select("*").eq("account_unique_id",e).single();if(o)throw o;if(!r)return null;const{data:a,error:i}=await y.from("policies").select("*").eq("account_id",e).order("expiration_date",{ascending:!1});if(i)return console.error("Error fetching policies:",i),{...r,policies:[]};if(a&&a.length>0){const n=[...new Set(a.map(s=>s.carrier_id).filter(Boolean))];if(n.length>0){const{data:s,error:l}=await y.from("carriers").select("id, name").in("id",n);if(s&&s.length>0){const c={};s.forEach(d=>{c[d.id]=d.name}),a.forEach(d=>{d.carrier_id&&c[d.carrier_id]&&(d.carrier={name:c[d.carrier_id]})})}}}return{...r,policies:a||[]}},async getByIdWithEmailHistory(e,r){const o=await this.getByIdWithPolicies(r),{data:a,error:i}=await y.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",e).eq("account_id",r).order("created_at",{ascending:!1}).limit(20);if(i)throw i;const{data:n,error:s}=await y.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category)
      `).eq("account_id",r).order("enrolled_at",{ascending:!1});if(s)throw s;return{...o,emailLogs:a,enrollments:n}},async search(e,r,o=20){const{data:a,error:i}=await y.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name").eq("owner_id",e).or(`name.ilike.%${r}%,person_email.ilike.%${r}%,email.ilike.%${r}%,primary_contact_first_name.ilike.%${r}%,primary_contact_last_name.ilike.%${r}%`).limit(o);if(i)throw i;return a},async getByStatus(e,r,o={}){const{limit:a=50,offset:i=0}=o,{data:n,error:s}=await y.from("accounts").select("*").eq("owner_id",e).eq("account_status",r).order("name").range(i,i+a-1);if(s)throw s;return n},async getCustomers(e,r={}){return this.getByStatus(e,"customer",r)},async getProspects(e,r={}){return this.getByStatus(e,"prospect",r)},async getPriorCustomers(e,r={}){return this.getByStatus(e,"prior_customer",r)},async getWithExpiringPolicies(e,r=45){const o=new Date;o.setDate(o.getDate()+r);const{data:a,error:i}=await y.from("policies").select(`
        policy_unique_id,
        policy_lob,
        expiration_date,
        policy_status,
        account_id,
        account:accounts!policies_account_id_fkey(
          account_unique_id,
          name,
          person_email,
          email,
          owner_id,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("policy_status","Active").lte("expiration_date",o.toISOString().split("T")[0]).gte("expiration_date",new Date().toISOString().split("T")[0]).order("expiration_date");if(i)throw i;return a.filter(n=>{var s;return((s=n.account)==null?void 0:s.owner_id)===e})},async getCounts(e){const{data:r,error:o}=await y.from("accounts").select("account_status").eq("owner_id",e);if(o)throw o;const a={total:r.length,customer:0,prospect:0,prior_customer:0,other:0};return r.forEach(i=>{var s;const n=((s=i.account_status)==null?void 0:s.toLowerCase().replace(" ","_"))||"other";a[n]!==void 0?a[n]++:a.other++}),a},getEmail(e){return e.person_email||e.email},getDisplayName(e){return e.primary_contact_first_name?`${e.primary_contact_first_name} ${e.primary_contact_last_name||""}`.trim():e.name},canReceiveMarketing(e){return e.user_subscribed_to_marketing!==!1&&e.person_has_opted_out_of_email!==!0&&(e.person_email||e.email)},async getEligibleForAutomation(e,r){let o=y.from("accounts").select("*").eq("owner_id",e).or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false").not("person_email","is",null);const{data:a,error:i}=await o;if(i)throw i;const n=a.map(d=>d.account_unique_id),{data:s,error:l}=await y.from("policies").select("*").in("account_id",n);if(l)throw l;return a.map(d=>({...d,policies:s.filter(k=>k.account_id===d.account_unique_id)})).filter(d=>this.canReceiveMarketing(d))}},yt={async getDashboardData(e,r={}){const{days:o=30}=r,[a,i,n,s,l,c,d]=await Promise.all([Te.getComparisonStats(e,o),xt.getRecent(e,{limit:10}),gt.getUpcoming(e,5),Te.getRecentOpens(e,5),Te.getRecentClicks(e,5),ke.getCounts(e),this.getAutomationStats(e)]);return{emailStats:a.current,emailChanges:a.changes,recentActivity:i,scheduledEmails:n,recentOpens:s,recentClicks:l,accountCounts:c,automationStats:d}},async getAutomationStats(e){const{data:r,error:o}=await y.from("automations").select(`
        id,
        name,
        status,
        stats
      `).eq("owner_id",e).eq("status","Active");if(o)throw o;const a=r.map(l=>l.id),{data:i,error:n}=await y.from("automation_enrollments").select("automation_id, status").in("automation_id",a);if(n)throw n;const s={};return i.forEach(l=>{s[l.automation_id]||(s[l.automation_id]={active:0,total:0}),s[l.automation_id].total++,l.status==="Active"&&s[l.automation_id].active++}),{total:r.length,active:r.filter(l=>l.status==="Active").length,automations:r.map(l=>{var c,d;return{...l,enrollmentCount:((c=s[l.id])==null?void 0:c.total)||0,activeEnrollments:((d=s[l.id])==null?void 0:d.active)||0}})}},async getEmailPerformanceOverTime(e,r=30){const o=new Date;o.setDate(o.getDate()-r);const{data:a,error:i}=await y.from("email_stats_daily").select("*").eq("owner_id",e).is("automation_id",null).gte("stat_date",o.toISOString().split("T")[0]).order("stat_date");if(i)throw i;return a},async getTopAutomations(e,r=5){const{data:o,error:a}=await y.from("automations").select("id, name, stats").eq("owner_id",e).eq("status","Active");if(a)throw a;return o.map(n=>{var s,l,c,d,k;return{...n,sent:((s=n.stats)==null?void 0:s.sent)||0,opened:((l=n.stats)==null?void 0:l.opened)||0,clicked:((c=n.stats)==null?void 0:c.clicked)||0,openRate:((d=n.stats)==null?void 0:d.sent)>0?(((k=n.stats)==null?void 0:k.opened)||0)/n.stats.sent*100:0}}).sort((n,s)=>s.openRate-n.openRate).slice(0,r)},async getAccountsNeedingAttention(e){const{data:r,error:o}=await y.from("email_logs").select(`
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",e).eq("status","Bounced").not("account_id","is",null).limit(10);if(o)throw o;const a=await ke.getWithExpiringPolicies(e,30);return{bouncedEmails:r.map(i=>i.account).filter((i,n,s)=>s.findIndex(l=>l.account_unique_id===i.account_unique_id)===n),expiringPolicies:a.slice(0,10)}},async getQuickStats(e){const r=new Date().toISOString().split("T")[0],o=new Date;o.setDate(o.getDate()-30);const[{count:a},{count:i},{count:n},{count:s}]=await Promise.all([y.from("email_logs").select("*",{count:"exact",head:!0}).eq("owner_id",e).gte("sent_at",r),y.from("email_logs").select("*",{count:"exact",head:!0}).eq("owner_id",e).gte("first_opened_at",r),y.from("automations").select("*",{count:"exact",head:!0}).eq("owner_id",e).eq("status","Active"),y.from("scheduled_emails").select("*",{count:"exact",head:!0}).eq("owner_id",e).eq("status","Pending")]);return{emailsToday:a||0,opensToday:i||0,activeAutomations:n||0,pendingScheduled:s||0}}},ht=()=>{const{userId:e}=ee();return e};function mt(){const e=ht();return Z({queryKey:["dashboard",e,"quick"],queryFn:()=>yt.getQuickStats(e),enabled:!!e,staleTime:1e4,refetchInterval:3e4})}function Ft(e=30){const r=ht();return Z({queryKey:["dashboard",r,"performance",e],queryFn:()=>yt.getEmailPerformanceOverTime(r,e),enabled:!!r})}const ft=()=>{const{userId:e}=ee();return e};function Nt(){const e=ft();return Z({queryKey:["userSettings",e],queryFn:()=>pe.get(e),enabled:!!e})}function Ht(){const e=ft(),r=Me(),o=()=>{r.invalidateQueries({queryKey:["userSettings",e]})},a=K({mutationFn:c=>pe.update(e,c),onSuccess:o}),i=K({mutationFn:c=>pe.updateSignature(e,c),onSuccess:o}),n=K({mutationFn:c=>pe.updateAgencyInfo(e,c),onSuccess:o}),s=K({mutationFn:c=>pe.updateEmailSettings(e,c),onSuccess:o}),l=K({mutationFn:c=>pe.updatePreferences(e,c),onSuccess:o});return{updateSettings:a,updateSignature:i,updateAgencyInfo:n,updateEmailSettings:s,updatePreferences:l}}const bt=()=>{const{userId:e}=ee();return e};function Gt(e={}){const r=bt();return Z({queryKey:["accounts",r,e],queryFn:()=>ke.getAll(r,e),enabled:!!r,staleTime:3e4})}function Ut(e){return Z({queryKey:["account",e,"policies"],queryFn:()=>ke.getByIdWithPolicies(e),enabled:!!e,staleTime:3e4})}function Kt(){const e=bt();return Z({queryKey:["accounts",e,"stats"],queryFn:()=>ke.getStats(e),enabled:!!e})}const Vt=()=>{const{userId:e}=ee();return e};function Qt(e,r=20){const o=Vt();return Z({queryKey:["activity",o,"account",e],queryFn:()=>xt.getByAccount(o,e,r),enabled:!!o&&!!e,staleTime:3e4})}const Yt=()=>{const{userId:e}=ee();return e};function Xt(e=10){const r=Yt();return Z({queryKey:["scheduledEmails",r,"upcoming",e],queryFn:()=>gt.getUpcoming(r,e),enabled:!!r})}const Zt=(e,r,o,a)=>{const n=(o-e)*Math.PI/180,s=(a-r)*Math.PI/180,l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 3959*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},we={},Jt=async e=>we[e]?we[e]:(console.warn("Google Maps API key not configured"),we[e]=null,null),eo=async(e,r=10)=>{const o={},a=[...new Set(e.filter(Boolean))],i=[];for(const n of a)we[n]?o[n]=we[n]:i.push(n);if(i.length===0)return o;for(let n=0;n<i.length;n+=r){const s=i.slice(n,n+r),l=await Promise.all(s.map(c=>Jt(c)));s.forEach((c,d)=>{l[d]&&(o[c]=l[d])})}return o},ue={async getAll(e,r={}){const{status:o,limit:a=50,offset:i=0}=r;let n=y.from("mass_email_batches").select(`
        *,
        template:email_templates(id, name, subject)
      `).eq("owner_id",e).order("created_at",{ascending:!1}).range(i,i+a-1);o&&(n=n.eq("status",o));const{data:s,error:l}=await n;if(l)throw l;return s},async getById(e,r){const{data:o,error:a}=await y.from("mass_email_batches").select(`
        *,
        template:email_templates(*)
      `).eq("owner_id",e).eq("id",r).single();if(a)throw a;return o},async create(e,r){const{data:o,error:a}=await y.from("mass_email_batches").insert({owner_id:e,status:"Draft",...r}).select().single();if(a)throw a;return o},async update(e,r,o){const{data:a,error:i}=await y.from("mass_email_batches").update({...o,updated_at:new Date().toISOString()}).eq("owner_id",e).eq("id",r).select().single();if(i)throw i;return a},async delete(e,r){const{error:o}=await y.from("mass_email_batches").delete().eq("owner_id",e).eq("id",r).eq("status","Draft");if(o)throw o;return!0},async getRecipients(e,r,o={}){const{limit:a=100,offset:i=0}=o,{rules:n=[],groups:s=[],notOptedOut:l=!0,search:c=""}=r||{};let d=s.length>0?s:n.length>0?[{rules:n}]:[];const k=Array.isArray(e)?e:[e];let g=y.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name, person_has_opted_out_of_email, billing_city, billing_state, billing_postal_code, billing_street, created_at").in("owner_id",k);l&&(g=g.or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false")),c&&(g=g.or(`name.ilike.%${c}%,person_email.ilike.%${c}%,email.ilike.%${c}%`)),d.length===0?g=g.order("name").range(i,i+a-1):g=g.order("name").limit(1e4);const{data:u,error:w}=await g;if(w)throw w;let m=u.filter(I=>{const H=I.person_email||I.email;return H&&H.includes("@")});if(d.length===0)return m;const C=d.some(I=>(I.rules||[]).some(P=>["policy_type","active_policy_type","policy_status","policy_count","policy_expiration","policy_effective"].includes(P.field)&&P.value));let v={};if(C&&m.length>0){const I=m.map(T=>T.account_unique_id),{data:H,error:P}=await y.from("policies").select("account_id, policy_lob, expiration_date, effective_date, policy_status").in("account_id",I);if(P)throw P;H.forEach(T=>{v[T.account_id]||(v[T.account_id]=[]),v[T.account_id].push(T)})}let p={};if(m.length>0){const I=m.map(T=>T.account_unique_id),{data:H,error:P}=await y.from("email_logs").select("account_id, sent_at").in("account_id",I).eq("status","sent").order("sent_at",{ascending:!1});if(P)throw P;H==null||H.forEach(T=>{!p[T.account_id]&&T.sent_at&&(p[T.account_id]=T.sent_at)})}const M=d.some(I=>(I.rules||[]).some(P=>P.field==="location"&&P.value));let $={};if(M&&m.length>0){const I={};m.forEach(P=>{const T=(P.billing_postal_code||"").trim(),x=(P.billing_city||"").trim(),D=(P.billing_state||"").trim();let U="";T&&D?U=`${T}, ${D}, USA`:x&&D?U=`${x}, ${D}, USA`:T&&(U=`${T}, USA`),U&&(I[P.account_unique_id]=U)});const H=[...new Set(Object.values(I))];$=await eo(H),m.forEach(P=>{P._locationKey=I[P.account_unique_id]})}const E=(I,H,P)=>{const{field:T,operator:x,value:D,value2:U,radius:oe}=H;if(!T||!x||!["is_empty","is_not_empty"].includes(x)&&!D)return!0;switch(T){case"account_status":{const z=(I.account_status||"").toLowerCase();return x==="is"?z===D.toLowerCase():x==="is_not"?z!==D.toLowerCase():x==="is_any"?D.split(",").map(h=>h.toLowerCase()).includes(z):x==="is_not_any"?!D.split(",").map(h=>h.toLowerCase()).includes(z):!0}case"policy_type":{const z=["is_any","is_not_any"].includes(x)?D.split(","):[D],S=P.some(h=>z.some(_=>{var b;return(b=h.policy_lob)==null?void 0:b.toLowerCase().includes(_.toLowerCase())}));return x==="is"||x==="is_any"?S:x==="is_not"||x==="is_not_any"?!S:!0}case"active_policy_type":{const z=["is_any","is_not_any"].includes(x)?D.split(","):[D],h=P.filter(_=>{var R;return((R=_.policy_status)==null?void 0:R.toLowerCase().trim())==="active"}).some(_=>z.some(b=>{var R;return(R=_.policy_lob)==null?void 0:R.toLowerCase().includes(b.toLowerCase())}));return x==="is"||x==="is_any"?h:x==="is_not"||x==="is_not_any"?!h:!0}case"policy_status":{const z=["is_any","is_not_any"].includes(x)?D.split(","):[D],S=P.some(h=>z.some(_=>{var b;return((b=h.policy_status)==null?void 0:b.toLowerCase())===_.toLowerCase()}));return x==="is"||x==="is_any"?S:x==="is_not"||x==="is_not_any"?!S:!0}case"policy_count":{const z=P.length,S=parseInt(D,10),h=U?parseInt(U,10):S;return x==="equals"?z===S:x==="greater_than"?z>S:x==="less_than"?z<S:x==="at_least"?z>=S:x==="at_most"?z<=S:x==="between"?z>=S&&z<=h:!0}case"policy_expiration":{const z=P.filter(h=>{var _;return((_=h.policy_status)==null?void 0:_.toLowerCase().trim())==="active"}),S=new Date().toISOString().split("T")[0];if(x==="in_next_days"){const h=parseInt(D,10),_=new Date;_.setDate(_.getDate()+h);const b=_.toISOString().split("T")[0];return z.some(R=>R.expiration_date&&R.expiration_date>=S&&R.expiration_date<=b)}if(x==="in_last_days"){const h=parseInt(D,10),_=new Date;_.setDate(_.getDate()-h);const b=_.toISOString().split("T")[0];return z.some(R=>R.expiration_date&&R.expiration_date>=b&&R.expiration_date<=S)}if(x==="more_than_days_future"){const h=parseInt(D,10),_=new Date;_.setDate(_.getDate()+h);const b=_.toISOString().split("T")[0];return z.some(R=>R.expiration_date&&R.expiration_date>b)}if(x==="less_than_days_future"){const h=parseInt(D,10),_=new Date;_.setDate(_.getDate()+h);const b=_.toISOString().split("T")[0];return z.some(R=>R.expiration_date&&R.expiration_date>=S&&R.expiration_date<b)}if(x==="more_than_days_ago"){const h=parseInt(D,10),_=new Date;_.setDate(_.getDate()-h);const b=_.toISOString().split("T")[0];return z.some(R=>R.expiration_date&&R.expiration_date<b)}if(x==="less_than_days_ago"){const h=parseInt(D,10),_=new Date;_.setDate(_.getDate()-h);const b=_.toISOString().split("T")[0];return z.some(R=>R.expiration_date&&R.expiration_date>=b&&R.expiration_date<=S)}return x==="before"?z.some(h=>h.expiration_date&&h.expiration_date<D):x==="after"?z.some(h=>h.expiration_date&&h.expiration_date>D):x==="between"?z.some(h=>h.expiration_date&&h.expiration_date>=D&&h.expiration_date<=(U||D)):!0}case"policy_effective":{const z=P.filter(h=>{var _;return((_=h.policy_status)==null?void 0:_.toLowerCase().trim())==="active"}),S=new Date().toISOString().split("T")[0];if(x==="in_next_days"){const h=parseInt(D,10),_=new Date;_.setDate(_.getDate()+h);const b=_.toISOString().split("T")[0];return z.some(R=>R.effective_date&&R.effective_date>=S&&R.effective_date<=b)}if(x==="in_last_days"){const h=parseInt(D,10),_=new Date;_.setDate(_.getDate()-h);const b=_.toISOString().split("T")[0];return z.some(R=>R.effective_date&&R.effective_date>=b&&R.effective_date<=S)}if(x==="more_than_days_future"){const h=parseInt(D,10),_=new Date;_.setDate(_.getDate()+h);const b=_.toISOString().split("T")[0];return z.some(R=>R.effective_date&&R.effective_date>b)}if(x==="less_than_days_future"){const h=parseInt(D,10),_=new Date;_.setDate(_.getDate()+h);const b=_.toISOString().split("T")[0];return z.some(R=>R.effective_date&&R.effective_date>=S&&R.effective_date<b)}if(x==="more_than_days_ago"){const h=parseInt(D,10),_=new Date;_.setDate(_.getDate()-h);const b=_.toISOString().split("T")[0];return z.some(R=>R.effective_date&&R.effective_date<b)}if(x==="less_than_days_ago"){const h=parseInt(D,10),_=new Date;_.setDate(_.getDate()-h);const b=_.toISOString().split("T")[0];return z.some(R=>R.effective_date&&R.effective_date>=b&&R.effective_date<=S)}return x==="before"?z.some(h=>h.effective_date&&h.effective_date<D):x==="after"?z.some(h=>h.effective_date&&h.effective_date>D):x==="between"?z.some(h=>h.effective_date&&h.effective_date>=D&&h.effective_date<=(U||D)):!0}case"state":{const z=(I.billing_state||"").toUpperCase();return x==="is"?z===D.toUpperCase():x==="is_not"?z!==D.toUpperCase():x==="is_any"?D.split(",").map(h=>h.toUpperCase()).includes(z):x==="is_not_any"?!D.split(",").map(h=>h.toUpperCase()).includes(z):!0}case"city":{const z=(I.billing_city||"").toLowerCase(),S=(D||"").toLowerCase();return x==="contains"?z.includes(S):x==="not_contains"?!z.includes(S):x==="equals"?z===S:x==="not_equals"?z!==S:x==="starts_with"?z.startsWith(S):x==="ends_with"?z.endsWith(S):x==="is_empty"?z.trim()==="":x==="is_not_empty"?z.trim()!=="":!0}case"zip_code":{const z=(I.billing_postal_code||"").toLowerCase().trim(),S=(D||"").toLowerCase().trim();return x==="contains"?z.includes(S):x==="not_contains"?!z.includes(S):x==="equals"?z===S:x==="not_equals"?z!==S:x==="starts_with"?z.startsWith(S):x==="ends_with"?z.endsWith(S):x==="is_empty"?z==="":x==="is_not_empty"?z!=="":!0}case"email_domain":{const z=(I.person_email||I.email||"").toLowerCase(),S=z.includes("@")?z.split("@")[1]:"",h=(D||"").toLowerCase().trim();return x==="contains"?S.includes(h):x==="not_contains"?!S.includes(h):x==="equals"?S===h:x==="not_equals"?S!==h:x==="starts_with"?S.startsWith(h):x==="ends_with"?S.endsWith(h):x==="is_empty"?S==="":x==="is_not_empty"?S!=="":!0}case"location":{if(x!=="within_radius"||!D)return!0;const[z,S]=D.split(",").map(parseFloat),h=parseInt(oe||"25",10),_=I._locationKey;if(!_)return!1;const b=$[_];return b?Zt(z,S,b.lat,b.lng)<=h:!1}case"last_email_sent":{const z=p[I.account_unique_id],S=new Date().toISOString().split("T")[0];if(!z)return x==="before"?!0:x==="in_last_days"||x==="less_than_days_ago"?!1:x==="more_than_days_ago"?!0:!(x==="in_next_days"||x==="more_than_days_future"||x==="less_than_days_future"||x==="after"||x==="between");const h=z.split("T")[0];if(x==="in_last_days"){const _=parseInt(D,10),b=new Date;b.setDate(b.getDate()-_);const R=b.toISOString().split("T")[0];return h>=R&&h<=S}if(x==="more_than_days_ago"){const _=parseInt(D,10),b=new Date;b.setDate(b.getDate()-_);const R=b.toISOString().split("T")[0];return h<R}if(x==="less_than_days_ago"){const _=parseInt(D,10),b=new Date;b.setDate(b.getDate()-_);const R=b.toISOString().split("T")[0];return h>=R&&h<=S}return x==="before"?h<D:x==="after"?h>D:x==="between"?h>=D&&h<=(U||D):!0}case"account_created":{const z=I.created_at;if(!z)return!1;const S=z.split("T")[0],h=new Date().toISOString().split("T")[0];if(x==="in_next_days"||x==="more_than_days_future"||x==="less_than_days_future")return!1;if(x==="in_last_days"){const _=parseInt(D,10),b=new Date;b.setDate(b.getDate()-_);const R=b.toISOString().split("T")[0];return S>=R&&S<=h}if(x==="more_than_days_ago"){const _=parseInt(D,10),b=new Date;b.setDate(b.getDate()-_);const R=b.toISOString().split("T")[0];return S<R}if(x==="less_than_days_ago"){const _=parseInt(D,10),b=new Date;b.setDate(b.getDate()-_);const R=b.toISOString().split("T")[0];return S>=R&&S<=h}return x==="before"?S<D:x==="after"?S>D:x==="between"?S>=D&&S<=(U||D):!0}default:return!0}},j=(I,H)=>{var oe,te,z;const{field:P,operator:T,value:x,value2:D}=H,U=new Date().toISOString().split("T")[0];switch(P){case"active_policy_type":{if(((oe=I.policy_status)==null?void 0:oe.toLowerCase().trim())!=="active")return!1;const _=(["is_any","is_not_any"].includes(T)?x.split(","):[x]).some(b=>{var R;return(R=I.policy_lob)==null?void 0:R.toLowerCase().includes(b.toLowerCase())});return T==="is"||T==="is_any"?_:T==="is_not"||T==="is_not_any"?!_:!0}case"policy_type":{const h=(["is_any","is_not_any"].includes(T)?x.split(","):[x]).some(_=>{var b;return(b=I.policy_lob)==null?void 0:b.toLowerCase().includes(_.toLowerCase())});return T==="is"||T==="is_any"?h:T==="is_not"||T==="is_not_any"?!h:!0}case"policy_status":{const h=(["is_any","is_not_any"].includes(T)?x.split(","):[x]).some(_=>{var b;return((b=I.policy_status)==null?void 0:b.toLowerCase())===_.toLowerCase()});return T==="is"||T==="is_any"?h:T==="is_not"||T==="is_not_any"?!h:!0}case"policy_expiration":{if(((te=I.policy_status)==null?void 0:te.toLowerCase().trim())!=="active")return!1;const h=I.expiration_date;if(!h)return!1;if(T==="in_next_days"){const _=parseInt(x,10),b=new Date;b.setDate(b.getDate()+_);const R=b.toISOString().split("T")[0];return h>=U&&h<=R}if(T==="in_last_days"){const _=parseInt(x,10),b=new Date;b.setDate(b.getDate()-_);const R=b.toISOString().split("T")[0];return h>=R&&h<=U}if(T==="more_than_days_future"){const _=parseInt(x,10),b=new Date;b.setDate(b.getDate()+_);const R=b.toISOString().split("T")[0];return h>R}if(T==="less_than_days_future"){const _=parseInt(x,10),b=new Date;b.setDate(b.getDate()+_);const R=b.toISOString().split("T")[0];return h>=U&&h<R}if(T==="more_than_days_ago"){const _=parseInt(x,10),b=new Date;b.setDate(b.getDate()-_);const R=b.toISOString().split("T")[0];return h<R}if(T==="less_than_days_ago"){const _=parseInt(x,10),b=new Date;b.setDate(b.getDate()-_);const R=b.toISOString().split("T")[0];return h>=R&&h<=U}return T==="before"?h<x:T==="after"?h>x:T==="between"?h>=x&&h<=(D||x):!0}case"policy_effective":{if(((z=I.policy_status)==null?void 0:z.toLowerCase().trim())!=="active")return!1;const h=I.effective_date;if(!h)return!1;if(T==="in_next_days"){const _=parseInt(x,10),b=new Date;b.setDate(b.getDate()+_);const R=b.toISOString().split("T")[0];return h>=U&&h<=R}if(T==="in_last_days"){const _=parseInt(x,10),b=new Date;b.setDate(b.getDate()-_);const R=b.toISOString().split("T")[0];return h>=R&&h<=U}if(T==="more_than_days_future"){const _=parseInt(x,10),b=new Date;b.setDate(b.getDate()+_);const R=b.toISOString().split("T")[0];return h>R}if(T==="less_than_days_future"){const _=parseInt(x,10),b=new Date;b.setDate(b.getDate()+_);const R=b.toISOString().split("T")[0];return h>=U&&h<R}if(T==="more_than_days_ago"){const _=parseInt(x,10),b=new Date;b.setDate(b.getDate()-_);const R=b.toISOString().split("T")[0];return h<R}if(T==="less_than_days_ago"){const _=parseInt(x,10),b=new Date;b.setDate(b.getDate()-_);const R=b.toISOString().split("T")[0];return h>=R&&h<=U}return T==="before"?h<x:T==="after"?h>x:T==="between"?h>=x&&h<=(D||x):!0}default:return!0}},W=["active_policy_type","policy_type","policy_status","policy_expiration","policy_effective"],O=I=>["is_not","is_not_any"].includes(I.operator),V=(I,H)=>{const{field:P,operator:T,value:x}=H,D=["is_any","is_not_any"].includes(T)?x.split(","):[x];return P==="active_policy_type"?!I.filter(te=>{var z;return((z=te.policy_status)==null?void 0:z.toLowerCase().trim())==="active"}).some(te=>D.some(z=>{var S;return(S=te.policy_lob)==null?void 0:S.toLowerCase().includes(z.toLowerCase())})):P==="policy_type"?!I.some(oe=>D.some(te=>{var z;return(z=oe.policy_lob)==null?void 0:z.toLowerCase().includes(te.toLowerCase())})):P==="policy_status"?!I.some(oe=>D.some(te=>{var z;return((z=oe.policy_status)==null?void 0:z.toLowerCase())===te.toLowerCase()})):!0},F=(I,H)=>{const P=H.rules||[];if(P.length===0)return!0;const T=v[I.account_unique_id]||[],x=P.filter(S=>W.includes(S.field)&&S.operator&&S.value&&!O(S)),D=P.filter(S=>W.includes(S.field)&&S.operator&&S.value&&O(S));return!P.filter(S=>!W.includes(S.field)||!S.operator||!S.value).every(S=>E(I,S,T))||!D.every(S=>V(T,S))?!1:x.length===0?!0:T.some(S=>x.every(h=>j(S,h)))},N=new Set,L=[];for(const I of m){const H=[];d.forEach((P,T)=>{F(I,P)&&H.push(T)}),H.length>0&&!N.has(I.account_unique_id)&&(N.add(I.account_unique_id),L.push({...I,_matchedGroups:H,_lastEmailSent:p[I.account_unique_id]||null}))}return L.slice(i,i+a)},async getRecipientStats(e,r){const{rules:o=[],groups:a=[],notOptedOut:i=!0,search:n=""}=r||{},s=a.length>0?a:o.length>0?[{rules:o}]:[];s.length>0;const l=s.length>1,c=s.some(C=>(C.rules||[]).some(p=>["policy_type","active_policy_type","policy_status","policy_count","policy_expiration","location","city","zip_code","email_domain"].includes(p.field)&&(p.value||["is_empty","is_not_empty"].includes(p.operator)))),d=l||c;let k,g;d?(k=await this.getRecipients(e,r,{limit:1e4}),g=k.length):(k=await this.getRecipients(e,r,{limit:1e4}),g=k.length);const u={},w=C=>C?C.toLowerCase().replace(/\b\w/g,v=>v.toUpperCase()):"";k.forEach(C=>{const v=(C.billing_state||"").trim(),p=(C.billing_city||"").trim();if(p&&v){const M=w(p),$=v.length===2?v.toUpperCase():w(v),E=`${M}, ${$}`;u[E]=(u[E]||0)+1}});const m=Object.entries(u).map(([C,v])=>({city:C,count:v})).sort((C,v)=>v.count-C.count).slice(0,10);return{count:g,breakdown:{total:k.length,byCity:m}}},async countRecipients(e,r){return(await this.getRecipientStats(e,r)).count},async getRecipientLocationBreakdown(e,r){return(await this.getRecipientStats(e,r)).breakdown},async scheduleBatch(e,r,o=null){const a=await this.getById(e,r);if(!a)throw new Error("Batch not found");if(a.status!=="Draft")throw new Error("Can only schedule draft batches");const i=await this.getRecipients(e,a.filter_config,{limit:1e4});if(i.length===0)throw new Error("No recipients match the filter");const n=o||new Date().toISOString(),s=i.map(d=>({owner_id:e,account_id:d.account_unique_id,template_id:a.template_id,recipient_email:d.person_email||d.email,recipient_name:d.primary_contact_first_name?`${d.primary_contact_first_name} ${d.primary_contact_last_name||""}`.trim():d.name,subject:a.subject,scheduled_for:n,status:"Pending",batch_id:r})),l=100;let c=0;for(let d=0;d<s.length;d+=l){const k=s.slice(d,d+l),{data:g,error:u}=await y.from("scheduled_emails").insert(k).select();if(u)throw u;c+=g.length}return await this.update(e,r,{status:o?"Scheduled":"Sending",total_recipients:i.length,scheduled_for:n,started_at:o?null:new Date().toISOString()}),{scheduled:c,total:i.length,scheduledFor:n}},async cancelBatch(e,r){await this.update(e,r,{status:"Cancelled"});const{error:o}=await y.from("scheduled_emails").update({status:"Cancelled"}).eq("owner_id",e).eq("batch_id",r).eq("status","Pending");if(o)throw o;return!0},async getBatchStats(e,r){const{data:o,error:a}=await y.from("scheduled_emails").select("status").eq("owner_id",e).eq("batch_id",r);if(a)throw a;const i={pending:0,sent:0,failed:0,cancelled:0,total:o.length};return o.forEach(n=>{const s=n.status.toLowerCase();i[s]!==void 0&&i[s]++}),i},async getAllWithStats(e,r={}){const o=await this.getAll(e,r);return await Promise.all(o.map(async i=>{if(i.status==="Draft")return{...i,stats:null};const n=await this.getBatchStats(e,i.id);return{...i,stats:n}}))}},ze=()=>{const{userId:e}=ee();return e};function vt(e=!1){const r=ze();return Z({queryKey:["roleUserIds",r,e],queryFn:async()=>e?pe.getUserIdsByRole(r):[r],enabled:!!r,staleTime:6e4})}function to(e={}){const r=ze();return Z({queryKey:["massEmails",r,"withStats",e],queryFn:()=>ue.getAllWithStats(r,e),enabled:!!r})}function Oe(e,r={}){const o=ze();return Z({queryKey:["massEmailRecipients",o,e,r],queryFn:()=>ue.getRecipients(o,e,r),enabled:!!o&&!!e})}function _t(e,r=!1){var n,s;const o=ze(),{data:a}=vt(r),i=e?{rules:(n=e.rules)==null?void 0:n.map(l=>({field:l.field,operator:l.operator,value:l.value,value2:l.value2,radius:l.radius})),groups:(s=e.groups)==null?void 0:s.map(l=>{var c;return{rules:(c=l.rules)==null?void 0:c.map(d=>({field:d.field,operator:d.operator,value:d.value,value2:d.value2,radius:d.radius}))}}),search:e.search,notOptedOut:e.notOptedOut,includeRoleAccounts:r}:null;return Z({queryKey:["massEmailRecipientStats",o,i,a],queryFn:()=>ue.getRecipientStats(a||[o],e),enabled:!!o&&!!e&&!!a,staleTime:3e4,gcTime:6e4,placeholderData:l=>l})}function jt(e,r=!1){const{data:o,isLoading:a,isFetching:i,error:n}=_t(e,r);return{data:o==null?void 0:o.count,isLoading:a,isFetching:i,error:n}}function oo(e,r=!1){const{data:o,isLoading:a,isFetching:i,error:n}=_t(e,r);return{data:o==null?void 0:o.breakdown,isLoading:a,isFetching:i,error:n}}function ro(){const e=ze(),r=Me(),o=()=>{r.invalidateQueries({queryKey:["massEmails",e]})},a=K({mutationFn:c=>ue.create(e,c),onSuccess:o}),i=K({mutationFn:({batchId:c,updates:d})=>ue.update(e,c,d),onSuccess:o}),n=K({mutationFn:c=>ue.delete(e,c),onSuccess:o}),s=K({mutationFn:({batchId:c,scheduledFor:d})=>ue.scheduleBatch(e,c,d),onSuccess:()=>{o(),r.invalidateQueries({queryKey:["scheduledEmails",e]})}}),l=K({mutationFn:c=>ue.cancelBatch(e,c),onSuccess:()=>{o(),r.invalidateQueries({queryKey:["scheduledEmails",e]})}});return{createBatch:a,updateBatch:i,deleteBatch:n,scheduleBatch:s,cancelBatch:l}}const no={async isAdmin(e){const{data:r,error:o}=await y.from("admin_users").select("id").eq("user_id",e).single();if(o&&o.code!=="PGRST116")throw o;return!!r},async getAdminUsers(){const{data:e,error:r}=await y.from("admin_users").select("*").order("created_at");if(r)throw r;return e},async addAdmin(e,r=null){const{data:o,error:a}=await y.from("admin_users").insert({user_id:e,name:r}).select().single();if(a)throw a;return o},async removeAdmin(e){const{error:r}=await y.from("admin_users").delete().eq("user_id",e);if(r)throw r;return!0},async getMasterAutomations(){const{data:e,error:r}=await y.from("master_automations").select("*").order("name");if(r)throw r;return e},async getMasterAutomation(e){const{data:r,error:o}=await y.from("master_automations").select("*").eq("default_key",e).single();if(o)throw o;return r},async createMasterAutomation(e){const{data:r,error:o}=await y.from("master_automations").insert(e).select().single();if(o)throw o;return r},async updateMasterAutomation(e,r){const{data:o,error:a}=await y.from("master_automations").update(r).eq("default_key",e).select().single();if(a)throw a;return o},async deleteMasterAutomation(e){const{error:r}=await y.from("master_automations").delete().eq("default_key",e);if(r)throw r;return!0},async syncMasterAutomation(e){const{data:r,error:o}=await y.rpc("sync_master_automation_to_users",{p_default_key:e});if(o)throw o;return r},async syncAllMasterAutomations(){const{data:e,error:r}=await y.rpc("sync_all_master_automations");if(r)throw r;return e},async getMasterTemplates(){const{data:e,error:r}=await y.from("master_templates").select("*").order("name");if(r)throw r;return e},async getMasterTemplate(e){const{data:r,error:o}=await y.from("master_templates").select("*").eq("default_key",e).single();if(o)throw o;return r},async createMasterTemplate(e){const{data:r,error:o}=await y.from("master_templates").insert(e).select().single();if(o)throw o;return r},async updateMasterTemplate(e,r){const{data:o,error:a}=await y.from("master_templates").update(r).eq("default_key",e).select().single();if(a)throw a;return o},async deleteMasterTemplate(e){const{error:r}=await y.from("master_templates").delete().eq("default_key",e);if(r)throw r;return!0},async syncMasterTemplate(e){const{data:r,error:o}=await y.rpc("sync_master_template_to_users",{p_default_key:e});if(o)throw o;return r},async syncAllMasterTemplates(){const{data:e,error:r}=await y.rpc("sync_all_master_templates");if(r)throw r;return e}},ao=()=>{const{userId:e}=ee();return e};function io(){const e=ao();return Z({queryKey:["isAdmin",e],queryFn:()=>no.isAdmin(e),enabled:!!e,staleTime:5*60*1e3})}const ye=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite"}}),Ae=({label:e,value:r,change:o,icon:a,positive:i,isLoading:n,theme:s})=>t.jsxs("div",{style:{padding:"20px",backgroundColor:s.bgCard,borderRadius:"12px",border:`1px solid ${s.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[t.jsx("span",{style:{color:s.textSecondary,fontSize:"13px"},children:e}),t.jsx("span",{style:{fontSize:"20px"},children:a})]}),n?t.jsx(ye,{height:"32px",width:"80px"}):t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:s.text,marginBottom:"4px"},children:r}),o&&t.jsx("span",{style:{fontSize:"12px",color:i?s.success:s.danger},children:o})]})]}),so=({email:e,theme:r,userId:o})=>{var a,i,n;return t.jsx("div",{style:{padding:"14px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"11px",color:r.textMuted,marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[t.jsx("span",{children:""})," ",new Date(e.scheduled_for).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]}),t.jsx(he,{to:`/${o}/clients/${e.account_id}`,style:{fontSize:"14px",fontWeight:"600",color:r.text,textDecoration:"none"},children:((a=e.accounts)==null?void 0:a.name)||"Unknown Account"}),t.jsx("div",{style:{fontSize:"12px",color:r.textSecondary,marginTop:"2px"},children:((i=e.email_templates)==null?void 0:i.subject)||"No subject"}),t.jsx("span",{style:{display:"inline-block",marginTop:"6px",padding:"3px 8px",backgroundColor:r.bgHover,borderRadius:"4px",fontSize:"11px",color:r.textSecondary},children:((n=e.email_templates)==null?void 0:n.name)||"Unknown Template"})]}),t.jsxs("div",{style:{display:"flex",gap:"6px"},children:[t.jsx("button",{style:{padding:"6px 10px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.textSecondary,cursor:"pointer",fontSize:"12px"},children:""}),t.jsx("button",{style:{padding:"6px 10px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.textSecondary,cursor:"pointer",fontSize:"12px"},children:""})]})]})})},lo=({label:e,you:r,avg:o,theme:a})=>t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[t.jsx("span",{style:{fontSize:"12px",color:a.textSecondary},children:e}),t.jsxs("span",{style:{fontSize:"12px",color:a.textMuted},children:[r,"% vs ",o,"%"]})]}),t.jsxs("div",{style:{display:"flex",gap:"4px",height:"24px"},children:[t.jsx("div",{style:{width:`${Math.min(r,100)}%`,backgroundColor:a.primary,borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:t.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[r,"%"]})}),t.jsx("div",{style:{width:`${Math.min(o,100)}%`,backgroundColor:"#14b8a6",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:t.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[o,"%"]})})]})]}),nt=({t:e})=>{const{userId:r}=ee(),{data:o,isLoading:a,error:i}=mt(),{data:n,isLoading:s}=Xt(7),{data:l,isLoading:c}=Ft(30),d=[{label:"Open Rate",you:(o==null?void 0:o.openRate)||0,avg:32},{label:"Click Rate",you:(o==null?void 0:o.clickRate)||0,avg:8},{label:"Response Rate",you:(o==null?void 0:o.responseRate)||8,avg:5}],k=u=>u>=1e3?`${(u/1e3).toFixed(1)}k`:(u==null?void 0:u.toLocaleString())||"0",g=u=>`${Math.round(u||0)}%`;return t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Dashboard"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Overview of your email campaigns and performance"})]}),i&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load dashboard data. Please try refreshing the page."}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"24px"},children:[t.jsx(Ae,{label:"Emails Sent",value:k(o==null?void 0:o.emailsSent),change:o!=null&&o.emailsSentChange?`${o.emailsSentChange>0?"+":""}${o.emailsSentChange}%`:null,icon:"",positive:(o==null?void 0:o.emailsSentChange)>0,isLoading:a,theme:e}),t.jsx(Ae,{label:"Open Rate",value:g(o==null?void 0:o.openRate),change:o!=null&&o.openRateChange?`${o.openRateChange>0?"+":""}${o.openRateChange}%`:null,icon:"",positive:(o==null?void 0:o.openRateChange)>0,isLoading:a,theme:e}),t.jsx(Ae,{label:"Click Rate",value:g(o==null?void 0:o.clickRate),change:o!=null&&o.clickRateChange?`${o.clickRateChange>0?"+":""}${o.clickRateChange}%`:null,icon:"",positive:(o==null?void 0:o.clickRateChange)>0,isLoading:a,theme:e}),t.jsx(Ae,{label:"Scheduled",value:k(o==null?void 0:o.scheduledCount),change:null,icon:"",positive:null,isLoading:a,theme:e})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,margin:0},children:"Upcoming Scheduled Emails"}),t.jsx(he,{to:`/${r}/scheduled`,style:{fontSize:"12px",color:e.primary,textDecoration:"none"},children:"View all "})]}),t.jsx("p",{style:{fontSize:"12px",color:e.textSecondary,marginBottom:"16px"},children:"Emails scheduled to be sent in the next 7 days"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:s?Array.from({length:3}).map((u,w)=>t.jsxs("div",{style:{padding:"14px",backgroundColor:e.bg,borderRadius:"8px",border:`1px solid ${e.border}`},children:[t.jsx(ye,{height:"12px",width:"120px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(ye,{height:"16px",width:"180px"})}),t.jsx("div",{style:{marginTop:"4px"},children:t.jsx(ye,{height:"12px",width:"220px"})})]},w)):(n==null?void 0:n.length)>0?n.slice(0,5).map(u=>t.jsx(so,{email:u,theme:e,userId:r},u.id)):t.jsxs("div",{style:{padding:"40px 20px",textAlign:"center",color:e.textMuted,fontSize:"14px"},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"8px"},children:""}),"No scheduled emails in the next 7 days"]})})]}),t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Performance Comparison"}),t.jsx("p",{style:{fontSize:"12px",color:e.textSecondary,marginBottom:"16px"},children:"Your metrics compared to industry averages"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:a?Array.from({length:3}).map((u,w)=>t.jsxs("div",{children:[t.jsx(ye,{height:"12px",width:"100px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(ye,{height:"24px"})})]},w)):d.map((u,w)=>t.jsx(lo,{label:u.label,you:u.you,avg:u.avg,theme:e},w))}),t.jsxs("div",{style:{display:"flex",gap:"16px",marginTop:"16px",justifyContent:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:e.primary,borderRadius:"2px"}}),t.jsx("span",{style:{fontSize:"11px",color:e.textSecondary},children:"You"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"#14b8a6",borderRadius:"2px"}}),t.jsx("span",{style:{fontSize:"11px",color:e.textSecondary},children:"Industry Avg"})]})]})]})]}),t.jsxs("div",{style:{marginTop:"20px",padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,margin:0},children:"Recent Email Activity"}),t.jsx(he,{to:`/${r}/activity`,style:{fontSize:"12px",color:e.primary,textDecoration:"none"},children:"View all "})]}),c?t.jsx(ye,{height:"200px"}):(l==null?void 0:l.length)>0?t.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"4px",height:"200px",padding:"20px 0"},children:l.slice(-14).map((u,w)=>{const m=Math.max(...l.map(v=>v.sent||0),1),C=(u.sent||0)/m*150;return t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[t.jsx("div",{style:{width:"100%",height:`${C}px`,backgroundColor:e.primary,borderRadius:"4px 4px 0 0",minHeight:"4px"},title:`${u.sent||0} sent on ${u.date}`}),t.jsx("span",{style:{fontSize:"9px",color:e.textMuted},children:new Date(u.date).toLocaleDateString("en-US",{weekday:"short"}).charAt(0)})]},w)})}):t.jsx("div",{style:{padding:"40px 20px",textAlign:"center",color:e.textMuted,fontSize:"14px"},children:"No email activity data yet"})]})]})},Be=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),co=[{id:"welcome",name:"Welcome Series",desc:"Send a series of welcome emails to new clients over their first 30 days",icon:"",category:"Onboarding",defaultNodes:[{type:"trigger",config:{frequency:"daily",time:"09:00"}},{type:"send_email",config:{templateKey:"welcome_email"}},{type:"delay",config:{days:3}},{type:"send_email",config:{templateKey:"getting_started"}}]},{id:"renewal",name:"Renewal Reminder",desc:"Automated reminders for upcoming policy renewals with customizable timing",icon:"",category:"Retention",defaultNodes:[{type:"trigger",config:{frequency:"daily",time:"09:00"}},{type:"send_email",config:{templateKey:"renewal_30_day"}},{type:"delay",config:{days:14}},{type:"condition",config:{type:"email_opened"}}]},{id:"engagement",name:"Engagement Campaign",desc:"Re-engage inactive clients with targeted email sequences",icon:"",category:"Engagement",defaultNodes:[{type:"trigger",config:{frequency:"weekly",time:"10:00"}},{type:"send_email",config:{templateKey:"reengagement"}}]},{id:"policy_update",name:"Policy Update Alert",desc:"Notify clients about important policy changes and updates",icon:"",category:"Communication",defaultNodes:[{type:"trigger",config:{frequency:"immediate"}},{type:"send_email",config:{templateKey:"policy_update"}}]}],po=({template:e,onUse:r,theme:o})=>t.jsxs("div",{style:{padding:"20px",backgroundColor:o.bgCard,borderRadius:"12px",border:`1px solid ${o.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[t.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:o.bgHover,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:e.icon}),t.jsx("span",{style:{padding:"4px 10px",backgroundColor:o.bgHover,borderRadius:"20px",fontSize:"11px",color:o.textSecondary},children:e.category})]}),t.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:o.text,marginBottom:"6px"},children:e.name}),t.jsx("p",{style:{fontSize:"13px",color:o.textSecondary,marginBottom:"16px",lineHeight:"1.5"},children:e.desc}),t.jsx("button",{onClick:()=>r(e),style:{width:"100%",padding:"10px",backgroundColor:o.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Use Template"})]}),uo=({automation:e,onEdit:r,onToggle:o,theme:a})=>{var s;const i=e.stats||{},n=e.status==="active";return t.jsxs("tr",{onClick:()=>r(e.id),style:{borderTop:`1px solid ${a.border}`,cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:l=>l.currentTarget.style.backgroundColor=a.bgHover,onMouseLeave:l=>l.currentTarget.style.backgroundColor="transparent",children:[t.jsx("td",{style:{padding:"14px 16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:a.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px"},children:""}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:a.text},children:e.name}),e.description&&t.jsx("div",{style:{fontSize:"12px",color:a.textMuted},children:e.description})]})]})}),t.jsx("td",{style:{padding:"14px 16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("button",{onClick:l=>{l.stopPropagation(),o(e.id,n?"pause":"activate")},style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:n?a.success:a.bgHover,cursor:"pointer",position:"relative",transition:"background-color 0.2s",flexShrink:0},children:t.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:n?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})}),t.jsx("span",{style:{fontSize:"12px",color:n?a.success:a.textMuted,fontWeight:"500"},children:n?"Active":e.status==="draft"?"Draft":"Paused"})]})}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:a.textSecondary},children:((s=i.totalSent)==null?void 0:s.toLocaleString())||0}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:a.textSecondary},children:i.openRate?`${Math.round(i.openRate)}%`:""}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:a.textSecondary},children:i.clickRate?`${Math.round(i.clickRate)}%`:""}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:a.textSecondary},children:i.activeEnrollments||0}),t.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:t.jsx("button",{onClick:l=>{l.stopPropagation(),r(e.id)},style:{padding:"6px 12px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"6px",color:a.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Edit"})})]})},xo=({t:e})=>{const{userId:r}=ee(),o=fe(),[a,i]=A.useState("my"),{data:n,isLoading:s,error:l}=Bt(),{activateAutomation:c,pauseAutomation:d}=ut(),k=()=>{o(`/${r}/automations/new`)},g=async p=>{o(`/${r}/automations/new`,{state:{templateId:p.id,templateName:p.name,defaultNodes:p.defaultNodes}})},u=p=>{o(`/${r}/automations/${p}`)},w=async(p,M)=>{try{M==="activate"?await c.mutateAsync(p):await d.mutateAsync(p)}catch($){console.error(`Failed to ${M} automation:`,$)}},m=(n==null?void 0:n.filter(p=>p.status==="active"))||[],C=(n==null?void 0:n.filter(p=>p.status==="paused"))||[],v=(n==null?void 0:n.filter(p=>p.status==="draft"))||[];return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Automations"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Create and manage automated email workflows"})]}),t.jsxs("button",{onClick:k,style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," Create Custom"]})]}),l&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load automations. Please try refreshing the page."}),!s&&n&&t.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"24px",padding:"16px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{textAlign:"center",flex:1},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.success},children:m.length}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Active"})]}),t.jsx("div",{style:{width:"1px",backgroundColor:e.border}}),t.jsxs("div",{style:{textAlign:"center",flex:1},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.warning},children:C.length}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Paused"})]}),t.jsx("div",{style:{width:"1px",backgroundColor:e.border}}),t.jsxs("div",{style:{textAlign:"center",flex:1},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.textMuted},children:v.length}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Drafts"})]}),t.jsx("div",{style:{width:"1px",backgroundColor:e.border}}),t.jsxs("div",{style:{textAlign:"center",flex:1},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.primary},children:n.reduce((p,M)=>{var $;return p+((($=M.stats)==null?void 0:$.totalSent)||0)},0).toLocaleString()}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Total Sent"})]})]}),t.jsxs("div",{style:{display:"flex",gap:"0",marginBottom:"24px",backgroundColor:e.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:[t.jsxs("button",{onClick:()=>i("my"),style:{padding:"10px 20px",backgroundColor:a==="my"?e.bgCard:"transparent",border:"none",borderRadius:"8px",color:a==="my"?e.text:e.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:a==="my"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:["My Automations ",n&&`(${n.length})`]}),t.jsx("button",{onClick:()=>i("templates"),style:{padding:"10px 20px",backgroundColor:a==="templates"?e.bgCard:"transparent",border:"none",borderRadius:"8px",color:a==="templates"?e.text:e.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:a==="templates"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:"Templates"})]}),a==="templates"&&t.jsxs(t.Fragment,{children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Pre-built Templates"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:co.map(p=>t.jsx(po,{template:p,onUse:g,theme:e},p.id))})]}),a==="my"&&t.jsx(t.Fragment,{children:s?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,padding:"20px"},children:Array.from({length:3}).map((p,M)=>t.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:M>0?`1px solid ${e.border}`:"none"},children:[t.jsx(Be,{width:"36px",height:"36px"}),t.jsxs("div",{style:{flex:1},children:[t.jsx(Be,{width:"200px",height:"16px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Be,{width:"120px",height:"12px"})})]})]},M))}):(n==null?void 0:n.length)>0?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,overflow:"hidden"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:e.bgHover},children:[t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Automation"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Status"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Sent"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Open Rate"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Click Rate"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Enrolled"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Actions"})]})}),t.jsx("tbody",{children:n.map(p=>t.jsx(uo,{automation:p,onEdit:u,onToggle:w,theme:e},p.id))})]})}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:"No automations yet"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:"Create your first automation to start sending targeted emails automatically."}),t.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[t.jsx("button",{onClick:()=>i("templates"),style:{padding:"10px 20px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,cursor:"pointer",fontSize:"14px"},children:"Browse Templates"}),t.jsx("button",{onClick:k,style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Custom"})]})]})})]})},Ie=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),go=({template:e,onSave:r,onClose:o,theme:a})=>{const[i,n]=A.useState((e==null?void 0:e.name)||""),[s,l]=A.useState((e==null?void 0:e.subject)||""),[c,d]=A.useState((e==null?void 0:e.body_html)||(e==null?void 0:e.body_text)||""),[k,g]=A.useState((e==null?void 0:e.category)||"general"),[u,w]=A.useState(!1),m=async()=>{w(!0);try{await r({name:i,subject:s,body_html:c,body_text:c.replace(/<[^>]*>/g,""),category:k}),o()}catch(p){console.error("Failed to save template:",p)}finally{w(!1)}},C=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],v=p=>{d(c+p)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:100},onClick:o}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxHeight:"90vh",backgroundColor:a.bgCard,borderRadius:"16px",border:`1px solid ${a.border}`,zIndex:101,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${a.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:a.text,margin:0},children:e?"Edit Template":"Create Template"}),t.jsx("button",{onClick:o,style:{background:"none",border:"none",color:a.textMuted,cursor:"pointer",fontSize:"20px"},children:""})]}),t.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Template Name"}),t.jsx("input",{type:"text",value:i,onChange:p=>n(p.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Category"}),t.jsxs("select",{value:k,onChange:p=>g(p.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"},children:[t.jsx("option",{value:"general",children:"General"}),t.jsx("option",{value:"welcome",children:"Welcome"}),t.jsx("option",{value:"renewal",children:"Renewal"}),t.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),t.jsx("option",{value:"engagement",children:"Engagement"}),t.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),t.jsx("input",{type:"text",value:s,onChange:p=>l(p.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"}})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:C.map(p=>t.jsx("button",{onClick:()=>v(p.key),style:{padding:"4px 10px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"6px",color:a.textSecondary,cursor:"pointer",fontSize:"11px"},children:p.label},p.key))})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Email Body"}),t.jsx("textarea",{value:c,onChange:p=>d(p.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:12,style:{width:"100%",padding:"12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),t.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${a.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[t.jsx("button",{onClick:o,style:{padding:"10px 20px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),t.jsx("button",{onClick:m,disabled:u||!i||!s,style:{padding:"10px 20px",backgroundColor:a.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:u?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:u||!i||!s?.6:1},children:u?"Saving...":e?"Save Changes":"Create Template"})]})]})]})},yo=({template:e,onEdit:r,onDuplicate:o,onDelete:a,theme:i})=>{var c,d;const[n,s]=A.useState(!1),l={welcome:i.success,renewal:i.warning,cross_sell:i.primary,engagement:i.purple,policy_update:"#06b6d4",general:i.textMuted};return t.jsxs("div",{style:{padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`,position:"relative"},children:[t.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px"},children:[t.jsx("button",{onClick:()=>s(!n),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:i.textMuted,cursor:"pointer",fontSize:"16px"},children:""}),n&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,zIndex:10},onClick:()=>s(!1)}),t.jsxs("div",{style:{position:"absolute",top:"100%",right:0,backgroundColor:i.bgCard,border:`1px solid ${i.border}`,borderRadius:"8px",padding:"4px",zIndex:11,minWidth:"140px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[t.jsx("button",{onClick:()=>{r(e),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:i.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:" Edit"}),t.jsx("button",{onClick:()=>{o(e),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:i.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:" Duplicate"}),t.jsx("button",{onClick:()=>{a(e.id),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:i.danger,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:" Delete"})]})]})]}),t.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${l[e.category]||i.textMuted}15`,color:l[e.category]||i.textMuted,borderRadius:"20px",fontSize:"11px",fontWeight:"500",marginBottom:"12px",textTransform:"capitalize"},children:((c=e.category)==null?void 0:c.replace("_"," "))||"General"}),t.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:i.text,marginBottom:"6px"},children:e.name}),t.jsx("p",{style:{fontSize:"13px",color:i.textSecondary,marginBottom:"8px"},children:e.subject}),t.jsxs("p",{style:{fontSize:"12px",color:i.textMuted,marginBottom:"12px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:[(d=e.body_text)==null?void 0:d.substring(0,100),"..."]}),t.jsxs("div",{style:{display:"flex",gap:"16px",paddingTop:"12px",borderTop:`1px solid ${i.border}`,fontSize:"11px",color:i.textMuted},children:[t.jsxs("span",{children:[" ",e.usage_count||0," sent"]}),t.jsxs("span",{children:[" ",e.open_rate?`${Math.round(e.open_rate)}%`:""," opens"]})]}),t.jsx("button",{onClick:()=>r(e),style:{marginTop:"12px",width:"100%",padding:"10px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,cursor:"pointer",fontSize:"13px"},children:"Edit Template"})]})},ho=({t:e})=>{const{userId:r}=ee(),[o,a]=A.useState("my"),[i,n]=A.useState("all"),[s,l]=A.useState(""),[c,d]=A.useState(!1),[k,g]=A.useState(null),{data:u,isLoading:w,error:m}=Ge(),{data:C}=Mt(),{createTemplate:v,updateTemplate:p,deleteTemplate:M,duplicateTemplate:$}=pt(),E=(u==null?void 0:u.filter(N=>!(i!=="all"&&N.category!==i||s&&!N.name.toLowerCase().includes(s.toLowerCase())&&!N.subject.toLowerCase().includes(s.toLowerCase()))))||[],j=()=>{g(null),d(!0)},W=N=>{g(N),d(!0)},O=async N=>{k?await p.mutateAsync({id:k.id,...N}):await v.mutateAsync(N)},V=async N=>{await $.mutateAsync(N.id)},F=async N=>{window.confirm("Are you sure you want to delete this template?")&&await M.mutateAsync(N)};return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Email Templates"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Create and manage reusable email templates"})]}),t.jsxs("button",{onClick:j,style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," Create Template"]})]}),m&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load templates. Please try refreshing the page."}),t.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"24px",alignItems:"center"},children:[t.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"300px"},children:[t.jsx("input",{type:"text",placeholder:"Search templates...",value:s,onChange:N=>l(N.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px"}}),t.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:e.textMuted},children:""})]}),t.jsxs("select",{value:i,onChange:N=>n(N.target.value),style:{padding:"10px 12px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px",minWidth:"150px"},children:[t.jsx("option",{value:"all",children:"All Categories"}),t.jsx("option",{value:"welcome",children:"Welcome"}),t.jsx("option",{value:"renewal",children:"Renewal"}),t.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),t.jsx("option",{value:"engagement",children:"Engagement"}),t.jsx("option",{value:"policy_update",children:"Policy Update"}),t.jsx("option",{value:"general",children:"General"})]}),t.jsxs("span",{style:{fontSize:"13px",color:e.textMuted},children:[E.length," template",E.length!==1?"s":""]})]}),w?t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:Array.from({length:6}).map((N,L)=>t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx(Ie,{width:"80px",height:"20px"}),t.jsx("div",{style:{marginTop:"12px"},children:t.jsx(Ie,{width:"180px",height:"18px"})}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Ie,{width:"220px",height:"14px"})}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Ie,{height:"40px"})})]},L))}):E.length>0?t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:E.map(N=>t.jsx(yo,{template:N,onEdit:W,onDuplicate:V,onDelete:F,theme:e},N.id))}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:s||i!=="all"?"No templates found":"No templates yet"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:s||i!=="all"?"Try adjusting your search or filter criteria.":"Create your first email template to get started."}),!s&&i==="all"&&t.jsx("button",{onClick:j,style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Template"})]}),c&&t.jsx(go,{template:k,onSave:O,onClose:()=>d(!1),theme:e})]})},qe=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),mo=({type:e,theme:r})=>{const o=(e||"").toLowerCase();let a=o;(o==="prior_customer"||o.startsWith("prior"))&&(a="prior"),o.startsWith("customer")&&(a="customer"),o.startsWith("prospect")&&(a="prospect"),o.startsWith("lead")&&(a="lead");const i={customer:{bg:`${r.success}20`,text:r.success,label:"Customer"},prospect:{bg:`${r.primary}20`,text:r.primary,label:"Prospect"},prior:{bg:`${r.textMuted}20`,text:r.textMuted,label:"Prior Customer"},lead:{bg:`${r.warning}20`,text:r.warning,label:"Lead"}},n=i[a]||i.prospect;return t.jsx("span",{style:{padding:"4px 10px",backgroundColor:n.bg,color:n.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:n.label||e||"Unknown"})},fo=({policyType:e,status:r,theme:o})=>{const a=r==="active";return t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"3px 8px",backgroundColor:a?`${o.success}10`:`${o.textMuted}10`,borderRadius:"6px",fontSize:"11px",color:a?o.success:o.textMuted},children:[a?"":""," ",e]})},bo=({client:e,onClick:r,theme:o})=>{var a,i,n;return t.jsxs("tr",{style:{borderTop:`1px solid ${o.border}`,cursor:"pointer"},onClick:r,onMouseOver:s=>s.currentTarget.style.backgroundColor=o.bgHover,onMouseOut:s=>s.currentTarget.style.backgroundColor="transparent",children:[t.jsx("td",{style:{padding:"14px 16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:o.bgHover,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",color:o.textMuted},children:((a=e.name)==null?void 0:a.charAt(0).toUpperCase())||"?"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:o.text},children:e.name}),t.jsx("div",{style:{fontSize:"12px",color:o.textMuted},children:e.person_email||e.email||""})]})]})}),t.jsx("td",{style:{padding:"14px 16px"},children:t.jsx(mo,{type:e.account_status||"Prospect",theme:o})}),t.jsx("td",{style:{padding:"14px 16px"},children:t.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",alignItems:"center"},children:((i=e.policies)==null?void 0:i.length)>0?t.jsxs(t.Fragment,{children:[e.policies.slice(0,3).map((s,l)=>t.jsx(fo,{policyType:s.policy_type||"Policy",status:s.status,theme:o},l)),e.policies.length>3&&t.jsxs("span",{style:{fontSize:"11px",color:o.textMuted},children:["+",e.policies.length-3," more"]})]}):t.jsx("span",{style:{fontSize:"13px",color:o.textMuted},children:"No policies"})})}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:o.textSecondary,textAlign:"center"},children:e.policy_count||((n=e.policies)==null?void 0:n.length)||0}),t.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:t.jsxs("div",{style:{display:"flex",gap:"6px",justifyContent:"flex-end"},children:[t.jsx("button",{onClick:s=>{s.stopPropagation()},style:{padding:"6px 12px",backgroundColor:o.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:" Email"}),t.jsx("button",{onClick:s=>{s.stopPropagation(),r()},style:{padding:"6px 12px",backgroundColor:o.bgHover,border:`1px solid ${o.border}`,borderRadius:"6px",color:o.textSecondary,cursor:"pointer",fontSize:"12px"},children:"View"})]})})]})},je=({label:e,value:r,icon:o,color:a,theme:i,onClick:n,active:s})=>t.jsxs("div",{onClick:n,style:{padding:"16px",backgroundColor:s?`${a}15`:i.bgCard,borderRadius:"10px",border:`2px solid ${s?a:i.border}`,textAlign:"center",cursor:n?"pointer":"default",transition:"all 0.2s ease",transform:s?"scale(1.02)":"scale(1)"},onMouseOver:l=>{n&&(l.currentTarget.style.borderColor=a,l.currentTarget.style.transform="scale(1.02)")},onMouseOut:l=>{n&&!s&&(l.currentTarget.style.borderColor=i.border,l.currentTarget.style.transform="scale(1)")},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"4px"},children:o}),t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:a||i.text},children:r}),t.jsx("div",{style:{fontSize:"12px",color:i.textSecondary},children:e})]}),vo=({t:e})=>{const{userId:r}=ee(),o=fe(),[a,i]=A.useState(""),[n,s]=A.useState("all"),[l,c]=A.useState("name"),[d,k]=A.useState("asc"),[g,u]=A.useState(1),w=25,m=A.useMemo(()=>{const G={limit:w,offset:(g-1)*w};return n!=="all"&&n!=="expiring"&&(G.status=n),n==="expiring"&&(G.expiring=!0,G.limit=100,G.offset=0),a.length>=2&&(G.search=a),G},[n,g,a]),{data:C,isLoading:v,error:p}=Gt(m),{data:M,isLoading:$}=Kt(),E=(C==null?void 0:C.accounts)||[],j=(C==null?void 0:C.total)||0,W=Math.ceil(j/w),O=A.useMemo(()=>!E||E.length===0?[]:[...E].sort((G,I)=>{let H=G[l],P=I[l];return l==="name"&&(H=(H==null?void 0:H.toLowerCase())||"",P=(P==null?void 0:P.toLowerCase())||""),l==="policy_count"&&(H=G.policy_count||0,P=I.policy_count||0),d==="asc"?H>P?1:-1:H<P?1:-1}),[E,l,d]),V=G=>{s(G),u(1)},F=G=>{i(G),u(1)},N=G=>{o(`/${r}/accounts/${G}`)},L=M||{Customer:0,Prospect:0,Prior:0,total:0,expiring:0};return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Accounts"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"View and manage your account database"})]}),t.jsxs("div",{style:{display:"flex",gap:"12px"},children:[t.jsx("button",{onClick:()=>{},style:{padding:"10px 16px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:" Export"}),t.jsx("button",{style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"+ Add Account"})]})]}),p&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load accounts. Please try refreshing the page."}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"16px",marginBottom:"24px"},children:[t.jsx(je,{label:"Total Accounts",value:$?"...":L.total,icon:"",color:e.text,theme:e,onClick:()=>V("all"),active:n==="all"}),t.jsx(je,{label:"Customers",value:$?"...":L.Customer,icon:"",color:e.success,theme:e,onClick:()=>V(n==="Customer"?"all":"Customer"),active:n==="Customer"}),t.jsx(je,{label:"Prospects",value:$?"...":L.Prospect,icon:"",color:e.primary,theme:e,onClick:()=>V(n==="Prospect"?"all":"Prospect"),active:n==="Prospect"}),t.jsx(je,{label:"Prior Customers",value:$?"...":L.Prior,icon:"",color:e.textMuted,theme:e,onClick:()=>V(n==="Prior"?"all":"Prior"),active:n==="Prior"}),t.jsx(je,{label:"Expiring in 30d",value:$?"...":L.expiring,icon:"",color:e.warning,theme:e,onClick:()=>V(n==="expiring"?"all":"expiring"),active:n==="expiring"})]}),t.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"20px",alignItems:"center",flexWrap:"wrap"},children:[t.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"350px"},children:[t.jsx("input",{type:"text",placeholder:"Search by name, email, or phone...",value:a,onChange:G=>F(G.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px"}}),t.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:e.textMuted},children:""})]}),t.jsxs("select",{value:n,onChange:G=>V(G.target.value),style:{padding:"10px 12px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px",minWidth:"150px"},children:[t.jsx("option",{value:"all",children:"All Types"}),t.jsx("option",{value:"Customer",children:"Customers"}),t.jsx("option",{value:"Prospect",children:"Prospects"}),t.jsx("option",{value:"Prior",children:"Prior Customers"}),t.jsx("option",{value:"Lead",children:"Leads"}),t.jsx("option",{value:"expiring",children:"Expiring Policies"})]}),t.jsxs("select",{value:`${l}-${d}`,onChange:G=>{const[I,H]=G.target.value.split("-");c(I),k(H)},style:{padding:"10px 12px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px",minWidth:"150px"},children:[t.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),t.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),t.jsx("option",{value:"created_at-desc",children:"Newest First"}),t.jsx("option",{value:"created_at-asc",children:"Oldest First"})]}),t.jsx("span",{style:{fontSize:"13px",color:e.textMuted,marginLeft:"auto"},children:n==="expiring"?`${O.length} account${O.length!==1?"s":""} with expiring policies`:`Showing ${(g-1)*w+1}-${Math.min(g*w,j)} of ${j} account${j!==1?"s":""}`})]}),v?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,padding:"20px"},children:Array.from({length:5}).map((G,I)=>t.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:I>0?`1px solid ${e.border}`:"none"},children:[t.jsx(qe,{width:"40px",height:"40px"}),t.jsxs("div",{style:{flex:1},children:[t.jsx(qe,{width:"200px",height:"16px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(qe,{width:"150px",height:"12px"})})]})]},I))}):O.length>0?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,overflow:"hidden"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:e.bgHover},children:[t.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Account"}),t.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Type"}),t.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Policies"}),t.jsx("th",{style:{padding:"14px 16px",textAlign:"center",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"# Policies"}),t.jsx("th",{style:{padding:"14px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Actions"})]})}),t.jsx("tbody",{children:O.map(G=>t.jsx(bo,{client:G,onClick:()=>N(G.account_unique_id),theme:e},G.id))})]})}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:a?"No accounts found":"No accounts yet"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:a?"Try adjusting your search criteria.":"Your accounts will appear here once synced from Salesforce."})]}),W>1&&n!=="expiring"&&t.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginTop:"24px",padding:"16px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("button",{onClick:()=>u(1),disabled:g===1,style:{padding:"8px 12px",backgroundColor:g===1?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:g===1?e.textMuted:e.text,cursor:g===1?"not-allowed":"pointer",fontSize:"13px"},children:" First"}),t.jsx("button",{onClick:()=>u(G=>Math.max(1,G-1)),disabled:g===1,style:{padding:"8px 12px",backgroundColor:g===1?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:g===1?e.textMuted:e.text,cursor:g===1?"not-allowed":"pointer",fontSize:"13px"},children:" Prev"}),t.jsxs("span",{style:{padding:"8px 16px",fontSize:"14px",color:e.text,fontWeight:"500"},children:["Page ",g," of ",W]}),t.jsx("button",{onClick:()=>u(G=>Math.min(W,G+1)),disabled:g===W,style:{padding:"8px 12px",backgroundColor:g===W?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:g===W?e.textMuted:e.text,cursor:g===W?"not-allowed":"pointer",fontSize:"13px"},children:"Next "}),t.jsx("button",{onClick:()=>u(W),disabled:g===W,style:{padding:"8px 12px",backgroundColor:g===W?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:g===W?e.textMuted:e.text,cursor:g===W?"not-allowed":"pointer",fontSize:"13px"},children:"Last "})]}),L.expiring>0&&n!=="expiring"&&t.jsxs("div",{style:{marginTop:"24px",padding:"16px 20px",backgroundColor:`${e.warning}10`,border:`1px solid ${e.warning}30`,borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("span",{style:{fontSize:"24px"},children:""}),t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:e.text},children:[L.expiring," account",L.expiring!==1?"s have":" has"," policies expiring in the next 30 days"]}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Consider setting up renewal reminders for these accounts."})]})]}),t.jsx("button",{onClick:()=>V("expiring"),style:{padding:"8px 16px",backgroundColor:e.warning,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"View Expiring"})]})]})},ge=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),St=({status:e,theme:r})=>{const o={active:{bg:`${r.success}20`,text:r.success},pending:{bg:`${r.warning}20`,text:r.warning},cancelled:{bg:`${r.danger}20`,text:r.danger},expired:{bg:`${r.textMuted}20`,text:r.textMuted}},a=o[e]||o.pending;return t.jsx("span",{style:{padding:"4px 10px",backgroundColor:a.bg,color:a.text,borderRadius:"20px",fontSize:"11px",fontWeight:"500",textTransform:"capitalize"},children:e})},Se=({event:e,theme:r})=>{const o={sent:"",delivered:"",opened:"",clicked:"",bounced:"",unsubscribed:""};return t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"2px 8px",backgroundColor:r.bgHover,borderRadius:"4px",fontSize:"11px",color:r.textSecondary},children:[o[e]||""," ",e]})},_o=({policy:e,theme:r})=>{var s;const o=e.expiration_date?Math.ceil((new Date(e.expiration_date)-new Date)/864e5):null,a=e.policy_lob||e.policy_type||"Unknown",i=e.policy_status||e.status||"unknown",n=((s=e.carrier)==null?void 0:s.name)||e.carrier_name||e.carrier||"";return t.jsxs("div",{style:{padding:"16px",backgroundColor:r.bg,borderRadius:"10px",border:`1px solid ${r.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[t.jsx("div",{style:{padding:"8px 12px",backgroundColor:`${r.primary}15`,borderRadius:"8px",fontSize:"14px",fontWeight:"600",color:r.primary},children:a}),t.jsx(St,{status:i.toLowerCase(),theme:r})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",fontSize:"13px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Policy Number"}),t.jsx("div",{style:{color:r.text},children:e.policy_number||""})]}),t.jsxs("div",{children:[t.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Carrier"}),t.jsx("div",{style:{color:r.text},children:n})]}),t.jsxs("div",{children:[t.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Effective Date"}),t.jsx("div",{style:{color:r.text},children:e.effective_date?new Date(e.effective_date).toLocaleDateString():""})]}),t.jsxs("div",{children:[t.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Expiration"}),t.jsx("div",{style:{color:o!==null&&o>0&&o<=30?r.warning:r.text},children:e.expiration_date?t.jsxs(t.Fragment,{children:[new Date(e.expiration_date).toLocaleDateString(),o!==null&&o>0&&o<=30&&t.jsxs("span",{style:{fontSize:"11px",marginLeft:"6px"},children:["(",o,"d left)"]})]}):""})]})]}),(e.premium||e.annual_premium)&&t.jsxs("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:`1px solid ${r.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{style:{fontSize:"12px",color:r.textMuted},children:"Annual Premium"}),t.jsxs("span",{style:{fontSize:"16px",fontWeight:"600",color:r.success},children:["$",(e.premium||e.annual_premium).toLocaleString()]})]})]})},jo=({log:e,theme:r})=>{var o;return t.jsxs("div",{style:{padding:"14px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`,marginBottom:"8px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:r.text},children:((o=e.email_templates)==null?void 0:o.name)||"Direct Email"}),t.jsx("div",{style:{fontSize:"12px",color:r.textSecondary,marginTop:"2px"},children:e.subject})]}),t.jsx("div",{style:{textAlign:"right"},children:t.jsxs("div",{style:{fontSize:"11px",color:r.textMuted},children:[new Date(e.sent_at).toLocaleDateString()," at"," ",new Date(e.sent_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})})]}),t.jsxs("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:[t.jsx(Se,{event:"sent",theme:r}),e.delivered_at&&t.jsx(Se,{event:"delivered",theme:r}),e.opened_at&&t.jsx(Se,{event:"opened",theme:r}),e.clicked_at&&t.jsx(Se,{event:"clicked",theme:r}),e.bounced_at&&t.jsx(Se,{event:"bounced",theme:r})]})]})},So=({activity:e,theme:r})=>{const o={email_sent:"",email_opened:"",email_clicked:"",enrollment_started:"",enrollment_completed:"",enrollment_paused:"",note_added:""};return t.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[t.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:r.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:o[e.action_type]||""}),t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"13px",color:r.text},children:e.description}),t.jsx("div",{style:{fontSize:"11px",color:r.textMuted,marginTop:"2px"},children:new Date(e.created_at).toLocaleString()})]})]})},at=({enrollment:e,theme:r,userId:o})=>{var a;return t.jsxs("div",{style:{padding:"14px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`,marginBottom:"8px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx(he,{to:`/${o}/automations/${e.automation_id}`,style:{fontSize:"14px",fontWeight:"500",color:r.text,textDecoration:"none"},children:((a=e.automations)==null?void 0:a.name)||"Unknown Automation"}),t.jsxs("div",{style:{fontSize:"12px",color:r.textMuted,marginTop:"2px"},children:["Started ",new Date(e.enrolled_at).toLocaleDateString()]})]}),t.jsx(St,{status:e.status==="active"?"active":e.status,theme:r})]}),e.current_node_id&&t.jsxs("div",{style:{marginTop:"10px",padding:"8px 10px",backgroundColor:r.bgHover,borderRadius:"6px",fontSize:"12px",color:r.textSecondary},children:[" Current step: ",e.current_node_name||e.current_node_id]})]})},wo=({t:e})=>{var $,E;const{userId:r,accountId:o}=ee(),a=fe(),[i,n]=A.useState("overview"),{data:s,isLoading:l,error:c}=Ut(o),{data:d,isLoading:k}=Ot(i==="overview"||i==="emails"?o:null),{data:g,isLoading:u}=Qt(i==="activity"?o:null),{data:w,isLoading:m}=Lt(i==="overview"||i==="automations"?o:null),{data:C}=mt(),v={emailsSent:(d==null?void 0:d.length)||0,opened:(d==null?void 0:d.filter(j=>j.opened_at).length)||0,clicked:(d==null?void 0:d.filter(j=>j.clicked_at).length)||0,openRate:(d==null?void 0:d.length)>0?Math.round(d.filter(j=>j.opened_at).length/d.length*100):0,clickRate:(d==null?void 0:d.length)>0?Math.round(d.filter(j=>j.clicked_at).length/d.length*100):0,activeEnrollments:(w==null?void 0:w.filter(j=>j.status==="active").length)||0},p={openRate:(C==null?void 0:C.openRate)||25,clickRate:(C==null?void 0:C.clickRate)||5};if(l)return t.jsxs("div",{children:[t.jsx(ge,{width:"200px",height:"32px"}),t.jsx("div",{style:{marginTop:"20px"},children:t.jsx(ge,{height:"200px"})})]});if(c||!s)return t.jsxs("div",{style:{padding:"60px 20px",textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),t.jsx("h2",{style:{color:e.text,marginBottom:"8px"},children:"Account Not Found"}),t.jsx("p",{style:{color:e.textSecondary,marginBottom:"24px"},children:"We couldn't find the account you're looking for."}),t.jsx("button",{onClick:()=>a(`/${r}/accounts`),style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Accounts"})]});const M=[{id:"overview",label:"Overview"},{id:"emails",label:`Emails (${(d==null?void 0:d.length)||0})`},{id:"automations",label:`Automations (${(w==null?void 0:w.length)||0})`},{id:"activity",label:"Activity"}];return t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("button",{onClick:()=>a(`/${r}/accounts`),style:{background:"none",border:"none",color:e.textMuted,cursor:"pointer",fontSize:"14px",marginBottom:"12px",padding:0,display:"flex",alignItems:"center",gap:"6px"},children:" Back to Accounts"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:s.name}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(()=>{const j=(s.account_status||"").toLowerCase();let W=j;(j==="prior_customer"||j.startsWith("prior"))&&(W="prior"),j.startsWith("customer")&&(W="customer"),j.startsWith("prospect")&&(W="prospect"),j.startsWith("lead")&&(W="lead");const O={customer:{bg:`${e.success}20`,text:e.success,label:"Customer"},prospect:{bg:`${e.primary}20`,text:e.primary,label:"Prospect"},prior:{bg:`${e.textMuted}20`,text:e.textMuted,label:"Prior Customer"},lead:{bg:`${e.warning}20`,text:e.warning,label:"Lead"}},V=O[W]||O.prospect;return t.jsx("span",{style:{padding:"4px 10px",backgroundColor:V.bg,color:V.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:V.label})})(),s.account_unique_id&&t.jsxs("span",{style:{fontSize:"12px",color:e.textMuted},children:["ID: ",s.account_unique_id]})]})]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("button",{style:{padding:"10px 16px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:" Add Note"}),t.jsx("button",{style:{padding:"10px 16px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:" Send Email"})]})]})]}),t.jsxs("div",{style:{display:"flex",gap:"24px",padding:"16px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,marginBottom:"24px",flexWrap:"wrap"},children:[(s.person_email||s.email)&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:""}),t.jsx("a",{href:`mailto:${s.person_email||s.email}`,style:{color:e.primary,textDecoration:"none",fontSize:"14px"},children:s.person_email||s.email})]}),s.phone&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:""}),t.jsx("a",{href:`tel:${s.phone}`,style:{color:e.text,textDecoration:"none",fontSize:"14px"},children:s.phone})]}),(s.billing_street||s.billing_city||s.billing_state)&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:""}),t.jsx("span",{style:{color:e.textSecondary,fontSize:"14px"},children:[s.billing_street,[s.billing_city,s.billing_state].filter(Boolean).join(", "),s.billing_postal_code].filter(Boolean).join("  ")})]}),s.primary_contact_first_name&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:""}),t.jsxs("span",{style:{color:e.textSecondary,fontSize:"14px"},children:[s.primary_contact_first_name," ",s.primary_contact_last_name]})]})]}),t.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:e.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:M.map(j=>t.jsx("button",{onClick:()=>n(j.id),style:{padding:"10px 20px",backgroundColor:i===j.id?e.bgCard:"transparent",border:"none",borderRadius:"8px",color:i===j.id?e.text:e.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:j.label},j.id))}),i==="overview"&&t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,display:"flex",flexDirection:"column"},children:[t.jsxs("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px",flexShrink:0},children:["Policies (",(($=s.policies)==null?void 0:$.length)||0,")"]}),((E=s.policies)==null?void 0:E.length)>0?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto",flex:1,paddingRight:"8px"},children:s.policies.map((j,W)=>t.jsx(_o,{policy:j,theme:e},W))}):t.jsx("div",{style:{padding:"30px",textAlign:"center",color:e.textMuted},children:"No policies on file"})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Email Engagement"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"20px"},children:[t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.primary},children:v.emailsSent}),t.jsx("div",{style:{fontSize:"11px",color:e.textMuted},children:"Sent"})]}),t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.success},children:v.opened}),t.jsx("div",{style:{fontSize:"11px",color:e.textMuted},children:"Opened"})]}),t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.warning},children:v.clicked}),t.jsx("div",{style:{fontSize:"11px",color:e.textMuted},children:"Clicked"})]}),t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.danger},children:(d==null?void 0:d.filter(j=>j.bounced_at).length)||0}),t.jsx("div",{style:{fontSize:"11px",color:e.textMuted},children:"Bounced"})]})]})]}),t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Compared to Average"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:e.textSecondary},children:"Open Rate"}),t.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:v.openRate>=p.openRate?e.success:e.danger},children:[v.openRate,"%",v.openRate>=p.openRate?" ":" "]})]}),t.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:e.bgHover,borderRadius:"4px",overflow:"hidden"},children:[t.jsx("div",{style:{position:"absolute",left:`${Math.min(p.openRate,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:e.textMuted,zIndex:2}}),t.jsx("div",{style:{width:`${Math.min(v.openRate,100)}%`,height:"100%",backgroundColor:v.openRate>=p.openRate?e.success:e.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[t.jsx("span",{style:{fontSize:"10px",color:e.textMuted},children:"0%"}),t.jsxs("span",{style:{fontSize:"10px",color:e.textMuted},children:["Avg: ",p.openRate,"%"]}),t.jsx("span",{style:{fontSize:"10px",color:e.textMuted},children:"100%"})]})]}),t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:e.textSecondary},children:"Click Rate"}),t.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:v.clickRate>=p.clickRate?e.success:e.danger},children:[v.clickRate,"%",v.clickRate>=p.clickRate?" ":" "]})]}),t.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:e.bgHover,borderRadius:"4px",overflow:"hidden"},children:[t.jsx("div",{style:{position:"absolute",left:`${Math.min(p.clickRate*5,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:e.textMuted,zIndex:2}}),t.jsx("div",{style:{width:`${Math.min(v.clickRate*5,100)}%`,height:"100%",backgroundColor:v.clickRate>=p.clickRate?e.success:e.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[t.jsx("span",{style:{fontSize:"10px",color:e.textMuted},children:"0%"}),t.jsxs("span",{style:{fontSize:"10px",color:e.textMuted},children:["Avg: ",p.clickRate,"%"]}),t.jsx("span",{style:{fontSize:"10px",color:e.textMuted},children:"20%+"})]})]}),t.jsxs("div",{style:{padding:"16px",backgroundColor:e.bg,borderRadius:"10px",textAlign:"center",marginTop:"8px"},children:[t.jsx("div",{style:{fontSize:"11px",color:e.textMuted,marginBottom:"4px"},children:"ENGAGEMENT SCORE"}),t.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:v.openRate>=p.openRate&&v.clickRate>=p.clickRate?e.success:v.openRate>=p.openRate||v.clickRate>=p.clickRate?e.warning:e.danger},children:v.emailsSent===0?"":v.openRate>=p.openRate&&v.clickRate>=p.clickRate?"High":v.openRate>=p.openRate||v.clickRate>=p.clickRate?"Medium":"Low"}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary,marginTop:"4px"},children:v.emailsSent===0?"No emails sent yet":v.openRate>=p.openRate?"Above average engagement":"Below average engagement"})]})]})]}),t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Active Automations"}),(w==null?void 0:w.filter(j=>j.status==="active").length)>0?w.filter(j=>j.status==="active").map(j=>t.jsx(at,{enrollment:j,theme:e,userId:r},j.id)):t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted,fontSize:"13px"},children:"Not enrolled in any automations"})]})]})]}),i==="emails"&&t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Email History"}),k?Array.from({length:3}).map((j,W)=>t.jsx("div",{style:{marginBottom:"12px"},children:t.jsx(ge,{height:"80px"})},W)):(d==null?void 0:d.length)>0?d.map(j=>t.jsx(jo,{log:j,theme:e},j.id)):t.jsx("div",{style:{padding:"40px",textAlign:"center",color:e.textMuted},children:"No emails sent to this client yet"})]}),i==="automations"&&t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,margin:0},children:"Automation Enrollments"}),t.jsx("button",{style:{padding:"8px 12px",backgroundColor:e.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:"+ Enroll in Automation"})]}),m?Array.from({length:2}).map((j,W)=>t.jsx("div",{style:{marginBottom:"12px"},children:t.jsx(ge,{height:"60px"})},W)):(w==null?void 0:w.length)>0?w.map(j=>t.jsx(at,{enrollment:j,theme:e,userId:r},j.id)):t.jsx("div",{style:{padding:"40px",textAlign:"center",color:e.textMuted},children:"Not enrolled in any automations"})]}),i==="activity"&&t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Activity Timeline"}),u?Array.from({length:5}).map((j,W)=>t.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[t.jsx(ge,{width:"32px",height:"32px"}),t.jsxs("div",{style:{flex:1},children:[t.jsx(ge,{width:"80%",height:"14px"}),t.jsx("div",{style:{marginTop:"4px"},children:t.jsx(ge,{width:"120px",height:"12px"})})]})]},W)):(g==null?void 0:g.length)>0?t.jsx("div",{style:{borderLeft:`2px solid ${e.border}`,marginLeft:"15px",paddingLeft:"20px"},children:g.map(j=>t.jsx(So,{activity:j,theme:e},j.id))}):t.jsx("div",{style:{padding:"40px",textAlign:"center",color:e.textMuted},children:"No activity recorded yet"})]})]})},Ee=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),ae=({label:e,value:r,onChange:o,placeholder:a,type:i="text",disabled:n,hint:s,theme:l})=>t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:e}),t.jsx("input",{type:i,value:r||"",onChange:c=>o(c.target.value),placeholder:a,disabled:n,style:{width:"100%",padding:"12px",backgroundColor:n?l.bgHover:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px",opacity:n?.6:1}}),s&&t.jsx("p",{style:{fontSize:"11px",color:l.textMuted,marginTop:"4px"},children:s})]}),Co=({label:e,value:r,onChange:o,placeholder:a,rows:i=3,disabled:n,theme:s})=>t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:s.text,display:"block",marginBottom:"6px"},children:e}),t.jsx("textarea",{value:r||"",onChange:l=>o(l.target.value),placeholder:a,rows:i,disabled:n,style:{width:"100%",padding:"12px",backgroundColor:n?s.bgHover:s.bgInput,border:`1px solid ${s.border}`,borderRadius:"8px",color:s.text,fontSize:"14px",resize:"vertical",opacity:n?.6:1}})]}),ko=({settings:e,theme:r})=>t.jsxs("div",{style:{padding:"16px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`},children:[(e==null?void 0:e.full_name)&&t.jsx("div",{style:{fontWeight:"600",color:r.text},children:e.full_name}),(e==null?void 0:e.job_title)&&t.jsx("div",{style:{color:r.textSecondary,fontSize:"14px"},children:e.job_title}),t.jsx("div",{style:{color:r.textSecondary,fontSize:"14px",marginTop:"4px"},children:[e==null?void 0:e.phone,e==null?void 0:e.email].filter(Boolean).join("  ")}),(e==null?void 0:e.custom_message)&&t.jsx("div",{style:{color:r.textMuted,fontSize:"14px",fontStyle:"italic",marginTop:"8px"},children:e.custom_message}),!(e!=null&&e.full_name)&&!(e!=null&&e.job_title)&&t.jsx("div",{style:{color:r.textMuted,fontSize:"14px"},children:"Fill in your details to see a preview"})]}),zo=({t:e})=>{const{userId:r}=ee(),[o,a]=A.useState("signature"),[i,n]=A.useState(!1),[s,l]=A.useState(null),{data:c,isLoading:d,error:k}=Nt(),{updateSettings:g,updateSignature:u}=Ht(),[w,m]=A.useState({full_name:"",job_title:"",phone:"",email:"",custom_message:"",agency_name:"",agency_address:"",agency_phone:"",agency_website:"",default_from_name:"",default_from_email:"",reply_to_email:"",sending_domain:""});A.useEffect(()=>{c&&m({full_name:c.full_name||"",job_title:c.job_title||"",phone:c.phone||"",email:c.email||"",custom_message:c.custom_message||"",agency_name:c.agency_name||"",agency_address:c.agency_address||"",agency_phone:c.agency_phone||"",agency_website:c.agency_website||"",default_from_name:c.default_from_name||"",default_from_email:c.default_from_email||"",reply_to_email:c.reply_to_email||"",sending_domain:c.sending_domain||""})},[c]);const C=$=>E=>{m(j=>({...j,[$]:E})),l(null)},v=async()=>{n(!0),l(null);try{await u.mutateAsync({full_name:w.full_name,job_title:w.job_title,phone:w.phone,email:w.email,custom_message:w.custom_message}),l({type:"success",text:"Signature saved successfully!"})}catch{l({type:"error",text:"Failed to save signature. Please try again."})}finally{n(!1)}},p=async()=>{n(!0),l(null);try{await g.mutateAsync(w),l({type:"success",text:"Settings saved successfully!"})}catch{l({type:"error",text:"Failed to save settings. Please try again."})}finally{n(!1)}},M=[{id:"signature",label:"Email Signature",icon:""},{id:"agency",label:"Agency Info",icon:""},{id:"email",label:"Email Settings",icon:""},{id:"integrations",label:"Integrations",icon:""}];return t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Settings"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Manage your email preferences and configuration"})]}),k&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load settings. Please try refreshing the page."}),s&&t.jsx("div",{style:{padding:"12px 16px",backgroundColor:s.type==="success"?`${e.success}15`:`${e.danger}15`,border:`1px solid ${s.type==="success"?e.success:e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:s.type==="success"?e.success:e.danger,fontSize:"14px"},children:s.text}),t.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:e.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:M.map($=>t.jsxs("button",{onClick:()=>a($.id),style:{padding:"10px 20px",backgroundColor:o===$.id?e.bgCard:"transparent",border:"none",borderRadius:"8px",color:o===$.id?e.text:e.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[$.icon," ",$.label]},$.id))}),d?t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx(Ee,{width:"200px",height:"24px"}),t.jsx("div",{style:{marginTop:"24px"},children:t.jsx(Ee,{height:"40px"})}),t.jsx("div",{style:{marginTop:"16px"},children:t.jsx(Ee,{height:"40px"})})]}):t.jsxs(t.Fragment,{children:[o==="signature"&&t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Your Email Signature"}),t.jsx("p",{style:{fontSize:"13px",color:e.textSecondary,marginBottom:"24px"},children:"This signature will be automatically added to all emails you send through the platform"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[t.jsx(ae,{label:"Full Name",value:w.full_name,onChange:C("full_name"),placeholder:"John Doe",theme:e}),t.jsx(ae,{label:"Job Title",value:w.job_title,onChange:C("job_title"),placeholder:"Insurance Advisor",theme:e}),t.jsx(ae,{label:"Phone Number",value:w.phone,onChange:C("phone"),placeholder:"(555) 123-4567",theme:e}),t.jsx(ae,{label:"Email Address",value:w.email,onChange:C("email"),placeholder:"john.doe@company.com",type:"email",theme:e})]}),t.jsx(Co,{label:"Custom Message (Optional)",value:w.custom_message,onChange:C("custom_message"),placeholder:"Looking forward to serving you!",theme:e}),t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:e.text,display:"block",marginBottom:"8px"},children:"Preview"}),t.jsx(ko,{settings:w,theme:e})]}),t.jsx("button",{onClick:v,disabled:i,style:{padding:"12px 24px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:i?"wait":"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px",opacity:i?.7:1},children:i?" Saving...":" Save Signature"})]}),o==="agency"&&t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Agency Information"}),t.jsx("p",{style:{fontSize:"13px",color:e.textSecondary,marginBottom:"24px"},children:"Your agency details used in email templates and footers"}),t.jsx(ae,{label:"Agency Name",value:w.agency_name,onChange:C("agency_name"),placeholder:"Insurance Solutions Group",theme:e}),t.jsx(ae,{label:"Address",value:w.agency_address,onChange:C("agency_address"),placeholder:"123 Main Street, Suite 100, Dallas, TX 75201",theme:e}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[t.jsx(ae,{label:"Phone",value:w.agency_phone,onChange:C("agency_phone"),placeholder:"(555) 000-0000",theme:e}),t.jsx(ae,{label:"Website",value:w.agency_website,onChange:C("agency_website"),placeholder:"https://www.example.com",theme:e})]}),t.jsx("button",{onClick:p,disabled:i,style:{padding:"12px 24px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:i?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:i?.7:1},children:i?" Saving...":" Save Agency Info"})]}),o==="email"&&t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Email Configuration"}),t.jsx("p",{style:{fontSize:"13px",color:e.textSecondary},children:"Configure your sending domain and default email settings"})]}),t.jsx("span",{style:{padding:"4px 10px",backgroundColor:e.bgHover,borderRadius:"20px",fontSize:"11px",color:e.textSecondary},children:"Admin Only"})]}),t.jsx(ae,{label:"Sending Domain",value:w.sending_domain,onChange:C("sending_domain"),placeholder:"emails.yourcompany.com",hint:"The domain that will be used to send emails. Must be verified in SendGrid.",theme:e}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[t.jsx(ae,{label:"Default From Name",value:w.default_from_name,onChange:C("default_from_name"),placeholder:"Your Company",theme:e}),t.jsx(ae,{label:"Default From Email",value:w.default_from_email,onChange:C("default_from_email"),placeholder:"noreply@yourcompany.com",type:"email",theme:e})]}),t.jsx(ae,{label:"Reply-To Email",value:w.reply_to_email,onChange:C("reply_to_email"),placeholder:"support@yourcompany.com",type:"email",hint:"Where replies will be directed when recipients respond to automated emails.",theme:e}),t.jsx("button",{onClick:p,disabled:i,style:{padding:"12px 24px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:i?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:i?.7:1},children:i?" Saving...":" Save Configuration"})]}),o==="integrations"&&t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"24px"},children:"Integrations"}),t.jsx("div",{style:{padding:"20px",backgroundColor:e.bg,borderRadius:"10px",border:`1px solid ${e.border}`,marginBottom:"16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[t.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#1A82E2",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SG"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"600",color:e.text,marginBottom:"2px"},children:"SendGrid"}),t.jsx("div",{style:{fontSize:"13px",color:e.textSecondary},children:"Email delivery service"})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${e.success}20`,color:e.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),t.jsx("button",{style:{padding:"8px 12px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"6px",color:e.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Configure"})]})]})}),t.jsx("div",{style:{padding:"20px",backgroundColor:e.bg,borderRadius:"10px",border:`1px solid ${e.border}`,marginBottom:"16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[t.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#00A1E0",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SF"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"600",color:e.text,marginBottom:"2px"},children:"Salesforce"}),t.jsx("div",{style:{fontSize:"13px",color:e.textSecondary},children:"CRM data sync"})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${e.success}20`,color:e.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),t.jsx("button",{style:{padding:"8px 12px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"6px",color:e.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Sync Now"})]})]})}),t.jsxs("div",{style:{padding:"16px",backgroundColor:`${e.primary}10`,borderRadius:"8px",marginTop:"24px"},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:e.text,marginBottom:"4px"},children:" Webhook URL"}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary,marginBottom:"8px"},children:"Configure this URL in SendGrid to receive email event notifications"}),t.jsxs("code",{style:{display:"block",padding:"8px 12px",backgroundColor:e.bgCard,borderRadius:"6px",fontSize:"12px",color:e.primary,wordBreak:"break-all"},children:["https://your-app-url.com/api/webhooks/sendgrid/",r]})]})]})]})]})},Fe=[{value:"account_status",label:"Account Status",type:"select",options:[{value:"customer",label:"Customer"},{value:"prospect",label:"Prospect"},{value:"prior_customer",label:"Prior Customer"},{value:"lead",label:"Lead"}]},{value:"policy_type",label:"Policy Type",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"active_policy_type",label:"Has Active Policy",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"policy_status",label:"Policy Status",type:"select",options:[{value:"active",label:"Active"},{value:"pending active",label:"Pending Active"},{value:"cancelled",label:"Cancelled"},{value:"expired",label:"Expired"}]},{value:"policy_count",label:"Number of Policies",type:"number"},{value:"policy_term",label:"Policy Term",type:"select",options:[{value:"6",label:"6 Months"},{value:"12",label:"12 Months"}]},{value:"policy_effective",label:"Policy Effective Date",type:"date"},{value:"policy_expiration",label:"Policy Expiration",type:"date"},{value:"state",label:"State",type:"select",options:[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}]},{value:"city",label:"City",type:"text"},{value:"zip_code",label:"ZIP Code",type:"text"},{value:"email_domain",label:"Email Domain",type:"text"},{value:"last_email_sent",label:"Last Email Sent",type:"date"},{value:"account_created",label:"Account Created",type:"date"}],wt={select:[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"is_any",label:"is any of"},{value:"is_not_any",label:"is not any of"}],number:[{value:"equals",label:"equals"},{value:"greater_than",label:"greater than"},{value:"less_than",label:"less than"},{value:"at_least",label:"at least"},{value:"at_most",label:"at most"},{value:"between",label:"is between"}],date:[{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"between",label:"is between"},{value:"in_next_days",label:"is in the next"},{value:"in_last_days",label:"was in the last"},{value:"more_than_days_future",label:"is more than X days from now"},{value:"less_than_days_future",label:"is less than X days from now"},{value:"more_than_days_ago",label:"was more than X days ago"},{value:"less_than_days_ago",label:"was less than X days ago"}],text:[{value:"contains",label:"contains"},{value:"not_contains",label:"does not contain"},{value:"equals",label:"equals"},{value:"not_equals",label:"does not equal"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"},{value:"is_empty",label:"is empty"},{value:"is_not_empty",label:"is not empty"}]},Ro=[{label:"Renewals (30 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"30"}},{label:"Renewals (60 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"60"}},{label:"Renewals (90 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"90"}},{label:"New Customers (90 days)",filter:{field:"account_created",operator:"in_last_days",value:"90"}},{label:"Active Customers",filter:{field:"account_status",operator:"is",value:"customer"}},{label:"Cross-Sell: Auto Only",filters:[{field:"active_policy_type",operator:"is",value:"Auto"},{field:"active_policy_type",operator:"is_not",value:"Home"}]},{label:"Cross-Sell: Home Only",filters:[{field:"active_policy_type",operator:"is",value:"Home"},{field:"active_policy_type",operator:"is_not",value:"Auto"}]},{label:"Prior Customers",filter:{field:"account_status",operator:"is",value:"prior_customer"}},{label:"Prospects",filter:{field:"account_status",operator:"is",value:"prospect"}}],$o=(e,r)=>{const a=(wt[e]||[]).find(i=>i.value===r);return(a==null?void 0:a.label)||r},it=e=>{const r=Fe.find(n=>n.value===e.field);if(!r)return null;const o=r.label,a=$o(r.type,e.operator);let i=e.value;if(r.type==="select"&&r.options)if(e.operator==="is_any"||e.operator==="is_not_any")i=(e.value||"").split(",").map(s=>{const l=r.options.find(c=>c.value===s);return(l==null?void 0:l.label)||s}).join(", ");else{const n=r.options.find(s=>s.value===e.value);i=(n==null?void 0:n.label)||e.value}return e.operator==="is_empty"||e.operator==="is_not_empty"?`${o} ${a}`:e.operator==="between"&&e.value2?`${o} ${a} ${e.value} and ${e.value2}`:e.operator==="in_next_days"||e.operator==="in_last_days"?`${o} ${a} ${e.value} days`:e.operator==="more_than_days_future"?`${o} is more than ${e.value} days from now`:e.operator==="less_than_days_future"?`${o} is less than ${e.value} days from now`:e.operator==="more_than_days_ago"?`${o} was more than ${e.value} days ago`:e.operator==="less_than_days_ago"?`${o} was less than ${e.value} days ago`:`${o} ${a} ${i}`},Do=({rule:e,index:r,onUpdate:o,onRemove:a,theme:i})=>{const n=Fe.find(d=>d.value===e.field),s=n?wt[n.type]:[],l={padding:"8px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.text,fontSize:"13px",minWidth:"140px"},c={padding:"8px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.text,fontSize:"13px",width:"120px"};return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:i.bgCard,borderRadius:"8px",border:`1px solid ${i.border}`,flexWrap:"wrap"},children:[r>0&&t.jsx("span",{style:{fontSize:"12px",color:i.primary,fontWeight:"600",padding:"4px 8px",backgroundColor:`${i.primary}15`,borderRadius:"4px"},children:"AND"}),t.jsxs("select",{value:e.field||"",onChange:d=>o(r,{...e,field:d.target.value,operator:"",value:""}),style:l,children:[t.jsx("option",{value:"",children:"Select field..."}),Fe.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))]}),e.field&&t.jsxs("select",{value:e.operator||"",onChange:d=>o(r,{...e,operator:d.target.value}),style:l,children:[t.jsx("option",{value:"",children:"Select condition..."}),s.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))]}),e.field&&e.operator&&t.jsxs(t.Fragment,{children:[(n==null?void 0:n.type)==="select"&&!["is_any","is_not_any"].includes(e.operator)&&t.jsxs("select",{value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),style:l,children:[t.jsx("option",{value:"",children:"Select value..."}),n.options.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))]}),(n==null?void 0:n.type)==="select"&&["is_any","is_not_any"].includes(e.operator)&&t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:n.options.map(d=>t.jsx("button",{onClick:()=>{const k=e.value?e.value.split(","):[],g=k.includes(d.value)?k.filter(u=>u!==d.value):[...k,d.value];o(r,{...e,value:g.join(",")})},style:{padding:"4px 10px",backgroundColor:(e.value||"").split(",").includes(d.value)?i.primary:i.bgHover,color:(e.value||"").split(",").includes(d.value)?"#fff":i.text,border:`1px solid ${(e.value||"").split(",").includes(d.value)?i.primary:i.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:d.label},d.value))}),(n==null?void 0:n.type)==="number"&&e.operator!=="between"&&t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"0",style:c}),(n==null?void 0:n.type)==="number"&&e.operator==="between"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"Min",style:{...c,width:"80px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"and"}),t.jsx("input",{type:"number",value:e.value2||"",onChange:d=>o(r,{...e,value2:d.target.value}),placeholder:"Max",style:{...c,width:"80px"}})]}),(n==null?void 0:n.type)==="date"&&e.operator==="in_next_days"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"30",style:{...c,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&e.operator==="in_last_days"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"30",style:{...c,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&e.operator==="between"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"date",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),style:c}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"and"}),t.jsx("input",{type:"date",value:e.value2||"",onChange:d=>o(r,{...e,value2:d.target.value}),style:c})]}),(n==null?void 0:n.type)==="date"&&(e.operator==="before"||e.operator==="after")&&t.jsx("input",{type:"date",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),style:c}),(n==null?void 0:n.type)==="date"&&["more_than_days_future","less_than_days_future","more_than_days_ago","less_than_days_ago"].includes(e.operator)&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"30",min:"1",style:{...c,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="text"&&!["is_empty","is_not_empty"].includes(e.operator)&&t.jsx("input",{type:"text",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:`Enter ${n.label.toLowerCase()}...`,style:{...c,width:"160px"}})]}),t.jsx("button",{onClick:()=>a(r),style:{marginLeft:"auto",padding:"6px 10px",backgroundColor:"transparent",border:"none",color:i.textMuted,cursor:"pointer",fontSize:"16px",borderRadius:"4px"},title:"Remove filter",children:""})]})},Ao=({group:e,groupIndex:r,onRemoveGroup:o,onDuplicateGroup:a,onAddRule:i,onUpdateRule:n,onRemoveRule:s,theme:l})=>{const c=e.rules||[];return t.jsxs("div",{style:{padding:"16px",backgroundColor:l.bgCard,borderRadius:"12px",border:`2px solid ${l.border}`,position:"relative"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[t.jsxs("span",{style:{fontSize:"12px",fontWeight:"600",color:l.textSecondary,textTransform:"uppercase",letterSpacing:"0.5px"},children:["Group ",r+1]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[a&&t.jsxs("button",{onClick:()=>a(r),style:{padding:"4px 8px",backgroundColor:"transparent",border:`1px solid ${l.border}`,color:l.textSecondary,cursor:"pointer",fontSize:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"4px"},title:"Duplicate group",children:[t.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),t.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),"Duplicate"]}),t.jsx("button",{onClick:()=>o(r),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:l.textMuted,cursor:"pointer",fontSize:"12px",borderRadius:"4px"},title:"Remove group",children:"Remove"})]})]}),c.length===0?t.jsx("div",{style:{textAlign:"center",padding:"12px",color:l.textMuted,fontSize:"13px"},children:"Add filters to this group"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:c.map((d,k)=>t.jsx(Do,{rule:d,index:k,onUpdate:(g,u)=>n(r,g,u),onRemove:g=>s(r,g),theme:l},k))}),t.jsxs("button",{onClick:()=>i(r),style:{width:"100%",padding:"8px",backgroundColor:l.bgHover,border:`1px dashed ${l.border}`,borderRadius:"6px",color:l.primary,cursor:"pointer",fontSize:"12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[t.jsx("span",{children:"+"})," Add Filter to Group"]})]})},Io=({groups:e,onApplyFilter:r,theme:o,filters:a=Ro})=>t.jsxs("div",{style:{padding:"16px",backgroundColor:o.bgCard,borderRadius:"12px",border:`1px solid ${o.border}`,marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:o.textSecondary,marginBottom:"10px"},children:"Quick Filters"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:a.map((i,n)=>t.jsxs("button",{onClick:()=>r(i),style:{padding:"6px 12px",backgroundColor:o.bgHover,border:`1px solid ${o.border}`,borderRadius:"16px",color:o.text,cursor:"pointer",fontSize:"12px",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:s=>{s.target.style.backgroundColor=o.primary+"20",s.target.style.borderColor=o.primary,s.target.style.color=o.primary},onMouseLeave:s=>{s.target.style.backgroundColor=o.bgHover,s.target.style.borderColor=o.border,s.target.style.color=o.text},children:["+ ",i.label]},n))})]}),To=({filterConfig:e,setFilterConfig:r,recipientCount:o,isLoading:a,onPreviewClick:i,showQuickFilters:n=!0,theme:s})=>{var M;const l=(e==null?void 0:e.groups)||(((M=e==null?void 0:e.rules)==null?void 0:M.length)>0?[{rules:e.rules}]:[]),c=l.length>0,d=()=>{const $=[...l,{rules:[{field:"",operator:"",value:""}]}];r({...e,groups:$,rules:void 0})},k=$=>{const E=l.filter((j,W)=>W!==$);r({...e,groups:E,rules:void 0})},g=$=>{const j={rules:(l[$].rules||[]).map(O=>({...O}))},W=[...l];W.splice($+1,0,j),r({...e,groups:W,rules:void 0})},u=$=>{const E=[...l];E[$]={...E[$],rules:[...E[$].rules||[],{field:"",operator:"",value:""}]},r({...e,groups:E,rules:void 0})},w=($,E,j)=>{const W=[...l],O=[...W[$].rules||[]];O[E]=j,W[$]={...W[$],rules:O},r({...e,groups:W,rules:void 0})},m=($,E)=>{const j=[...l];j[$]={...j[$],rules:j[$].rules.filter((W,O)=>O!==E)},j[$].rules.length===0&&j.splice($,1),r({...e,groups:j,rules:void 0})},C=()=>{r({...e,groups:[],rules:void 0})},v=$=>{if($.filters){const E={rules:$.filters};r({...e,groups:[...l,E],rules:void 0})}else{const E={rules:[$.filter]};r({...e,groups:[...l,E],rules:void 0})}},p=l.reduce(($,E)=>$+(E.rules||[]).filter(j=>j.field&&j.operator&&(j.value||["is_empty","is_not_empty"].includes(j.operator))).length,0);return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:s.text,margin:0},children:"Filter Recipients"}),c&&t.jsx("button",{onClick:C,style:{padding:"6px 12px",backgroundColor:"transparent",border:`1px solid ${s.border}`,borderRadius:"6px",color:s.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Clear all"})]}),n&&t.jsx(Io,{groups:l,onApplyFilter:v,theme:s}),t.jsxs("div",{style:{padding:"16px",backgroundColor:s.bgHover,borderRadius:"12px",marginBottom:"16px"},children:[c?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},children:l.map(($,E)=>t.jsxs("div",{children:[E>0&&t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"8px 0",gap:"12px"},children:[t.jsx("div",{style:{flex:1,height:"1px",backgroundColor:s.border}}),t.jsx("span",{style:{fontSize:"12px",fontWeight:"700",color:"#f59e0b",padding:"4px 12px",backgroundColor:"#f59e0b20",borderRadius:"4px",textTransform:"uppercase",letterSpacing:"1px"},children:"OR"}),t.jsx("div",{style:{flex:1,height:"1px",backgroundColor:s.border}})]}),t.jsx(Ao,{group:$,groupIndex:E,onRemoveGroup:k,onDuplicateGroup:g,onAddRule:u,onUpdateRule:w,onRemoveRule:m,theme:s})]},E))}):t.jsx("div",{style:{textAlign:"center",padding:"20px",color:s.textMuted,fontSize:"14px"},children:"No filters applied. All matching records will be included."}),t.jsxs("button",{onClick:d,style:{width:"100%",padding:"10px",backgroundColor:s.bgCard,border:`1px dashed ${s.border}`,borderRadius:"8px",color:s.primary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," ",c?"Add OR Group":"Add Filter Group"]})]}),p>0&&t.jsxs("div",{style:{padding:"12px 16px",backgroundColor:`${s.primary}10`,borderRadius:"8px",marginBottom:"16px",fontSize:"13px",color:s.text},children:[t.jsx("strong",{children:p})," filter",p!==1?"s":""," in ",t.jsx("strong",{children:l.length})," group",l.length!==1?"s":"",l.length>1&&t.jsx("span",{style:{color:s.textSecondary},children:" (groups combined with OR)"})]}),o!==void 0&&t.jsxs("button",{onClick:i,disabled:a||o===0||!i,style:{width:"100%",padding:"20px",backgroundColor:`${s.primary}10`,borderRadius:"12px",border:`1px solid ${s.primary}30`,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:a||o===0||!i?"default":"pointer",textAlign:"left",transition:"all 0.2s"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:s.text},children:"Matching Recipients"}),t.jsx("div",{style:{fontSize:"12px",color:s.textSecondary},children:o>0&&i?"Click to view matching accounts":"Accounts matching your criteria"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:s.primary},children:a?"...":(o??0).toLocaleString()}),!a&&o>0&&i&&t.jsx("div",{style:{padding:"6px 10px",backgroundColor:s.primary,color:"#fff",borderRadius:"6px",fontSize:"12px",fontWeight:"500"},children:"View"})]})]})]})},Wo={bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},Mo=[{id:"entry-criteria",type:"entry_criteria",title:"Entry Criteria",subtitle:"Define who enters this automation",config:{filterConfig:{groups:[]},reentry:{enabled:!1,type:"never",days:30},pacing:{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}}},{id:"trigger",type:"trigger",title:"Trigger",subtitle:"Daily at 09:00 (Central)",config:{time:"09:00",timezone:"America/Chicago",frequency:"Daily"}},{id:"node-1",type:"send_email",title:"Send Email",subtitle:"Select template...",config:{template:""}}],Bo=({t:e,automation:r,onUpdate:o,onSave:a,canEdit:i=!0})=>{var Re,$e,De,_e,ie,J,ce,Ke,Ve,Qe,Ye,Xe,Ze,Je,et,tt,ot;const n=e||Wo,s=()=>!(r!=null&&r.nodes)||r.nodes.length===0?Mo:r.nodes.map(f=>{var q,B,Q;return f.type==="entry_criteria"?{...f,config:{...f.config,filterConfig:((q=f.config)==null?void 0:q.filterConfig)||{groups:[]},reentry:((B=f.config)==null?void 0:B.reentry)||{enabled:!1,type:"never",days:30},pacing:((Q=f.config)==null?void 0:Q.pacing)||{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}}}:f}),[l,c]=A.useState(s),[d,k]=A.useState(null),[g,u]=A.useState(null),[w,m]=A.useState(!1),[C,v]=A.useState(!1),[p,M]=A.useState(null),{data:$=[],isLoading:E}=Ge(),j=(r==null?void 0:r.nodeStats)||{},W=l.find(f=>f.type==="entry_criteria"),[O,V]=A.useState(((Re=W==null?void 0:W.config)==null?void 0:Re.filterConfig)||{groups:[]}),[F,N]=A.useState((($e=W==null?void 0:W.config)==null?void 0:$e.reentry)||{enabled:!1,type:"never",days:30}),[L,G]=A.useState(((De=W==null?void 0:W.config)==null?void 0:De.pacing)||{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}),I=f=>{V(f),c(q=>q.map(B=>B.type==="entry_criteria"?{...B,config:{...B.config,filterConfig:f}}:B))},H=f=>{N(f),c(q=>q.map(B=>B.type==="entry_criteria"?{...B,config:{...B.config,reentry:f}}:B))},P=f=>{G(f),c(q=>q.map(B=>B.type==="entry_criteria"?{...B,config:{...B.config,pacing:f}}:B))},T=A.useRef(null);A.useEffect(()=>(o&&(T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{o(f=>({...f,nodes:l,filter_config:O}))},100)),()=>{T.current&&clearTimeout(T.current)}),[l,O,F,L]);const x=(_e=O==null?void 0:O.groups)==null?void 0:_e.some(f=>{var q;return(q=f.rules)==null?void 0:q.some(B=>B.field&&B.operator)}),{data:D,isLoading:U}=Oe(C&&x?O:null,{limit:500}),{data:oe,isLoading:te}=jt(x?O:null),z={entry_criteria:{icon:"",color:"#8b5cf6",label:"Entry Criteria"},trigger:{icon:"",color:n.primary,label:"Trigger"},send_email:{icon:"",color:n.success,label:"Send Email"},delay:{icon:"",color:n.warning,label:"Delay"},condition:{icon:"",color:n.purple,label:"Condition"},field_condition:{icon:"",color:"#ec4899",label:"Field Check"},update_field:{icon:"",color:"#06b6d4",label:"Update Field"},end:{icon:"",color:n.textMuted,label:"End"}},S=[{type:"send_email",label:"Send Email",desc:"Send an email template",icon:""},{type:"delay",label:"Delay",desc:"Wait before continuing",icon:""},{type:"condition",label:"Email Engagement",desc:"Branch on open/click",icon:""},{type:"field_condition",label:"Field Condition",desc:"Branch on field value",icon:""},{type:"update_field",label:"Update Field",desc:"Update a record field",icon:""},{type:"end",label:"End",desc:"Stop automation",icon:""}],h=(f,q,B=null)=>{var xe;const Q={id:`node-${Date.now()}`,type:q,title:((xe=S.find(se=>se.type===q))==null?void 0:xe.label)||q,subtitle:"Configure...",config:{}};if((q==="condition"||q==="field_condition")&&(Q.branches={yes:[],no:[]}),B)c(se=>{const de=X=>X.map(le=>le.id===f&&le.branches?{...le,branches:{...le.branches,[B]:[...le.branches[B],Q]}}:le.branches?{...le,branches:{yes:de(le.branches.yes),no:de(le.branches.no)}}:le);return de(se)});else{const se=l.findIndex(X=>X.id===f),de=[...l];de.splice(se+1,0,Q),c(de)}u(null),k(Q.id)},_=f=>{c(q=>q.filter(B=>B.id!==f&&B.id!=="trigger"&&B.id!=="entry-criteria")),d===f&&k(null)},b=()=>{const f=(O==null?void 0:O.groups)||[],q=f.reduce((B,Q)=>{var xe;return B+(((xe=Q.rules)==null?void 0:xe.filter(se=>se.field&&se.operator).length)||0)},0);return q===0?"No filters defined":`${q} filter${q!==1?"s":""} in ${f.length} group${f.length!==1?"s":""}`},R=(f,q)=>{const B=j[f]||{};return q==="entry_criteria"?B.entered?`${B.entered.toLocaleString()} entered`:null:q==="trigger"?B.processed?`${B.processed.toLocaleString()} processed`:null:q==="send_email"&&B.sent?`${B.sent.toLocaleString()} sent`:q==="delay"?B.waiting?`${B.waiting.toLocaleString()} waiting`:null:(q==="condition"||q==="field_condition")&&B.evaluated?`${B.evaluated.toLocaleString()} evaluated`:null},be=({node:f})=>{const q=z[f.type]||z.send_email,B=d===f.id,Q=f.type==="entry_criteria",xe=f.type==="trigger",se=Q||xe,de=R(f.id,f.type);return t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[t.jsxs("div",{onClick:()=>{k(f.id)},style:{width:"320px",backgroundColor:n.bgCard,border:B?`2px solid ${q.color}`:`1px solid ${n.border}`,borderRadius:"12px",padding:"16px 18px",cursor:"pointer",position:"relative"},children:[de&&t.jsx("div",{style:{position:"absolute",top:"-10px",right:"12px",padding:"4px 10px",backgroundColor:q.color,color:"#fff",borderRadius:"12px",fontSize:"11px",fontWeight:"600",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:de}),!se&&t.jsx("button",{onClick:X=>{X.stopPropagation(),_(f.id)},style:{position:"absolute",top:"8px",right:"8px",background:"none",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"16px"},children:""}),t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[t.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${q.color}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:q.icon}),t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:n.text},children:f.title}),t.jsx("div",{style:{fontSize:"12px",color:n.textMuted,marginTop:"2px"},children:Q?b():f.subtitle})]})]}),Q&&t.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[t.jsxs("button",{onClick:X=>{X.stopPropagation(),m(!0)},style:{flex:1,padding:"10px",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,borderRadius:"8px",color:n.textSecondary,cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:""})," Edit Criteria"]}),t.jsxs("button",{onClick:X=>{X.stopPropagation(),v(!0)},style:{flex:1,padding:"10px",backgroundColor:n.primary+"15",border:`1px solid ${n.primary}40`,borderRadius:"8px",color:n.primary,cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:""})," Preview ",x&&oe!==void 0&&!te&&t.jsx("span",{style:{backgroundColor:n.primary,color:"#fff",padding:"2px 6px",borderRadius:"10px",fontSize:"10px",fontWeight:"600"},children:oe})]})]})]}),!f.branches&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.borderLight}}),t.jsx("button",{onClick:()=>u({afterNodeId:f.id,branch:null}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,color:n.textMuted,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"}),t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.borderLight}}),(g==null?void 0:g.afterNodeId)===f.id&&!(g!=null&&g.branch)&&t.jsx(ve,{onSelect:X=>h(f.id,X),onClose:()=>u(null)})]}),f.branches&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.borderLight}}),t.jsxs("div",{style:{display:"flex"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:n.success}}),t.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#22c55e20",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:n.success},children:"YES"})]}),t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.success}}),f.branches.yes.map(X=>t.jsx(be,{node:X},X.id)),t.jsx("button",{onClick:()=>u({afterNodeId:f.id,branch:"yes"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:n.bgHover,border:"1px dashed #22c55e",color:n.success,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(g==null?void 0:g.afterNodeId)===f.id&&(g==null?void 0:g.branch)==="yes"&&t.jsx(ve,{onSelect:X=>h(f.id,X,"yes"),onClose:()=>u(null)})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#ef444420",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:n.danger},children:"NO"}),t.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:n.danger}})]}),t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.danger}}),f.branches.no.map(X=>t.jsx(be,{node:X},X.id)),t.jsx("button",{onClick:()=>u({afterNodeId:f.id,branch:"no"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:n.bgHover,border:"1px dashed #ef4444",color:n.danger,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(g==null?void 0:g.afterNodeId)===f.id&&(g==null?void 0:g.branch)==="no"&&t.jsx(ve,{onSelect:X=>h(f.id,X,"no"),onClose:()=>u(null)})]})]})]})]})},ve=({onSelect:f,onClose:q})=>t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:q}),t.jsx("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"10px",backgroundColor:n.bgCard,border:`1px solid ${n.borderLight}`,borderRadius:"12px",padding:"8px",zIndex:100,width:"240px",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},children:S.map(B=>t.jsxs("button",{onClick:()=>f(B.type),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px",color:n.text,textAlign:"left"},children:[t.jsx("span",{style:{fontSize:"18px"},children:B.icon}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500"},children:B.label}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:B.desc})]})]},B.type))})]}),Y=l.find(f=>f.id===d)||l.flatMap(f=>f.branches?[...f.branches.yes||[],...f.branches.no||[]]:[]).find(f=>f.id===d);return t.jsxs("div",{style:{fontFamily:"'IBM Plex Sans', -apple-system, sans-serif",backgroundColor:n.bg,height:"100%",color:n.text,display:"flex"},children:[t.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[t.jsxs("div",{style:{width:"220px",borderRight:`1px solid ${n.border}`,padding:"16px",backgroundColor:n.bgCard,overflowY:"auto"},children:[t.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:n.textMuted,marginBottom:"12px",textTransform:"uppercase"},children:"Add Nodes"}),S.map(f=>t.jsxs("div",{style:{padding:"12px",backgroundColor:n.bgHover,borderRadius:"8px",marginBottom:"8px",cursor:"grab",display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{fontSize:"18px"},children:f.icon}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:n.text},children:f.label}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:f.desc})]})]},f.type))]}),t.jsx("div",{style:{flex:1,padding:"40px",overflowY:"auto",display:"flex",justifyContent:"center"},children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[l.map(f=>t.jsx(be,{node:f},f.id)),t.jsx("div",{style:{marginTop:"16px",padding:"8px 18px",backgroundColor:n.bgHover,borderRadius:"20px",fontSize:"12px",color:n.textMuted},children:"End of automation"})]})}),t.jsxs("div",{style:{width:"300px",borderLeft:`1px solid ${n.border}`,backgroundColor:n.bgCard,overflowY:"auto"},children:[t.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${n.border}`,fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase"},children:"Configuration"}),t.jsx("div",{style:{padding:"18px"},children:Y?t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[t.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${((ie=z[Y.type])==null?void 0:ie.color)||n.primary}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:((J=z[Y.type])==null?void 0:J.icon)||""}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"600",color:n.text,fontSize:"15px"},children:Y.title}),t.jsx("div",{style:{fontSize:"12px",color:n.textMuted},children:((ce=z[Y.type])==null?void 0:ce.label)||"Node"})]})]}),Y.type==="entry_criteria"&&t.jsxs("div",{children:[t.jsx("p",{style:{fontSize:"13px",color:n.textSecondary,marginBottom:"16px"},children:"Define which accounts enter this automation based on their attributes."}),((O==null?void 0:O.groups)||[]).length>0&&t.jsxs("div",{style:{padding:"12px",backgroundColor:n.bgHover,borderRadius:"8px",marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:n.textMuted,marginBottom:"8px",textTransform:"uppercase"},children:"Current Filters"}),O.groups.map((f,q)=>t.jsxs("div",{style:{marginBottom:q<O.groups.length-1?"8px":0},children:[q>0&&t.jsx("div",{style:{fontSize:"10px",color:"#f59e0b",fontWeight:"700",textAlign:"center",margin:"6px 0"},children:"OR"}),(f.rules||[]).filter(B=>B.field&&B.operator).map((B,Q)=>t.jsx("div",{style:{padding:"4px 8px",backgroundColor:`${n.primary}15`,borderRadius:"4px",fontSize:"11px",color:n.text,marginBottom:"4px"},children:it(B)},Q))]},q))]}),t.jsx("button",{onClick:()=>m(!0),style:{width:"100%",padding:"12px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",marginBottom:"20px"},children:"Edit Entry Criteria"}),t.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgHover,borderRadius:"8px",marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:n.text,marginBottom:"12px"},children:"Re-entry Rules"}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",marginBottom:"12px"},children:[t.jsx("input",{type:"checkbox",checked:F.enabled,onChange:f=>H({...F,enabled:f.target.checked}),style:{width:"16px",height:"16px",accentColor:n.primary}}),t.jsx("span",{style:{fontSize:"13px",color:n.textSecondary},children:"Allow contacts to re-enter"})]}),F.enabled&&t.jsx("div",{style:{marginLeft:"26px"},children:t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px",cursor:"pointer"},children:[t.jsx("input",{type:"radio",name:"reentryType",checked:F.type==="after_days",onChange:()=>H({...F,type:"after_days"}),style:{accentColor:n.primary}}),t.jsx("span",{style:{fontSize:"12px",color:n.textSecondary},children:"After"}),t.jsx("input",{type:"number",value:F.days,onChange:f=>H({...F,days:parseInt(f.target.value)||1}),min:"1",style:{width:"60px",padding:"4px 8px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"4px",color:n.text,fontSize:"12px"}}),t.jsx("span",{style:{fontSize:"12px",color:n.textSecondary},children:"days"})]})}),!F.enabled&&t.jsx("p",{style:{fontSize:"11px",color:n.textMuted,margin:0},children:"Contacts can only enter this automation once"})]}),t.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgHover,borderRadius:"8px"},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:n.text,marginBottom:"12px"},children:"Enrollment Pacing"}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",marginBottom:"12px"},children:[t.jsx("input",{type:"checkbox",checked:L.enabled,onChange:f=>P({...L,enabled:f.target.checked}),style:{width:"16px",height:"16px",accentColor:n.primary}}),t.jsx("span",{style:{fontSize:"13px",color:n.textSecondary},children:"Spread enrollments over time"})]}),L.enabled&&t.jsxs("div",{style:{marginLeft:"26px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[t.jsx("span",{style:{fontSize:"12px",color:n.textSecondary},children:"Spread over"}),t.jsx("input",{type:"number",value:L.spreadOverDays,onChange:f=>P({...L,spreadOverDays:parseInt(f.target.value)||1}),min:"1",max:"365",style:{width:"60px",padding:"4px 8px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"4px",color:n.text,fontSize:"12px"}}),t.jsx("span",{style:{fontSize:"12px",color:n.textSecondary},children:"days"})]}),t.jsx("div",{style:{fontSize:"11px",color:n.textSecondary,marginBottom:"8px"},children:"Run on these days:"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[{value:"sun",label:"Sun"},{value:"mon",label:"Mon"},{value:"tue",label:"Tue"},{value:"wed",label:"Wed"},{value:"thu",label:"Thu"},{value:"fri",label:"Fri"},{value:"sat",label:"Sat"}].map(f=>t.jsx("button",{onClick:()=>{const q=L.allowedDays||[],B=q.includes(f.value)?q.filter(Q=>Q!==f.value):[...q,f.value];P({...L,allowedDays:B})},style:{padding:"4px 8px",backgroundColor:(L.allowedDays||[]).includes(f.value)?n.primary:n.bgCard,color:(L.allowedDays||[]).includes(f.value)?"#fff":n.textSecondary,border:`1px solid ${(L.allowedDays||[]).includes(f.value)?n.primary:n.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px",fontWeight:"500"},children:f.label},f.value))})]}),!L.enabled&&t.jsx("p",{style:{fontSize:"11px",color:n.textMuted,margin:0},children:"All matching contacts will be enrolled immediately"})]})]}),Y.type==="trigger"&&t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Run Time"}),t.jsx("input",{type:"time",defaultValue:((Ke=Y.config)==null?void 0:Ke.time)||"09:00",style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px",marginBottom:"16px"}}),t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Frequency"}),t.jsxs("select",{defaultValue:((Ve=Y.config)==null?void 0:Ve.frequency)||"Daily",style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[t.jsx("option",{children:"Daily"}),t.jsx("option",{children:"Weekly"}),t.jsx("option",{children:"Monthly"})]})]}),Y.type==="send_email"&&t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Email Template"}),t.jsxs("select",{value:((Qe=Y.config)==null?void 0:Qe.template)||"",onChange:f=>{const q=$.find(B=>B.id===f.target.value);updateNode(d,{config:{...Y.config,template:f.target.value,templateName:(q==null?void 0:q.name)||""},subtitle:(q==null?void 0:q.name)||"Select template..."})},style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[t.jsx("option",{value:"",children:E?"Loading templates...":"Select template..."}),$.map(f=>t.jsx("option",{value:f.id,children:f.name},f.id))]})]}),Y.type==="delay"&&t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Wait Duration"}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("input",{type:"number",defaultValue:((Ye=Y.config)==null?void 0:Ye.duration)||1,min:"1",style:{flex:1,padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"}}),t.jsxs("select",{defaultValue:((Xe=Y.config)==null?void 0:Xe.unit)||"days",style:{flex:1,padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[t.jsx("option",{value:"hours",children:"Hours"}),t.jsx("option",{value:"days",children:"Days"}),t.jsx("option",{value:"weeks",children:"Weeks"})]})]})]}),(Y.type==="condition"||Y.type==="field_condition")&&t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Condition Type"}),t.jsxs("select",{defaultValue:((Ze=Y.config)==null?void 0:Ze.type)||"email_opened",style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[t.jsx("option",{value:"email_opened",children:"Email Opened"}),t.jsx("option",{value:"email_clicked",children:"Email Clicked"}),t.jsx("option",{value:"field_value",children:"Field Value"})]})]}),Y.type==="end"&&t.jsx("p",{style:{fontSize:"13px",color:n.textSecondary},children:"This node ends the automation flow. Contacts reaching this point will exit the automation."})]}):t.jsxs("div",{style:{textAlign:"center",color:n.textMuted,padding:"30px 0"},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:""}),t.jsx("div",{style:{fontSize:"13px"},children:"Select a node to configure"})]})})]})]}),w&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",zIndex:200},onClick:()=>m(!1)}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"900px",maxWidth:"95vw",maxHeight:"85vh",backgroundColor:n.bgCard,borderRadius:"16px",border:`1px solid ${n.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${n.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[t.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Entry Criteria"}),t.jsx("button",{onClick:()=>m(!1),style:{background:"none",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"18px"},children:""})]}),t.jsx("div",{style:{flex:1,padding:"20px",overflow:"auto"},children:t.jsx(To,{filterConfig:O,setFilterConfig:I,showQuickFilters:!0,theme:n})}),t.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${n.border}`,display:"flex",justifyContent:"flex-end",gap:"8px",flexShrink:0},children:i?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>m(!1),style:{padding:"10px 20px",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,borderRadius:"8px",color:n.textSecondary,cursor:"pointer",fontSize:"13px"},children:"Cancel"}),t.jsx("button",{onClick:()=>m(!1),style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Save Criteria"})]}):t.jsx("button",{onClick:()=>m(!1),style:{padding:"10px 20px",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,borderRadius:"8px",color:n.textSecondary,cursor:"pointer",fontSize:"13px"},children:"Close"})})]})]}),C&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",zIndex:200},onClick:()=>v(!1)}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxWidth:"95vw",maxHeight:"85vh",backgroundColor:n.bgCard,borderRadius:"16px",border:`1px solid ${n.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${n.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[t.jsxs("div",{children:[t.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Preview Potential Enrollees"}),t.jsx("p",{style:{fontSize:"12px",color:n.textMuted,margin:"4px 0 0"},children:"Contacts matching your entry criteria who would enter this automation"})]}),t.jsx("button",{onClick:()=>v(!1),style:{background:"none",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"20px"},children:""})]}),t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${n.border}`,display:"flex",gap:"24px",backgroundColor:n.bgHover},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.primary},children:U?"...":(D==null?void 0:D.length)||0}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted,textTransform:"uppercase"},children:"Matching Contacts"})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.success},children:((Je=O==null?void 0:O.groups)==null?void 0:Je.length)||0}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted,textTransform:"uppercase"},children:"Filter Groups"})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.textSecondary},children:((et=O==null?void 0:O.groups)==null?void 0:et.reduce((f,q)=>{var B;return f+(((B=q.rules)==null?void 0:B.filter(Q=>Q.field&&Q.operator).length)||0)},0))||0}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted,textTransform:"uppercase"},children:"Active Filters"})]})]}),t.jsxs("div",{style:{flex:1,overflow:"auto",padding:"0"},children:[U?t.jsx("div",{style:{textAlign:"center",padding:"40px",color:n.textMuted},children:t.jsx("div",{style:{fontSize:"14px"},children:"Loading potential enrollees..."})}):x?D&&D.length>0?t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:n.bgHover},children:[t.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${n.border}`},children:"Contact"}),t.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${n.border}`},children:"Account Type"}),t.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${n.border}`},children:"Last Email"}),t.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${n.border}`},children:"Matched Groups"})]})}),t.jsx("tbody",{children:D.map(f=>t.jsxs("tr",{style:{borderBottom:`1px solid ${n.border}`},children:[t.jsxs("td",{style:{padding:"12px 20px"},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:n.text},children:f.name||f.account_name}),t.jsx("div",{style:{fontSize:"12px",color:n.textMuted},children:f.email})]}),t.jsx("td",{style:{padding:"12px 20px",fontSize:"13px",color:n.textSecondary},children:f.account_type||""}),t.jsx("td",{style:{padding:"12px 20px",fontSize:"13px",color:n.textSecondary},children:f._lastEmailSent?new Date(f._lastEmailSent).toLocaleDateString():"Never"}),t.jsx("td",{style:{padding:"12px 20px",position:"relative"},children:f._matchedGroups&&f._matchedGroups.length>0?t.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:f._matchedGroups.map(q=>t.jsxs("span",{style:{padding:"2px 8px",borderRadius:"10px",fontSize:"11px",fontWeight:"600",backgroundColor:(p==null?void 0:p.contactId)===f.id&&(p==null?void 0:p.groupIndex)===q?n.primary:`${n.primary}20`,color:(p==null?void 0:p.contactId)===f.id&&(p==null?void 0:p.groupIndex)===q?"#fff":n.primary,cursor:"default",transition:"all 0.15s ease",position:"relative"},onMouseEnter:B=>{const Q=B.target.getBoundingClientRect();M({contactId:f.id,groupIndex:q,x:Q.left,y:Q.bottom+8})},onMouseLeave:()=>{M(null)},children:["Group ",q+1]},q))}):t.jsx("span",{style:{fontSize:"12px",color:n.textMuted},children:""})})]},f.id))})]}):t.jsxs("div",{style:{textAlign:"center",padding:"40px",color:n.textMuted},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:""}),t.jsx("div",{style:{fontSize:"14px"},children:"No contacts match your current filters"})]}):t.jsxs("div",{style:{textAlign:"center",padding:"40px",color:n.textMuted},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:""}),t.jsx("div",{style:{fontSize:"14px"},children:"Add filters to see who would enter this automation"})]}),p&&((tt=O==null?void 0:O.groups)==null?void 0:tt[p.groupIndex])&&t.jsxs("div",{style:{position:"fixed",left:p.x,top:p.y,backgroundColor:n.bgCard,border:`1px solid ${n.border}`,borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e4,maxWidth:"300px",pointerEvents:"none"},children:[t.jsxs("div",{style:{fontSize:"11px",fontWeight:"600",color:n.textMuted,marginBottom:"8px",textTransform:"uppercase"},children:["Group ",p.groupIndex+1," Criteria"]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:(ot=O.groups[p.groupIndex].rules)==null?void 0:ot.filter(f=>f.field&&f.operator).map((f,q)=>t.jsx("div",{style:{fontSize:"12px",color:n.text},children:it(f)},q))})]})]}),t.jsxs("div",{style:{padding:"12px 20px",borderTop:`1px solid ${n.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0,backgroundColor:n.bgHover},children:[t.jsx("span",{style:{fontSize:"12px",color:n.textMuted},children:U?"Loading...":`Showing ${(D==null?void 0:D.length)||0} potential enrollee${((D==null?void 0:D.length)||0)!==1?"s":""}`}),t.jsx("button",{onClick:()=>v(!1),style:{padding:"8px 16px",backgroundColor:n.bgCard,border:`1px solid ${n.borderLight}`,borderRadius:"6px",color:n.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Close"})]})]})]})]})},st=({t:e})=>{var L,G;const{userId:r,automationId:o}=ee(),a=fe(),i=dt(),n=!o||o==="new";(L=i.state)!=null&&L.templateName||((G=i.state)==null||G.templateId);const{data:s=!1,isLoading:l}=io(),{data:c,isLoading:d,error:k}=qt(n?null:o),g=(c==null?void 0:c.is_default)===!0,u=n||!g||s,{createAutomation:w,updateAutomation:m,activateAutomation:C,pauseAutomation:v,duplicateAutomation:p}=ut(),M=async()=>{if(n)return;const I=$.status==="active",H=I?"paused":"active";try{I?await v.mutateAsync(o):await C.mutateAsync(o),E(P=>({...P,status:H}))}catch(P){console.error("Failed to toggle status:",P)}},[$,E]=A.useState({name:"",description:"",category:"general",status:"draft",send_time:"10:00",timezone:"America/Chicago",frequency:"Daily",filter_config:{},nodes:[]});A.useEffect(()=>{c&&E({name:c.name||"",description:c.description||"",category:c.category||"general",status:c.status||"draft",send_time:c.send_time||"10:00",timezone:c.timezone||"America/Chicago",frequency:c.frequency||"Daily",filter_config:c.filter_config||{},nodes:c.nodes||[]})},[c]);const j=async I=>{if(!u){alert('You cannot edit default automations. Use "Clone & Edit" to create your own copy.');return}try{if(n){const H=await w.mutateAsync(I);a(`/${r}/automations/${H.id}`,{replace:!0})}else await m.mutateAsync({automationId:o,updates:I})}catch(H){console.error("Failed to save automation:",H),alert("Failed to save automation. Please try again.")}},W=async()=>{try{const I=await p.mutateAsync(o);a(`/${r}/automations/${I.id}`,{replace:!0})}catch(I){console.error("Failed to clone automation:",I),alert("Failed to clone automation. Please try again.")}},O=()=>{a(`/${r}/automations`)},[V,F]=A.useState(null),N=n||c&&V===c.updated_at;return A.useEffect(()=>{c!=null&&c.updated_at&&F(c.updated_at)},[c==null?void 0:c.updated_at]),!n&&(d||l||!N)?t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[t.jsx("div",{style:{fontSize:"32px"},children:""}),t.jsx("div",{style:{color:(e==null?void 0:e.textSecondary)||"#a1a1aa"},children:"Loading automation..."})]}):k?t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[t.jsx("div",{style:{fontSize:"48px"},children:""}),t.jsx("h2",{style:{color:(e==null?void 0:e.text)||"#fafafa",margin:0},children:"Automation Not Found"}),t.jsx("p",{style:{color:(e==null?void 0:e.textSecondary)||"#a1a1aa"},children:"We couldn't find the automation you're looking for."}),t.jsx("button",{onClick:O,style:{padding:"10px 20px",backgroundColor:(e==null?void 0:e.primary)||"#3b82f6",border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Automations"})]}):t.jsxs("div",{style:{margin:"-24px",height:"calc(100vh - 49px)",display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${(e==null?void 0:e.border)||"#27272a"}`,display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:(e==null?void 0:e.bgCard)||"#18181b",flexShrink:0},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[t.jsx("button",{onClick:O,style:{background:"none",border:"none",color:(e==null?void 0:e.textSecondary)||"#a1a1aa",cursor:"pointer",fontSize:"20px",padding:"4px 8px",display:"flex",alignItems:"center"},children:""}),t.jsx("h1",{style:{fontSize:"16px",fontWeight:"600",color:(e==null?void 0:e.text)||"#fafafa",margin:0},children:n?"Create Automation":u?`Edit: ${(c==null?void 0:c.name)||"Automation"}`:`View: ${(c==null?void 0:c.name)||"Automation"}`}),g&&t.jsx("span",{style:{padding:"4px 8px",backgroundColor:`${(e==null?void 0:e.primary)||"#3b82f6"}20`,color:(e==null?void 0:e.primary)||"#3b82f6",borderRadius:"4px",fontSize:"11px",fontWeight:"600",textTransform:"uppercase"},children:"Default"}),!u&&t.jsx("span",{style:{padding:"4px 8px",backgroundColor:`${(e==null?void 0:e.warning)||"#f59e0b"}20`,color:(e==null?void 0:e.warning)||"#f59e0b",borderRadius:"4px",fontSize:"11px",fontWeight:"600"},children:"Read Only"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[!n&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"13px",color:(e==null?void 0:e.textSecondary)||"#a1a1aa"},children:$.status==="active"?"Active":"Inactive"}),t.jsx("button",{onClick:M,disabled:C.isPending||v.isPending,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:$.status==="active"?(e==null?void 0:e.success)||"#22c55e":(e==null?void 0:e.bgHover)||"#27272a",cursor:"pointer",position:"relative",transition:"background-color 0.2s",opacity:C.isPending||v.isPending?.6:1},children:t.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:$.status==="active"?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})})]}),!u&&t.jsx("button",{onClick:W,disabled:p.isPending,style:{padding:"8px 16px",backgroundColor:(e==null?void 0:e.bgHover)||"#27272a",border:`1px solid ${(e==null?void 0:e.border)||"#3f3f46"}`,borderRadius:"6px",color:(e==null?void 0:e.text)||"#fafafa",cursor:"pointer",fontSize:"13px",fontWeight:"500",opacity:p.isPending?.7:1},children:p.isPending?"Cloning...":"Clone & Edit"}),u&&t.jsx("button",{onClick:()=>j($),disabled:w.isPending||m.isPending,style:{padding:"8px 16px",backgroundColor:(e==null?void 0:e.primary)||"#3b82f6",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",opacity:w.isPending||m.isPending?.7:1},children:w.isPending||m.isPending?"Saving...":n?"Create":"Save Changes"})]})]}),t.jsx("div",{style:{flex:1,overflow:"hidden"},children:t.jsx(Bo,{t:e,automation:$,onUpdate:E,onSave:j,canEdit:u},`${o||"new"}-${(c==null?void 0:c.updated_at)||"new"}`)})]})},qo=void 0,We=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Eo=({status:e,theme:r})=>{const o={Draft:{bg:r.textMuted,text:"#fff"},Scheduled:{bg:r.warning,text:"#fff"},Sending:{bg:r.primary,text:"#fff"},Completed:{bg:r.success,text:"#fff"},Cancelled:{bg:r.danger,text:"#fff"}},a=o[e]||o.Draft;return t.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${a.bg}20`,color:a.bg,borderRadius:"20px",fontSize:"11px",fontWeight:"500"},children:e})},Lo=({template:e,onSave:r,onClose:o,theme:a})=>{const[i,n]=A.useState((e==null?void 0:e.name)||""),[s,l]=A.useState((e==null?void 0:e.subject)||""),[c,d]=A.useState((e==null?void 0:e.body_html)||(e==null?void 0:e.body_text)||""),[k,g]=A.useState((e==null?void 0:e.category)||"general"),[u,w]=A.useState(!1),m=async()=>{w(!0);try{const p=await r({name:i,subject:s,body_html:c,body_text:c.replace(/<[^>]*>/g,""),category:k});o(p)}catch(p){console.error("Failed to save template:",p)}finally{w(!1)}},C=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],v=p=>{d(c+p)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:200},onClick:()=>o(null)}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxWidth:"95vw",maxHeight:"90vh",backgroundColor:a.bgCard,borderRadius:"16px",border:`1px solid ${a.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${a.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:a.text,margin:0},children:e?"Edit Template":"Create New Template"}),t.jsx("button",{onClick:()=>o(null),style:{background:"none",border:"none",color:a.textMuted,cursor:"pointer",fontSize:"20px"},children:""})]}),t.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Template Name"}),t.jsx("input",{type:"text",value:i,onChange:p=>n(p.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Category"}),t.jsxs("select",{value:k,onChange:p=>g(p.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"},children:[t.jsx("option",{value:"general",children:"General"}),t.jsx("option",{value:"welcome",children:"Welcome"}),t.jsx("option",{value:"renewal",children:"Renewal"}),t.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),t.jsx("option",{value:"engagement",children:"Engagement"}),t.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),t.jsx("input",{type:"text",value:s,onChange:p=>l(p.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"}})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:C.map(p=>t.jsx("button",{onClick:()=>v(p.key),style:{padding:"4px 10px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"6px",color:a.textSecondary,cursor:"pointer",fontSize:"11px"},children:p.label},p.key))})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Email Body"}),t.jsx("textarea",{value:c,onChange:p=>d(p.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:10,style:{width:"100%",padding:"12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),t.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${a.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[t.jsx("button",{onClick:()=>o(null),style:{padding:"10px 20px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),t.jsx("button",{onClick:m,disabled:u||!i||!s,style:{padding:"10px 20px",backgroundColor:a.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:u?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:u||!i||!s?.6:1},children:u?"Creating...":"Create & Select"})]})]})]})},Po=({batch:e,onView:r,theme:o})=>{var i;const a=e.total_recipients>0?Math.round(e.emails_sent/e.total_recipients*100):0;return t.jsxs("div",{style:{padding:"16px",backgroundColor:o.bgCard,borderRadius:"10px",border:`1px solid ${o.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"6px"},children:[t.jsx("span",{style:{fontWeight:"600",color:o.text},children:e.name||"Untitled Batch"}),t.jsx(Eo,{status:e.status,theme:o})]}),t.jsx("p",{style:{fontSize:"13px",color:o.textSecondary,margin:0},children:e.subject||"No subject"}),t.jsxs("p",{style:{fontSize:"12px",color:o.textMuted,margin:"4px 0 0"},children:[((i=e.template)==null?void 0:i.name)||"Custom email","  ",e.total_recipients||0," recipients"]})]}),e.status!=="Draft"&&t.jsxs("div",{style:{textAlign:"right",minWidth:"100px"},children:[t.jsxs("div",{style:{fontSize:"18px",fontWeight:"600",color:o.text},children:[a,"%"]}),t.jsxs("div",{style:{fontSize:"11px",color:o.textMuted},children:[e.emails_sent||0," / ",e.total_recipients||0," sent"]})]}),t.jsx("button",{onClick:()=>r(e),style:{padding:"8px 16px",backgroundColor:o.bgHover,border:`1px solid ${o.border}`,borderRadius:"6px",color:o.text,cursor:"pointer",fontSize:"13px"},children:"View"})]})},Oo=({currentStep:e,steps:r,theme:o})=>t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"24px"},children:r.map((a,i)=>t.jsxs(Ce.Fragment,{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:i<=e?o.primary:o.bgHover,color:i<=e?"#fff":o.textMuted,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"13px",fontWeight:"600"},children:i<e?"":i+1}),t.jsx("span",{style:{fontSize:"14px",fontWeight:i===e?"600":"400",color:i<=e?o.text:o.textMuted},children:a})]}),i<r.length-1&&t.jsx("div",{style:{flex:1,height:"2px",backgroundColor:i<e?o.primary:o.border,minWidth:"40px"}})]},a))}),Fo=({selectedTemplate:e,onSelect:r,onCreateNew:o,templates:a,isLoading:i,theme:n})=>{const[s,l]=A.useState(""),c=A.useMemo(()=>a?s?a.filter(d=>d.name.toLowerCase().includes(s.toLowerCase())||d.subject.toLowerCase().includes(s.toLowerCase())):a:[],[a,s]);return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Select an Email Template"}),t.jsxs("button",{onClick:o,style:{padding:"8px 16px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," Create New Template"]})]}),t.jsxs("div",{style:{position:"relative",marginBottom:"16px"},children:[t.jsx("input",{type:"text",placeholder:"Search templates...",value:s,onChange:d=>l(d.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"}}),t.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:n.textMuted},children:""})]}),i?t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"},children:Array.from({length:4}).map((d,k)=>t.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgCard,borderRadius:"10px",border:`1px solid ${n.border}`},children:[t.jsx(We,{width:"120px",height:"16px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(We,{width:"200px",height:"14px"})})]},k))}):t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px",maxHeight:"400px",overflow:"auto"},children:c.map(d=>t.jsxs("div",{onClick:()=>r(d),style:{padding:"16px",backgroundColor:n.bgCard,borderRadius:"10px",border:`2px solid ${(e==null?void 0:e.id)===d.id?n.primary:n.border}`,cursor:"pointer",transition:"border-color 0.15s"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:n.text,marginBottom:"4px"},children:d.name}),t.jsx("div",{style:{fontSize:"13px",color:n.textSecondary},children:d.subject}),t.jsx("div",{style:{marginTop:"8px",padding:"4px 8px",backgroundColor:`${n.primary}15`,color:n.primary,borderRadius:"4px",fontSize:"11px",display:"inline-block",textTransform:"capitalize"},children:d.category||"General"})]},d.id))}),!i&&c.length===0&&t.jsx("div",{style:{textAlign:"center",padding:"40px",color:n.textMuted},children:s?"No templates match your search":"No templates available. Create one to get started!"})]})},Ne=[{value:"account_status",label:"Account Status",type:"select",options:[{value:"customer",label:"Customer"},{value:"prospect",label:"Prospect"},{value:"prior_customer",label:"Prior Customer"},{value:"lead",label:"Lead"}]},{value:"policy_type",label:"Policy Type",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"active_policy_type",label:"Has Active Policy",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"policy_status",label:"Policy Status",type:"select",options:[{value:"active",label:"Active"},{value:"cancelled",label:"Cancelled"},{value:"expired",label:"Expired"}]},{value:"policy_count",label:"Number of Policies",type:"number"},{value:"policy_effective",label:"Policy Effective Date",type:"date"},{value:"policy_expiration",label:"Policy Expiration",type:"date"},{value:"location",label:"Location",type:"location"},{value:"state",label:"State",type:"select",options:[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}]},{value:"city",label:"City",type:"text"},{value:"zip_code",label:"ZIP Code",type:"text"},{value:"email_domain",label:"Email Domain",type:"text"},{value:"last_email_sent",label:"Last Email Sent",type:"date"},{value:"account_created",label:"Account Created",type:"date"}],Ct={select:[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"is_any",label:"is any of"}],number:[{value:"equals",label:"equals"},{value:"greater_than",label:"greater than"},{value:"less_than",label:"less than"},{value:"at_least",label:"at least"},{value:"at_most",label:"at most"},{value:"between",label:"is between"}],date:[{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"between",label:"is between"},{value:"in_next_days",label:"is in the next"},{value:"in_last_days",label:"was in the last"}],location:[{value:"within_radius",label:"is within"}],text:[{value:"contains",label:"contains"},{value:"not_contains",label:"does not contain"},{value:"equals",label:"equals"},{value:"not_equals",label:"does not equal"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"},{value:"is_empty",label:"is empty"},{value:"is_not_empty",label:"is not empty"}]},No=[5,10,15,25,50,100],Ho=(e,r)=>{const a=(Ct[e]||[]).find(i=>i.value===r);return(a==null?void 0:a.label)||r},lt=e=>{const r=Ne.find(n=>n.value===e.field);if(!r)return null;const o=r.label,a=Ho(r.type,e.operator);let i=e.value;if(r.type==="select"&&r.options)if(e.operator==="is_any")i=(e.value||"").split(",").map(s=>{const l=r.options.find(c=>c.value===s);return(l==null?void 0:l.label)||s}).join(", ");else{const n=r.options.find(s=>s.value===e.value);i=(n==null?void 0:n.label)||e.value}return e.operator==="is_empty"||e.operator==="is_not_empty"?`${o} ${a}`:e.operator==="between"&&e.value2?`${o} ${a} ${e.value} and ${e.value2}`:e.operator==="in_next_days"||e.operator==="in_last_days"?`${o} ${a} ${e.value} days`:e.operator==="within_radius"?`${o} within ${e.radius||25} miles of ${e.locationDisplay||"location"}`:`${o} ${a} ${i}`},Go=({recipients:e,filterConfig:r,isLoading:o,onClose:a,theme:i})=>{var C;const[n,s]=A.useState(""),[l,c]=A.useState(1),d=20,k=(r==null?void 0:r.groups)||(((C=r==null?void 0:r.rules)==null?void 0:C.length)>0?[{rules:r.rules}]:[]),g=k.some(v=>{var p;return(p=v.rules)==null?void 0:p.some(M=>M.field&&M.operator)}),u=A.useMemo(()=>{if(!e)return[];if(!n)return e;const v=n.toLowerCase();return e.filter(p=>(p.name||"").toLowerCase().includes(v)||(p.person_email||p.email||"").toLowerCase().includes(v)||(p.primary_contact_first_name||"").toLowerCase().includes(v)||(p.primary_contact_last_name||"").toLowerCase().includes(v))},[e,n]),w=Math.ceil(u.length/d),m=u.slice((l-1)*d,l*d);return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",zIndex:1e3},onClick:a}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"900px",maxWidth:"95vw",maxHeight:"85vh",backgroundColor:i.bgCard,borderRadius:"16px",border:`1px solid ${i.border}`,zIndex:1001,display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${i.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{margin:0,fontSize:"18px",fontWeight:"600",color:i.text},children:"Matching Recipients"}),t.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:i.textSecondary},children:o?"Loading...":`${u.length.toLocaleString()} accounts match your criteria`})]}),t.jsx("button",{onClick:a,style:{background:"none",border:"none",color:i.textMuted,cursor:"pointer",fontSize:"24px",lineHeight:1,padding:"4px"},children:""})]}),g&&t.jsxs("div",{style:{padding:"12px 20px",backgroundColor:i.bgHover,borderBottom:`1px solid ${i.border}`},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:i.textSecondary,marginBottom:"8px",textTransform:"uppercase"},children:"Active Filters"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:k.map((v,p)=>t.jsxs(Ce.Fragment,{children:[p>0&&t.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#f59e0b20",color:"#f59e0b",borderRadius:"4px",fontSize:"11px",fontWeight:"700"},children:"OR"}),(v.rules||[]).filter(M=>M.field&&M.operator).map((M,$)=>t.jsxs(Ce.Fragment,{children:[$>0&&t.jsx("span",{style:{fontSize:"11px",color:i.textMuted,alignSelf:"center"},children:"AND"}),t.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${i.primary}15`,color:i.primary,borderRadius:"4px",fontSize:"12px",fontWeight:"500"},children:lt(M)})]},`${p}-${$}`))]},p))})]}),t.jsx("div",{style:{padding:"12px 20px",borderBottom:`1px solid ${i.border}`},children:t.jsx("input",{type:"text",placeholder:"Search recipients...",value:n,onChange:v=>{s(v.target.value),c(1)},style:{width:"100%",padding:"10px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px"}})}),t.jsx("div",{style:{flex:1,overflow:"auto",padding:"0 20px"},children:o?t.jsx("div",{style:{padding:"40px",textAlign:"center",color:i.textMuted},children:"Loading recipients..."}):m.length===0?t.jsx("div",{style:{padding:"40px",textAlign:"center",color:i.textMuted},children:n?"No recipients match your search":"No recipients found"}):t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{borderBottom:`2px solid ${i.border}`},children:[t.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:i.textSecondary,textTransform:"uppercase"},children:"Name"}),t.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:i.textSecondary,textTransform:"uppercase"},children:"Email"}),t.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:i.textSecondary,textTransform:"uppercase"},children:"Status"}),g&&k.length>0&&t.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:i.textSecondary,textTransform:"uppercase"},children:"Matched Groups"})]})}),t.jsx("tbody",{children:m.map((v,p)=>t.jsxs("tr",{style:{borderBottom:`1px solid ${i.border}`,backgroundColor:p%2===0?"transparent":i.bgHover},children:[t.jsxs("td",{style:{padding:"12px 8px"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:i.text},children:v.primary_contact_first_name?`${v.primary_contact_first_name} ${v.primary_contact_last_name||""}`.trim():v.name||"N/A"}),v.name&&v.primary_contact_first_name&&t.jsx("div",{style:{fontSize:"12px",color:i.textMuted},children:v.name})]}),t.jsx("td",{style:{padding:"12px 8px",fontSize:"13px",color:i.textSecondary},children:v.person_email||v.email||"N/A"}),t.jsx("td",{style:{padding:"12px 8px"},children:t.jsx("span",{style:{padding:"3px 8px",backgroundColor:i.bgHover,color:i.text,borderRadius:"4px",fontSize:"12px",textTransform:"capitalize"},children:v.account_status||"N/A"})}),g&&k.length>0&&t.jsx("td",{style:{padding:"12px 8px"},children:t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[(v._matchedGroups||[]).map(M=>{var $,E;return t.jsxs("span",{style:{padding:"2px 8px",backgroundColor:`${i.success}20`,color:i.success,borderRadius:"4px",fontSize:"11px",fontWeight:"600",display:"inline-flex",alignItems:"center",gap:"4px",cursor:"help"},title:((E=($=k[M])==null?void 0:$.rules)==null?void 0:E.filter(j=>j.field&&j.operator).map(j=>lt(j)).join(" AND "))||`Group ${M+1}`,children:["Group ",M+1,t.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{opacity:.7},children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),t.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})]},M)}),(!v._matchedGroups||v._matchedGroups.length===0)&&t.jsx("span",{style:{fontSize:"11px",color:i.textMuted},children:k.length===0?"No filters":"All"})]})})]},v.account_unique_id||p))})]})}),w>1&&t.jsxs("div",{style:{padding:"12px 20px",borderTop:`1px solid ${i.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{fontSize:"13px",color:i.textSecondary},children:["Showing ",(l-1)*d+1,"-",Math.min(l*d,u.length)," of ",u.length]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("button",{onClick:()=>c(v=>Math.max(1,v-1)),disabled:l===1,style:{padding:"6px 12px",backgroundColor:l===1?i.bgHover:i.bgCard,border:`1px solid ${i.border}`,borderRadius:"6px",color:l===1?i.textMuted:i.text,cursor:l===1?"not-allowed":"pointer",fontSize:"13px"},children:"Previous"}),t.jsxs("span",{style:{padding:"6px 12px",fontSize:"13px",color:i.textSecondary},children:["Page ",l," of ",w]}),t.jsx("button",{onClick:()=>c(v=>Math.min(w,v+1)),disabled:l===w,style:{padding:"6px 12px",backgroundColor:l===w?i.bgHover:i.bgCard,border:`1px solid ${i.border}`,borderRadius:"6px",color:l===w?i.textMuted:i.text,cursor:l===w?"not-allowed":"pointer",fontSize:"13px"},children:"Next"})]})]})]})]})},Uo=({lat:e,lng:r,radiusMiles:o,theme:a})=>{const i=A.useRef(null),n=A.useRef(null),s=A.useRef(null),l=A.useRef(null);A.useEffect(()=>{var k;if((k=window.google)!=null&&k.maps)d();else{const g=document.createElement("script");g.src=`https://maps.googleapis.com/maps/api/js?key=${qo}`,g.async=!0,g.defer=!0,g.onload=()=>d(),document.head.appendChild(g)}function d(){var w;if(!i.current||!((w=window.google)!=null&&w.maps))return;const g={lat:e,lng:r},u=o*1609.34;n.current=new window.google.maps.Map(i.current,{center:g,zoom:c(o),mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,styles:[{featureType:"poi",stylers:[{visibility:"off"}]}]}),s.current=new window.google.maps.Circle({map:n.current,center:g,radius:u,fillColor:a.primary,fillOpacity:.2,strokeColor:a.primary,strokeWeight:2}),l.current=new window.google.maps.Marker({map:n.current,position:g}),n.current.fitBounds(s.current.getBounds())}return()=>{s.current&&s.current.setMap(null),l.current&&l.current.setMap(null)}},[e,r,o,a.primary]);function c(d){return d<=5?12:d<=15?11:d<=25?10:d<=50?9:8}return t.jsx("div",{ref:i,style:{width:"100%",height:"100%"}})},Ko=({location:e,radius:r,onClose:o,theme:a})=>{if(!e)return null;const i=parseFloat(e.lat),n=parseFloat(e.lng);return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",zIndex:1e3},onClick:o}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"600px",maxWidth:"95vw",backgroundColor:a.bgCard,borderRadius:"16px",border:`1px solid ${a.border}`,zIndex:1001,overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${a.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:a.text},children:"Location Radius Preview"}),t.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:a.textSecondary},children:[" ",e.display]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsxs("div",{style:{padding:"6px 12px",backgroundColor:`${a.primary}15`,color:a.primary,borderRadius:"6px",fontWeight:"600",fontSize:"14px"},children:[r," mile radius"]}),t.jsx("button",{onClick:o,style:{background:"none",border:"none",color:a.textMuted,cursor:"pointer",fontSize:"24px",lineHeight:1},children:""})]})]}),t.jsx("div",{style:{height:"400px"},children:t.jsx(Uo,{lat:i,lng:n,radiusMiles:r,theme:a})}),t.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${a.border}`,backgroundColor:a.bgHover,fontSize:"12px",color:a.textSecondary,textAlign:"center"},children:"Recipients within this area will be included in your campaign"})]})]})},Vo=({location:e,radius:r,theme:o})=>{const[a,i]=A.useState(!1);return e?t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{marginTop:"12px",borderRadius:"8px",overflow:"hidden",border:`1px solid ${o.border}`},children:t.jsxs("div",{style:{padding:"12px 16px",backgroundColor:o.bgHover,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{fontSize:"20px"},children:""}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:o.text},children:e.display}),t.jsxs("div",{style:{fontSize:"12px",color:o.textSecondary},children:[r," mile radius"]})]})]}),t.jsx("button",{onClick:()=>i(!0),style:{padding:"8px 16px",backgroundColor:o.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:" View Map"})]})}),a&&t.jsx(Ko,{location:e,radius:r,onClose:()=>i(!1),theme:o})]}):null},Qo=({rule:e,index:r,onUpdate:o,onRemove:a,theme:i})=>{const n=Ne.find(d=>d.value===e.field),s=n?Ct[n.type]:[],l={padding:"8px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.text,fontSize:"13px",minWidth:"140px"},c={padding:"8px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.text,fontSize:"13px",width:"120px"};return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:i.bgCard,borderRadius:"8px",border:`1px solid ${i.border}`,flexWrap:"wrap"},children:[r>0&&t.jsx("span",{style:{fontSize:"12px",color:i.primary,fontWeight:"600",padding:"4px 8px",backgroundColor:`${i.primary}15`,borderRadius:"4px"},children:"AND"}),t.jsxs("select",{value:e.field||"",onChange:d=>o(r,{...e,field:d.target.value,operator:"",value:""}),style:l,children:[t.jsx("option",{value:"",children:"Select field..."}),Ne.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))]}),e.field&&t.jsxs("select",{value:e.operator||"",onChange:d=>o(r,{...e,operator:d.target.value}),style:l,children:[t.jsx("option",{value:"",children:"Select condition..."}),s.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))]}),e.field&&e.operator&&t.jsxs(t.Fragment,{children:[(n==null?void 0:n.type)==="select"&&e.operator!=="is_any"&&t.jsxs("select",{value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),style:l,children:[t.jsx("option",{value:"",children:"Select value..."}),n.options.map(d=>t.jsx("option",{value:d.value,children:d.label},d.value))]}),(n==null?void 0:n.type)==="select"&&e.operator==="is_any"&&t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:n.options.map(d=>t.jsx("button",{onClick:()=>{const k=e.value?e.value.split(","):[],g=k.includes(d.value)?k.filter(u=>u!==d.value):[...k,d.value];o(r,{...e,value:g.join(",")})},style:{padding:"4px 10px",backgroundColor:(e.value||"").split(",").includes(d.value)?i.primary:i.bgHover,color:(e.value||"").split(",").includes(d.value)?"#fff":i.text,border:`1px solid ${(e.value||"").split(",").includes(d.value)?i.primary:i.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:d.label},d.value))}),(n==null?void 0:n.type)==="number"&&e.operator!=="between"&&t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"0",style:c}),(n==null?void 0:n.type)==="number"&&e.operator==="between"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"Min",style:{...c,width:"80px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"and"}),t.jsx("input",{type:"number",value:e.value2||"",onChange:d=>o(r,{...e,value2:d.target.value}),placeholder:"Max",style:{...c,width:"80px"}})]}),(n==null?void 0:n.type)==="date"&&e.operator==="in_next_days"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"30",style:{...c,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&e.operator==="in_last_days"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:"30",style:{...c,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&e.operator==="between"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"date",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),style:c}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"and"}),t.jsx("input",{type:"date",value:e.value2||"",onChange:d=>o(r,{...e,value2:d.target.value}),style:c})]}),(n==null?void 0:n.type)==="date"&&(e.operator==="before"||e.operator==="after")&&t.jsx("input",{type:"date",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),style:c}),(n==null?void 0:n.type)==="text"&&!["is_empty","is_not_empty"].includes(e.operator)&&t.jsx("input",{type:"text",value:e.value||"",onChange:d=>o(r,{...e,value:d.target.value}),placeholder:`Enter ${n.label.toLowerCase()}...`,style:{...c,width:"160px"}}),(n==null?void 0:n.type)==="location"&&t.jsx(Yo,{rule:e,onUpdate:d=>o(r,{...e,...d}),theme:i})]}),t.jsx("button",{onClick:()=>a(r),style:{marginLeft:"auto",padding:"6px 10px",backgroundColor:"transparent",border:"none",color:i.textMuted,cursor:"pointer",fontSize:"16px",borderRadius:"4px"},title:"Remove filter",children:""})]})},Yo=({rule:e,onUpdate:r,theme:o})=>{const[a,i]=A.useState(e.locationDisplay||""),[n,s]=A.useState(!1),[l,c]=A.useState([]),[d,k]=A.useState(!1),g={padding:"8px 12px",backgroundColor:o.bgInput,border:`1px solid ${o.border}`,borderRadius:"6px",color:o.text,fontSize:"13px"},u=async m=>{if(m.length<3){c([]);return}s(!0);try{const v=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&q=${encodeURIComponent(m)}&limit=5`,{headers:{"Accept-Language":"en"}})).json();c(v.map(p=>({display:p.display_name,lat:p.lat,lng:p.lon,type:p.type}))),k(!0)}catch(C){console.error("Geocoding error:",C),c([])}finally{s(!1)}};Ce.useEffect(()=>{const m=setTimeout(()=>{a&&a!==e.locationDisplay&&u(a)},300);return()=>clearTimeout(m)},[a]);const w=m=>{i(m.display.split(",").slice(0,2).join(",")),r({value:`${m.lat},${m.lng}`,locationDisplay:m.display.split(",").slice(0,2).join(","),locationData:m}),k(!1)};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",flex:1,minWidth:"300px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[t.jsxs("div",{style:{position:"relative",flex:1,minWidth:"200px"},children:[t.jsx("input",{type:"text",value:a,onChange:m=>i(m.target.value),onFocus:()=>l.length>0&&k(!0),placeholder:"Enter zip code, city, or address...",style:{...g,width:"100%",paddingRight:"30px"}}),n&&t.jsx("span",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:o.textMuted,fontSize:"12px"},children:"..."}),d&&l.length>0&&t.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:o.bgCard,border:`1px solid ${o.border}`,borderRadius:"6px",marginTop:"4px",zIndex:100,maxHeight:"200px",overflow:"auto",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:l.map((m,C)=>t.jsxs("button",{onClick:()=>w(m),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderBottom:C<l.length-1?`1px solid ${o.border}`:"none",color:o.text,fontSize:"12px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"flex-start",gap:"8px"},onMouseEnter:v=>v.target.style.backgroundColor=o.bgHover,onMouseLeave:v=>v.target.style.backgroundColor="transparent",children:[t.jsx("span",{children:""}),t.jsx("span",{style:{lineHeight:"1.4"},children:m.display})]},C))})]}),t.jsx("span",{style:{fontSize:"13px",color:o.textSecondary},children:"of"}),t.jsx("select",{value:e.radius||"25",onChange:m=>r({radius:m.target.value}),style:{...g,minWidth:"100px"},children:No.map(m=>t.jsxs("option",{value:m,children:[m," miles"]},m))})]}),e.locationData&&t.jsx(Vo,{location:e.locationData,radius:parseInt(e.radius||"25",10),theme:o})]})},Xo=({breakdown:e,isLoading:r,theme:o})=>{const[a,i]=A.useState(!1);return r?t.jsx("div",{style:{padding:"12px 16px",backgroundColor:o.bgHover,borderRadius:"8px",marginTop:"12px",fontSize:"13px",color:o.textSecondary},children:"Loading location data..."}):!e||e.byCity.length===0?null:t.jsxs("div",{style:{marginTop:"12px",backgroundColor:o.bgCard,borderRadius:"8px",border:`1px solid ${o.border}`,overflow:"hidden"},children:[t.jsxs("button",{onClick:()=>i(!a),style:{width:"100%",padding:"12px 16px",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",color:o.text},children:[t.jsx("span",{style:{fontSize:"13px",fontWeight:"500"},children:" View Recipients by City"}),t.jsx("span",{style:{fontSize:"12px",color:o.textSecondary},children:a?"":""})]}),a&&t.jsx("div",{style:{padding:"0 16px 16px"},children:t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:e.byCity.map(({city:n,count:s})=>t.jsxs("div",{style:{padding:"6px 10px",backgroundColor:o.bgHover,borderRadius:"6px",fontSize:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{style:{color:o.text},children:n}),t.jsx("span",{style:{backgroundColor:o.primary,color:"#fff",padding:"2px 6px",borderRadius:"10px",fontSize:"11px",fontWeight:"600"},children:s})]},n))})})]})},Zo=({group:e,groupIndex:r,onUpdateGroup:o,onRemoveGroup:a,onAddRule:i,onUpdateRule:n,onRemoveRule:s,showOrLabel:l,theme:c})=>{const d=e.rules||[];return t.jsxs("div",{style:{padding:"16px",backgroundColor:c.bgCard,borderRadius:"12px",border:`2px solid ${c.border}`,position:"relative"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[t.jsxs("span",{style:{fontSize:"12px",fontWeight:"600",color:c.textSecondary,textTransform:"uppercase",letterSpacing:"0.5px"},children:["Group ",r+1]}),t.jsx("button",{onClick:()=>a(r),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:c.textMuted,cursor:"pointer",fontSize:"12px",borderRadius:"4px"},title:"Remove group",children:"Remove Group"})]}),d.length===0?t.jsx("div",{style:{textAlign:"center",padding:"12px",color:c.textMuted,fontSize:"13px"},children:"Add filters to this group"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:d.map((k,g)=>t.jsx(Qo,{rule:k,index:g,onUpdate:(u,w)=>n(r,u,w),onRemove:u=>s(r,u),theme:c},g))}),t.jsxs("button",{onClick:()=>i(r),style:{width:"100%",padding:"8px",backgroundColor:c.bgHover,border:`1px dashed ${c.border}`,borderRadius:"6px",color:c.primary,cursor:"pointer",fontSize:"12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[t.jsx("span",{children:"+"})," Add Filter to Group"]})]})},Jo=({filterConfig:e,setFilterConfig:r,recipientCount:o,isLoading:a,isFetching:i,locationBreakdown:n,isLoadingBreakdown:s,includeRoleAccounts:l,setIncludeRoleAccounts:c,roleUserCount:d,previewRecipients:k,isLoadingPreview:g,theme:u})=>{var V;const[w,m]=A.useState(!1),C=e.groups||(((V=e.rules)==null?void 0:V.length)>0?[{rules:e.rules}]:[]),v=C.length>0,p=()=>{const F=[...C,{rules:[{field:"",operator:"",value:""}]}];r({...e,groups:F,rules:void 0})},M=F=>{const N=C.filter((L,G)=>G!==F);r({...e,groups:N,rules:void 0})},$=F=>{const N=[...C];N[F]={...N[F],rules:[...N[F].rules||[],{field:"",operator:"",value:""}]},r({...e,groups:N,rules:void 0})},E=(F,N,L)=>{const G=[...C],I=[...G[F].rules||[]];I[N]=L,G[F]={...G[F],rules:I},r({...e,groups:G,rules:void 0})},j=(F,N)=>{const L=[...C];L[F]={...L[F],rules:L[F].rules.filter((G,I)=>I!==N)},L[F].rules.length===0&&L.splice(F,1),r({...e,groups:L,rules:void 0})},W=()=>{r({...e,groups:[],rules:void 0,search:""})},O=C.reduce((F,N)=>F+(N.rules||[]).filter(L=>L.field&&L.operator&&(L.value||["is_empty","is_not_empty"].includes(L.operator))).length,0);return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:u.text,margin:0},children:"Filter Recipients"}),(v||e.search)&&t.jsx("button",{onClick:W,style:{padding:"6px 12px",backgroundColor:"transparent",border:`1px solid ${u.border}`,borderRadius:"6px",color:u.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Clear all"})]}),t.jsxs("div",{style:{padding:"16px",backgroundColor:u.bgCard,borderRadius:"12px",border:`1px solid ${u.border}`,marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:u.textSecondary,marginBottom:"10px"},children:"Quick Filters"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[{label:"Renewals (30 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"30"}},{label:"New Customers (90 days)",filter:{field:"account_created",operator:"in_last_days",value:"90"}},{label:"Not Emailed (30 days)",filter:{field:"last_email_sent",operator:"before",value:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0]}},{label:"Active Customers",filter:{field:"account_status",operator:"is",value:"customer"}},{label:"Cross-Sell: Auto Only",filters:[{field:"active_policy_type",operator:"is",value:"Auto"},{field:"active_policy_type",operator:"is_not",value:"Home"}]},{label:"Cross-Sell: Home Only",filters:[{field:"active_policy_type",operator:"is",value:"Home"},{field:"active_policy_type",operator:"is_not",value:"Auto"}]},{label:"Prior Customers (90 days)",filters:[{field:"account_status",operator:"is",value:"prior_customer"},{field:"last_email_sent",operator:"before",value:new Date(Date.now()-90*24*60*60*1e3).toISOString().split("T")[0]}]},{label:"Prospects (90 days)",filters:[{field:"account_status",operator:"is",value:"prospect"},{field:"last_email_sent",operator:"before",value:new Date(Date.now()-90*24*60*60*1e3).toISOString().split("T")[0]}]}].map((F,N)=>t.jsxs("button",{onClick:()=>{if(F.filters){const L={rules:F.filters};r({...e,groups:[...C,L],rules:void 0})}else{const L={rules:[F.filter]};r({...e,groups:[...C,L],rules:void 0})}},style:{padding:"6px 12px",backgroundColor:u.bgHover,border:`1px solid ${u.border}`,borderRadius:"16px",color:u.text,cursor:"pointer",fontSize:"12px",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:L=>{L.target.style.backgroundColor=u.primary+"20",L.target.style.borderColor=u.primary,L.target.style.color=u.primary},onMouseLeave:L=>{L.target.style.backgroundColor=u.bgHover,L.target.style.borderColor=u.border,L.target.style.color=u.text},children:["+ ",F.label]},N))})]}),t.jsx("div",{style:{padding:"16px",backgroundColor:u.bgCard,borderRadius:"12px",border:`1px solid ${u.border}`,marginBottom:"16px",display:"flex",alignItems:"center",gap:"12px"},children:t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",flex:1},children:[t.jsx("input",{type:"checkbox",checked:l,onChange:F=>c(F.target.checked),style:{width:"18px",height:"18px",cursor:"pointer",accentColor:u.primary}}),t.jsxs("div",{children:[t.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:u.text},children:"Include accounts from users in my role"}),t.jsx("p",{style:{fontSize:"12px",color:u.textSecondary,margin:"2px 0 0"},children:l&&d>1?`Includes accounts from ${d} users with the same role`:"When enabled, includes accounts from all users with the same role as you"})]})]})}),t.jsxs("div",{style:{padding:"16px",backgroundColor:u.bgHover,borderRadius:"12px",marginBottom:"16px"},children:[v?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},children:C.map((F,N)=>t.jsxs("div",{children:[N>0&&t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"8px 0",gap:"12px"},children:[t.jsx("div",{style:{flex:1,height:"1px",backgroundColor:u.border}}),t.jsx("span",{style:{fontSize:"12px",fontWeight:"700",color:"#f59e0b",padding:"4px 12px",backgroundColor:"#f59e0b20",borderRadius:"4px",textTransform:"uppercase",letterSpacing:"1px"},children:"OR"}),t.jsx("div",{style:{flex:1,height:"1px",backgroundColor:u.border}})]}),t.jsx(Zo,{group:F,groupIndex:N,onRemoveGroup:M,onAddRule:$,onUpdateRule:E,onRemoveRule:j,showOrLabel:N>0,theme:u})]},N))}):t.jsx("div",{style:{textAlign:"center",padding:"20px",color:u.textMuted,fontSize:"14px"},children:"No filters applied. All accounts with valid emails will be included."}),t.jsx("div",{style:{display:"flex",gap:"8px"},children:t.jsxs("button",{onClick:p,style:{flex:1,padding:"10px",backgroundColor:u.bgCard,border:`1px dashed ${u.border}`,borderRadius:"8px",color:u.primary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," ",v?"Add OR Group":"Add Filter Group"]})})]}),O>0&&t.jsxs("div",{style:{padding:"12px 16px",backgroundColor:`${u.primary}10`,borderRadius:"8px",marginBottom:"16px",fontSize:"13px",color:u.text},children:[t.jsx("strong",{children:O})," filter",O!==1?"s":""," in ",t.jsx("strong",{children:C.length})," group",C.length!==1?"s":"",C.length>1&&t.jsx("span",{style:{color:u.textSecondary},children:" (groups combined with OR)"}),t.jsx("span",{style:{color:u.textSecondary},children:"  results update automatically"})]}),t.jsxs("button",{onClick:()=>m(!0),disabled:a||o===0,style:{width:"100%",padding:"20px",backgroundColor:`${u.primary}10`,borderRadius:"12px",border:`1px solid ${u.primary}30`,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:a||o===0?"default":"pointer",textAlign:"left",transition:"all 0.2s"},onMouseEnter:F=>{!a&&o>0&&(F.currentTarget.style.backgroundColor=`${u.primary}18`,F.currentTarget.style.borderColor=`${u.primary}50`)},onMouseLeave:F=>{F.currentTarget.style.backgroundColor=`${u.primary}10`,F.currentTarget.style.borderColor=`${u.primary}30`},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:u.text},children:"Matching Recipients"}),t.jsx("div",{style:{fontSize:"12px",color:u.textSecondary},children:i&&o!==void 0?"Updating count...":o>0?"Click to view matching accounts":"Accounts with valid emails who haven't opted out"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:u.primary,opacity:i?.6:1,transition:"opacity 0.2s"},children:a?"...":(o??0).toLocaleString()}),!a&&o>0&&t.jsx("div",{style:{padding:"6px 10px",backgroundColor:u.primary,color:"#fff",borderRadius:"6px",fontSize:"12px",fontWeight:"500"},children:"View"})]})]}),t.jsx(Xo,{breakdown:n,isLoading:s,theme:u}),w&&t.jsx(Go,{recipients:k,filterConfig:e,isLoading:g,onClose:()=>m(!1),theme:u})]})},er=({template:e,filterConfig:r,subject:o,setSubject:a,name:i,setName:n,recipients:s,isLoadingRecipients:l,theme:c})=>t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:c.text,marginBottom:"16px"},children:"Review & Send"}),t.jsxs("div",{style:{padding:"20px",backgroundColor:c.bgCard,borderRadius:"12px",border:`1px solid ${c.border}`,marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:c.text,display:"block",marginBottom:"6px"},children:"Campaign Name"}),t.jsx("input",{type:"text",placeholder:"e.g., December Newsletter",value:i,onChange:d=>n(d.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:c.bgInput,border:`1px solid ${c.border}`,borderRadius:"8px",color:c.text,fontSize:"14px"}})]}),t.jsxs("div",{style:{padding:"20px",backgroundColor:c.bgCard,borderRadius:"12px",border:`1px solid ${c.border}`,marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:c.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),t.jsx("input",{type:"text",placeholder:"Email subject...",value:o,onChange:d=>a(d.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:c.bgInput,border:`1px solid ${c.border}`,borderRadius:"8px",color:c.text,fontSize:"14px"}}),t.jsxs("p",{style:{fontSize:"12px",color:c.textMuted,marginTop:"6px"},children:["Use merge fields like ","{{first_name}}"," for personalization"]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[t.jsxs("div",{style:{padding:"16px",backgroundColor:c.bgCard,borderRadius:"12px",border:`1px solid ${c.border}`},children:[t.jsx("div",{style:{fontSize:"12px",color:c.textMuted,marginBottom:"4px"},children:"Template"}),t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:c.text},children:e==null?void 0:e.name})]}),t.jsxs("div",{style:{padding:"16px",backgroundColor:c.bgCard,borderRadius:"12px",border:`1px solid ${c.border}`},children:[t.jsx("div",{style:{fontSize:"12px",color:c.textMuted,marginBottom:"4px"},children:"Recipients"}),t.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:c.text},children:[l?"...":((s==null?void 0:s.length)||0).toLocaleString()," accounts"]})]})]}),s&&s.length>0&&t.jsxs("div",{style:{padding:"16px",backgroundColor:c.bgCard,borderRadius:"12px",border:`1px solid ${c.border}`},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:c.text,marginBottom:"12px"},children:"Preview Recipients (first 10)"}),t.jsx("div",{style:{maxHeight:"200px",overflow:"auto"},children:s.slice(0,10).map((d,k)=>t.jsxs("div",{style:{padding:"8px 0",borderBottom:k<Math.min(9,s.length-1)?`1px solid ${c.border}`:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",color:c.text},children:d.primary_contact_first_name?`${d.primary_contact_first_name} ${d.primary_contact_last_name||""}`:d.name}),t.jsx("div",{style:{fontSize:"12px",color:c.textMuted},children:d.person_email||d.email})]}),t.jsx("span",{style:{padding:"2px 8px",backgroundColor:c.bgHover,color:c.textSecondary,borderRadius:"4px",fontSize:"11px",textTransform:"capitalize"},children:d.account_status})]},d.account_unique_id))}),s.length>10&&t.jsxs("div",{style:{fontSize:"12px",color:c.textMuted,marginTop:"8px",textAlign:"center"},children:["+",s.length-10," more recipients"]})]})]}),tr=({t:e})=>{const{userId:r}=ee(),[o,a]=A.useState(!1),[i,n]=A.useState(!1),[s,l]=A.useState(0),[c,d]=A.useState(null),[k,g]=A.useState({rules:[],search:"",notOptedOut:!0}),[u,w]=A.useState(!1),[m,C]=A.useState(""),[v,p]=A.useState(""),[M,$]=A.useState(!1),[E,j]=A.useState(null),[W,O]=A.useState(null),{data:V,isLoading:F,refetch:N}=Ge(),{data:L,isLoading:G,refetch:I}=to(),{data:H}=vt(u),{data:P,isLoading:T,isFetching:x}=jt(s>=1?k:null,u),{data:D,isLoading:U}=oo(s>=1?k:null,u),{data:oe,isLoading:te}=Oe(s>=1?k:null,{limit:500}),{data:z,isLoading:S}=Oe(s===2?k:null,{limit:100}),{createBatch:h,scheduleBatch:_}=ro(),{createTemplate:b}=pt(),R=["Select Template","Filter Recipients","Review & Send"],be=J=>{d(J),C(J.subject||"")},ve=async J=>{const ce=await b.mutateAsync(J);return await N(),ce},Y=J=>{n(!1),J&&(d(J),C(J.subject||""))},Re=()=>{s<2&&l(s+1)},$e=()=>{s>0&&l(s-1)},De=async()=>{if(!(!c||!m)){$(!0),j(null);try{const J=await h.mutateAsync({name:v||`Mass Email - ${new Date().toLocaleDateString()}`,subject:m,template_id:c.id,filter_config:k,total_recipients:P||0});await _.mutateAsync({batchId:J.id}),O(`Successfully scheduled ${P} emails for sending!`),a(!1),_e(),I()}catch(J){j(J.message||"Failed to send mass email")}finally{$(!1)}}},_e=()=>{l(0),d(null),g({rules:[],search:"",notOptedOut:!0}),w(!1),C(""),p("")},ie=()=>s===0?!!c:s===1?(P||0)>0:s===2?!!m&&!!v:!1;return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Mass Email"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Send one-off emails to filtered recipients"})]}),!o&&t.jsxs("button",{onClick:()=>a(!0),style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," New Campaign"]})]}),W&&t.jsxs("div",{style:{padding:"16px",backgroundColor:`${e.success}15`,border:`1px solid ${e.success}30`,borderRadius:"8px",marginBottom:"24px",color:e.success,fontSize:"14px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[W,t.jsx("button",{onClick:()=>O(null),style:{background:"none",border:"none",color:e.success,cursor:"pointer"},children:""})]}),o?t.jsxs("div",{style:{backgroundColor:e.bgCard,borderRadius:"16px",border:`1px solid ${e.border}`,padding:"24px"},children:[t.jsx(Oo,{currentStep:s,steps:R,theme:e}),E&&t.jsx("div",{style:{padding:"12px 16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"16px",color:e.danger,fontSize:"14px"},children:E}),t.jsxs("div",{style:{minHeight:"300px"},children:[s===0&&t.jsx(Fo,{selectedTemplate:c,onSelect:be,onCreateNew:()=>n(!0),templates:V,isLoading:F,theme:e}),s===1&&t.jsx(Jo,{filterConfig:k,setFilterConfig:g,recipientCount:P,isLoading:T,isFetching:x,locationBreakdown:D,isLoadingBreakdown:U,includeRoleAccounts:u,setIncludeRoleAccounts:w,roleUserCount:(H==null?void 0:H.length)||1,previewRecipients:oe,isLoadingPreview:te,theme:e}),s===2&&t.jsx(er,{template:c,filterConfig:k,subject:m,setSubject:C,name:v,setName:p,recipients:z,isLoadingRecipients:S,theme:e})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"24px",borderTop:`1px solid ${e.border}`,marginTop:"24px"},children:[t.jsx("button",{onClick:()=>{s===0?(a(!1),_e()):$e()},style:{padding:"10px 20px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,cursor:"pointer",fontSize:"14px"},children:s===0?"Cancel":"Back"}),s<2?t.jsx("button",{onClick:Re,disabled:!ie(),style:{padding:"10px 24px",backgroundColor:ie()?e.primary:e.bgHover,border:"none",borderRadius:"8px",color:ie()?"#fff":e.textMuted,cursor:ie()?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500"},children:"Continue"}):t.jsx("button",{onClick:De,disabled:!ie()||M,style:{padding:"10px 24px",backgroundColor:ie()&&!M?e.success:e.bgHover,border:"none",borderRadius:"8px",color:ie()&&!M?"#fff":e.textMuted,cursor:ie()&&!M?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px"},children:M?"Sending...":"Send Emails"})]})]}):t.jsx(t.Fragment,{children:t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Recent Campaigns"}),G?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:Array.from({length:3}).map((J,ce)=>t.jsxs("div",{style:{padding:"16px",backgroundColor:e.bgCard,borderRadius:"10px",border:`1px solid ${e.border}`},children:[t.jsx(We,{width:"200px",height:"18px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(We,{width:"300px",height:"14px"})})]},ce))}):L&&L.length>0?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:L.map(J=>t.jsx(Po,{batch:J,onView:ce=>console.log("View batch:",ce),theme:e},J.id))}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:"No campaigns yet"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:"Create your first mass email campaign to reach your clients."}),t.jsx("button",{onClick:()=>a(!0),style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Campaign"})]})]})}),i&&t.jsx(Lo,{template:null,onSave:ve,onClose:Y,theme:e})]})},or=A.createContext(),Le={light:{bg:"#f8fafc",bgCard:"#ffffff",bgSidebar:"#ffffff",bgHover:"#f1f5f9",bgInput:"#ffffff",border:"#e2e8f0",borderLight:"#f1f5f9",text:"#1e293b",textSecondary:"#64748b",textMuted:"#94a3b8",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},dark:{bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"}},rr=A.createContext(),nr=()=>{const{userId:e}=ee(),r=dt();fe();const[o,a]=A.useState(!1),{data:i}=Z({queryKey:["currentUser",e],queryFn:()=>pe.getCurrentUser(e),enabled:!!e}),[n,s]=A.useState({id:e,name:"",email:"",org:""});A.useEffect(()=>{i&&s({id:e,name:`${i.first_name||""} ${i.last_name||""}`.trim()||"Unknown User",email:i.email||"",org:i.profile_name||""})},[i,e]);const l=o?Le.dark:Le.light,d=(()=>{const g=r.pathname.split("/").slice(2).join("/");return g.startsWith("automations/")?"automations":g.startsWith("accounts/")?"accounts":g||"dashboard"})(),k=[{id:"dashboard",label:"Dashboard",icon:"",path:`/${e}/dashboard`},{id:"automations",label:"Automations",icon:"",path:`/${e}/automations`},{id:"templates",label:"Templates",icon:"",path:`/${e}/templates`},{id:"mass-email",label:"Mass Email",icon:"",path:`/${e}/mass-email`},{id:"accounts",label:"Accounts",icon:"",path:`/${e}/accounts`},{id:"settings",label:"Settings",icon:"",path:`/${e}/settings`}];return t.jsx(or.Provider,{value:{isDark:o,setIsDark:a,t:l,themes:Le},children:t.jsx(rr.Provider,{value:{userId:e,currentUser:n,setCurrentUser:s},children:t.jsxs("div",{style:{fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",backgroundColor:l.bg,minHeight:"100vh",display:"flex",color:l.text},children:[t.jsxs("div",{style:{width:"220px",backgroundColor:l.bgSidebar,borderRight:`1px solid ${l.border}`,display:"flex",flexDirection:"column",position:"fixed",top:0,left:0,bottom:0},children:[t.jsx("div",{style:{padding:"20px 16px",borderBottom:`1px solid ${l.border}`},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:l.primary,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"18px"},children:""}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"700",fontSize:"14px",color:l.text},children:"Email Automation"}),t.jsx("div",{style:{fontSize:"11px",color:l.textMuted},children:"Marketing System"})]})]})}),t.jsxs("div",{style:{flex:1,padding:"12px 8px"},children:[t.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:l.textMuted,padding:"8px 12px",textTransform:"uppercase"},children:"Navigation"}),k.map(g=>t.jsxs(he,{to:g.path,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:d===g.id?`${l.primary}15`:"transparent",border:"none",borderRadius:"8px",color:d===g.id?l.primary:l.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:d===g.id?"600":"400",textAlign:"left",alignItems:"center",gap:"10px",marginBottom:"2px",textDecoration:"none"},children:[t.jsx("span",{children:g.icon})," ",g.label]},g.id)),t.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:l.textMuted,padding:"16px 12px 8px",textTransform:"uppercase"},children:"Admin"}),t.jsxs(he,{to:`/${e}/timeline`,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:d==="timeline"?`${l.primary}15`:"transparent",border:"none",borderRadius:"8px",color:d==="timeline"?l.primary:l.textSecondary,cursor:"pointer",fontSize:"13px",textAlign:"left",alignItems:"center",gap:"10px",textDecoration:"none"},children:[t.jsx("span",{children:""})," Timeline",t.jsx("span",{style:{marginLeft:"auto",padding:"2px 8px",backgroundColor:l.bgHover,borderRadius:"4px",fontSize:"10px",color:l.textMuted},children:"Admin"})]})]}),t.jsxs("div",{style:{padding:"16px",borderTop:`1px solid ${l.border}`,display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:l.bgHover,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:""}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:l.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.name}),t.jsx("div",{style:{fontSize:"11px",color:l.textMuted,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.email})]}),t.jsx(he,{to:`/${e}/settings`,style:{color:l.textMuted,fontSize:"16px",textDecoration:"none"},children:""})]})]}),t.jsxs("div",{style:{flex:1,marginLeft:"220px"},children:[t.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${l.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:l.bgCard},children:[t.jsxs("div",{style:{fontSize:"11px",color:l.textMuted},children:["User: ",e==null?void 0:e.substring(0,8),"..."]}),t.jsx("button",{onClick:()=>a(!o),style:{padding:"8px 12px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:o?" Light":" Dark"})]}),t.jsx("div",{style:{padding:"24px"},children:t.jsxs(ct,{children:[t.jsx(re,{path:"dashboard",element:t.jsx(nt,{t:l})}),t.jsx(re,{path:"automations",element:t.jsx(xo,{t:l})}),t.jsx(re,{path:"automations/new",element:t.jsx(st,{t:l})}),t.jsx(re,{path:"automations/:automationId",element:t.jsx(st,{t:l})}),t.jsx(re,{path:"templates",element:t.jsx(ho,{t:l})}),t.jsx(re,{path:"mass-email",element:t.jsx(tr,{t:l})}),t.jsx(re,{path:"accounts",element:t.jsx(vo,{t:l})}),t.jsx(re,{path:"accounts/:accountId",element:t.jsx(wo,{t:l})}),t.jsx(re,{path:"settings",element:t.jsx(zo,{t:l})}),t.jsx(re,{path:"timeline",element:t.jsx(ar,{t:l})}),t.jsx(re,{path:"*",element:t.jsx(nt,{t:l})})]})})]})]})})})},ar=({t:e})=>t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Activity Timeline"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px"},children:"View all email activity across your organization"}),t.jsxs("div",{style:{marginTop:"24px",padding:"60px",textAlign:"center",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),t.jsx("p",{style:{color:e.textMuted},children:"Timeline view coming soon..."})]})]}),ir=()=>{const e=fe();return A.useEffect(()=>{e("/0056g000004jvyVAAQ/dashboard")},[e]),t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"'Inter', sans-serif"},children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"16px"},children:""}),t.jsx("div",{children:"Loading..."})]})})},sr=()=>t.jsxs(zt,{client:It,children:[t.jsx($t,{children:t.jsxs(ct,{children:[t.jsx(re,{path:"/",element:t.jsx(ir,{})}),t.jsx(re,{path:"/:userId/*",element:t.jsx(nr,{})})]})}),t.jsx(At,{initialIsOpen:!1})]});Pe.createRoot(document.getElementById("root")).render(t.jsx(Ce.StrictMode,{children:t.jsx(sr,{})}));
