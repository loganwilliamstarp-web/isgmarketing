const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DashboardPage-ZxuNp-cV.js","assets/query-BgC-0ePs.js","assets/vendor-CvdBrt7H.js","assets/useDashboard-CXzg9wgv.js","assets/useEffectiveOwner-BN9vJCNM.js","assets/accounts-BqGB46ES.js","assets/supabase-GtAdROLV.js","assets/AutomationsPage-C2gGHSn1.js","assets/useAutomations-DUarEmo4.js","assets/massEmails-cdFsY1gu.js","assets/useSenderDomains-BmYMCls7.js","assets/senderDomains-D32G31A3.js","assets/TemplatesPage-BByafKMh.js","assets/useTemplates-BV1KRl1Y.js","assets/ClientsPage-SrX-tLSi.js","assets/useAccounts-OopLnqh2.js","assets/ClientProfilePage-CHV3gSsR.js","assets/SettingsPage-QdR4vW0v.js","assets/SettingsPage-D-Ncpkvi.css","assets/WorkflowBuilderPage-CTsnhRAY.js","assets/useMassEmails-dmaXbuhX.js","assets/MassEmailPage-BFY5eIbJ.js","assets/KnowledgeCenterPage-D6sBsZL2.js"])))=>i.map(i=>d[i]);
import{Q as ce,j as t,a as de,u as ue}from"./query-BgC-0ePs.js";import{a as fe,r as c,u as F,b as pe,c as te,N as me,B as ge,R as re,d as U,e as xe,L as G,f as ne}from"./vendor-CvdBrt7H.js";import{c as he}from"./supabase-GtAdROLV.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var J={},Q=fe;J.createRoot=Q.createRoot,J.hydrateRoot=Q.hydrateRoot;const ye="modulepreload",_e=function(e){return"/"+e},Z={},O=function(r,n,s){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),u=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));o=Promise.allSettled(n.map(m=>{if(m=_e(m),m in Z)return;Z[m]=!0;const h=m.endsWith(".css"),_=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${_}`))return;const b=document.createElement("link");if(b.rel=h?"stylesheet":ye,h||(b.as="script"),b.crossOrigin="",b.href=m,u&&b.setAttribute("nonce",u),document.head.appendChild(b),h)return new Promise((a,g)=>{b.addEventListener("load",a),b.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${m}`)))})}))}function i(d){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=d,window.dispatchEvent(u),!u.defaultPrevented)throw d}return o.then(d=>{for(const u of d||[])u.status==="rejected"&&i(u.reason);return r().catch(i)})};var be=function(){return null};const ve=new ce({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*30,retry:1,refetchOnWindowFocus:!0,refetchOnMount:!0},mutations:{retry:0}}}),we=void 0,Se=void 0;throw new Error("Missing Supabase environment variables");const f=he(we,Se),je={async get(e){const{data:r,error:n}=await f.from("user_settings").select("*").eq("user_id",e).single();if(n&&n.code!=="PGRST116")throw n;return r},async getWithUser(e){const{data:r,error:n}=await f.from("user_settings").select(`
        *,
        user:users(user_unique_id, email, first_name, last_name, role_name, profile_name)
      `).eq("user_id",e).single();if(n&&n.code!=="PGRST116")throw n;return r},async create(e,r={}){const{data:n,error:s}=await f.from("user_settings").insert({user_id:e,...r}).select().single();if(s)throw s;return n},async update(e,r){const{data:n,error:s}=await f.from("user_settings").update({...r,updated_at:new Date().toISOString()}).eq("user_id",e).select().single();if(s)throw s;return n},async updateSignature(e,r){const{signature_html:n}=r;return this.update(e,{signature_html:n})},async updateAgencyInfo(e,r){const{agencyName:n,agencyAddress:s,agencyPhone:o,agencyWebsite:i}=r;return this.update(e,{agency_name:n,agency_address:s,agency_phone:o,agency_website:i})},async updateAgencyInfoByProfile(e,r){const{agency_name:n,agency_address:s,agency_phone:o,agency_website:i}=r,{data:d,error:u}=await f.from("users").select("user_unique_id").eq("profile_name",e);if(u)throw u;if(!d||d.length===0)return null;const m=d.map(b=>b.user_unique_id),{data:h,error:_}=await f.from("user_settings").update({agency_name:n,agency_address:s,agency_phone:o,agency_website:i,updated_at:new Date().toISOString()}).in("user_id",m).select();if(_)throw _;return h},async updateEmailSettings(e,r){const{fromName:n,fromEmail:s,replyToEmail:o,defaultSendTime:i,timezone:d,dailySendLimit:u}=r;return this.update(e,{from_name:n,from_email:s,reply_to_email:o,default_send_time:i,timezone:d,daily_send_limit:u})},async updatePreferences(e,r){const n=await this.get(e);return this.update(e,{preferences:{...n==null?void 0:n.preferences,...r}})},async getCurrentUser(e){const{data:r,error:n}=await f.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name").eq("user_unique_id",e).single();if(n&&n.code!=="PGRST116")throw n;return r},async getUserIdsByRole(e){const r=await this.getCurrentUser(e);if(!(r!=null&&r.role_name))return[e];const{data:n,error:s}=await f.from("users").select("user_unique_id").eq("role_name",r.role_name);if(s)throw s;return(n==null?void 0:n.map(o=>o.user_unique_id))||[e]},async getSignatureHtml(e){const r=await this.get(e);return r&&r.signature_html?`<div style="margin-top: 20px; font-family: Arial, sans-serif;">${r.signature_html}</div>`:""},async getUnsubscribeFooterHtml(e,r,n=null){const s=await this.get(e),o="https://your-app.com",i=`${o}/unsubscribe?type=automation&id=${r}&aid=${n}`,d=`${o}/unsubscribe?type=all&id=${r}`;let u=`
      <table style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; width: 100%; font-family: Arial, sans-serif;">
        <tr>
          <td style="text-align: center; font-size: 12px; color: #666;">
    `;return n&&(u+=`<a href="${i}" style="color: #666;">Unsubscribe from these emails</a> &nbsp;|&nbsp; `),u+=`<a href="${d}" style="color: #666;">Unsubscribe from all emails</a>`,(s!=null&&s.agency_name||s!=null&&s.agency_address)&&(u+="<br><br>",s.agency_name&&(u+=s.agency_name),s.agency_address&&(u+=` | ${s.agency_address}`)),u+=`
          </td>
        </tr>
      </table>
    `,u}},B={async isAdmin(e){const{data:r,error:n}=await f.from("admin_users").select("id").eq("user_id",e).single();if(n&&n.code!=="PGRST116")throw n;return!!r},async getAdminUsers(){const{data:e,error:r}=await f.from("admin_users").select("*").order("created_at");if(r)throw r;return e},async addAdmin(e,r=null){const{data:n,error:s}=await f.from("admin_users").insert({user_id:e,name:r}).select().single();if(s)throw s;return n},async removeAdmin(e){const{error:r}=await f.from("admin_users").delete().eq("user_id",e);if(r)throw r;return!0},async getAllUsers(e=""){let r=f.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name, marketing_cloud_agency_admin").order("first_name");e&&(r=r.or(`first_name.ilike.%${e}%,last_name.ilike.%${e}%,email.ilike.%${e}%`)),r=r.limit(50);const{data:n,error:s}=await r;if(s)throw s;return n||[]},async getUniqueAgencies(){const{data:e,error:r}=await f.from("users").select("profile_name").not("profile_name","is",null).order("profile_name");if(r)throw r;return[...new Set(e==null?void 0:e.map(s=>s.profile_name))].filter(Boolean)},async getUsersByAgency(e){const{data:r,error:n}=await f.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name, marketing_cloud_agency_admin").eq("profile_name",e).order("first_name");if(n)throw n;return r||[]},async getUserIdsByAgency(e){const{data:r,error:n}=await f.from("users").select("user_unique_id").eq("profile_name",e);if(n)throw n;return(r==null?void 0:r.map(s=>s.user_unique_id))||[]},async getAllUserIds(){const{data:e,error:r}=await f.from("users").select("user_unique_id");if(r)throw r;return(e==null?void 0:e.map(n=>n.user_unique_id))||[]},async getAgencyAgents(e,r=null,n=""){let s=f.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name").eq("profile_name",e).order("first_name");r&&(s=s.neq("user_unique_id",r)),n&&(s=s.or(`first_name.ilike.%${n}%,last_name.ilike.%${n}%,email.ilike.%${n}%`)),s=s.limit(50);const{data:o,error:i}=await s;if(i)throw i;return o||[]},async isAgencyAdmin(e){const{data:r,error:n}=await f.from("users").select("marketing_cloud_agency_admin").eq("user_unique_id",e).single();if(n&&n.code!=="PGRST116")throw n;return(r==null?void 0:r.marketing_cloud_agency_admin)===!0},async getUserProfileName(e){const{data:r,error:n}=await f.from("users").select("profile_name").eq("user_unique_id",e).single();if(n&&n.code!=="PGRST116")throw n;return(r==null?void 0:r.profile_name)||null},async getMasterAutomations(){const{data:e,error:r}=await f.from("master_automations").select("*").order("name");if(r)throw r;return e},async getMasterAutomation(e){const{data:r,error:n}=await f.from("master_automations").select("*").eq("default_key",e).single();if(n)throw n;return r},async createMasterAutomation(e){const{data:r,error:n}=await f.from("master_automations").insert(e).select().single();if(n)throw n;return r},async updateMasterAutomation(e,r){const{data:n}=await f.from("master_automations").select("id").eq("default_key",e).single();let s,o;if(n){const i=await f.from("master_automations").update({...r,updated_at:new Date().toISOString()}).eq("default_key",e).select().single();s=i.data,o=i.error}else{const i=await f.from("master_automations").insert({default_key:e,...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();s=i.data,o=i.error}if(o)throw o;return await f.rpc("sync_master_automation_to_users",{p_default_key:e}),s},async deleteMasterAutomation(e){const{error:r}=await f.from("master_automations").delete().eq("default_key",e);if(r)throw r;return!0},async syncMasterAutomation(e){const{data:r,error:n}=await f.rpc("sync_master_automation_to_users",{p_default_key:e});if(n)throw n;return r},async syncAllMasterAutomations(){const{data:e,error:r}=await f.rpc("sync_all_master_automations");if(r)throw r;return e},async getMasterTemplates(){const{data:e,error:r}=await f.from("master_templates").select("*").order("name");if(r)throw r;return e},async getMasterTemplate(e){const{data:r,error:n}=await f.from("master_templates").select("*").eq("default_key",e).single();if(n)throw n;return r},async createMasterTemplate(e){const{data:r,error:n}=await f.from("master_templates").insert(e).select().single();if(n)throw n;return r},async updateMasterTemplate(e,r){const{data:n,error:s}=await f.from("master_templates").update(r).eq("default_key",e).select().single();if(s)throw s;return n},async deleteMasterTemplate(e){const{error:r}=await f.from("master_templates").delete().eq("default_key",e);if(r)throw r;return!0},async syncMasterTemplate(e){const{data:r,error:n}=await f.rpc("sync_master_template_to_users",{p_default_key:e});if(n)throw n;return r},async syncAllMasterTemplates(){const{data:e,error:r}=await f.rpc("sync_all_master_templates");if(r)throw r;return e}},I={detectSalesforceContext(){const e=new URLSearchParams(window.location.search),r=e.get("sfSession"),n=e.get("sfOrg"),s=window.location.pathname.match(/^\/([a-zA-Z0-9]{15,18})/),o=s?s[1]:null,i=window.self!==window.top,d=document.referrer||"",u=d.includes(".salesforce.com")||d.includes(".force.com")||d.includes(".lightning.force.com")||d.includes(".my.salesforce.com");return r&&n&&o?{isFromSalesforce:!0,userId:o,sessionId:r,orgId:n,isInIframe:i,isSalesforceReferrer:u}:i&&u&&o?{isFromSalesforce:!0,userId:o,sessionId:null,orgId:null,isInIframe:i,isSalesforceReferrer:u}:{isFromSalesforce:!1,userId:o,sessionId:null,orgId:null,isInIframe:i,isSalesforceReferrer:u}},async validateSalesforceSession(e,r){if(!e||!r)return null;try{const n=`https://${r.substring(0,15)}.my.salesforce.com`,s=await fetch(`${n}/services/oauth2/userinfo`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)return console.warn("Salesforce session validation failed:",s.status),null;const o=await s.json();return{userId:o.user_id,email:o.email,name:o.name,orgId:o.organization_id}}catch(n){return console.warn("Salesforce session validation error:",n),null}},async getUserById(e){const{data:r,error:n}=await f.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name, marketing_cloud_engagement, marketing_cloud_agency_admin").eq("user_unique_id",e);if(n)throw n;return!r||r.length===0||!r.some(i=>i.marketing_cloud_engagement===!0||i.marketing_cloud_agency_admin===!0)?null:r.find(i=>i.marketing_cloud_engagement===!0||i.marketing_cloud_agency_admin===!0)||r[0]},createLocalSession(e){const r={userId:e.user_unique_id,email:e.email,name:`${e.first_name||""} ${e.last_name||""}`.trim()||"User",expiresAt:Date.now()+864e5,source:"salesforce"};return localStorage.setItem("isg_sf_session",JSON.stringify(r)),r},getLocalSession(){const e=localStorage.getItem("isg_sf_session");if(!e)return null;try{const r=JSON.parse(e);return r.expiresAt>Date.now()?r:(localStorage.removeItem("isg_sf_session"),null)}catch{return localStorage.removeItem("isg_sf_session"),null}},clearLocalSession(){localStorage.removeItem("isg_sf_session")},async sendOTP(e){const{error:r}=await f.auth.signInWithOtp({email:e,options:{shouldCreateUser:!0}});if(r)throw r;return!0},async verifyOTP(e,r){const{data:n,error:s}=await f.auth.verifyOtp({email:e,token:r,type:"email"});if(s)throw s;return n},async getUserByEmail(e){const{data:r,error:n}=await f.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name, marketing_cloud_engagement, marketing_cloud_agency_admin").eq("email",e);if(n)throw n;return!r||r.length===0||!r.some(i=>i.marketing_cloud_engagement===!0||i.marketing_cloud_agency_admin===!0)?null:r.find(i=>i.marketing_cloud_engagement===!0||i.marketing_cloud_agency_admin===!0)||r[0]},async getSession(){const{data:{session:e},error:r}=await f.auth.getSession();if(r)throw r;return e},async signOut(){const{error:e}=await f.auth.signOut();if(e)throw e;return!0},onAuthStateChange(e){return f.auth.onAuthStateChange(e)},async isAdmin(e){const{data:r,error:n}=await f.from("admin_users").select("id").eq("user_id",e).single();if(n&&n.code!=="PGRST116")throw n;return!!r},saveLastEmail(e){localStorage.setItem("isg_last_email",e)},getLastEmail(){return localStorage.getItem("isg_last_email")},clearLastEmail(){localStorage.removeItem("isg_last_email")}},se=c.createContext(),H={MASTER_ADMIN:"master_admin",AGENCY_ADMIN:"agency_admin",MARKETING_USER:"marketing_user"},D=()=>{const e=c.useContext(se);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},Ie=({children:e})=>{const[r,n]=c.useState(!0),[s,o]=c.useState(!1),[i,d]=c.useState(null),[u,m]=c.useState(!1),[h,_]=c.useState(!1),[b,a]=c.useState(null),[g,y]=c.useState({active:!1,originalUserId:null,originalUserName:null,targetUserId:null,targetUserName:null,targetProfileName:null}),[v,k]=c.useState({active:!1,filterType:null,filterValue:null,filterLabel:null,ownerIds:null});c.useEffect(()=>{E();const{data:{subscription:x}}=I.onAuthStateChange(async(S,j)=>{S==="SIGNED_OUT"&&(o(!1),d(null),m(!1),y({active:!1,originalUserId:null,originalUserName:null,targetUserId:null,targetUserName:null}))});return()=>x==null?void 0:x.unsubscribe()},[]);const E=async()=>{n(!0);try{const x=I.detectSalesforceContext();if(x.isFromSalesforce&&await C(x)){n(!1);return}const S=I.getLocalSession();if(S){const j=await I.getUserById(S.userId);if(j){await L(j),n(!1);return}I.clearLocalSession()}await z()}catch(x){console.error("Auth initialization error:",x),o(!1),d(null)}finally{n(!1)}},C=async x=>{try{const{userId:S,sessionId:j,orgId:R,isSalesforceReferrer:N,isInIframe:V}=x;if(j&&R){const q=await I.validateSalesforceSession(j,R);if(q){const P=await I.getUserById(q.userId);if(P)return I.createLocalSession(P),await L(P),!0}}if(V&&N&&S){const q=await I.getUserById(S);if(q)return I.createLocalSession(q),await L(q),!0}return!1}catch(S){return console.error("Salesforce auth error:",S),!1}},L=async x=>{const S=`${x.first_name||""} ${x.last_name||""}`.trim()||"User";d({id:x.user_unique_id,name:S,email:x.email,profileName:x.profile_name||null}),o(!0);const j=await I.isAdmin(x.user_unique_id);m(j);const R=x.marketing_cloud_agency_admin===!0;_(R);let N;j?N=H.MASTER_ADMIN:R?N=H.AGENCY_ADMIN:N=H.MARKETING_USER,a(N);const V=localStorage.getItem("isg_impersonation");if(V&&(j||R)){const P=JSON.parse(V);P.originalUserId===x.user_unique_id?y(P):localStorage.removeItem("isg_impersonation")}const q=localStorage.getItem("isg_scope_filter");if(q&&(j||R)){const P=JSON.parse(q);P.originalUserId===x.user_unique_id?k(P):localStorage.removeItem("isg_scope_filter")}else if(j){const K={active:!0,filterType:"all_agencies",filterValue:null,filterLabel:"All Agencies",ownerIds:await B.getAllUserIds(),originalUserId:x.user_unique_id};k(K),localStorage.setItem("isg_scope_filter",JSON.stringify(K))}},z=async()=>{var x;try{const S=await I.getSession();if((x=S==null?void 0:S.user)!=null&&x.email){const j=await I.getUserByEmail(S.user.email);j?await L(j):(await I.signOut(),o(!1),d(null))}}catch(S){console.error("Session check error:",S),o(!1),d(null)}},M=async x=>{await I.sendOTP(x),I.saveLastEmail(x)},l=async(x,S)=>{await I.verifyOTP(x,S);const j=await I.getUserByEmail(x);if(!j)return await I.signOut(),{success:!1,noAccess:!0};const R=`${j.first_name||""} ${j.last_name||""}`.trim()||"User";d({id:j.user_unique_id,name:R,email:j.email}),o(!0);const N=await I.isAdmin(j.user_unique_id);return m(N),{success:!0,userId:j.user_unique_id,noAccess:!1}},w=async()=>{await I.signOut(),I.clearLocalSession(),localStorage.removeItem("isg_impersonation"),localStorage.removeItem("isg_scope_filter"),o(!1),d(null),m(!1),_(!1),a(null),y({active:!1,originalUserId:null,originalUserName:null,targetUserId:null,targetUserName:null,targetProfileName:null}),k({active:!1,filterType:null,filterValue:null,filterLabel:null,ownerIds:null})},T=c.useCallback((x,S,j=null)=>{if(!u&&!h||!i)return!1;const R={active:!0,originalUserId:i.id,originalUserName:i.name,targetUserId:x,targetUserName:S,targetProfileName:j};return y(R),localStorage.setItem("isg_impersonation",JSON.stringify(R)),!0},[u,h,i]),p=c.useCallback(()=>{localStorage.removeItem("isg_impersonation"),y({active:!1,originalUserId:null,originalUserName:null,targetUserId:null,targetUserName:null,targetProfileName:null})},[]),A=c.useCallback(()=>g.active&&g.targetUserId?g.targetUserId:(i==null?void 0:i.id)||null,[g,i]),$=c.useCallback(()=>g.active&&g.targetUserName?g.targetUserName:(i==null?void 0:i.name)||null,[g,i]),W=c.useCallback(x=>{if(!i)return;const S={active:x.filterType!==null,filterType:x.filterType,filterValue:x.filterValue,filterLabel:x.filterLabel,ownerIds:x.ownerIds,originalUserId:i.id};k(S),S.active?localStorage.setItem("isg_scope_filter",JSON.stringify(S)):localStorage.removeItem("isg_scope_filter")},[i]),ie=c.useCallback(()=>{localStorage.removeItem("isg_scope_filter"),k({active:!1,filterType:null,filterValue:null,filterLabel:null,ownerIds:null})},[]),oe=c.useCallback(()=>g.active&&g.targetUserId?g.targetUserId:v.active&&v.ownerIds&&v.ownerIds.length>0?v.ownerIds.length===1?v.ownerIds[0]:v.ownerIds:(i==null?void 0:i.id)||null,[g,v,i]),ae=c.useCallback(()=>v.active||g.active,[v,g]),le={isLoading:r,isAuthenticated:s,user:i,isAdmin:u,isAgencyAdmin:h,userRole:b,impersonating:g,scopeFilter:v,sendOTP:M,verifyOTP:l,logout:w,impersonate:T,exitImpersonation:p,getEffectiveUserId:A,getEffectiveUserName:$,updateScopeFilter:W,clearScopeFilter:ie,getEffectiveOwnerIds:oe,isViewingFiltered:ae,checkSession:z};return t.jsx(se.Provider,{value:le,children:e})},Ae=()=>{const e=F(),[r]=pe(),{isAuthenticated:n,user:s,sendOTP:o,verifyOTP:i}=D(),[d,u]=c.useState("email"),[m,h]=c.useState(""),[_,b]=c.useState(""),[a,g]=c.useState(""),[y,v]=c.useState(!1),[k,E]=c.useState(!1);c.useEffect(()=>{const w=r.get("email"),T=I.getLastEmail();w?h(w):T&&h(T)},[r]),c.useEffect(()=>{n&&(s!=null&&s.id)&&e(`/${s.id}/dashboard`,{replace:!0})},[n,s,e]);const C=async w=>{var T;w.preventDefault(),g(""),v(!0);try{await o(m),E(!0),u("code")}catch(p){console.error("Send OTP error:",p),(T=p.message)!=null&&T.includes("rate limit")?g("Too many attempts. Please wait a moment and try again."):g("Failed to send verification code. Please try again.")}finally{v(!1)}},L=async w=>{var T,p;w.preventDefault(),g(""),v(!0);try{const A=await i(m,_);A.noAccess?u("no-access"):A.success&&e(`/${A.userId}/dashboard`,{replace:!0})}catch(A){console.error("Verify OTP error:",A),(T=A.message)!=null&&T.includes("Invalid")||(p=A.message)!=null&&p.includes("expired")?g("Invalid or expired code. Please try again."):g("Verification failed. Please try again.")}finally{v(!1)}},z=async()=>{g(""),v(!0),b("");try{await o(m),E(!0),g("")}catch(w){console.error("Resend OTP error:",w),g("Failed to resend code. Please try again.")}finally{v(!1)}},M=()=>{u("email"),h(""),b(""),g(""),E(!1),I.clearLastEmail()},l={container:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",padding:"20px"},card:{backgroundColor:"#ffffff",borderRadius:"16px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",padding:"48px",width:"100%",maxWidth:"420px"},logo:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",marginBottom:"32px"},logoIcon:{width:"48px",height:"48px",backgroundColor:"#3b82f6",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"24px"},logoText:{fontWeight:"700",fontSize:"20px",color:"#1e293b"},title:{fontSize:"24px",fontWeight:"700",color:"#1e293b",textAlign:"center",marginBottom:"8px"},subtitle:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},form:{display:"flex",flexDirection:"column",gap:"20px"},inputGroup:{display:"flex",flexDirection:"column",gap:"6px"},label:{fontSize:"14px",fontWeight:"500",color:"#374151"},input:{padding:"12px 16px",fontSize:"16px",border:"1px solid #e2e8f0",borderRadius:"8px",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},button:{padding:"14px 24px",fontSize:"16px",fontWeight:"600",color:"#ffffff",backgroundColor:"#3b82f6",border:"none",borderRadius:"8px",cursor:"pointer",transition:"background-color 0.2s"},buttonDisabled:{backgroundColor:"#94a3b8",cursor:"not-allowed"},error:{padding:"12px 16px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",color:"#dc2626",fontSize:"14px"},link:{color:"#3b82f6",textDecoration:"none",cursor:"pointer",fontSize:"14px"},codeInfo:{textAlign:"center",fontSize:"14px",color:"#64748b"},noAccessIcon:{fontSize:"64px",textAlign:"center",marginBottom:"24px"},noAccessTitle:{fontSize:"20px",fontWeight:"600",color:"#1e293b",textAlign:"center",marginBottom:"12px"},noAccessText:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"24px",lineHeight:"1.6"},secondaryButton:{padding:"12px 24px",fontSize:"14px",fontWeight:"500",color:"#3b82f6",backgroundColor:"transparent",border:"1px solid #3b82f6",borderRadius:"8px",cursor:"pointer",transition:"background-color 0.2s"}};return d==="no-access"?t.jsx("div",{style:l.container,children:t.jsxs("div",{style:l.card,children:[t.jsxs("div",{style:l.logo,children:[t.jsx("div",{style:l.logoIcon,children:"ðŸ“§"}),t.jsx("div",{style:l.logoText,children:"Email Automation"})]}),t.jsx("div",{style:l.noAccessIcon,children:"ðŸ”’"}),t.jsx("div",{style:l.noAccessTitle,children:"Access Denied"}),t.jsxs("div",{style:l.noAccessText,children:["You don't have access to this site.",t.jsx("br",{}),"Contact your administrator for access."]}),t.jsx("button",{onClick:M,style:l.secondaryButton,children:"Try a Different Email"})]})}):d==="code"?t.jsx("div",{style:l.container,children:t.jsxs("div",{style:l.card,children:[t.jsxs("div",{style:l.logo,children:[t.jsx("div",{style:l.logoIcon,children:"ðŸ“§"}),t.jsx("div",{style:l.logoText,children:"Email Automation"})]}),t.jsx("h1",{style:l.title,children:"Check Your Email"}),t.jsxs("p",{style:l.subtitle,children:["We sent a verification code to",t.jsx("br",{}),t.jsx("strong",{children:m})]}),t.jsxs("form",{onSubmit:L,style:l.form,children:[a&&t.jsx("div",{style:l.error,children:a}),t.jsxs("div",{style:l.inputGroup,children:[t.jsx("label",{style:l.label,children:"Verification Code"}),t.jsx("input",{type:"text",value:_,onChange:w=>b(w.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"Enter 6-digit code",style:l.input,autoFocus:!0,maxLength:6,inputMode:"numeric",autoComplete:"one-time-code"})]}),t.jsx("button",{type:"submit",disabled:y||_.length!==6,style:{...l.button,...y||_.length!==6?l.buttonDisabled:{}},children:y?"Verifying...":"Verify Code"}),t.jsxs("div",{style:l.codeInfo,children:["Didn't receive the code?"," ",t.jsx("span",{onClick:y?void 0:z,style:{...l.link,...y?{opacity:.5,cursor:"not-allowed"}:{}},children:"Resend"})]}),t.jsx("div",{style:{textAlign:"center"},children:t.jsx("span",{onClick:M,style:l.link,children:"Use a different email"})})]})]})}):t.jsx("div",{style:l.container,children:t.jsxs("div",{style:l.card,children:[t.jsxs("div",{style:l.logo,children:[t.jsx("div",{style:l.logoIcon,children:"ðŸ“§"}),t.jsx("div",{style:l.logoText,children:"Email Automation"})]}),t.jsx("h1",{style:l.title,children:"Welcome Back"}),t.jsx("p",{style:l.subtitle,children:"Enter your email to receive a verification code"}),t.jsxs("form",{onSubmit:C,style:l.form,children:[a&&t.jsx("div",{style:l.error,children:a}),t.jsxs("div",{style:l.inputGroup,children:[t.jsx("label",{style:l.label,children:"Email Address"}),t.jsx("input",{type:"email",value:m,onChange:w=>h(w.target.value),placeholder:"you@example.com",style:l.input,autoFocus:!0,autoComplete:"email",required:!0})]}),t.jsx("button",{type:"submit",disabled:y||!m,style:{...l.button,...y||!m?l.buttonDisabled:{}},children:y?"Sending...":"Send Verification Code"})]})]})})},Ce=({children:e})=>{const{isLoading:r,isAuthenticated:n}=D(),s=te();if(r)return t.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif"},children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{width:"48px",height:"48px",border:"3px solid #e2e8f0",borderTopColor:"#3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 16px"}}),t.jsx("div",{style:{color:"#64748b",fontSize:"14px"},children:"Loading..."}),t.jsx("style",{children:`
            @keyframes spin {
              to { transform: rotate(360deg); }
            }
          `})]})});if(!n){const o=I.detectSalesforceContext();return o.isInIframe&&o.isSalesforceReferrer?t.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif"},children:t.jsxs("div",{style:{textAlign:"center",padding:"40px",maxWidth:"400px"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ”’"}),t.jsx("h2",{style:{fontSize:"20px",fontWeight:"600",color:"#1e293b",marginBottom:"8px"},children:"Access Denied"}),t.jsx("p",{style:{color:"#64748b",fontSize:"14px",lineHeight:"1.5"},children:"Your user account doesn't have access to this application. Please contact your administrator."})]})}):t.jsx(me,{to:"/login",state:{from:s},replace:!0})}return e},ke=()=>{const e=F(),{impersonating:r,exitImpersonation:n,user:s}=D(),[o,i]=c.useState(null);if(c.useEffect(()=>{if(!r.active||!r.targetUserId){i(null);return}(async()=>{var h;try{const{data:_,error:b}=await f.from("users").select("email").eq("user_unique_id",r.targetUserId).limit(1).single();if(b||!(_!=null&&_.email)){i(null);return}const a=(h=_.email.split("@")[1])==null?void 0:h.toLowerCase();if(!a){i(null);return}const{data:g,error:y}=await f.from("sender_domains").select("domain, status").eq("owner_id",r.targetUserId).eq("status","verified");if(y){console.error("Error fetching sender domains:",y),i(null);return}const v=g==null?void 0:g.some(k=>{var E;return((E=k.domain)==null?void 0:E.toLowerCase())===a});i(v?null:{email:_.email,domain:a,hasAnyVerifiedDomain:g&&g.length>0})}catch(_){console.error("Error checking domain verification:",_),i(null)}})()},[r.active,r.targetUserId]),!r.active)return null;const d=()=>{n(),s!=null&&s.id&&e(`/${s.id}/dashboard`)},u=()=>{e(`/${r.targetUserId}/settings`)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{backgroundColor:"#f59e0b",color:"#ffffff",padding:"10px 24px",display:"flex",alignItems:"center",justifyContent:"center",gap:"16px",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",fontSize:"14px",fontWeight:"500",position:"fixed",top:0,left:0,right:0,zIndex:9999,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:[t.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ‘ï¸"}),"Viewing as: ",t.jsx("strong",{children:r.targetUserName})]}),t.jsx("button",{onClick:d,style:{backgroundColor:"rgba(255, 255, 255, 0.2)",border:"1px solid rgba(255, 255, 255, 0.4)",color:"#ffffff",padding:"6px 16px",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"600",transition:"background-color 0.2s"},onMouseEnter:m=>m.target.style.backgroundColor="rgba(255, 255, 255, 0.3)",onMouseLeave:m=>m.target.style.backgroundColor="rgba(255, 255, 255, 0.2)",children:"Exit Impersonation"})]}),o&&t.jsxs("div",{style:{backgroundColor:"#dc2626",color:"#ffffff",padding:"10px 24px",display:"flex",alignItems:"center",justifyContent:"center",gap:"16px",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",fontSize:"14px",fontWeight:"500",position:"fixed",top:"44px",left:0,right:0,zIndex:9998,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:[t.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:"âš ï¸"}),o.hasAnyVerifiedDomain?t.jsxs(t.Fragment,{children:["No verified sender domain matching ",t.jsx("strong",{children:o.domain})]}):t.jsxs(t.Fragment,{children:["No verified sender domain for ",t.jsx("strong",{children:o.domain})]})]}),t.jsx("button",{onClick:u,style:{backgroundColor:"rgba(255, 255, 255, 0.2)",border:"1px solid rgba(255, 255, 255, 0.4)",color:"#ffffff",padding:"6px 16px",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"600",transition:"background-color 0.2s"},onMouseEnter:m=>m.target.style.backgroundColor="rgba(255, 255, 255, 0.3)",onMouseLeave:m=>m.target.style.backgroundColor="rgba(255, 255, 255, 0.2)",children:"Add Domain"})]})]})},Ee=({t:e})=>{const{userRole:r,user:n,scopeFilter:s,updateScopeFilter:o,clearScopeFilter:i,isAdmin:d,isAgencyAdmin:u}=D(),[m,h]=c.useState(!1),[_,b]=c.useState(""),[a,g]=c.useState([]),[y,v]=c.useState(!1),k=c.useRef(null),E=c.useRef(null);if(r===H.MARKETING_USER||!d&&!u)return null;c.useEffect(()=>{const p=A=>{k.current&&!k.current.contains(A.target)&&h(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]);const C=async(p="")=>{v(!0);try{if(d){const A=await B.getUniqueAgencies(),$=p?A.filter(W=>W.toLowerCase().includes(p.toLowerCase())):A;g($.map(W=>({type:"agency",value:W,label:W})))}else if(u&&(n!=null&&n.profileName)){const A=await B.getAgencyAgents(n.profileName,n.id,p);g(A.map($=>({type:"agent",value:$.user_unique_id,label:`${$.first_name||""} ${$.last_name||""}`.trim()||$.email,email:$.email})))}}catch(A){console.error("Error fetching filter items:",A)}finally{v(!1)}},L=async()=>{h(!0),b(""),await C()},z=p=>{b(p),E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{C(p)},300)},M=async()=>{if(d){const p=await B.getAllUserIds();o({filterType:"all_agencies",filterValue:null,filterLabel:"All Agencies",ownerIds:p})}else if(u&&(n!=null&&n.profileName)){const p=await B.getUserIdsByAgency(n.profileName);o({filterType:"all_agents",filterValue:n.profileName,filterLabel:"All Agents",ownerIds:p})}h(!1),b("")},l=async p=>{if(p.type==="agency"){const A=await B.getUserIdsByAgency(p.value);o({filterType:"agency",filterValue:p.value,filterLabel:p.label,ownerIds:A})}else p.type==="agent"&&o({filterType:"agent",filterValue:p.value,filterLabel:p.label,ownerIds:[p.value]});h(!1),b("")},w=()=>s.active?s.filterLabel||"Filtered":d?"All Agencies":"My Data",T=()=>d?"All Agencies":"All Agents";return t.jsxs("div",{ref:k,style:{position:"relative"},children:[t.jsxs("button",{onClick:L,style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",backgroundColor:s.active?e.primary+"15":e.bgHover,border:`1px solid ${s.active?e.primary:e.border}`,borderRadius:"8px",color:s.active?e.primary:e.text,cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:[t.jsx("span",{children:d?"ðŸ¢":"ðŸ‘¥"}),t.jsx("span",{children:w()}),t.jsx("span",{style:{fontSize:"10px",opacity:.7},children:"â–¼"})]}),m&&t.jsxs("div",{style:{position:"absolute",top:"100%",left:0,marginTop:"4px",width:"280px",backgroundColor:e.bgCard,border:`1px solid ${e.border}`,borderRadius:"12px",boxShadow:"0 10px 40px rgba(0,0,0,0.15)",zIndex:1e3,overflow:"hidden"},children:[t.jsx("div",{style:{padding:"12px",borderBottom:`1px solid ${e.border}`},children:t.jsx("input",{type:"text",placeholder:d?"Search agencies...":"Search agents...",value:_,onChange:p=>z(p.target.value),autoFocus:!0,style:{width:"100%",padding:"10px 12px",fontSize:"13px",border:`1px solid ${e.border}`,borderRadius:"8px",backgroundColor:e.bgInput,color:e.text,outline:"none"}})}),t.jsxs("div",{style:{maxHeight:"300px",overflowY:"auto"},children:[t.jsxs("button",{onClick:M,style:{width:"100%",padding:"12px 16px",backgroundColor:s.active?"transparent":e.bgHover,border:"none",borderBottom:`1px solid ${e.borderLight}`,color:e.text,cursor:"pointer",textAlign:"left",fontSize:"13px",fontWeight:s.active?"400":"600",display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:d?"ðŸŒ":"ðŸ‘¥"}),t.jsx("span",{children:T()}),!s.active&&t.jsx("span",{style:{marginLeft:"auto",color:e.primary},children:"âœ“"})]}),y&&t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted},children:"Loading..."}),!y&&a.length===0&&t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted},children:_?"No results found":"No items available"}),!y&&a.map((p,A)=>t.jsxs("button",{onClick:()=>l(p),style:{width:"100%",padding:"12px 16px",backgroundColor:s.filterValue===p.value?e.bgHover:"transparent",border:"none",borderBottom:A<a.length-1?`1px solid ${e.borderLight}`:"none",color:e.text,cursor:"pointer",textAlign:"left",fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:p.type==="agency"?"ðŸ¢":"ðŸ‘¤"}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:s.filterValue===p.value?"600":"400"},children:p.label}),p.email&&t.jsx("div",{style:{fontSize:"11px",color:e.textMuted,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:p.email})]}),s.filterValue===p.value&&t.jsx("span",{style:{color:e.primary},children:"âœ“"})]},p.value))]}),s.active&&t.jsx("div",{style:{padding:"12px",borderTop:`1px solid ${e.border}`},children:t.jsx("button",{onClick:()=>{i(),h(!1)},style:{width:"100%",padding:"10px",backgroundColor:"transparent",border:`1px solid ${e.danger}`,borderRadius:"8px",color:e.danger,cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Clear Filter"})})]})]})},X=c.lazy(()=>O(()=>import("./DashboardPage-ZxuNp-cV.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Te=c.lazy(()=>O(()=>import("./AutomationsPage-C2gGHSn1.js"),__vite__mapDeps([7,1,2,8,4,9,10,11,6]))),Ue=c.lazy(()=>O(()=>import("./TemplatesPage-BByafKMh.js"),__vite__mapDeps([12,1,2,13,4,6]))),Re=c.lazy(()=>O(()=>import("./ClientsPage-SrX-tLSi.js"),__vite__mapDeps([14,1,2,15,5,4,6]))),Le=c.lazy(()=>O(()=>import("./ClientProfilePage-CHV3gSsR.js"),__vite__mapDeps([16,1,2,3,4,5,15,6]))),Pe=c.lazy(()=>O(()=>import("./SettingsPage-QdR4vW0v.js"),__vite__mapDeps([17,1,2,11,6,18]))),ee=c.lazy(()=>O(()=>import("./WorkflowBuilderPage-CTsnhRAY.js"),__vite__mapDeps([19,1,2,8,4,9,13,20,6]))),ze=c.lazy(()=>O(()=>import("./MassEmailPage-BFY5eIbJ.js"),__vite__mapDeps([21,1,2,13,4,20,9,10,11,6]))),$e=c.lazy(()=>O(()=>import("./KnowledgeCenterPage-D6sBsZL2.js"),__vite__mapDeps([22,1,2]))),qe=({t:e})=>t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"400px",flexDirection:"column",gap:"16px"},children:[t.jsx("div",{style:{width:"40px",height:"40px",border:`3px solid ${(e==null?void 0:e.border)||"#e2e8f0"}`,borderTopColor:(e==null?void 0:e.primary)||"#3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite"}}),t.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}),Oe=c.createContext(),Y={light:{bg:"#f8fafc",bgCard:"#ffffff",bgSidebar:"#ffffff",bgHover:"#f1f5f9",bgInput:"#ffffff",border:"#e2e8f0",borderLight:"#f1f5f9",text:"#1e293b",textSecondary:"#64748b",textMuted:"#94a3b8",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},dark:{bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"}},Me=c.createContext(),Ne=({t:e})=>{const r=F(),{isAdmin:n,isAgencyAdmin:s,user:o,impersonate:i,impersonating:d}=D(),[u,m]=c.useState(!1),[h,_]=c.useState(""),[b,a]=c.useState([]),[g,y]=c.useState(!1),v=ne.useRef(null);if(!n&&!s)return null;const k=async(l="")=>{y(!0);try{if(n){const w=await B.getAllUsers(l);a(w)}else if(s&&(o!=null&&o.profileName)){const w=await B.getAgencyAgents(o.profileName,o.id,l);a(w)}}catch(w){console.error("Error fetching users:",w)}finally{y(!1)}},E=async()=>{m(!0),await k()},C=l=>{_(l),v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{k(l)},300)},L=l=>{const w=`${l.first_name||""} ${l.last_name||""}`.trim()||l.email;i(l.user_unique_id,w,l.profile_name),m(!1),_(""),r(`/${l.user_unique_id}/dashboard`)},z=()=>n?"View As User":"View As Agent",M=()=>n?"Select a user to impersonate":"Select an agent in your agency to impersonate";return t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:E,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",color:e.textSecondary,cursor:"pointer",fontSize:"13px",textAlign:"left",alignItems:"center",gap:"10px"},children:[t.jsx("span",{children:"ðŸ‘ï¸"})," ",z(),d.active&&t.jsx("span",{style:{marginLeft:"auto",padding:"2px 6px",backgroundColor:e.warning,borderRadius:"4px",fontSize:"9px",color:"#fff",fontWeight:"600"},children:"ACTIVE"})]}),u&&t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>m(!1),children:t.jsxs("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",width:"400px",maxHeight:"500px",overflow:"hidden",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:l=>l.stopPropagation(),children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:e.text},children:z()}),t.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:e.textMuted},children:M()})]}),t.jsx("div",{style:{padding:"12px 20px"},children:t.jsx("input",{type:"text",placeholder:"Search by name or email...",value:h,onChange:l=>C(l.target.value),style:{width:"100%",padding:"10px 12px",fontSize:"14px",border:`1px solid ${e.border}`,borderRadius:"8px",backgroundColor:e.bgInput,color:e.text,outline:"none"},autoFocus:!0})}),t.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",padding:"0 12px 12px"},children:g?t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted},children:"Loading..."}):b.length===0?t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted},children:"No users found"}):b.map(l=>{const w=`${l.first_name||""} ${l.last_name||""}`.trim()||"Unknown";return t.jsxs("button",{onClick:()=>L(l),style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",textAlign:"left",alignItems:"center",gap:"12px",marginBottom:"4px"},onMouseEnter:T=>T.currentTarget.style.backgroundColor=e.bgHover,onMouseLeave:T=>T.currentTarget.style.backgroundColor="transparent",children:[t.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:e.bgHover,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",flexShrink:0},children:"ðŸ‘¤"}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:e.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:w}),t.jsx("div",{style:{fontSize:"12px",color:e.textMuted,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l.email})]})]},l.user_unique_id)})}),t.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${e.border}`,display:"flex",justifyContent:"flex-end"},children:t.jsx("button",{onClick:()=>m(!1),style:{padding:"8px 16px",fontSize:"13px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"6px",color:e.text,cursor:"pointer"},children:"Cancel"})})]})})]})},Be=()=>{const{userId:e}=xe(),r=te(),n=F(),[s,o]=c.useState(!1),{user:i,isAdmin:d,impersonating:u,logout:m}=D(),{data:h}=ue({queryKey:["currentUser",e],queryFn:()=>je.getCurrentUser(e),enabled:!!e}),[_,b]=c.useState({id:e,name:"",email:"",org:""});c.useEffect(()=>{h&&b({id:e,name:`${h.first_name||""} ${h.last_name||""}`.trim()||"Unknown User",email:h.email||"",org:h.profile_name||""})},[h,e]),c.useEffect(()=>{i&&e&&!u.active&&i.id!==e&&!d&&n(`/${i.id}/dashboard`,{replace:!0})},[i,e,d,u.active,n]);const a=s?Y.dark:Y.light,y=(()=>{const C=r.pathname.split("/").slice(2).join("/");return C.startsWith("automations/")?"automations":C.startsWith("accounts/")?"accounts":C||"dashboard"})(),v=[{id:"dashboard",label:"Dashboard",icon:"ðŸ“Š",path:`/${e}/dashboard`},{id:"automations",label:"Automations",icon:"âš¡",path:`/${e}/automations`},{id:"templates",label:"Templates",icon:"ðŸ“",path:`/${e}/templates`},{id:"mass-email",label:"Mass Email",icon:"ðŸ“§",path:`/${e}/mass-email`},{id:"accounts",label:"Accounts",icon:"ðŸ‘¥",path:`/${e}/accounts`},{id:"settings",label:"Settings",icon:"âš™ï¸",path:`/${e}/settings`}],k=async()=>{await m(),n("/login")},E=u.active?"44px":"0px";return t.jsx(Oe.Provider,{value:{isDark:s,setIsDark:o,t:a,themes:Y},children:t.jsxs(Me.Provider,{value:{userId:e,currentUser:_,setCurrentUser:b},children:[t.jsx(ke,{}),t.jsxs("div",{style:{fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",backgroundColor:a.bg,minHeight:"100vh",display:"flex",color:a.text,paddingTop:E},children:[t.jsxs("div",{style:{width:"220px",backgroundColor:a.bgSidebar,borderRight:`1px solid ${a.border}`,display:"flex",flexDirection:"column",position:"fixed",top:E,left:0,bottom:0},children:[t.jsx("div",{style:{padding:"20px 16px",borderBottom:`1px solid ${a.border}`},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:a.primary,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"18px"},children:"ðŸ“§"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"700",fontSize:"14px",color:a.text},children:"Email Automation"}),t.jsx("div",{style:{fontSize:"11px",color:a.textMuted},children:"Marketing System"})]})]})}),t.jsxs("div",{style:{flex:1,padding:"12px 8px",overflowY:"auto"},children:[t.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:a.textMuted,padding:"8px 12px",textTransform:"uppercase"},children:"Navigation"}),v.map(C=>t.jsxs(G,{to:C.path,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:y===C.id?`${a.primary}15`:"transparent",border:"none",borderRadius:"8px",color:y===C.id?a.primary:a.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:y===C.id?"600":"400",textAlign:"left",alignItems:"center",gap:"10px",marginBottom:"2px",textDecoration:"none"},children:[t.jsx("span",{children:C.icon})," ",C.label]},C.id)),t.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:a.textMuted,padding:"16px 12px 8px",textTransform:"uppercase"},children:"Admin"}),t.jsxs(G,{to:`/${e}/timeline`,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:y==="timeline"?`${a.primary}15`:"transparent",border:"none",borderRadius:"8px",color:y==="timeline"?a.primary:a.textSecondary,cursor:"pointer",fontSize:"13px",textAlign:"left",alignItems:"center",gap:"10px",textDecoration:"none"},children:[t.jsx("span",{children:"ðŸ“ˆ"})," Timeline",t.jsx("span",{style:{marginLeft:"auto",padding:"2px 8px",backgroundColor:a.bgHover,borderRadius:"4px",fontSize:"10px",color:a.textMuted},children:"Admin"})]}),t.jsx(Ne,{t:a}),t.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:a.textMuted,padding:"16px 12px 8px",textTransform:"uppercase"},children:"Help & Support"}),t.jsxs(G,{to:`/${e}/knowledge-center`,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:y==="knowledge-center"?`${a.primary}15`:"transparent",border:"none",borderRadius:"8px",color:y==="knowledge-center"?a.primary:a.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:y==="knowledge-center"?"600":"400",textAlign:"left",alignItems:"center",gap:"10px",textDecoration:"none",marginBottom:"2px"},children:[t.jsx("span",{children:"ðŸ“š"})," Knowledge Center"]})]}),t.jsxs("div",{style:{padding:"16px",borderTop:`1px solid ${a.border}`},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"12px"},children:[t.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:a.bgHover,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:"ðŸ‘¤"}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:a.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:u.active?_.name:i==null?void 0:i.name}),t.jsx("div",{style:{fontSize:"11px",color:a.textMuted,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:u.active?_.email:i==null?void 0:i.email})]})]}),t.jsxs("button",{onClick:k,style:{width:"100%",padding:"8px 12px",fontSize:"13px",backgroundColor:"transparent",border:`1px solid ${a.border}`,borderRadius:"6px",color:a.textSecondary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:"ðŸšª"})," Sign Out"]})]})]}),t.jsxs("div",{style:{flex:1,marginLeft:"220px"},children:[t.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${a.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:a.bgCard},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[t.jsx("div",{style:{fontSize:"11px",color:a.textMuted},children:u.active?t.jsxs("span",{children:["Viewing as: ",t.jsx("strong",{children:_.name})]}):t.jsxs("span",{children:["User: ",e==null?void 0:e.substring(0,8),"..."]})}),t.jsx(Ee,{t:a})]}),t.jsx("button",{onClick:()=>o(!s),style:{padding:"8px 12px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:s?"â˜€ï¸ Light":"ðŸŒ™ Dark"})]}),t.jsx("div",{style:{padding:"24px"},children:t.jsx(c.Suspense,{fallback:t.jsx(qe,{t:a}),children:t.jsxs(re,{children:[t.jsx(U,{path:"dashboard",element:t.jsx(X,{t:a})}),t.jsx(U,{path:"automations",element:t.jsx(Te,{t:a})}),t.jsx(U,{path:"automations/new",element:t.jsx(ee,{t:a})}),t.jsx(U,{path:"automations/:automationId",element:t.jsx(ee,{t:a})}),t.jsx(U,{path:"templates",element:t.jsx(Ue,{t:a})}),t.jsx(U,{path:"mass-email",element:t.jsx(ze,{t:a})}),t.jsx(U,{path:"accounts",element:t.jsx(Re,{t:a})}),t.jsx(U,{path:"accounts/:accountId",element:t.jsx(Le,{t:a})}),t.jsx(U,{path:"settings",element:t.jsx(Pe,{t:a})}),t.jsx(U,{path:"knowledge-center",element:t.jsx($e,{t:a})}),t.jsx(U,{path:"timeline",element:t.jsx(De,{t:a})}),t.jsx(U,{path:"*",element:t.jsx(X,{t:a})})]})})})]})]})]})})},De=({t:e})=>t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Activity Timeline"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px"},children:"View all email activity across your organization"}),t.jsxs("div",{style:{marginTop:"24px",padding:"60px",textAlign:"center",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ“ˆ"}),t.jsx("p",{style:{color:e.textMuted},children:"Timeline view coming soon..."})]})]}),We=()=>{const e=F(),{isAuthenticated:r,isLoading:n,user:s}=D();return c.useEffect(()=>{n||(r&&(s!=null&&s.id)?e(`/${s.id}/dashboard`,{replace:!0}):e("/login",{replace:!0}))},[r,n,s,e]),t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"'Inter', sans-serif"},children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"16px"},children:"â³"}),t.jsx("div",{children:"Loading..."})]})})},Fe=()=>t.jsxs(de,{client:ve,children:[t.jsx(ge,{children:t.jsx(Ie,{children:t.jsxs(re,{children:[t.jsx(U,{path:"/login",element:t.jsx(Ae,{})}),t.jsx(U,{path:"/",element:t.jsx(We,{})}),t.jsx(U,{path:"/:userId/*",element:t.jsx(Ce,{children:t.jsx(Be,{})})})]})})}),t.jsx(be,{initialIsOpen:!1})]});J.createRoot(document.getElementById("root")).render(t.jsx(ne.StrictMode,{children:t.jsx(Fe,{})}));export{D as a,B as b,f as s,je as u};
