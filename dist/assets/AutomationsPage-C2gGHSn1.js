import{j as e}from"./query-BgC-0ePs.js";import{e as w,u as R,r as W}from"./vendor-CvdBrt7H.js";import"./index-laD0T8Yw.js";import{u as $,a as T}from"./useAutomations-DUarEmo4.js";import{u as B}from"./useSenderDomains-BmYMCls7.js";import"./supabase-GtAdROLV.js";import"./useEffectiveOwner-BN9vJCNM.js";import"./massEmails-cdFsY1gu.js";import"./senderDomains-D32G31A3.js";const c=({width:t="100%",height:a="20px"})=>e.jsx("div",{style:{width:t,height:a,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),m=({automation:t,onEdit:a,onToggle:g,hasVerifiedDomain:d,theme:n})=>{var r;const s=t.stats||{},p=t.status==="active",x=p||d;return e.jsxs("tr",{onClick:()=>a(t.id),style:{borderTop:`1px solid ${n.border}`,cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:i=>i.currentTarget.style.backgroundColor=n.bgHover,onMouseLeave:i=>i.currentTarget.style.backgroundColor="transparent",children:[e.jsx("td",{style:{padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:n.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px"},children:"⚡"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:n.text},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"12px",color:n.textMuted},children:t.description})]})]})}),e.jsx("td",{style:{padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),x&&g(t.id,p?"pause":"activate")},disabled:!x,title:x?"":"Add a verified sender domain to activate automations",style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:p?n.success:n.bgHover,cursor:x?"pointer":"not-allowed",position:"relative",transition:"background-color 0.2s",flexShrink:0,opacity:x?1:.5},children:e.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:p?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})}),e.jsx("span",{style:{fontSize:"12px",color:p?n.success:n.textMuted,fontWeight:"500"},children:p?"Active":t.status==="draft"?"Draft":"Paused"})]})}),e.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:n.textSecondary},children:((r=s.totalSent)==null?void 0:r.toLocaleString())||0}),e.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:n.textSecondary},children:s.openRate?`${Math.round(s.openRate)}%`:"—"}),e.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:n.textSecondary},children:s.clickRate?`${Math.round(s.clickRate)}%`:"—"}),e.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:n.textSecondary},children:s.activeEnrollments||0}),e.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:e.jsx("button",{onClick:i=>{i.stopPropagation(),a(t.id)},style:{padding:"6px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"6px",color:n.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Edit"})})]})},_=({t})=>{const{userId:a}=w(),g=R(),[d,n]=W.useState("automations"),{data:s,isLoading:p}=B(),x=((s==null?void 0:s.length)||0)>0,{data:r,isLoading:i,error:S}=$(),{activateAutomation:v,pauseAutomation:C}=T(),u=()=>{g(`/${a}/automations/new`)},b=o=>{g(`/${a}/automations/${o}`)},j=async(o,l)=>{try{l==="activate"?await v.mutateAsync(o):await C.mutateAsync(o)}catch(y){console.error(`Failed to ${l} automation:`,y)}},h=(r==null?void 0:r.filter(o=>o.is_default===!0))||[],f=(r==null?void 0:r.filter(o=>o.is_default!==!0))||[],A=(r==null?void 0:r.filter(o=>o.status==="active"))||[],z=(r==null?void 0:r.filter(o=>o.status==="paused"))||[],k=(r==null?void 0:r.filter(o=>o.status==="draft"))||[];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:t.text,marginBottom:"4px"},children:"Automations"}),e.jsx("p",{style:{color:t.textSecondary,fontSize:"14px",margin:0},children:"Create and manage automated email workflows"})]}),e.jsxs("button",{onClick:u,style:{padding:"10px 20px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{children:"+"})," Create Custom"]})]}),S&&e.jsx("div",{style:{padding:"16px",backgroundColor:`${t.danger}15`,border:`1px solid ${t.danger}30`,borderRadius:"8px",marginBottom:"24px",color:t.danger,fontSize:"14px"},children:"Failed to load automations. Please try refreshing the page."}),!p&&!x&&e.jsxs("div",{style:{padding:"20px",backgroundColor:`${t.warning}15`,border:`1px solid ${t.warning}30`,borderRadius:"12px",marginBottom:"24px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"600",color:t.text,marginBottom:"4px"},children:"Sender Domain Required"}),e.jsx("div",{style:{fontSize:"14px",color:t.textSecondary},children:"You need to add and verify a sender domain before you can activate automations. This ensures emails are delivered from your agency's domain."})]}),e.jsx("button",{onClick:()=>g(`/${a}/settings`),style:{padding:"10px 20px",backgroundColor:t.warning,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",whiteSpace:"nowrap"},children:"Add Domain"})]}),!i&&r&&e.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"24px",padding:"16px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{textAlign:"center",flex:1},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.success},children:A.length}),e.jsx("div",{style:{fontSize:"12px",color:t.textSecondary},children:"Active"})]}),e.jsx("div",{style:{width:"1px",backgroundColor:t.border}}),e.jsxs("div",{style:{textAlign:"center",flex:1},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.warning},children:z.length}),e.jsx("div",{style:{fontSize:"12px",color:t.textSecondary},children:"Paused"})]}),e.jsx("div",{style:{width:"1px",backgroundColor:t.border}}),e.jsxs("div",{style:{textAlign:"center",flex:1},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.textMuted},children:k.length}),e.jsx("div",{style:{fontSize:"12px",color:t.textSecondary},children:"Drafts"})]}),e.jsx("div",{style:{width:"1px",backgroundColor:t.border}}),e.jsxs("div",{style:{textAlign:"center",flex:1},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.primary},children:r.reduce((o,l)=>{var y;return o+(((y=l.stats)==null?void 0:y.totalSent)||0)},0).toLocaleString()}),e.jsx("div",{style:{fontSize:"12px",color:t.textSecondary},children:"Total Sent"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0",marginBottom:"24px",backgroundColor:t.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:[e.jsxs("button",{onClick:()=>n("automations"),style:{padding:"10px 20px",backgroundColor:d==="automations"?t.bgCard:"transparent",border:"none",borderRadius:"8px",color:d==="automations"?t.text:t.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:d==="automations"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:["Automations ",h.length>0&&`(${h.length})`]}),e.jsxs("button",{onClick:()=>n("my"),style:{padding:"10px 20px",backgroundColor:d==="my"?t.bgCard:"transparent",border:"none",borderRadius:"8px",color:d==="my"?t.text:t.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:d==="my"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:["My Automations ",f.length>0&&`(${f.length})`]})]}),d==="automations"&&e.jsx(e.Fragment,{children:i?e.jsx("div",{style:{backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,padding:"20px"},children:Array.from({length:3}).map((o,l)=>e.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:l>0?`1px solid ${t.border}`:"none"},children:[e.jsx(c,{width:"36px",height:"36px"}),e.jsxs("div",{style:{flex:1},children:[e.jsx(c,{width:"200px",height:"16px"}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(c,{width:"120px",height:"12px"})})]})]},l))}):h.length>0?e.jsx("div",{style:{backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:t.bgHover},children:[e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Automation"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Status"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Sent"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Open Rate"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Click Rate"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Enrolled"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Actions"})]})}),e.jsx("tbody",{children:h.map(o=>e.jsx(m,{automation:o,onEdit:b,onToggle:j,hasVerifiedDomain:x,theme:t},o.id))})]})}):e.jsxs("div",{style:{padding:"60px 20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"⚡"}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:t.text,marginBottom:"8px"},children:"No default automations"}),e.jsx("p",{style:{fontSize:"14px",color:t.textSecondary,marginBottom:"24px"},children:"Default automations will appear here when available."})]})}),d==="my"&&e.jsx(e.Fragment,{children:i?e.jsx("div",{style:{backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,padding:"20px"},children:Array.from({length:3}).map((o,l)=>e.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:l>0?`1px solid ${t.border}`:"none"},children:[e.jsx(c,{width:"36px",height:"36px"}),e.jsxs("div",{style:{flex:1},children:[e.jsx(c,{width:"200px",height:"16px"}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(c,{width:"120px",height:"12px"})})]})]},l))}):f.length>0?e.jsx("div",{style:{backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:t.bgHover},children:[e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Automation"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Status"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Sent"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Open Rate"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Click Rate"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Enrolled"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Actions"})]})}),e.jsx("tbody",{children:f.map(o=>e.jsx(m,{automation:o,onEdit:b,onToggle:j,hasVerifiedDomain:x,theme:t},o.id))})]})}):e.jsxs("div",{style:{padding:"60px 20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"⚡"}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:t.text,marginBottom:"8px"},children:"No custom automations yet"}),e.jsx("p",{style:{fontSize:"14px",color:t.textSecondary,marginBottom:"24px"},children:"Create your own automation or clone an existing one to get started."}),e.jsx("button",{onClick:u,style:{padding:"10px 20px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Custom"})]})})]})};export{_ as default};
