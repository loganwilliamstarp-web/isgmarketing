import{Q as Ue,u as F,a as xe,b as D,j as e,c as Ge}from"./query-CW7cajfZ.js";import{a as Ke,u as P,L as Z,b as ie,r as k,R as oe,c as Re,B as Ve,d as $e,e as H}from"./vendor-CJJr1Dh-.js";import{c as Qe}from"./supabase-GtAdROLV.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();var be={},Se=Ke;be.createRoot=Se.createRoot,be.hydrateRoot=Se.hydrateRoot;var Ye=function(){return null};const Je=new Ue({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*30,retry:1,refetchOnWindowFocus:!0,refetchOnMount:!0},mutations:{retry:0}}}),Xe=void 0,Ze=void 0;throw new Error("Missing Supabase environment variables");const u=Qe(Xe,Ze),te={async getAll(t,o={}){const{category:i,isDefault:r,search:n}=o;let a=u.from("email_templates").select("*").eq("owner_id",t).order("is_default",{ascending:!1}).order("name");i&&(a=a.eq("category",i)),typeof r=="boolean"&&(a=a.eq("is_default",r)),n&&(a=a.or(`name.ilike.%${n}%,subject.ilike.%${n}%`));const{data:s,error:d}=await a;if(d)throw d;return s},async getById(t,o){const{data:i,error:r}=await u.from("email_templates").select("*").eq("owner_id",t).eq("id",o).single();if(r)throw r;return i},async getByDefaultKey(t,o){const{data:i,error:r}=await u.from("email_templates").select("*").eq("owner_id",t).eq("default_key",o).single();if(r)throw r;return i},async create(t,o){const{data:i,error:r}=await u.from("email_templates").insert({owner_id:t,is_default:!1,...o}).select().single();if(r)throw r;return i},async update(t,o,i){const{data:r,error:n}=await u.from("email_templates").update({...i,updated_at:new Date().toISOString()}).eq("owner_id",t).eq("id",o).select().single();if(n)throw n;return r},async delete(t,o){const{error:i}=await u.from("email_templates").delete().eq("owner_id",t).eq("id",o).eq("is_default",!1);if(i)throw i;return!0},async duplicate(t,o){const i=await this.getById(t,o),{data:r,error:n}=await u.from("email_templates").insert({owner_id:t,is_default:!1,default_key:null,name:`${i.name} (Copy)`,subject:i.subject,body_html:i.body_html,body_text:i.body_text,category:i.category,merge_fields:i.merge_fields}).select().single();if(n)throw n;return r},async getByCategory(t,o){const{data:i,error:r}=await u.from("email_templates").select("*").eq("owner_id",t).eq("category",o).order("is_default",{ascending:!1}).order("name");if(r)throw r;return i},async getCategories(t){const{data:o,error:i}=await u.from("email_templates").select("category").eq("owner_id",t).not("category","is",null);if(i)throw i;return[...new Set(o.map(r=>r.category))]},async resetToDefault(t,o){return this.getById(t,o)}},ve=()=>{const{userId:t}=P();return t};function Ie(t={}){const o=ve();return F({queryKey:["templates",o,t],queryFn:()=>te.getAll(o,t),enabled:!!o})}function et(){const t=ve();return F({queryKey:["templates",t,"categories"],queryFn:()=>te.getCategories(t),enabled:!!t})}function Ae(){const t=ve(),o=xe(),i=()=>{o.invalidateQueries({queryKey:["templates",t]})},r=D({mutationFn:d=>te.create(t,d),onSuccess:i}),n=D({mutationFn:({templateId:d,updates:c})=>te.update(t,d,c),onSuccess:d=>{i(),o.setQueryData(["template",t,d.id],d)}}),a=D({mutationFn:d=>te.delete(t,d),onSuccess:i}),s=D({mutationFn:d=>te.duplicate(t,d),onSuccess:i});return{createTemplate:r,updateTemplate:n,deleteTemplate:a,duplicateTemplate:s}}const N={async getAll(t,o={}){const{status:i,category:r,search:n}=o;let a=u.from("automations").select(`
        *,
        _count:automation_enrollments(count)
      `).eq("owner_id",t).order("is_default",{ascending:!1}).order("name");i&&(a=a.eq("status",i)),r&&(a=a.eq("category",r)),n&&(a=a.or(`name.ilike.%${n}%,description.ilike.%${n}%`));const{data:s,error:d}=await a;if(d)throw d;return s},async getAllWithStats(t){const{data:o,error:i}=await u.from("automations").select("*").eq("owner_id",t).order("is_default",{ascending:!1}).order("name");if(i)throw i;const r=o.map(d=>d.id),{data:n,error:a}=await u.from("automation_enrollments").select("automation_id, status").in("automation_id",r);if(a)throw a;const s={};return n.forEach(d=>{s[d.automation_id]||(s[d.automation_id]={total:0,active:0,completed:0,exited:0}),s[d.automation_id].total++,s[d.automation_id][d.status.toLowerCase()]++}),o.map(d=>({...d,enrollmentStats:s[d.id]||{total:0,active:0,completed:0,exited:0}}))},async getById(t,o){const{data:i,error:r}=await u.from("automations").select("*").eq("owner_id",t).eq("id",o).single();if(r)throw r;return i},async getByIdWithDetails(t,o){const i=await this.getById(t,o),{data:r,error:n}=await u.from("automation_enrollments").select("status").eq("automation_id",o);if(n)throw n;const a={total:r.length,active:r.filter(l=>l.status==="Active").length,completed:r.filter(l=>l.status==="Completed").length,exited:r.filter(l=>l.status==="Exited").length,paused:r.filter(l=>l.status==="Paused").length},{data:s,error:d}=await u.from("email_logs").select("status, open_count, click_count").eq("automation_id",o);if(d)throw d;const c={sent:s.length,delivered:s.filter(l=>l.status==="Delivered"||l.status==="Opened"||l.status==="Clicked").length,opened:s.filter(l=>l.open_count>0).length,clicked:s.filter(l=>l.click_count>0).length,bounced:s.filter(l=>l.status==="Bounced").length};return{...i,enrollmentStats:a,emailSummary:c}},async getByDefaultKey(t,o){const{data:i,error:r}=await u.from("automations").select("*").eq("owner_id",t).eq("default_key",o).single();if(r)throw r;return i},async create(t,o){const{data:i,error:r}=await u.from("automations").insert({owner_id:t,is_default:!1,status:"Draft",...o}).select().single();if(r)throw r;return i},async update(t,o,i){const{data:r,error:n}=await u.from("automations").update({...i,updated_at:new Date().toISOString()}).eq("owner_id",t).eq("id",o).select().single();if(n)throw n;return r},async updateStatus(t,o,i){return this.update(t,o,{status:i})},async activate(t,o){return this.updateStatus(t,o,"active")},async pause(t,o){return this.updateStatus(t,o,"paused")},async archive(t,o){return this.updateStatus(t,o,"archived")},async delete(t,o){const{error:i}=await u.from("automations").delete().eq("owner_id",t).eq("id",o).eq("is_default",!1);if(i)throw i;return!0},async duplicate(t,o){const i=await this.getById(t,o),{data:r,error:n}=await u.from("automations").insert({owner_id:t,is_default:!1,default_key:null,name:`${i.name} (Copy)`,description:i.description,category:i.category,status:"Draft",send_time:i.send_time,timezone:i.timezone,frequency:i.frequency,max_enrollments:i.max_enrollments,enrollment_cooldown_days:i.enrollment_cooldown_days,distribute_evenly:i.distribute_evenly,filter_config:i.filter_config,nodes:i.nodes}).select().single();if(n)throw n;return r},async updateFilters(t,o,i){return this.update(t,o,{filter_config:i})},async updateNodes(t,o,i){return this.update(t,o,{nodes:i})},async updateSchedule(t,o,i){const{sendTime:r,timezone:n,frequency:a}=i;return this.update(t,o,{send_time:r,timezone:n,frequency:a})},async updateEnrollmentRules(t,o,i){const{maxEnrollments:r,cooldownDays:n,distributeEvenly:a}=i;return this.update(t,o,{max_enrollments:r,enrollment_cooldown_days:n,distribute_evenly:a})},async getByStatus(t,o){const{data:i,error:r}=await u.from("automations").select("*").eq("owner_id",t).eq("status",o).order("name");if(r)throw r;return i},async getActive(t){return this.getByStatus(t,"Active")},async getCategories(t){const{data:o,error:i}=await u.from("automations").select("category").eq("owner_id",t).not("category","is",null);if(i)throw i;return[...new Set(o.map(r=>r.category))]}},je=()=>{const{userId:t}=P();return t};function tt(){const t=je();return F({queryKey:["automations",t,"withStats"],queryFn:()=>N.getAllWithStats(t),enabled:!!t})}function ot(t){const o=je();return F({queryKey:["automation",o,t],queryFn:()=>N.getById(o,t),enabled:!!o&&!!t})}function Te(){const t=je(),o=xe(),i=()=>{o.invalidateQueries({queryKey:["automations",t]})},r=D({mutationFn:h=>N.create(t,h),onSuccess:i}),n=D({mutationFn:({automationId:h,updates:w})=>N.update(t,h,w),onSuccess:h=>{i(),o.setQueryData(["automation",t,h.id],h)}}),a=D({mutationFn:h=>N.delete(t,h),onSuccess:i}),s=D({mutationFn:h=>N.duplicate(t,h),onSuccess:i}),d=D({mutationFn:h=>N.activate(t,h),onSuccess:h=>{i(),o.setQueryData(["automation",t,h.id],h)}}),c=D({mutationFn:h=>N.pause(t,h),onSuccess:h=>{i(),o.setQueryData(["automation",t,h.id],h)}}),l=D({mutationFn:h=>N.archive(t,h),onSuccess:i}),b=D({mutationFn:({automationId:h,filterConfig:w})=>N.updateFilters(t,h,w),onSuccess:h=>{o.setQueryData(["automation",t,h.id],h)}}),x=D({mutationFn:({automationId:h,nodes:w})=>N.updateNodes(t,h,w),onSuccess:h=>{o.setQueryData(["automation",t,h.id],h)}}),_=D({mutationFn:({automationId:h,scheduleConfig:w})=>N.updateSchedule(t,h,w),onSuccess:h=>{o.setQueryData(["automation",t,h.id],h)}}),v=D({mutationFn:({automationId:h,rules:w})=>N.updateEnrollmentRules(t,h,w),onSuccess:h=>{o.setQueryData(["automation",t,h.id],h)}});return{createAutomation:r,updateAutomation:n,deleteAutomation:a,duplicateAutomation:s,activateAutomation:d,pauseAutomation:c,archiveAutomation:l,updateFilters:b,updateNodes:x,updateSchedule:_,updateEnrollmentRules:v}}const it={async getByAutomation(t,o={}){const{status:i,limit:r=50,offset:n=0}=o;let a=u.from("automation_enrollments").select(`
        *,
        account:accounts(
          account_unique_id,
          name,
          person_email,
          email,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("automation_id",t).order("enrolled_at",{ascending:!1}).range(n,n+r-1);i&&(a=a.eq("status",i));const{data:s,error:d}=await a;if(d)throw d;return s},async getByAccount(t,o={}){const{status:i}=o;let r=u.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category, status)
      `).eq("account_id",t).order("enrolled_at",{ascending:!1});i&&(r=r.eq("status",i));const{data:n,error:a}=await r;if(a)throw a;return n},async getById(t){const{data:o,error:i}=await u.from("automation_enrollments").select(`
        *,
        account:accounts(*),
        automation:automations(*)
      `).eq("id",t).single();if(i)throw i;return o},async getStats(t){const{data:o,error:i}=await u.from("automation_enrollments").select("status, emails_sent, emails_opened, emails_clicked").eq("automation_id",t);if(i)throw i;const r={total:o.length,active:0,completed:0,exited:0,paused:0,totalEmailsSent:0,totalOpens:0,totalClicks:0};return o.forEach(n=>{r[n.status.toLowerCase()]++,r.totalEmailsSent+=n.emails_sent||0,r.totalOpens+=n.emails_opened||0,r.totalClicks+=n.emails_clicked||0}),r},async canEnroll(t,o){const{data:i,error:r}=await u.rpc("can_enroll_in_automation",{p_account_id:t,p_automation_id:o});if(r)throw r;return i},async enroll(t,o,i={}){var l;if(!await this.canEnroll(o,t))throw new Error("Account cannot be enrolled in this automation");const{data:n,error:a}=await u.from("automations").select("nodes").eq("id",t).single();if(a)throw a;const s=(l=n.nodes)==null?void 0:l[0],{data:d,error:c}=await u.from("automation_enrollments").insert({automation_id:t,account_id:o,status:"Active",current_node_id:(s==null?void 0:s.id)||null,metadata:i}).select().single();if(c)throw c;return d},async bulkEnroll(t,o){const i={enrolled:[],skipped:[],errors:[]};for(const r of o)try{if(await this.canEnroll(r,t)){const a=await this.enroll(t,r);i.enrolled.push(a)}else i.skipped.push(r)}catch(n){i.errors.push({accountId:r,error:n.message})}return i},async exit(t,o="manual"){const{data:i,error:r}=await u.from("automation_enrollments").update({status:"Exited",exit_reason:o,exited_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",t).select().single();if(r)throw r;return i},async pause(t){const{data:o,error:i}=await u.from("automation_enrollments").update({status:"Paused",updated_at:new Date().toISOString()}).eq("id",t).select().single();if(i)throw i;return o},async resume(t){const{data:o,error:i}=await u.from("automation_enrollments").update({status:"Active",updated_at:new Date().toISOString()}).eq("id",t).select().single();if(i)throw i;return o},async complete(t){const{data:o,error:i}=await u.from("automation_enrollments").update({status:"Completed",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",t).select().single();if(i)throw i;return o},async updateProgress(t,o,i=null){const{data:r,error:n}=await u.from("automation_enrollments").update({current_node_id:o,current_branch:i,last_action_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",t).select().single();if(n)throw n;return r},async setNextAction(t,o){const{data:i,error:r}=await u.from("automation_enrollments").update({next_action_at:o,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(r)throw r;return i},async incrementEmailSent(t){const{data:o,error:i}=await u.rpc("increment_enrollment_email_sent",{p_enrollment_id:t});if(i){const{data:r}=await u.from("automation_enrollments").select("emails_sent").eq("id",t).single();return u.from("automation_enrollments").update({emails_sent:((r==null?void 0:r.emails_sent)||0)+1}).eq("id",t)}return o},async getReadyForAction(){const{data:t,error:o}=await u.from("automation_enrollments").select(`
        *,
        automation:automations(*),
        account:accounts(*)
      `).eq("status","Active").lte("next_action_at",new Date().toISOString()).order("next_action_at");if(o)throw o;return t},async getHistory(t){const{data:o,error:i}=await u.from("enrollment_history").select(`
        *,
        email_log:email_logs(id, subject, status, sent_at, first_opened_at, first_clicked_at)
      `).eq("enrollment_id",t).order("created_at",{ascending:!0});if(i)throw i;return o},async logHistory(t,o){const{data:i,error:r}=await u.from("enrollment_history").insert({enrollment_id:t,...o}).select().single();if(r)throw r;return i}};function nt(t,o={}){return F({queryKey:["enrollments","account",t,o],queryFn:()=>it.getByAccount(t,o),enabled:!!t,staleTime:3e4})}const ce={async getAll(t,o={}){const{status:i,automationId:r,accountId:n,limit:a=50,offset:s=0,startDate:d,endDate:c}=o;let l=u.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email, primary_contact_first_name),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",t).order("created_at",{ascending:!1}).range(s,s+a-1);i&&(l=l.eq("status",i)),r&&(l=l.eq("automation_id",r)),n&&(l=l.eq("account_id",n)),d&&(l=l.gte("sent_at",d)),c&&(l=l.lte("sent_at",c));const{data:b,error:x}=await l;if(x)throw x;return b},async getById(t,o){const{data:i,error:r}=await u.from("email_logs").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name),
        enrollment:automation_enrollments(id, status)
      `).eq("owner_id",t).eq("id",o).single();if(r)throw r;return i},async getByIdWithEvents(t,o){const i=await this.getById(t,o),{data:r,error:n}=await u.from("email_events").select("*").eq("email_log_id",o).order("event_timestamp",{ascending:!0});if(n)throw n;return{...i,events:r}},async getByAccount(t,o,i={}){const{limit:r=20}=i,{data:n,error:a}=await u.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",t).eq("account_id",o).order("created_at",{ascending:!1}).limit(r);if(a)throw a;return n},async getByAutomation(t,o,i={}){const{limit:r=50,offset:n=0,status:a}=i;let s=u.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",t).eq("automation_id",o).order("created_at",{ascending:!1}).range(n,n+r-1);a&&(s=s.eq("status",a));const{data:d,error:c}=await s;if(c)throw c;return d},async create(t,o){const{data:i,error:r}=await u.from("email_logs").insert({owner_id:t,status:"Queued",...o}).select().single();if(r)throw r;return i},async updateStatus(t,o,i,r={}){const{data:n,error:a}=await u.from("email_logs").update({status:i,...r,updated_at:new Date().toISOString()}).eq("owner_id",t).eq("id",o).select().single();if(a)throw a;return n},async markSent(t,o,i){return this.updateStatus(t,o,"Sent",{sent_at:new Date().toISOString(),sendgrid_message_id:i})},async markFailed(t,o,i,r=null){return this.updateStatus(t,o,"Failed",{failed_at:new Date().toISOString(),error_message:i,error_code:r})},async getRecentOpens(t,o=10){const{data:i,error:r}=await u.from("email_logs").select(`
        id, subject, first_opened_at, open_count,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",t).not("first_opened_at","is",null).order("first_opened_at",{ascending:!1}).limit(o);if(r)throw r;return i},async getRecentClicks(t,o=10){const{data:i,error:r}=await u.from("email_logs").select(`
        id, subject, first_clicked_at, click_count,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",t).not("first_clicked_at","is",null).order("first_clicked_at",{ascending:!1}).limit(o);if(r)throw r;return i},async getBounces(t,o={}){const{limit:i=50,offset:r=0}=o,{data:n,error:a}=await u.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",t).eq("status","Bounced").order("bounced_at",{ascending:!1}).range(r,r+i-1);if(a)throw a;return n},async getStats(t,o,i,r=null){const{data:n,error:a}=await u.rpc("get_email_stats",{p_owner_id:t,p_start_date:o,p_end_date:i,p_automation_id:r});if(a)throw a;return(n==null?void 0:n[0])||{total_sent:0,total_delivered:0,total_opened:0,unique_opens:0,total_clicked:0,unique_clicks:0,total_bounced:0,open_rate:0,click_rate:0}},async getDailyStats(t,o,i,r=null){let n=u.from("email_stats_daily").select("*").eq("owner_id",t).gte("stat_date",o).lte("stat_date",i).order("stat_date");r?n=n.eq("automation_id",r):n=n.is("automation_id",null);const{data:a,error:s}=await n;if(s)throw s;return a},async getComparisonStats(t,o=30){const i=new Date,r=new Date(i);r.setDate(r.getDate()-o);const n=new Date(r);n.setDate(n.getDate()-o);const[a,s]=await Promise.all([this.getStats(t,r.toISOString().split("T")[0],i.toISOString().split("T")[0]),this.getStats(t,n.toISOString().split("T")[0],r.toISOString().split("T")[0])]),d=(c,l)=>l===0?c>0?100:0:((c-l)/l*100).toFixed(1);return{current:a,previous:s,changes:{sent:d(a.total_sent,s.total_sent),delivered:d(a.total_delivered,s.total_delivered),opened:d(a.unique_opens,s.unique_opens),clicked:d(a.unique_clicks,s.unique_clicks),bounced:d(a.total_bounced,s.total_bounced)}}}},rt=()=>{const{userId:t}=P();return t};function at(t,o={}){const i=rt();return F({queryKey:["emailLogs",i,"account",t,o],queryFn:()=>ce.getByAccount(i,t,o),enabled:!!i&&!!t,staleTime:3e4})}const Be={async getRecent(t,o={}){const{category:i,limit:r=20,offset:n=0}=o;let a=u.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name),
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).eq("owner_id",t).order("created_at",{ascending:!1}).range(n,n+r-1);i&&(a=a.eq("event_category",i));const{data:s,error:d}=await a;if(d)throw d;return s},async getByAccount(t,o,i=20){const{data:r,error:n}=await u.from("activity_log").select(`
        *,
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).eq("owner_id",t).eq("account_id",o).order("created_at",{ascending:!1}).limit(i);if(n)throw n;return r},async getByAutomation(t,o,i=50){const{data:r,error:n}=await u.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("owner_id",t).eq("automation_id",o).order("created_at",{ascending:!1}).limit(i);if(n)throw n;return r},async getByType(t,o,i={}){const{limit:r=50,offset:n=0}=i,{data:a,error:s}=await u.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("owner_id",t).eq("event_type",o).order("created_at",{ascending:!1}).range(n,n+r-1);if(s)throw s;return a},async log(t,o){const{data:i,error:r}=await u.from("activity_log").insert({owner_id:t,...o}).select().single();if(r)throw r;return i},async logEmailSent(t,o,i,r=null){return this.log(t,{event_type:"email_sent",event_category:"email",title:"Email sent",email_log_id:o,account_id:i,automation_id:r,actor_type:r?"automation":"user"})},async logEmailOpened(t,o,i){return this.log(t,{event_type:"email_opened",event_category:"email",title:"Email opened",email_log_id:o,account_id:i,actor_type:"system"})},async logEmailClicked(t,o,i,r=null){return this.log(t,{event_type:"email_clicked",event_category:"email",title:"Email link clicked",email_log_id:o,account_id:i,actor_type:"system",event_data:r?{url:r}:{}})},async logEnrollment(t,o,i,r){return this.log(t,{event_type:"enrollment_created",event_category:"automation",title:`Enrolled in ${r}`,automation_id:o,account_id:i,actor_type:"automation"})},async logAutomationCompleted(t,o,i,r){return this.log(t,{event_type:"automation_completed",event_category:"automation",title:`Completed ${r}`,automation_id:o,account_id:i,actor_type:"automation"})},async logUnsubscribe(t,o,i,r=null){return this.log(t,{event_type:"unsubscribed",event_category:"account",title:i==="all"?"Unsubscribed from all emails":"Unsubscribed from automation",account_id:o,automation_id:r,actor_type:"system",severity:"warning"})},async logBounce(t,o,i,r){return this.log(t,{event_type:"email_bounced",event_category:"email",title:`Email bounced (${r})`,email_log_id:o,account_id:i,actor_type:"system",severity:"warning",event_data:{bounce_type:r}})},async getStats(t,o=7){const i=new Date;i.setDate(i.getDate()-o);const{data:r,error:n}=await u.from("activity_log").select("event_type, event_category").eq("owner_id",t).gte("created_at",i.toISOString());if(n)throw n;const a={total:r.length,byType:{},byCategory:{}};return r.forEach(s=>{a.byType[s.event_type]=(a.byType[s.event_type]||0)+1,a.byCategory[s.event_category]=(a.byCategory[s.event_category]||0)+1}),a}},We={async getAll(t,o={}){const{status:i,automationId:r,limit:n=50,offset:a=0}=o;let s=u.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",t).order("scheduled_for",{ascending:!0}).range(a,a+n-1);i&&(s=s.eq("status",i)),r&&(s=s.eq("automation_id",r));const{data:d,error:c}=await s;if(c)throw c;return d},async getUpcoming(t,o=10){const{data:i,error:r}=await u.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        automation:automations(id, name)
      `).eq("owner_id",t).eq("status","Pending").gte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0}).limit(o);if(r)throw r;return i},async getReadyToSend(){const{data:t,error:o}=await u.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name, owner_id)
      `).eq("status","Pending").lte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0});if(o)throw o;return t},async getById(t,o){const{data:i,error:r}=await u.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name)
      `).eq("owner_id",t).eq("id",o).single();if(r)throw r;return i},async create(t,o){const{data:i,error:r}=await u.from("scheduled_emails").insert({owner_id:t,status:"Pending",...o}).select().single();if(r)throw r;return i},async createBatch(t,o){const i=o.map(a=>({owner_id:t,status:"Pending",...a})),{data:r,error:n}=await u.from("scheduled_emails").insert(i).select();if(n)throw n;return r},async update(t,o,i){const{data:r,error:n}=await u.from("scheduled_emails").update({...i,updated_at:new Date().toISOString()}).eq("owner_id",t).eq("id",o).select().single();if(n)throw n;return r},async cancel(t,o){return this.update(t,o,{status:"Cancelled"})},async reschedule(t,o,i){return this.update(t,o,{scheduled_for:i,status:"Pending",attempts:0})},async markProcessing(t){const{data:o,error:i}=await u.from("scheduled_emails").update({status:"Processing",last_attempt_at:new Date().toISOString(),attempts:u.sql`attempts + 1`,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(i)throw i;return o},async markSent(t,o){const{data:i,error:r}=await u.from("scheduled_emails").update({status:"Sent",email_log_id:o,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(r)throw r;return i},async markFailed(t,o){const{data:i,error:r}=await u.from("scheduled_emails").select("attempts, max_attempts").eq("id",t).single();if(r)throw r;const n=i.attempts<i.max_attempts,{data:a,error:s}=await u.from("scheduled_emails").update({status:n?"Pending":"Failed",error_message:o,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(s)throw s;return a},async delete(t,o){const{error:i}=await u.from("scheduled_emails").delete().eq("owner_id",t).eq("id",o);if(i)throw i;return!0},async getStats(t){const{data:o,error:i}=await u.from("scheduled_emails").select("status, scheduled_for").eq("owner_id",t);if(i)throw i;const r=new Date,n={pending:0,processing:0,sent:0,failed:0,cancelled:0,upcomingToday:0,upcomingThisWeek:0},a=new Date(r);a.setHours(23,59,59,999);const s=new Date(r);return s.setDate(s.getDate()+7),o.forEach(d=>{if(n[d.status.toLowerCase()]++,d.status==="Pending"){const c=new Date(d.scheduled_for);c<=a&&n.upcomingToday++,c<=s&&n.upcomingThisWeek++}}),n}},se={async getAll(t,o={}){const{status:i,search:r,limit:n=25,offset:a=0,expiring:s=!1}=o;let d=u.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",t);if(i){let z=i;i.toLowerCase()==="prior"&&(z="prior_customer"),d=d.ilike("account_status",z)}r&&(d=d.or(`name.ilike.%${r}%,person_email.ilike.%${r}%,email.ilike.%${r}%`));const{count:c,error:l}=await d;if(l)throw l;let b=u.from("accounts").select("*").eq("owner_id",t).order("name").range(a,a+n-1);if(i){let z=i;i.toLowerCase()==="prior"&&(z="prior_customer"),b=b.ilike("account_status",z)}r&&(b=b.or(`name.ilike.%${r}%,person_email.ilike.%${r}%,email.ilike.%${r}%`));const{data:x,error:_}=await b;if(_)throw _;if(!x||x.length===0)return{accounts:[],total:c||0};const v=x.map(z=>z.account_unique_id).filter(Boolean),w=new Date().toISOString().split("T")[0],y=new Date;y.setDate(y.getDate()+30);const g=y.toISOString().split("T")[0];if(v.length>0){const{data:z,error:I}=await u.from("policies").select("account_id, policy_lob, policy_status, expiration_date").in("account_id",v);if(!I&&z){const C={};z.forEach(m=>{var q;C[m.account_id]||(C[m.account_id]=[]);const R=m.expiration_date&&m.expiration_date>=w&&m.expiration_date<=g;C[m.account_id].push({policy_type:m.policy_lob,status:((q=m.policy_status)==null?void 0:q.toLowerCase())||"unknown",expiration_date:m.expiration_date,is_expiring:R})}),x.forEach(m=>{m.policies=C[m.account_unique_id]||[],m.policy_count=m.policies.length,m.has_expiring_policy=m.policies.some(R=>R.is_expiring),m.expiring_policy_count=m.policies.filter(R=>R.is_expiring).length})}}if(s){const z=x.filter(I=>I.has_expiring_policy);return{accounts:z,total:z.length,isExpiringFilter:!0}}return{accounts:x,total:c||0}},async getStats(t){const{count:o,error:i}=await u.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",t);if(i)throw i;const{count:r}=await u.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",t).ilike("account_status","customer"),{count:n}=await u.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",t).ilike("account_status","prospect"),{count:a}=await u.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",t).ilike("account_status","prior_customer"),{count:s}=await u.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",t).ilike("account_status","lead");let d=0;const c=new Date().toISOString().split("T")[0],l=new Date;l.setDate(l.getDate()+30);const b=l.toISOString().split("T")[0],{count:x}=await u.from("policies").select("*",{count:"exact",head:!0}).gte("expiration_date",c).lte("expiration_date",b);if(x&&x>0){const{data:_}=await u.from("policies").select("account_id").gte("expiration_date",c).lte("expiration_date",b).limit(5e3);if(_&&_.length>0){const v=[...new Set(_.map(h=>h.account_id).filter(Boolean))];if(v.length>0){let h=0;const w=100;for(let y=0;y<v.length;y+=w){const g=v.slice(y,y+w),{count:z}=await u.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",t).in("account_unique_id",g);h+=z||0}d=h}}}return{Customer:r||0,Prospect:n||0,Prior:a||0,Lead:s||0,total:o||0,expiring:d}},async getById(t){const{data:o,error:i}=await u.from("accounts").select("*").eq("account_unique_id",t).single();if(i)throw i;return o},async getByIdWithPolicies(t){const{data:o,error:i}=await u.from("accounts").select("*").eq("account_unique_id",t).single();if(i)throw i;if(!o)return null;const{data:r,error:n}=await u.from("policies").select("*").eq("account_id",t).order("expiration_date",{ascending:!1});if(n)return console.error("Error fetching policies:",n),{...o,policies:[]};if(r&&r.length>0){const a=[...new Set(r.map(s=>s.carrier_id).filter(Boolean))];if(a.length>0){const{data:s,error:d}=await u.from("carriers").select("id, name").in("id",a);if(s&&s.length>0){const c={};s.forEach(l=>{c[l.id]=l.name}),r.forEach(l=>{l.carrier_id&&c[l.carrier_id]&&(l.carrier={name:c[l.carrier_id]})})}}}return{...o,policies:r||[]}},async getByIdWithEmailHistory(t,o){const i=await this.getByIdWithPolicies(o),{data:r,error:n}=await u.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",t).eq("account_id",o).order("created_at",{ascending:!1}).limit(20);if(n)throw n;const{data:a,error:s}=await u.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category)
      `).eq("account_id",o).order("enrolled_at",{ascending:!1});if(s)throw s;return{...i,emailLogs:r,enrollments:a}},async search(t,o,i=20){const{data:r,error:n}=await u.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name").eq("owner_id",t).or(`name.ilike.%${o}%,person_email.ilike.%${o}%,email.ilike.%${o}%,primary_contact_first_name.ilike.%${o}%,primary_contact_last_name.ilike.%${o}%`).limit(i);if(n)throw n;return r},async getByStatus(t,o,i={}){const{limit:r=50,offset:n=0}=i,{data:a,error:s}=await u.from("accounts").select("*").eq("owner_id",t).eq("account_status",o).order("name").range(n,n+r-1);if(s)throw s;return a},async getCustomers(t,o={}){return this.getByStatus(t,"customer",o)},async getProspects(t,o={}){return this.getByStatus(t,"prospect",o)},async getPriorCustomers(t,o={}){return this.getByStatus(t,"prior_customer",o)},async getWithExpiringPolicies(t,o=45){const i=new Date;i.setDate(i.getDate()+o);const{data:r,error:n}=await u.from("policies").select(`
        policy_unique_id,
        policy_lob,
        expiration_date,
        policy_status,
        account_id,
        account:accounts!policies_account_id_fkey(
          account_unique_id,
          name,
          person_email,
          email,
          owner_id,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("policy_status","Active").lte("expiration_date",i.toISOString().split("T")[0]).gte("expiration_date",new Date().toISOString().split("T")[0]).order("expiration_date");if(n)throw n;return r.filter(a=>{var s;return((s=a.account)==null?void 0:s.owner_id)===t})},async getCounts(t){const{data:o,error:i}=await u.from("accounts").select("account_status").eq("owner_id",t);if(i)throw i;const r={total:o.length,customer:0,prospect:0,prior_customer:0,other:0};return o.forEach(n=>{var s;const a=((s=n.account_status)==null?void 0:s.toLowerCase().replace(" ","_"))||"other";r[a]!==void 0?r[a]++:r.other++}),r},getEmail(t){return t.person_email||t.email},getDisplayName(t){return t.primary_contact_first_name?`${t.primary_contact_first_name} ${t.primary_contact_last_name||""}`.trim():t.name},canReceiveMarketing(t){return t.user_subscribed_to_marketing!==!1&&t.person_has_opted_out_of_email!==!0&&(t.person_email||t.email)},async getEligibleForAutomation(t,o){let i=u.from("accounts").select("*").eq("owner_id",t).or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false").not("person_email","is",null);const{data:r,error:n}=await i;if(n)throw n;const a=r.map(l=>l.account_unique_id),{data:s,error:d}=await u.from("policies").select("*").in("account_id",a);if(d)throw d;return r.map(l=>({...l,policies:s.filter(b=>b.account_id===l.account_unique_id)})).filter(l=>this.canReceiveMarketing(l))}},qe={async getDashboardData(t,o={}){const{days:i=30}=o,[r,n,a,s,d,c,l]=await Promise.all([ce.getComparisonStats(t,i),Be.getRecent(t,{limit:10}),We.getUpcoming(t,5),ce.getRecentOpens(t,5),ce.getRecentClicks(t,5),se.getCounts(t),this.getAutomationStats(t)]);return{emailStats:r.current,emailChanges:r.changes,recentActivity:n,scheduledEmails:a,recentOpens:s,recentClicks:d,accountCounts:c,automationStats:l}},async getAutomationStats(t){const{data:o,error:i}=await u.from("automations").select(`
        id,
        name,
        status,
        stats
      `).eq("owner_id",t).eq("status","Active");if(i)throw i;const r=o.map(d=>d.id),{data:n,error:a}=await u.from("automation_enrollments").select("automation_id, status").in("automation_id",r);if(a)throw a;const s={};return n.forEach(d=>{s[d.automation_id]||(s[d.automation_id]={active:0,total:0}),s[d.automation_id].total++,d.status==="Active"&&s[d.automation_id].active++}),{total:o.length,active:o.filter(d=>d.status==="Active").length,automations:o.map(d=>{var c,l;return{...d,enrollmentCount:((c=s[d.id])==null?void 0:c.total)||0,activeEnrollments:((l=s[d.id])==null?void 0:l.active)||0}})}},async getEmailPerformanceOverTime(t,o=30){const i=new Date;i.setDate(i.getDate()-o);const{data:r,error:n}=await u.from("email_stats_daily").select("*").eq("owner_id",t).is("automation_id",null).gte("stat_date",i.toISOString().split("T")[0]).order("stat_date");if(n)throw n;return r},async getTopAutomations(t,o=5){const{data:i,error:r}=await u.from("automations").select("id, name, stats").eq("owner_id",t).eq("status","Active");if(r)throw r;return i.map(a=>{var s,d,c,l,b;return{...a,sent:((s=a.stats)==null?void 0:s.sent)||0,opened:((d=a.stats)==null?void 0:d.opened)||0,clicked:((c=a.stats)==null?void 0:c.clicked)||0,openRate:((l=a.stats)==null?void 0:l.sent)>0?(((b=a.stats)==null?void 0:b.opened)||0)/a.stats.sent*100:0}}).sort((a,s)=>s.openRate-a.openRate).slice(0,o)},async getAccountsNeedingAttention(t){const{data:o,error:i}=await u.from("email_logs").select(`
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",t).eq("status","Bounced").not("account_id","is",null).limit(10);if(i)throw i;const r=await se.getWithExpiringPolicies(t,30);return{bouncedEmails:o.map(n=>n.account).filter((n,a,s)=>s.findIndex(d=>d.account_unique_id===n.account_unique_id)===a),expiringPolicies:r.slice(0,10)}},async getQuickStats(t){const o=new Date().toISOString().split("T")[0],i=new Date;i.setDate(i.getDate()-30);const[{count:r},{count:n},{count:a},{count:s}]=await Promise.all([u.from("email_logs").select("*",{count:"exact",head:!0}).eq("owner_id",t).gte("sent_at",o),u.from("email_logs").select("*",{count:"exact",head:!0}).eq("owner_id",t).gte("first_opened_at",o),u.from("automations").select("*",{count:"exact",head:!0}).eq("owner_id",t).eq("status","Active"),u.from("scheduled_emails").select("*",{count:"exact",head:!0}).eq("owner_id",t).eq("status","Pending")]);return{emailsToday:r||0,opensToday:n||0,activeAutomations:a||0,pendingScheduled:s||0}}},Ee=()=>{const{userId:t}=P();return t};function Me(){const t=Ee();return F({queryKey:["dashboard",t,"quick"],queryFn:()=>qe.getQuickStats(t),enabled:!!t,staleTime:1e4,refetchInterval:3e4})}function st(t=30){const o=Ee();return F({queryKey:["dashboard",o,"performance",t],queryFn:()=>qe.getEmailPerformanceOverTime(o,t),enabled:!!o})}const ee={async get(t){const{data:o,error:i}=await u.from("user_settings").select("*").eq("user_id",t).single();if(i&&i.code!=="PGRST116")throw i;return o},async getWithUser(t){const{data:o,error:i}=await u.from("user_settings").select(`
        *,
        user:users(user_unique_id, email, first_name, last_name, role_name, profile_name)
      `).eq("user_id",t).single();if(i&&i.code!=="PGRST116")throw i;return o},async create(t,o={}){const{data:i,error:r}=await u.from("user_settings").insert({user_id:t,...o}).select().single();if(r)throw r;return i},async update(t,o){const{data:i,error:r}=await u.from("user_settings").update({...o,updated_at:new Date().toISOString()}).eq("user_id",t).select().single();if(r)throw r;return i},async updateSignature(t,o){const{signatureName:i,signatureTitle:r,signaturePhone:n,signatureEmail:a,signatureMessage:s}=o;return this.update(t,{signature_name:i,signature_title:r,signature_phone:n,signature_email:a,signature_message:s})},async updateAgencyInfo(t,o){const{agencyName:i,agencyAddress:r,agencyPhone:n,agencyWebsite:a}=o;return this.update(t,{agency_name:i,agency_address:r,agency_phone:n,agency_website:a})},async updateEmailSettings(t,o){const{fromName:i,fromEmail:r,replyToEmail:n,defaultSendTime:a,timezone:s,dailySendLimit:d}=o;return this.update(t,{from_name:i,from_email:r,reply_to_email:n,default_send_time:a,timezone:s,daily_send_limit:d})},async updatePreferences(t,o){const i=await this.get(t);return this.update(t,{preferences:{...i==null?void 0:i.preferences,...o}})},async getSignatureHtml(t){const o=await this.get(t);if(!o)return"";const{signature_name:i,signature_title:r,signature_phone:n,signature_email:a,signature_message:s}=o;let d='<table style="margin-top: 20px; font-family: Arial, sans-serif;">';return d+="<tr><td>",i&&(d+=`<strong style="font-size: 14px;">${i}</strong><br>`),r&&(d+=`<span style="color: #666;">${r}</span><br>`),n&&(d+=`<span>${n}</span><br>`),a&&(d+=`<a href="mailto:${a}" style="color: #0066cc;">${a}</a><br>`),s&&(d+=`<p style="margin-top: 10px; font-style: italic; color: #666;">${s}</p>`),d+="</td></tr></table>",d},async getUnsubscribeFooterHtml(t,o,i=null){const r=await this.get(t),n="https://your-app.com",a=`${n}/unsubscribe?type=automation&id=${o}&aid=${i}`,s=`${n}/unsubscribe?type=all&id=${o}`;let d=`
      <table style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; width: 100%; font-family: Arial, sans-serif;">
        <tr>
          <td style="text-align: center; font-size: 12px; color: #666;">
    `;return i&&(d+=`<a href="${a}" style="color: #666;">Unsubscribe from these emails</a> &nbsp;|&nbsp; `),d+=`<a href="${s}" style="color: #666;">Unsubscribe from all emails</a>`,(r!=null&&r.agency_name||r!=null&&r.agency_address)&&(d+="<br><br>",r.agency_name&&(d+=r.agency_name),r.agency_address&&(d+=` | ${r.agency_address}`)),d+=`
          </td>
        </tr>
      </table>
    `,d}},De=()=>{const{userId:t}=P();return t};function lt(){const t=De();return F({queryKey:["userSettings",t],queryFn:()=>ee.get(t),enabled:!!t})}function dt(){const t=De(),o=xe(),i=()=>{o.invalidateQueries({queryKey:["userSettings",t]})},r=D({mutationFn:c=>ee.update(t,c),onSuccess:i}),n=D({mutationFn:c=>ee.updateSignature(t,c),onSuccess:i}),a=D({mutationFn:c=>ee.updateAgencyInfo(t,c),onSuccess:i}),s=D({mutationFn:c=>ee.updateEmailSettings(t,c),onSuccess:i}),d=D({mutationFn:c=>ee.updatePreferences(t,c),onSuccess:i});return{updateSettings:r,updateSignature:n,updateAgencyInfo:a,updateEmailSettings:s,updatePreferences:d}}const Pe=()=>{const{userId:t}=P();return t};function ct(t={}){const o=Pe();return F({queryKey:["accounts",o,t],queryFn:()=>se.getAll(o,t),enabled:!!o,staleTime:3e4})}function pt(t){return F({queryKey:["account",t,"policies"],queryFn:()=>se.getByIdWithPolicies(t),enabled:!!t,staleTime:3e4})}function xt(){const t=Pe();return F({queryKey:["accounts",t,"stats"],queryFn:()=>se.getStats(t),enabled:!!t})}const ut=()=>{const{userId:t}=P();return t};function gt(t,o=20){const i=ut();return F({queryKey:["activity",i,"account",t],queryFn:()=>Be.getByAccount(i,t,o),enabled:!!i&&!!t,staleTime:3e4})}const ht=()=>{const{userId:t}=P();return t};function mt(t=10){const o=ht();return F({queryKey:["scheduledEmails",o,"upcoming",t],queryFn:()=>We.getUpcoming(o,t),enabled:!!o})}const yt=(t,o,i,r)=>{const a=(i-t)*Math.PI/180,s=(r-o)*Math.PI/180,d=Math.sin(a/2)*Math.sin(a/2)+Math.cos(t*Math.PI/180)*Math.cos(i*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 3959*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))},ge={},ft=async t=>{if(ge[t])return ge[t];try{const i=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&q=${encodeURIComponent(t)}&limit=1`)).json();if(i&&i.length>0){const r={lat:parseFloat(i[0].lat),lng:parseFloat(i[0].lon)};return ge[t]=r,r}}catch(o){console.error("Geocoding error:",o)}return null},Y={async getAll(t,o={}){const{status:i,limit:r=50,offset:n=0}=o;let a=u.from("mass_email_batches").select(`
        *,
        template:email_templates(id, name, subject)
      `).eq("owner_id",t).order("created_at",{ascending:!1}).range(n,n+r-1);i&&(a=a.eq("status",i));const{data:s,error:d}=await a;if(d)throw d;return s},async getById(t,o){const{data:i,error:r}=await u.from("mass_email_batches").select(`
        *,
        template:email_templates(*)
      `).eq("owner_id",t).eq("id",o).single();if(r)throw r;return i},async create(t,o){const{data:i,error:r}=await u.from("mass_email_batches").insert({owner_id:t,status:"Draft",...o}).select().single();if(r)throw r;return i},async update(t,o,i){const{data:r,error:n}=await u.from("mass_email_batches").update({...i,updated_at:new Date().toISOString()}).eq("owner_id",t).eq("id",o).select().single();if(n)throw n;return r},async delete(t,o){const{error:i}=await u.from("mass_email_batches").delete().eq("owner_id",t).eq("id",o).eq("status","Draft");if(i)throw i;return!0},async getRecipients(t,o,i={}){const{limit:r=100,offset:n=0}=i,{rules:a=[],notOptedOut:s=!0,search:d=""}=o||{},c=a.filter(C=>C.field==="account_status"&&C.value),l=a.filter(C=>C.field==="policy_type"&&C.value),b=a.filter(C=>C.field==="policy_count"&&C.value),x=a.filter(C=>C.field==="policy_expiration"&&C.value),_=a.filter(C=>C.field==="location"&&C.value),v=a.filter(C=>C.field==="state"&&C.value),h=a.filter(C=>C.field==="city"&&C.value);let w=u.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name, person_has_opted_out_of_email, billing_city, billing_state, billing_postal_code, billing_street").eq("owner_id",t);if(c.length>0){const C=c[0];if(C.operator==="is")w=w.eq("account_status",C.value);else if(C.operator==="is_not")w=w.neq("account_status",C.value);else if(C.operator==="is_any"){const m=C.value.split(",").filter(R=>R);m.length>0&&(w=w.in("account_status",m))}}s&&(w=w.or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false")),d&&(w=w.or(`name.ilike.%${d}%,person_email.ilike.%${d}%,email.ilike.%${d}%`)),w=w.order("name").range(n,n+r-1);const{data:y,error:g}=await w;if(g)throw g;let z=y.filter(C=>{const m=C.person_email||C.email;return m&&m.includes("@")});if((l.length>0||b.length>0||x.length>0)&&z.length>0){const C=z.map(B=>B.account_unique_id),{data:m,error:R}=await u.from("policies").select("account_id, policy_lob, expiration_date, policy_status").in("account_id",C);if(R)throw R;const q={};m.forEach(B=>{q[B.account_id]||(q[B.account_id]=[]),q[B.account_id].push(B)}),z=z.filter(B=>{const E=q[B.account_unique_id]||[];for(const p of b){const f=E.length,S=parseInt(p.value,10);if(p.operator==="equals"&&f!==S||p.operator==="greater_than"&&f<=S||p.operator==="less_than"&&f>=S||p.operator==="at_least"&&f<S)return!1}for(const p of l){const f=p.operator==="is_any"?p.value.split(","):[p.value],S=E.some(j=>f.some($=>{var T;return(T=j.policy_lob)==null?void 0:T.toLowerCase().includes($.toLowerCase())}));if(p.operator==="is"&&!S||p.operator==="is_any"&&!S||p.operator==="is_not"&&S)return!1}const W=new Date().toISOString().split("T")[0];for(const p of x)if(p.operator==="in_next_days"){const f=parseInt(p.value,10),S=new Date;S.setDate(S.getDate()+f);const j=S.toISOString().split("T")[0];if(!E.some(T=>T.expiration_date&&T.expiration_date>=W&&T.expiration_date<=j))return!1}else if(p.operator==="before"){if(!E.some(S=>S.expiration_date&&S.expiration_date<p.value))return!1}else if(p.operator==="after"){if(!E.some(S=>S.expiration_date&&S.expiration_date>p.value))return!1}else if(p.operator==="between"&&!E.some(S=>S.expiration_date&&S.expiration_date>=p.value&&S.expiration_date<=(p.value2||p.value)))return!1;return!0})}if(v.length>0&&z.length>0&&(z=z.filter(C=>{for(const m of v){const R=(C.billing_state||"").toUpperCase();if(m.operator==="is"){if(R!==m.value.toUpperCase())return!1}else if(m.operator==="is_not"){if(R===m.value.toUpperCase())return!1}else if(m.operator==="is_any"&&!m.value.split(",").map(B=>B.toUpperCase()).includes(R))return!1}return!0})),h.length>0&&z.length>0&&(z=z.filter(C=>{for(const m of h){const R=(C.billing_city||"").toLowerCase(),q=(m.value||"").toLowerCase();if(m.operator==="contains"){if(!R.includes(q))return!1}else if(m.operator==="equals"){if(R!==q)return!1}else if(m.operator==="starts_with"&&!R.startsWith(q))return!1}return!0})),_.length>0&&z.length>0)for(const C of _){const[m,R]=C.value.split(",").map(parseFloat),q=parseInt(C.radius||"25",10);z=(await Promise.all(z.map(async E=>{const W=[E.billing_postal_code,E.billing_city,E.billing_state].filter(Boolean);if(W.length===0)return{account:E,inRadius:!1};const p=W.join(", "),f=await ft(p);if(!f)return{account:E,inRadius:!1};const S=yt(m,R,f.lat,f.lng);return{account:E,inRadius:S<=q}}))).filter(E=>E.inRadius).map(E=>E.account)}return z},async countRecipients(t,o){const{rules:i=[],notOptedOut:r=!0,search:n=""}=o||{},a=i.filter(y=>y.field==="policy_type"&&y.value),s=i.filter(y=>y.field==="policy_count"&&y.value),d=i.filter(y=>y.field==="policy_expiration"&&y.value),c=i.filter(y=>y.field==="location"&&y.value),l=i.filter(y=>y.field==="city"&&y.value);if(a.length>0||s.length>0||d.length>0||c.length>0||l.length>0)return(await this.getRecipients(t,o,{limit:1e4})).length;let x=u.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",t);const _=i.filter(y=>y.field==="account_status"&&y.value);if(_.length>0){const y=_[0];if(y.operator==="is")x=x.eq("account_status",y.value);else if(y.operator==="is_not")x=x.neq("account_status",y.value);else if(y.operator==="is_any"){const g=y.value.split(",").filter(z=>z);g.length>0&&(x=x.in("account_status",g))}}const v=i.filter(y=>y.field==="state"&&y.value);if(v.length>0){const y=v[0];if(y.operator==="is")x=x.ilike("billing_state",y.value);else if(y.operator==="is_not")x=x.not("billing_state","ilike",y.value);else if(y.operator==="is_any"){const g=y.value.split(",").filter(z=>z);g.length>0&&(x=x.in("billing_state",g))}}r&&(x=x.or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false")),n&&(x=x.or(`name.ilike.%${n}%,person_email.ilike.%${n}%,email.ilike.%${n}%`));const{count:h,error:w}=await x;if(w)throw w;return h||0},async scheduleBatch(t,o,i=null){const r=await this.getById(t,o);if(!r)throw new Error("Batch not found");if(r.status!=="Draft")throw new Error("Can only schedule draft batches");const n=await this.getRecipients(t,r.filter_config,{limit:1e4});if(n.length===0)throw new Error("No recipients match the filter");const a=i||new Date().toISOString(),s=n.map(l=>({owner_id:t,account_id:l.account_unique_id,template_id:r.template_id,recipient_email:l.person_email||l.email,recipient_name:l.primary_contact_first_name?`${l.primary_contact_first_name} ${l.primary_contact_last_name||""}`.trim():l.name,subject:r.subject,scheduled_for:a,status:"Pending",batch_id:o})),d=100;let c=0;for(let l=0;l<s.length;l+=d){const b=s.slice(l,l+d),{data:x,error:_}=await u.from("scheduled_emails").insert(b).select();if(_)throw _;c+=x.length}return await this.update(t,o,{status:i?"Scheduled":"Sending",total_recipients:n.length,scheduled_for:a,started_at:i?null:new Date().toISOString()}),{scheduled:c,total:n.length,scheduledFor:a}},async cancelBatch(t,o){await this.update(t,o,{status:"Cancelled"});const{error:i}=await u.from("scheduled_emails").update({status:"Cancelled"}).eq("owner_id",t).eq("batch_id",o).eq("status","Pending");if(i)throw i;return!0},async getBatchStats(t,o){const{data:i,error:r}=await u.from("scheduled_emails").select("status").eq("owner_id",t).eq("batch_id",o);if(r)throw r;const n={pending:0,sent:0,failed:0,cancelled:0,total:i.length};return i.forEach(a=>{const s=a.status.toLowerCase();n[s]!==void 0&&n[s]++}),n},async getAllWithStats(t,o={}){const i=await this.getAll(t,o);return await Promise.all(i.map(async n=>{if(n.status==="Draft")return{...n,stats:null};const a=await this.getBatchStats(t,n.id);return{...n,stats:a}}))}},ue=()=>{const{userId:t}=P();return t};function bt(t={}){const o=ue();return F({queryKey:["massEmails",o,"withStats",t],queryFn:()=>Y.getAllWithStats(o,t),enabled:!!o})}function vt(t,o={}){const i=ue();return F({queryKey:["massEmailRecipients",i,t,o],queryFn:()=>Y.getRecipients(i,t,o),enabled:!!i&&!!t})}function jt(t){const o=ue();return F({queryKey:["massEmailRecipientCount",o,t],queryFn:()=>Y.countRecipients(o,t),enabled:!!o&&!!t})}function _t(){const t=ue(),o=xe(),i=()=>{o.invalidateQueries({queryKey:["massEmails",t]})},r=D({mutationFn:c=>Y.create(t,c),onSuccess:i}),n=D({mutationFn:({batchId:c,updates:l})=>Y.update(t,c,l),onSuccess:i}),a=D({mutationFn:c=>Y.delete(t,c),onSuccess:i}),s=D({mutationFn:({batchId:c,scheduledFor:l})=>Y.scheduleBatch(t,c,l),onSuccess:()=>{i(),o.invalidateQueries({queryKey:["scheduledEmails",t]})}}),d=D({mutationFn:c=>Y.cancelBatch(t,c),onSuccess:()=>{i(),o.invalidateQueries({queryKey:["scheduledEmails",t]})}});return{createBatch:r,updateBatch:n,deleteBatch:a,scheduleBatch:s,cancelBatch:d}}const X=({width:t="100%",height:o="20px"})=>e.jsx("div",{style:{width:t,height:o,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite"}}),le=({label:t,value:o,change:i,icon:r,positive:n,isLoading:a,theme:s})=>e.jsxs("div",{style:{padding:"20px",backgroundColor:s.bgCard,borderRadius:"12px",border:`1px solid ${s.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[e.jsx("span",{style:{color:s.textSecondary,fontSize:"13px"},children:t}),e.jsx("span",{style:{fontSize:"20px"},children:r})]}),a?e.jsx(X,{height:"32px",width:"80px"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:s.text,marginBottom:"4px"},children:o}),i&&e.jsx("span",{style:{fontSize:"12px",color:n?s.success:s.danger},children:i})]})]}),St=({email:t,theme:o,userId:i})=>{var r,n,a;return e.jsx("div",{style:{padding:"14px",backgroundColor:o.bg,borderRadius:"8px",border:`1px solid ${o.border}`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"11px",color:o.textMuted,marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:""})," ",new Date(t.scheduled_for).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]}),e.jsx(Z,{to:`/${i}/clients/${t.account_id}`,style:{fontSize:"14px",fontWeight:"600",color:o.text,textDecoration:"none"},children:((r=t.accounts)==null?void 0:r.name)||"Unknown Account"}),e.jsx("div",{style:{fontSize:"12px",color:o.textSecondary,marginTop:"2px"},children:((n=t.email_templates)==null?void 0:n.subject)||"No subject"}),e.jsx("span",{style:{display:"inline-block",marginTop:"6px",padding:"3px 8px",backgroundColor:o.bgHover,borderRadius:"4px",fontSize:"11px",color:o.textSecondary},children:((a=t.email_templates)==null?void 0:a.name)||"Unknown Template"})]}),e.jsxs("div",{style:{display:"flex",gap:"6px"},children:[e.jsx("button",{style:{padding:"6px 10px",backgroundColor:o.bgHover,border:`1px solid ${o.border}`,borderRadius:"6px",color:o.textSecondary,cursor:"pointer",fontSize:"12px"},children:""}),e.jsx("button",{style:{padding:"6px 10px",backgroundColor:o.bgHover,border:`1px solid ${o.border}`,borderRadius:"6px",color:o.textSecondary,cursor:"pointer",fontSize:"12px"},children:""})]})]})})},Ct=({label:t,you:o,avg:i,theme:r})=>e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[e.jsx("span",{style:{fontSize:"12px",color:r.textSecondary},children:t}),e.jsxs("span",{style:{fontSize:"12px",color:r.textMuted},children:[o,"% vs ",i,"%"]})]}),e.jsxs("div",{style:{display:"flex",gap:"4px",height:"24px"},children:[e.jsx("div",{style:{width:`${Math.min(o,100)}%`,backgroundColor:r.primary,borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:e.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[o,"%"]})}),e.jsx("div",{style:{width:`${Math.min(i,100)}%`,backgroundColor:"#14b8a6",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:e.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[i,"%"]})})]})]}),Ce=({t})=>{const{userId:o}=P(),{data:i,isLoading:r,error:n}=Me(),{data:a,isLoading:s}=mt(7),{data:d,isLoading:c}=st(30),l=[{label:"Open Rate",you:(i==null?void 0:i.openRate)||0,avg:32},{label:"Click Rate",you:(i==null?void 0:i.clickRate)||0,avg:8},{label:"Response Rate",you:(i==null?void 0:i.responseRate)||8,avg:5}],b=_=>_>=1e3?`${(_/1e3).toFixed(1)}k`:(_==null?void 0:_.toLocaleString())||"0",x=_=>`${Math.round(_||0)}%`;return e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:t.text,marginBottom:"4px"},children:"Dashboard"}),e.jsx("p",{style:{color:t.textSecondary,fontSize:"14px",margin:0},children:"Overview of your email campaigns and performance"})]}),n&&e.jsx("div",{style:{padding:"16px",backgroundColor:`${t.danger}15`,border:`1px solid ${t.danger}30`,borderRadius:"8px",marginBottom:"24px",color:t.danger,fontSize:"14px"},children:"Failed to load dashboard data. Please try refreshing the page."}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"24px"},children:[e.jsx(le,{label:"Emails Sent",value:b(i==null?void 0:i.emailsSent),change:i!=null&&i.emailsSentChange?`${i.emailsSentChange>0?"+":""}${i.emailsSentChange}%`:null,icon:"",positive:(i==null?void 0:i.emailsSentChange)>0,isLoading:r,theme:t}),e.jsx(le,{label:"Open Rate",value:x(i==null?void 0:i.openRate),change:i!=null&&i.openRateChange?`${i.openRateChange>0?"+":""}${i.openRateChange}%`:null,icon:"",positive:(i==null?void 0:i.openRateChange)>0,isLoading:r,theme:t}),e.jsx(le,{label:"Click Rate",value:x(i==null?void 0:i.clickRate),change:i!=null&&i.clickRateChange?`${i.clickRateChange>0?"+":""}${i.clickRateChange}%`:null,icon:"",positive:(i==null?void 0:i.clickRateChange)>0,isLoading:r,theme:t}),e.jsx(le,{label:"Scheduled",value:b(i==null?void 0:i.scheduledCount),change:null,icon:"",positive:null,isLoading:r,theme:t})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsxs("div",{style:{padding:"20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:t.text,margin:0},children:"Upcoming Scheduled Emails"}),e.jsx(Z,{to:`/${o}/scheduled`,style:{fontSize:"12px",color:t.primary,textDecoration:"none"},children:"View all "})]}),e.jsx("p",{style:{fontSize:"12px",color:t.textSecondary,marginBottom:"16px"},children:"Emails scheduled to be sent in the next 7 days"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:s?Array.from({length:3}).map((_,v)=>e.jsxs("div",{style:{padding:"14px",backgroundColor:t.bg,borderRadius:"8px",border:`1px solid ${t.border}`},children:[e.jsx(X,{height:"12px",width:"120px"}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(X,{height:"16px",width:"180px"})}),e.jsx("div",{style:{marginTop:"4px"},children:e.jsx(X,{height:"12px",width:"220px"})})]},v)):(a==null?void 0:a.length)>0?a.slice(0,5).map(_=>e.jsx(St,{email:_,theme:t,userId:o},_.id)):e.jsxs("div",{style:{padding:"40px 20px",textAlign:"center",color:t.textMuted,fontSize:"14px"},children:[e.jsx("div",{style:{fontSize:"32px",marginBottom:"8px"},children:""}),"No scheduled emails in the next 7 days"]})})]}),e.jsxs("div",{style:{padding:"20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:t.text,marginBottom:"4px"},children:"Performance Comparison"}),e.jsx("p",{style:{fontSize:"12px",color:t.textSecondary,marginBottom:"16px"},children:"Your metrics compared to industry averages"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:r?Array.from({length:3}).map((_,v)=>e.jsxs("div",{children:[e.jsx(X,{height:"12px",width:"100px"}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(X,{height:"24px"})})]},v)):l.map((_,v)=>e.jsx(Ct,{label:_.label,you:_.you,avg:_.avg,theme:t},v))}),e.jsxs("div",{style:{display:"flex",gap:"16px",marginTop:"16px",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:t.primary,borderRadius:"2px"}}),e.jsx("span",{style:{fontSize:"11px",color:t.textSecondary},children:"You"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"#14b8a6",borderRadius:"2px"}}),e.jsx("span",{style:{fontSize:"11px",color:t.textSecondary},children:"Industry Avg"})]})]})]})]}),e.jsxs("div",{style:{marginTop:"20px",padding:"20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:t.text,margin:0},children:"Recent Email Activity"}),e.jsx(Z,{to:`/${o}/activity`,style:{fontSize:"12px",color:t.primary,textDecoration:"none"},children:"View all "})]}),c?e.jsx(X,{height:"200px"}):(d==null?void 0:d.length)>0?e.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"4px",height:"200px",padding:"20px 0"},children:d.slice(-14).map((_,v)=>{const h=Math.max(...d.map(y=>y.sent||0),1),w=(_.sent||0)/h*150;return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[e.jsx("div",{style:{width:"100%",height:`${w}px`,backgroundColor:t.primary,borderRadius:"4px 4px 0 0",minHeight:"4px"},title:`${_.sent||0} sent on ${_.date}`}),e.jsx("span",{style:{fontSize:"9px",color:t.textMuted},children:new Date(_.date).toLocaleDateString("en-US",{weekday:"short"}).charAt(0)})]},v)})}):e.jsx("div",{style:{padding:"40px 20px",textAlign:"center",color:t.textMuted,fontSize:"14px"},children:"No email activity data yet"})]})]})},he=({width:t="100%",height:o="20px"})=>e.jsx("div",{style:{width:t,height:o,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),wt=[{id:"welcome",name:"Welcome Series",desc:"Send a series of welcome emails to new clients over their first 30 days",icon:"",category:"Onboarding",defaultNodes:[{type:"trigger",config:{frequency:"daily",time:"09:00"}},{type:"send_email",config:{templateKey:"welcome_email"}},{type:"delay",config:{days:3}},{type:"send_email",config:{templateKey:"getting_started"}}]},{id:"renewal",name:"Renewal Reminder",desc:"Automated reminders for upcoming policy renewals with customizable timing",icon:"",category:"Retention",defaultNodes:[{type:"trigger",config:{frequency:"daily",time:"09:00"}},{type:"send_email",config:{templateKey:"renewal_30_day"}},{type:"delay",config:{days:14}},{type:"condition",config:{type:"email_opened"}}]},{id:"engagement",name:"Engagement Campaign",desc:"Re-engage inactive clients with targeted email sequences",icon:"",category:"Engagement",defaultNodes:[{type:"trigger",config:{frequency:"weekly",time:"10:00"}},{type:"send_email",config:{templateKey:"reengagement"}}]},{id:"policy_update",name:"Policy Update Alert",desc:"Notify clients about important policy changes and updates",icon:"",category:"Communication",defaultNodes:[{type:"trigger",config:{frequency:"immediate"}},{type:"send_email",config:{templateKey:"policy_update"}}]}],kt=({template:t,onUse:o,theme:i})=>e.jsxs("div",{style:{padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:i.bgHover,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:t.icon}),e.jsx("span",{style:{padding:"4px 10px",backgroundColor:i.bgHover,borderRadius:"20px",fontSize:"11px",color:i.textSecondary},children:t.category})]}),e.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:i.text,marginBottom:"6px"},children:t.name}),e.jsx("p",{style:{fontSize:"13px",color:i.textSecondary,marginBottom:"16px",lineHeight:"1.5"},children:t.desc}),e.jsx("button",{onClick:()=>o(t),style:{width:"100%",padding:"10px",backgroundColor:i.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Use Template"})]}),zt=({automation:t,onEdit:o,onToggle:i,theme:r})=>{var s;const n=t.stats||{},a=t.status==="active";return e.jsxs("tr",{style:{borderTop:`1px solid ${r.border}`},children:[e.jsx("td",{style:{padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:r.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px"},children:""}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:r.text},children:t.name}),t.description&&e.jsx("div",{style:{fontSize:"12px",color:r.textMuted},children:t.description})]})]})}),e.jsx("td",{style:{padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("button",{onClick:()=>i(t.id,a?"pause":"activate"),style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:a?r.success:r.bgHover,cursor:"pointer",position:"relative",transition:"background-color 0.2s",flexShrink:0},children:e.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:a?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})}),e.jsx("span",{style:{fontSize:"12px",color:a?r.success:r.textMuted,fontWeight:"500"},children:a?"Active":t.status==="draft"?"Draft":"Paused"})]})}),e.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:r.textSecondary},children:((s=n.totalSent)==null?void 0:s.toLocaleString())||0}),e.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:r.textSecondary},children:n.openRate?`${Math.round(n.openRate)}%`:""}),e.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:r.textSecondary},children:n.clickRate?`${Math.round(n.clickRate)}%`:""}),e.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:r.textSecondary},children:n.activeEnrollments||0}),e.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:e.jsx("button",{onClick:()=>o(t.id),style:{padding:"6px 12px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Edit"})})]})},Rt=({t})=>{const{userId:o}=P(),i=ie(),[r,n]=k.useState("my"),{data:a,isLoading:s,error:d}=tt(),{activateAutomation:c,pauseAutomation:l}=Te(),b=()=>{i(`/${o}/automations/new`)},x=async g=>{i(`/${o}/automations/new`,{state:{templateId:g.id,templateName:g.name,defaultNodes:g.defaultNodes}})},_=g=>{i(`/${o}/automations/${g}`)},v=async(g,z)=>{try{z==="activate"?await c.mutateAsync(g):await l.mutateAsync(g)}catch(I){console.error(`Failed to ${z} automation:`,I)}},h=(a==null?void 0:a.filter(g=>g.status==="active"))||[],w=(a==null?void 0:a.filter(g=>g.status==="paused"))||[],y=(a==null?void 0:a.filter(g=>g.status==="draft"))||[];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:t.text,marginBottom:"4px"},children:"Automations"}),e.jsx("p",{style:{color:t.textSecondary,fontSize:"14px",margin:0},children:"Create and manage automated email workflows"})]}),e.jsxs("button",{onClick:b,style:{padding:"10px 20px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{children:"+"})," Create Custom"]})]}),d&&e.jsx("div",{style:{padding:"16px",backgroundColor:`${t.danger}15`,border:`1px solid ${t.danger}30`,borderRadius:"8px",marginBottom:"24px",color:t.danger,fontSize:"14px"},children:"Failed to load automations. Please try refreshing the page."}),!s&&a&&e.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"24px",padding:"16px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{textAlign:"center",flex:1},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.success},children:h.length}),e.jsx("div",{style:{fontSize:"12px",color:t.textSecondary},children:"Active"})]}),e.jsx("div",{style:{width:"1px",backgroundColor:t.border}}),e.jsxs("div",{style:{textAlign:"center",flex:1},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.warning},children:w.length}),e.jsx("div",{style:{fontSize:"12px",color:t.textSecondary},children:"Paused"})]}),e.jsx("div",{style:{width:"1px",backgroundColor:t.border}}),e.jsxs("div",{style:{textAlign:"center",flex:1},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.textMuted},children:y.length}),e.jsx("div",{style:{fontSize:"12px",color:t.textSecondary},children:"Drafts"})]}),e.jsx("div",{style:{width:"1px",backgroundColor:t.border}}),e.jsxs("div",{style:{textAlign:"center",flex:1},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.primary},children:a.reduce((g,z)=>{var I;return g+(((I=z.stats)==null?void 0:I.totalSent)||0)},0).toLocaleString()}),e.jsx("div",{style:{fontSize:"12px",color:t.textSecondary},children:"Total Sent"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0",marginBottom:"24px",backgroundColor:t.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:[e.jsxs("button",{onClick:()=>n("my"),style:{padding:"10px 20px",backgroundColor:r==="my"?t.bgCard:"transparent",border:"none",borderRadius:"8px",color:r==="my"?t.text:t.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:r==="my"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:["My Automations ",a&&`(${a.length})`]}),e.jsx("button",{onClick:()=>n("templates"),style:{padding:"10px 20px",backgroundColor:r==="templates"?t.bgCard:"transparent",border:"none",borderRadius:"8px",color:r==="templates"?t.text:t.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:r==="templates"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:"Templates"})]}),r==="templates"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:t.text,marginBottom:"16px"},children:"Pre-built Templates"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:wt.map(g=>e.jsx(kt,{template:g,onUse:x,theme:t},g.id))})]}),r==="my"&&e.jsx(e.Fragment,{children:s?e.jsx("div",{style:{backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,padding:"20px"},children:Array.from({length:3}).map((g,z)=>e.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:z>0?`1px solid ${t.border}`:"none"},children:[e.jsx(he,{width:"36px",height:"36px"}),e.jsxs("div",{style:{flex:1},children:[e.jsx(he,{width:"200px",height:"16px"}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(he,{width:"120px",height:"12px"})})]})]},z))}):(a==null?void 0:a.length)>0?e.jsx("div",{style:{backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:t.bgHover},children:[e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Automation"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Status"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Sent"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Open Rate"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Click Rate"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Enrolled"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Actions"})]})}),e.jsx("tbody",{children:a.map(g=>e.jsx(zt,{automation:g,onEdit:_,onToggle:v,theme:t},g.id))})]})}):e.jsxs("div",{style:{padding:"60px 20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:t.text,marginBottom:"8px"},children:"No automations yet"}),e.jsx("p",{style:{fontSize:"14px",color:t.textSecondary,marginBottom:"24px"},children:"Create your first automation to start sending targeted emails automatically."}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsx("button",{onClick:()=>n("templates"),style:{padding:"10px 20px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,cursor:"pointer",fontSize:"14px"},children:"Browse Templates"}),e.jsx("button",{onClick:b,style:{padding:"10px 20px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Custom"})]})]})})]})},de=({width:t="100%",height:o="20px"})=>e.jsx("div",{style:{width:t,height:o,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),$t=({template:t,onSave:o,onClose:i,theme:r})=>{const[n,a]=k.useState((t==null?void 0:t.name)||""),[s,d]=k.useState((t==null?void 0:t.subject)||""),[c,l]=k.useState((t==null?void 0:t.body_html)||(t==null?void 0:t.body_text)||""),[b,x]=k.useState((t==null?void 0:t.category)||"general"),[_,v]=k.useState(!1),h=async()=>{v(!0);try{await o({name:n,subject:s,body_html:c,body_text:c.replace(/<[^>]*>/g,""),category:b}),i()}catch(g){console.error("Failed to save template:",g)}finally{v(!1)}},w=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],y=g=>{l(c+g)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:100},onClick:i}),e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxHeight:"90vh",backgroundColor:r.bgCard,borderRadius:"16px",border:`1px solid ${r.border}`,zIndex:101,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${r.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:r.text,margin:0},children:t?"Edit Template":"Create Template"}),e.jsx("button",{onClick:i,style:{background:"none",border:"none",color:r.textMuted,cursor:"pointer",fontSize:"20px"},children:""})]}),e.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:r.text,display:"block",marginBottom:"6px"},children:"Template Name"}),e.jsx("input",{type:"text",value:n,onChange:g=>a(g.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:r.bgInput,border:`1px solid ${r.border}`,borderRadius:"8px",color:r.text,fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:r.text,display:"block",marginBottom:"6px"},children:"Category"}),e.jsxs("select",{value:b,onChange:g=>x(g.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:r.bgInput,border:`1px solid ${r.border}`,borderRadius:"8px",color:r.text,fontSize:"14px"},children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"welcome",children:"Welcome"}),e.jsx("option",{value:"renewal",children:"Renewal"}),e.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),e.jsx("option",{value:"engagement",children:"Engagement"}),e.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:r.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),e.jsx("input",{type:"text",value:s,onChange:g=>d(g.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:r.bgInput,border:`1px solid ${r.border}`,borderRadius:"8px",color:r.text,fontSize:"14px"}})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:r.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:w.map(g=>e.jsx("button",{onClick:()=>y(g.key),style:{padding:"4px 10px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.textSecondary,cursor:"pointer",fontSize:"11px"},children:g.label},g.key))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:r.text,display:"block",marginBottom:"6px"},children:"Email Body"}),e.jsx("textarea",{value:c,onChange:g=>l(g.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:12,style:{width:"100%",padding:"12px",backgroundColor:r.bgInput,border:`1px solid ${r.border}`,borderRadius:"8px",color:r.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),e.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${r.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[e.jsx("button",{onClick:i,style:{padding:"10px 20px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"8px",color:r.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),e.jsx("button",{onClick:h,disabled:_||!n||!s,style:{padding:"10px 20px",backgroundColor:r.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:_?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:_||!n||!s?.6:1},children:_?"Saving...":t?"Save Changes":"Create Template"})]})]})]})},It=({template:t,onEdit:o,onDuplicate:i,onDelete:r,theme:n})=>{var c,l;const[a,s]=k.useState(!1),d={welcome:n.success,renewal:n.warning,cross_sell:n.primary,engagement:n.purple,policy_update:"#06b6d4",general:n.textMuted};return e.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,position:"relative"},children:[e.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px"},children:[e.jsx("button",{onClick:()=>s(!a),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"16px"},children:""}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,zIndex:10},onClick:()=>s(!1)}),e.jsxs("div",{style:{position:"absolute",top:"100%",right:0,backgroundColor:n.bgCard,border:`1px solid ${n.border}`,borderRadius:"8px",padding:"4px",zIndex:11,minWidth:"140px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("button",{onClick:()=>{o(t),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:n.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:" Edit"}),e.jsx("button",{onClick:()=>{i(t),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:n.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:" Duplicate"}),e.jsx("button",{onClick:()=>{r(t.id),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:n.danger,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:" Delete"})]})]})]}),e.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${d[t.category]||n.textMuted}15`,color:d[t.category]||n.textMuted,borderRadius:"20px",fontSize:"11px",fontWeight:"500",marginBottom:"12px",textTransform:"capitalize"},children:((c=t.category)==null?void 0:c.replace("_"," "))||"General"}),e.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"6px"},children:t.name}),e.jsx("p",{style:{fontSize:"13px",color:n.textSecondary,marginBottom:"8px"},children:t.subject}),e.jsxs("p",{style:{fontSize:"12px",color:n.textMuted,marginBottom:"12px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:[(l=t.body_text)==null?void 0:l.substring(0,100),"..."]}),e.jsxs("div",{style:{display:"flex",gap:"16px",paddingTop:"12px",borderTop:`1px solid ${n.border}`,fontSize:"11px",color:n.textMuted},children:[e.jsxs("span",{children:[" ",t.usage_count||0," sent"]}),e.jsxs("span",{children:[" ",t.open_rate?`${Math.round(t.open_rate)}%`:""," opens"]})]}),e.jsx("button",{onClick:()=>o(t),style:{marginTop:"12px",width:"100%",padding:"10px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,cursor:"pointer",fontSize:"13px"},children:"Edit Template"})]})},At=({t})=>{const{userId:o}=P(),[i,r]=k.useState("my"),[n,a]=k.useState("all"),[s,d]=k.useState(""),[c,l]=k.useState(!1),[b,x]=k.useState(null),{data:_,isLoading:v,error:h}=Ie(),{data:w}=et(),{createTemplate:y,updateTemplate:g,deleteTemplate:z,duplicateTemplate:I}=Ae(),C=(_==null?void 0:_.filter(W=>!(n!=="all"&&W.category!==n||s&&!W.name.toLowerCase().includes(s.toLowerCase())&&!W.subject.toLowerCase().includes(s.toLowerCase()))))||[],m=()=>{x(null),l(!0)},R=W=>{x(W),l(!0)},q=async W=>{b?await g.mutateAsync({id:b.id,...W}):await y.mutateAsync(W)},B=async W=>{await I.mutateAsync(W.id)},E=async W=>{window.confirm("Are you sure you want to delete this template?")&&await z.mutateAsync(W)};return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:t.text,marginBottom:"4px"},children:"Email Templates"}),e.jsx("p",{style:{color:t.textSecondary,fontSize:"14px",margin:0},children:"Create and manage reusable email templates"})]}),e.jsxs("button",{onClick:m,style:{padding:"10px 20px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{children:"+"})," Create Template"]})]}),h&&e.jsx("div",{style:{padding:"16px",backgroundColor:`${t.danger}15`,border:`1px solid ${t.danger}30`,borderRadius:"8px",marginBottom:"24px",color:t.danger,fontSize:"14px"},children:"Failed to load templates. Please try refreshing the page."}),e.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"24px",alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"300px"},children:[e.jsx("input",{type:"text",placeholder:"Search templates...",value:s,onChange:W=>d(W.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px"}}),e.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:t.textMuted},children:""})]}),e.jsxs("select",{value:n,onChange:W=>a(W.target.value),style:{padding:"10px 12px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px",minWidth:"150px"},children:[e.jsx("option",{value:"all",children:"All Categories"}),e.jsx("option",{value:"welcome",children:"Welcome"}),e.jsx("option",{value:"renewal",children:"Renewal"}),e.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),e.jsx("option",{value:"engagement",children:"Engagement"}),e.jsx("option",{value:"policy_update",children:"Policy Update"}),e.jsx("option",{value:"general",children:"General"})]}),e.jsxs("span",{style:{fontSize:"13px",color:t.textMuted},children:[C.length," template",C.length!==1?"s":""]})]}),v?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:Array.from({length:6}).map((W,p)=>e.jsxs("div",{style:{padding:"20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsx(de,{width:"80px",height:"20px"}),e.jsx("div",{style:{marginTop:"12px"},children:e.jsx(de,{width:"180px",height:"18px"})}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(de,{width:"220px",height:"14px"})}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(de,{height:"40px"})})]},p))}):C.length>0?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:C.map(W=>e.jsx(It,{template:W,onEdit:R,onDuplicate:B,onDelete:E,theme:t},W.id))}):e.jsxs("div",{style:{padding:"60px 20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:t.text,marginBottom:"8px"},children:s||n!=="all"?"No templates found":"No templates yet"}),e.jsx("p",{style:{fontSize:"14px",color:t.textSecondary,marginBottom:"24px"},children:s||n!=="all"?"Try adjusting your search or filter criteria.":"Create your first email template to get started."}),!s&&n==="all"&&e.jsx("button",{onClick:m,style:{padding:"10px 20px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Template"})]}),c&&e.jsx($t,{template:b,onSave:q,onClose:()=>l(!1),theme:t})]})},me=({width:t="100%",height:o="20px"})=>e.jsx("div",{style:{width:t,height:o,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Tt=({type:t,theme:o})=>{const i=(t||"").toLowerCase();let r=i;(i==="prior_customer"||i.startsWith("prior"))&&(r="prior"),i.startsWith("customer")&&(r="customer"),i.startsWith("prospect")&&(r="prospect"),i.startsWith("lead")&&(r="lead");const n={customer:{bg:`${o.success}20`,text:o.success,label:"Customer"},prospect:{bg:`${o.primary}20`,text:o.primary,label:"Prospect"},prior:{bg:`${o.textMuted}20`,text:o.textMuted,label:"Prior Customer"},lead:{bg:`${o.warning}20`,text:o.warning,label:"Lead"}},a=n[r]||n.prospect;return e.jsx("span",{style:{padding:"4px 10px",backgroundColor:a.bg,color:a.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:a.label||t||"Unknown"})},Bt=({policyType:t,status:o,theme:i})=>{const r=o==="active";return e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"3px 8px",backgroundColor:r?`${i.success}10`:`${i.textMuted}10`,borderRadius:"6px",fontSize:"11px",color:r?i.success:i.textMuted},children:[r?"":""," ",t]})},Wt=({client:t,onClick:o,theme:i})=>{var r,n,a;return e.jsxs("tr",{style:{borderTop:`1px solid ${i.border}`,cursor:"pointer"},onClick:o,onMouseOver:s=>s.currentTarget.style.backgroundColor=i.bgHover,onMouseOut:s=>s.currentTarget.style.backgroundColor="transparent",children:[e.jsx("td",{style:{padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:i.bgHover,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",color:i.textMuted},children:((r=t.name)==null?void 0:r.charAt(0).toUpperCase())||"?"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:i.text},children:t.name}),e.jsx("div",{style:{fontSize:"12px",color:i.textMuted},children:t.person_email||t.email||""})]})]})}),e.jsx("td",{style:{padding:"14px 16px"},children:e.jsx(Tt,{type:t.account_status||"Prospect",theme:i})}),e.jsx("td",{style:{padding:"14px 16px"},children:e.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",alignItems:"center"},children:((n=t.policies)==null?void 0:n.length)>0?e.jsxs(e.Fragment,{children:[t.policies.slice(0,3).map((s,d)=>e.jsx(Bt,{policyType:s.policy_type||"Policy",status:s.status,theme:i},d)),t.policies.length>3&&e.jsxs("span",{style:{fontSize:"11px",color:i.textMuted},children:["+",t.policies.length-3," more"]})]}):e.jsx("span",{style:{fontSize:"13px",color:i.textMuted},children:"No policies"})})}),e.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:i.textSecondary,textAlign:"center"},children:t.policy_count||((a=t.policies)==null?void 0:a.length)||0}),e.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:e.jsxs("div",{style:{display:"flex",gap:"6px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:s=>{s.stopPropagation()},style:{padding:"6px 12px",backgroundColor:i.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:" Email"}),e.jsx("button",{onClick:s=>{s.stopPropagation(),o()},style:{padding:"6px 12px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.textSecondary,cursor:"pointer",fontSize:"12px"},children:"View"})]})})]})},re=({label:t,value:o,icon:i,color:r,theme:n,onClick:a,active:s})=>e.jsxs("div",{onClick:a,style:{padding:"16px",backgroundColor:s?`${r}15`:n.bgCard,borderRadius:"10px",border:`2px solid ${s?r:n.border}`,textAlign:"center",cursor:a?"pointer":"default",transition:"all 0.2s ease",transform:s?"scale(1.02)":"scale(1)"},onMouseOver:d=>{a&&(d.currentTarget.style.borderColor=r,d.currentTarget.style.transform="scale(1.02)")},onMouseOut:d=>{a&&!s&&(d.currentTarget.style.borderColor=n.border,d.currentTarget.style.transform="scale(1)")},children:[e.jsx("div",{style:{fontSize:"24px",marginBottom:"4px"},children:i}),e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:r||n.text},children:o}),e.jsx("div",{style:{fontSize:"12px",color:n.textSecondary},children:t})]}),qt=({t})=>{const{userId:o}=P(),i=ie(),[r,n]=k.useState(""),[a,s]=k.useState("all"),[d,c]=k.useState("name"),[l,b]=k.useState("asc"),[x,_]=k.useState(1),v=25,h=k.useMemo(()=>{const f={limit:v,offset:(x-1)*v};return a!=="all"&&a!=="expiring"&&(f.status=a),a==="expiring"&&(f.expiring=!0,f.limit=100,f.offset=0),r.length>=2&&(f.search=r),f},[a,x,r]),{data:w,isLoading:y,error:g}=ct(h),{data:z,isLoading:I}=xt(),C=(w==null?void 0:w.accounts)||[],m=(w==null?void 0:w.total)||0,R=Math.ceil(m/v),q=k.useMemo(()=>!C||C.length===0?[]:[...C].sort((f,S)=>{let j=f[d],$=S[d];return d==="name"&&(j=(j==null?void 0:j.toLowerCase())||"",$=($==null?void 0:$.toLowerCase())||""),d==="policy_count"&&(j=f.policy_count||0,$=S.policy_count||0),l==="asc"?j>$?1:-1:j<$?1:-1}),[C,d,l]),B=f=>{s(f),_(1)},E=f=>{n(f),_(1)},W=f=>{i(`/${o}/accounts/${f}`)},p=z||{Customer:0,Prospect:0,Prior:0,total:0,expiring:0};return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:t.text,marginBottom:"4px"},children:"Accounts"}),e.jsx("p",{style:{color:t.textSecondary,fontSize:"14px",margin:0},children:"View and manage your account database"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("button",{onClick:()=>{},style:{padding:"10px 16px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:" Export"}),e.jsx("button",{style:{padding:"10px 20px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"+ Add Account"})]})]}),g&&e.jsx("div",{style:{padding:"16px",backgroundColor:`${t.danger}15`,border:`1px solid ${t.danger}30`,borderRadius:"8px",marginBottom:"24px",color:t.danger,fontSize:"14px"},children:"Failed to load accounts. Please try refreshing the page."}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"16px",marginBottom:"24px"},children:[e.jsx(re,{label:"Total Accounts",value:I?"...":p.total,icon:"",color:t.text,theme:t,onClick:()=>B("all"),active:a==="all"}),e.jsx(re,{label:"Customers",value:I?"...":p.Customer,icon:"",color:t.success,theme:t,onClick:()=>B(a==="Customer"?"all":"Customer"),active:a==="Customer"}),e.jsx(re,{label:"Prospects",value:I?"...":p.Prospect,icon:"",color:t.primary,theme:t,onClick:()=>B(a==="Prospect"?"all":"Prospect"),active:a==="Prospect"}),e.jsx(re,{label:"Prior Customers",value:I?"...":p.Prior,icon:"",color:t.textMuted,theme:t,onClick:()=>B(a==="Prior"?"all":"Prior"),active:a==="Prior"}),e.jsx(re,{label:"Expiring in 30d",value:I?"...":p.expiring,icon:"",color:t.warning,theme:t,onClick:()=>B(a==="expiring"?"all":"expiring"),active:a==="expiring"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"20px",alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"350px"},children:[e.jsx("input",{type:"text",placeholder:"Search by name, email, or phone...",value:r,onChange:f=>E(f.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px"}}),e.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:t.textMuted},children:""})]}),e.jsxs("select",{value:a,onChange:f=>B(f.target.value),style:{padding:"10px 12px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px",minWidth:"150px"},children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"Customer",children:"Customers"}),e.jsx("option",{value:"Prospect",children:"Prospects"}),e.jsx("option",{value:"Prior",children:"Prior Customers"}),e.jsx("option",{value:"Lead",children:"Leads"}),e.jsx("option",{value:"expiring",children:"Expiring Policies"})]}),e.jsxs("select",{value:`${d}-${l}`,onChange:f=>{const[S,j]=f.target.value.split("-");c(S),b(j)},style:{padding:"10px 12px",backgroundColor:t.bgInput,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,fontSize:"14px",minWidth:"150px"},children:[e.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),e.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),e.jsx("option",{value:"created_at-desc",children:"Newest First"}),e.jsx("option",{value:"created_at-asc",children:"Oldest First"})]}),e.jsx("span",{style:{fontSize:"13px",color:t.textMuted,marginLeft:"auto"},children:a==="expiring"?`${q.length} account${q.length!==1?"s":""} with expiring policies`:`Showing ${(x-1)*v+1}-${Math.min(x*v,m)} of ${m} account${m!==1?"s":""}`})]}),y?e.jsx("div",{style:{backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,padding:"20px"},children:Array.from({length:5}).map((f,S)=>e.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:S>0?`1px solid ${t.border}`:"none"},children:[e.jsx(me,{width:"40px",height:"40px"}),e.jsxs("div",{style:{flex:1},children:[e.jsx(me,{width:"200px",height:"16px"}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(me,{width:"150px",height:"12px"})})]})]},S))}):q.length>0?e.jsx("div",{style:{backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:t.bgHover},children:[e.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Account"}),e.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Type"}),e.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Policies"}),e.jsx("th",{style:{padding:"14px 16px",textAlign:"center",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"# Policies"}),e.jsx("th",{style:{padding:"14px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:t.textSecondary},children:"Actions"})]})}),e.jsx("tbody",{children:q.map(f=>e.jsx(Wt,{client:f,onClick:()=>W(f.account_unique_id),theme:t},f.id))})]})}):e.jsxs("div",{style:{padding:"60px 20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:t.text,marginBottom:"8px"},children:r?"No accounts found":"No accounts yet"}),e.jsx("p",{style:{fontSize:"14px",color:t.textSecondary,marginBottom:"24px"},children:r?"Try adjusting your search criteria.":"Your accounts will appear here once synced from Salesforce."})]}),R>1&&a!=="expiring"&&e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginTop:"24px",padding:"16px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsx("button",{onClick:()=>_(1),disabled:x===1,style:{padding:"8px 12px",backgroundColor:x===1?t.bgHover:t.bg,border:`1px solid ${t.border}`,borderRadius:"6px",color:x===1?t.textMuted:t.text,cursor:x===1?"not-allowed":"pointer",fontSize:"13px"},children:" First"}),e.jsx("button",{onClick:()=>_(f=>Math.max(1,f-1)),disabled:x===1,style:{padding:"8px 12px",backgroundColor:x===1?t.bgHover:t.bg,border:`1px solid ${t.border}`,borderRadius:"6px",color:x===1?t.textMuted:t.text,cursor:x===1?"not-allowed":"pointer",fontSize:"13px"},children:" Prev"}),e.jsxs("span",{style:{padding:"8px 16px",fontSize:"14px",color:t.text,fontWeight:"500"},children:["Page ",x," of ",R]}),e.jsx("button",{onClick:()=>_(f=>Math.min(R,f+1)),disabled:x===R,style:{padding:"8px 12px",backgroundColor:x===R?t.bgHover:t.bg,border:`1px solid ${t.border}`,borderRadius:"6px",color:x===R?t.textMuted:t.text,cursor:x===R?"not-allowed":"pointer",fontSize:"13px"},children:"Next "}),e.jsx("button",{onClick:()=>_(R),disabled:x===R,style:{padding:"8px 12px",backgroundColor:x===R?t.bgHover:t.bg,border:`1px solid ${t.border}`,borderRadius:"6px",color:x===R?t.textMuted:t.text,cursor:x===R?"not-allowed":"pointer",fontSize:"13px"},children:"Last "})]}),p.expiring>0&&a!=="expiring"&&e.jsxs("div",{style:{marginTop:"24px",padding:"16px 20px",backgroundColor:`${t.warning}10`,border:`1px solid ${t.warning}30`,borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("span",{style:{fontSize:"24px"},children:""}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:t.text},children:[p.expiring," account",p.expiring!==1?"s have":" has"," policies expiring in the next 30 days"]}),e.jsx("div",{style:{fontSize:"12px",color:t.textSecondary},children:"Consider setting up renewal reminders for these accounts."})]})]}),e.jsx("button",{onClick:()=>B("expiring"),style:{padding:"8px 16px",backgroundColor:t.warning,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"View Expiring"})]})]})},J=({width:t="100%",height:o="20px"})=>e.jsx("div",{style:{width:t,height:o,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Fe=({status:t,theme:o})=>{const i={active:{bg:`${o.success}20`,text:o.success},pending:{bg:`${o.warning}20`,text:o.warning},cancelled:{bg:`${o.danger}20`,text:o.danger},expired:{bg:`${o.textMuted}20`,text:o.textMuted}},r=i[t]||i.pending;return e.jsx("span",{style:{padding:"4px 10px",backgroundColor:r.bg,color:r.text,borderRadius:"20px",fontSize:"11px",fontWeight:"500",textTransform:"capitalize"},children:t})},ae=({event:t,theme:o})=>{const i={sent:"",delivered:"",opened:"",clicked:"",bounced:"",unsubscribed:""};return e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"2px 8px",backgroundColor:o.bgHover,borderRadius:"4px",fontSize:"11px",color:o.textSecondary},children:[i[t]||""," ",t]})},Et=({policy:t,theme:o})=>{var s;const i=t.expiration_date?Math.ceil((new Date(t.expiration_date)-new Date)/864e5):null,r=t.policy_lob||t.policy_type||"Unknown",n=t.policy_status||t.status||"unknown",a=((s=t.carrier)==null?void 0:s.name)||t.carrier_name||t.carrier||"";return e.jsxs("div",{style:{padding:"16px",backgroundColor:o.bg,borderRadius:"10px",border:`1px solid ${o.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[e.jsx("div",{style:{padding:"8px 12px",backgroundColor:`${o.primary}15`,borderRadius:"8px",fontSize:"14px",fontWeight:"600",color:o.primary},children:r}),e.jsx(Fe,{status:n.toLowerCase(),theme:o})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",fontSize:"13px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:o.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Policy Number"}),e.jsx("div",{style:{color:o.text},children:t.policy_number||""})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:o.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Carrier"}),e.jsx("div",{style:{color:o.text},children:a})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:o.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Effective Date"}),e.jsx("div",{style:{color:o.text},children:t.effective_date?new Date(t.effective_date).toLocaleDateString():""})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:o.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Expiration"}),e.jsx("div",{style:{color:i!==null&&i>0&&i<=30?o.warning:o.text},children:t.expiration_date?e.jsxs(e.Fragment,{children:[new Date(t.expiration_date).toLocaleDateString(),i!==null&&i>0&&i<=30&&e.jsxs("span",{style:{fontSize:"11px",marginLeft:"6px"},children:["(",i,"d left)"]})]}):""})]})]}),(t.premium||t.annual_premium)&&e.jsxs("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:`1px solid ${o.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"12px",color:o.textMuted},children:"Annual Premium"}),e.jsxs("span",{style:{fontSize:"16px",fontWeight:"600",color:o.success},children:["$",(t.premium||t.annual_premium).toLocaleString()]})]})]})},Mt=({log:t,theme:o})=>{var i;return e.jsxs("div",{style:{padding:"14px",backgroundColor:o.bg,borderRadius:"8px",border:`1px solid ${o.border}`,marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:o.text},children:((i=t.email_templates)==null?void 0:i.name)||"Direct Email"}),e.jsx("div",{style:{fontSize:"12px",color:o.textSecondary,marginTop:"2px"},children:t.subject})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs("div",{style:{fontSize:"11px",color:o.textMuted},children:[new Date(t.sent_at).toLocaleDateString()," at"," ",new Date(t.sent_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})})]}),e.jsxs("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:[e.jsx(ae,{event:"sent",theme:o}),t.delivered_at&&e.jsx(ae,{event:"delivered",theme:o}),t.opened_at&&e.jsx(ae,{event:"opened",theme:o}),t.clicked_at&&e.jsx(ae,{event:"clicked",theme:o}),t.bounced_at&&e.jsx(ae,{event:"bounced",theme:o})]})]})},Dt=({activity:t,theme:o})=>{const i={email_sent:"",email_opened:"",email_clicked:"",enrollment_started:"",enrollment_completed:"",enrollment_paused:"",note_added:""};return e.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[e.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:o.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:i[t.action_type]||""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:"13px",color:o.text},children:t.description}),e.jsx("div",{style:{fontSize:"11px",color:o.textMuted,marginTop:"2px"},children:new Date(t.created_at).toLocaleString()})]})]})},we=({enrollment:t,theme:o,userId:i})=>{var r;return e.jsxs("div",{style:{padding:"14px",backgroundColor:o.bg,borderRadius:"8px",border:`1px solid ${o.border}`,marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(Z,{to:`/${i}/automations/${t.automation_id}`,style:{fontSize:"14px",fontWeight:"500",color:o.text,textDecoration:"none"},children:((r=t.automations)==null?void 0:r.name)||"Unknown Automation"}),e.jsxs("div",{style:{fontSize:"12px",color:o.textMuted,marginTop:"2px"},children:["Started ",new Date(t.enrolled_at).toLocaleDateString()]})]}),e.jsx(Fe,{status:t.status==="active"?"active":t.status,theme:o})]}),t.current_node_id&&e.jsxs("div",{style:{marginTop:"10px",padding:"8px 10px",backgroundColor:o.bgHover,borderRadius:"6px",fontSize:"12px",color:o.textSecondary},children:[" Current step: ",t.current_node_name||t.current_node_id]})]})},Pt=({t})=>{var I,C;const{userId:o,accountId:i}=P(),r=ie(),[n,a]=k.useState("overview"),{data:s,isLoading:d,error:c}=pt(i),{data:l,isLoading:b}=at(n==="overview"||n==="emails"?i:null),{data:x,isLoading:_}=gt(n==="activity"?i:null),{data:v,isLoading:h}=nt(n==="overview"||n==="automations"?i:null),{data:w}=Me(),y={emailsSent:(l==null?void 0:l.length)||0,opened:(l==null?void 0:l.filter(m=>m.opened_at).length)||0,clicked:(l==null?void 0:l.filter(m=>m.clicked_at).length)||0,openRate:(l==null?void 0:l.length)>0?Math.round(l.filter(m=>m.opened_at).length/l.length*100):0,clickRate:(l==null?void 0:l.length)>0?Math.round(l.filter(m=>m.clicked_at).length/l.length*100):0,activeEnrollments:(v==null?void 0:v.filter(m=>m.status==="active").length)||0},g={openRate:(w==null?void 0:w.openRate)||25,clickRate:(w==null?void 0:w.clickRate)||5};if(d)return e.jsxs("div",{children:[e.jsx(J,{width:"200px",height:"32px"}),e.jsx("div",{style:{marginTop:"20px"},children:e.jsx(J,{height:"200px"})})]});if(c||!s)return e.jsxs("div",{style:{padding:"60px 20px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),e.jsx("h2",{style:{color:t.text,marginBottom:"8px"},children:"Account Not Found"}),e.jsx("p",{style:{color:t.textSecondary,marginBottom:"24px"},children:"We couldn't find the account you're looking for."}),e.jsx("button",{onClick:()=>r(`/${o}/accounts`),style:{padding:"10px 20px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Accounts"})]});const z=[{id:"overview",label:"Overview"},{id:"emails",label:`Emails (${(l==null?void 0:l.length)||0})`},{id:"automations",label:`Automations (${(v==null?void 0:v.length)||0})`},{id:"activity",label:"Activity"}];return e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("button",{onClick:()=>r(`/${o}/accounts`),style:{background:"none",border:"none",color:t.textMuted,cursor:"pointer",fontSize:"14px",marginBottom:"12px",padding:0,display:"flex",alignItems:"center",gap:"6px"},children:" Back to Accounts"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:t.text,marginBottom:"4px"},children:s.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(()=>{const m=(s.account_status||"").toLowerCase();let R=m;(m==="prior_customer"||m.startsWith("prior"))&&(R="prior"),m.startsWith("customer")&&(R="customer"),m.startsWith("prospect")&&(R="prospect"),m.startsWith("lead")&&(R="lead");const q={customer:{bg:`${t.success}20`,text:t.success,label:"Customer"},prospect:{bg:`${t.primary}20`,text:t.primary,label:"Prospect"},prior:{bg:`${t.textMuted}20`,text:t.textMuted,label:"Prior Customer"},lead:{bg:`${t.warning}20`,text:t.warning,label:"Lead"}},B=q[R]||q.prospect;return e.jsx("span",{style:{padding:"4px 10px",backgroundColor:B.bg,color:B.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:B.label})})(),s.account_unique_id&&e.jsxs("span",{style:{fontSize:"12px",color:t.textMuted},children:["ID: ",s.account_unique_id]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{style:{padding:"10px 16px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:" Add Note"}),e.jsx("button",{style:{padding:"10px 16px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:" Send Email"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"24px",padding:"16px 20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,marginBottom:"24px",flexWrap:"wrap"},children:[(s.person_email||s.email)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"16px"},children:""}),e.jsx("a",{href:`mailto:${s.person_email||s.email}`,style:{color:t.primary,textDecoration:"none",fontSize:"14px"},children:s.person_email||s.email})]}),s.phone&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"16px"},children:""}),e.jsx("a",{href:`tel:${s.phone}`,style:{color:t.text,textDecoration:"none",fontSize:"14px"},children:s.phone})]}),(s.billing_street||s.billing_city||s.billing_state)&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"16px"},children:""}),e.jsx("span",{style:{color:t.textSecondary,fontSize:"14px"},children:[s.billing_street,[s.billing_city,s.billing_state].filter(Boolean).join(", "),s.billing_postal_code].filter(Boolean).join("  ")})]}),s.primary_contact_first_name&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"16px"},children:""}),e.jsxs("span",{style:{color:t.textSecondary,fontSize:"14px"},children:[s.primary_contact_first_name," ",s.primary_contact_last_name]})]})]}),e.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:t.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:z.map(m=>e.jsx("button",{onClick:()=>a(m.id),style:{padding:"10px 20px",backgroundColor:n===m.id?t.bgCard:"transparent",border:"none",borderRadius:"8px",color:n===m.id?t.text:t.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:m.label},m.id))}),n==="overview"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsxs("div",{style:{padding:"20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,display:"flex",flexDirection:"column"},children:[e.jsxs("h3",{style:{fontSize:"16px",fontWeight:"600",color:t.text,marginBottom:"16px",flexShrink:0},children:["Policies (",((I=s.policies)==null?void 0:I.length)||0,")"]}),((C=s.policies)==null?void 0:C.length)>0?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto",flex:1,paddingRight:"8px"},children:s.policies.map((m,R)=>e.jsx(Et,{policy:m,theme:t},R))}):e.jsx("div",{style:{padding:"30px",textAlign:"center",color:t.textMuted},children:"No policies on file"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsxs("div",{style:{padding:"20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:t.text,marginBottom:"16px"},children:"Email Engagement"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"20px"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.primary},children:y.emailsSent}),e.jsx("div",{style:{fontSize:"11px",color:t.textMuted},children:"Sent"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.success},children:y.opened}),e.jsx("div",{style:{fontSize:"11px",color:t.textMuted},children:"Opened"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.warning},children:y.clicked}),e.jsx("div",{style:{fontSize:"11px",color:t.textMuted},children:"Clicked"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:t.danger},children:(l==null?void 0:l.filter(m=>m.bounced_at).length)||0}),e.jsx("div",{style:{fontSize:"11px",color:t.textMuted},children:"Bounced"})]})]})]}),e.jsxs("div",{style:{padding:"20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:t.text,marginBottom:"16px"},children:"Compared to Average"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[e.jsx("span",{style:{fontSize:"13px",color:t.textSecondary},children:"Open Rate"}),e.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:y.openRate>=g.openRate?t.success:t.danger},children:[y.openRate,"%",y.openRate>=g.openRate?" ":" "]})]}),e.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:t.bgHover,borderRadius:"4px",overflow:"hidden"},children:[e.jsx("div",{style:{position:"absolute",left:`${Math.min(g.openRate,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:t.textMuted,zIndex:2}}),e.jsx("div",{style:{width:`${Math.min(y.openRate,100)}%`,height:"100%",backgroundColor:y.openRate>=g.openRate?t.success:t.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[e.jsx("span",{style:{fontSize:"10px",color:t.textMuted},children:"0%"}),e.jsxs("span",{style:{fontSize:"10px",color:t.textMuted},children:["Avg: ",g.openRate,"%"]}),e.jsx("span",{style:{fontSize:"10px",color:t.textMuted},children:"100%"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[e.jsx("span",{style:{fontSize:"13px",color:t.textSecondary},children:"Click Rate"}),e.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:y.clickRate>=g.clickRate?t.success:t.danger},children:[y.clickRate,"%",y.clickRate>=g.clickRate?" ":" "]})]}),e.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:t.bgHover,borderRadius:"4px",overflow:"hidden"},children:[e.jsx("div",{style:{position:"absolute",left:`${Math.min(g.clickRate*5,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:t.textMuted,zIndex:2}}),e.jsx("div",{style:{width:`${Math.min(y.clickRate*5,100)}%`,height:"100%",backgroundColor:y.clickRate>=g.clickRate?t.success:t.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[e.jsx("span",{style:{fontSize:"10px",color:t.textMuted},children:"0%"}),e.jsxs("span",{style:{fontSize:"10px",color:t.textMuted},children:["Avg: ",g.clickRate,"%"]}),e.jsx("span",{style:{fontSize:"10px",color:t.textMuted},children:"20%+"})]})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:t.bg,borderRadius:"10px",textAlign:"center",marginTop:"8px"},children:[e.jsx("div",{style:{fontSize:"11px",color:t.textMuted,marginBottom:"4px"},children:"ENGAGEMENT SCORE"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:y.openRate>=g.openRate&&y.clickRate>=g.clickRate?t.success:y.openRate>=g.openRate||y.clickRate>=g.clickRate?t.warning:t.danger},children:y.emailsSent===0?"":y.openRate>=g.openRate&&y.clickRate>=g.clickRate?"High":y.openRate>=g.openRate||y.clickRate>=g.clickRate?"Medium":"Low"}),e.jsx("div",{style:{fontSize:"12px",color:t.textSecondary,marginTop:"4px"},children:y.emailsSent===0?"No emails sent yet":y.openRate>=g.openRate?"Above average engagement":"Below average engagement"})]})]})]}),e.jsxs("div",{style:{padding:"20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:t.text,marginBottom:"16px"},children:"Active Automations"}),(v==null?void 0:v.filter(m=>m.status==="active").length)>0?v.filter(m=>m.status==="active").map(m=>e.jsx(we,{enrollment:m,theme:t,userId:o},m.id)):e.jsx("div",{style:{padding:"20px",textAlign:"center",color:t.textMuted,fontSize:"13px"},children:"Not enrolled in any automations"})]})]})]}),n==="emails"&&e.jsxs("div",{style:{padding:"20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:t.text,marginBottom:"16px"},children:"Email History"}),b?Array.from({length:3}).map((m,R)=>e.jsx("div",{style:{marginBottom:"12px"},children:e.jsx(J,{height:"80px"})},R)):(l==null?void 0:l.length)>0?l.map(m=>e.jsx(Mt,{log:m,theme:t},m.id)):e.jsx("div",{style:{padding:"40px",textAlign:"center",color:t.textMuted},children:"No emails sent to this client yet"})]}),n==="automations"&&e.jsxs("div",{style:{padding:"20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:t.text,margin:0},children:"Automation Enrollments"}),e.jsx("button",{style:{padding:"8px 12px",backgroundColor:t.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:"+ Enroll in Automation"})]}),h?Array.from({length:2}).map((m,R)=>e.jsx("div",{style:{marginBottom:"12px"},children:e.jsx(J,{height:"60px"})},R)):(v==null?void 0:v.length)>0?v.map(m=>e.jsx(we,{enrollment:m,theme:t,userId:o},m.id)):e.jsx("div",{style:{padding:"40px",textAlign:"center",color:t.textMuted},children:"Not enrolled in any automations"})]}),n==="activity"&&e.jsxs("div",{style:{padding:"20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:t.text,marginBottom:"16px"},children:"Activity Timeline"}),_?Array.from({length:5}).map((m,R)=>e.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[e.jsx(J,{width:"32px",height:"32px"}),e.jsxs("div",{style:{flex:1},children:[e.jsx(J,{width:"80%",height:"14px"}),e.jsx("div",{style:{marginTop:"4px"},children:e.jsx(J,{width:"120px",height:"12px"})})]})]},R)):(x==null?void 0:x.length)>0?e.jsx("div",{style:{borderLeft:`2px solid ${t.border}`,marginLeft:"15px",paddingLeft:"20px"},children:x.map(m=>e.jsx(Dt,{activity:m,theme:t},m.id))}):e.jsx("div",{style:{padding:"40px",textAlign:"center",color:t.textMuted},children:"No activity recorded yet"})]})]})},ye=({width:t="100%",height:o="20px"})=>e.jsx("div",{style:{width:t,height:o,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),U=({label:t,value:o,onChange:i,placeholder:r,type:n="text",disabled:a,hint:s,theme:d})=>e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:d.text,display:"block",marginBottom:"6px"},children:t}),e.jsx("input",{type:n,value:o||"",onChange:c=>i(c.target.value),placeholder:r,disabled:a,style:{width:"100%",padding:"12px",backgroundColor:a?d.bgHover:d.bgInput,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px",opacity:a?.6:1}}),s&&e.jsx("p",{style:{fontSize:"11px",color:d.textMuted,marginTop:"4px"},children:s})]}),Ft=({label:t,value:o,onChange:i,placeholder:r,rows:n=3,disabled:a,theme:s})=>e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:s.text,display:"block",marginBottom:"6px"},children:t}),e.jsx("textarea",{value:o||"",onChange:d=>i(d.target.value),placeholder:r,rows:n,disabled:a,style:{width:"100%",padding:"12px",backgroundColor:a?s.bgHover:s.bgInput,border:`1px solid ${s.border}`,borderRadius:"8px",color:s.text,fontSize:"14px",resize:"vertical",opacity:a?.6:1}})]}),Lt=({settings:t,theme:o})=>e.jsxs("div",{style:{padding:"16px",backgroundColor:o.bg,borderRadius:"8px",border:`1px solid ${o.border}`},children:[(t==null?void 0:t.full_name)&&e.jsx("div",{style:{fontWeight:"600",color:o.text},children:t.full_name}),(t==null?void 0:t.job_title)&&e.jsx("div",{style:{color:o.textSecondary,fontSize:"14px"},children:t.job_title}),e.jsx("div",{style:{color:o.textSecondary,fontSize:"14px",marginTop:"4px"},children:[t==null?void 0:t.phone,t==null?void 0:t.email].filter(Boolean).join("  ")}),(t==null?void 0:t.custom_message)&&e.jsx("div",{style:{color:o.textMuted,fontSize:"14px",fontStyle:"italic",marginTop:"8px"},children:t.custom_message}),!(t!=null&&t.full_name)&&!(t!=null&&t.job_title)&&e.jsx("div",{style:{color:o.textMuted,fontSize:"14px"},children:"Fill in your details to see a preview"})]}),Ht=({t})=>{const{userId:o}=P(),[i,r]=k.useState("signature"),[n,a]=k.useState(!1),[s,d]=k.useState(null),{data:c,isLoading:l,error:b}=lt(),{updateSettings:x,updateSignature:_}=dt(),[v,h]=k.useState({full_name:"",job_title:"",phone:"",email:"",custom_message:"",agency_name:"",agency_address:"",agency_phone:"",agency_website:"",default_from_name:"",default_from_email:"",reply_to_email:"",sending_domain:""});k.useEffect(()=>{c&&h({full_name:c.full_name||"",job_title:c.job_title||"",phone:c.phone||"",email:c.email||"",custom_message:c.custom_message||"",agency_name:c.agency_name||"",agency_address:c.agency_address||"",agency_phone:c.agency_phone||"",agency_website:c.agency_website||"",default_from_name:c.default_from_name||"",default_from_email:c.default_from_email||"",reply_to_email:c.reply_to_email||"",sending_domain:c.sending_domain||""})},[c]);const w=I=>C=>{h(m=>({...m,[I]:C})),d(null)},y=async()=>{a(!0),d(null);try{await _.mutateAsync({full_name:v.full_name,job_title:v.job_title,phone:v.phone,email:v.email,custom_message:v.custom_message}),d({type:"success",text:"Signature saved successfully!"})}catch{d({type:"error",text:"Failed to save signature. Please try again."})}finally{a(!1)}},g=async()=>{a(!0),d(null);try{await x.mutateAsync(v),d({type:"success",text:"Settings saved successfully!"})}catch{d({type:"error",text:"Failed to save settings. Please try again."})}finally{a(!1)}},z=[{id:"signature",label:"Email Signature",icon:""},{id:"agency",label:"Agency Info",icon:""},{id:"email",label:"Email Settings",icon:""},{id:"integrations",label:"Integrations",icon:""}];return e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:t.text,marginBottom:"4px"},children:"Settings"}),e.jsx("p",{style:{color:t.textSecondary,fontSize:"14px",margin:0},children:"Manage your email preferences and configuration"})]}),b&&e.jsx("div",{style:{padding:"16px",backgroundColor:`${t.danger}15`,border:`1px solid ${t.danger}30`,borderRadius:"8px",marginBottom:"24px",color:t.danger,fontSize:"14px"},children:"Failed to load settings. Please try refreshing the page."}),s&&e.jsx("div",{style:{padding:"12px 16px",backgroundColor:s.type==="success"?`${t.success}15`:`${t.danger}15`,border:`1px solid ${s.type==="success"?t.success:t.danger}30`,borderRadius:"8px",marginBottom:"24px",color:s.type==="success"?t.success:t.danger,fontSize:"14px"},children:s.text}),e.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:t.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:z.map(I=>e.jsxs("button",{onClick:()=>r(I.id),style:{padding:"10px 20px",backgroundColor:i===I.id?t.bgCard:"transparent",border:"none",borderRadius:"8px",color:i===I.id?t.text:t.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[I.icon," ",I.label]},I.id))}),l?e.jsxs("div",{style:{padding:"24px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsx(ye,{width:"200px",height:"24px"}),e.jsx("div",{style:{marginTop:"24px"},children:e.jsx(ye,{height:"40px"})}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsx(ye,{height:"40px"})})]}):e.jsxs(e.Fragment,{children:[i==="signature"&&e.jsxs("div",{style:{padding:"24px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:t.text,marginBottom:"4px"},children:"Your Email Signature"}),e.jsx("p",{style:{fontSize:"13px",color:t.textSecondary,marginBottom:"24px"},children:"This signature will be automatically added to all emails you send through the platform"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(U,{label:"Full Name",value:v.full_name,onChange:w("full_name"),placeholder:"John Doe",theme:t}),e.jsx(U,{label:"Job Title",value:v.job_title,onChange:w("job_title"),placeholder:"Insurance Advisor",theme:t}),e.jsx(U,{label:"Phone Number",value:v.phone,onChange:w("phone"),placeholder:"(555) 123-4567",theme:t}),e.jsx(U,{label:"Email Address",value:v.email,onChange:w("email"),placeholder:"john.doe@company.com",type:"email",theme:t})]}),e.jsx(Ft,{label:"Custom Message (Optional)",value:v.custom_message,onChange:w("custom_message"),placeholder:"Looking forward to serving you!",theme:t}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:t.text,display:"block",marginBottom:"8px"},children:"Preview"}),e.jsx(Lt,{settings:v,theme:t})]}),e.jsx("button",{onClick:y,disabled:n,style:{padding:"12px 24px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:n?"wait":"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px",opacity:n?.7:1},children:n?" Saving...":" Save Signature"})]}),i==="agency"&&e.jsxs("div",{style:{padding:"24px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:t.text,marginBottom:"4px"},children:"Agency Information"}),e.jsx("p",{style:{fontSize:"13px",color:t.textSecondary,marginBottom:"24px"},children:"Your agency details used in email templates and footers"}),e.jsx(U,{label:"Agency Name",value:v.agency_name,onChange:w("agency_name"),placeholder:"Insurance Solutions Group",theme:t}),e.jsx(U,{label:"Address",value:v.agency_address,onChange:w("agency_address"),placeholder:"123 Main Street, Suite 100, Dallas, TX 75201",theme:t}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(U,{label:"Phone",value:v.agency_phone,onChange:w("agency_phone"),placeholder:"(555) 000-0000",theme:t}),e.jsx(U,{label:"Website",value:v.agency_website,onChange:w("agency_website"),placeholder:"https://www.example.com",theme:t})]}),e.jsx("button",{onClick:g,disabled:n,style:{padding:"12px 24px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:n?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:n?.7:1},children:n?" Saving...":" Save Agency Info"})]}),i==="email"&&e.jsxs("div",{style:{padding:"24px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:t.text,marginBottom:"4px"},children:"Email Configuration"}),e.jsx("p",{style:{fontSize:"13px",color:t.textSecondary},children:"Configure your sending domain and default email settings"})]}),e.jsx("span",{style:{padding:"4px 10px",backgroundColor:t.bgHover,borderRadius:"20px",fontSize:"11px",color:t.textSecondary},children:"Admin Only"})]}),e.jsx(U,{label:"Sending Domain",value:v.sending_domain,onChange:w("sending_domain"),placeholder:"emails.yourcompany.com",hint:"The domain that will be used to send emails. Must be verified in SendGrid.",theme:t}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(U,{label:"Default From Name",value:v.default_from_name,onChange:w("default_from_name"),placeholder:"Your Company",theme:t}),e.jsx(U,{label:"Default From Email",value:v.default_from_email,onChange:w("default_from_email"),placeholder:"noreply@yourcompany.com",type:"email",theme:t})]}),e.jsx(U,{label:"Reply-To Email",value:v.reply_to_email,onChange:w("reply_to_email"),placeholder:"support@yourcompany.com",type:"email",hint:"Where replies will be directed when recipients respond to automated emails.",theme:t}),e.jsx("button",{onClick:g,disabled:n,style:{padding:"12px 24px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:n?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:n?.7:1},children:n?" Saving...":" Save Configuration"})]}),i==="integrations"&&e.jsxs("div",{style:{padding:"24px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:t.text,marginBottom:"24px"},children:"Integrations"}),e.jsx("div",{style:{padding:"20px",backgroundColor:t.bg,borderRadius:"10px",border:`1px solid ${t.border}`,marginBottom:"16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#1A82E2",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SG"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"600",color:t.text,marginBottom:"2px"},children:"SendGrid"}),e.jsx("div",{style:{fontSize:"13px",color:t.textSecondary},children:"Email delivery service"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${t.success}20`,color:t.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),e.jsx("button",{style:{padding:"8px 12px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"6px",color:t.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Configure"})]})]})}),e.jsx("div",{style:{padding:"20px",backgroundColor:t.bg,borderRadius:"10px",border:`1px solid ${t.border}`,marginBottom:"16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#00A1E0",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SF"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"600",color:t.text,marginBottom:"2px"},children:"Salesforce"}),e.jsx("div",{style:{fontSize:"13px",color:t.textSecondary},children:"CRM data sync"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${t.success}20`,color:t.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),e.jsx("button",{style:{padding:"8px 12px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"6px",color:t.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Sync Now"})]})]})}),e.jsxs("div",{style:{padding:"16px",backgroundColor:`${t.primary}10`,borderRadius:"8px",marginTop:"24px"},children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:t.text,marginBottom:"4px"},children:" Webhook URL"}),e.jsx("div",{style:{fontSize:"12px",color:t.textSecondary,marginBottom:"8px"},children:"Configure this URL in SendGrid to receive email event notifications"}),e.jsxs("code",{style:{display:"block",padding:"8px 12px",backgroundColor:t.bgCard,borderRadius:"6px",fontSize:"12px",color:t.primary,wordBreak:"break-all"},children:["https://your-app-url.com/api/webhooks/sendgrid/",o]})]})]})]})]})},Le={bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},Nt=({onClose:t,t:o=Le})=>{const[i,r]=k.useState("simple"),[n,a]=k.useState("OR"),[s,d]=k.useState(""),[c,l]=k.useState(null),b=[{id:1,name:"John Smith",policies:"Auto only  Expires in 52 days",passes:!0,conditions:[{label:"Has policy type: Auto",passes:!0,value:"Auto (Active)"},{label:"Has policy type: Home",passes:!0,value:"None (Excluded)"},{label:"Expiration: 45-60 days",passes:!0,value:"52 days"}],groupResults:[{passes:!0},{passes:!1}]},{id:2,name:"Jane Wilson",policies:"Home only  Expires in 48 days",passes:!0,conditions:[{label:"Has policy type: Home",passes:!0,value:"Home (Active)"},{label:"Has policy type: Auto",passes:!0,value:"None (Excluded)"},{label:"Expiration: 45-60 days",passes:!0,value:"48 days"}],groupResults:[{passes:!1},{passes:!0}]},{id:3,name:"Bob Johnson",policies:"Auto + Home  Expires in 55 days",passes:!1,conditions:[{label:"Has policy type: Auto",passes:!0,value:"Auto (Active)"},{label:"Excludes: Home",passes:!1,reason:"Account has Home policy",value:"Home (Active)"},{label:"Expiration: 45-60 days",passes:!0,value:"55 days"}],groupResults:[{passes:!1},{passes:!1}]},{id:4,name:"Sarah Davis",policies:"Auto only  Expires in 90 days",passes:!1,conditions:[{label:"Has policy type: Auto",passes:!0,value:"Auto (Active)"},{label:"Has policy type: Home",passes:!0,value:"None (Excluded)"},{label:"Expiration: 45-60 days",passes:!1,reason:"Outside timing window",value:"90 days"}],groupResults:[{passes:!1},{passes:!1}]}].filter(p=>p.name.toLowerCase().includes(s.toLowerCase())),[x,_]=k.useState([{id:1,name:"Group 1",logic:"AND",color:o.primary,filters:{include:[{id:1,conditionId:"has_policy_type",label:"Has policy type",icon:"",value:"Auto"}],exclude:[{id:2,conditionId:"has_policy_type",label:"Has policy type",icon:"",value:"Home"}],activity:[]}},{id:2,name:"Group 2",logic:"AND",color:o.purple,filters:{include:[{id:3,conditionId:"has_policy_type",label:"Has policy type",icon:"",value:"Home"}],exclude:[{id:4,conditionId:"has_policy_type",label:"Has policy type",icon:"",value:"Auto"}],activity:[]}}]),[v,h]=k.useState({enabled:!0,field:"expiration_days",min:45,max:60}),w={"Customer Type":{icon:"",color:o.purple,conditions:[{id:"customer_status",label:"Customer status",configType:"select",options:["New","Existing","Prior","Prospect"]},{id:"is_new",label:"Is a new customer",configType:"none"},{id:"is_existing",label:"Is an existing customer",configType:"none"},{id:"is_prior",label:"Is a prior customer",configType:"none"}]},"Policy Bundle":{icon:"",color:o.primary,conditions:[{id:"bundle_status",label:"Bundle status",configType:"select",options:["Monoline","Bundled"]},{id:"policy_count",label:"Number of policies",configType:"number_compare",unit:"policies"}]},Coverage:{icon:"",color:o.success,conditions:[{id:"has_policy_type",label:"Has policy type",configType:"select",options:["Auto","Home","Renters","Umbrella","Life","Any Active"]},{id:"policy_status",label:"Policy status",configType:"select",options:["Active","Pending","Cancelled","Expired"]},{id:"has_active_renewal",label:"Has an active renewal",configType:"none"}]},"Policy Timing":{icon:"",color:o.warning,conditions:[{id:"expiration_days",label:"Expiration date",configType:"days_from_now"},{id:"effective_days",label:"Effective date",configType:"days_ago"},{id:"approaching_renewal",label:"Is approaching renewal",configType:"none"}]},"Email History":{icon:"",color:"#06b6d4",conditions:[{id:"no_email_in",label:"Hasn't received email in",configType:"days_threshold",defaultValue:30},{id:"received_template",label:"Has received email",configType:"select",options:["Welcome","Renewal","Cross Sell","Follow-Up","Feedback"]},{id:"not_received_template",label:"Has NOT received email",configType:"select",options:["Welcome","Renewal","Cross Sell","Follow-Up","Feedback"]}]},Engagement:{icon:"",color:"#8b5cf6",conditions:[{id:"opened_last",label:"Opened last email",configType:"none"},{id:"clicked_last",label:"Clicked last email",configType:"none"},{id:"no_opens_in",label:"Hasn't opened email in",configType:"days_threshold",defaultValue:60}]},Feedback:{icon:"",color:"#eab308",conditions:[{id:"feedback_score",label:"Feedback score",configType:"number_compare",unit:"stars",max:5},{id:"gave_feedback",label:"Has given feedback",configType:"none"},{id:"no_feedback",label:"Has not given feedback",configType:"none"}]}},y=["#3b82f6","#a78bfa","#22c55e","#f59e0b","#ec4899","#06b6d4"],g=()=>{const p=Math.max(...x.map(f=>f.id),0)+1;_([...x,{id:p,name:`Group ${p}`,logic:"AND",color:y[(p-1)%y.length],filters:{include:[],exclude:[],activity:[]}}])},z=p=>{x.length>1&&_(x.filter(f=>f.id!==p))},I=(p,f,S)=>{_(x.map(j=>j.id===p?{...j,filters:{...j.filters,[f]:[...j.filters[f],{...S,id:Date.now()}]}}:j))},C=(p,f,S,j)=>{_(x.map($=>$.id===p?{...$,filters:{...$.filters,[f]:$.filters[f].map(T=>T.id===S?{...T,...j}:T)}}:$))},m=(p,f,S)=>{_(x.map(j=>j.id===p?{...j,filters:{...j.filters,[f]:j.filters[f].filter($=>$.id!==S)}}:j))},R=p=>{for(const f of Object.values(w)){const S=f.conditions.find(j=>j.id===p);if(S)return S}return null},q=({filter:p,groupId:f,section:S,color:j})=>{const $=R(p.conditionId),T=()=>{if(!$)return null;switch($.configType){case"select":return e.jsx("select",{value:p.value||$.options[0],onChange:M=>C(f,S,p.id,{value:M.target.value}),style:{backgroundColor:o.bgHover,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"4px 8px",color:o.text,fontSize:"12px",marginLeft:"6px"},children:$.options.map(M=>e.jsx("option",{value:M,children:M},M))});case"days_threshold":return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginLeft:"6px"},children:[e.jsx("input",{type:"number",value:p.value||$.defaultValue||30,onChange:M=>C(f,S,p.id,{value:M.target.value}),style:{backgroundColor:o.bgHover,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"4px 6px",color:o.text,fontSize:"12px",width:"50px",textAlign:"center"}}),e.jsx("span",{style:{color:o.textMuted,fontSize:"11px"},children:"days"})]});case"number_compare":return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginLeft:"6px"},children:[e.jsxs("select",{value:p.operator||"at_least",onChange:M=>C(f,S,p.id,{operator:M.target.value}),style:{backgroundColor:o.bgHover,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"4px 6px",color:o.text,fontSize:"11px"},children:[e.jsx("option",{value:"equals",children:"equals"}),e.jsx("option",{value:"at_least",children:"at least"}),e.jsx("option",{value:"at_most",children:"at most"})]}),e.jsx("input",{type:"number",value:p.value||1,max:$.max,onChange:M=>C(f,S,p.id,{value:M.target.value}),style:{backgroundColor:o.bgHover,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"4px 6px",color:o.text,fontSize:"12px",width:"45px",textAlign:"center"}}),$.unit&&e.jsx("span",{style:{color:o.textMuted,fontSize:"11px"},children:$.unit})]});default:return null}};return e.jsxs("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"4px",padding:"8px 10px",backgroundColor:`${j}12`,borderRadius:"8px",border:`1px solid ${j}25`,fontSize:"13px",color:o.text},children:[e.jsx("span",{style:{opacity:.7},children:p.icon}),e.jsx("span",{children:p.label}),T(),e.jsx("button",{onClick:()=>m(f,S,p.id),style:{background:"none",border:"none",color:o.textMuted,cursor:"pointer",padding:"0 2px",fontSize:"16px",lineHeight:1,marginLeft:"auto"},children:""})]})},B=({groupId:p,section:f,onSelect:S,buttonColor:j})=>{const[$,T]=k.useState(!1),[M,K]=k.useState(null),G=f==="include"?"Add condition":f==="exclude"?"Add exclusion":"Add activity filter";return e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("button",{onClick:()=>T(!$),style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:`1px dashed ${o.borderLight}`,borderRadius:"8px",color:o.textMuted,cursor:"pointer",fontSize:"12px",textAlign:"left",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{color:j},children:"+"})," ",G]}),$&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:()=>{T(!1),K(null)}}),e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",backgroundColor:o.bgCard,border:`1px solid ${o.borderLight}`,borderRadius:"12px",zIndex:100,overflow:"hidden",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},children:e.jsxs("div",{style:{display:"flex",maxHeight:"280px"},children:[e.jsx("div",{style:{width:"140px",borderRight:"1px solid #3f3f46",overflowY:"auto"},children:Object.entries(w).map(([A,V])=>e.jsxs("button",{onClick:()=>K(A),style:{width:"100%",padding:"8px 10px",backgroundColor:M===A?"#27272a":"transparent",border:"none",borderLeft:M===A?`3px solid ${V.color}`:"3px solid transparent",color:M===A?"#fafafa":"#a1a1aa",cursor:"pointer",fontSize:"11px",textAlign:"left",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{children:V.icon})," ",A]},A))}),e.jsx("div",{style:{flex:1,padding:"6px",overflowY:"auto",minWidth:"180px"},children:M?w[M].conditions.map(A=>e.jsx("button",{onClick:()=>{S({conditionId:A.id,label:A.label,icon:w[M].icon,value:A.options?A.options[0]:A.defaultValue}),T(!1),K(null)},style:{width:"100%",padding:"8px 10px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:o.text,cursor:"pointer",fontSize:"12px",textAlign:"left"},children:A.label},A.id)):e.jsx("div",{style:{padding:"20px 12px",textAlign:"center",color:o.textMuted,fontSize:"11px"},children:" Select category"})})]})})]})]})},E=()=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 0"},children:[e.jsx("div",{style:{height:"14px",width:"2px",backgroundColor:o.borderLight}}),e.jsx("button",{onClick:()=>a(n==="OR"?"AND":"OR"),style:{margin:"0 -1px",padding:"4px 12px",backgroundColor:n==="OR"?"#7c3aed":"#0891b2",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",fontSize:"10px",fontWeight:"700"},children:n}),e.jsx("div",{style:{height:"14px",width:"2px",backgroundColor:o.borderLight}})]}),W=({group:p,index:f})=>e.jsxs("div",{style:{backgroundColor:o.bg,borderRadius:"10px",border:`2px solid ${p.color}30`,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"8px 12px",backgroundColor:`${p.color}10`,borderBottom:`1px solid ${p.color}20`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"5px",backgroundColor:p.color,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"700",color:"#fff"},children:f+1}),e.jsx("input",{type:"text",value:p.name,onChange:S=>_(x.map(j=>j.id===p.id?{...j,name:S.target.value}:j)),style:{background:"none",border:"none",color:o.text,fontSize:"12px",fontWeight:"600",width:"80px"}})]}),x.length>1&&e.jsx("button",{onClick:()=>z(p.id),style:{background:"none",border:"none",color:o.textMuted,cursor:"pointer",fontSize:"16px"},children:""})]}),e.jsxs("div",{style:{padding:"12px"},children:[e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsxs("div",{style:{fontSize:"10px",fontWeight:"600",color:o.success,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:""})," INCLUDE"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[p.filters.include.map(S=>e.jsx(q,{filter:S,groupId:p.id,section:"include",color:"#22c55e"},S.id)),e.jsx(B,{groupId:p.id,section:"include",onSelect:S=>I(p.id,"include",S),buttonColor:"#22c55e"})]})]}),e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsxs("div",{style:{fontSize:"10px",fontWeight:"600",color:o.danger,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:""})," EXCLUDE"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[p.filters.exclude.map(S=>e.jsx(q,{filter:S,groupId:p.id,section:"exclude",color:"#ef4444"},S.id)),e.jsx(B,{groupId:p.id,section:"exclude",onSelect:S=>I(p.id,"exclude",S),buttonColor:"#ef4444"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"10px",fontWeight:"600",color:"#06b6d4",marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:""})," ACTIVITY"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[p.filters.activity.map(S=>e.jsx(q,{filter:S,groupId:p.id,section:"activity",color:"#06b6d4"},S.id)),e.jsx(B,{groupId:p.id,section:"activity",onSelect:S=>I(p.id,"activity",S),buttonColor:"#06b6d4"})]})]})]})]});return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 280px",gap:"16px",height:"100%"},children:[e.jsxs("div",{style:{overflowY:"auto",paddingRight:"8px"},children:[e.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"16px",backgroundColor:o.bgHover,padding:"3px",borderRadius:"8px",width:"fit-content"},children:[{id:"simple",label:"Guided",icon:""},{id:"advanced",label:"Advanced",icon:""}].map(p=>e.jsxs("button",{onClick:()=>r(p.id),style:{padding:"6px 12px",borderRadius:"6px",border:"none",cursor:"pointer",fontSize:"11px",fontWeight:"500",backgroundColor:i===p.id?"#3b82f6":"transparent",color:i===p.id?"#fff":"#71717a",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:p.icon})," ",p.label]},p.id))}),i==="simple"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px",padding:"8px 12px",backgroundColor:o.bgHover,borderRadius:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"12px",color:o.textSecondary},children:"Filter Groups"}),x.length>1&&e.jsxs("span",{style:{padding:"2px 6px",backgroundColor:n==="OR"?"#7c3aed25":"#0891b225",borderRadius:"4px",fontSize:"9px",fontWeight:"600",color:n==="OR"?"#a78bfa":"#22d3ee"},children:[x.length," groups  ",n]})]}),e.jsx("button",{onClick:g,style:{padding:"4px 8px",backgroundColor:o.primary,border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer",fontSize:"10px",fontWeight:"500"},children:"+ Add Group"})]}),x.map((p,f)=>e.jsxs(oe.Fragment,{children:[e.jsx(W,{group:p,index:f}),f<x.length-1&&e.jsx(E,{})]},p.id)),e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"8px"},children:[e.jsx("span",{style:{fontSize:"11px",color:o.primary},children:""}),e.jsx("span",{style:{fontSize:"12px",fontWeight:"600",color:o.text},children:"Timing"})]}),e.jsx("div",{style:{padding:"12px",backgroundColor:"rgba(59, 130, 246, 0.08)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[e.jsx("span",{style:{fontSize:"12px",color:o.textSecondary},children:"When"}),e.jsxs("select",{style:{backgroundColor:o.bgHover,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"6px 8px",color:o.text,fontSize:"11px"},children:[e.jsx("option",{children:"Days until expiration"}),e.jsx("option",{children:"Days since effective"}),e.jsx("option",{children:"Days since status change"})]}),e.jsx("span",{style:{fontSize:"12px",color:o.textSecondary},children:"is between"}),e.jsx("input",{type:"number",defaultValue:v.min,style:{backgroundColor:o.bgHover,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"6px",color:o.text,fontSize:"11px",width:"45px",textAlign:"center"}}),e.jsx("span",{style:{fontSize:"12px",color:o.textSecondary},children:"and"}),e.jsx("input",{type:"number",defaultValue:v.max,style:{backgroundColor:o.bgHover,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"6px",color:o.text,fontSize:"11px",width:"45px",textAlign:"center"}}),e.jsx("span",{style:{fontSize:"12px",color:o.textSecondary},children:"days"})]})})]})]}),i==="advanced"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px",padding:"8px 12px",backgroundColor:o.bgHover,borderRadius:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"12px",color:o.textSecondary},children:"Rule Groups"}),e.jsx("button",{onClick:()=>a(n==="OR"?"AND":"OR"),style:{padding:"3px 8px",backgroundColor:n==="OR"?"#7c3aed":"#0891b2",border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer",fontSize:"9px",fontWeight:"700"},children:n}),e.jsx("span",{style:{fontSize:"10px",color:o.textMuted},children:"between groups"})]}),e.jsx("button",{onClick:g,style:{padding:"4px 8px",backgroundColor:o.primary,border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer",fontSize:"10px",fontWeight:"500"},children:"+ Add Group"})]}),x.map((p,f)=>e.jsxs(oe.Fragment,{children:[e.jsxs("div",{style:{backgroundColor:o.bg,borderRadius:"10px",border:`2px solid ${p.color}30`,marginBottom:f<x.length-1?"0":"16px",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"8px 12px",backgroundColor:`${p.color}10`,borderBottom:`1px solid ${p.color}20`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"4px",backgroundColor:p.color,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"700",color:"#fff"},children:f+1}),e.jsx("input",{type:"text",value:p.name,onChange:S=>_(x.map(j=>j.id===p.id?{...j,name:S.target.value}:j)),style:{background:"none",border:"none",color:o.text,fontSize:"12px",fontWeight:"600",width:"80px"}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{fontSize:"10px",color:o.textMuted},children:"Logic:"}),e.jsxs("select",{value:p.logic,onChange:S=>_(x.map(j=>j.id===p.id?{...j,logic:S.target.value}:j)),style:{backgroundColor:o.bgHover,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"3px 6px",color:o.text,fontSize:"10px"},children:[e.jsx("option",{value:"AND",children:"AND"}),e.jsx("option",{value:"OR",children:"OR"})]}),x.length>1&&e.jsx("button",{onClick:()=>z(p.id),style:{background:"none",border:"none",color:o.textMuted,cursor:"pointer",fontSize:"14px"},children:""})]})]}),e.jsxs("div",{style:{padding:"10px"},children:[[...p.filters.include,...p.filters.exclude].map((S,j)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 10px",backgroundColor:o.bgHover,borderRadius:"6px",marginBottom:"6px"},children:[e.jsxs("span",{style:{fontSize:"10px",color:o.textMuted,width:"16px",fontFamily:"monospace"},children:[j+1,"."]}),e.jsxs("select",{style:{backgroundColor:o.bgCard,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:o.textSecondary,fontSize:"10px",width:"80px"},children:[e.jsx("option",{children:"Field"}),e.jsx("option",{children:"Relationship"})]}),e.jsxs("select",{style:{backgroundColor:o.bgCard,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:o.text,fontSize:"10px",width:"70px"},children:[e.jsx("option",{children:"Policy"}),e.jsx("option",{children:"Account"}),e.jsx("option",{children:"Contact"})]}),e.jsx("span",{style:{color:o.borderLight,fontSize:"10px"},children:"."}),e.jsxs("select",{style:{backgroundColor:o.bgCard,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:o.text,fontSize:"10px",flex:1},children:[e.jsx("option",{children:"Type"}),e.jsx("option",{children:"Status"}),e.jsx("option",{children:"Premium"}),e.jsx("option",{children:"Effective Date"}),e.jsx("option",{children:"Expiration Date"})]}),e.jsxs("select",{style:{backgroundColor:o.bgCard,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:p.filters.exclude.find($=>$.id===S.id)?"#f87171":"#4ade80",fontSize:"10px",width:"80px"},children:[e.jsx("option",{children:"equals"}),e.jsx("option",{children:"not equals"}),e.jsx("option",{children:"contains"}),e.jsx("option",{children:"is empty"}),e.jsx("option",{children:"is not empty"})]}),e.jsx("input",{type:"text",defaultValue:S.value||"",placeholder:"value",style:{backgroundColor:o.bgCard,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:o.text,fontSize:"10px",width:"70px"}}),e.jsx("button",{onClick:()=>{const $=p.filters.include.find(T=>T.id===S.id)?"include":"exclude";m(p.id,$,S.id)},style:{background:"none",border:"none",color:o.textMuted,cursor:"pointer",fontSize:"12px"},children:""})]},S.id)),e.jsx("button",{onClick:()=>I(p.id,"include",{label:"New Rule",value:"",icon:""}),style:{width:"100%",padding:"8px",backgroundColor:"transparent",border:`1px dashed ${o.borderLight}`,borderRadius:"6px",color:o.textMuted,cursor:"pointer",fontSize:"10px"},children:"+ Add Rule"})]})]}),f<x.length-1&&e.jsx(E,{})]},p.id)),e.jsxs("div",{style:{padding:"12px",backgroundColor:"rgba(59, 130, 246, 0.08)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)"},children:[e.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:o.primary,marginBottom:"8px"},children:" Timing Window"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[e.jsxs("select",{style:{backgroundColor:o.bgHover,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"6px 8px",color:o.text,fontSize:"10px"},children:[e.jsx("option",{children:"Policy.ExpirationDate"}),e.jsx("option",{children:"Policy.EffectiveDate"}),e.jsx("option",{children:"Account.StatusChangeDate"}),e.jsx("option",{children:"EmailActivity.LastSentDate"})]}),e.jsxs("select",{style:{backgroundColor:o.bgHover,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"6px 8px",color:o.text,fontSize:"10px"},children:[e.jsx("option",{children:"days from now between"}),e.jsx("option",{children:"days ago between"})]}),e.jsx("input",{type:"number",defaultValue:"45",style:{backgroundColor:o.bgHover,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"6px",color:o.text,fontSize:"10px",width:"40px",textAlign:"center"}}),e.jsx("span",{style:{color:o.textMuted,fontSize:"10px"},children:"AND"}),e.jsx("input",{type:"number",defaultValue:"60",style:{backgroundColor:o.bgHover,border:`1px solid ${o.borderLight}`,borderRadius:"4px",padding:"6px",color:o.text,fontSize:"10px",width:"40px",textAlign:"center"}})]})]})]})]}),e.jsxs("div",{style:{backgroundColor:o.bg,borderRadius:"10px",padding:"14px",display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:o.textMuted,textTransform:"uppercase",marginBottom:"10px"},children:"Audience Preview"}),e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"6px",marginBottom:"12px"},children:[e.jsx("span",{style:{fontSize:"32px",fontWeight:"700",color:o.primary,fontFamily:"monospace",lineHeight:1},children:"1,247"}),e.jsx("span",{style:{color:o.textMuted,fontSize:"12px"},children:"match"})]}),e.jsxs("div",{style:{display:"flex",gap:"6px",marginBottom:"12px"},children:[e.jsxs("div",{style:{flex:1,padding:"8px",backgroundColor:o.bgHover,borderRadius:"6px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:o.success},children:"2,847"}),e.jsx("div",{style:{fontSize:"9px",color:o.textMuted},children:"Included"})]}),e.jsxs("div",{style:{flex:1,padding:"8px",backgroundColor:o.bgHover,borderRadius:"6px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:o.danger},children:"1,600"}),e.jsx("div",{style:{fontSize:"9px",color:o.textMuted},children:"Excluded"})]})]}),x.length>1&&e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("div",{style:{fontSize:"9px",color:o.textMuted,marginBottom:"4px"},children:"By group:"}),x.map((p,f)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px 6px",backgroundColor:o.bgHover,borderRadius:"4px",marginBottom:"3px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("div",{style:{width:"14px",height:"14px",borderRadius:"3px",backgroundColor:p.color,fontSize:"8px",fontWeight:"700",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},children:f+1}),e.jsx("span",{style:{fontSize:"10px",color:o.textSecondary},children:p.name})]}),e.jsx("span",{style:{fontSize:"11px",fontWeight:"600",color:p.color},children:f===0?"847":"523"})]},p.id))]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:o.textMuted,textTransform:"uppercase",marginBottom:"8px"},children:" Test with Account"}),e.jsxs("div",{style:{position:"relative",marginBottom:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Search accounts...",value:s,onChange:p=>d(p.target.value),style:{width:"100%",padding:"8px 10px",paddingRight:"30px",backgroundColor:o.bgHover,border:`1px solid ${o.borderLight}`,borderRadius:"6px",color:o.text,fontSize:"11px"}}),e.jsx("span",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:o.textMuted,fontSize:"12px"},children:""})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:b.map(p=>e.jsxs("div",{onClick:()=>l(c===p.id?null:p.id),style:{padding:"8px 10px",backgroundColor:p.passes?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",border:`1px solid ${p.passes?"rgba(34, 197, 94, 0.2)":"rgba(239, 68, 68, 0.2)"}`,borderRadius:"6px",cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:o.text},children:p.name}),e.jsx("div",{style:{fontSize:"9px",color:o.textMuted},children:p.policies})]}),e.jsx("div",{style:{padding:"3px 8px",backgroundColor:p.passes?"#22c55e":"#ef4444",borderRadius:"4px",fontSize:"9px",fontWeight:"600",color:"#fff"},children:p.passes?" Pass":" Fail"})]}),c===p.id&&e.jsxs("div",{style:{marginTop:"10px",paddingTop:"10px",borderTop:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("div",{style:{fontSize:"9px",fontWeight:"600",color:o.textMuted,marginBottom:"6px"},children:"CONDITION RESULTS"}),p.conditions.map((f,S)=>e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"6px",marginBottom:"4px",padding:"4px 6px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"4px"},children:[e.jsx("span",{style:{fontSize:"10px",color:f.passes?"#22c55e":"#ef4444",flexShrink:0},children:f.passes?"":""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:"10px",color:o.text},children:f.label}),!f.passes&&f.reason&&e.jsx("div",{style:{fontSize:"9px",color:o.danger,marginTop:"2px"},children:f.reason}),f.value&&e.jsxs("div",{style:{fontSize:"9px",color:o.textMuted,marginTop:"2px"},children:["Actual: ",f.value]})]})]},S)),x.length>1&&e.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.05)"},children:[e.jsx("div",{style:{fontSize:"9px",color:o.textMuted,marginBottom:"4px"},children:"GROUP RESULTS"}),e.jsx("div",{style:{display:"flex",gap:"4px"},children:p.groupResults.map((f,S)=>{var j;return e.jsxs("div",{style:{flex:1,padding:"4px",backgroundColor:f.passes?"rgba(34, 197, 94, 0.15)":"rgba(239, 68, 68, 0.15)",borderRadius:"4px",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"9px",fontWeight:"600",color:((j=x[S])==null?void 0:j.color)||"#71717a"},children:["G",S+1]}),e.jsx("div",{style:{fontSize:"10px",color:f.passes?"#22c55e":"#ef4444"},children:f.passes?"":""})]},S)})}),e.jsx("div",{style:{fontSize:"9px",color:o.textMuted,textAlign:"center",marginTop:"4px"},children:n==="OR"?"Needs 1 group to pass":"Needs all groups to pass"})]})]})]},p.id))}),e.jsx("button",{style:{width:"100%",marginTop:"8px",padding:"6px",backgroundColor:"transparent",border:`1px dashed ${o.borderLight}`,borderRadius:"6px",color:o.textMuted,cursor:"pointer",fontSize:"10px"},children:"View all matching records "})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:o.textMuted,textTransform:"uppercase",marginBottom:"8px"},children:"Summary"}),e.jsx("div",{style:{fontSize:"10px",color:o.textSecondary,lineHeight:"1.6"},children:x.map((p,f)=>e.jsxs(oe.Fragment,{children:[e.jsxs("div",{style:{padding:"6px",backgroundColor:`${p.color}10`,borderRadius:"4px",border:`1px solid ${p.color}20`,marginBottom:(f<x.length-1,"0")},children:[e.jsx("div",{style:{fontWeight:"600",color:p.color,marginBottom:"2px",fontSize:"9px"},children:p.name}),e.jsxs("div",{style:{color:o.text,fontSize:"10px"},children:[p.filters.include.map(S=>`${S.label}: ${S.value||""}`).join(" + "),p.filters.exclude.length>0&&e.jsxs("span",{style:{color:o.danger},children:[" "," ",p.filters.exclude.map(S=>`${S.value||S.label}`).join(", ")]})]})]}),f<x.length-1&&e.jsx("div",{style:{textAlign:"center",padding:"3px 0",fontWeight:"700",fontSize:"9px",color:n==="OR"?"#a78bfa":"#22d3ee"},children:n})]},p.id))})]})]})]})},Ot=[{id:"entry-criteria",type:"entry_criteria",title:"Entry Criteria",subtitle:"Define who enters this automation",config:{filterConfig:{}}},{id:"trigger",type:"trigger",title:"Trigger",subtitle:"Daily at 09:00 (Central)",config:{time:"09:00",timezone:"America/Chicago",frequency:"Daily"}},{id:"node-1",type:"send_email",title:"Send Email",subtitle:"Select template...",config:{template:""}}],Ut=({t,automation:o,onUpdate:i,onSave:r})=>{var m,R,q,B,E,W,p,f,S;const n=t||Le,a=o!=null&&o.nodes&&o.nodes.length>0?o.nodes:Ot,[s,d]=k.useState(a),[c,l]=k.useState(null),[b,x]=k.useState(null),[_,v]=k.useState(!1),h={entry_criteria:{icon:"",color:"#8b5cf6",label:"Entry Criteria"},trigger:{icon:"",color:n.primary,label:"Trigger"},send_email:{icon:"",color:n.success,label:"Send Email"},delay:{icon:"",color:n.warning,label:"Delay"},condition:{icon:"",color:n.purple,label:"Condition"},field_condition:{icon:"",color:"#ec4899",label:"Field Check"},update_field:{icon:"",color:"#06b6d4",label:"Update Field"},end:{icon:"",color:n.textMuted,label:"End"}},w=[{type:"send_email",label:"Send Email",desc:"Send an email template",icon:""},{type:"delay",label:"Delay",desc:"Wait before continuing",icon:""},{type:"condition",label:"Email Engagement",desc:"Branch on open/click",icon:""},{type:"field_condition",label:"Field Condition",desc:"Branch on field value",icon:""},{type:"update_field",label:"Update Field",desc:"Update a record field",icon:""},{type:"end",label:"End",desc:"Stop automation",icon:""}],y=(j,$,T=null)=>{var K;const M={id:`node-${Date.now()}`,type:$,title:((K=w.find(G=>G.type===$))==null?void 0:K.label)||$,subtitle:"Configure...",config:{}};if(($==="condition"||$==="field_condition")&&(M.branches={yes:[],no:[]}),T)d(G=>{const A=V=>V.map(O=>O.id===j&&O.branches?{...O,branches:{...O.branches,[T]:[...O.branches[T],M]}}:O.branches?{...O,branches:{yes:A(O.branches.yes),no:A(O.branches.no)}}:O);return A(G)});else{const G=s.findIndex(V=>V.id===j),A=[...s];A.splice(G+1,0,M),d(A)}x(null),l(M.id)},g=j=>{d($=>$.filter(T=>T.id!==j&&T.id!=="trigger"&&T.id!=="entry-criteria")),c===j&&l(null)},z=({node:j})=>{const $=h[j.type]||h.send_email,T=c===j.id,M=j.type==="entry_criteria",K=j.type==="trigger",G=M||K;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs("div",{onClick:()=>{l(j.id),M&&v(!0)},style:{width:"320px",backgroundColor:n.bgCard,border:T?`2px solid ${$.color}`:`1px solid ${n.border}`,borderRadius:"12px",padding:"16px 18px",cursor:"pointer",position:"relative"},children:[!G&&e.jsx("button",{onClick:A=>{A.stopPropagation(),g(j.id)},style:{position:"absolute",top:"8px",right:"8px",background:"none",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"16px"},children:""}),e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${$.color}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:$.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:n.text},children:j.title}),e.jsx("div",{style:{fontSize:"12px",color:n.textMuted,marginTop:"2px"},children:j.subtitle})]})]}),M&&e.jsxs("button",{onClick:A=>{A.stopPropagation(),v(!0)},style:{marginTop:"12px",width:"100%",padding:"10px",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,borderRadius:"8px",color:n.textSecondary,cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx("span",{children:""})," Edit Entry Criteria"]})]}),!j.branches&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[e.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.borderLight}}),e.jsx("button",{onClick:()=>x({afterNodeId:j.id,branch:null}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,color:n.textMuted,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"}),e.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.borderLight}}),(b==null?void 0:b.afterNodeId)===j.id&&!(b!=null&&b.branch)&&e.jsx(I,{onSelect:A=>y(j.id,A),onClose:()=>x(null)})]}),j.branches&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.borderLight}}),e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:n.success}}),e.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#22c55e20",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:n.success},children:"YES"})]}),e.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.success}}),j.branches.yes.map(A=>e.jsx(z,{node:A},A.id)),e.jsx("button",{onClick:()=>x({afterNodeId:j.id,branch:"yes"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:n.bgHover,border:"1px dashed #22c55e",color:n.success,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(b==null?void 0:b.afterNodeId)===j.id&&(b==null?void 0:b.branch)==="yes"&&e.jsx(I,{onSelect:A=>y(j.id,A,"yes"),onClose:()=>x(null)})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#ef444420",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:n.danger},children:"NO"}),e.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:n.danger}})]}),e.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.danger}}),j.branches.no.map(A=>e.jsx(z,{node:A},A.id)),e.jsx("button",{onClick:()=>x({afterNodeId:j.id,branch:"no"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:n.bgHover,border:"1px dashed #ef4444",color:n.danger,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(b==null?void 0:b.afterNodeId)===j.id&&(b==null?void 0:b.branch)==="no"&&e.jsx(I,{onSelect:A=>y(j.id,A,"no"),onClose:()=>x(null)})]})]})]})]})},I=({onSelect:j,onClose:$})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:$}),e.jsx("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"10px",backgroundColor:n.bgCard,border:`1px solid ${n.borderLight}`,borderRadius:"12px",padding:"8px",zIndex:100,width:"240px",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},children:w.map(T=>e.jsxs("button",{onClick:()=>j(T.type),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px",color:n.text,textAlign:"left"},children:[e.jsx("span",{style:{fontSize:"18px"},children:T.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"500"},children:T.label}),e.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:T.desc})]})]},T.type))})]}),C=s.find(j=>j.id===c)||s.flatMap(j=>j.branches?[...j.branches.yes||[],...j.branches.no||[]]:[]).find(j=>j.id===c);return e.jsxs("div",{style:{fontFamily:"'IBM Plex Sans', -apple-system, sans-serif",backgroundColor:n.bg,height:"100%",color:n.text,display:"flex"},children:[e.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[e.jsxs("div",{style:{width:"220px",borderRight:`1px solid ${n.border}`,padding:"16px",backgroundColor:n.bgCard,overflowY:"auto"},children:[e.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:n.textMuted,marginBottom:"12px",textTransform:"uppercase"},children:"Add Nodes"}),w.map(j=>e.jsxs("div",{style:{padding:"12px",backgroundColor:n.bgHover,borderRadius:"8px",marginBottom:"8px",cursor:"grab",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{style:{fontSize:"18px"},children:j.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:n.text},children:j.label}),e.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:j.desc})]})]},j.type))]}),e.jsx("div",{style:{flex:1,padding:"40px",overflowY:"auto",display:"flex",justifyContent:"center"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[s.map(j=>e.jsx(z,{node:j},j.id)),e.jsx("div",{style:{marginTop:"16px",padding:"8px 18px",backgroundColor:n.bgHover,borderRadius:"20px",fontSize:"12px",color:n.textMuted},children:"End of automation"})]})}),e.jsxs("div",{style:{width:"300px",borderLeft:`1px solid ${n.border}`,backgroundColor:n.bgCard,overflowY:"auto"},children:[e.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${n.border}`,fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase"},children:"Configuration"}),e.jsx("div",{style:{padding:"18px"},children:C?e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${((m=h[C.type])==null?void 0:m.color)||n.primary}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:((R=h[C.type])==null?void 0:R.icon)||""}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"600",color:n.text,fontSize:"15px"},children:C.title}),e.jsx("div",{style:{fontSize:"12px",color:n.textMuted},children:((q=h[C.type])==null?void 0:q.label)||"Node"})]})]}),C.type==="entry_criteria"&&e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"13px",color:n.textSecondary,marginBottom:"16px"},children:"Define which contacts enter this automation based on their attributes and behavior."}),e.jsx("button",{onClick:()=>v(!0),style:{width:"100%",padding:"12px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Edit Entry Criteria"})]}),C.type==="trigger"&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Run Time"}),e.jsx("input",{type:"time",defaultValue:((B=C.config)==null?void 0:B.time)||"09:00",style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px",marginBottom:"16px"}}),e.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Frequency"}),e.jsxs("select",{defaultValue:((E=C.config)==null?void 0:E.frequency)||"Daily",style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[e.jsx("option",{children:"Daily"}),e.jsx("option",{children:"Weekly"}),e.jsx("option",{children:"Monthly"})]})]}),C.type==="send_email"&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Email Template"}),e.jsxs("select",{defaultValue:((W=C.config)==null?void 0:W.template)||"",style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[e.jsx("option",{value:"",children:"Select template..."}),e.jsx("option",{children:"Welcome Email"}),e.jsx("option",{children:"Cross-Sell Introduction"}),e.jsx("option",{children:"Renewal Reminder"}),e.jsx("option",{children:"Follow-Up"}),e.jsx("option",{children:"Re-engagement"})]})]}),C.type==="delay"&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Wait Duration"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("input",{type:"number",defaultValue:((p=C.config)==null?void 0:p.duration)||1,min:"1",style:{flex:1,padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"}}),e.jsxs("select",{defaultValue:((f=C.config)==null?void 0:f.unit)||"days",style:{flex:1,padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[e.jsx("option",{value:"hours",children:"Hours"}),e.jsx("option",{value:"days",children:"Days"}),e.jsx("option",{value:"weeks",children:"Weeks"})]})]})]}),(C.type==="condition"||C.type==="field_condition")&&e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Condition Type"}),e.jsxs("select",{defaultValue:((S=C.config)==null?void 0:S.type)||"email_opened",style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[e.jsx("option",{value:"email_opened",children:"Email Opened"}),e.jsx("option",{value:"email_clicked",children:"Email Clicked"}),e.jsx("option",{value:"field_value",children:"Field Value"})]})]}),C.type==="end"&&e.jsx("p",{style:{fontSize:"13px",color:n.textSecondary},children:"This node ends the automation flow. Contacts reaching this point will exit the automation."})]}):e.jsxs("div",{style:{textAlign:"center",color:n.textMuted,padding:"30px 0"},children:[e.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:""}),e.jsx("div",{style:{fontSize:"13px"},children:"Select a node to configure"})]})})]})]}),_&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",zIndex:200},onClick:()=>v(!1)}),e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"1000px",height:"80vh",backgroundColor:n.bgCard,borderRadius:"16px",border:`1px solid ${n.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${n.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[e.jsx("h2",{style:{fontSize:"15px",fontWeight:"600",color:n.text,margin:0},children:"Audience Criteria"}),e.jsx("button",{onClick:()=>v(!1),style:{background:"none",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"18px"},children:""})]}),e.jsx("div",{style:{flex:1,padding:"20px",overflow:"hidden"},children:e.jsx(Nt,{onClose:()=>v(!1),t:n})}),e.jsxs("div",{style:{padding:"12px 20px",borderTop:`1px solid ${n.border}`,display:"flex",justifyContent:"flex-end",gap:"8px",flexShrink:0},children:[e.jsx("button",{onClick:()=>v(!1),style:{padding:"8px 16px",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,borderRadius:"6px",color:n.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Cancel"}),e.jsx("button",{onClick:()=>v(!1),style:{padding:"8px 16px",backgroundColor:n.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px",fontWeight:"500"},children:"Save Criteria"})]})]})]})]})},ke=({t})=>{var z,I;const{userId:o,automationId:i}=P(),r=ie(),n=Re(),a=!i||i==="new";(z=n.state)!=null&&z.templateName||((I=n.state)==null||I.templateId);const{data:s,isLoading:d,error:c}=ot(a?null:i),{createAutomation:l,updateAutomation:b,activateAutomation:x,pauseAutomation:_}=Te(),v=async()=>{if(a)return;const C=h.status==="active",m=C?"paused":"active";try{C?await _.mutateAsync(i):await x.mutateAsync(i),w(R=>({...R,status:m}))}catch(R){console.error("Failed to toggle status:",R)}},[h,w]=k.useState({name:"",description:"",category:"general",status:"draft",send_time:"10:00",timezone:"America/Chicago",frequency:"Daily",filter_config:{},nodes:[]});k.useEffect(()=>{s&&w({name:s.name||"",description:s.description||"",category:s.category||"general",status:s.status||"draft",send_time:s.send_time||"10:00",timezone:s.timezone||"America/Chicago",frequency:s.frequency||"Daily",filter_config:s.filter_config||{},nodes:s.nodes||[]})},[s]);const y=async C=>{try{if(a){const m=await l.mutateAsync(C);r(`/${o}/automations/${m.id}`,{replace:!0})}else await b.mutateAsync({automationId:i,updates:C})}catch(m){console.error("Failed to save automation:",m),alert("Failed to save automation. Please try again.")}},g=()=>{r(`/${o}/automations`)};return!a&&d?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[e.jsx("div",{style:{fontSize:"32px"},children:""}),e.jsx("div",{style:{color:(t==null?void 0:t.textSecondary)||"#a1a1aa"},children:"Loading automation..."})]}):c?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[e.jsx("div",{style:{fontSize:"48px"},children:""}),e.jsx("h2",{style:{color:(t==null?void 0:t.text)||"#fafafa",margin:0},children:"Automation Not Found"}),e.jsx("p",{style:{color:(t==null?void 0:t.textSecondary)||"#a1a1aa"},children:"We couldn't find the automation you're looking for."}),e.jsx("button",{onClick:g,style:{padding:"10px 20px",backgroundColor:(t==null?void 0:t.primary)||"#3b82f6",border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Automations"})]}):e.jsxs("div",{style:{margin:"-24px",height:"calc(100vh - 49px)",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${(t==null?void 0:t.border)||"#27272a"}`,display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:(t==null?void 0:t.bgCard)||"#18181b",flexShrink:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("button",{onClick:g,style:{background:"none",border:"none",color:(t==null?void 0:t.textSecondary)||"#a1a1aa",cursor:"pointer",fontSize:"20px",padding:"4px 8px",display:"flex",alignItems:"center"},children:""}),e.jsx("h1",{style:{fontSize:"16px",fontWeight:"600",color:(t==null?void 0:t.text)||"#fafafa",margin:0},children:a?"Create Automation":`Edit: ${(s==null?void 0:s.name)||"Automation"}`})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[!a&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"13px",color:(t==null?void 0:t.textSecondary)||"#a1a1aa"},children:h.status==="active"?"Active":"Inactive"}),e.jsx("button",{onClick:v,disabled:x.isPending||_.isPending,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:h.status==="active"?(t==null?void 0:t.success)||"#22c55e":(t==null?void 0:t.bgHover)||"#27272a",cursor:"pointer",position:"relative",transition:"background-color 0.2s",opacity:x.isPending||_.isPending?.6:1},children:e.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:h.status==="active"?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})})]}),e.jsx("button",{onClick:()=>y(h),disabled:l.isPending||b.isPending,style:{padding:"8px 16px",backgroundColor:(t==null?void 0:t.primary)||"#3b82f6",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",opacity:l.isPending||b.isPending?.7:1},children:l.isPending||b.isPending?"Saving...":a?"Create":"Save Changes"})]})]}),e.jsx("div",{style:{flex:1,overflow:"hidden"},children:e.jsx(Ut,{t,automation:h,onUpdate:w,onSave:y})})]})},pe=({width:t="100%",height:o="20px"})=>e.jsx("div",{style:{width:t,height:o,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Gt=({status:t,theme:o})=>{const i={Draft:{bg:o.textMuted,text:"#fff"},Scheduled:{bg:o.warning,text:"#fff"},Sending:{bg:o.primary,text:"#fff"},Completed:{bg:o.success,text:"#fff"},Cancelled:{bg:o.danger,text:"#fff"}},r=i[t]||i.Draft;return e.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${r.bg}20`,color:r.bg,borderRadius:"20px",fontSize:"11px",fontWeight:"500"},children:t})},Kt=({template:t,onSave:o,onClose:i,theme:r})=>{const[n,a]=k.useState((t==null?void 0:t.name)||""),[s,d]=k.useState((t==null?void 0:t.subject)||""),[c,l]=k.useState((t==null?void 0:t.body_html)||(t==null?void 0:t.body_text)||""),[b,x]=k.useState((t==null?void 0:t.category)||"general"),[_,v]=k.useState(!1),h=async()=>{v(!0);try{const g=await o({name:n,subject:s,body_html:c,body_text:c.replace(/<[^>]*>/g,""),category:b});i(g)}catch(g){console.error("Failed to save template:",g)}finally{v(!1)}},w=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],y=g=>{l(c+g)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:200},onClick:()=>i(null)}),e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxWidth:"95vw",maxHeight:"90vh",backgroundColor:r.bgCard,borderRadius:"16px",border:`1px solid ${r.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${r.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:r.text,margin:0},children:t?"Edit Template":"Create New Template"}),e.jsx("button",{onClick:()=>i(null),style:{background:"none",border:"none",color:r.textMuted,cursor:"pointer",fontSize:"20px"},children:""})]}),e.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:r.text,display:"block",marginBottom:"6px"},children:"Template Name"}),e.jsx("input",{type:"text",value:n,onChange:g=>a(g.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:r.bgInput,border:`1px solid ${r.border}`,borderRadius:"8px",color:r.text,fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:r.text,display:"block",marginBottom:"6px"},children:"Category"}),e.jsxs("select",{value:b,onChange:g=>x(g.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:r.bgInput,border:`1px solid ${r.border}`,borderRadius:"8px",color:r.text,fontSize:"14px"},children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"welcome",children:"Welcome"}),e.jsx("option",{value:"renewal",children:"Renewal"}),e.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),e.jsx("option",{value:"engagement",children:"Engagement"}),e.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:r.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),e.jsx("input",{type:"text",value:s,onChange:g=>d(g.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:r.bgInput,border:`1px solid ${r.border}`,borderRadius:"8px",color:r.text,fontSize:"14px"}})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:r.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:w.map(g=>e.jsx("button",{onClick:()=>y(g.key),style:{padding:"4px 10px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.textSecondary,cursor:"pointer",fontSize:"11px"},children:g.label},g.key))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:r.text,display:"block",marginBottom:"6px"},children:"Email Body"}),e.jsx("textarea",{value:c,onChange:g=>l(g.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:10,style:{width:"100%",padding:"12px",backgroundColor:r.bgInput,border:`1px solid ${r.border}`,borderRadius:"8px",color:r.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),e.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${r.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[e.jsx("button",{onClick:()=>i(null),style:{padding:"10px 20px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"8px",color:r.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),e.jsx("button",{onClick:h,disabled:_||!n||!s,style:{padding:"10px 20px",backgroundColor:r.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:_?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:_||!n||!s?.6:1},children:_?"Creating...":"Create & Select"})]})]})]})},Vt=({batch:t,onView:o,theme:i})=>{var n;const r=t.total_recipients>0?Math.round(t.emails_sent/t.total_recipients*100):0;return e.jsxs("div",{style:{padding:"16px",backgroundColor:i.bgCard,borderRadius:"10px",border:`1px solid ${i.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"6px"},children:[e.jsx("span",{style:{fontWeight:"600",color:i.text},children:t.name||"Untitled Batch"}),e.jsx(Gt,{status:t.status,theme:i})]}),e.jsx("p",{style:{fontSize:"13px",color:i.textSecondary,margin:0},children:t.subject||"No subject"}),e.jsxs("p",{style:{fontSize:"12px",color:i.textMuted,margin:"4px 0 0"},children:[((n=t.template)==null?void 0:n.name)||"Custom email","  ",t.total_recipients||0," recipients"]})]}),t.status!=="Draft"&&e.jsxs("div",{style:{textAlign:"right",minWidth:"100px"},children:[e.jsxs("div",{style:{fontSize:"18px",fontWeight:"600",color:i.text},children:[r,"%"]}),e.jsxs("div",{style:{fontSize:"11px",color:i.textMuted},children:[t.emails_sent||0," / ",t.total_recipients||0," sent"]})]}),e.jsx("button",{onClick:()=>o(t),style:{padding:"8px 16px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.text,cursor:"pointer",fontSize:"13px"},children:"View"})]})},Qt=({currentStep:t,steps:o,theme:i})=>e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"24px"},children:o.map((r,n)=>e.jsxs(oe.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:n<=t?i.primary:i.bgHover,color:n<=t?"#fff":i.textMuted,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"13px",fontWeight:"600"},children:n<t?"":n+1}),e.jsx("span",{style:{fontSize:"14px",fontWeight:n===t?"600":"400",color:n<=t?i.text:i.textMuted},children:r})]}),n<o.length-1&&e.jsx("div",{style:{flex:1,height:"2px",backgroundColor:n<t?i.primary:i.border,minWidth:"40px"}})]},r))}),Yt=({selectedTemplate:t,onSelect:o,onCreateNew:i,templates:r,isLoading:n,theme:a})=>{const[s,d]=k.useState(""),c=k.useMemo(()=>r?s?r.filter(l=>l.name.toLowerCase().includes(s.toLowerCase())||l.subject.toLowerCase().includes(s.toLowerCase())):r:[],[r,s]);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:a.text,margin:0},children:"Select an Email Template"}),e.jsxs("button",{onClick:i,style:{padding:"8px 16px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{children:"+"})," Create New Template"]})]}),e.jsxs("div",{style:{position:"relative",marginBottom:"16px"},children:[e.jsx("input",{type:"text",placeholder:"Search templates...",value:s,onChange:l=>d(l.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"}}),e.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:a.textMuted},children:""})]}),n?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"},children:Array.from({length:4}).map((l,b)=>e.jsxs("div",{style:{padding:"16px",backgroundColor:a.bgCard,borderRadius:"10px",border:`1px solid ${a.border}`},children:[e.jsx(pe,{width:"120px",height:"16px"}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(pe,{width:"200px",height:"14px"})})]},b))}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px",maxHeight:"400px",overflow:"auto"},children:c.map(l=>e.jsxs("div",{onClick:()=>o(l),style:{padding:"16px",backgroundColor:a.bgCard,borderRadius:"10px",border:`2px solid ${(t==null?void 0:t.id)===l.id?a.primary:a.border}`,cursor:"pointer",transition:"border-color 0.15s"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:a.text,marginBottom:"4px"},children:l.name}),e.jsx("div",{style:{fontSize:"13px",color:a.textSecondary},children:l.subject}),e.jsx("div",{style:{marginTop:"8px",padding:"4px 8px",backgroundColor:`${a.primary}15`,color:a.primary,borderRadius:"4px",fontSize:"11px",display:"inline-block",textTransform:"capitalize"},children:l.category||"General"})]},l.id))}),!n&&c.length===0&&e.jsx("div",{style:{textAlign:"center",padding:"40px",color:a.textMuted},children:s?"No templates match your search":"No templates available. Create one to get started!"})]})},ze=[{value:"account_status",label:"Account Status",type:"select",options:[{value:"customer",label:"Customer"},{value:"prospect",label:"Prospect"},{value:"prior_customer",label:"Prior Customer"},{value:"lead",label:"Lead"}]},{value:"policy_type",label:"Policy Type",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"policy_count",label:"Number of Policies",type:"number"},{value:"policy_expiration",label:"Policy Expiration",type:"date"},{value:"location",label:"Location",type:"location"},{value:"state",label:"State",type:"select",options:[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}]},{value:"city",label:"City",type:"text"}],Jt={select:[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"is_any",label:"is any of"}],number:[{value:"equals",label:"equals"},{value:"greater_than",label:"greater than"},{value:"less_than",label:"less than"},{value:"at_least",label:"at least"}],date:[{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"between",label:"is between"},{value:"in_next_days",label:"is in the next"}],location:[{value:"within_radius",label:"is within"}],text:[{value:"contains",label:"contains"},{value:"equals",label:"equals"},{value:"starts_with",label:"starts with"}]},Xt=[5,10,15,25,50,100],Zt=({location:t,radius:o,theme:i})=>{if(!t)return null;const r=1/69,n=1/(69*Math.cos(parseFloat(t.lat)*Math.PI/180)),a=1.3,s=o*r*a,d=o*n*a,c=`https://www.openstreetmap.org/export/embed.html?bbox=${encodeURIComponent(`${parseFloat(t.lng)-d},${parseFloat(t.lat)-s},${parseFloat(t.lng)+d},${parseFloat(t.lat)+s}`)}&layer=mapnik&marker=${t.lat},${t.lng}`,l=1/a*100;return e.jsxs("div",{style:{marginTop:"12px",borderRadius:"8px",overflow:"hidden",border:`1px solid ${i.border}`},children:[e.jsxs("div",{style:{padding:"8px 12px",backgroundColor:i.bgHover,fontSize:"12px",color:i.textSecondary,display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{children:""}),e.jsxs("span",{children:[t.display," - ",o," mile radius"]})]}),e.jsxs("div",{style:{position:"relative",width:"100%",height:"200px"},children:[e.jsx("iframe",{title:"Location Preview",src:c,style:{width:"100%",height:"100%",border:"none"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:`${l}%`,height:`${l}%`,borderRadius:"50%",border:`3px solid ${i.primary}`,backgroundColor:`${i.primary}20`,pointerEvents:"none",boxSizing:"border-box"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"12px",height:"12px",borderRadius:"50%",backgroundColor:i.primary,border:"2px solid #fff",boxShadow:"0 2px 4px rgba(0,0,0,0.3)",pointerEvents:"none"}})]})]})},eo=({rule:t,index:o,onUpdate:i,onRemove:r,theme:n})=>{const a=ze.find(l=>l.value===t.field),s=a?Jt[a.type]:[],d={padding:"8px 12px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"6px",color:n.text,fontSize:"13px",minWidth:"140px"},c={padding:"8px 12px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"6px",color:n.text,fontSize:"13px",width:"120px"};return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:n.bgCard,borderRadius:"8px",border:`1px solid ${n.border}`,flexWrap:"wrap"},children:[o>0&&e.jsx("span",{style:{fontSize:"12px",color:n.primary,fontWeight:"600",padding:"4px 8px",backgroundColor:`${n.primary}15`,borderRadius:"4px"},children:"AND"}),e.jsxs("select",{value:t.field||"",onChange:l=>i(o,{...t,field:l.target.value,operator:"",value:""}),style:d,children:[e.jsx("option",{value:"",children:"Select field..."}),ze.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]}),t.field&&e.jsxs("select",{value:t.operator||"",onChange:l=>i(o,{...t,operator:l.target.value}),style:d,children:[e.jsx("option",{value:"",children:"Select condition..."}),s.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]}),t.field&&t.operator&&e.jsxs(e.Fragment,{children:[(a==null?void 0:a.type)==="select"&&t.operator!=="is_any"&&e.jsxs("select",{value:t.value||"",onChange:l=>i(o,{...t,value:l.target.value}),style:d,children:[e.jsx("option",{value:"",children:"Select value..."}),a.options.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]}),(a==null?void 0:a.type)==="select"&&t.operator==="is_any"&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:a.options.map(l=>e.jsx("button",{onClick:()=>{const b=t.value?t.value.split(","):[],x=b.includes(l.value)?b.filter(_=>_!==l.value):[...b,l.value];i(o,{...t,value:x.join(",")})},style:{padding:"4px 10px",backgroundColor:(t.value||"").split(",").includes(l.value)?n.primary:n.bgHover,color:(t.value||"").split(",").includes(l.value)?"#fff":n.text,border:`1px solid ${(t.value||"").split(",").includes(l.value)?n.primary:n.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:l.label},l.value))}),(a==null?void 0:a.type)==="number"&&e.jsx("input",{type:"number",value:t.value||"",onChange:l=>i(o,{...t,value:l.target.value}),placeholder:"0",style:c}),(a==null?void 0:a.type)==="date"&&t.operator==="in_next_days"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:t.value||"",onChange:l=>i(o,{...t,value:l.target.value}),placeholder:"30",style:{...c,width:"70px"}}),e.jsx("span",{style:{fontSize:"13px",color:n.textSecondary},children:"days"})]}),(a==null?void 0:a.type)==="date"&&t.operator==="between"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"date",value:t.value||"",onChange:l=>i(o,{...t,value:l.target.value}),style:c}),e.jsx("span",{style:{fontSize:"13px",color:n.textSecondary},children:"and"}),e.jsx("input",{type:"date",value:t.value2||"",onChange:l=>i(o,{...t,value2:l.target.value}),style:c})]}),(a==null?void 0:a.type)==="date"&&(t.operator==="before"||t.operator==="after")&&e.jsx("input",{type:"date",value:t.value||"",onChange:l=>i(o,{...t,value:l.target.value}),style:c}),(a==null?void 0:a.type)==="text"&&e.jsx("input",{type:"text",value:t.value||"",onChange:l=>i(o,{...t,value:l.target.value}),placeholder:`Enter ${a.label.toLowerCase()}...`,style:{...c,width:"160px"}}),(a==null?void 0:a.type)==="location"&&e.jsx(to,{rule:t,onUpdate:l=>i(o,{...t,...l}),theme:n})]}),e.jsx("button",{onClick:()=>r(o),style:{marginLeft:"auto",padding:"6px 10px",backgroundColor:"transparent",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"16px",borderRadius:"4px"},title:"Remove filter",children:""})]})},to=({rule:t,onUpdate:o,theme:i})=>{const[r,n]=k.useState(t.locationDisplay||""),[a,s]=k.useState(!1),[d,c]=k.useState([]),[l,b]=k.useState(!1),x={padding:"8px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.text,fontSize:"13px"},_=async h=>{if(h.length<3){c([]);return}s(!0);try{const y=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&q=${encodeURIComponent(h)}&limit=5`,{headers:{"Accept-Language":"en"}})).json();c(y.map(g=>({display:g.display_name,lat:g.lat,lng:g.lon,type:g.type}))),b(!0)}catch(w){console.error("Geocoding error:",w),c([])}finally{s(!1)}};oe.useEffect(()=>{const h=setTimeout(()=>{r&&r!==t.locationDisplay&&_(r)},300);return()=>clearTimeout(h)},[r]);const v=h=>{n(h.display.split(",").slice(0,2).join(",")),o({value:`${h.lat},${h.lng}`,locationDisplay:h.display.split(",").slice(0,2).join(","),locationData:h}),b(!1)};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",flex:1,minWidth:"300px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:"200px"},children:[e.jsx("input",{type:"text",value:r,onChange:h=>n(h.target.value),onFocus:()=>d.length>0&&b(!0),placeholder:"Enter zip code, city, or address...",style:{...x,width:"100%",paddingRight:"30px"}}),a&&e.jsx("span",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:i.textMuted,fontSize:"12px"},children:"..."}),l&&d.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:i.bgCard,border:`1px solid ${i.border}`,borderRadius:"6px",marginTop:"4px",zIndex:100,maxHeight:"200px",overflow:"auto",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:d.map((h,w)=>e.jsxs("button",{onClick:()=>v(h),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderBottom:w<d.length-1?`1px solid ${i.border}`:"none",color:i.text,fontSize:"12px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"flex-start",gap:"8px"},onMouseEnter:y=>y.target.style.backgroundColor=i.bgHover,onMouseLeave:y=>y.target.style.backgroundColor="transparent",children:[e.jsx("span",{children:""}),e.jsx("span",{style:{lineHeight:"1.4"},children:h.display})]},w))})]}),e.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"of"}),e.jsx("select",{value:t.radius||"25",onChange:h=>o({radius:h.target.value}),style:{...x,minWidth:"100px"},children:Xt.map(h=>e.jsxs("option",{value:h,children:[h," miles"]},h))})]}),t.locationData&&e.jsx(Zt,{location:t.locationData,radius:parseInt(t.radius||"25",10),theme:i})]})},oo=({filterConfig:t,setFilterConfig:o,recipientCount:i,isLoading:r,theme:n})=>{const a=t.rules||[],s=()=>{o({...t,rules:[...a,{field:"",operator:"",value:""}]})},d=(x,_)=>{const v=[...a];v[x]=_,o({...t,rules:v})},c=x=>{const _=a.filter((v,h)=>h!==x);o({...t,rules:_})},l=()=>{o({...t,rules:[],search:""})},b=a.filter(x=>x.field&&x.operator&&x.value).length;return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Filter Recipients"}),(a.length>0||t.search)&&e.jsx("button",{onClick:l,style:{padding:"6px 12px",backgroundColor:"transparent",border:`1px solid ${n.border}`,borderRadius:"6px",color:n.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Clear all"})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgHover,borderRadius:"12px",marginBottom:"16px"},children:[a.length===0?e.jsx("div",{style:{textAlign:"center",padding:"20px",color:n.textMuted,fontSize:"14px"},children:"No filters applied. All accounts with valid emails will be included."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:a.map((x,_)=>e.jsx(eo,{rule:x,index:_,onUpdate:d,onRemove:c,theme:n},_))}),e.jsxs("button",{onClick:s,style:{width:"100%",padding:"10px",backgroundColor:n.bgCard,border:`1px dashed ${n.border}`,borderRadius:"8px",color:n.primary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[e.jsx("span",{children:"+"})," Add Filter"]})]}),b>0&&e.jsxs("div",{style:{padding:"12px 16px",backgroundColor:`${n.primary}10`,borderRadius:"8px",marginBottom:"16px",fontSize:"13px",color:n.text},children:[e.jsx("strong",{children:b})," filter",b!==1?"s":""," applied",e.jsx("span",{style:{color:n.textSecondary},children:"  results update automatically"})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:n.text,display:"block",marginBottom:"8px"},children:"Search by Name or Email"}),e.jsx("input",{type:"text",placeholder:"Type to search...",value:t.search||"",onChange:x=>o({...t,search:x.target.value}),style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"}})]}),e.jsxs("div",{style:{padding:"20px",backgroundColor:`${n.primary}10`,borderRadius:"12px",border:`1px solid ${n.primary}30`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:n.text},children:"Matching Recipients"}),e.jsx("div",{style:{fontSize:"12px",color:n.textSecondary},children:"Accounts with valid emails who haven't opted out"})]}),e.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:n.primary},children:r?"...":(i||0).toLocaleString()})]})]})},io=({template:t,filterConfig:o,subject:i,setSubject:r,name:n,setName:a,recipients:s,isLoadingRecipients:d,theme:c})=>e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:c.text,marginBottom:"16px"},children:"Review & Send"}),e.jsxs("div",{style:{padding:"20px",backgroundColor:c.bgCard,borderRadius:"12px",border:`1px solid ${c.border}`,marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:c.text,display:"block",marginBottom:"6px"},children:"Campaign Name"}),e.jsx("input",{type:"text",placeholder:"e.g., December Newsletter",value:n,onChange:l=>a(l.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:c.bgInput,border:`1px solid ${c.border}`,borderRadius:"8px",color:c.text,fontSize:"14px"}})]}),e.jsxs("div",{style:{padding:"20px",backgroundColor:c.bgCard,borderRadius:"12px",border:`1px solid ${c.border}`,marginBottom:"16px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:c.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),e.jsx("input",{type:"text",placeholder:"Email subject...",value:i,onChange:l=>r(l.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:c.bgInput,border:`1px solid ${c.border}`,borderRadius:"8px",color:c.text,fontSize:"14px"}}),e.jsxs("p",{style:{fontSize:"12px",color:c.textMuted,marginTop:"6px"},children:["Use merge fields like ","{{first_name}}"," for personalization"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[e.jsxs("div",{style:{padding:"16px",backgroundColor:c.bgCard,borderRadius:"12px",border:`1px solid ${c.border}`},children:[e.jsx("div",{style:{fontSize:"12px",color:c.textMuted,marginBottom:"4px"},children:"Template"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:c.text},children:t==null?void 0:t.name})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:c.bgCard,borderRadius:"12px",border:`1px solid ${c.border}`},children:[e.jsx("div",{style:{fontSize:"12px",color:c.textMuted,marginBottom:"4px"},children:"Recipients"}),e.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:c.text},children:[d?"...":((s==null?void 0:s.length)||0).toLocaleString()," accounts"]})]})]}),s&&s.length>0&&e.jsxs("div",{style:{padding:"16px",backgroundColor:c.bgCard,borderRadius:"12px",border:`1px solid ${c.border}`},children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:c.text,marginBottom:"12px"},children:"Preview Recipients (first 10)"}),e.jsx("div",{style:{maxHeight:"200px",overflow:"auto"},children:s.slice(0,10).map((l,b)=>e.jsxs("div",{style:{padding:"8px 0",borderBottom:b<Math.min(9,s.length-1)?`1px solid ${c.border}`:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"13px",color:c.text},children:l.primary_contact_first_name?`${l.primary_contact_first_name} ${l.primary_contact_last_name||""}`:l.name}),e.jsx("div",{style:{fontSize:"12px",color:c.textMuted},children:l.person_email||l.email})]}),e.jsx("span",{style:{padding:"2px 8px",backgroundColor:c.bgHover,color:c.textSecondary,borderRadius:"4px",fontSize:"11px",textTransform:"capitalize"},children:l.account_status})]},l.account_unique_id))}),s.length>10&&e.jsxs("div",{style:{fontSize:"12px",color:c.textMuted,marginTop:"8px",textAlign:"center"},children:["+",s.length-10," more recipients"]})]})]}),no=({t})=>{const{userId:o}=P(),[i,r]=k.useState(!1),[n,a]=k.useState(!1),[s,d]=k.useState(0),[c,l]=k.useState(null),[b,x]=k.useState({rules:[],search:"",notOptedOut:!0}),[_,v]=k.useState(""),[h,w]=k.useState(""),[y,g]=k.useState(!1),[z,I]=k.useState(null),[C,m]=k.useState(null),{data:R,isLoading:q,refetch:B}=Ie(),{data:E,isLoading:W,refetch:p}=bt(),{data:f,isLoading:S}=jt(s>=1?b:null),{data:j,isLoading:$}=vt(s===2?b:null,{limit:100}),{createBatch:T,scheduleBatch:M}=_t(),{createTemplate:K}=Ae(),G=["Select Template","Filter Recipients","Review & Send"],A=L=>{l(L),v(L.subject||"")},V=async L=>{const ne=await K.mutateAsync(L);return await B(),ne},O=L=>{a(!1),L&&(l(L),v(L.subject||""))},He=()=>{s<2&&d(s+1)},Ne=()=>{s>0&&d(s-1)},Oe=async()=>{if(!(!c||!_)){g(!0),I(null);try{const L=await T.mutateAsync({name:h||`Mass Email - ${new Date().toLocaleDateString()}`,subject:_,template_id:c.id,filter_config:b,total_recipients:f||0});await M.mutateAsync({batchId:L.id}),m(`Successfully scheduled ${f} emails for sending!`),r(!1),_e(),p()}catch(L){I(L.message||"Failed to send mass email")}finally{g(!1)}}},_e=()=>{d(0),l(null),x({rules:[],search:"",notOptedOut:!0}),v(""),w("")},Q=()=>s===0?!!c:s===1?(f||0)>0:s===2?!!_&&!!h:!1;return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:t.text,marginBottom:"4px"},children:"Mass Email"}),e.jsx("p",{style:{color:t.textSecondary,fontSize:"14px",margin:0},children:"Send one-off emails to filtered recipients"})]}),!i&&e.jsxs("button",{onClick:()=>r(!0),style:{padding:"10px 20px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{children:"+"})," New Campaign"]})]}),C&&e.jsxs("div",{style:{padding:"16px",backgroundColor:`${t.success}15`,border:`1px solid ${t.success}30`,borderRadius:"8px",marginBottom:"24px",color:t.success,fontSize:"14px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[C,e.jsx("button",{onClick:()=>m(null),style:{background:"none",border:"none",color:t.success,cursor:"pointer"},children:""})]}),i?e.jsxs("div",{style:{backgroundColor:t.bgCard,borderRadius:"16px",border:`1px solid ${t.border}`,padding:"24px"},children:[e.jsx(Qt,{currentStep:s,steps:G,theme:t}),z&&e.jsx("div",{style:{padding:"12px 16px",backgroundColor:`${t.danger}15`,border:`1px solid ${t.danger}30`,borderRadius:"8px",marginBottom:"16px",color:t.danger,fontSize:"14px"},children:z}),e.jsxs("div",{style:{minHeight:"300px"},children:[s===0&&e.jsx(Yt,{selectedTemplate:c,onSelect:A,onCreateNew:()=>a(!0),templates:R,isLoading:q,theme:t}),s===1&&e.jsx(oo,{filterConfig:b,setFilterConfig:x,recipientCount:f,isLoading:S,theme:t}),s===2&&e.jsx(io,{template:c,filterConfig:b,subject:_,setSubject:v,name:h,setName:w,recipients:j,isLoadingRecipients:$,theme:t})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"24px",borderTop:`1px solid ${t.border}`,marginTop:"24px"},children:[e.jsx("button",{onClick:()=>{s===0?(r(!1),_e()):Ne()},style:{padding:"10px 20px",backgroundColor:t.bgHover,border:`1px solid ${t.border}`,borderRadius:"8px",color:t.text,cursor:"pointer",fontSize:"14px"},children:s===0?"Cancel":"Back"}),s<2?e.jsx("button",{onClick:He,disabled:!Q(),style:{padding:"10px 24px",backgroundColor:Q()?t.primary:t.bgHover,border:"none",borderRadius:"8px",color:Q()?"#fff":t.textMuted,cursor:Q()?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500"},children:"Continue"}):e.jsx("button",{onClick:Oe,disabled:!Q()||y,style:{padding:"10px 24px",backgroundColor:Q()&&!y?t.success:t.bgHover,border:"none",borderRadius:"8px",color:Q()&&!y?"#fff":t.textMuted,cursor:Q()&&!y?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px"},children:y?"Sending...":"Send Emails"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:t.text,marginBottom:"16px"},children:"Recent Campaigns"}),W?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:Array.from({length:3}).map((L,ne)=>e.jsxs("div",{style:{padding:"16px",backgroundColor:t.bgCard,borderRadius:"10px",border:`1px solid ${t.border}`},children:[e.jsx(pe,{width:"200px",height:"18px"}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(pe,{width:"300px",height:"14px"})})]},ne))}):E&&E.length>0?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:E.map(L=>e.jsx(Vt,{batch:L,onView:ne=>console.log("View batch:",ne),theme:t},L.id))}):e.jsxs("div",{style:{padding:"60px 20px",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:t.text,marginBottom:"8px"},children:"No campaigns yet"}),e.jsx("p",{style:{fontSize:"14px",color:t.textSecondary,marginBottom:"24px"},children:"Create your first mass email campaign to reach your clients."}),e.jsx("button",{onClick:()=>r(!0),style:{padding:"10px 20px",backgroundColor:t.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Campaign"})]})]})}),n&&e.jsx(Kt,{template:null,onSave:V,onClose:O,theme:t})]})},ro=k.createContext(),fe={light:{bg:"#f8fafc",bgCard:"#ffffff",bgSidebar:"#ffffff",bgHover:"#f1f5f9",bgInput:"#ffffff",border:"#e2e8f0",borderLight:"#f1f5f9",text:"#1e293b",textSecondary:"#64748b",textMuted:"#94a3b8",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},dark:{bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"}},ao=k.createContext(),so=()=>{const{userId:t}=P(),o=Re();ie();const[i,r]=k.useState(!1),[n,a]=k.useState({id:t,name:"Logan Johns",email:"info@isgdfw.com",org:"ISG"}),s=i?fe.dark:fe.light,c=(()=>{const b=o.pathname.split("/").slice(2).join("/");return b.startsWith("automations/")?"automations":b.startsWith("accounts/")?"accounts":b||"dashboard"})(),l=[{id:"dashboard",label:"Dashboard",icon:"",path:`/${t}/dashboard`},{id:"automations",label:"Automations",icon:"",path:`/${t}/automations`},{id:"templates",label:"Templates",icon:"",path:`/${t}/templates`},{id:"mass-email",label:"Mass Email",icon:"",path:`/${t}/mass-email`},{id:"accounts",label:"Accounts",icon:"",path:`/${t}/accounts`},{id:"settings",label:"Settings",icon:"",path:`/${t}/settings`}];return e.jsx(ro.Provider,{value:{isDark:i,setIsDark:r,t:s,themes:fe},children:e.jsx(ao.Provider,{value:{userId:t,currentUser:n,setCurrentUser:a},children:e.jsxs("div",{style:{fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",backgroundColor:s.bg,minHeight:"100vh",display:"flex",color:s.text},children:[e.jsxs("div",{style:{width:"220px",backgroundColor:s.bgSidebar,borderRight:`1px solid ${s.border}`,display:"flex",flexDirection:"column",position:"fixed",top:0,left:0,bottom:0},children:[e.jsx("div",{style:{padding:"20px 16px",borderBottom:`1px solid ${s.border}`},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:s.primary,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"18px"},children:""}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"700",fontSize:"14px",color:s.text},children:"Email Automation"}),e.jsx("div",{style:{fontSize:"11px",color:s.textMuted},children:"Marketing System"})]})]})}),e.jsxs("div",{style:{flex:1,padding:"12px 8px"},children:[e.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:s.textMuted,padding:"8px 12px",textTransform:"uppercase"},children:"Navigation"}),l.map(b=>e.jsxs(Z,{to:b.path,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:c===b.id?`${s.primary}15`:"transparent",border:"none",borderRadius:"8px",color:c===b.id?s.primary:s.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:c===b.id?"600":"400",textAlign:"left",alignItems:"center",gap:"10px",marginBottom:"2px",textDecoration:"none"},children:[e.jsx("span",{children:b.icon})," ",b.label]},b.id)),e.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:s.textMuted,padding:"16px 12px 8px",textTransform:"uppercase"},children:"Admin"}),e.jsxs(Z,{to:`/${t}/timeline`,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:c==="timeline"?`${s.primary}15`:"transparent",border:"none",borderRadius:"8px",color:c==="timeline"?s.primary:s.textSecondary,cursor:"pointer",fontSize:"13px",textAlign:"left",alignItems:"center",gap:"10px",textDecoration:"none"},children:[e.jsx("span",{children:""})," Timeline",e.jsx("span",{style:{marginLeft:"auto",padding:"2px 8px",backgroundColor:s.bgHover,borderRadius:"4px",fontSize:"10px",color:s.textMuted},children:"Admin"})]})]}),e.jsxs("div",{style:{padding:"16px",borderTop:`1px solid ${s.border}`,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:s.bgHover,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:""}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:s.text},children:n.name}),e.jsx("div",{style:{fontSize:"11px",color:s.textMuted},children:n.email})]}),e.jsx(Z,{to:`/${t}/settings`,style:{color:s.textMuted,fontSize:"16px",textDecoration:"none"},children:""})]})]}),e.jsxs("div",{style:{flex:1,marginLeft:"220px"},children:[e.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${s.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:s.bgCard},children:[e.jsxs("div",{style:{fontSize:"11px",color:s.textMuted},children:["User: ",t==null?void 0:t.substring(0,8),"..."]}),e.jsx("button",{onClick:()=>r(!i),style:{padding:"8px 12px",backgroundColor:s.bgHover,border:`1px solid ${s.border}`,borderRadius:"8px",color:s.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:i?" Light":" Dark"})]}),e.jsx("div",{style:{padding:"24px"},children:e.jsxs($e,{children:[e.jsx(H,{path:"dashboard",element:e.jsx(Ce,{t:s})}),e.jsx(H,{path:"automations",element:e.jsx(Rt,{t:s})}),e.jsx(H,{path:"automations/new",element:e.jsx(ke,{t:s})}),e.jsx(H,{path:"automations/:automationId",element:e.jsx(ke,{t:s})}),e.jsx(H,{path:"templates",element:e.jsx(At,{t:s})}),e.jsx(H,{path:"mass-email",element:e.jsx(no,{t:s})}),e.jsx(H,{path:"accounts",element:e.jsx(qt,{t:s})}),e.jsx(H,{path:"accounts/:accountId",element:e.jsx(Pt,{t:s})}),e.jsx(H,{path:"settings",element:e.jsx(Ht,{t:s})}),e.jsx(H,{path:"timeline",element:e.jsx(lo,{t:s})}),e.jsx(H,{path:"*",element:e.jsx(Ce,{t:s})})]})})]})]})})})},lo=({t})=>e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:t.text,marginBottom:"4px"},children:"Activity Timeline"}),e.jsx("p",{style:{color:t.textSecondary,fontSize:"14px"},children:"View all email activity across your organization"}),e.jsxs("div",{style:{marginTop:"24px",padding:"60px",textAlign:"center",backgroundColor:t.bgCard,borderRadius:"12px",border:`1px solid ${t.border}`},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),e.jsx("p",{style:{color:t.textMuted},children:"Timeline view coming soon..."})]})]}),co=()=>{const t=ie();return k.useEffect(()=>{t("/0056g000004jvyVAAQ/dashboard")},[t]),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"'Inter', sans-serif"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"32px",marginBottom:"16px"},children:""}),e.jsx("div",{children:"Loading..."})]})})},po=()=>e.jsxs(Ge,{client:Je,children:[e.jsx(Ve,{children:e.jsxs($e,{children:[e.jsx(H,{path:"/",element:e.jsx(co,{})}),e.jsx(H,{path:"/:userId/*",element:e.jsx(so,{})})]})}),e.jsx(Ye,{initialIsOpen:!1})]});be.createRoot(document.getElementById("root")).render(e.jsx(oe.StrictMode,{children:e.jsx(po,{})}));
