import{Q as It,j as t,u as oe,a as Me,b as J,c as $t}from"./query-BbE8ety8.js";import{a as Dt,r as C,u as ye,b as Tt,c as Ye,N as Mt,d as le,L as Ce,R as ke,B as Wt,e as ft,f as ae}from"./vendor-BprrjqLD.js";import{c as Bt}from"./supabase-GtAdROLV.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function o(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(i){if(i.ep)return;i.ep=!0;const n=o(i);fetch(i.href,n)}})();var Ge={},lt=Dt;Ge.createRoot=lt.createRoot,Ge.hydrateRoot=lt.hydrateRoot;var Et=function(){return null};const qt=new It({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*30,retry:1,refetchOnWindowFocus:!0,refetchOnMount:!0},mutations:{retry:0}}}),Lt=void 0,Pt=void 0;throw new Error("Missing Supabase environment variables");const g=Bt(Lt,Pt),he={async get(e){const{data:r,error:o}=await g.from("user_settings").select("*").eq("user_id",e).single();if(o&&o.code!=="PGRST116")throw o;return r},async getWithUser(e){const{data:r,error:o}=await g.from("user_settings").select(`
        *,
        user:users(user_unique_id, email, first_name, last_name, role_name, profile_name)
      `).eq("user_id",e).single();if(o&&o.code!=="PGRST116")throw o;return r},async create(e,r={}){const{data:o,error:a}=await g.from("user_settings").insert({user_id:e,...r}).select().single();if(a)throw a;return o},async update(e,r){const{data:o,error:a}=await g.from("user_settings").update({...r,updated_at:new Date().toISOString()}).eq("user_id",e).select().single();if(a)throw a;return o},async updateSignature(e,r){const{signatureName:o,signatureTitle:a,signaturePhone:i,signatureEmail:n,signatureMessage:s}=r;return this.update(e,{signature_name:o,signature_title:a,signature_phone:i,signature_email:n,signature_message:s})},async updateAgencyInfo(e,r){const{agencyName:o,agencyAddress:a,agencyPhone:i,agencyWebsite:n}=r;return this.update(e,{agency_name:o,agency_address:a,agency_phone:i,agency_website:n})},async updateEmailSettings(e,r){const{fromName:o,fromEmail:a,replyToEmail:i,defaultSendTime:n,timezone:s,dailySendLimit:c}=r;return this.update(e,{from_name:o,from_email:a,reply_to_email:i,default_send_time:n,timezone:s,daily_send_limit:c})},async updatePreferences(e,r){const o=await this.get(e);return this.update(e,{preferences:{...o==null?void 0:o.preferences,...r}})},async getCurrentUser(e){const{data:r,error:o}=await g.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name").eq("user_unique_id",e).single();if(o&&o.code!=="PGRST116")throw o;return r},async getUserIdsByRole(e){const r=await this.getCurrentUser(e);if(!(r!=null&&r.role_name))return[e];const{data:o,error:a}=await g.from("users").select("user_unique_id").eq("role_name",r.role_name);if(a)throw a;return(o==null?void 0:o.map(i=>i.user_unique_id))||[e]},async getSignatureHtml(e){const r=await this.get(e);if(!r)return"";const{signature_name:o,signature_title:a,signature_phone:i,signature_email:n,signature_message:s}=r;let c='<table style="margin-top: 20px; font-family: Arial, sans-serif;">';return c+="<tr><td>",o&&(c+=`<strong style="font-size: 14px;">${o}</strong><br>`),a&&(c+=`<span style="color: #666;">${a}</span><br>`),i&&(c+=`<span>${i}</span><br>`),n&&(c+=`<a href="mailto:${n}" style="color: #0066cc;">${n}</a><br>`),s&&(c+=`<p style="margin-top: 10px; font-style: italic; color: #666;">${s}</p>`),c+="</td></tr></table>",c},async getUnsubscribeFooterHtml(e,r,o=null){const a=await this.get(e),i="https://your-app.com",n=`${i}/unsubscribe?type=automation&id=${r}&aid=${o}`,s=`${i}/unsubscribe?type=all&id=${r}`;let c=`
      <table style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; width: 100%; font-family: Arial, sans-serif;">
        <tr>
          <td style="text-align: center; font-size: 12px; color: #666;">
    `;return o&&(c+=`<a href="${n}" style="color: #666;">Unsubscribe from these emails</a> &nbsp;|&nbsp; `),c+=`<a href="${s}" style="color: #666;">Unsubscribe from all emails</a>`,(a!=null&&a.agency_name||a!=null&&a.agency_address)&&(c+="<br><br>",a.agency_name&&(c+=a.agency_name),a.agency_address&&(c+=` | ${a.agency_address}`)),c+=`
          </td>
        </tr>
      </table>
    `,c}},pe={async isAdmin(e){const{data:r,error:o}=await g.from("admin_users").select("id").eq("user_id",e).single();if(o&&o.code!=="PGRST116")throw o;return!!r},async getAdminUsers(){const{data:e,error:r}=await g.from("admin_users").select("*").order("created_at");if(r)throw r;return e},async addAdmin(e,r=null){const{data:o,error:a}=await g.from("admin_users").insert({user_id:e,name:r}).select().single();if(a)throw a;return o},async removeAdmin(e){const{error:r}=await g.from("admin_users").delete().eq("user_id",e);if(r)throw r;return!0},async getAllUsers(e=""){let r=g.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name, marketing_cloud_agency_admin").order("first_name");e&&(r=r.or(`first_name.ilike.%${e}%,last_name.ilike.%${e}%,email.ilike.%${e}%`)),r=r.limit(50);const{data:o,error:a}=await r;if(a)throw a;return o||[]},async getUniqueAgencies(){const{data:e,error:r}=await g.from("users").select("profile_name").not("profile_name","is",null).order("profile_name");if(r)throw r;return[...new Set(e==null?void 0:e.map(a=>a.profile_name))].filter(Boolean)},async getUsersByAgency(e){const{data:r,error:o}=await g.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name, marketing_cloud_agency_admin").eq("profile_name",e).order("first_name");if(o)throw o;return r||[]},async getUserIdsByAgency(e){const{data:r,error:o}=await g.from("users").select("user_unique_id").eq("profile_name",e);if(o)throw o;return(r==null?void 0:r.map(a=>a.user_unique_id))||[]},async getAgencyAgents(e,r=null,o=""){let a=g.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name").eq("profile_name",e).order("first_name");r&&(a=a.neq("user_unique_id",r)),o&&(a=a.or(`first_name.ilike.%${o}%,last_name.ilike.%${o}%,email.ilike.%${o}%`)),a=a.limit(50);const{data:i,error:n}=await a;if(n)throw n;return i||[]},async isAgencyAdmin(e){const{data:r,error:o}=await g.from("users").select("marketing_cloud_agency_admin").eq("user_unique_id",e).single();if(o&&o.code!=="PGRST116")throw o;return(r==null?void 0:r.marketing_cloud_agency_admin)===!0},async getUserProfileName(e){const{data:r,error:o}=await g.from("users").select("profile_name").eq("user_unique_id",e).single();if(o&&o.code!=="PGRST116")throw o;return(r==null?void 0:r.profile_name)||null},async getMasterAutomations(){const{data:e,error:r}=await g.from("master_automations").select("*").order("name");if(r)throw r;return e},async getMasterAutomation(e){const{data:r,error:o}=await g.from("master_automations").select("*").eq("default_key",e).single();if(o)throw o;return r},async createMasterAutomation(e){const{data:r,error:o}=await g.from("master_automations").insert(e).select().single();if(o)throw o;return r},async updateMasterAutomation(e,r){const{data:o}=await g.from("master_automations").select("id").eq("default_key",e).single();let a,i;if(o){const n=await g.from("master_automations").update({...r,updated_at:new Date().toISOString()}).eq("default_key",e).select().single();a=n.data,i=n.error}else{const n=await g.from("master_automations").insert({default_key:e,...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();a=n.data,i=n.error}if(i)throw i;return await g.rpc("sync_master_automation_to_users",{p_default_key:e}),a},async deleteMasterAutomation(e){const{error:r}=await g.from("master_automations").delete().eq("default_key",e);if(r)throw r;return!0},async syncMasterAutomation(e){const{data:r,error:o}=await g.rpc("sync_master_automation_to_users",{p_default_key:e});if(o)throw o;return r},async syncAllMasterAutomations(){const{data:e,error:r}=await g.rpc("sync_all_master_automations");if(r)throw r;return e},async getMasterTemplates(){const{data:e,error:r}=await g.from("master_templates").select("*").order("name");if(r)throw r;return e},async getMasterTemplate(e){const{data:r,error:o}=await g.from("master_templates").select("*").eq("default_key",e).single();if(o)throw o;return r},async createMasterTemplate(e){const{data:r,error:o}=await g.from("master_templates").insert(e).select().single();if(o)throw o;return r},async updateMasterTemplate(e,r){const{data:o,error:a}=await g.from("master_templates").update(r).eq("default_key",e).select().single();if(a)throw a;return o},async deleteMasterTemplate(e){const{error:r}=await g.from("master_templates").delete().eq("default_key",e);if(r)throw r;return!0},async syncMasterTemplate(e){const{data:r,error:o}=await g.rpc("sync_master_template_to_users",{p_default_key:e});if(o)throw o;return r},async syncAllMasterTemplates(){const{data:e,error:r}=await g.rpc("sync_all_master_templates");if(r)throw r;return e}},X={detectSalesforceContext(){const e=new URLSearchParams(window.location.search),r=e.get("sfSession"),o=e.get("sfOrg"),a=window.location.pathname.match(/^\/([a-zA-Z0-9]{15,18})/),i=a?a[1]:null,n=window.self!==window.top,s=document.referrer||"",c=s.includes(".salesforce.com")||s.includes(".force.com")||s.includes(".lightning.force.com")||s.includes(".my.salesforce.com");return r&&o&&i?{isFromSalesforce:!0,userId:i,sessionId:r,orgId:o,isInIframe:n,isSalesforceReferrer:c}:n&&c&&i?{isFromSalesforce:!0,userId:i,sessionId:null,orgId:null,isInIframe:n,isSalesforceReferrer:c}:{isFromSalesforce:!1,userId:i,sessionId:null,orgId:null,isInIframe:n,isSalesforceReferrer:c}},async validateSalesforceSession(e,r){if(!e||!r)return null;try{const o=`https://${r.substring(0,15)}.my.salesforce.com`,a=await fetch(`${o}/services/oauth2/userinfo`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok)return console.warn("Salesforce session validation failed:",a.status),null;const i=await a.json();return{userId:i.user_id,email:i.email,name:i.name,orgId:i.organization_id}}catch(o){return console.warn("Salesforce session validation error:",o),null}},async getUserById(e){const{data:r,error:o}=await g.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name, marketing_cloud_engagement, marketing_cloud_agency_admin").eq("user_unique_id",e);if(o)throw o;return!r||r.length===0||!r.some(n=>n.marketing_cloud_engagement===!0||n.marketing_cloud_agency_admin===!0)?null:r.find(n=>n.marketing_cloud_engagement===!0||n.marketing_cloud_agency_admin===!0)||r[0]},createLocalSession(e){const r={userId:e.user_unique_id,email:e.email,name:`${e.first_name||""} ${e.last_name||""}`.trim()||"User",expiresAt:Date.now()+864e5,source:"salesforce"};return localStorage.setItem("isg_sf_session",JSON.stringify(r)),r},getLocalSession(){const e=localStorage.getItem("isg_sf_session");if(!e)return null;try{const r=JSON.parse(e);return r.expiresAt>Date.now()?r:(localStorage.removeItem("isg_sf_session"),null)}catch{return localStorage.removeItem("isg_sf_session"),null}},clearLocalSession(){localStorage.removeItem("isg_sf_session")},async sendOTP(e){const{error:r}=await g.auth.signInWithOtp({email:e,options:{shouldCreateUser:!0}});if(r)throw r;return!0},async verifyOTP(e,r){const{data:o,error:a}=await g.auth.verifyOtp({email:e,token:r,type:"email"});if(a)throw a;return o},async getUserByEmail(e){const{data:r,error:o}=await g.from("users").select("user_unique_id, email, first_name, last_name, role_name, profile_name, marketing_cloud_engagement, marketing_cloud_agency_admin").eq("email",e);if(o)throw o;return!r||r.length===0||!r.some(n=>n.marketing_cloud_engagement===!0||n.marketing_cloud_agency_admin===!0)?null:r.find(n=>n.marketing_cloud_engagement===!0||n.marketing_cloud_agency_admin===!0)||r[0]},async getSession(){const{data:{session:e},error:r}=await g.auth.getSession();if(r)throw r;return e},async signOut(){const{error:e}=await g.auth.signOut();if(e)throw e;return!0},onAuthStateChange(e){return g.auth.onAuthStateChange(e)},async isAdmin(e){const{data:r,error:o}=await g.from("admin_users").select("id").eq("user_id",e).single();if(o&&o.code!=="PGRST116")throw o;return!!r},saveLastEmail(e){localStorage.setItem("isg_last_email",e)},getLastEmail(){return localStorage.getItem("isg_last_email")},clearLastEmail(){localStorage.removeItem("isg_last_email")}},yt=C.createContext(),Pe={MASTER_ADMIN:"master_admin",AGENCY_ADMIN:"agency_admin",MARKETING_USER:"marketing_user"},ve=()=>{const e=C.useContext(yt);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},Ot=({children:e})=>{const[r,o]=C.useState(!0),[a,i]=C.useState(!1),[n,s]=C.useState(null),[c,d]=C.useState(!1),[l,h]=C.useState(!1),[y,p]=C.useState(null),[v,R]=C.useState({active:!1,originalUserId:null,originalUserName:null,targetUserId:null,targetUserName:null,targetProfileName:null}),[x,b]=C.useState({active:!1,filterType:null,filterValue:null,filterLabel:null,ownerIds:null});C.useEffect(()=>{m();const{data:{subscription:u}}=X.onAuthStateChange(async(A,G)=>{A==="SIGNED_OUT"&&(i(!1),s(null),d(!1),R({active:!1,originalUserId:null,originalUserName:null,targetUserId:null,targetUserName:null}))});return()=>u==null?void 0:u.unsubscribe()},[]);const m=async()=>{o(!0);try{const u=X.detectSalesforceContext();if(u.isFromSalesforce&&await I(u)){o(!1);return}const A=X.getLocalSession();if(A){const G=await X.getUserById(A.userId);if(G){await D(G),o(!1);return}X.clearLocalSession()}await E()}catch(u){console.error("Auth initialization error:",u),i(!1),s(null)}finally{o(!1)}},I=async u=>{try{const{userId:A,sessionId:G,orgId:Q,isSalesforceReferrer:Z,isInIframe:$}=u;if(G&&Q){const w=await X.validateSalesforceSession(G,Q);if(w){const f=await X.getUserById(w.userId);if(f)return X.createLocalSession(f),await D(f),!0}}if($&&Z&&A){const w=await X.getUserById(A);if(w)return X.createLocalSession(w),await D(w),!0}return!1}catch(A){return console.error("Salesforce auth error:",A),!1}},D=async u=>{const A=`${u.first_name||""} ${u.last_name||""}`.trim()||"User";s({id:u.user_unique_id,name:A,email:u.email,profileName:u.profile_name||null}),i(!0);const G=await X.isAdmin(u.user_unique_id);d(G);const Q=u.marketing_cloud_agency_admin===!0;h(Q);let Z;G?Z=Pe.MASTER_ADMIN:Q?Z=Pe.AGENCY_ADMIN:Z=Pe.MARKETING_USER,p(Z);const $=localStorage.getItem("isg_impersonation");if($&&(G||Q)){const f=JSON.parse($);f.originalUserId===u.user_unique_id?R(f):localStorage.removeItem("isg_impersonation")}const w=localStorage.getItem("isg_scope_filter");if(w&&(G||Q)){const f=JSON.parse(w);f.originalUserId===u.user_unique_id?b(f):localStorage.removeItem("isg_scope_filter")}},E=async()=>{var u;try{const A=await X.getSession();if((u=A==null?void 0:A.user)!=null&&u.email){const G=await X.getUserByEmail(A.user.email);G?await D(G):(await X.signOut(),i(!1),s(null))}}catch(A){console.error("Session check error:",A),i(!1),s(null)}},S=async u=>{await X.sendOTP(u),X.saveLastEmail(u)},_=async(u,A)=>{await X.verifyOTP(u,A);const G=await X.getUserByEmail(u);if(!G)return await X.signOut(),{success:!1,noAccess:!0};const Q=`${G.first_name||""} ${G.last_name||""}`.trim()||"User";s({id:G.user_unique_id,name:Q,email:G.email}),i(!0);const Z=await X.isAdmin(G.user_unique_id);return d(Z),{success:!0,userId:G.user_unique_id,noAccess:!1}},W=async()=>{await X.signOut(),X.clearLocalSession(),localStorage.removeItem("isg_impersonation"),localStorage.removeItem("isg_scope_filter"),i(!1),s(null),d(!1),h(!1),p(null),R({active:!1,originalUserId:null,originalUserName:null,targetUserId:null,targetUserName:null,targetProfileName:null}),b({active:!1,filterType:null,filterValue:null,filterLabel:null,ownerIds:null})},V=C.useCallback((u,A,G=null)=>{if(!c&&!l||!n)return!1;const Q={active:!0,originalUserId:n.id,originalUserName:n.name,targetUserId:u,targetUserName:A,targetProfileName:G};return R(Q),localStorage.setItem("isg_impersonation",JSON.stringify(Q)),!0},[c,l,n]),T=C.useCallback(()=>{localStorage.removeItem("isg_impersonation"),R({active:!1,originalUserId:null,originalUserName:null,targetUserId:null,targetUserName:null,targetProfileName:null})},[]),q=C.useCallback(()=>v.active&&v.targetUserId?v.targetUserId:(n==null?void 0:n.id)||null,[v,n]),P=C.useCallback(()=>v.active&&v.targetUserName?v.targetUserName:(n==null?void 0:n.name)||null,[v,n]),K=C.useCallback(u=>{if(!n)return;const A={active:u.filterType!==null,filterType:u.filterType,filterValue:u.filterValue,filterLabel:u.filterLabel,ownerIds:u.ownerIds,originalUserId:n.id};b(A),A.active?localStorage.setItem("isg_scope_filter",JSON.stringify(A)):localStorage.removeItem("isg_scope_filter")},[n]),L=C.useCallback(()=>{localStorage.removeItem("isg_scope_filter"),b({active:!1,filterType:null,filterValue:null,filterLabel:null,ownerIds:null})},[]),N=C.useCallback(()=>v.active&&v.targetUserId?v.targetUserId:x.active&&x.ownerIds&&x.ownerIds.length>0?x.ownerIds.length===1?x.ownerIds[0]:x.ownerIds:(n==null?void 0:n.id)||null,[v,x,n]),O=C.useCallback(()=>x.active||v.active,[x,v]),B={isLoading:r,isAuthenticated:a,user:n,isAdmin:c,isAgencyAdmin:l,userRole:y,impersonating:v,scopeFilter:x,sendOTP:S,verifyOTP:_,logout:W,impersonate:V,exitImpersonation:T,getEffectiveUserId:q,getEffectiveUserName:P,updateScopeFilter:K,clearScopeFilter:L,getEffectiveOwnerIds:N,isViewingFiltered:O,checkSession:E};return t.jsx(yt.Provider,{value:B,children:e})},Ft=()=>{const e=ye(),[r]=Tt(),{isAuthenticated:o,user:a,sendOTP:i,verifyOTP:n}=ve(),[s,c]=C.useState("email"),[d,l]=C.useState(""),[h,y]=C.useState(""),[p,v]=C.useState(""),[R,x]=C.useState(!1),[b,m]=C.useState(!1);C.useEffect(()=>{const W=r.get("email"),V=X.getLastEmail();W?l(W):V&&l(V)},[r]),C.useEffect(()=>{o&&(a!=null&&a.id)&&e(`/${a.id}/dashboard`,{replace:!0})},[o,a,e]);const I=async W=>{var V;W.preventDefault(),v(""),x(!0);try{await i(d),m(!0),c("code")}catch(T){console.error("Send OTP error:",T),(V=T.message)!=null&&V.includes("rate limit")?v("Too many attempts. Please wait a moment and try again."):v("Failed to send verification code. Please try again.")}finally{x(!1)}},D=async W=>{var V,T;W.preventDefault(),v(""),x(!0);try{const q=await n(d,h);q.noAccess?c("no-access"):q.success&&e(`/${q.userId}/dashboard`,{replace:!0})}catch(q){console.error("Verify OTP error:",q),(V=q.message)!=null&&V.includes("Invalid")||(T=q.message)!=null&&T.includes("expired")?v("Invalid or expired code. Please try again."):v("Verification failed. Please try again.")}finally{x(!1)}},E=async()=>{v(""),x(!0),y("");try{await i(d),m(!0),v("")}catch(W){console.error("Resend OTP error:",W),v("Failed to resend code. Please try again.")}finally{x(!1)}},S=()=>{c("email"),l(""),y(""),v(""),m(!1),X.clearLastEmail()},_={container:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",padding:"20px"},card:{backgroundColor:"#ffffff",borderRadius:"16px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",padding:"48px",width:"100%",maxWidth:"420px"},logo:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",marginBottom:"32px"},logoIcon:{width:"48px",height:"48px",backgroundColor:"#3b82f6",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"24px"},logoText:{fontWeight:"700",fontSize:"20px",color:"#1e293b"},title:{fontSize:"24px",fontWeight:"700",color:"#1e293b",textAlign:"center",marginBottom:"8px"},subtitle:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},form:{display:"flex",flexDirection:"column",gap:"20px"},inputGroup:{display:"flex",flexDirection:"column",gap:"6px"},label:{fontSize:"14px",fontWeight:"500",color:"#374151"},input:{padding:"12px 16px",fontSize:"16px",border:"1px solid #e2e8f0",borderRadius:"8px",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},button:{padding:"14px 24px",fontSize:"16px",fontWeight:"600",color:"#ffffff",backgroundColor:"#3b82f6",border:"none",borderRadius:"8px",cursor:"pointer",transition:"background-color 0.2s"},buttonDisabled:{backgroundColor:"#94a3b8",cursor:"not-allowed"},error:{padding:"12px 16px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",color:"#dc2626",fontSize:"14px"},link:{color:"#3b82f6",textDecoration:"none",cursor:"pointer",fontSize:"14px"},codeInfo:{textAlign:"center",fontSize:"14px",color:"#64748b"},noAccessIcon:{fontSize:"64px",textAlign:"center",marginBottom:"24px"},noAccessTitle:{fontSize:"20px",fontWeight:"600",color:"#1e293b",textAlign:"center",marginBottom:"12px"},noAccessText:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"24px",lineHeight:"1.6"},secondaryButton:{padding:"12px 24px",fontSize:"14px",fontWeight:"500",color:"#3b82f6",backgroundColor:"transparent",border:"1px solid #3b82f6",borderRadius:"8px",cursor:"pointer",transition:"background-color 0.2s"}};return s==="no-access"?t.jsx("div",{style:_.container,children:t.jsxs("div",{style:_.card,children:[t.jsxs("div",{style:_.logo,children:[t.jsx("div",{style:_.logoIcon,children:"ðŸ“§"}),t.jsx("div",{style:_.logoText,children:"Email Automation"})]}),t.jsx("div",{style:_.noAccessIcon,children:"ðŸ”’"}),t.jsx("div",{style:_.noAccessTitle,children:"Access Denied"}),t.jsxs("div",{style:_.noAccessText,children:["You don't have access to this site.",t.jsx("br",{}),"Contact your administrator for access."]}),t.jsx("button",{onClick:S,style:_.secondaryButton,children:"Try a Different Email"})]})}):s==="code"?t.jsx("div",{style:_.container,children:t.jsxs("div",{style:_.card,children:[t.jsxs("div",{style:_.logo,children:[t.jsx("div",{style:_.logoIcon,children:"ðŸ“§"}),t.jsx("div",{style:_.logoText,children:"Email Automation"})]}),t.jsx("h1",{style:_.title,children:"Check Your Email"}),t.jsxs("p",{style:_.subtitle,children:["We sent a verification code to",t.jsx("br",{}),t.jsx("strong",{children:d})]}),t.jsxs("form",{onSubmit:D,style:_.form,children:[p&&t.jsx("div",{style:_.error,children:p}),t.jsxs("div",{style:_.inputGroup,children:[t.jsx("label",{style:_.label,children:"Verification Code"}),t.jsx("input",{type:"text",value:h,onChange:W=>y(W.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"Enter 6-digit code",style:_.input,autoFocus:!0,maxLength:6,inputMode:"numeric",autoComplete:"one-time-code"})]}),t.jsx("button",{type:"submit",disabled:R||h.length!==6,style:{..._.button,...R||h.length!==6?_.buttonDisabled:{}},children:R?"Verifying...":"Verify Code"}),t.jsxs("div",{style:_.codeInfo,children:["Didn't receive the code?"," ",t.jsx("span",{onClick:R?void 0:E,style:{..._.link,...R?{opacity:.5,cursor:"not-allowed"}:{}},children:"Resend"})]}),t.jsx("div",{style:{textAlign:"center"},children:t.jsx("span",{onClick:S,style:_.link,children:"Use a different email"})})]})]})}):t.jsx("div",{style:_.container,children:t.jsxs("div",{style:_.card,children:[t.jsxs("div",{style:_.logo,children:[t.jsx("div",{style:_.logoIcon,children:"ðŸ“§"}),t.jsx("div",{style:_.logoText,children:"Email Automation"})]}),t.jsx("h1",{style:_.title,children:"Welcome Back"}),t.jsx("p",{style:_.subtitle,children:"Enter your email to receive a verification code"}),t.jsxs("form",{onSubmit:I,style:_.form,children:[p&&t.jsx("div",{style:_.error,children:p}),t.jsxs("div",{style:_.inputGroup,children:[t.jsx("label",{style:_.label,children:"Email Address"}),t.jsx("input",{type:"email",value:d,onChange:W=>l(W.target.value),placeholder:"you@example.com",style:_.input,autoFocus:!0,autoComplete:"email",required:!0})]}),t.jsx("button",{type:"submit",disabled:R||!d,style:{..._.button,...R||!d?_.buttonDisabled:{}},children:R?"Sending...":"Send Verification Code"})]})]})})},Nt=({children:e})=>{const{isLoading:r,isAuthenticated:o}=ve(),a=Ye();if(r)return t.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif"},children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{width:"48px",height:"48px",border:"3px solid #e2e8f0",borderTopColor:"#3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 16px"}}),t.jsx("div",{style:{color:"#64748b",fontSize:"14px"},children:"Loading..."}),t.jsx("style",{children:`
            @keyframes spin {
              to { transform: rotate(360deg); }
            }
          `})]})});if(!o){const i=X.detectSalesforceContext();return i.isInIframe&&i.isSalesforceReferrer?t.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8fafc",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif"},children:t.jsxs("div",{style:{textAlign:"center",padding:"40px",maxWidth:"400px"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ”’"}),t.jsx("h2",{style:{fontSize:"20px",fontWeight:"600",color:"#1e293b",marginBottom:"8px"},children:"Access Denied"}),t.jsx("p",{style:{color:"#64748b",fontSize:"14px",lineHeight:"1.5"},children:"Your user account doesn't have access to this application. Please contact your administrator."})]})}):t.jsx(Mt,{to:"/login",state:{from:a},replace:!0})}return e},Ht=()=>{const e=ye(),{impersonating:r,exitImpersonation:o,user:a}=ve();if(!r.active)return null;const i=()=>{o(),a!=null&&a.id&&e(`/${a.id}/dashboard`)};return t.jsxs("div",{style:{backgroundColor:"#f59e0b",color:"#ffffff",padding:"10px 24px",display:"flex",alignItems:"center",justifyContent:"center",gap:"16px",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",fontSize:"14px",fontWeight:"500",position:"fixed",top:0,left:0,right:0,zIndex:9999,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:[t.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ‘ï¸"}),"Viewing as: ",t.jsx("strong",{children:r.targetUserName})]}),t.jsx("button",{onClick:i,style:{backgroundColor:"rgba(255, 255, 255, 0.2)",border:"1px solid rgba(255, 255, 255, 0.4)",color:"#ffffff",padding:"6px 16px",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"600",transition:"background-color 0.2s"},onMouseEnter:n=>n.target.style.backgroundColor="rgba(255, 255, 255, 0.3)",onMouseLeave:n=>n.target.style.backgroundColor="rgba(255, 255, 255, 0.2)",children:"Exit Impersonation"})]})},Ut=({t:e})=>{const{userRole:r,user:o,scopeFilter:a,updateScopeFilter:i,clearScopeFilter:n,isAdmin:s,isAgencyAdmin:c}=ve(),[d,l]=C.useState(!1),[h,y]=C.useState(""),[p,v]=C.useState([]),[R,x]=C.useState(!1),b=C.useRef(null),m=C.useRef(null);if(r===Pe.MARKETING_USER||!s&&!c)return null;C.useEffect(()=>{const T=q=>{b.current&&!b.current.contains(q.target)&&l(!1)};return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[]);const I=async(T="")=>{x(!0);try{if(s){const q=await pe.getUniqueAgencies(),P=T?q.filter(K=>K.toLowerCase().includes(T.toLowerCase())):q;v(P.map(K=>({type:"agency",value:K,label:K})))}else if(c&&(o!=null&&o.profileName)){const q=await pe.getAgencyAgents(o.profileName,o.id,T);v(q.map(P=>({type:"agent",value:P.user_unique_id,label:`${P.first_name||""} ${P.last_name||""}`.trim()||P.email,email:P.email})))}}catch(q){console.error("Error fetching filter items:",q)}finally{x(!1)}},D=async()=>{l(!0),y(""),await I()},E=T=>{y(T),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{I(T)},300)},S=async()=>{if(s)n();else if(c&&(o!=null&&o.profileName)){const T=await pe.getUserIdsByAgency(o.profileName);i({filterType:"all_agents",filterValue:o.profileName,filterLabel:"All Agents",ownerIds:T})}l(!1),y("")},_=async T=>{if(T.type==="agency"){const q=await pe.getUserIdsByAgency(T.value);i({filterType:"agency",filterValue:T.value,filterLabel:T.label,ownerIds:q})}else T.type==="agent"&&i({filterType:"agent",filterValue:T.value,filterLabel:T.label,ownerIds:[T.value]});l(!1),y("")},W=()=>a.active?a.filterLabel||"Filtered":s?"All Agencies":"My Data",V=()=>s?"All Agencies":"All Agents";return t.jsxs("div",{ref:b,style:{position:"relative"},children:[t.jsxs("button",{onClick:D,style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",backgroundColor:a.active?e.primary+"15":e.bgHover,border:`1px solid ${a.active?e.primary:e.border}`,borderRadius:"8px",color:a.active?e.primary:e.text,cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:[t.jsx("span",{children:s?"ðŸ¢":"ðŸ‘¥"}),t.jsx("span",{children:W()}),t.jsx("span",{style:{fontSize:"10px",opacity:.7},children:"â–¼"})]}),d&&t.jsxs("div",{style:{position:"absolute",top:"100%",left:0,marginTop:"4px",width:"280px",backgroundColor:e.bgCard,border:`1px solid ${e.border}`,borderRadius:"12px",boxShadow:"0 10px 40px rgba(0,0,0,0.15)",zIndex:1e3,overflow:"hidden"},children:[t.jsx("div",{style:{padding:"12px",borderBottom:`1px solid ${e.border}`},children:t.jsx("input",{type:"text",placeholder:s?"Search agencies...":"Search agents...",value:h,onChange:T=>E(T.target.value),autoFocus:!0,style:{width:"100%",padding:"10px 12px",fontSize:"13px",border:`1px solid ${e.border}`,borderRadius:"8px",backgroundColor:e.bgInput,color:e.text,outline:"none"}})}),t.jsxs("div",{style:{maxHeight:"300px",overflowY:"auto"},children:[t.jsxs("button",{onClick:S,style:{width:"100%",padding:"12px 16px",backgroundColor:a.active?"transparent":e.bgHover,border:"none",borderBottom:`1px solid ${e.borderLight}`,color:e.text,cursor:"pointer",textAlign:"left",fontSize:"13px",fontWeight:a.active?"400":"600",display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:s?"ðŸŒ":"ðŸ‘¥"}),t.jsx("span",{children:V()}),!a.active&&t.jsx("span",{style:{marginLeft:"auto",color:e.primary},children:"âœ“"})]}),R&&t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted},children:"Loading..."}),!R&&p.length===0&&t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted},children:h?"No results found":"No items available"}),!R&&p.map((T,q)=>t.jsxs("button",{onClick:()=>_(T),style:{width:"100%",padding:"12px 16px",backgroundColor:a.filterValue===T.value?e.bgHover:"transparent",border:"none",borderBottom:q<p.length-1?`1px solid ${e.borderLight}`:"none",color:e.text,cursor:"pointer",textAlign:"left",fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{children:T.type==="agency"?"ðŸ¢":"ðŸ‘¤"}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:a.filterValue===T.value?"600":"400"},children:T.label}),T.email&&t.jsx("div",{style:{fontSize:"11px",color:e.textMuted,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:T.email})]}),a.filterValue===T.value&&t.jsx("span",{style:{color:e.primary},children:"âœ“"})]},T.value))]}),a.active&&t.jsx("div",{style:{padding:"12px",borderTop:`1px solid ${e.border}`},children:t.jsx("button",{onClick:()=>{n(),l(!1)},style:{width:"100%",padding:"10px",backgroundColor:"transparent",border:`1px solid ${e.danger}`,borderRadius:"8px",color:e.danger,cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Clear Filter"})})]})]})};function H(e,r,o="owner_id"){return r?Array.isArray(r)?r.length===0?e:r.length===1?e.eq(o,r[0]):e.in(o,r):e.eq(o,r):e}function xe(e){return e?Array.isArray(e)?e.length>0?e[0]:null:e:null}function Gt(e){return e?Array.isArray(e)?e:[e]:[]}const we={async getAll(e,r={}){const{category:o,isDefault:a,search:i}=r;let n=g.from("email_templates").select("*").order("is_default",{ascending:!1}).order("name");n=H(n,e),o&&(n=n.eq("category",o)),typeof a=="boolean"&&(n=n.eq("is_default",a)),i&&(n=n.or(`name.ilike.%${i}%,subject.ilike.%${i}%`));const{data:s,error:c}=await n;if(c)throw c;return s},async getById(e,r){let o=g.from("email_templates").select("*").eq("id",r);o=H(o,e);const{data:a,error:i}=await o.single();if(i)throw i;return a},async getByDefaultKey(e,r){let o=g.from("email_templates").select("*").eq("default_key",r);o=H(o,e);const{data:a,error:i}=await o.single();if(i)throw i;return a},async create(e,r){const o=xe(e),{data:a,error:i}=await g.from("email_templates").insert({owner_id:o,is_default:!1,...r}).select().single();if(i)throw i;return a},async update(e,r,o){let a=g.from("email_templates").update({...o,updated_at:new Date().toISOString()}).eq("id",r);a=H(a,e);const{data:i,error:n}=await a.select().single();if(n)throw n;return i},async delete(e,r){let o=g.from("email_templates").delete().eq("id",r).eq("is_default",!1);o=H(o,e);const{error:a}=await o;if(a)throw a;return!0},async duplicate(e,r){const o=await this.getById(e,r),a=xe(e),{data:i,error:n}=await g.from("email_templates").insert({owner_id:a,is_default:!1,default_key:null,name:`${o.name} (Copy)`,subject:o.subject,body_html:o.body_html,body_text:o.body_text,category:o.category,merge_fields:o.merge_fields}).select().single();if(n)throw n;return i},async getByCategory(e,r){let o=g.from("email_templates").select("*").eq("category",r).order("is_default",{ascending:!1}).order("name");o=H(o,e);const{data:a,error:i}=await o;if(i)throw i;return a},async getCategories(e){let r=g.from("email_templates").select("category").not("category","is",null);r=H(r,e);const{data:o,error:a}=await r;if(a)throw a;return[...new Set(o.map(i=>i.category))]},async resetToDefault(e,r){return this.getById(e,r)}};function ne(){const{userId:e}=le(),{impersonating:r,scopeFilter:o,getEffectiveOwnerIds:a}=ve(),i=a(),n=Array.isArray(i),s=n?i.length>0?i[0]:null:i,c=o.active?`${o.filterType}:${o.filterValue}`:r.active?`impersonate:${r.targetUserId}`:`user:${e}`;return{ownerId:s,ownerIds:n?i:i?[i]:[],isMultiOwner:n,filterKey:c,urlUserId:e}}function Je(e={}){const{ownerIds:r,filterKey:o}=ne();return oe({queryKey:["templates",o,e],queryFn:()=>we.getAll(r,e),enabled:r.length>0})}function Kt(){const{ownerIds:e,filterKey:r}=ne();return oe({queryKey:["templates",r,"categories"],queryFn:()=>we.getCategories(e),enabled:e.length>0})}function mt(){const{ownerIds:e,filterKey:r}=ne(),o=Me(),a=()=>{o.invalidateQueries({queryKey:["templates"]})},i=J({mutationFn:d=>we.create(e,d),onSuccess:a}),n=J({mutationFn:({templateId:d,updates:l})=>we.update(e,d,l),onSuccess:d=>{a(),o.setQueryData(["template",r,d.id],d)}}),s=J({mutationFn:d=>we.delete(e,d),onSuccess:a}),c=J({mutationFn:d=>we.duplicate(e,d),onSuccess:a});return{createTemplate:i,updateTemplate:n,deleteTemplate:s,duplicateTemplate:c}}const se={async getAll(e,r={}){const{status:o,category:a,search:i}=r;let n=g.from("automations").select(`
        *,
        _count:automation_enrollments(count)
      `).order("is_default",{ascending:!1}).order("name");n=H(n,e),o&&(n=n.eq("status",o)),a&&(n=n.eq("category",a)),i&&(n=n.or(`name.ilike.%${i}%,description.ilike.%${i}%`));const{data:s,error:c}=await n;if(c)throw c;return s},async getAllWithStats(e){let r=g.from("automations").select("*").order("is_default",{ascending:!1}).order("name");r=H(r,e);const{data:o,error:a}=await r;if(a)throw a;const i=o.map(d=>d.id),{data:n,error:s}=await g.from("automation_enrollments").select("automation_id, status").in("automation_id",i);if(s)throw s;const c={};return n.forEach(d=>{c[d.automation_id]||(c[d.automation_id]={total:0,active:0,completed:0,exited:0}),c[d.automation_id].total++,c[d.automation_id][d.status.toLowerCase()]++}),o.map(d=>({...d,enrollmentStats:c[d.id]||{total:0,active:0,completed:0,exited:0}}))},async getById(e,r){let o=g.from("automations").select("*").eq("id",r);o=H(o,e);const{data:a,error:i}=await o.single();if(i)throw i;return a},async getByIdWithDetails(e,r){const o=await this.getById(e,r),{data:a,error:i}=await g.from("automation_enrollments").select("status").eq("automation_id",r);if(i)throw i;const n={total:a.length,active:a.filter(l=>l.status==="Active").length,completed:a.filter(l=>l.status==="Completed").length,exited:a.filter(l=>l.status==="Exited").length,paused:a.filter(l=>l.status==="Paused").length},{data:s,error:c}=await g.from("email_logs").select("status, open_count, click_count").eq("automation_id",r);if(c)throw c;const d={sent:s.length,delivered:s.filter(l=>l.status==="Delivered"||l.status==="Opened"||l.status==="Clicked").length,opened:s.filter(l=>l.open_count>0).length,clicked:s.filter(l=>l.click_count>0).length,bounced:s.filter(l=>l.status==="Bounced").length};return{...o,enrollmentStats:n,emailSummary:d}},async getByDefaultKey(e,r){let o=g.from("automations").select("*").eq("default_key",r);o=H(o,e);const{data:a,error:i}=await o.single();if(i)throw i;return a},async create(e,r){const o=xe(e),{data:a,error:i}=await g.from("automations").insert({owner_id:o,is_default:!1,status:"Draft",...r}).select().single();if(i)throw i;return a},async update(e,r,o){let a=g.from("automations").update({...o,updated_at:new Date().toISOString()}).eq("id",r);a=H(a,e);const{data:i,error:n}=await a.select().single();if(n)throw n;return i},async updateStatus(e,r,o){return this.update(e,r,{status:o})},async activate(e,r){return this.updateStatus(e,r,"active")},async pause(e,r){return this.updateStatus(e,r,"paused")},async archive(e,r){return this.updateStatus(e,r,"archived")},async delete(e,r){let o=g.from("automations").delete().eq("id",r).eq("is_default",!1);o=H(o,e);const{error:a}=await o;if(a)throw a;return!0},async duplicate(e,r){const o=await this.getById(e,r),a=xe(e),{data:i,error:n}=await g.from("automations").insert({owner_id:a,is_default:!1,default_key:null,name:`${o.name} (Copy)`,description:o.description,category:o.category,status:"Draft",send_time:o.send_time,timezone:o.timezone,frequency:o.frequency,max_enrollments:o.max_enrollments,enrollment_cooldown_days:o.enrollment_cooldown_days,distribute_evenly:o.distribute_evenly,filter_config:o.filter_config,nodes:o.nodes}).select().single();if(n)throw n;return i},async updateFilters(e,r,o){return this.update(e,r,{filter_config:o})},async updateNodes(e,r,o){return this.update(e,r,{nodes:o})},async updateSchedule(e,r,o){const{sendTime:a,timezone:i,frequency:n}=o;return this.update(e,r,{send_time:a,timezone:i,frequency:n})},async updateEnrollmentRules(e,r,o){const{maxEnrollments:a,cooldownDays:i,distributeEvenly:n}=o;return this.update(e,r,{max_enrollments:a,enrollment_cooldown_days:i,distribute_evenly:n})},async getByStatus(e,r){let o=g.from("automations").select("*").eq("status",r).order("name");o=H(o,e);const{data:a,error:i}=await o;if(i)throw i;return a},async getActive(e){return this.getByStatus(e,"Active")},async getCategories(e){let r=g.from("automations").select("category").not("category","is",null);r=H(r,e);const{data:o,error:a}=await r;if(a)throw a;return[...new Set(o.map(i=>i.category))]}};function Vt(){const{ownerIds:e,filterKey:r}=ne();return oe({queryKey:["automations",r,"withStats"],queryFn:()=>se.getAllWithStats(e),enabled:e.length>0})}function Qt(e){const{ownerIds:r,filterKey:o}=ne();return oe({queryKey:["automation",o,e],queryFn:()=>se.getById(r,e),enabled:r.length>0&&!!e})}function ht(){const{ownerIds:e,filterKey:r}=ne(),o=Me(),a=()=>{o.invalidateQueries({queryKey:["automations"]})},i=J({mutationFn:x=>se.create(e,x),onSuccess:a}),n=J({mutationFn:({automationId:x,updates:b})=>se.update(e,x,b),onSuccess:x=>{a(),o.setQueryData(["automation",r,x.id],x)}}),s=J({mutationFn:x=>se.delete(e,x),onSuccess:a}),c=J({mutationFn:x=>se.duplicate(e,x),onSuccess:a}),d=J({mutationFn:x=>se.activate(e,x),onSuccess:x=>{a(),o.setQueryData(["automation",r,x.id],x)}}),l=J({mutationFn:x=>se.pause(e,x),onSuccess:x=>{a(),o.setQueryData(["automation",r,x.id],x)}}),h=J({mutationFn:x=>se.archive(e,x),onSuccess:a}),y=J({mutationFn:({automationId:x,filterConfig:b})=>se.updateFilters(e,x,b),onSuccess:x=>{o.setQueryData(["automation",r,x.id],x)}}),p=J({mutationFn:({automationId:x,nodes:b})=>se.updateNodes(e,x,b),onSuccess:x=>{o.setQueryData(["automation",r,x.id],x)}}),v=J({mutationFn:({automationId:x,scheduleConfig:b})=>se.updateSchedule(e,x,b),onSuccess:x=>{o.setQueryData(["automation",r,x.id],x)}}),R=J({mutationFn:({automationId:x,rules:b})=>se.updateEnrollmentRules(e,x,b),onSuccess:x=>{o.setQueryData(["automation",r,x.id],x)}});return{createAutomation:i,updateAutomation:n,deleteAutomation:s,duplicateAutomation:c,activateAutomation:d,pauseAutomation:l,archiveAutomation:h,updateFilters:y,updateNodes:p,updateSchedule:v,updateEnrollmentRules:R}}const Yt={async getByAutomation(e,r={}){const{status:o,limit:a=50,offset:i=0}=r;let n=g.from("automation_enrollments").select(`
        *,
        account:accounts(
          account_unique_id,
          name,
          person_email,
          email,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("automation_id",e).order("enrolled_at",{ascending:!1}).range(i,i+a-1);o&&(n=n.eq("status",o));const{data:s,error:c}=await n;if(c)throw c;return s},async getByAccount(e,r={}){const{status:o}=r;let a=g.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category, status)
      `).eq("account_id",e).order("enrolled_at",{ascending:!1});o&&(a=a.eq("status",o));const{data:i,error:n}=await a;if(n)throw n;return i},async getById(e){const{data:r,error:o}=await g.from("automation_enrollments").select(`
        *,
        account:accounts(*),
        automation:automations(*)
      `).eq("id",e).single();if(o)throw o;return r},async getStats(e){const{data:r,error:o}=await g.from("automation_enrollments").select("status, emails_sent, emails_opened, emails_clicked").eq("automation_id",e);if(o)throw o;const a={total:r.length,active:0,completed:0,exited:0,paused:0,totalEmailsSent:0,totalOpens:0,totalClicks:0};return r.forEach(i=>{a[i.status.toLowerCase()]++,a.totalEmailsSent+=i.emails_sent||0,a.totalOpens+=i.emails_opened||0,a.totalClicks+=i.emails_clicked||0}),a},async canEnroll(e,r){const{data:o,error:a}=await g.rpc("can_enroll_in_automation",{p_account_id:e,p_automation_id:r});if(a)throw a;return o},async enroll(e,r,o={}){var l;if(!await this.canEnroll(r,e))throw new Error("Account cannot be enrolled in this automation");const{data:i,error:n}=await g.from("automations").select("nodes").eq("id",e).single();if(n)throw n;const s=(l=i.nodes)==null?void 0:l[0],{data:c,error:d}=await g.from("automation_enrollments").insert({automation_id:e,account_id:r,status:"Active",current_node_id:(s==null?void 0:s.id)||null,metadata:o}).select().single();if(d)throw d;return c},async bulkEnroll(e,r){const o={enrolled:[],skipped:[],errors:[]};for(const a of r)try{if(await this.canEnroll(a,e)){const n=await this.enroll(e,a);o.enrolled.push(n)}else o.skipped.push(a)}catch(i){o.errors.push({accountId:a,error:i.message})}return o},async exit(e,r="manual"){const{data:o,error:a}=await g.from("automation_enrollments").update({status:"Exited",exit_reason:r,exited_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();if(a)throw a;return o},async pause(e){const{data:r,error:o}=await g.from("automation_enrollments").update({status:"Paused",updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;return r},async resume(e){const{data:r,error:o}=await g.from("automation_enrollments").update({status:"Active",updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;return r},async complete(e){const{data:r,error:o}=await g.from("automation_enrollments").update({status:"Completed",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;return r},async updateProgress(e,r,o=null){const{data:a,error:i}=await g.from("automation_enrollments").update({current_node_id:r,current_branch:o,last_action_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;return a},async setNextAction(e,r){const{data:o,error:a}=await g.from("automation_enrollments").update({next_action_at:r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(a)throw a;return o},async incrementEmailSent(e){const{data:r,error:o}=await g.rpc("increment_enrollment_email_sent",{p_enrollment_id:e});if(o){const{data:a}=await g.from("automation_enrollments").select("emails_sent").eq("id",e).single();return g.from("automation_enrollments").update({emails_sent:((a==null?void 0:a.emails_sent)||0)+1}).eq("id",e)}return r},async getReadyForAction(){const{data:e,error:r}=await g.from("automation_enrollments").select(`
        *,
        automation:automations(*),
        account:accounts(*)
      `).eq("status","Active").lte("next_action_at",new Date().toISOString()).order("next_action_at");if(r)throw r;return e},async getHistory(e){const{data:r,error:o}=await g.from("enrollment_history").select(`
        *,
        email_log:email_logs(id, subject, status, sent_at, first_opened_at, first_clicked_at)
      `).eq("enrollment_id",e).order("created_at",{ascending:!0});if(o)throw o;return r},async logHistory(e,r){const{data:o,error:a}=await g.from("enrollment_history").insert({enrollment_id:e,...r}).select().single();if(a)throw a;return o}};function Jt(e,r={}){return oe({queryKey:["enrollments","account",e,r],queryFn:()=>Yt.getByAccount(e,r),enabled:!!e,staleTime:3e4})}const Oe={async getAll(e,r={}){const{status:o,automationId:a,accountId:i,limit:n=50,offset:s=0,startDate:c,endDate:d}=r;let l=g.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email, primary_contact_first_name),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).order("created_at",{ascending:!1}).range(s,s+n-1);l=H(l,e),o&&(l=l.eq("status",o)),a&&(l=l.eq("automation_id",a)),i&&(l=l.eq("account_id",i)),c&&(l=l.gte("sent_at",c)),d&&(l=l.lte("sent_at",d));const{data:h,error:y}=await l;if(y)throw y;return h},async getById(e,r){let o=g.from("email_logs").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name),
        enrollment:automation_enrollments(id, status)
      `).eq("id",r);o=H(o,e);const{data:a,error:i}=await o.single();if(i)throw i;return a},async getByIdWithEvents(e,r){const o=await this.getById(e,r),{data:a,error:i}=await g.from("email_events").select("*").eq("email_log_id",r).order("event_timestamp",{ascending:!0});if(i)throw i;return{...o,events:a}},async getByAccount(e,r,o={}){const{limit:a=20}=o;let i=g.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("account_id",r).order("created_at",{ascending:!1}).limit(a);i=H(i,e);const{data:n,error:s}=await i;if(s)throw s;return n},async getByAutomation(e,r,o={}){const{limit:a=50,offset:i=0,status:n}=o;let s=g.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("automation_id",r).order("created_at",{ascending:!1}).range(i,i+a-1);s=H(s,e),n&&(s=s.eq("status",n));const{data:c,error:d}=await s;if(d)throw d;return c},async create(e,r){const o=xe(e),{data:a,error:i}=await g.from("email_logs").insert({owner_id:o,status:"Queued",...r}).select().single();if(i)throw i;return a},async updateStatus(e,r,o,a={}){let i=g.from("email_logs").update({status:o,...a,updated_at:new Date().toISOString()}).eq("id",r);i=H(i,e);const{data:n,error:s}=await i.select().single();if(s)throw s;return n},async markSent(e,r,o){return this.updateStatus(e,r,"Sent",{sent_at:new Date().toISOString(),sendgrid_message_id:o})},async markFailed(e,r,o,a=null){return this.updateStatus(e,r,"Failed",{failed_at:new Date().toISOString(),error_message:o,error_code:a})},async getRecentOpens(e,r=10){let o=g.from("email_logs").select(`
        id, subject, first_opened_at, open_count,
        account:accounts(account_unique_id, name, person_email)
      `).not("first_opened_at","is",null).order("first_opened_at",{ascending:!1}).limit(r);o=H(o,e);const{data:a,error:i}=await o;if(i)throw i;return a},async getRecentClicks(e,r=10){let o=g.from("email_logs").select(`
        id, subject, first_clicked_at, click_count,
        account:accounts(account_unique_id, name, person_email)
      `).not("first_clicked_at","is",null).order("first_clicked_at",{ascending:!1}).limit(r);o=H(o,e);const{data:a,error:i}=await o;if(i)throw i;return a},async getBounces(e,r={}){const{limit:o=50,offset:a=0}=r;let i=g.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("status","Bounced").order("bounced_at",{ascending:!1}).range(a,a+o-1);i=H(i,e);const{data:n,error:s}=await i;if(s)throw s;return n},async getStats(e,r,o,a=null){const i=xe(e),{data:n,error:s}=await g.rpc("get_email_stats",{p_owner_id:i,p_start_date:r,p_end_date:o,p_automation_id:a});if(s)throw s;return(n==null?void 0:n[0])||{total_sent:0,total_delivered:0,total_opened:0,unique_opens:0,total_clicked:0,unique_clicks:0,total_bounced:0,open_rate:0,click_rate:0}},async getDailyStats(e,r,o,a=null){let i=g.from("email_stats_daily").select("*").gte("stat_date",r).lte("stat_date",o).order("stat_date");i=H(i,e),a?i=i.eq("automation_id",a):i=i.is("automation_id",null);const{data:n,error:s}=await i;if(s)throw s;return n},async getComparisonStats(e,r=30){const o=new Date,a=new Date(o);a.setDate(a.getDate()-r);const i=new Date(a);i.setDate(i.getDate()-r);const[n,s]=await Promise.all([this.getStats(e,a.toISOString().split("T")[0],o.toISOString().split("T")[0]),this.getStats(e,i.toISOString().split("T")[0],a.toISOString().split("T")[0])]),c=(d,l)=>l===0?d>0?100:0:((d-l)/l*100).toFixed(1);return{current:n,previous:s,changes:{sent:c(n.total_sent,s.total_sent),delivered:c(n.total_delivered,s.total_delivered),opened:c(n.unique_opens,s.unique_opens),clicked:c(n.unique_clicks,s.unique_clicks),bounced:c(n.total_bounced,s.total_bounced)}}}};function Zt(e,r={}){const{ownerIds:o,filterKey:a}=ne();return oe({queryKey:["emailLogs",a,"account",e,r],queryFn:()=>Oe.getByAccount(o,e,r),enabled:o.length>0&&!!e,staleTime:3e4})}const bt={async getRecent(e,r={}){const{category:o,limit:a=20,offset:i=0}=r;let n=g.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name),
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).order("created_at",{ascending:!1}).range(i,i+a-1);n=H(n,e),o&&(n=n.eq("event_category",o));const{data:s,error:c}=await n;if(c)throw c;return s},async getByAccount(e,r,o=20){let a=g.from("activity_log").select(`
        *,
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).eq("account_id",r).order("created_at",{ascending:!1}).limit(o);a=H(a,e);const{data:i,error:n}=await a;if(n)throw n;return i},async getByAutomation(e,r,o=50){let a=g.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("automation_id",r).order("created_at",{ascending:!1}).limit(o);a=H(a,e);const{data:i,error:n}=await a;if(n)throw n;return i},async getByType(e,r,o={}){const{limit:a=50,offset:i=0}=o;let n=g.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("event_type",r).order("created_at",{ascending:!1}).range(i,i+a-1);n=H(n,e);const{data:s,error:c}=await n;if(c)throw c;return s},async log(e,r){const o=xe(e),{data:a,error:i}=await g.from("activity_log").insert({owner_id:o,...r}).select().single();if(i)throw i;return a},async logEmailSent(e,r,o,a=null){return this.log(e,{event_type:"email_sent",event_category:"email",title:"Email sent",email_log_id:r,account_id:o,automation_id:a,actor_type:a?"automation":"user"})},async logEmailOpened(e,r,o){return this.log(e,{event_type:"email_opened",event_category:"email",title:"Email opened",email_log_id:r,account_id:o,actor_type:"system"})},async logEmailClicked(e,r,o,a=null){return this.log(e,{event_type:"email_clicked",event_category:"email",title:"Email link clicked",email_log_id:r,account_id:o,actor_type:"system",event_data:a?{url:a}:{}})},async logEnrollment(e,r,o,a){return this.log(e,{event_type:"enrollment_created",event_category:"automation",title:`Enrolled in ${a}`,automation_id:r,account_id:o,actor_type:"automation"})},async logAutomationCompleted(e,r,o,a){return this.log(e,{event_type:"automation_completed",event_category:"automation",title:`Completed ${a}`,automation_id:r,account_id:o,actor_type:"automation"})},async logUnsubscribe(e,r,o,a=null){return this.log(e,{event_type:"unsubscribed",event_category:"account",title:o==="all"?"Unsubscribed from all emails":"Unsubscribed from automation",account_id:r,automation_id:a,actor_type:"system",severity:"warning"})},async logBounce(e,r,o,a){return this.log(e,{event_type:"email_bounced",event_category:"email",title:`Email bounced (${a})`,email_log_id:r,account_id:o,actor_type:"system",severity:"warning",event_data:{bounce_type:a}})},async getStats(e,r=7){const o=new Date;o.setDate(o.getDate()-r);let a=g.from("activity_log").select("event_type, event_category").gte("created_at",o.toISOString());a=H(a,e);const{data:i,error:n}=await a;if(n)throw n;const s={total:i.length,byType:{},byCategory:{}};return i.forEach(c=>{s.byType[c.event_type]=(s.byType[c.event_type]||0)+1,s.byCategory[c.event_category]=(s.byCategory[c.event_category]||0)+1}),s}},vt={async getAll(e,r={}){const{status:o,automationId:a,limit:i=50,offset:n=0}=r;let s=g.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).order("scheduled_for",{ascending:!0}).range(n,n+i-1);s=H(s,e),o&&(s=s.eq("status",o)),a&&(s=s.eq("automation_id",a));const{data:c,error:d}=await s;if(d)throw d;return c},async getUpcoming(e,r=10){let o=g.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        automation:automations(id, name)
      `).eq("status","Pending").gte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0}).limit(r);o=H(o,e);const{data:a,error:i}=await o;if(i)throw i;return a},async getReadyToSend(){const{data:e,error:r}=await g.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name, owner_id)
      `).eq("status","Pending").lte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0});if(r)throw r;return e},async getById(e,r){let o=g.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name)
      `).eq("id",r);o=H(o,e);const{data:a,error:i}=await o.single();if(i)throw i;return a},async create(e,r){const o=xe(e),{data:a,error:i}=await g.from("scheduled_emails").insert({owner_id:o,status:"Pending",...r}).select().single();if(i)throw i;return a},async createBatch(e,r){const o=xe(e),a=r.map(s=>({owner_id:o,status:"Pending",...s})),{data:i,error:n}=await g.from("scheduled_emails").insert(a).select();if(n)throw n;return i},async update(e,r,o){let a=g.from("scheduled_emails").update({...o,updated_at:new Date().toISOString()}).eq("id",r);a=H(a,e);const{data:i,error:n}=await a.select().single();if(n)throw n;return i},async cancel(e,r){return this.update(e,r,{status:"Cancelled"})},async reschedule(e,r,o){return this.update(e,r,{scheduled_for:o,status:"Pending",attempts:0})},async markProcessing(e){const{data:r,error:o}=await g.from("scheduled_emails").update({status:"Processing",last_attempt_at:new Date().toISOString(),attempts:g.sql`attempts + 1`,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;return r},async markSent(e,r){const{data:o,error:a}=await g.from("scheduled_emails").update({status:"Sent",email_log_id:r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(a)throw a;return o},async markFailed(e,r){const{data:o,error:a}=await g.from("scheduled_emails").select("attempts, max_attempts").eq("id",e).single();if(a)throw a;const i=o.attempts<o.max_attempts,{data:n,error:s}=await g.from("scheduled_emails").update({status:i?"Pending":"Failed",error_message:r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw s;return n},async delete(e,r){let o=g.from("scheduled_emails").delete().eq("id",r);o=H(o,e);const{error:a}=await o;if(a)throw a;return!0},async getStats(e){let r=g.from("scheduled_emails").select("status, scheduled_for");r=H(r,e);const{data:o,error:a}=await r;if(a)throw a;const i=new Date,n={pending:0,processing:0,sent:0,failed:0,cancelled:0,upcomingToday:0,upcomingThisWeek:0},s=new Date(i);s.setHours(23,59,59,999);const c=new Date(i);return c.setDate(c.getDate()+7),o.forEach(d=>{if(n[d.status.toLowerCase()]++,d.status==="Pending"){const l=new Date(d.scheduled_for);l<=s&&n.upcomingToday++,l<=c&&n.upcomingThisWeek++}}),n}},Te={async getAll(e,r={}){const{status:o,search:a,limit:i=25,offset:n=0,expiring:s=!1}=r;let c=g.from("accounts").select("*",{count:"exact",head:!0});if(c=H(c,e),o){let I=o;o.toLowerCase()==="prior"&&(I="prior_customer"),c=c.ilike("account_status",I)}a&&(c=c.or(`name.ilike.%${a}%,person_email.ilike.%${a}%,email.ilike.%${a}%`));const{count:d,error:l}=await c;if(l)throw l;let h=g.from("accounts").select("*").order("name").range(n,n+i-1);if(h=H(h,e),o){let I=o;o.toLowerCase()==="prior"&&(I="prior_customer"),h=h.ilike("account_status",I)}a&&(h=h.or(`name.ilike.%${a}%,person_email.ilike.%${a}%,email.ilike.%${a}%`));const{data:y,error:p}=await h;if(p)throw p;if(!y||y.length===0)return{accounts:[],total:d||0};const v=y.map(I=>I.account_unique_id).filter(Boolean),x=new Date().toISOString().split("T")[0],b=new Date;b.setDate(b.getDate()+30);const m=b.toISOString().split("T")[0];if(v.length>0){const{data:I,error:D}=await g.from("policies").select("account_id, policy_lob, policy_status, expiration_date").in("account_id",v);if(!D&&I){const E={};I.forEach(S=>{var W;E[S.account_id]||(E[S.account_id]=[]);const _=S.expiration_date&&S.expiration_date>=x&&S.expiration_date<=m;E[S.account_id].push({policy_type:S.policy_lob,status:((W=S.policy_status)==null?void 0:W.toLowerCase())||"unknown",expiration_date:S.expiration_date,is_expiring:_})}),y.forEach(S=>{S.policies=E[S.account_unique_id]||[],S.policy_count=S.policies.length,S.has_expiring_policy=S.policies.some(_=>_.is_expiring),S.expiring_policy_count=S.policies.filter(_=>_.is_expiring).length})}}if(s){const I=y.filter(D=>D.has_expiring_policy);return{accounts:I,total:I.length,isExpiringFilter:!0}}return{accounts:y,total:d||0}},async getStats(e){let r=g.from("accounts").select("*",{count:"exact",head:!0});r=H(r,e);const{count:o,error:a}=await r;if(a)throw a;let i=g.from("accounts").select("*",{count:"exact",head:!0}).ilike("account_status","customer");i=H(i,e);const{count:n}=await i;let s=g.from("accounts").select("*",{count:"exact",head:!0}).ilike("account_status","prospect");s=H(s,e);const{count:c}=await s;let d=g.from("accounts").select("*",{count:"exact",head:!0}).ilike("account_status","prior_customer");d=H(d,e);const{count:l}=await d;let h=g.from("accounts").select("*",{count:"exact",head:!0}).ilike("account_status","lead");h=H(h,e);const{count:y}=await h;let p=0;const v=new Date().toISOString().split("T")[0],R=new Date;R.setDate(R.getDate()+30);const x=R.toISOString().split("T")[0],{count:b}=await g.from("policies").select("*",{count:"exact",head:!0}).gte("expiration_date",v).lte("expiration_date",x);if(b&&b>0){const{data:m}=await g.from("policies").select("account_id").gte("expiration_date",v).lte("expiration_date",x).limit(5e3);if(m&&m.length>0){const I=[...new Set(m.map(D=>D.account_id).filter(Boolean))];if(I.length>0){let D=0;const E=100;for(let S=0;S<I.length;S+=E){const _=I.slice(S,S+E);let W=g.from("accounts").select("*",{count:"exact",head:!0}).in("account_unique_id",_);W=H(W,e);const{count:V}=await W;D+=V||0}p=D}}}return{Customer:n||0,Prospect:c||0,Prior:l||0,Lead:y||0,total:o||0,expiring:p}},async getById(e){const{data:r,error:o}=await g.from("accounts").select("*").eq("account_unique_id",e).single();if(o)throw o;return r},async getByIdWithPolicies(e){const{data:r,error:o}=await g.from("accounts").select("*").eq("account_unique_id",e).single();if(o)throw o;if(!r)return null;const{data:a,error:i}=await g.from("policies").select("*").eq("account_id",e).order("expiration_date",{ascending:!1});if(i)return console.error("Error fetching policies:",i),{...r,policies:[]};if(a&&a.length>0){const n=[...new Set(a.map(s=>s.carrier_id).filter(Boolean))];if(n.length>0){const{data:s,error:c}=await g.from("carriers").select("id, name").in("id",n);if(s&&s.length>0){const d={};s.forEach(l=>{d[l.id]=l.name}),a.forEach(l=>{l.carrier_id&&d[l.carrier_id]&&(l.carrier={name:d[l.carrier_id]})})}}}return{...r,policies:a||[]}},async getByIdWithEmailHistory(e,r){const o=await this.getByIdWithPolicies(r);let a=g.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("account_id",r).order("created_at",{ascending:!1}).limit(20);a=H(a,e);const{data:i,error:n}=await a;if(n)throw n;const{data:s,error:c}=await g.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category)
      `).eq("account_id",r).order("enrolled_at",{ascending:!1});if(c)throw c;return{...o,emailLogs:i,enrollments:s}},async search(e,r,o=20){let a=g.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name").or(`name.ilike.%${r}%,person_email.ilike.%${r}%,email.ilike.%${r}%,primary_contact_first_name.ilike.%${r}%,primary_contact_last_name.ilike.%${r}%`).limit(o);a=H(a,e);const{data:i,error:n}=await a;if(n)throw n;return i},async getByStatus(e,r,o={}){const{limit:a=50,offset:i=0}=o;let n=g.from("accounts").select("*").eq("account_status",r).order("name").range(i,i+a-1);n=H(n,e);const{data:s,error:c}=await n;if(c)throw c;return s},async getCustomers(e,r={}){return this.getByStatus(e,"customer",r)},async getProspects(e,r={}){return this.getByStatus(e,"prospect",r)},async getPriorCustomers(e,r={}){return this.getByStatus(e,"prior_customer",r)},async getWithExpiringPolicies(e,r=45){const o=new Date;o.setDate(o.getDate()+r);const a=Gt(e),{data:i,error:n}=await g.from("policies").select(`
        policy_unique_id,
        policy_lob,
        expiration_date,
        policy_status,
        account_id,
        account:accounts!policies_account_id_fkey(
          account_unique_id,
          name,
          person_email,
          email,
          owner_id,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("policy_status","Active").lte("expiration_date",o.toISOString().split("T")[0]).gte("expiration_date",new Date().toISOString().split("T")[0]).order("expiration_date");if(n)throw n;return i.filter(s=>{var c;return((c=s.account)==null?void 0:c.owner_id)&&a.includes(s.account.owner_id)})},async getCounts(e){let r=g.from("accounts").select("account_status");r=H(r,e);const{data:o,error:a}=await r;if(a)throw a;const i={total:o.length,customer:0,prospect:0,prior_customer:0,other:0};return o.forEach(n=>{var c;const s=((c=n.account_status)==null?void 0:c.toLowerCase().replace(" ","_"))||"other";i[s]!==void 0?i[s]++:i.other++}),i},getEmail(e){return e.person_email||e.email},getDisplayName(e){return e.primary_contact_first_name?`${e.primary_contact_first_name} ${e.primary_contact_last_name||""}`.trim():e.name},canReceiveMarketing(e){return e.user_subscribed_to_marketing!==!1&&e.person_has_opted_out_of_email!==!0&&(e.person_email||e.email)},async getEligibleForAutomation(e,r){let o=g.from("accounts").select("*").or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false").not("person_email","is",null);o=H(o,e);const{data:a,error:i}=await o;if(i)throw i;const n=a.map(l=>l.account_unique_id),{data:s,error:c}=await g.from("policies").select("*").in("account_id",n);if(c)throw c;return a.map(l=>({...l,policies:s.filter(h=>h.account_id===l.account_unique_id)})).filter(l=>this.canReceiveMarketing(l))}},_t={async getDashboardData(e,r={}){const{days:o=30}=r,[a,i,n,s,c,d,l]=await Promise.all([Oe.getComparisonStats(e,o),bt.getRecent(e,{limit:10}),vt.getUpcoming(e,5),Oe.getRecentOpens(e,5),Oe.getRecentClicks(e,5),Te.getCounts(e),this.getAutomationStats(e)]);return{emailStats:a.current,emailChanges:a.changes,recentActivity:i,scheduledEmails:n,recentOpens:s,recentClicks:c,accountCounts:d,automationStats:l}},async getAutomationStats(e){let r=g.from("automations").select(`
        id,
        name,
        status,
        stats
      `).eq("status","Active");r=H(r,e);const{data:o,error:a}=await r;if(a)throw a;const i=o.map(d=>d.id),{data:n,error:s}=await g.from("automation_enrollments").select("automation_id, status").in("automation_id",i);if(s)throw s;const c={};return n.forEach(d=>{c[d.automation_id]||(c[d.automation_id]={active:0,total:0}),c[d.automation_id].total++,d.status==="Active"&&c[d.automation_id].active++}),{total:o.length,active:o.filter(d=>d.status==="Active").length,automations:o.map(d=>{var l,h;return{...d,enrollmentCount:((l=c[d.id])==null?void 0:l.total)||0,activeEnrollments:((h=c[d.id])==null?void 0:h.active)||0}})}},async getEmailPerformanceOverTime(e,r=30){const o=new Date;o.setDate(o.getDate()-r);let a=g.from("email_stats_daily").select("*").is("automation_id",null).gte("stat_date",o.toISOString().split("T")[0]).order("stat_date");a=H(a,e);const{data:i,error:n}=await a;if(n)throw n;return i},async getTopAutomations(e,r=5){let o=g.from("automations").select("id, name, stats").eq("status","Active");o=H(o,e);const{data:a,error:i}=await o;if(i)throw i;return a.map(s=>{var c,d,l,h,y;return{...s,sent:((c=s.stats)==null?void 0:c.sent)||0,opened:((d=s.stats)==null?void 0:d.opened)||0,clicked:((l=s.stats)==null?void 0:l.clicked)||0,openRate:((h=s.stats)==null?void 0:h.sent)>0?(((y=s.stats)==null?void 0:y.opened)||0)/s.stats.sent*100:0}}).sort((s,c)=>c.openRate-s.openRate).slice(0,r)},async getAccountsNeedingAttention(e){let r=g.from("email_logs").select(`
        account:accounts(account_unique_id, name, person_email)
      `).eq("status","Bounced").not("account_id","is",null).limit(10);r=H(r,e);const{data:o,error:a}=await r;if(a)throw a;const i=await Te.getWithExpiringPolicies(e,30);return{bouncedEmails:o.map(n=>n.account).filter((n,s,c)=>c.findIndex(d=>d.account_unique_id===n.account_unique_id)===s),expiringPolicies:i.slice(0,10)}},async getQuickStats(e){const r=new Date().toISOString().split("T")[0],o=new Date;o.setDate(o.getDate()-30);let a=g.from("email_logs").select("*",{count:"exact",head:!0}).gte("sent_at",r);a=H(a,e);let i=g.from("email_logs").select("*",{count:"exact",head:!0}).gte("first_opened_at",r);i=H(i,e);let n=g.from("automations").select("*",{count:"exact",head:!0}).eq("status","Active");n=H(n,e);let s=g.from("scheduled_emails").select("*",{count:"exact",head:!0}).eq("status","Pending");s=H(s,e);const[{count:c},{count:d},{count:l},{count:h}]=await Promise.all([a,i,n,s]);return{emailsToday:c||0,opensToday:d||0,activeAutomations:l||0,pendingScheduled:h||0}}};function jt(){const{ownerIds:e,filterKey:r}=ne();return oe({queryKey:["dashboard",r,"quick"],queryFn:()=>_t.getQuickStats(e),enabled:e.length>0,staleTime:1e4,refetchInterval:3e4})}function Xt(e=30){const{ownerIds:r,filterKey:o}=ne();return oe({queryKey:["dashboard",o,"performance",e],queryFn:()=>_t.getEmailPerformanceOverTime(r,e),enabled:r.length>0})}const St=()=>{const{userId:e}=le();return e};function eo(){const e=St();return oe({queryKey:["userSettings",e],queryFn:()=>he.get(e),enabled:!!e})}function to(){const e=St(),r=Me(),o=()=>{r.invalidateQueries({queryKey:["userSettings",e]})},a=J({mutationFn:d=>he.update(e,d),onSuccess:o}),i=J({mutationFn:d=>he.updateSignature(e,d),onSuccess:o}),n=J({mutationFn:d=>he.updateAgencyInfo(e,d),onSuccess:o}),s=J({mutationFn:d=>he.updateEmailSettings(e,d),onSuccess:o}),c=J({mutationFn:d=>he.updatePreferences(e,d),onSuccess:o});return{updateSettings:a,updateSignature:i,updateAgencyInfo:n,updateEmailSettings:s,updatePreferences:c}}function oo(e={}){const{ownerIds:r,filterKey:o}=ne();return oe({queryKey:["accounts",o,e],queryFn:()=>Te.getAll(r,e),enabled:r.length>0,staleTime:3e4})}function ro(e){return oe({queryKey:["account",e,"policies"],queryFn:()=>Te.getByIdWithPolicies(e),enabled:!!e,staleTime:3e4})}function no(){const{ownerIds:e,filterKey:r}=ne();return oe({queryKey:["accounts",r,"stats"],queryFn:()=>Te.getStats(e),enabled:e.length>0})}const ao=()=>{const{userId:e}=le();return e};function io(e,r=20){const o=ao();return oe({queryKey:["activity",o,"account",e],queryFn:()=>bt.getByAccount(o,e,r),enabled:!!o&&!!e,staleTime:3e4})}function so(e=10){const{ownerIds:r,filterKey:o}=ne();return oe({queryKey:["scheduledEmails",o,"upcoming",e],queryFn:()=>vt.getUpcoming(r,e),enabled:r.length>0})}const lo=(e,r,o,a)=>{const n=(o-e)*Math.PI/180,s=(a-r)*Math.PI/180,c=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 3959*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))},De={},co=async e=>De[e]?De[e]:(console.warn("Google Maps API key not configured"),De[e]=null,null),po=async(e,r=10)=>{const o={},a=[...new Set(e.filter(Boolean))],i=[];for(const n of a)De[n]?o[n]=De[n]:i.push(n);if(i.length===0)return o;for(let n=0;n<i.length;n+=r){const s=i.slice(n,n+r),c=await Promise.all(s.map(d=>co(d)));s.forEach((d,l)=>{c[l]&&(o[d]=c[l])})}return o},be={async getAll(e,r={}){const{status:o,limit:a=50,offset:i=0}=r;let n=g.from("mass_email_batches").select(`
        *,
        template:email_templates(id, name, subject)
      `).order("created_at",{ascending:!1}).range(i,i+a-1);n=H(n,e),o&&(n=n.eq("status",o));const{data:s,error:c}=await n;if(c)throw c;return s},async getById(e,r){let o=g.from("mass_email_batches").select(`
        *,
        template:email_templates(*)
      `).eq("id",r);o=H(o,e);const{data:a,error:i}=await o.single();if(i)throw i;return a},async create(e,r){const o=xe(e),{data:a,error:i}=await g.from("mass_email_batches").insert({owner_id:o,status:"Draft",...r}).select().single();if(i)throw i;return a},async update(e,r,o){let a=g.from("mass_email_batches").update({...o,updated_at:new Date().toISOString()}).eq("id",r);a=H(a,e);const{data:i,error:n}=await a.select().single();if(n)throw n;return i},async delete(e,r){let o=g.from("mass_email_batches").delete().eq("id",r).eq("status","Draft");o=H(o,e);const{error:a}=await o;if(a)throw a;return!0},async getRecipients(e,r,o={}){const{limit:a=100,offset:i=0}=o,{rules:n=[],groups:s=[],notOptedOut:c=!0,search:d=""}=r||{};let l=s.length>0?s:n.length>0?[{rules:n}]:[];const h=Array.isArray(e)?e:[e];let y=g.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name, person_has_opted_out_of_email, billing_city, billing_state, billing_postal_code, billing_street, created_at").in("owner_id",h);c&&(y=y.or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false")),d&&(y=y.or(`name.ilike.%${d}%,person_email.ilike.%${d}%,email.ilike.%${d}%`)),l.length===0?y=y.order("name").range(i,i+a-1):y=y.order("name").limit(1e4);const{data:p,error:v}=await y;if(v)throw v;let R=p.filter(L=>{const N=L.person_email||L.email;return N&&N.includes("@")});if(l.length===0)return R;const x=l.some(L=>(L.rules||[]).some(O=>["policy_type","active_policy_type","policy_status","policy_count","policy_expiration","policy_effective","policy_class"].includes(O.field)&&O.value));let b={};if(x&&R.length>0){const L=R.map(B=>B.account_unique_id),{data:N,error:O}=await g.from("policies").select("account_id, policy_lob, expiration_date, effective_date, policy_status").in("account_id",L);if(O)throw O;N.forEach(B=>{b[B.account_id]||(b[B.account_id]=[]),b[B.account_id].push(B)})}let m={};if(R.length>0){const L=R.map(B=>B.account_unique_id),{data:N,error:O}=await g.from("email_logs").select("account_id, sent_at").in("account_id",L).eq("status","sent").order("sent_at",{ascending:!1});if(O)throw O;N==null||N.forEach(B=>{!m[B.account_id]&&B.sent_at&&(m[B.account_id]=B.sent_at)})}const I=l.some(L=>(L.rules||[]).some(O=>O.field==="location"&&O.value));let D={};if(I&&R.length>0){const L={};R.forEach(O=>{const B=(O.billing_postal_code||"").trim(),u=(O.billing_city||"").trim(),A=(O.billing_state||"").trim();let G="";B&&A?G=`${B}, ${A}, USA`:u&&A?G=`${u}, ${A}, USA`:B&&(G=`${B}, USA`),G&&(L[O.account_unique_id]=G)});const N=[...new Set(Object.values(L))];D=await po(N),R.forEach(O=>{O._locationKey=L[O.account_unique_id]})}const E=(L,N,O)=>{const{field:B,operator:u,value:A,value2:G,radius:Q}=N;if(!B||!u||!["is_empty","is_not_empty"].includes(u)&&!A)return!0;switch(B){case"account_status":{const $=(L.account_status||"").toLowerCase();return u==="is"?$===A.toLowerCase():u==="is_not"?$!==A.toLowerCase():u==="is_any"?A.split(",").map(f=>f.toLowerCase()).includes($):u==="is_not_any"?!A.split(",").map(f=>f.toLowerCase()).includes($):!0}case"policy_type":{const $=["is_any","is_not_any"].includes(u)?A.split(","):[A],w=O.some(f=>$.some(z=>{var j;return(j=f.policy_lob)==null?void 0:j.toLowerCase().includes(z.toLowerCase())}));return u==="is"||u==="is_any"?w:u==="is_not"||u==="is_not_any"?!w:!0}case"active_policy_type":{const $=["is_any","is_not_any"].includes(u)?A.split(","):[A],f=O.filter(z=>{var M;return((M=z.policy_status)==null?void 0:M.toLowerCase().trim())==="active"}).some(z=>$.some(j=>{var M;return(M=z.policy_lob)==null?void 0:M.toLowerCase().includes(j.toLowerCase())}));return u==="is"||u==="is_any"?f:u==="is_not"||u==="is_not_any"?!f:!0}case"policy_status":{const $=["is_any","is_not_any"].includes(u)?A.split(","):[A],w=O.some(f=>$.some(z=>{var j;return((j=f.policy_status)==null?void 0:j.toLowerCase())===z.toLowerCase()}));return u==="is"||u==="is_any"?w:u==="is_not"||u==="is_not_any"?!w:!0}case"policy_class":{const $=["is_any","is_not_any"].includes(u)?A.split(","):[A],w=O.some(f=>$.some(z=>{var j;return((j=f.policy_class)==null?void 0:j.toLowerCase())===z.toLowerCase()}));return u==="is"||u==="is_any"?w:u==="is_not"||u==="is_not_any"?!w:!0}case"policy_count":{const $=O.length,w=parseInt(A,10),f=G?parseInt(G,10):w;return u==="equals"?$===w:u==="greater_than"?$>w:u==="less_than"?$<w:u==="at_least"?$>=w:u==="at_most"?$<=w:u==="between"?$>=w&&$<=f:!0}case"policy_expiration":{const $=O.filter(f=>{var z;return((z=f.policy_status)==null?void 0:z.toLowerCase().trim())==="active"}),w=new Date().toISOString().split("T")[0];if(u==="in_next_days"){const f=parseInt(A,10),z=new Date;z.setDate(z.getDate()+f);const j=z.toISOString().split("T")[0];return $.some(M=>M.expiration_date&&M.expiration_date>=w&&M.expiration_date<=j)}if(u==="in_last_days"){const f=parseInt(A,10),z=new Date;z.setDate(z.getDate()-f);const j=z.toISOString().split("T")[0];return $.some(M=>M.expiration_date&&M.expiration_date>=j&&M.expiration_date<=w)}if(u==="more_than_days_future"){const f=parseInt(A,10),z=new Date;z.setDate(z.getDate()+f);const j=z.toISOString().split("T")[0];return $.some(M=>M.expiration_date&&M.expiration_date>j)}if(u==="less_than_days_future"){const f=parseInt(A,10),z=new Date;z.setDate(z.getDate()+f);const j=z.toISOString().split("T")[0];return $.some(M=>M.expiration_date&&M.expiration_date>=w&&M.expiration_date<j)}if(u==="more_than_days_ago"){const f=parseInt(A,10),z=new Date;z.setDate(z.getDate()-f);const j=z.toISOString().split("T")[0];return $.some(M=>M.expiration_date&&M.expiration_date<j)}if(u==="less_than_days_ago"){const f=parseInt(A,10),z=new Date;z.setDate(z.getDate()-f);const j=z.toISOString().split("T")[0];return $.some(M=>M.expiration_date&&M.expiration_date>=j&&M.expiration_date<=w)}return u==="before"?$.some(f=>f.expiration_date&&f.expiration_date<A):u==="after"?$.some(f=>f.expiration_date&&f.expiration_date>A):u==="between"?$.some(f=>f.expiration_date&&f.expiration_date>=A&&f.expiration_date<=(G||A)):!0}case"policy_effective":{const $=O.filter(f=>{var z;return((z=f.policy_status)==null?void 0:z.toLowerCase().trim())==="active"}),w=new Date().toISOString().split("T")[0];if(u==="in_next_days"){const f=parseInt(A,10),z=new Date;z.setDate(z.getDate()+f);const j=z.toISOString().split("T")[0];return $.some(M=>M.effective_date&&M.effective_date>=w&&M.effective_date<=j)}if(u==="in_last_days"){const f=parseInt(A,10),z=new Date;z.setDate(z.getDate()-f);const j=z.toISOString().split("T")[0];return $.some(M=>M.effective_date&&M.effective_date>=j&&M.effective_date<=w)}if(u==="more_than_days_future"){const f=parseInt(A,10),z=new Date;z.setDate(z.getDate()+f);const j=z.toISOString().split("T")[0];return $.some(M=>M.effective_date&&M.effective_date>j)}if(u==="less_than_days_future"){const f=parseInt(A,10),z=new Date;z.setDate(z.getDate()+f);const j=z.toISOString().split("T")[0];return $.some(M=>M.effective_date&&M.effective_date>=w&&M.effective_date<j)}if(u==="more_than_days_ago"){const f=parseInt(A,10),z=new Date;z.setDate(z.getDate()-f);const j=z.toISOString().split("T")[0];return $.some(M=>M.effective_date&&M.effective_date<j)}if(u==="less_than_days_ago"){const f=parseInt(A,10),z=new Date;z.setDate(z.getDate()-f);const j=z.toISOString().split("T")[0];return $.some(M=>M.effective_date&&M.effective_date>=j&&M.effective_date<=w)}return u==="before"?$.some(f=>f.effective_date&&f.effective_date<A):u==="after"?$.some(f=>f.effective_date&&f.effective_date>A):u==="between"?$.some(f=>f.effective_date&&f.effective_date>=A&&f.effective_date<=(G||A)):!0}case"state":{const $=(L.billing_state||"").toUpperCase();return u==="is"?$===A.toUpperCase():u==="is_not"?$!==A.toUpperCase():u==="is_any"?A.split(",").map(f=>f.toUpperCase()).includes($):u==="is_not_any"?!A.split(",").map(f=>f.toUpperCase()).includes($):!0}case"city":{const $=(L.billing_city||"").toLowerCase(),w=(A||"").toLowerCase();return u==="contains"?$.includes(w):u==="not_contains"?!$.includes(w):u==="equals"?$===w:u==="not_equals"?$!==w:u==="starts_with"?$.startsWith(w):u==="ends_with"?$.endsWith(w):u==="is_empty"?$.trim()==="":u==="is_not_empty"?$.trim()!=="":!0}case"zip_code":{const $=(L.billing_postal_code||"").toLowerCase().trim(),w=(A||"").toLowerCase().trim();return u==="contains"?$.includes(w):u==="not_contains"?!$.includes(w):u==="equals"?$===w:u==="not_equals"?$!==w:u==="starts_with"?$.startsWith(w):u==="ends_with"?$.endsWith(w):u==="is_empty"?$==="":u==="is_not_empty"?$!=="":!0}case"email_domain":{const $=(L.person_email||L.email||"").toLowerCase(),w=$.includes("@")?$.split("@")[1]:"",f=(A||"").toLowerCase().trim();return u==="contains"?w.includes(f):u==="not_contains"?!w.includes(f):u==="equals"?w===f:u==="not_equals"?w!==f:u==="starts_with"?w.startsWith(f):u==="ends_with"?w.endsWith(f):u==="is_empty"?w==="":u==="is_not_empty"?w!=="":!0}case"location":{if(u!=="within_radius"||!A)return!0;const[$,w]=A.split(",").map(parseFloat),f=parseInt(Q||"25",10),z=L._locationKey;if(!z)return!1;const j=D[z];return j?lo($,w,j.lat,j.lng)<=f:!1}case"last_email_sent":{const $=m[L.account_unique_id],w=new Date().toISOString().split("T")[0];if(!$)return u==="before"?!0:u==="in_last_days"||u==="less_than_days_ago"?!1:u==="more_than_days_ago"?!0:!(u==="in_next_days"||u==="more_than_days_future"||u==="less_than_days_future"||u==="after"||u==="between");const f=$.split("T")[0];if(u==="in_last_days"){const z=parseInt(A,10),j=new Date;j.setDate(j.getDate()-z);const M=j.toISOString().split("T")[0];return f>=M&&f<=w}if(u==="more_than_days_ago"){const z=parseInt(A,10),j=new Date;j.setDate(j.getDate()-z);const M=j.toISOString().split("T")[0];return f<M}if(u==="less_than_days_ago"){const z=parseInt(A,10),j=new Date;j.setDate(j.getDate()-z);const M=j.toISOString().split("T")[0];return f>=M&&f<=w}return u==="before"?f<A:u==="after"?f>A:u==="between"?f>=A&&f<=(G||A):!0}case"account_created":{const $=L.created_at;if(!$)return!1;const w=$.split("T")[0],f=new Date().toISOString().split("T")[0];if(u==="in_next_days"||u==="more_than_days_future"||u==="less_than_days_future")return!1;if(u==="in_last_days"){const z=parseInt(A,10),j=new Date;j.setDate(j.getDate()-z);const M=j.toISOString().split("T")[0];return w>=M&&w<=f}if(u==="more_than_days_ago"){const z=parseInt(A,10),j=new Date;j.setDate(j.getDate()-z);const M=j.toISOString().split("T")[0];return w<M}if(u==="less_than_days_ago"){const z=parseInt(A,10),j=new Date;j.setDate(j.getDate()-z);const M=j.toISOString().split("T")[0];return w>=M&&w<=f}return u==="before"?w<A:u==="after"?w>A:u==="between"?w>=A&&w<=(G||A):!0}default:return!0}},S=(L,N)=>{var Q,Z,$;const{field:O,operator:B,value:u,value2:A}=N,G=new Date().toISOString().split("T")[0];switch(O){case"active_policy_type":{if(((Q=L.policy_status)==null?void 0:Q.toLowerCase().trim())!=="active")return!1;const z=(["is_any","is_not_any"].includes(B)?u.split(","):[u]).some(j=>{var M;return(M=L.policy_lob)==null?void 0:M.toLowerCase().includes(j.toLowerCase())});return B==="is"||B==="is_any"?z:B==="is_not"||B==="is_not_any"?!z:!0}case"policy_type":{const f=(["is_any","is_not_any"].includes(B)?u.split(","):[u]).some(z=>{var j;return(j=L.policy_lob)==null?void 0:j.toLowerCase().includes(z.toLowerCase())});return B==="is"||B==="is_any"?f:B==="is_not"||B==="is_not_any"?!f:!0}case"policy_status":{const f=(["is_any","is_not_any"].includes(B)?u.split(","):[u]).some(z=>{var j;return((j=L.policy_status)==null?void 0:j.toLowerCase())===z.toLowerCase()});return B==="is"||B==="is_any"?f:B==="is_not"||B==="is_not_any"?!f:!0}case"policy_class":{const f=(["is_any","is_not_any"].includes(B)?u.split(","):[u]).some(z=>{var j;return((j=L.policy_class)==null?void 0:j.toLowerCase())===z.toLowerCase()});return B==="is"||B==="is_any"?f:B==="is_not"||B==="is_not_any"?!f:!0}case"policy_expiration":{if(((Z=L.policy_status)==null?void 0:Z.toLowerCase().trim())!=="active")return!1;const f=L.expiration_date;if(!f)return!1;if(B==="in_next_days"){const z=parseInt(u,10),j=new Date;j.setDate(j.getDate()+z);const M=j.toISOString().split("T")[0];return f>=G&&f<=M}if(B==="in_last_days"){const z=parseInt(u,10),j=new Date;j.setDate(j.getDate()-z);const M=j.toISOString().split("T")[0];return f>=M&&f<=G}if(B==="more_than_days_future"){const z=parseInt(u,10),j=new Date;j.setDate(j.getDate()+z);const M=j.toISOString().split("T")[0];return f>M}if(B==="less_than_days_future"){const z=parseInt(u,10),j=new Date;j.setDate(j.getDate()+z);const M=j.toISOString().split("T")[0];return f>=G&&f<M}if(B==="more_than_days_ago"){const z=parseInt(u,10),j=new Date;j.setDate(j.getDate()-z);const M=j.toISOString().split("T")[0];return f<M}if(B==="less_than_days_ago"){const z=parseInt(u,10),j=new Date;j.setDate(j.getDate()-z);const M=j.toISOString().split("T")[0];return f>=M&&f<=G}return B==="before"?f<u:B==="after"?f>u:B==="between"?f>=u&&f<=(A||u):!0}case"policy_effective":{if((($=L.policy_status)==null?void 0:$.toLowerCase().trim())!=="active")return!1;const f=L.effective_date;if(!f)return!1;if(B==="in_next_days"){const z=parseInt(u,10),j=new Date;j.setDate(j.getDate()+z);const M=j.toISOString().split("T")[0];return f>=G&&f<=M}if(B==="in_last_days"){const z=parseInt(u,10),j=new Date;j.setDate(j.getDate()-z);const M=j.toISOString().split("T")[0];return f>=M&&f<=G}if(B==="more_than_days_future"){const z=parseInt(u,10),j=new Date;j.setDate(j.getDate()+z);const M=j.toISOString().split("T")[0];return f>M}if(B==="less_than_days_future"){const z=parseInt(u,10),j=new Date;j.setDate(j.getDate()+z);const M=j.toISOString().split("T")[0];return f>=G&&f<M}if(B==="more_than_days_ago"){const z=parseInt(u,10),j=new Date;j.setDate(j.getDate()-z);const M=j.toISOString().split("T")[0];return f<M}if(B==="less_than_days_ago"){const z=parseInt(u,10),j=new Date;j.setDate(j.getDate()-z);const M=j.toISOString().split("T")[0];return f>=M&&f<=G}return B==="before"?f<u:B==="after"?f>u:B==="between"?f>=u&&f<=(A||u):!0}default:return!0}},_=["active_policy_type","policy_type","policy_status","policy_class","policy_expiration","policy_effective"],W=L=>["is_not","is_not_any"].includes(L.operator),V=(L,N)=>{const{field:O,operator:B,value:u}=N,A=["is_any","is_not_any"].includes(B)?u.split(","):[u];return O==="active_policy_type"?!L.filter(Z=>{var $;return(($=Z.policy_status)==null?void 0:$.toLowerCase().trim())==="active"}).some(Z=>A.some($=>{var w;return(w=Z.policy_lob)==null?void 0:w.toLowerCase().includes($.toLowerCase())})):O==="policy_type"?!L.some(Q=>A.some(Z=>{var $;return($=Q.policy_lob)==null?void 0:$.toLowerCase().includes(Z.toLowerCase())})):O==="policy_status"?!L.some(Q=>A.some(Z=>{var $;return(($=Q.policy_status)==null?void 0:$.toLowerCase())===Z.toLowerCase()})):O==="policy_class"?!L.some(Q=>A.some(Z=>{var $;return(($=Q.policy_class)==null?void 0:$.toLowerCase())===Z.toLowerCase()})):!0},T=(L,N)=>{const O=N.rules||[];if(O.length===0)return!0;const B=b[L.account_unique_id]||[],u=O.filter(w=>_.includes(w.field)&&w.operator&&w.value&&!W(w)),A=O.filter(w=>_.includes(w.field)&&w.operator&&w.value&&W(w));return!O.filter(w=>!_.includes(w.field)||!w.operator||!w.value).every(w=>E(L,w,B))||!A.every(w=>V(B,w))?!1:u.length===0?!0:B.some(w=>u.every(f=>S(w,f)))},q=new Set,P=[];for(const L of R){const N=[];l.forEach((O,B)=>{T(L,O)&&N.push(B)}),N.length>0&&!q.has(L.account_unique_id)&&(q.add(L.account_unique_id),P.push({...L,_matchedGroups:N,_lastEmailSent:m[L.account_unique_id]||null}))}return P.slice(i,i+a)},async getRecipientStats(e,r){const{rules:o=[],groups:a=[],notOptedOut:i=!0,search:n=""}=r||{},s=a.length>0?a:o.length>0?[{rules:o}]:[];s.length>0;const c=s.length>1,d=s.some(x=>(x.rules||[]).some(m=>["policy_type","active_policy_type","policy_status","policy_class","policy_count","policy_expiration","location","city","zip_code","email_domain"].includes(m.field)&&(m.value||["is_empty","is_not_empty"].includes(m.operator)))),l=c||d;let h,y;l?(h=await this.getRecipients(e,r,{limit:1e4}),y=h.length):(h=await this.getRecipients(e,r,{limit:1e4}),y=h.length);const p={},v=x=>x?x.toLowerCase().replace(/\b\w/g,b=>b.toUpperCase()):"";h.forEach(x=>{const b=(x.billing_state||"").trim(),m=(x.billing_city||"").trim();if(m&&b){const I=v(m),D=b.length===2?b.toUpperCase():v(b),E=`${I}, ${D}`;p[E]=(p[E]||0)+1}});const R=Object.entries(p).map(([x,b])=>({city:x,count:b})).sort((x,b)=>b.count-x.count).slice(0,10);return{count:y,breakdown:{total:h.length,byCity:R}}},async countRecipients(e,r){return(await this.getRecipientStats(e,r)).count},async getRecipientLocationBreakdown(e,r){return(await this.getRecipientStats(e,r)).breakdown},async scheduleBatch(e,r,o=null){const a=xe(e),i=await this.getById(e,r);if(!i)throw new Error("Batch not found");if(i.status!=="Draft")throw new Error("Can only schedule draft batches");const n=await this.getRecipients(e,i.filter_config,{limit:1e4});if(n.length===0)throw new Error("No recipients match the filter");const s=o||new Date().toISOString(),c=n.map(h=>({owner_id:a,account_id:h.account_unique_id,template_id:i.template_id,recipient_email:h.person_email||h.email,recipient_name:h.primary_contact_first_name?`${h.primary_contact_first_name} ${h.primary_contact_last_name||""}`.trim():h.name,subject:i.subject,scheduled_for:s,status:"Pending",batch_id:r})),d=100;let l=0;for(let h=0;h<c.length;h+=d){const y=c.slice(h,h+d),{data:p,error:v}=await g.from("scheduled_emails").insert(y).select();if(v)throw v;l+=p.length}return await this.update(e,r,{status:o?"Scheduled":"Sending",total_recipients:n.length,scheduled_for:s,started_at:o?null:new Date().toISOString()}),{scheduled:l,total:n.length,scheduledFor:s}},async cancelBatch(e,r){await this.update(e,r,{status:"Cancelled"});let o=g.from("scheduled_emails").update({status:"Cancelled"}).eq("batch_id",r).eq("status","Pending");o=H(o,e);const{error:a}=await o;if(a)throw a;return!0},async getBatchStats(e,r){let o=g.from("scheduled_emails").select("status").eq("batch_id",r);o=H(o,e);const{data:a,error:i}=await o;if(i)throw i;const n={pending:0,sent:0,failed:0,cancelled:0,total:a.length};return a.forEach(s=>{const c=s.status.toLowerCase();n[c]!==void 0&&n[c]++}),n},async getAllWithStats(e,r={}){const o=await this.getAll(e,r);return await Promise.all(o.map(async i=>{if(i.status==="Draft")return{...i,stats:null};const n=await this.getBatchStats(e,i.id);return{...i,stats:n}}))}};function wt(e=!1){const{ownerIds:r,filterKey:o}=ne();return oe({queryKey:["roleUserIds",o,e],queryFn:async()=>!e||r.length>1?r:he.getUserIdsByRole(r[0]),enabled:r.length>0,staleTime:6e4})}function uo(e={}){const{ownerIds:r,filterKey:o}=ne();return oe({queryKey:["massEmails",o,"withStats",e],queryFn:()=>be.getAllWithStats(r,e),enabled:r.length>0})}function Ke(e,r={}){const{ownerIds:o,filterKey:a}=ne();return oe({queryKey:["massEmailRecipients",a,e,r],queryFn:()=>be.getRecipients(o,e,r),enabled:o.length>0&&!!e})}function Ct(e,r=!1){var s,c;const{ownerIds:o,filterKey:a}=ne(),{data:i}=wt(r),n=e?{rules:(s=e.rules)==null?void 0:s.map(d=>({field:d.field,operator:d.operator,value:d.value,value2:d.value2,radius:d.radius})),groups:(c=e.groups)==null?void 0:c.map(d=>{var l;return{rules:(l=d.rules)==null?void 0:l.map(h=>({field:h.field,operator:h.operator,value:h.value,value2:h.value2,radius:h.radius}))}}),search:e.search,notOptedOut:e.notOptedOut,includeRoleAccounts:r}:null;return oe({queryKey:["massEmailRecipientStats",a,n,i],queryFn:()=>be.getRecipientStats(i||o,e),enabled:o.length>0&&!!e&&!!i,staleTime:3e4,gcTime:6e4,placeholderData:d=>d})}function kt(e,r=!1){const{data:o,isLoading:a,isFetching:i,error:n}=Ct(e,r);return{data:o==null?void 0:o.count,isLoading:a,isFetching:i,error:n}}function xo(e,r=!1){const{data:o,isLoading:a,isFetching:i,error:n}=Ct(e,r);return{data:o==null?void 0:o.breakdown,isLoading:a,isFetching:i,error:n}}function go(){const{ownerIds:e}=ne(),r=Me(),o=()=>{r.invalidateQueries({queryKey:["massEmails"]})},a=J({mutationFn:d=>be.create(e,d),onSuccess:o}),i=J({mutationFn:({batchId:d,updates:l})=>be.update(e,d,l),onSuccess:o}),n=J({mutationFn:d=>be.delete(e,d),onSuccess:o}),s=J({mutationFn:({batchId:d,scheduledFor:l})=>be.scheduleBatch(e,d,l),onSuccess:()=>{o(),r.invalidateQueries({queryKey:["scheduledEmails"]})}}),c=J({mutationFn:d=>be.cancelBatch(e,d),onSuccess:()=>{o(),r.invalidateQueries({queryKey:["scheduledEmails"]})}});return{createBatch:a,updateBatch:i,deleteBatch:n,scheduleBatch:s,cancelBatch:c}}const fo=()=>{const{userId:e}=le();return e};function yo(){const e=fo();return oe({queryKey:["isAdmin",e],queryFn:()=>pe.isAdmin(e),enabled:!!e,staleTime:5*60*1e3})}function mo(){const e=Me(),r=()=>{e.invalidateQueries({queryKey:["masterAutomations"]}),e.invalidateQueries({queryKey:["masterAutomation"]}),e.invalidateQueries({queryKey:["automations"]}),e.invalidateQueries({queryKey:["automation"]})},o=J({mutationFn:c=>pe.createMasterAutomation(c),onSuccess:r}),a=J({mutationFn:({defaultKey:c,updates:d})=>pe.updateMasterAutomation(c,d),onSuccess:r}),i=J({mutationFn:c=>pe.deleteMasterAutomation(c),onSuccess:r}),n=J({mutationFn:c=>pe.syncMasterAutomation(c),onSuccess:()=>{e.invalidateQueries({queryKey:["automations"]}),e.invalidateQueries({queryKey:["automation"]})}}),s=J({mutationFn:()=>pe.syncAllMasterAutomations(),onSuccess:()=>{e.invalidateQueries({queryKey:["automations"]}),e.invalidateQueries({queryKey:["automation"]})}});return{createMasterAutomation:o,updateMasterAutomation:a,deleteMasterAutomation:i,syncMasterAutomation:n,syncAllMasterAutomations:s}}const je=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite"}}),qe=({label:e,value:r,change:o,icon:a,positive:i,isLoading:n,theme:s})=>t.jsxs("div",{style:{padding:"20px",backgroundColor:s.bgCard,borderRadius:"12px",border:`1px solid ${s.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[t.jsx("span",{style:{color:s.textSecondary,fontSize:"13px"},children:e}),t.jsx("span",{style:{fontSize:"20px"},children:a})]}),n?t.jsx(je,{height:"32px",width:"80px"}):t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:s.text,marginBottom:"4px"},children:r}),o&&t.jsx("span",{style:{fontSize:"12px",color:i?s.success:s.danger},children:o})]})]}),ho=({email:e,theme:r,userId:o})=>{var a,i,n;return t.jsx("div",{style:{padding:"14px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"11px",color:r.textMuted,marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[t.jsx("span",{children:"ðŸ•"})," ",new Date(e.scheduled_for).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]}),t.jsx(Ce,{to:`/${o}/clients/${e.account_id}`,style:{fontSize:"14px",fontWeight:"600",color:r.text,textDecoration:"none"},children:((a=e.accounts)==null?void 0:a.name)||"Unknown Account"}),t.jsx("div",{style:{fontSize:"12px",color:r.textSecondary,marginTop:"2px"},children:((i=e.email_templates)==null?void 0:i.subject)||"No subject"}),t.jsx("span",{style:{display:"inline-block",marginTop:"6px",padding:"3px 8px",backgroundColor:r.bgHover,borderRadius:"4px",fontSize:"11px",color:r.textSecondary},children:((n=e.email_templates)==null?void 0:n.name)||"Unknown Template"})]}),t.jsxs("div",{style:{display:"flex",gap:"6px"},children:[t.jsx("button",{style:{padding:"6px 10px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.textSecondary,cursor:"pointer",fontSize:"12px"},children:"âœˆï¸"}),t.jsx("button",{style:{padding:"6px 10px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Ã—"})]})]})})},bo=({label:e,you:r,avg:o,theme:a})=>t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[t.jsx("span",{style:{fontSize:"12px",color:a.textSecondary},children:e}),t.jsxs("span",{style:{fontSize:"12px",color:a.textMuted},children:[r,"% vs ",o,"%"]})]}),t.jsxs("div",{style:{display:"flex",gap:"4px",height:"24px"},children:[t.jsx("div",{style:{width:`${Math.min(r,100)}%`,backgroundColor:a.primary,borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:t.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[r,"%"]})}),t.jsx("div",{style:{width:`${Math.min(o,100)}%`,backgroundColor:"#14b8a6",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:t.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[o,"%"]})})]})]}),dt=({t:e})=>{const{userId:r}=le(),{data:o,isLoading:a,error:i}=jt(),{data:n,isLoading:s}=so(7),{data:c,isLoading:d}=Xt(30),l=[{label:"Open Rate",you:(o==null?void 0:o.openRate)||0,avg:32},{label:"Click Rate",you:(o==null?void 0:o.clickRate)||0,avg:8},{label:"Response Rate",you:(o==null?void 0:o.responseRate)||0,avg:5}],h=p=>p>=1e3?`${(p/1e3).toFixed(1)}k`:(p==null?void 0:p.toLocaleString())||"0",y=p=>`${Math.round(p||0)}%`;return t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Dashboard"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Overview of your email campaigns and performance"})]}),i&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load dashboard data. Please try refreshing the page."}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"24px"},children:[t.jsx(qe,{label:"Emails Sent",value:h(o==null?void 0:o.emailsSent),change:o!=null&&o.emailsSentChange?`${o.emailsSentChange>0?"+":""}${o.emailsSentChange}%`:null,icon:"ðŸ“§",positive:(o==null?void 0:o.emailsSentChange)>0,isLoading:a,theme:e}),t.jsx(qe,{label:"Open Rate",value:y(o==null?void 0:o.openRate),change:o!=null&&o.openRateChange?`${o.openRateChange>0?"+":""}${o.openRateChange}%`:null,icon:"ðŸ“¬",positive:(o==null?void 0:o.openRateChange)>0,isLoading:a,theme:e}),t.jsx(qe,{label:"Click Rate",value:y(o==null?void 0:o.clickRate),change:o!=null&&o.clickRateChange?`${o.clickRateChange>0?"+":""}${o.clickRateChange}%`:null,icon:"ðŸ–±ï¸",positive:(o==null?void 0:o.clickRateChange)>0,isLoading:a,theme:e}),t.jsx(qe,{label:"Scheduled",value:h(o==null?void 0:o.scheduledCount),change:null,icon:"ðŸ“…",positive:null,isLoading:a,theme:e})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,margin:0},children:"Upcoming Scheduled Emails"}),t.jsx(Ce,{to:`/${r}/scheduled`,style:{fontSize:"12px",color:e.primary,textDecoration:"none"},children:"View all â†’"})]}),t.jsx("p",{style:{fontSize:"12px",color:e.textSecondary,marginBottom:"16px"},children:"Emails scheduled to be sent in the next 7 days"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:s?Array.from({length:3}).map((p,v)=>t.jsxs("div",{style:{padding:"14px",backgroundColor:e.bg,borderRadius:"8px",border:`1px solid ${e.border}`},children:[t.jsx(je,{height:"12px",width:"120px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(je,{height:"16px",width:"180px"})}),t.jsx("div",{style:{marginTop:"4px"},children:t.jsx(je,{height:"12px",width:"220px"})})]},v)):(n==null?void 0:n.length)>0?n.slice(0,5).map(p=>t.jsx(ho,{email:p,theme:e,userId:r},p.id)):t.jsxs("div",{style:{padding:"40px 20px",textAlign:"center",color:e.textMuted,fontSize:"14px"},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"8px"},children:"ðŸ“­"}),"No scheduled emails in the next 7 days"]})})]}),t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Performance Comparison"}),t.jsx("p",{style:{fontSize:"12px",color:e.textSecondary,marginBottom:"16px"},children:"Your metrics compared to industry averages"}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:a?Array.from({length:3}).map((p,v)=>t.jsxs("div",{children:[t.jsx(je,{height:"12px",width:"100px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(je,{height:"24px"})})]},v)):l.map((p,v)=>t.jsx(bo,{label:p.label,you:p.you,avg:p.avg,theme:e},v))}),t.jsxs("div",{style:{display:"flex",gap:"16px",marginTop:"16px",justifyContent:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:e.primary,borderRadius:"2px"}}),t.jsx("span",{style:{fontSize:"11px",color:e.textSecondary},children:"You"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"#14b8a6",borderRadius:"2px"}}),t.jsx("span",{style:{fontSize:"11px",color:e.textSecondary},children:"Industry Avg"})]})]})]})]}),t.jsxs("div",{style:{marginTop:"20px",padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,margin:0},children:"Recent Email Activity"}),t.jsx(Ce,{to:`/${r}/activity`,style:{fontSize:"12px",color:e.primary,textDecoration:"none"},children:"View all â†’"})]}),d?t.jsx(je,{height:"200px"}):(c==null?void 0:c.length)>0?t.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"4px",height:"200px",padding:"20px 0"},children:c.slice(-14).map((p,v)=>{const R=Math.max(...c.map(b=>b.sent||0),1),x=(p.sent||0)/R*150;return t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[t.jsx("div",{style:{width:"100%",height:`${x}px`,backgroundColor:e.primary,borderRadius:"4px 4px 0 0",minHeight:"4px"},title:`${p.sent||0} sent on ${p.date}`}),t.jsx("span",{style:{fontSize:"9px",color:e.textMuted},children:new Date(p.date).toLocaleDateString("en-US",{weekday:"short"}).charAt(0)})]},v)})}):t.jsx("div",{style:{padding:"40px 20px",textAlign:"center",color:e.textMuted,fontSize:"14px"},children:"No email activity data yet"})]})]})},Se=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),ct=({automation:e,onEdit:r,onToggle:o,theme:a})=>{var s;const i=e.stats||{},n=e.status==="active";return t.jsxs("tr",{onClick:()=>r(e.id),style:{borderTop:`1px solid ${a.border}`,cursor:"pointer",transition:"background-color 0.15s"},onMouseEnter:c=>c.currentTarget.style.backgroundColor=a.bgHover,onMouseLeave:c=>c.currentTarget.style.backgroundColor="transparent",children:[t.jsx("td",{style:{padding:"14px 16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:a.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px"},children:"âš¡"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:a.text},children:e.name}),e.description&&t.jsx("div",{style:{fontSize:"12px",color:a.textMuted},children:e.description})]})]})}),t.jsx("td",{style:{padding:"14px 16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("button",{onClick:c=>{c.stopPropagation(),o(e.id,n?"pause":"activate")},style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:n?a.success:a.bgHover,cursor:"pointer",position:"relative",transition:"background-color 0.2s",flexShrink:0},children:t.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:n?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})}),t.jsx("span",{style:{fontSize:"12px",color:n?a.success:a.textMuted,fontWeight:"500"},children:n?"Active":e.status==="draft"?"Draft":"Paused"})]})}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:a.textSecondary},children:((s=i.totalSent)==null?void 0:s.toLocaleString())||0}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:a.textSecondary},children:i.openRate?`${Math.round(i.openRate)}%`:"â€”"}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:a.textSecondary},children:i.clickRate?`${Math.round(i.clickRate)}%`:"â€”"}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:a.textSecondary},children:i.activeEnrollments||0}),t.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:t.jsx("button",{onClick:c=>{c.stopPropagation(),r(e.id)},style:{padding:"6px 12px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"6px",color:a.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Edit"})})]})},vo=({t:e})=>{const{userId:r}=le(),o=ye(),[a,i]=C.useState("automations"),{data:n,isLoading:s,error:c}=Vt(),{activateAutomation:d,pauseAutomation:l}=ht(),h=()=>{o(`/${r}/automations/new`)},y=I=>{o(`/${r}/automations/${I}`)},p=async(I,D)=>{try{D==="activate"?await d.mutateAsync(I):await l.mutateAsync(I)}catch(E){console.error(`Failed to ${D} automation:`,E)}},v=(n==null?void 0:n.filter(I=>I.is_default===!0))||[],R=(n==null?void 0:n.filter(I=>I.is_default!==!0))||[],x=(n==null?void 0:n.filter(I=>I.status==="active"))||[],b=(n==null?void 0:n.filter(I=>I.status==="paused"))||[],m=(n==null?void 0:n.filter(I=>I.status==="draft"))||[];return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Automations"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Create and manage automated email workflows"})]}),t.jsxs("button",{onClick:h,style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," Create Custom"]})]}),c&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load automations. Please try refreshing the page."}),!s&&n&&t.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"24px",padding:"16px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{textAlign:"center",flex:1},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.success},children:x.length}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Active"})]}),t.jsx("div",{style:{width:"1px",backgroundColor:e.border}}),t.jsxs("div",{style:{textAlign:"center",flex:1},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.warning},children:b.length}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Paused"})]}),t.jsx("div",{style:{width:"1px",backgroundColor:e.border}}),t.jsxs("div",{style:{textAlign:"center",flex:1},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.textMuted},children:m.length}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Drafts"})]}),t.jsx("div",{style:{width:"1px",backgroundColor:e.border}}),t.jsxs("div",{style:{textAlign:"center",flex:1},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.primary},children:n.reduce((I,D)=>{var E;return I+(((E=D.stats)==null?void 0:E.totalSent)||0)},0).toLocaleString()}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Total Sent"})]})]}),t.jsxs("div",{style:{display:"flex",gap:"0",marginBottom:"24px",backgroundColor:e.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:[t.jsxs("button",{onClick:()=>i("automations"),style:{padding:"10px 20px",backgroundColor:a==="automations"?e.bgCard:"transparent",border:"none",borderRadius:"8px",color:a==="automations"?e.text:e.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:a==="automations"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:["Automations ",v.length>0&&`(${v.length})`]}),t.jsxs("button",{onClick:()=>i("my"),style:{padding:"10px 20px",backgroundColor:a==="my"?e.bgCard:"transparent",border:"none",borderRadius:"8px",color:a==="my"?e.text:e.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:a==="my"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:["My Automations ",R.length>0&&`(${R.length})`]})]}),a==="automations"&&t.jsx(t.Fragment,{children:s?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,padding:"20px"},children:Array.from({length:3}).map((I,D)=>t.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:D>0?`1px solid ${e.border}`:"none"},children:[t.jsx(Se,{width:"36px",height:"36px"}),t.jsxs("div",{style:{flex:1},children:[t.jsx(Se,{width:"200px",height:"16px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Se,{width:"120px",height:"12px"})})]})]},D))}):v.length>0?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,overflow:"hidden"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:e.bgHover},children:[t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Automation"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Status"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Sent"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Open Rate"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Click Rate"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Enrolled"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Actions"})]})}),t.jsx("tbody",{children:v.map(I=>t.jsx(ct,{automation:I,onEdit:y,onToggle:p,theme:e},I.id))})]})}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"âš¡"}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:"No default automations"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:"Default automations will appear here when available."})]})}),a==="my"&&t.jsx(t.Fragment,{children:s?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,padding:"20px"},children:Array.from({length:3}).map((I,D)=>t.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:D>0?`1px solid ${e.border}`:"none"},children:[t.jsx(Se,{width:"36px",height:"36px"}),t.jsxs("div",{style:{flex:1},children:[t.jsx(Se,{width:"200px",height:"16px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Se,{width:"120px",height:"12px"})})]})]},D))}):R.length>0?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,overflow:"hidden"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:e.bgHover},children:[t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Automation"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Status"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Sent"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Open Rate"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Click Rate"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Enrolled"}),t.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Actions"})]})}),t.jsx("tbody",{children:R.map(I=>t.jsx(ct,{automation:I,onEdit:y,onToggle:p,theme:e},I.id))})]})}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"âš¡"}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:"No custom automations yet"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:"Create your own automation or clone an existing one to get started."}),t.jsx("button",{onClick:h,style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Custom"})]})})]})},Le=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),_o=({template:e,onSave:r,onClose:o,theme:a})=>{const[i,n]=C.useState((e==null?void 0:e.name)||""),[s,c]=C.useState((e==null?void 0:e.subject)||""),[d,l]=C.useState((e==null?void 0:e.body_html)||(e==null?void 0:e.body_text)||""),[h,y]=C.useState((e==null?void 0:e.category)||"general"),[p,v]=C.useState(!1),R=async()=>{v(!0);try{await r({name:i,subject:s,body_html:d,body_text:d.replace(/<[^>]*>/g,""),category:h}),o()}catch(m){console.error("Failed to save template:",m)}finally{v(!1)}},x=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],b=m=>{l(d+m)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:100},onClick:o}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxHeight:"90vh",backgroundColor:a.bgCard,borderRadius:"16px",border:`1px solid ${a.border}`,zIndex:101,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${a.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:a.text,margin:0},children:e?"Edit Template":"Create Template"}),t.jsx("button",{onClick:o,style:{background:"none",border:"none",color:a.textMuted,cursor:"pointer",fontSize:"20px"},children:"Ã—"})]}),t.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Template Name"}),t.jsx("input",{type:"text",value:i,onChange:m=>n(m.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Category"}),t.jsxs("select",{value:h,onChange:m=>y(m.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"},children:[t.jsx("option",{value:"general",children:"General"}),t.jsx("option",{value:"welcome",children:"Welcome"}),t.jsx("option",{value:"renewal",children:"Renewal"}),t.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),t.jsx("option",{value:"engagement",children:"Engagement"}),t.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),t.jsx("input",{type:"text",value:s,onChange:m=>c(m.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"}})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:x.map(m=>t.jsx("button",{onClick:()=>b(m.key),style:{padding:"4px 10px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"6px",color:a.textSecondary,cursor:"pointer",fontSize:"11px"},children:m.label},m.key))})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Email Body"}),t.jsx("textarea",{value:d,onChange:m=>l(m.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:12,style:{width:"100%",padding:"12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),t.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${a.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[t.jsx("button",{onClick:o,style:{padding:"10px 20px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),t.jsx("button",{onClick:R,disabled:p||!i||!s,style:{padding:"10px 20px",backgroundColor:a.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:p?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:p||!i||!s?.6:1},children:p?"Saving...":e?"Save Changes":"Create Template"})]})]})]})},jo=({template:e,onEdit:r,onDuplicate:o,onDelete:a,theme:i})=>{var d,l;const[n,s]=C.useState(!1),c={welcome:i.success,renewal:i.warning,cross_sell:i.primary,engagement:i.purple,policy_update:"#06b6d4",general:i.textMuted};return t.jsxs("div",{style:{padding:"20px",backgroundColor:i.bgCard,borderRadius:"12px",border:`1px solid ${i.border}`,position:"relative"},children:[t.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px"},children:[t.jsx("button",{onClick:()=>s(!n),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:i.textMuted,cursor:"pointer",fontSize:"16px"},children:"â‹®"}),n&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,zIndex:10},onClick:()=>s(!1)}),t.jsxs("div",{style:{position:"absolute",top:"100%",right:0,backgroundColor:i.bgCard,border:`1px solid ${i.border}`,borderRadius:"8px",padding:"4px",zIndex:11,minWidth:"140px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[t.jsx("button",{onClick:()=>{r(e),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:i.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:"âœï¸ Edit"}),t.jsx("button",{onClick:()=>{o(e),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:i.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:"ðŸ“‹ Duplicate"}),t.jsx("button",{onClick:()=>{a(e.id),s(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:i.danger,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:"ðŸ—‘ï¸ Delete"})]})]})]}),t.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${c[e.category]||i.textMuted}15`,color:c[e.category]||i.textMuted,borderRadius:"20px",fontSize:"11px",fontWeight:"500",marginBottom:"12px",textTransform:"capitalize"},children:((d=e.category)==null?void 0:d.replace("_"," "))||"General"}),t.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:i.text,marginBottom:"6px"},children:e.name}),t.jsx("p",{style:{fontSize:"13px",color:i.textSecondary,marginBottom:"8px"},children:e.subject}),t.jsxs("p",{style:{fontSize:"12px",color:i.textMuted,marginBottom:"12px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:[(l=e.body_text)==null?void 0:l.substring(0,100),"..."]}),t.jsxs("div",{style:{display:"flex",gap:"16px",paddingTop:"12px",borderTop:`1px solid ${i.border}`,fontSize:"11px",color:i.textMuted},children:[t.jsxs("span",{children:["ðŸ“§ ",e.usage_count||0," sent"]}),t.jsxs("span",{children:["ðŸ“¬ ",e.open_rate?`${Math.round(e.open_rate)}%`:"â€”"," opens"]})]}),t.jsx("button",{onClick:()=>r(e),style:{marginTop:"12px",width:"100%",padding:"10px",backgroundColor:i.bgHover,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,cursor:"pointer",fontSize:"13px"},children:"Edit Template"})]})},So=({t:e})=>{const{userId:r}=le(),[o,a]=C.useState("my"),[i,n]=C.useState("all"),[s,c]=C.useState(""),[d,l]=C.useState(!1),[h,y]=C.useState(null),{data:p,isLoading:v,error:R}=Je(),{data:x}=Kt(),{createTemplate:b,updateTemplate:m,deleteTemplate:I,duplicateTemplate:D}=mt(),E=(p==null?void 0:p.filter(q=>!(i!=="all"&&q.category!==i||s&&!q.name.toLowerCase().includes(s.toLowerCase())&&!q.subject.toLowerCase().includes(s.toLowerCase()))))||[],S=()=>{y(null),l(!0)},_=q=>{y(q),l(!0)},W=async q=>{h?await m.mutateAsync({id:h.id,...q}):await b.mutateAsync(q)},V=async q=>{await D.mutateAsync(q.id)},T=async q=>{window.confirm("Are you sure you want to delete this template?")&&await I.mutateAsync(q)};return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Email Templates"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Create and manage reusable email templates"})]}),t.jsxs("button",{onClick:S,style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," Create Template"]})]}),R&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load templates. Please try refreshing the page."}),t.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"24px",alignItems:"center"},children:[t.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"300px"},children:[t.jsx("input",{type:"text",placeholder:"Search templates...",value:s,onChange:q=>c(q.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px"}}),t.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:e.textMuted},children:"ðŸ”"})]}),t.jsxs("select",{value:i,onChange:q=>n(q.target.value),style:{padding:"10px 12px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px",minWidth:"150px"},children:[t.jsx("option",{value:"all",children:"All Categories"}),t.jsx("option",{value:"welcome",children:"Welcome"}),t.jsx("option",{value:"renewal",children:"Renewal"}),t.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),t.jsx("option",{value:"engagement",children:"Engagement"}),t.jsx("option",{value:"policy_update",children:"Policy Update"}),t.jsx("option",{value:"general",children:"General"})]}),t.jsxs("span",{style:{fontSize:"13px",color:e.textMuted},children:[E.length," template",E.length!==1?"s":""]})]}),v?t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:Array.from({length:6}).map((q,P)=>t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx(Le,{width:"80px",height:"20px"}),t.jsx("div",{style:{marginTop:"12px"},children:t.jsx(Le,{width:"180px",height:"18px"})}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Le,{width:"220px",height:"14px"})}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Le,{height:"40px"})})]},P))}):E.length>0?t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:E.map(q=>t.jsx(jo,{template:q,onEdit:_,onDuplicate:V,onDelete:T,theme:e},q.id))}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ“"}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:s||i!=="all"?"No templates found":"No templates yet"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:s||i!=="all"?"Try adjusting your search or filter criteria.":"Create your first email template to get started."}),!s&&i==="all"&&t.jsx("button",{onClick:S,style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Template"})]}),d&&t.jsx(_o,{template:h,onSave:W,onClose:()=>l(!1),theme:e})]})},Ne=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),wo=({type:e,theme:r})=>{const o=(e||"").toLowerCase();let a=o;(o==="prior_customer"||o.startsWith("prior"))&&(a="prior"),o.startsWith("customer")&&(a="customer"),o.startsWith("prospect")&&(a="prospect"),o.startsWith("lead")&&(a="lead");const i={customer:{bg:`${r.success}20`,text:r.success,label:"Customer"},prospect:{bg:`${r.primary}20`,text:r.primary,label:"Prospect"},prior:{bg:`${r.textMuted}20`,text:r.textMuted,label:"Prior Customer"},lead:{bg:`${r.warning}20`,text:r.warning,label:"Lead"}},n=i[a]||i.prospect;return t.jsx("span",{style:{padding:"4px 10px",backgroundColor:n.bg,color:n.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:n.label||e||"Unknown"})},Co=({policyType:e,status:r,theme:o})=>{const a=r==="active";return t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"3px 8px",backgroundColor:a?`${o.success}10`:`${o.textMuted}10`,borderRadius:"6px",fontSize:"11px",color:a?o.success:o.textMuted},children:[a?"âœ“":"â—‹"," ",e]})},ko=({client:e,onClick:r,theme:o})=>{var a,i,n;return t.jsxs("tr",{style:{borderTop:`1px solid ${o.border}`,cursor:"pointer"},onClick:r,onMouseOver:s=>s.currentTarget.style.backgroundColor=o.bgHover,onMouseOut:s=>s.currentTarget.style.backgroundColor="transparent",children:[t.jsx("td",{style:{padding:"14px 16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:o.bgHover,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",color:o.textMuted},children:((a=e.name)==null?void 0:a.charAt(0).toUpperCase())||"?"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:o.text},children:e.name}),t.jsx("div",{style:{fontSize:"12px",color:o.textMuted},children:e.person_email||e.email||"â€”"})]})]})}),t.jsx("td",{style:{padding:"14px 16px"},children:t.jsx(wo,{type:e.account_status||"Prospect",theme:o})}),t.jsx("td",{style:{padding:"14px 16px"},children:t.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",alignItems:"center"},children:((i=e.policies)==null?void 0:i.length)>0?t.jsxs(t.Fragment,{children:[e.policies.slice(0,3).map((s,c)=>t.jsx(Co,{policyType:s.policy_type||"Policy",status:s.status,theme:o},c)),e.policies.length>3&&t.jsxs("span",{style:{fontSize:"11px",color:o.textMuted},children:["+",e.policies.length-3," more"]})]}):t.jsx("span",{style:{fontSize:"13px",color:o.textMuted},children:"No policies"})})}),t.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:o.textSecondary,textAlign:"center"},children:e.policy_count||((n=e.policies)==null?void 0:n.length)||0}),t.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:t.jsxs("div",{style:{display:"flex",gap:"6px",justifyContent:"flex-end"},children:[t.jsx("button",{onClick:s=>{s.stopPropagation()},style:{padding:"6px 12px",backgroundColor:o.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:"ðŸ“§ Email"}),t.jsx("button",{onClick:s=>{s.stopPropagation(),r()},style:{padding:"6px 12px",backgroundColor:o.bgHover,border:`1px solid ${o.border}`,borderRadius:"6px",color:o.textSecondary,cursor:"pointer",fontSize:"12px"},children:"View"})]})})]})},Ie=({label:e,value:r,icon:o,color:a,theme:i,onClick:n,active:s})=>t.jsxs("div",{onClick:n,style:{padding:"16px",backgroundColor:s?`${a}15`:i.bgCard,borderRadius:"10px",border:`2px solid ${s?a:i.border}`,textAlign:"center",cursor:n?"pointer":"default",transition:"all 0.2s ease",transform:s?"scale(1.02)":"scale(1)"},onMouseOver:c=>{n&&(c.currentTarget.style.borderColor=a,c.currentTarget.style.transform="scale(1.02)")},onMouseOut:c=>{n&&!s&&(c.currentTarget.style.borderColor=i.border,c.currentTarget.style.transform="scale(1)")},children:[t.jsx("div",{style:{fontSize:"24px",marginBottom:"4px"},children:o}),t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:a||i.text},children:r}),t.jsx("div",{style:{fontSize:"12px",color:i.textSecondary},children:e})]}),zo=({t:e})=>{const{userId:r}=le(),o=ye(),[a,i]=C.useState(""),[n,s]=C.useState("all"),[c,d]=C.useState("name"),[l,h]=C.useState("asc"),[y,p]=C.useState(1),v=25,R=C.useMemo(()=>{const K={limit:v,offset:(y-1)*v};return n!=="all"&&n!=="expiring"&&(K.status=n),n==="expiring"&&(K.expiring=!0,K.limit=100,K.offset=0),a.length>=2&&(K.search=a),K},[n,y,a]),{data:x,isLoading:b,error:m}=oo(R),{data:I,isLoading:D}=no(),E=(x==null?void 0:x.accounts)||[],S=(x==null?void 0:x.total)||0,_=Math.ceil(S/v),W=C.useMemo(()=>!E||E.length===0?[]:[...E].sort((K,L)=>{let N=K[c],O=L[c];return c==="name"&&(N=(N==null?void 0:N.toLowerCase())||"",O=(O==null?void 0:O.toLowerCase())||""),c==="policy_count"&&(N=K.policy_count||0,O=L.policy_count||0),l==="asc"?N>O?1:-1:N<O?1:-1}),[E,c,l]),V=K=>{s(K),p(1)},T=K=>{i(K),p(1)},q=K=>{o(`/${r}/accounts/${K}`)},P=I||{Customer:0,Prospect:0,Prior:0,total:0,expiring:0};return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Accounts"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"View and manage your account database"})]}),t.jsxs("div",{style:{display:"flex",gap:"12px"},children:[t.jsx("button",{onClick:()=>{},style:{padding:"10px 16px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:"ðŸ“¤ Export"}),t.jsx("button",{style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"+ Add Account"})]})]}),m&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load accounts. Please try refreshing the page."}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"16px",marginBottom:"24px"},children:[t.jsx(Ie,{label:"Total Accounts",value:D?"...":P.total,icon:"ðŸ“Š",color:e.text,theme:e,onClick:()=>V("all"),active:n==="all"}),t.jsx(Ie,{label:"Customers",value:D?"...":P.Customer,icon:"ðŸ‘¥",color:e.success,theme:e,onClick:()=>V(n==="Customer"?"all":"Customer"),active:n==="Customer"}),t.jsx(Ie,{label:"Prospects",value:D?"...":P.Prospect,icon:"ðŸŽ¯",color:e.primary,theme:e,onClick:()=>V(n==="Prospect"?"all":"Prospect"),active:n==="Prospect"}),t.jsx(Ie,{label:"Prior Customers",value:D?"...":P.Prior,icon:"ðŸ“",color:e.textMuted,theme:e,onClick:()=>V(n==="Prior"?"all":"Prior"),active:n==="Prior"}),t.jsx(Ie,{label:"Expiring in 30d",value:D?"...":P.expiring,icon:"âš ï¸",color:e.warning,theme:e,onClick:()=>V(n==="expiring"?"all":"expiring"),active:n==="expiring"})]}),t.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"20px",alignItems:"center",flexWrap:"wrap"},children:[t.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"350px"},children:[t.jsx("input",{type:"text",placeholder:"Search by name, email, or phone...",value:a,onChange:K=>T(K.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px"}}),t.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:e.textMuted},children:"ðŸ”"})]}),t.jsxs("select",{value:n,onChange:K=>V(K.target.value),style:{padding:"10px 12px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px",minWidth:"150px"},children:[t.jsx("option",{value:"all",children:"All Types"}),t.jsx("option",{value:"Customer",children:"Customers"}),t.jsx("option",{value:"Prospect",children:"Prospects"}),t.jsx("option",{value:"Prior",children:"Prior Customers"}),t.jsx("option",{value:"Lead",children:"Leads"}),t.jsx("option",{value:"expiring",children:"Expiring Policies"})]}),t.jsxs("select",{value:`${c}-${l}`,onChange:K=>{const[L,N]=K.target.value.split("-");d(L),h(N)},style:{padding:"10px 12px",backgroundColor:e.bgInput,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,fontSize:"14px",minWidth:"150px"},children:[t.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),t.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),t.jsx("option",{value:"created_at-desc",children:"Newest First"}),t.jsx("option",{value:"created_at-asc",children:"Oldest First"})]}),t.jsx("span",{style:{fontSize:"13px",color:e.textMuted,marginLeft:"auto"},children:n==="expiring"?`${W.length} account${W.length!==1?"s":""} with expiring policies`:`Showing ${(y-1)*v+1}-${Math.min(y*v,S)} of ${S} account${S!==1?"s":""}`})]}),b?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,padding:"20px"},children:Array.from({length:5}).map((K,L)=>t.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:L>0?`1px solid ${e.border}`:"none"},children:[t.jsx(Ne,{width:"40px",height:"40px"}),t.jsxs("div",{style:{flex:1},children:[t.jsx(Ne,{width:"200px",height:"16px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Ne,{width:"150px",height:"12px"})})]})]},L))}):W.length>0?t.jsx("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,overflow:"hidden"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:e.bgHover},children:[t.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Account"}),t.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Type"}),t.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Policies"}),t.jsx("th",{style:{padding:"14px 16px",textAlign:"center",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"# Policies"}),t.jsx("th",{style:{padding:"14px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:e.textSecondary},children:"Actions"})]})}),t.jsx("tbody",{children:W.map(K=>t.jsx(ko,{client:K,onClick:()=>q(K.account_unique_id),theme:e},K.id))})]})}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ‘¥"}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:a?"No accounts found":"No accounts yet"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:a?"Try adjusting your search criteria.":"Your accounts will appear here once synced from Salesforce."})]}),_>1&&n!=="expiring"&&t.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginTop:"24px",padding:"16px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("button",{onClick:()=>p(1),disabled:y===1,style:{padding:"8px 12px",backgroundColor:y===1?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:y===1?e.textMuted:e.text,cursor:y===1?"not-allowed":"pointer",fontSize:"13px"},children:"âŸ¨âŸ¨ First"}),t.jsx("button",{onClick:()=>p(K=>Math.max(1,K-1)),disabled:y===1,style:{padding:"8px 12px",backgroundColor:y===1?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:y===1?e.textMuted:e.text,cursor:y===1?"not-allowed":"pointer",fontSize:"13px"},children:"âŸ¨ Prev"}),t.jsxs("span",{style:{padding:"8px 16px",fontSize:"14px",color:e.text,fontWeight:"500"},children:["Page ",y," of ",_]}),t.jsx("button",{onClick:()=>p(K=>Math.min(_,K+1)),disabled:y===_,style:{padding:"8px 12px",backgroundColor:y===_?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:y===_?e.textMuted:e.text,cursor:y===_?"not-allowed":"pointer",fontSize:"13px"},children:"Next âŸ©"}),t.jsx("button",{onClick:()=>p(_),disabled:y===_,style:{padding:"8px 12px",backgroundColor:y===_?e.bgHover:e.bg,border:`1px solid ${e.border}`,borderRadius:"6px",color:y===_?e.textMuted:e.text,cursor:y===_?"not-allowed":"pointer",fontSize:"13px"},children:"Last âŸ©âŸ©"})]}),P.expiring>0&&n!=="expiring"&&t.jsxs("div",{style:{marginTop:"24px",padding:"16px 20px",backgroundColor:`${e.warning}10`,border:`1px solid ${e.warning}30`,borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("span",{style:{fontSize:"24px"},children:"âš ï¸"}),t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:e.text},children:[P.expiring," account",P.expiring!==1?"s have":" has"," policies expiring in the next 30 days"]}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary},children:"Consider setting up renewal reminders for these accounts."})]})]}),t.jsx("button",{onClick:()=>V("expiring"),style:{padding:"8px 16px",backgroundColor:e.warning,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"View Expiring"})]})]})},_e=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),zt=({status:e,theme:r})=>{const o={active:{bg:`${r.success}20`,text:r.success},pending:{bg:`${r.warning}20`,text:r.warning},cancelled:{bg:`${r.danger}20`,text:r.danger},expired:{bg:`${r.textMuted}20`,text:r.textMuted}},a=o[e]||o.pending;return t.jsx("span",{style:{padding:"4px 10px",backgroundColor:a.bg,color:a.text,borderRadius:"20px",fontSize:"11px",fontWeight:"500",textTransform:"capitalize"},children:e})},$e=({event:e,theme:r})=>{const o={sent:"ðŸ“¤",delivered:"âœ…",opened:"ðŸ“¬",clicked:"ðŸ–±ï¸",bounced:"âŒ",unsubscribed:"ðŸš«"};return t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"2px 8px",backgroundColor:r.bgHover,borderRadius:"4px",fontSize:"11px",color:r.textSecondary},children:[o[e]||"ðŸ“§"," ",e]})},Ro=({policy:e,theme:r})=>{var s;const o=e.expiration_date?Math.ceil((new Date(e.expiration_date)-new Date)/864e5):null,a=e.policy_lob||e.policy_type||"Unknown",i=e.policy_status||e.status||"unknown",n=((s=e.carrier)==null?void 0:s.name)||e.carrier_name||e.carrier||"â€”";return t.jsxs("div",{style:{padding:"16px",backgroundColor:r.bg,borderRadius:"10px",border:`1px solid ${r.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[t.jsx("div",{style:{padding:"8px 12px",backgroundColor:`${r.primary}15`,borderRadius:"8px",fontSize:"14px",fontWeight:"600",color:r.primary},children:a}),t.jsx(zt,{status:i.toLowerCase(),theme:r})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",fontSize:"13px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Policy Number"}),t.jsx("div",{style:{color:r.text},children:e.policy_number||"â€”"})]}),t.jsxs("div",{children:[t.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Carrier"}),t.jsx("div",{style:{color:r.text},children:n})]}),t.jsxs("div",{children:[t.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Effective Date"}),t.jsx("div",{style:{color:r.text},children:e.effective_date?new Date(e.effective_date).toLocaleDateString():"â€”"})]}),t.jsxs("div",{children:[t.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Expiration"}),t.jsx("div",{style:{color:o!==null&&o>0&&o<=30?r.warning:r.text},children:e.expiration_date?t.jsxs(t.Fragment,{children:[new Date(e.expiration_date).toLocaleDateString(),o!==null&&o>0&&o<=30&&t.jsxs("span",{style:{fontSize:"11px",marginLeft:"6px"},children:["(",o,"d left)"]})]}):"â€”"})]})]}),(e.premium||e.annual_premium)&&t.jsxs("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:`1px solid ${r.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{style:{fontSize:"12px",color:r.textMuted},children:"Annual Premium"}),t.jsxs("span",{style:{fontSize:"16px",fontWeight:"600",color:r.success},children:["$",(e.premium||e.annual_premium).toLocaleString()]})]})]})},Ao=({log:e,theme:r})=>{var o;return t.jsxs("div",{style:{padding:"14px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`,marginBottom:"8px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:r.text},children:((o=e.email_templates)==null?void 0:o.name)||"Direct Email"}),t.jsx("div",{style:{fontSize:"12px",color:r.textSecondary,marginTop:"2px"},children:e.subject})]}),t.jsx("div",{style:{textAlign:"right"},children:t.jsxs("div",{style:{fontSize:"11px",color:r.textMuted},children:[new Date(e.sent_at).toLocaleDateString()," at"," ",new Date(e.sent_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})})]}),t.jsxs("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:[t.jsx($e,{event:"sent",theme:r}),e.delivered_at&&t.jsx($e,{event:"delivered",theme:r}),e.opened_at&&t.jsx($e,{event:"opened",theme:r}),e.clicked_at&&t.jsx($e,{event:"clicked",theme:r}),e.bounced_at&&t.jsx($e,{event:"bounced",theme:r})]})]})},Io=({activity:e,theme:r})=>{const o={email_sent:"ðŸ“¤",email_opened:"ðŸ“¬",email_clicked:"ðŸ–±ï¸",enrollment_started:"â–¶ï¸",enrollment_completed:"âœ…",enrollment_paused:"â¸ï¸",note_added:"ðŸ“"};return t.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[t.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:r.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:o[e.action_type]||"ðŸ“Œ"}),t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"13px",color:r.text},children:e.description}),t.jsx("div",{style:{fontSize:"11px",color:r.textMuted,marginTop:"2px"},children:new Date(e.created_at).toLocaleString()})]})]})},pt=({enrollment:e,theme:r,userId:o})=>{var a;return t.jsxs("div",{style:{padding:"14px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`,marginBottom:"8px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx(Ce,{to:`/${o}/automations/${e.automation_id}`,style:{fontSize:"14px",fontWeight:"500",color:r.text,textDecoration:"none"},children:((a=e.automations)==null?void 0:a.name)||"Unknown Automation"}),t.jsxs("div",{style:{fontSize:"12px",color:r.textMuted,marginTop:"2px"},children:["Started ",new Date(e.enrolled_at).toLocaleDateString()]})]}),t.jsx(zt,{status:e.status==="active"?"active":e.status,theme:r})]}),e.current_node_id&&t.jsxs("div",{style:{marginTop:"10px",padding:"8px 10px",backgroundColor:r.bgHover,borderRadius:"6px",fontSize:"12px",color:r.textSecondary},children:["ðŸ“ Current step: ",e.current_node_name||e.current_node_id]})]})},$o=({t:e})=>{var D,E;const{userId:r,accountId:o}=le(),a=ye(),[i,n]=C.useState("overview"),{data:s,isLoading:c,error:d}=ro(o),{data:l,isLoading:h}=Zt(i==="overview"||i==="emails"?o:null),{data:y,isLoading:p}=io(i==="activity"?o:null),{data:v,isLoading:R}=Jt(i==="overview"||i==="automations"?o:null),{data:x}=jt(),b={emailsSent:(l==null?void 0:l.length)||0,opened:(l==null?void 0:l.filter(S=>S.opened_at).length)||0,clicked:(l==null?void 0:l.filter(S=>S.clicked_at).length)||0,openRate:(l==null?void 0:l.length)>0?Math.round(l.filter(S=>S.opened_at).length/l.length*100):0,clickRate:(l==null?void 0:l.length)>0?Math.round(l.filter(S=>S.clicked_at).length/l.length*100):0,activeEnrollments:(v==null?void 0:v.filter(S=>S.status==="active").length)||0},m={openRate:(x==null?void 0:x.openRate)||25,clickRate:(x==null?void 0:x.clickRate)||5};if(c)return t.jsxs("div",{children:[t.jsx(_e,{width:"200px",height:"32px"}),t.jsx("div",{style:{marginTop:"20px"},children:t.jsx(_e,{height:"200px"})})]});if(d||!s)return t.jsxs("div",{style:{padding:"60px 20px",textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ˜•"}),t.jsx("h2",{style:{color:e.text,marginBottom:"8px"},children:"Account Not Found"}),t.jsx("p",{style:{color:e.textSecondary,marginBottom:"24px"},children:"We couldn't find the account you're looking for."}),t.jsx("button",{onClick:()=>a(`/${r}/accounts`),style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Accounts"})]});const I=[{id:"overview",label:"Overview"},{id:"emails",label:`Emails (${(l==null?void 0:l.length)||0})`},{id:"automations",label:`Automations (${(v==null?void 0:v.length)||0})`},{id:"activity",label:"Activity"}];return t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("button",{onClick:()=>a(`/${r}/accounts`),style:{background:"none",border:"none",color:e.textMuted,cursor:"pointer",fontSize:"14px",marginBottom:"12px",padding:0,display:"flex",alignItems:"center",gap:"6px"},children:"â† Back to Accounts"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:s.name}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(()=>{const S=(s.account_status||"").toLowerCase();let _=S;(S==="prior_customer"||S.startsWith("prior"))&&(_="prior"),S.startsWith("customer")&&(_="customer"),S.startsWith("prospect")&&(_="prospect"),S.startsWith("lead")&&(_="lead");const W={customer:{bg:`${e.success}20`,text:e.success,label:"Customer"},prospect:{bg:`${e.primary}20`,text:e.primary,label:"Prospect"},prior:{bg:`${e.textMuted}20`,text:e.textMuted,label:"Prior Customer"},lead:{bg:`${e.warning}20`,text:e.warning,label:"Lead"}},V=W[_]||W.prospect;return t.jsx("span",{style:{padding:"4px 10px",backgroundColor:V.bg,color:V.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:V.label})})(),s.account_unique_id&&t.jsxs("span",{style:{fontSize:"12px",color:e.textMuted},children:["ID: ",s.account_unique_id]})]})]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("button",{style:{padding:"10px 16px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:"ðŸ“ Add Note"}),t.jsx("button",{style:{padding:"10px 16px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"ðŸ“§ Send Email"})]})]})]}),t.jsxs("div",{style:{display:"flex",gap:"24px",padding:"16px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,marginBottom:"24px",flexWrap:"wrap"},children:[(s.person_email||s.email)&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ“§"}),t.jsx("a",{href:`mailto:${s.person_email||s.email}`,style:{color:e.primary,textDecoration:"none",fontSize:"14px"},children:s.person_email||s.email})]}),s.phone&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ“±"}),t.jsx("a",{href:`tel:${s.phone}`,style:{color:e.text,textDecoration:"none",fontSize:"14px"},children:s.phone})]}),(s.billing_street||s.billing_city||s.billing_state)&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ“"}),t.jsx("span",{style:{color:e.textSecondary,fontSize:"14px"},children:[s.billing_street,[s.billing_city,s.billing_state].filter(Boolean).join(", "),s.billing_postal_code].filter(Boolean).join(" â€¢ ")})]}),s.primary_contact_first_name&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"16px"},children:"ðŸ‘¤"}),t.jsxs("span",{style:{color:e.textSecondary,fontSize:"14px"},children:[s.primary_contact_first_name," ",s.primary_contact_last_name]})]})]}),t.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:e.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:I.map(S=>t.jsx("button",{onClick:()=>n(S.id),style:{padding:"10px 20px",backgroundColor:i===S.id?e.bgCard:"transparent",border:"none",borderRadius:"8px",color:i===S.id?e.text:e.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:S.label},S.id))}),i==="overview"&&t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,display:"flex",flexDirection:"column"},children:[t.jsxs("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px",flexShrink:0},children:["Policies (",((D=s.policies)==null?void 0:D.length)||0,")"]}),((E=s.policies)==null?void 0:E.length)>0?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto",flex:1,paddingRight:"8px"},children:s.policies.map((S,_)=>t.jsx(Ro,{policy:S,theme:e},_))}):t.jsx("div",{style:{padding:"30px",textAlign:"center",color:e.textMuted},children:"No policies on file"})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Email Engagement"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"20px"},children:[t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.primary},children:b.emailsSent}),t.jsx("div",{style:{fontSize:"11px",color:e.textMuted},children:"Sent"})]}),t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.success},children:b.opened}),t.jsx("div",{style:{fontSize:"11px",color:e.textMuted},children:"Opened"})]}),t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.warning},children:b.clicked}),t.jsx("div",{style:{fontSize:"11px",color:e.textMuted},children:"Clicked"})]}),t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:e.danger},children:(l==null?void 0:l.filter(S=>S.bounced_at).length)||0}),t.jsx("div",{style:{fontSize:"11px",color:e.textMuted},children:"Bounced"})]})]})]}),t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Compared to Average"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:e.textSecondary},children:"Open Rate"}),t.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:b.openRate>=m.openRate?e.success:e.danger},children:[b.openRate,"%",b.openRate>=m.openRate?" â†‘":" â†“"]})]}),t.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:e.bgHover,borderRadius:"4px",overflow:"hidden"},children:[t.jsx("div",{style:{position:"absolute",left:`${Math.min(m.openRate,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:e.textMuted,zIndex:2}}),t.jsx("div",{style:{width:`${Math.min(b.openRate,100)}%`,height:"100%",backgroundColor:b.openRate>=m.openRate?e.success:e.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[t.jsx("span",{style:{fontSize:"10px",color:e.textMuted},children:"0%"}),t.jsxs("span",{style:{fontSize:"10px",color:e.textMuted},children:["Avg: ",m.openRate,"%"]}),t.jsx("span",{style:{fontSize:"10px",color:e.textMuted},children:"100%"})]})]}),t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[t.jsx("span",{style:{fontSize:"13px",color:e.textSecondary},children:"Click Rate"}),t.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:b.clickRate>=m.clickRate?e.success:e.danger},children:[b.clickRate,"%",b.clickRate>=m.clickRate?" â†‘":" â†“"]})]}),t.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:e.bgHover,borderRadius:"4px",overflow:"hidden"},children:[t.jsx("div",{style:{position:"absolute",left:`${Math.min(m.clickRate*5,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:e.textMuted,zIndex:2}}),t.jsx("div",{style:{width:`${Math.min(b.clickRate*5,100)}%`,height:"100%",backgroundColor:b.clickRate>=m.clickRate?e.success:e.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[t.jsx("span",{style:{fontSize:"10px",color:e.textMuted},children:"0%"}),t.jsxs("span",{style:{fontSize:"10px",color:e.textMuted},children:["Avg: ",m.clickRate,"%"]}),t.jsx("span",{style:{fontSize:"10px",color:e.textMuted},children:"20%+"})]})]}),t.jsxs("div",{style:{padding:"16px",backgroundColor:e.bg,borderRadius:"10px",textAlign:"center",marginTop:"8px"},children:[t.jsx("div",{style:{fontSize:"11px",color:e.textMuted,marginBottom:"4px"},children:"ENGAGEMENT SCORE"}),t.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:b.openRate>=m.openRate&&b.clickRate>=m.clickRate?e.success:b.openRate>=m.openRate||b.clickRate>=m.clickRate?e.warning:e.danger},children:b.emailsSent===0?"â€”":b.openRate>=m.openRate&&b.clickRate>=m.clickRate?"High":b.openRate>=m.openRate||b.clickRate>=m.clickRate?"Medium":"Low"}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary,marginTop:"4px"},children:b.emailsSent===0?"No emails sent yet":b.openRate>=m.openRate?"Above average engagement":"Below average engagement"})]})]})]}),t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Active Automations"}),(v==null?void 0:v.filter(S=>S.status==="active").length)>0?v.filter(S=>S.status==="active").map(S=>t.jsx(pt,{enrollment:S,theme:e,userId:r},S.id)):t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted,fontSize:"13px"},children:"Not enrolled in any automations"})]})]})]}),i==="emails"&&t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Email History"}),h?Array.from({length:3}).map((S,_)=>t.jsx("div",{style:{marginBottom:"12px"},children:t.jsx(_e,{height:"80px"})},_)):(l==null?void 0:l.length)>0?l.map(S=>t.jsx(Ao,{log:S,theme:e},S.id)):t.jsx("div",{style:{padding:"40px",textAlign:"center",color:e.textMuted},children:"No emails sent to this client yet"})]}),i==="automations"&&t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,margin:0},children:"Automation Enrollments"}),t.jsx("button",{style:{padding:"8px 12px",backgroundColor:e.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:"+ Enroll in Automation"})]}),R?Array.from({length:2}).map((S,_)=>t.jsx("div",{style:{marginBottom:"12px"},children:t.jsx(_e,{height:"60px"})},_)):(v==null?void 0:v.length)>0?v.map(S=>t.jsx(pt,{enrollment:S,theme:e,userId:r},S.id)):t.jsx("div",{style:{padding:"40px",textAlign:"center",color:e.textMuted},children:"Not enrolled in any automations"})]}),i==="activity"&&t.jsxs("div",{style:{padding:"20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Activity Timeline"}),p?Array.from({length:5}).map((S,_)=>t.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[t.jsx(_e,{width:"32px",height:"32px"}),t.jsxs("div",{style:{flex:1},children:[t.jsx(_e,{width:"80%",height:"14px"}),t.jsx("div",{style:{marginTop:"4px"},children:t.jsx(_e,{width:"120px",height:"12px"})})]})]},_)):(y==null?void 0:y.length)>0?t.jsx("div",{style:{borderLeft:`2px solid ${e.border}`,marginLeft:"15px",paddingLeft:"20px"},children:y.map(S=>t.jsx(Io,{activity:S,theme:e},S.id))}):t.jsx("div",{style:{padding:"40px",textAlign:"center",color:e.textMuted},children:"No activity recorded yet"})]})]})},He=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),ce=({label:e,value:r,onChange:o,placeholder:a,type:i="text",disabled:n,hint:s,theme:c})=>t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:c.text,display:"block",marginBottom:"6px"},children:e}),t.jsx("input",{type:i,value:r||"",onChange:d=>o(d.target.value),placeholder:a,disabled:n,style:{width:"100%",padding:"12px",backgroundColor:n?c.bgHover:c.bgInput,border:`1px solid ${c.border}`,borderRadius:"8px",color:c.text,fontSize:"14px",opacity:n?.6:1}}),s&&t.jsx("p",{style:{fontSize:"11px",color:c.textMuted,marginTop:"4px"},children:s})]}),Do=({label:e,value:r,onChange:o,placeholder:a,rows:i=3,disabled:n,theme:s})=>t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:s.text,display:"block",marginBottom:"6px"},children:e}),t.jsx("textarea",{value:r||"",onChange:c=>o(c.target.value),placeholder:a,rows:i,disabled:n,style:{width:"100%",padding:"12px",backgroundColor:n?s.bgHover:s.bgInput,border:`1px solid ${s.border}`,borderRadius:"8px",color:s.text,fontSize:"14px",resize:"vertical",opacity:n?.6:1}})]}),To=({settings:e,theme:r})=>t.jsxs("div",{style:{padding:"16px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`},children:[(e==null?void 0:e.full_name)&&t.jsx("div",{style:{fontWeight:"600",color:r.text},children:e.full_name}),(e==null?void 0:e.job_title)&&t.jsx("div",{style:{color:r.textSecondary,fontSize:"14px"},children:e.job_title}),t.jsx("div",{style:{color:r.textSecondary,fontSize:"14px",marginTop:"4px"},children:[e==null?void 0:e.phone,e==null?void 0:e.email].filter(Boolean).join(" Â· ")}),(e==null?void 0:e.custom_message)&&t.jsx("div",{style:{color:r.textMuted,fontSize:"14px",fontStyle:"italic",marginTop:"8px"},children:e.custom_message}),!(e!=null&&e.full_name)&&!(e!=null&&e.job_title)&&t.jsx("div",{style:{color:r.textMuted,fontSize:"14px"},children:"Fill in your details to see a preview"})]}),Mo=({t:e})=>{const{userId:r}=le(),[o,a]=C.useState("signature"),[i,n]=C.useState(!1),[s,c]=C.useState(null),{data:d,isLoading:l,error:h}=eo(),{updateSettings:y,updateSignature:p}=to(),[v,R]=C.useState({full_name:"",job_title:"",phone:"",email:"",custom_message:"",agency_name:"",agency_address:"",agency_phone:"",agency_website:"",default_from_name:"",default_from_email:"",reply_to_email:"",sending_domain:""});C.useEffect(()=>{d&&R({full_name:d.full_name||"",job_title:d.job_title||"",phone:d.phone||"",email:d.email||"",custom_message:d.custom_message||"",agency_name:d.agency_name||"",agency_address:d.agency_address||"",agency_phone:d.agency_phone||"",agency_website:d.agency_website||"",default_from_name:d.default_from_name||"",default_from_email:d.default_from_email||"",reply_to_email:d.reply_to_email||"",sending_domain:d.sending_domain||""})},[d]);const x=D=>E=>{R(S=>({...S,[D]:E})),c(null)},b=async()=>{n(!0),c(null);try{await p.mutateAsync({full_name:v.full_name,job_title:v.job_title,phone:v.phone,email:v.email,custom_message:v.custom_message}),c({type:"success",text:"Signature saved successfully!"})}catch{c({type:"error",text:"Failed to save signature. Please try again."})}finally{n(!1)}},m=async()=>{n(!0),c(null);try{await y.mutateAsync(v),c({type:"success",text:"Settings saved successfully!"})}catch{c({type:"error",text:"Failed to save settings. Please try again."})}finally{n(!1)}},I=[{id:"signature",label:"Email Signature",icon:"ðŸ‘¤"},{id:"agency",label:"Agency Info",icon:"ðŸ¢"},{id:"email",label:"Email Settings",icon:"ðŸ“§"},{id:"integrations",label:"Integrations",icon:"ðŸ”—"}];return t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Settings"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Manage your email preferences and configuration"})]}),h&&t.jsx("div",{style:{padding:"16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:e.danger,fontSize:"14px"},children:"Failed to load settings. Please try refreshing the page."}),s&&t.jsx("div",{style:{padding:"12px 16px",backgroundColor:s.type==="success"?`${e.success}15`:`${e.danger}15`,border:`1px solid ${s.type==="success"?e.success:e.danger}30`,borderRadius:"8px",marginBottom:"24px",color:s.type==="success"?e.success:e.danger,fontSize:"14px"},children:s.text}),t.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:e.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:I.map(D=>t.jsxs("button",{onClick:()=>a(D.id),style:{padding:"10px 20px",backgroundColor:o===D.id?e.bgCard:"transparent",border:"none",borderRadius:"8px",color:o===D.id?e.text:e.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[D.icon," ",D.label]},D.id))}),l?t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx(He,{width:"200px",height:"24px"}),t.jsx("div",{style:{marginTop:"24px"},children:t.jsx(He,{height:"40px"})}),t.jsx("div",{style:{marginTop:"16px"},children:t.jsx(He,{height:"40px"})})]}):t.jsxs(t.Fragment,{children:[o==="signature"&&t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Your Email Signature"}),t.jsx("p",{style:{fontSize:"13px",color:e.textSecondary,marginBottom:"24px"},children:"This signature will be automatically added to all emails you send through the platform"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[t.jsx(ce,{label:"Full Name",value:v.full_name,onChange:x("full_name"),placeholder:"John Doe",theme:e}),t.jsx(ce,{label:"Job Title",value:v.job_title,onChange:x("job_title"),placeholder:"Insurance Advisor",theme:e}),t.jsx(ce,{label:"Phone Number",value:v.phone,onChange:x("phone"),placeholder:"(555) 123-4567",theme:e}),t.jsx(ce,{label:"Email Address",value:v.email,onChange:x("email"),placeholder:"john.doe@company.com",type:"email",theme:e})]}),t.jsx(Do,{label:"Custom Message (Optional)",value:v.custom_message,onChange:x("custom_message"),placeholder:"Looking forward to serving you!",theme:e}),t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:e.text,display:"block",marginBottom:"8px"},children:"Preview"}),t.jsx(To,{settings:v,theme:e})]}),t.jsx("button",{onClick:b,disabled:i,style:{padding:"12px 24px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:i?"wait":"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px",opacity:i?.7:1},children:i?"ðŸ’¾ Saving...":"ðŸ’¾ Save Signature"})]}),o==="agency"&&t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Agency Information"}),t.jsx("p",{style:{fontSize:"13px",color:e.textSecondary,marginBottom:"24px"},children:"Your agency details used in email templates and footers"}),t.jsx(ce,{label:"Agency Name",value:v.agency_name,onChange:x("agency_name"),placeholder:"Insurance Solutions Group",theme:e}),t.jsx(ce,{label:"Address",value:v.agency_address,onChange:x("agency_address"),placeholder:"123 Main Street, Suite 100, Dallas, TX 75201",theme:e}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[t.jsx(ce,{label:"Phone",value:v.agency_phone,onChange:x("agency_phone"),placeholder:"(555) 000-0000",theme:e}),t.jsx(ce,{label:"Website",value:v.agency_website,onChange:x("agency_website"),placeholder:"https://www.example.com",theme:e})]}),t.jsx("button",{onClick:m,disabled:i,style:{padding:"12px 24px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:i?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:i?.7:1},children:i?"ðŸ’¾ Saving...":"ðŸ’¾ Save Agency Info"})]}),o==="email"&&t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"4px"},children:"Email Configuration"}),t.jsx("p",{style:{fontSize:"13px",color:e.textSecondary},children:"Configure your sending domain and default email settings"})]}),t.jsx("span",{style:{padding:"4px 10px",backgroundColor:e.bgHover,borderRadius:"20px",fontSize:"11px",color:e.textSecondary},children:"Admin Only"})]}),t.jsx(ce,{label:"Sending Domain",value:v.sending_domain,onChange:x("sending_domain"),placeholder:"emails.yourcompany.com",hint:"The domain that will be used to send emails. Must be verified in SendGrid.",theme:e}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[t.jsx(ce,{label:"Default From Name",value:v.default_from_name,onChange:x("default_from_name"),placeholder:"Your Company",theme:e}),t.jsx(ce,{label:"Default From Email",value:v.default_from_email,onChange:x("default_from_email"),placeholder:"noreply@yourcompany.com",type:"email",theme:e})]}),t.jsx(ce,{label:"Reply-To Email",value:v.reply_to_email,onChange:x("reply_to_email"),placeholder:"support@yourcompany.com",type:"email",hint:"Where replies will be directed when recipients respond to automated emails.",theme:e}),t.jsx("button",{onClick:m,disabled:i,style:{padding:"12px 24px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:i?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:i?.7:1},children:i?"ðŸ’¾ Saving...":"ðŸ’¾ Save Configuration"})]}),o==="integrations"&&t.jsxs("div",{style:{padding:"24px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"24px"},children:"Integrations"}),t.jsx("div",{style:{padding:"20px",backgroundColor:e.bg,borderRadius:"10px",border:`1px solid ${e.border}`,marginBottom:"16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[t.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#1A82E2",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SG"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"600",color:e.text,marginBottom:"2px"},children:"SendGrid"}),t.jsx("div",{style:{fontSize:"13px",color:e.textSecondary},children:"Email delivery service"})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${e.success}20`,color:e.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),t.jsx("button",{style:{padding:"8px 12px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"6px",color:e.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Configure"})]})]})}),t.jsx("div",{style:{padding:"20px",backgroundColor:e.bg,borderRadius:"10px",border:`1px solid ${e.border}`,marginBottom:"16px"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[t.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#00A1E0",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SF"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"600",color:e.text,marginBottom:"2px"},children:"Salesforce"}),t.jsx("div",{style:{fontSize:"13px",color:e.textSecondary},children:"CRM data sync"})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${e.success}20`,color:e.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),t.jsx("button",{style:{padding:"8px 12px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"6px",color:e.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Sync Now"})]})]})}),t.jsxs("div",{style:{padding:"16px",backgroundColor:`${e.primary}10`,borderRadius:"8px",marginTop:"24px"},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:e.text,marginBottom:"4px"},children:"ðŸ“Œ Webhook URL"}),t.jsx("div",{style:{fontSize:"12px",color:e.textSecondary,marginBottom:"8px"},children:"Configure this URL in SendGrid to receive email event notifications"}),t.jsxs("code",{style:{display:"block",padding:"8px 12px",backgroundColor:e.bgCard,borderRadius:"6px",fontSize:"12px",color:e.primary,wordBreak:"break-all"},children:["https://your-app-url.com/api/webhooks/sendgrid/",r]})]})]})]})]})},Ve=[{value:"account_status",label:"Account Status",type:"select",options:[{value:"customer",label:"Customer"},{value:"prospect",label:"Prospect"},{value:"prior_customer",label:"Prior Customer"},{value:"lead",label:"Lead"}]},{value:"policy_type",label:"Policy Type",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"active_policy_type",label:"Has Active Policy",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"policy_status",label:"Policy Status",type:"select",options:[{value:"active",label:"Active"},{value:"pending active",label:"Pending Active"},{value:"cancelled",label:"Cancelled"},{value:"expired",label:"Expired"}]},{value:"policy_class",label:"Policy Class",type:"select",options:[{value:"Personal",label:"Personal"},{value:"Commercial",label:"Commercial"}]},{value:"policy_count",label:"Number of Policies",type:"number"},{value:"policy_term",label:"Policy Term",type:"select",options:[{value:"6",label:"6 Months"},{value:"12",label:"12 Months"}]},{value:"policy_effective",label:"Policy Effective Date",type:"date"},{value:"policy_expiration",label:"Policy Expiration",type:"date"},{value:"state",label:"State",type:"select",options:[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}]},{value:"city",label:"City",type:"text"},{value:"zip_code",label:"ZIP Code",type:"text"},{value:"email_domain",label:"Email Domain",type:"text"},{value:"last_email_sent",label:"Last Email Sent",type:"date"},{value:"account_created",label:"Account Created",type:"date"}],Rt={select:[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"is_any",label:"is any of"},{value:"is_not_any",label:"is not any of"}],number:[{value:"equals",label:"equals"},{value:"greater_than",label:"greater than"},{value:"less_than",label:"less than"},{value:"at_least",label:"at least"},{value:"at_most",label:"at most"},{value:"between",label:"is between"}],date:[{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"between",label:"is between"},{value:"in_next_days",label:"is in the next"},{value:"in_last_days",label:"was in the last"},{value:"more_than_days_future",label:"is more than X days from now"},{value:"less_than_days_future",label:"is less than X days from now"},{value:"more_than_days_ago",label:"was more than X days ago"},{value:"less_than_days_ago",label:"was less than X days ago"}],text:[{value:"contains",label:"contains"},{value:"not_contains",label:"does not contain"},{value:"equals",label:"equals"},{value:"not_equals",label:"does not equal"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"},{value:"is_empty",label:"is empty"},{value:"is_not_empty",label:"is not empty"}]},Wo=[{label:"Renewals (30 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"30"}},{label:"Renewals (60 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"60"}},{label:"Renewals (90 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"90"}},{label:"New Customers (90 days)",filter:{field:"account_created",operator:"in_last_days",value:"90"}},{label:"Active Customers",filter:{field:"account_status",operator:"is",value:"customer"}},{label:"Cross-Sell: Auto Only",filters:[{field:"active_policy_type",operator:"is",value:"Auto"},{field:"active_policy_type",operator:"is_not",value:"Home"}]},{label:"Cross-Sell: Home Only",filters:[{field:"active_policy_type",operator:"is",value:"Home"},{field:"active_policy_type",operator:"is_not",value:"Auto"}]},{label:"Prior Customers",filter:{field:"account_status",operator:"is",value:"prior_customer"}},{label:"Prospects",filter:{field:"account_status",operator:"is",value:"prospect"}}],Bo=(e,r)=>{const a=(Rt[e]||[]).find(i=>i.value===r);return(a==null?void 0:a.label)||r},ut=e=>{const r=Ve.find(n=>n.value===e.field);if(!r)return null;const o=r.label,a=Bo(r.type,e.operator);let i=e.value;if(r.type==="select"&&r.options)if(e.operator==="is_any"||e.operator==="is_not_any")i=(e.value||"").split(",").map(s=>{const c=r.options.find(d=>d.value===s);return(c==null?void 0:c.label)||s}).join(", ");else{const n=r.options.find(s=>s.value===e.value);i=(n==null?void 0:n.label)||e.value}return e.operator==="is_empty"||e.operator==="is_not_empty"?`${o} ${a}`:e.operator==="between"&&e.value2?`${o} ${a} ${e.value} and ${e.value2}`:e.operator==="in_next_days"||e.operator==="in_last_days"?`${o} ${a} ${e.value} days`:e.operator==="more_than_days_future"?`${o} is more than ${e.value} days from now`:e.operator==="less_than_days_future"?`${o} is less than ${e.value} days from now`:e.operator==="more_than_days_ago"?`${o} was more than ${e.value} days ago`:e.operator==="less_than_days_ago"?`${o} was less than ${e.value} days ago`:`${o} ${a} ${i}`},Eo=({rule:e,index:r,onUpdate:o,onRemove:a,theme:i})=>{const n=Ve.find(l=>l.value===e.field),s=n?Rt[n.type]:[],c={padding:"8px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.text,fontSize:"13px",minWidth:"140px"},d={padding:"8px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.text,fontSize:"13px",width:"120px"};return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:i.bgCard,borderRadius:"8px",border:`1px solid ${i.border}`,flexWrap:"wrap"},children:[r>0&&t.jsx("span",{style:{fontSize:"12px",color:i.primary,fontWeight:"600",padding:"4px 8px",backgroundColor:`${i.primary}15`,borderRadius:"4px"},children:"AND"}),t.jsxs("select",{value:e.field||"",onChange:l=>o(r,{...e,field:l.target.value,operator:"",value:""}),style:c,children:[t.jsx("option",{value:"",children:"Select field..."}),Ve.map(l=>t.jsx("option",{value:l.value,children:l.label},l.value))]}),e.field&&t.jsxs("select",{value:e.operator||"",onChange:l=>o(r,{...e,operator:l.target.value}),style:c,children:[t.jsx("option",{value:"",children:"Select condition..."}),s.map(l=>t.jsx("option",{value:l.value,children:l.label},l.value))]}),e.field&&e.operator&&t.jsxs(t.Fragment,{children:[(n==null?void 0:n.type)==="select"&&!["is_any","is_not_any"].includes(e.operator)&&t.jsxs("select",{value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),style:c,children:[t.jsx("option",{value:"",children:"Select value..."}),n.options.map(l=>t.jsx("option",{value:l.value,children:l.label},l.value))]}),(n==null?void 0:n.type)==="select"&&["is_any","is_not_any"].includes(e.operator)&&t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:n.options.map(l=>t.jsx("button",{onClick:()=>{const h=e.value?e.value.split(","):[],y=h.includes(l.value)?h.filter(p=>p!==l.value):[...h,l.value];o(r,{...e,value:y.join(",")})},style:{padding:"4px 10px",backgroundColor:(e.value||"").split(",").includes(l.value)?i.primary:i.bgHover,color:(e.value||"").split(",").includes(l.value)?"#fff":i.text,border:`1px solid ${(e.value||"").split(",").includes(l.value)?i.primary:i.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:l.label},l.value))}),(n==null?void 0:n.type)==="number"&&e.operator!=="between"&&t.jsx("input",{type:"number",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),placeholder:"0",style:d}),(n==null?void 0:n.type)==="number"&&e.operator==="between"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),placeholder:"Min",style:{...d,width:"80px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"and"}),t.jsx("input",{type:"number",value:e.value2||"",onChange:l=>o(r,{...e,value2:l.target.value}),placeholder:"Max",style:{...d,width:"80px"}})]}),(n==null?void 0:n.type)==="date"&&e.operator==="in_next_days"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),placeholder:"30",style:{...d,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&e.operator==="in_last_days"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),placeholder:"30",style:{...d,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&e.operator==="between"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"date",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),style:d}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"and"}),t.jsx("input",{type:"date",value:e.value2||"",onChange:l=>o(r,{...e,value2:l.target.value}),style:d})]}),(n==null?void 0:n.type)==="date"&&(e.operator==="before"||e.operator==="after")&&t.jsx("input",{type:"date",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),style:d}),(n==null?void 0:n.type)==="date"&&["more_than_days_future","less_than_days_future","more_than_days_ago","less_than_days_ago"].includes(e.operator)&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),placeholder:"30",min:"1",style:{...d,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="text"&&!["is_empty","is_not_empty"].includes(e.operator)&&t.jsx("input",{type:"text",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),placeholder:`Enter ${n.label.toLowerCase()}...`,style:{...d,width:"160px"}})]}),t.jsx("button",{onClick:()=>a(r),style:{marginLeft:"auto",padding:"6px 10px",backgroundColor:"transparent",border:"none",color:i.textMuted,cursor:"pointer",fontSize:"16px",borderRadius:"4px"},title:"Remove filter",children:"Ã—"})]})},qo=({group:e,groupIndex:r,onRemoveGroup:o,onDuplicateGroup:a,onAddRule:i,onUpdateRule:n,onRemoveRule:s,theme:c})=>{const d=e.rules||[];return t.jsxs("div",{style:{padding:"16px",backgroundColor:c.bgCard,borderRadius:"12px",border:`2px solid ${c.border}`,position:"relative"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[t.jsxs("span",{style:{fontSize:"12px",fontWeight:"600",color:c.textSecondary,textTransform:"uppercase",letterSpacing:"0.5px"},children:["Group ",r+1]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[a&&t.jsxs("button",{onClick:()=>a(r),style:{padding:"4px 8px",backgroundColor:"transparent",border:`1px solid ${c.border}`,color:c.textSecondary,cursor:"pointer",fontSize:"12px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"4px"},title:"Duplicate group",children:[t.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),t.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),"Duplicate"]}),t.jsx("button",{onClick:()=>o(r),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:c.textMuted,cursor:"pointer",fontSize:"12px",borderRadius:"4px"},title:"Remove group",children:"Remove"})]})]}),d.length===0?t.jsx("div",{style:{textAlign:"center",padding:"12px",color:c.textMuted,fontSize:"13px"},children:"Add filters to this group"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:d.map((l,h)=>t.jsx(Eo,{rule:l,index:h,onUpdate:(y,p)=>n(r,y,p),onRemove:y=>s(r,y),theme:c},h))}),t.jsxs("button",{onClick:()=>i(r),style:{width:"100%",padding:"8px",backgroundColor:c.bgHover,border:`1px dashed ${c.border}`,borderRadius:"6px",color:c.primary,cursor:"pointer",fontSize:"12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[t.jsx("span",{children:"+"})," Add Filter to Group"]})]})},Lo=({groups:e,onApplyFilter:r,theme:o,filters:a=Wo})=>t.jsxs("div",{style:{padding:"16px",backgroundColor:o.bgCard,borderRadius:"12px",border:`1px solid ${o.border}`,marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:o.textSecondary,marginBottom:"10px"},children:"Quick Filters"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:a.map((i,n)=>t.jsxs("button",{onClick:()=>r(i),style:{padding:"6px 12px",backgroundColor:o.bgHover,border:`1px solid ${o.border}`,borderRadius:"16px",color:o.text,cursor:"pointer",fontSize:"12px",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:s=>{s.target.style.backgroundColor=o.primary+"20",s.target.style.borderColor=o.primary,s.target.style.color=o.primary},onMouseLeave:s=>{s.target.style.backgroundColor=o.bgHover,s.target.style.borderColor=o.border,s.target.style.color=o.text},children:["+ ",i.label]},n))})]}),Po=({filterConfig:e,setFilterConfig:r,recipientCount:o,isLoading:a,onPreviewClick:i,showQuickFilters:n=!0,theme:s})=>{var I;const c=(e==null?void 0:e.groups)||(((I=e==null?void 0:e.rules)==null?void 0:I.length)>0?[{rules:e.rules}]:[]),d=c.length>0,l=()=>{const D=[...c,{rules:[{field:"",operator:"",value:""}]}];r({...e,groups:D,rules:void 0})},h=D=>{const E=c.filter((S,_)=>_!==D);r({...e,groups:E,rules:void 0})},y=D=>{const S={rules:(c[D].rules||[]).map(W=>({...W}))},_=[...c];_.splice(D+1,0,S),r({...e,groups:_,rules:void 0})},p=D=>{const E=[...c];E[D]={...E[D],rules:[...E[D].rules||[],{field:"",operator:"",value:""}]},r({...e,groups:E,rules:void 0})},v=(D,E,S)=>{const _=[...c],W=[..._[D].rules||[]];W[E]=S,_[D]={..._[D],rules:W},r({...e,groups:_,rules:void 0})},R=(D,E)=>{const S=[...c];S[D]={...S[D],rules:S[D].rules.filter((_,W)=>W!==E)},S[D].rules.length===0&&S.splice(D,1),r({...e,groups:S,rules:void 0})},x=()=>{r({...e,groups:[],rules:void 0})},b=D=>{if(D.filters){const E={rules:D.filters};r({...e,groups:[...c,E],rules:void 0})}else{const E={rules:[D.filter]};r({...e,groups:[...c,E],rules:void 0})}},m=c.reduce((D,E)=>D+(E.rules||[]).filter(S=>S.field&&S.operator&&(S.value||["is_empty","is_not_empty"].includes(S.operator))).length,0);return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:s.text,margin:0},children:"Filter Recipients"}),d&&t.jsx("button",{onClick:x,style:{padding:"6px 12px",backgroundColor:"transparent",border:`1px solid ${s.border}`,borderRadius:"6px",color:s.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Clear all"})]}),n&&t.jsx(Lo,{groups:c,onApplyFilter:b,theme:s}),t.jsxs("div",{style:{padding:"16px",backgroundColor:s.bgHover,borderRadius:"12px",marginBottom:"16px"},children:[d?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},children:c.map((D,E)=>t.jsxs("div",{children:[E>0&&t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"8px 0",gap:"12px"},children:[t.jsx("div",{style:{flex:1,height:"1px",backgroundColor:s.border}}),t.jsx("span",{style:{fontSize:"12px",fontWeight:"700",color:"#f59e0b",padding:"4px 12px",backgroundColor:"#f59e0b20",borderRadius:"4px",textTransform:"uppercase",letterSpacing:"1px"},children:"OR"}),t.jsx("div",{style:{flex:1,height:"1px",backgroundColor:s.border}})]}),t.jsx(qo,{group:D,groupIndex:E,onRemoveGroup:h,onDuplicateGroup:y,onAddRule:p,onUpdateRule:v,onRemoveRule:R,theme:s})]},E))}):t.jsx("div",{style:{textAlign:"center",padding:"20px",color:s.textMuted,fontSize:"14px"},children:"No filters applied. All matching records will be included."}),t.jsxs("button",{onClick:l,style:{width:"100%",padding:"10px",backgroundColor:s.bgCard,border:`1px dashed ${s.border}`,borderRadius:"8px",color:s.primary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," ",d?"Add OR Group":"Add Filter Group"]})]}),m>0&&t.jsxs("div",{style:{padding:"12px 16px",backgroundColor:`${s.primary}10`,borderRadius:"8px",marginBottom:"16px",fontSize:"13px",color:s.text},children:[t.jsx("strong",{children:m})," filter",m!==1?"s":""," in ",t.jsx("strong",{children:c.length})," group",c.length!==1?"s":"",c.length>1&&t.jsx("span",{style:{color:s.textSecondary},children:" (groups combined with OR)"})]}),o!==void 0&&t.jsxs("button",{onClick:i,disabled:a||o===0||!i,style:{width:"100%",padding:"20px",backgroundColor:`${s.primary}10`,borderRadius:"12px",border:`1px solid ${s.primary}30`,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:a||o===0||!i?"default":"pointer",textAlign:"left",transition:"all 0.2s"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:s.text},children:"Matching Recipients"}),t.jsx("div",{style:{fontSize:"12px",color:s.textSecondary},children:o>0&&i?"Click to view matching accounts":"Accounts matching your criteria"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:s.primary},children:a?"...":(o??0).toLocaleString()}),!a&&o>0&&i&&t.jsx("div",{style:{padding:"6px 10px",backgroundColor:s.primary,color:"#fff",borderRadius:"6px",fontSize:"12px",fontWeight:"500"},children:"View"})]})]})]})},Oo={bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},Fo=[{id:"entry-criteria",type:"entry_criteria",title:"Entry Criteria",subtitle:"Define who enters this automation",config:{filterConfig:{groups:[]},reentry:{enabled:!1,type:"never",days:30},pacing:{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}}},{id:"trigger",type:"trigger",title:"Trigger",subtitle:"Daily at 09:00 (Central)",config:{time:"09:00",timezone:"America/Chicago",frequency:"Daily"}},{id:"node-1",type:"send_email",title:"Send Email",subtitle:"Select template...",config:{template:""}}],No=({t:e,automation:r,onUpdate:o,onSave:a,canEdit:i=!0})=>{var We,Be,Ee,Ae,ue,re,me,Ze,Xe,et,tt,ot,rt,nt,at,it,st;const n=e||Oo,s=()=>{if(!(r!=null&&r.nodes)||r.nodes.length===0)return Fo;const k=r.nodes.some(Y=>Y.type==="entry_criteria"),U={id:"entry-criteria",type:"entry_criteria",title:"Entry Criteria",subtitle:"Define who enters this automation",config:{filterConfig:r.filter_config||{groups:[]},reentry:{enabled:!1,type:"never",days:30},pacing:{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}}};let F=r.nodes.map(Y=>{var ge,ie,de;return Y.type==="entry_criteria"?{...Y,config:{...Y.config,filterConfig:((ge=Y.config)==null?void 0:ge.filterConfig)||r.filter_config||{groups:[]},reentry:((ie=Y.config)==null?void 0:ie.reentry)||{enabled:!1,type:"never",days:30},pacing:((de=Y.config)==null?void 0:de.pacing)||{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}}}:Y});return k||(F=[U,...F]),F},[c,d]=C.useState(s),[l,h]=C.useState(null),[y,p]=C.useState(null),[v,R]=C.useState(!1),[x,b]=C.useState(!1),[m,I]=C.useState(null),{data:D=[],isLoading:E}=Je(),S=(r==null?void 0:r.nodeStats)||{},_=c.find(k=>k.type==="entry_criteria"),[W,V]=C.useState(((We=_==null?void 0:_.config)==null?void 0:We.filterConfig)||{groups:[]}),[T,q]=C.useState(((Be=_==null?void 0:_.config)==null?void 0:Be.reentry)||{enabled:!1,type:"never",days:30}),[P,K]=C.useState(((Ee=_==null?void 0:_.config)==null?void 0:Ee.pacing)||{enabled:!1,spreadOverDays:7,allowedDays:["mon","tue","wed","thu","fri"]}),L=k=>{V(k),d(U=>U.map(F=>F.type==="entry_criteria"?{...F,config:{...F.config,filterConfig:k}}:F))},N=k=>{q(k),d(U=>U.map(F=>F.type==="entry_criteria"?{...F,config:{...F.config,reentry:k}}:F))},O=k=>{K(k),d(U=>U.map(F=>F.type==="entry_criteria"?{...F,config:{...F.config,pacing:k}}:F))},B=C.useRef(null);C.useEffect(()=>(o&&(B.current&&clearTimeout(B.current),B.current=setTimeout(()=>{o(k=>({...k,nodes:c,filter_config:W}))},100)),()=>{B.current&&clearTimeout(B.current)}),[c,W,T,P]);const u=(Ae=W==null?void 0:W.groups)==null?void 0:Ae.some(k=>{var U;return(U=k.rules)==null?void 0:U.some(F=>F.field&&F.operator)}),{data:A,isLoading:G}=Ke(x&&u?W:null,{limit:500}),{data:Q,isLoading:Z}=kt(u?W:null),$={entry_criteria:{icon:"ðŸŽ¯",color:"#8b5cf6",label:"Entry Criteria"},trigger:{icon:"âš¡",color:n.primary,label:"Trigger"},send_email:{icon:"ðŸ“§",color:n.success,label:"Send Email"},delay:{icon:"â±",color:n.warning,label:"Delay"},condition:{icon:"ðŸ”€",color:n.purple,label:"Condition"},field_condition:{icon:"ðŸ“‹",color:"#ec4899",label:"Field Check"},update_field:{icon:"âœï¸",color:"#06b6d4",label:"Update Field"},end:{icon:"ðŸ",color:n.textMuted,label:"End"}},w=[{type:"send_email",label:"Send Email",desc:"Send an email template",icon:"ðŸ“§"},{type:"delay",label:"Delay",desc:"Wait before continuing",icon:"â±"},{type:"condition",label:"Email Engagement",desc:"Branch on open/click",icon:"ðŸ“¬"},{type:"field_condition",label:"Field Condition",desc:"Branch on field value",icon:"ðŸ”€"},{type:"update_field",label:"Update Field",desc:"Update a record field",icon:"âœï¸"},{type:"end",label:"End",desc:"Stop automation",icon:"ðŸ"}],f=(k,U,F=null)=>{var ge;const Y={id:`node-${Date.now()}`,type:U,title:((ge=w.find(ie=>ie.type===U))==null?void 0:ge.label)||U,subtitle:"Configure...",config:{}};if((U==="condition"||U==="field_condition")&&(Y.branches={yes:[],no:[]}),F)d(ie=>{const de=te=>te.map(fe=>fe.id===k&&fe.branches?{...fe,branches:{...fe.branches,[F]:[...fe.branches[F],Y]}}:fe.branches?{...fe,branches:{yes:de(fe.branches.yes),no:de(fe.branches.no)}}:fe);return de(ie)});else{const ie=c.findIndex(te=>te.id===k),de=[...c];de.splice(ie+1,0,Y),d(de)}p(null),h(Y.id)},z=k=>{d(U=>U.filter(F=>F.id!==k&&F.id!=="trigger"&&F.id!=="entry-criteria")),l===k&&h(null)},j=()=>{const k=(W==null?void 0:W.groups)||[],U=k.reduce((F,Y)=>{var ge;return F+(((ge=Y.rules)==null?void 0:ge.filter(ie=>ie.field&&ie.operator).length)||0)},0);return U===0?"No filters defined":`${U} filter${U!==1?"s":""} in ${k.length} group${k.length!==1?"s":""}`},M=(k,U)=>{const F=S[k]||{};return U==="entry_criteria"?F.entered?`${F.entered.toLocaleString()} entered`:null:U==="trigger"?F.processed?`${F.processed.toLocaleString()} processed`:null:U==="send_email"&&F.sent?`${F.sent.toLocaleString()} sent`:U==="delay"?F.waiting?`${F.waiting.toLocaleString()} waiting`:null:(U==="condition"||U==="field_condition")&&F.evaluated?`${F.evaluated.toLocaleString()} evaluated`:null},ze=({node:k})=>{const U=$[k.type]||$.send_email,F=l===k.id,Y=k.type==="entry_criteria",ge=k.type==="trigger",ie=Y||ge,de=M(k.id,k.type);return t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[t.jsxs("div",{onClick:()=>{h(k.id)},style:{width:"320px",backgroundColor:n.bgCard,border:F?`2px solid ${U.color}`:`1px solid ${n.border}`,borderRadius:"12px",padding:"16px 18px",cursor:"pointer",position:"relative"},children:[de&&t.jsx("div",{style:{position:"absolute",top:"-10px",right:"12px",padding:"4px 10px",backgroundColor:U.color,color:"#fff",borderRadius:"12px",fontSize:"11px",fontWeight:"600",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:de}),!ie&&t.jsx("button",{onClick:te=>{te.stopPropagation(),z(k.id)},style:{position:"absolute",top:"8px",right:"8px",background:"none",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"16px"},children:"Ã—"}),t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[t.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${U.color}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:U.icon}),t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:n.text},children:k.title}),t.jsx("div",{style:{fontSize:"12px",color:n.textMuted,marginTop:"2px"},children:Y?j():k.subtitle})]})]}),Y&&t.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[t.jsxs("button",{onClick:te=>{te.stopPropagation(),R(!0)},style:{flex:1,padding:"10px",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,borderRadius:"8px",color:n.textSecondary,cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:"ðŸŽ¯"})," Edit Criteria"]}),t.jsxs("button",{onClick:te=>{te.stopPropagation(),b(!0)},style:{flex:1,padding:"10px",backgroundColor:n.primary+"15",border:`1px solid ${n.primary}40`,borderRadius:"8px",color:n.primary,cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:"ðŸ‘¥"})," Preview ",u&&Q!==void 0&&!Z&&t.jsx("span",{style:{backgroundColor:n.primary,color:"#fff",padding:"2px 6px",borderRadius:"10px",fontSize:"10px",fontWeight:"600"},children:Q})]})]})]}),!k.branches&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.borderLight}}),t.jsx("button",{onClick:()=>p({afterNodeId:k.id,branch:null}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,color:n.textMuted,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"}),t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.borderLight}}),(y==null?void 0:y.afterNodeId)===k.id&&!(y!=null&&y.branch)&&t.jsx(Re,{onSelect:te=>f(k.id,te),onClose:()=>p(null)})]}),k.branches&&t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.borderLight}}),t.jsxs("div",{style:{display:"flex"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:n.success}}),t.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#22c55e20",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:n.success},children:"YES"})]}),t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.success}}),k.branches.yes.map(te=>t.jsx(ze,{node:te},te.id)),t.jsx("button",{onClick:()=>p({afterNodeId:k.id,branch:"yes"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:n.bgHover,border:"1px dashed #22c55e",color:n.success,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(y==null?void 0:y.afterNodeId)===k.id&&(y==null?void 0:y.branch)==="yes"&&t.jsx(Re,{onSelect:te=>f(k.id,te,"yes"),onClose:()=>p(null)})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#ef444420",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:n.danger},children:"NO"}),t.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:n.danger}})]}),t.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n.danger}}),k.branches.no.map(te=>t.jsx(ze,{node:te},te.id)),t.jsx("button",{onClick:()=>p({afterNodeId:k.id,branch:"no"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:n.bgHover,border:"1px dashed #ef4444",color:n.danger,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(y==null?void 0:y.afterNodeId)===k.id&&(y==null?void 0:y.branch)==="no"&&t.jsx(Re,{onSelect:te=>f(k.id,te,"no"),onClose:()=>p(null)})]})]})]})]})},Re=({onSelect:k,onClose:U})=>t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:U}),t.jsx("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"10px",backgroundColor:n.bgCard,border:`1px solid ${n.borderLight}`,borderRadius:"12px",padding:"8px",zIndex:100,width:"240px",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},children:w.map(F=>t.jsxs("button",{onClick:()=>k(F.type),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px",color:n.text,textAlign:"left"},children:[t.jsx("span",{style:{fontSize:"18px"},children:F.icon}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500"},children:F.label}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:F.desc})]})]},F.type))})]}),ee=c.find(k=>k.id===l)||c.flatMap(k=>k.branches?[...k.branches.yes||[],...k.branches.no||[]]:[]).find(k=>k.id===l);return t.jsxs("div",{style:{fontFamily:"'IBM Plex Sans', -apple-system, sans-serif",backgroundColor:n.bg,height:"100%",color:n.text,display:"flex"},children:[t.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[t.jsxs("div",{style:{width:"220px",borderRight:`1px solid ${n.border}`,padding:"16px",backgroundColor:n.bgCard,overflowY:"auto"},children:[t.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:n.textMuted,marginBottom:"12px",textTransform:"uppercase"},children:"Add Nodes"}),w.map(k=>t.jsxs("div",{style:{padding:"12px",backgroundColor:n.bgHover,borderRadius:"8px",marginBottom:"8px",cursor:"grab",display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{fontSize:"18px"},children:k.icon}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:n.text},children:k.label}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:k.desc})]})]},k.type))]}),t.jsx("div",{style:{flex:1,padding:"40px",overflowY:"auto",display:"flex",justifyContent:"center"},children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[c.map(k=>t.jsx(ze,{node:k},k.id)),t.jsx("div",{style:{marginTop:"16px",padding:"8px 18px",backgroundColor:n.bgHover,borderRadius:"20px",fontSize:"12px",color:n.textMuted},children:"End of automation"})]})}),t.jsxs("div",{style:{width:"300px",borderLeft:`1px solid ${n.border}`,backgroundColor:n.bgCard,overflowY:"auto"},children:[t.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${n.border}`,fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase"},children:"Configuration"}),t.jsx("div",{style:{padding:"18px"},children:ee?t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[t.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${((ue=$[ee.type])==null?void 0:ue.color)||n.primary}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:((re=$[ee.type])==null?void 0:re.icon)||"ðŸ“§"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"600",color:n.text,fontSize:"15px"},children:ee.title}),t.jsx("div",{style:{fontSize:"12px",color:n.textMuted},children:((me=$[ee.type])==null?void 0:me.label)||"Node"})]})]}),ee.type==="entry_criteria"&&t.jsxs("div",{children:[t.jsx("p",{style:{fontSize:"13px",color:n.textSecondary,marginBottom:"16px"},children:"Define which accounts enter this automation based on their attributes."}),((W==null?void 0:W.groups)||[]).length>0&&t.jsxs("div",{style:{padding:"12px",backgroundColor:n.bgHover,borderRadius:"8px",marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:n.textMuted,marginBottom:"8px",textTransform:"uppercase"},children:"Current Filters"}),W.groups.map((k,U)=>t.jsxs("div",{style:{marginBottom:U<W.groups.length-1?"8px":0},children:[U>0&&t.jsx("div",{style:{fontSize:"10px",color:"#f59e0b",fontWeight:"700",textAlign:"center",margin:"6px 0"},children:"OR"}),(k.rules||[]).filter(F=>F.field&&F.operator).map((F,Y)=>t.jsx("div",{style:{padding:"4px 8px",backgroundColor:`${n.primary}15`,borderRadius:"4px",fontSize:"11px",color:n.text,marginBottom:"4px"},children:ut(F)},Y))]},U))]}),t.jsx("button",{onClick:()=>R(!0),style:{width:"100%",padding:"12px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",marginBottom:"20px"},children:"Edit Entry Criteria"}),t.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgHover,borderRadius:"8px",marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:n.text,marginBottom:"12px"},children:"Re-entry Rules"}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",marginBottom:"12px"},children:[t.jsx("input",{type:"checkbox",checked:T.enabled,onChange:k=>N({...T,enabled:k.target.checked}),style:{width:"16px",height:"16px",accentColor:n.primary}}),t.jsx("span",{style:{fontSize:"13px",color:n.textSecondary},children:"Allow contacts to re-enter"})]}),T.enabled&&t.jsx("div",{style:{marginLeft:"26px"},children:t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px",cursor:"pointer"},children:[t.jsx("input",{type:"radio",name:"reentryType",checked:T.type==="after_days",onChange:()=>N({...T,type:"after_days"}),style:{accentColor:n.primary}}),t.jsx("span",{style:{fontSize:"12px",color:n.textSecondary},children:"After"}),t.jsx("input",{type:"number",value:T.days,onChange:k=>N({...T,days:parseInt(k.target.value)||1}),min:"1",style:{width:"60px",padding:"4px 8px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"4px",color:n.text,fontSize:"12px"}}),t.jsx("span",{style:{fontSize:"12px",color:n.textSecondary},children:"days"})]})}),!T.enabled&&t.jsx("p",{style:{fontSize:"11px",color:n.textMuted,margin:0},children:"Contacts can only enter this automation once"})]}),t.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgHover,borderRadius:"8px"},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:n.text,marginBottom:"12px"},children:"Enrollment Pacing"}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",marginBottom:"12px"},children:[t.jsx("input",{type:"checkbox",checked:P.enabled,onChange:k=>O({...P,enabled:k.target.checked}),style:{width:"16px",height:"16px",accentColor:n.primary}}),t.jsx("span",{style:{fontSize:"13px",color:n.textSecondary},children:"Spread enrollments over time"})]}),P.enabled&&t.jsxs("div",{style:{marginLeft:"26px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[t.jsx("span",{style:{fontSize:"12px",color:n.textSecondary},children:"Spread over"}),t.jsx("input",{type:"number",value:P.spreadOverDays,onChange:k=>O({...P,spreadOverDays:parseInt(k.target.value)||1}),min:"1",max:"365",style:{width:"60px",padding:"4px 8px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"4px",color:n.text,fontSize:"12px"}}),t.jsx("span",{style:{fontSize:"12px",color:n.textSecondary},children:"days"})]}),t.jsx("div",{style:{fontSize:"11px",color:n.textSecondary,marginBottom:"8px"},children:"Run on these days:"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[{value:"sun",label:"Sun"},{value:"mon",label:"Mon"},{value:"tue",label:"Tue"},{value:"wed",label:"Wed"},{value:"thu",label:"Thu"},{value:"fri",label:"Fri"},{value:"sat",label:"Sat"}].map(k=>t.jsx("button",{onClick:()=>{const U=P.allowedDays||[],F=U.includes(k.value)?U.filter(Y=>Y!==k.value):[...U,k.value];O({...P,allowedDays:F})},style:{padding:"4px 8px",backgroundColor:(P.allowedDays||[]).includes(k.value)?n.primary:n.bgCard,color:(P.allowedDays||[]).includes(k.value)?"#fff":n.textSecondary,border:`1px solid ${(P.allowedDays||[]).includes(k.value)?n.primary:n.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px",fontWeight:"500"},children:k.label},k.value))})]}),!P.enabled&&t.jsx("p",{style:{fontSize:"11px",color:n.textMuted,margin:0},children:"All matching contacts will be enrolled immediately"})]})]}),ee.type==="trigger"&&t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Run Time"}),t.jsx("input",{type:"time",defaultValue:((Ze=ee.config)==null?void 0:Ze.time)||"09:00",style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px",marginBottom:"16px"}}),t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Frequency"}),t.jsxs("select",{defaultValue:((Xe=ee.config)==null?void 0:Xe.frequency)||"Daily",style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[t.jsx("option",{children:"Daily"}),t.jsx("option",{children:"Weekly"}),t.jsx("option",{children:"Monthly"})]})]}),ee.type==="send_email"&&t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Email Template"}),t.jsxs("select",{value:((et=ee.config)==null?void 0:et.template)||"",onChange:k=>{const U=D.find(F=>F.id===k.target.value);updateNode(l,{config:{...ee.config,template:k.target.value,templateName:(U==null?void 0:U.name)||""},subtitle:(U==null?void 0:U.name)||"Select template..."})},style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[t.jsx("option",{value:"",children:E?"Loading templates...":"Select template..."}),D.map(k=>t.jsx("option",{value:k.id,children:k.name},k.id))]})]}),ee.type==="delay"&&t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Wait Duration"}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("input",{type:"number",defaultValue:((tt=ee.config)==null?void 0:tt.duration)||1,min:"1",style:{flex:1,padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"}}),t.jsxs("select",{defaultValue:((ot=ee.config)==null?void 0:ot.unit)||"days",style:{flex:1,padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[t.jsx("option",{value:"hours",children:"Hours"}),t.jsx("option",{value:"days",children:"Days"}),t.jsx("option",{value:"weeks",children:"Weeks"})]})]})]}),(ee.type==="condition"||ee.type==="field_condition")&&t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"12px",color:n.textSecondary,marginBottom:"6px"},children:"Condition Type"}),t.jsxs("select",{defaultValue:((rt=ee.config)==null?void 0:rt.type)||"email_opened",style:{width:"100%",padding:"10px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"},children:[t.jsx("option",{value:"email_opened",children:"Email Opened"}),t.jsx("option",{value:"email_clicked",children:"Email Clicked"}),t.jsx("option",{value:"field_value",children:"Field Value"})]})]}),ee.type==="end"&&t.jsx("p",{style:{fontSize:"13px",color:n.textSecondary},children:"This node ends the automation flow. Contacts reaching this point will exit the automation."})]}):t.jsxs("div",{style:{textAlign:"center",color:n.textMuted,padding:"30px 0"},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:"ðŸ‘†"}),t.jsx("div",{style:{fontSize:"13px"},children:"Select a node to configure"})]})})]})]}),v&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",zIndex:200},onClick:()=>R(!1)}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"900px",maxWidth:"95vw",maxHeight:"85vh",backgroundColor:n.bgCard,borderRadius:"16px",border:`1px solid ${n.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${n.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[t.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Entry Criteria"}),t.jsx("button",{onClick:()=>R(!1),style:{background:"none",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"18px"},children:"Ã—"})]}),t.jsx("div",{style:{flex:1,padding:"20px",overflow:"auto"},children:t.jsx(Po,{filterConfig:W,setFilterConfig:L,showQuickFilters:!0,theme:n})}),t.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${n.border}`,display:"flex",justifyContent:"flex-end",gap:"8px",flexShrink:0},children:i?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>R(!1),style:{padding:"10px 20px",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,borderRadius:"8px",color:n.textSecondary,cursor:"pointer",fontSize:"13px"},children:"Cancel"}),t.jsx("button",{onClick:()=>R(!1),style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Save Criteria"})]}):t.jsx("button",{onClick:()=>R(!1),style:{padding:"10px 20px",backgroundColor:n.bgHover,border:`1px solid ${n.borderLight}`,borderRadius:"8px",color:n.textSecondary,cursor:"pointer",fontSize:"13px"},children:"Close"})})]})]}),x&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",zIndex:200},onClick:()=>b(!1)}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxWidth:"95vw",maxHeight:"85vh",backgroundColor:n.bgCard,borderRadius:"16px",border:`1px solid ${n.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${n.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[t.jsxs("div",{children:[t.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Preview Potential Enrollees"}),t.jsx("p",{style:{fontSize:"12px",color:n.textMuted,margin:"4px 0 0"},children:"Contacts matching your entry criteria who would enter this automation"})]}),t.jsx("button",{onClick:()=>b(!1),style:{background:"none",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"20px"},children:"Ã—"})]}),t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${n.border}`,display:"flex",gap:"24px",backgroundColor:n.bgHover},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.primary},children:G?"...":(A==null?void 0:A.length)||0}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted,textTransform:"uppercase"},children:"Matching Contacts"})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.success},children:((nt=W==null?void 0:W.groups)==null?void 0:nt.length)||0}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted,textTransform:"uppercase"},children:"Filter Groups"})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.textSecondary},children:((at=W==null?void 0:W.groups)==null?void 0:at.reduce((k,U)=>{var F;return k+(((F=U.rules)==null?void 0:F.filter(Y=>Y.field&&Y.operator).length)||0)},0))||0}),t.jsx("div",{style:{fontSize:"11px",color:n.textMuted,textTransform:"uppercase"},children:"Active Filters"})]})]}),t.jsxs("div",{style:{flex:1,overflow:"auto",padding:"0"},children:[G?t.jsx("div",{style:{textAlign:"center",padding:"40px",color:n.textMuted},children:t.jsx("div",{style:{fontSize:"14px"},children:"Loading potential enrollees..."})}):u?A&&A.length>0?t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:n.bgHover},children:[t.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${n.border}`},children:"Contact"}),t.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${n.border}`},children:"Account Type"}),t.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${n.border}`},children:"Last Email"}),t.jsx("th",{style:{padding:"12px 20px",textAlign:"left",fontSize:"11px",fontWeight:"600",color:n.textMuted,textTransform:"uppercase",borderBottom:`1px solid ${n.border}`},children:"Matched Groups"})]})}),t.jsx("tbody",{children:A.map(k=>t.jsxs("tr",{style:{borderBottom:`1px solid ${n.border}`},children:[t.jsxs("td",{style:{padding:"12px 20px"},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:n.text},children:k.name||k.account_name}),t.jsx("div",{style:{fontSize:"12px",color:n.textMuted},children:k.email})]}),t.jsx("td",{style:{padding:"12px 20px",fontSize:"13px",color:n.textSecondary},children:k.account_type||"â€”"}),t.jsx("td",{style:{padding:"12px 20px",fontSize:"13px",color:n.textSecondary},children:k._lastEmailSent?new Date(k._lastEmailSent).toLocaleDateString():"Never"}),t.jsx("td",{style:{padding:"12px 20px",position:"relative"},children:k._matchedGroups&&k._matchedGroups.length>0?t.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:k._matchedGroups.map(U=>t.jsxs("span",{style:{padding:"2px 8px",borderRadius:"10px",fontSize:"11px",fontWeight:"600",backgroundColor:(m==null?void 0:m.contactId)===k.id&&(m==null?void 0:m.groupIndex)===U?n.primary:`${n.primary}20`,color:(m==null?void 0:m.contactId)===k.id&&(m==null?void 0:m.groupIndex)===U?"#fff":n.primary,cursor:"default",transition:"all 0.15s ease",position:"relative"},onMouseEnter:F=>{const Y=F.target.getBoundingClientRect();I({contactId:k.id,groupIndex:U,x:Y.left,y:Y.bottom+8})},onMouseLeave:()=>{I(null)},children:["Group ",U+1]},U))}):t.jsx("span",{style:{fontSize:"12px",color:n.textMuted},children:"â€”"})})]},k.id))})]}):t.jsxs("div",{style:{textAlign:"center",padding:"40px",color:n.textMuted},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:"ðŸ‘¥"}),t.jsx("div",{style:{fontSize:"14px"},children:"No contacts match your current filters"})]}):t.jsxs("div",{style:{textAlign:"center",padding:"40px",color:n.textMuted},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:"ðŸŽ¯"}),t.jsx("div",{style:{fontSize:"14px"},children:"Add filters to see who would enter this automation"})]}),m&&((it=W==null?void 0:W.groups)==null?void 0:it[m.groupIndex])&&t.jsxs("div",{style:{position:"fixed",left:m.x,top:m.y,backgroundColor:n.bgCard,border:`1px solid ${n.border}`,borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e4,maxWidth:"300px",pointerEvents:"none"},children:[t.jsxs("div",{style:{fontSize:"11px",fontWeight:"600",color:n.textMuted,marginBottom:"8px",textTransform:"uppercase"},children:["Group ",m.groupIndex+1," Criteria"]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:(st=W.groups[m.groupIndex].rules)==null?void 0:st.filter(k=>k.field&&k.operator).map((k,U)=>t.jsx("div",{style:{fontSize:"12px",color:n.text},children:ut(k)},U))})]})]}),t.jsxs("div",{style:{padding:"12px 20px",borderTop:`1px solid ${n.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0,backgroundColor:n.bgHover},children:[t.jsx("span",{style:{fontSize:"12px",color:n.textMuted},children:G?"Loading...":`Showing ${(A==null?void 0:A.length)||0} potential enrollee${((A==null?void 0:A.length)||0)!==1?"s":""}`}),t.jsx("button",{onClick:()=>b(!1),style:{padding:"8px 16px",backgroundColor:n.bgCard,border:`1px solid ${n.borderLight}`,borderRadius:"6px",color:n.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Close"})]})]})]})]})},xt=({t:e})=>{var K,L;const{userId:r,automationId:o}=le(),a=ye(),i=Ye(),n=!o||o==="new";(K=i.state)!=null&&K.templateName||((L=i.state)==null||L.templateId);const{data:s=!1,isLoading:c}=yo(),{data:d,isLoading:l,error:h}=Qt(n?null:o),y=(d==null?void 0:d.is_default)===!0,p=n||!y||s,{createAutomation:v,updateAutomation:R,activateAutomation:x,pauseAutomation:b,duplicateAutomation:m}=ht(),{updateMasterAutomation:I}=mo(),D=async()=>{if(n)return;const N=E.status==="active",O=N?"paused":"active";try{N?await b.mutateAsync(o):await x.mutateAsync(o),S(B=>({...B,status:O}))}catch(B){console.error("Failed to toggle status:",B)}},[E,S]=C.useState({name:"",description:"",category:"general",status:"draft",send_time:"10:00",timezone:"America/Chicago",frequency:"Daily",filter_config:{},nodes:[]});C.useEffect(()=>{d&&S({name:d.name||"",description:d.description||"",category:d.category||"general",status:d.status||"draft",send_time:d.send_time||"10:00",timezone:d.timezone||"America/Chicago",frequency:d.frequency||"Daily",filter_config:d.filter_config||{},nodes:d.nodes||[]})},[d]);const _=async N=>{if(!p){alert('You cannot edit default automations. Use "Clone & Edit" to create your own copy.');return}try{if(n){const O=await v.mutateAsync(N);a(`/${r}/automations/${O.id}`,{replace:!0})}else s&&y&&(d!=null&&d.default_key)?await I.mutateAsync({defaultKey:d.default_key,updates:{name:N.name,description:N.description,category:N.category,send_time:N.send_time,timezone:N.timezone,frequency:N.frequency,filter_config:N.filter_config,nodes:N.nodes}}):await R.mutateAsync({automationId:o,updates:N})}catch(O){console.error("Failed to save automation:",O),alert("Failed to save automation. Please try again.")}},W=async()=>{try{const N=await m.mutateAsync(o);a(`/${r}/automations/${N.id}`,{replace:!0})}catch(N){console.error("Failed to clone automation:",N),alert("Failed to clone automation. Please try again.")}},V=()=>{a(`/${r}/automations`)},[T,q]=C.useState(null),P=n||d&&T===d.updated_at;return C.useEffect(()=>{d!=null&&d.updated_at&&q(d.updated_at)},[d==null?void 0:d.updated_at]),!n&&(l||c||!P)?t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[t.jsx("div",{style:{fontSize:"32px"},children:"â³"}),t.jsx("div",{style:{color:(e==null?void 0:e.textSecondary)||"#a1a1aa"},children:"Loading automation..."})]}):h?t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[t.jsx("div",{style:{fontSize:"48px"},children:"ðŸ˜•"}),t.jsx("h2",{style:{color:(e==null?void 0:e.text)||"#fafafa",margin:0},children:"Automation Not Found"}),t.jsx("p",{style:{color:(e==null?void 0:e.textSecondary)||"#a1a1aa"},children:"We couldn't find the automation you're looking for."}),t.jsx("button",{onClick:V,style:{padding:"10px 20px",backgroundColor:(e==null?void 0:e.primary)||"#3b82f6",border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Automations"})]}):t.jsxs("div",{style:{margin:"-24px",height:"calc(100vh - 49px)",display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${(e==null?void 0:e.border)||"#27272a"}`,display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:(e==null?void 0:e.bgCard)||"#18181b",flexShrink:0},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[t.jsx("button",{onClick:V,style:{background:"none",border:"none",color:(e==null?void 0:e.textSecondary)||"#a1a1aa",cursor:"pointer",fontSize:"20px",padding:"4px 8px",display:"flex",alignItems:"center"},children:"â†"}),t.jsx("h1",{style:{fontSize:"16px",fontWeight:"600",color:(e==null?void 0:e.text)||"#fafafa",margin:0},children:n?"Create Automation":p?`Edit: ${(d==null?void 0:d.name)||"Automation"}`:`View: ${(d==null?void 0:d.name)||"Automation"}`}),y&&t.jsx("span",{style:{padding:"4px 8px",backgroundColor:`${(e==null?void 0:e.primary)||"#3b82f6"}20`,color:(e==null?void 0:e.primary)||"#3b82f6",borderRadius:"4px",fontSize:"11px",fontWeight:"600",textTransform:"uppercase"},children:"Default"}),!p&&t.jsx("span",{style:{padding:"4px 8px",backgroundColor:`${(e==null?void 0:e.warning)||"#f59e0b"}20`,color:(e==null?void 0:e.warning)||"#f59e0b",borderRadius:"4px",fontSize:"11px",fontWeight:"600"},children:"Read Only"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[!n&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("span",{style:{fontSize:"13px",color:(e==null?void 0:e.textSecondary)||"#a1a1aa"},children:E.status==="active"?"Active":"Inactive"}),t.jsx("button",{onClick:D,disabled:x.isPending||b.isPending,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:E.status==="active"?(e==null?void 0:e.success)||"#22c55e":(e==null?void 0:e.bgHover)||"#27272a",cursor:"pointer",position:"relative",transition:"background-color 0.2s",opacity:x.isPending||b.isPending?.6:1},children:t.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:E.status==="active"?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})})]}),!p&&t.jsx("button",{onClick:W,disabled:m.isPending,style:{padding:"8px 16px",backgroundColor:(e==null?void 0:e.bgHover)||"#27272a",border:`1px solid ${(e==null?void 0:e.border)||"#3f3f46"}`,borderRadius:"6px",color:(e==null?void 0:e.text)||"#fafafa",cursor:"pointer",fontSize:"13px",fontWeight:"500",opacity:m.isPending?.7:1},children:m.isPending?"Cloning...":"Clone & Edit"}),p&&t.jsx("button",{onClick:()=>_(E),disabled:v.isPending||R.isPending||I.isPending,style:{padding:"8px 16px",backgroundColor:(e==null?void 0:e.primary)||"#3b82f6",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",opacity:v.isPending||R.isPending||I.isPending?.7:1},children:v.isPending||R.isPending||I.isPending?"Saving...":n?"Create":"Save Changes"})]})]}),t.jsx("div",{style:{flex:1,overflow:"hidden"},children:t.jsx(No,{t:e,automation:E,onUpdate:S,onSave:_,canEdit:p},`${o||"new"}-${(d==null?void 0:d.updated_at)||"new"}`)})]})},Ho=void 0,Fe=({width:e="100%",height:r="20px"})=>t.jsx("div",{style:{width:e,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Uo=({status:e,theme:r})=>{const o={Draft:{bg:r.textMuted,text:"#fff"},Scheduled:{bg:r.warning,text:"#fff"},Sending:{bg:r.primary,text:"#fff"},Completed:{bg:r.success,text:"#fff"},Cancelled:{bg:r.danger,text:"#fff"}},a=o[e]||o.Draft;return t.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${a.bg}20`,color:a.bg,borderRadius:"20px",fontSize:"11px",fontWeight:"500"},children:e})},Go=({template:e,onSave:r,onClose:o,theme:a})=>{const[i,n]=C.useState((e==null?void 0:e.name)||""),[s,c]=C.useState((e==null?void 0:e.subject)||""),[d,l]=C.useState((e==null?void 0:e.body_html)||(e==null?void 0:e.body_text)||""),[h,y]=C.useState((e==null?void 0:e.category)||"general"),[p,v]=C.useState(!1),R=async()=>{v(!0);try{const m=await r({name:i,subject:s,body_html:d,body_text:d.replace(/<[^>]*>/g,""),category:h});o(m)}catch(m){console.error("Failed to save template:",m)}finally{v(!1)}},x=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],b=m=>{l(d+m)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:200},onClick:()=>o(null)}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxWidth:"95vw",maxHeight:"90vh",backgroundColor:a.bgCard,borderRadius:"16px",border:`1px solid ${a.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${a.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:a.text,margin:0},children:e?"Edit Template":"Create New Template"}),t.jsx("button",{onClick:()=>o(null),style:{background:"none",border:"none",color:a.textMuted,cursor:"pointer",fontSize:"20px"},children:"Ã—"})]}),t.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Template Name"}),t.jsx("input",{type:"text",value:i,onChange:m=>n(m.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Category"}),t.jsxs("select",{value:h,onChange:m=>y(m.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"},children:[t.jsx("option",{value:"general",children:"General"}),t.jsx("option",{value:"welcome",children:"Welcome"}),t.jsx("option",{value:"renewal",children:"Renewal"}),t.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),t.jsx("option",{value:"engagement",children:"Engagement"}),t.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),t.jsx("input",{type:"text",value:s,onChange:m=>c(m.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px"}})]}),t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:x.map(m=>t.jsx("button",{onClick:()=>b(m.key),style:{padding:"4px 10px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"6px",color:a.textSecondary,cursor:"pointer",fontSize:"11px"},children:m.label},m.key))})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:a.text,display:"block",marginBottom:"6px"},children:"Email Body"}),t.jsx("textarea",{value:d,onChange:m=>l(m.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:10,style:{width:"100%",padding:"12px",backgroundColor:a.bgInput,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),t.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${a.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[t.jsx("button",{onClick:()=>o(null),style:{padding:"10px 20px",backgroundColor:a.bgHover,border:`1px solid ${a.border}`,borderRadius:"8px",color:a.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),t.jsx("button",{onClick:R,disabled:p||!i||!s,style:{padding:"10px 20px",backgroundColor:a.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:p?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:p||!i||!s?.6:1},children:p?"Creating...":"Create & Select"})]})]})]})},Ko=({batch:e,onView:r,theme:o})=>{var i;const a=e.total_recipients>0?Math.round(e.emails_sent/e.total_recipients*100):0;return t.jsxs("div",{style:{padding:"16px",backgroundColor:o.bgCard,borderRadius:"10px",border:`1px solid ${o.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"6px"},children:[t.jsx("span",{style:{fontWeight:"600",color:o.text},children:e.name||"Untitled Batch"}),t.jsx(Uo,{status:e.status,theme:o})]}),t.jsx("p",{style:{fontSize:"13px",color:o.textSecondary,margin:0},children:e.subject||"No subject"}),t.jsxs("p",{style:{fontSize:"12px",color:o.textMuted,margin:"4px 0 0"},children:[((i=e.template)==null?void 0:i.name)||"Custom email"," â€¢ ",e.total_recipients||0," recipients"]})]}),e.status!=="Draft"&&t.jsxs("div",{style:{textAlign:"right",minWidth:"100px"},children:[t.jsxs("div",{style:{fontSize:"18px",fontWeight:"600",color:o.text},children:[a,"%"]}),t.jsxs("div",{style:{fontSize:"11px",color:o.textMuted},children:[e.emails_sent||0," / ",e.total_recipients||0," sent"]})]}),t.jsx("button",{onClick:()=>r(e),style:{padding:"8px 16px",backgroundColor:o.bgHover,border:`1px solid ${o.border}`,borderRadius:"6px",color:o.text,cursor:"pointer",fontSize:"13px"},children:"View"})]})},Vo=({currentStep:e,steps:r,theme:o})=>t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"24px"},children:r.map((a,i)=>t.jsxs(ke.Fragment,{children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:i<=e?o.primary:o.bgHover,color:i<=e?"#fff":o.textMuted,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"13px",fontWeight:"600"},children:i<e?"âœ“":i+1}),t.jsx("span",{style:{fontSize:"14px",fontWeight:i===e?"600":"400",color:i<=e?o.text:o.textMuted},children:a})]}),i<r.length-1&&t.jsx("div",{style:{flex:1,height:"2px",backgroundColor:i<e?o.primary:o.border,minWidth:"40px"}})]},a))}),Qo=({selectedTemplate:e,onSelect:r,onCreateNew:o,templates:a,isLoading:i,theme:n})=>{const[s,c]=C.useState(""),d=C.useMemo(()=>a?s?a.filter(l=>l.name.toLowerCase().includes(s.toLowerCase())||l.subject.toLowerCase().includes(s.toLowerCase())):a:[],[a,s]);return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Select an Email Template"}),t.jsxs("button",{onClick:o,style:{padding:"8px 16px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," Create New Template"]})]}),t.jsxs("div",{style:{position:"relative",marginBottom:"16px"},children:[t.jsx("input",{type:"text",placeholder:"Search templates...",value:s,onChange:l=>c(l.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"}}),t.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:n.textMuted},children:"ðŸ”"})]}),i?t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"},children:Array.from({length:4}).map((l,h)=>t.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgCard,borderRadius:"10px",border:`1px solid ${n.border}`},children:[t.jsx(Fe,{width:"120px",height:"16px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Fe,{width:"200px",height:"14px"})})]},h))}):t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px",maxHeight:"400px",overflow:"auto"},children:d.map(l=>t.jsxs("div",{onClick:()=>r(l),style:{padding:"16px",backgroundColor:n.bgCard,borderRadius:"10px",border:`2px solid ${(e==null?void 0:e.id)===l.id?n.primary:n.border}`,cursor:"pointer",transition:"border-color 0.15s"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:n.text,marginBottom:"4px"},children:l.name}),t.jsx("div",{style:{fontSize:"13px",color:n.textSecondary},children:l.subject}),t.jsx("div",{style:{marginTop:"8px",padding:"4px 8px",backgroundColor:`${n.primary}15`,color:n.primary,borderRadius:"4px",fontSize:"11px",display:"inline-block",textTransform:"capitalize"},children:l.category||"General"})]},l.id))}),!i&&d.length===0&&t.jsx("div",{style:{textAlign:"center",padding:"40px",color:n.textMuted},children:s?"No templates match your search":"No templates available. Create one to get started!"})]})},Qe=[{value:"account_status",label:"Account Status",type:"select",options:[{value:"customer",label:"Customer"},{value:"prospect",label:"Prospect"},{value:"prior_customer",label:"Prior Customer"},{value:"lead",label:"Lead"}]},{value:"policy_type",label:"Policy Type",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"active_policy_type",label:"Has Active Policy",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"policy_status",label:"Policy Status",type:"select",options:[{value:"active",label:"Active"},{value:"cancelled",label:"Cancelled"},{value:"expired",label:"Expired"}]},{value:"policy_class",label:"Policy Class",type:"select",options:[{value:"Personal",label:"Personal"},{value:"Commercial",label:"Commercial"}]},{value:"policy_count",label:"Number of Policies",type:"number"},{value:"policy_effective",label:"Policy Effective Date",type:"date"},{value:"policy_expiration",label:"Policy Expiration",type:"date"},{value:"location",label:"Location",type:"location"},{value:"state",label:"State",type:"select",options:[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}]},{value:"city",label:"City",type:"text"},{value:"zip_code",label:"ZIP Code",type:"text"},{value:"email_domain",label:"Email Domain",type:"text"},{value:"last_email_sent",label:"Last Email Sent",type:"date"},{value:"account_created",label:"Account Created",type:"date"}],At={select:[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"is_any",label:"is any of"}],number:[{value:"equals",label:"equals"},{value:"greater_than",label:"greater than"},{value:"less_than",label:"less than"},{value:"at_least",label:"at least"},{value:"at_most",label:"at most"},{value:"between",label:"is between"}],date:[{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"between",label:"is between"},{value:"in_next_days",label:"is in the next"},{value:"in_last_days",label:"was in the last"}],location:[{value:"within_radius",label:"is within"}],text:[{value:"contains",label:"contains"},{value:"not_contains",label:"does not contain"},{value:"equals",label:"equals"},{value:"not_equals",label:"does not equal"},{value:"starts_with",label:"starts with"},{value:"ends_with",label:"ends with"},{value:"is_empty",label:"is empty"},{value:"is_not_empty",label:"is not empty"}]},Yo=[5,10,15,25,50,100],Jo=(e,r)=>{const a=(At[e]||[]).find(i=>i.value===r);return(a==null?void 0:a.label)||r},gt=e=>{const r=Qe.find(n=>n.value===e.field);if(!r)return null;const o=r.label,a=Jo(r.type,e.operator);let i=e.value;if(r.type==="select"&&r.options)if(e.operator==="is_any")i=(e.value||"").split(",").map(s=>{const c=r.options.find(d=>d.value===s);return(c==null?void 0:c.label)||s}).join(", ");else{const n=r.options.find(s=>s.value===e.value);i=(n==null?void 0:n.label)||e.value}return e.operator==="is_empty"||e.operator==="is_not_empty"?`${o} ${a}`:e.operator==="between"&&e.value2?`${o} ${a} ${e.value} and ${e.value2}`:e.operator==="in_next_days"||e.operator==="in_last_days"?`${o} ${a} ${e.value} days`:e.operator==="within_radius"?`${o} within ${e.radius||25} miles of ${e.locationDisplay||"location"}`:`${o} ${a} ${i}`},Zo=({recipients:e,filterConfig:r,isLoading:o,onClose:a,theme:i})=>{var x;const[n,s]=C.useState(""),[c,d]=C.useState(1),l=20,h=(r==null?void 0:r.groups)||(((x=r==null?void 0:r.rules)==null?void 0:x.length)>0?[{rules:r.rules}]:[]),y=h.some(b=>{var m;return(m=b.rules)==null?void 0:m.some(I=>I.field&&I.operator)}),p=C.useMemo(()=>{if(!e)return[];if(!n)return e;const b=n.toLowerCase();return e.filter(m=>(m.name||"").toLowerCase().includes(b)||(m.person_email||m.email||"").toLowerCase().includes(b)||(m.primary_contact_first_name||"").toLowerCase().includes(b)||(m.primary_contact_last_name||"").toLowerCase().includes(b))},[e,n]),v=Math.ceil(p.length/l),R=p.slice((c-1)*l,c*l);return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",zIndex:1e3},onClick:a}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"900px",maxWidth:"95vw",maxHeight:"85vh",backgroundColor:i.bgCard,borderRadius:"16px",border:`1px solid ${i.border}`,zIndex:1001,display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${i.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{margin:0,fontSize:"18px",fontWeight:"600",color:i.text},children:"Matching Recipients"}),t.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:i.textSecondary},children:o?"Loading...":`${p.length.toLocaleString()} accounts match your criteria`})]}),t.jsx("button",{onClick:a,style:{background:"none",border:"none",color:i.textMuted,cursor:"pointer",fontSize:"24px",lineHeight:1,padding:"4px"},children:"Ã—"})]}),y&&t.jsxs("div",{style:{padding:"12px 20px",backgroundColor:i.bgHover,borderBottom:`1px solid ${i.border}`},children:[t.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:i.textSecondary,marginBottom:"8px",textTransform:"uppercase"},children:"Active Filters"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:h.map((b,m)=>t.jsxs(ke.Fragment,{children:[m>0&&t.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#f59e0b20",color:"#f59e0b",borderRadius:"4px",fontSize:"11px",fontWeight:"700"},children:"OR"}),(b.rules||[]).filter(I=>I.field&&I.operator).map((I,D)=>t.jsxs(ke.Fragment,{children:[D>0&&t.jsx("span",{style:{fontSize:"11px",color:i.textMuted,alignSelf:"center"},children:"AND"}),t.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${i.primary}15`,color:i.primary,borderRadius:"4px",fontSize:"12px",fontWeight:"500"},children:gt(I)})]},`${m}-${D}`))]},m))})]}),t.jsx("div",{style:{padding:"12px 20px",borderBottom:`1px solid ${i.border}`},children:t.jsx("input",{type:"text",placeholder:"Search recipients...",value:n,onChange:b=>{s(b.target.value),d(1)},style:{width:"100%",padding:"10px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"8px",color:i.text,fontSize:"14px"}})}),t.jsx("div",{style:{flex:1,overflow:"auto",padding:"0 20px"},children:o?t.jsx("div",{style:{padding:"40px",textAlign:"center",color:i.textMuted},children:"Loading recipients..."}):R.length===0?t.jsx("div",{style:{padding:"40px",textAlign:"center",color:i.textMuted},children:n?"No recipients match your search":"No recipients found"}):t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{borderBottom:`2px solid ${i.border}`},children:[t.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:i.textSecondary,textTransform:"uppercase"},children:"Name"}),t.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:i.textSecondary,textTransform:"uppercase"},children:"Email"}),t.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:i.textSecondary,textTransform:"uppercase"},children:"Status"}),y&&h.length>0&&t.jsx("th",{style:{textAlign:"left",padding:"12px 8px",fontSize:"12px",fontWeight:"600",color:i.textSecondary,textTransform:"uppercase"},children:"Matched Groups"})]})}),t.jsx("tbody",{children:R.map((b,m)=>t.jsxs("tr",{style:{borderBottom:`1px solid ${i.border}`,backgroundColor:m%2===0?"transparent":i.bgHover},children:[t.jsxs("td",{style:{padding:"12px 8px"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:i.text},children:b.primary_contact_first_name?`${b.primary_contact_first_name} ${b.primary_contact_last_name||""}`.trim():b.name||"N/A"}),b.name&&b.primary_contact_first_name&&t.jsx("div",{style:{fontSize:"12px",color:i.textMuted},children:b.name})]}),t.jsx("td",{style:{padding:"12px 8px",fontSize:"13px",color:i.textSecondary},children:b.person_email||b.email||"N/A"}),t.jsx("td",{style:{padding:"12px 8px"},children:t.jsx("span",{style:{padding:"3px 8px",backgroundColor:i.bgHover,color:i.text,borderRadius:"4px",fontSize:"12px",textTransform:"capitalize"},children:b.account_status||"N/A"})}),y&&h.length>0&&t.jsx("td",{style:{padding:"12px 8px"},children:t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[(b._matchedGroups||[]).map(I=>{var D,E;return t.jsxs("span",{style:{padding:"2px 8px",backgroundColor:`${i.success}20`,color:i.success,borderRadius:"4px",fontSize:"11px",fontWeight:"600",display:"inline-flex",alignItems:"center",gap:"4px",cursor:"help"},title:((E=(D=h[I])==null?void 0:D.rules)==null?void 0:E.filter(S=>S.field&&S.operator).map(S=>gt(S)).join(" AND "))||`Group ${I+1}`,children:["Group ",I+1,t.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{opacity:.7},children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),t.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})]},I)}),(!b._matchedGroups||b._matchedGroups.length===0)&&t.jsx("span",{style:{fontSize:"11px",color:i.textMuted},children:h.length===0?"No filters":"All"})]})})]},b.account_unique_id||m))})]})}),v>1&&t.jsxs("div",{style:{padding:"12px 20px",borderTop:`1px solid ${i.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{fontSize:"13px",color:i.textSecondary},children:["Showing ",(c-1)*l+1,"-",Math.min(c*l,p.length)," of ",p.length]}),t.jsxs("div",{style:{display:"flex",gap:"8px"},children:[t.jsx("button",{onClick:()=>d(b=>Math.max(1,b-1)),disabled:c===1,style:{padding:"6px 12px",backgroundColor:c===1?i.bgHover:i.bgCard,border:`1px solid ${i.border}`,borderRadius:"6px",color:c===1?i.textMuted:i.text,cursor:c===1?"not-allowed":"pointer",fontSize:"13px"},children:"Previous"}),t.jsxs("span",{style:{padding:"6px 12px",fontSize:"13px",color:i.textSecondary},children:["Page ",c," of ",v]}),t.jsx("button",{onClick:()=>d(b=>Math.min(v,b+1)),disabled:c===v,style:{padding:"6px 12px",backgroundColor:c===v?i.bgHover:i.bgCard,border:`1px solid ${i.border}`,borderRadius:"6px",color:c===v?i.textMuted:i.text,cursor:c===v?"not-allowed":"pointer",fontSize:"13px"},children:"Next"})]})]})]})]})},Xo=({lat:e,lng:r,radiusMiles:o,theme:a})=>{const i=C.useRef(null),n=C.useRef(null),s=C.useRef(null),c=C.useRef(null);C.useEffect(()=>{var h;if((h=window.google)!=null&&h.maps)l();else{const y=document.createElement("script");y.src=`https://maps.googleapis.com/maps/api/js?key=${Ho}`,y.async=!0,y.defer=!0,y.onload=()=>l(),document.head.appendChild(y)}function l(){var v;if(!i.current||!((v=window.google)!=null&&v.maps))return;const y={lat:e,lng:r},p=o*1609.34;n.current=new window.google.maps.Map(i.current,{center:y,zoom:d(o),mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,styles:[{featureType:"poi",stylers:[{visibility:"off"}]}]}),s.current=new window.google.maps.Circle({map:n.current,center:y,radius:p,fillColor:a.primary,fillOpacity:.2,strokeColor:a.primary,strokeWeight:2}),c.current=new window.google.maps.Marker({map:n.current,position:y}),n.current.fitBounds(s.current.getBounds())}return()=>{s.current&&s.current.setMap(null),c.current&&c.current.setMap(null)}},[e,r,o,a.primary]);function d(l){return l<=5?12:l<=15?11:l<=25?10:l<=50?9:8}return t.jsx("div",{ref:i,style:{width:"100%",height:"100%"}})},er=({location:e,radius:r,onClose:o,theme:a})=>{if(!e)return null;const i=parseFloat(e.lat),n=parseFloat(e.lng);return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",zIndex:1e3},onClick:o}),t.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"600px",maxWidth:"95vw",backgroundColor:a.bgCard,borderRadius:"16px",border:`1px solid ${a.border}`,zIndex:1001,overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${a.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:a.text},children:"Location Radius Preview"}),t.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:a.textSecondary},children:["ðŸ“ ",e.display]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsxs("div",{style:{padding:"6px 12px",backgroundColor:`${a.primary}15`,color:a.primary,borderRadius:"6px",fontWeight:"600",fontSize:"14px"},children:[r," mile radius"]}),t.jsx("button",{onClick:o,style:{background:"none",border:"none",color:a.textMuted,cursor:"pointer",fontSize:"24px",lineHeight:1},children:"Ã—"})]})]}),t.jsx("div",{style:{height:"400px"},children:t.jsx(Xo,{lat:i,lng:n,radiusMiles:r,theme:a})}),t.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${a.border}`,backgroundColor:a.bgHover,fontSize:"12px",color:a.textSecondary,textAlign:"center"},children:"Recipients within this area will be included in your campaign"})]})]})},tr=({location:e,radius:r,theme:o})=>{const[a,i]=C.useState(!1);return e?t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{marginTop:"12px",borderRadius:"8px",overflow:"hidden",border:`1px solid ${o.border}`},children:t.jsxs("div",{style:{padding:"12px 16px",backgroundColor:o.bgHover,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("span",{style:{fontSize:"20px"},children:"ðŸ“"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:o.text},children:e.display}),t.jsxs("div",{style:{fontSize:"12px",color:o.textSecondary},children:[r," mile radius"]})]})]}),t.jsx("button",{onClick:()=>i(!0),style:{padding:"8px 16px",backgroundColor:o.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"ðŸ—ºï¸ View Map"})]})}),a&&t.jsx(er,{location:e,radius:r,onClose:()=>i(!1),theme:o})]}):null},or=({rule:e,index:r,onUpdate:o,onRemove:a,theme:i})=>{const n=Qe.find(l=>l.value===e.field),s=n?At[n.type]:[],c={padding:"8px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.text,fontSize:"13px",minWidth:"140px"},d={padding:"8px 12px",backgroundColor:i.bgInput,border:`1px solid ${i.border}`,borderRadius:"6px",color:i.text,fontSize:"13px",width:"120px"};return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:i.bgCard,borderRadius:"8px",border:`1px solid ${i.border}`,flexWrap:"wrap"},children:[r>0&&t.jsx("span",{style:{fontSize:"12px",color:i.primary,fontWeight:"600",padding:"4px 8px",backgroundColor:`${i.primary}15`,borderRadius:"4px"},children:"AND"}),t.jsxs("select",{value:e.field||"",onChange:l=>o(r,{...e,field:l.target.value,operator:"",value:""}),style:c,children:[t.jsx("option",{value:"",children:"Select field..."}),Qe.map(l=>t.jsx("option",{value:l.value,children:l.label},l.value))]}),e.field&&t.jsxs("select",{value:e.operator||"",onChange:l=>o(r,{...e,operator:l.target.value}),style:c,children:[t.jsx("option",{value:"",children:"Select condition..."}),s.map(l=>t.jsx("option",{value:l.value,children:l.label},l.value))]}),e.field&&e.operator&&t.jsxs(t.Fragment,{children:[(n==null?void 0:n.type)==="select"&&e.operator!=="is_any"&&t.jsxs("select",{value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),style:c,children:[t.jsx("option",{value:"",children:"Select value..."}),n.options.map(l=>t.jsx("option",{value:l.value,children:l.label},l.value))]}),(n==null?void 0:n.type)==="select"&&e.operator==="is_any"&&t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:n.options.map(l=>t.jsx("button",{onClick:()=>{const h=e.value?e.value.split(","):[],y=h.includes(l.value)?h.filter(p=>p!==l.value):[...h,l.value];o(r,{...e,value:y.join(",")})},style:{padding:"4px 10px",backgroundColor:(e.value||"").split(",").includes(l.value)?i.primary:i.bgHover,color:(e.value||"").split(",").includes(l.value)?"#fff":i.text,border:`1px solid ${(e.value||"").split(",").includes(l.value)?i.primary:i.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:l.label},l.value))}),(n==null?void 0:n.type)==="number"&&e.operator!=="between"&&t.jsx("input",{type:"number",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),placeholder:"0",style:d}),(n==null?void 0:n.type)==="number"&&e.operator==="between"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),placeholder:"Min",style:{...d,width:"80px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"and"}),t.jsx("input",{type:"number",value:e.value2||"",onChange:l=>o(r,{...e,value2:l.target.value}),placeholder:"Max",style:{...d,width:"80px"}})]}),(n==null?void 0:n.type)==="date"&&e.operator==="in_next_days"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),placeholder:"30",style:{...d,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&e.operator==="in_last_days"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),placeholder:"30",style:{...d,width:"70px"}}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"days"})]}),(n==null?void 0:n.type)==="date"&&e.operator==="between"&&t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"date",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),style:d}),t.jsx("span",{style:{fontSize:"13px",color:i.textSecondary},children:"and"}),t.jsx("input",{type:"date",value:e.value2||"",onChange:l=>o(r,{...e,value2:l.target.value}),style:d})]}),(n==null?void 0:n.type)==="date"&&(e.operator==="before"||e.operator==="after")&&t.jsx("input",{type:"date",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),style:d}),(n==null?void 0:n.type)==="text"&&!["is_empty","is_not_empty"].includes(e.operator)&&t.jsx("input",{type:"text",value:e.value||"",onChange:l=>o(r,{...e,value:l.target.value}),placeholder:`Enter ${n.label.toLowerCase()}...`,style:{...d,width:"160px"}}),(n==null?void 0:n.type)==="location"&&t.jsx(rr,{rule:e,onUpdate:l=>o(r,{...e,...l}),theme:i})]}),t.jsx("button",{onClick:()=>a(r),style:{marginLeft:"auto",padding:"6px 10px",backgroundColor:"transparent",border:"none",color:i.textMuted,cursor:"pointer",fontSize:"16px",borderRadius:"4px"},title:"Remove filter",children:"Ã—"})]})},rr=({rule:e,onUpdate:r,theme:o})=>{const[a,i]=C.useState(e.locationDisplay||""),[n,s]=C.useState(!1),[c,d]=C.useState([]),[l,h]=C.useState(!1),y={padding:"8px 12px",backgroundColor:o.bgInput,border:`1px solid ${o.border}`,borderRadius:"6px",color:o.text,fontSize:"13px"},p=async R=>{if(R.length<3){d([]);return}s(!0);try{const b=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&q=${encodeURIComponent(R)}&limit=5`,{headers:{"Accept-Language":"en"}})).json();d(b.map(m=>({display:m.display_name,lat:m.lat,lng:m.lon,type:m.type}))),h(!0)}catch(x){console.error("Geocoding error:",x),d([])}finally{s(!1)}};ke.useEffect(()=>{const R=setTimeout(()=>{a&&a!==e.locationDisplay&&p(a)},300);return()=>clearTimeout(R)},[a]);const v=R=>{i(R.display.split(",").slice(0,2).join(",")),r({value:`${R.lat},${R.lng}`,locationDisplay:R.display.split(",").slice(0,2).join(","),locationData:R}),h(!1)};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",flex:1,minWidth:"300px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[t.jsxs("div",{style:{position:"relative",flex:1,minWidth:"200px"},children:[t.jsx("input",{type:"text",value:a,onChange:R=>i(R.target.value),onFocus:()=>c.length>0&&h(!0),placeholder:"Enter zip code, city, or address...",style:{...y,width:"100%",paddingRight:"30px"}}),n&&t.jsx("span",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:o.textMuted,fontSize:"12px"},children:"..."}),l&&c.length>0&&t.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:o.bgCard,border:`1px solid ${o.border}`,borderRadius:"6px",marginTop:"4px",zIndex:100,maxHeight:"200px",overflow:"auto",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:c.map((R,x)=>t.jsxs("button",{onClick:()=>v(R),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderBottom:x<c.length-1?`1px solid ${o.border}`:"none",color:o.text,fontSize:"12px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"flex-start",gap:"8px"},onMouseEnter:b=>b.target.style.backgroundColor=o.bgHover,onMouseLeave:b=>b.target.style.backgroundColor="transparent",children:[t.jsx("span",{children:"ðŸ“"}),t.jsx("span",{style:{lineHeight:"1.4"},children:R.display})]},x))})]}),t.jsx("span",{style:{fontSize:"13px",color:o.textSecondary},children:"of"}),t.jsx("select",{value:e.radius||"25",onChange:R=>r({radius:R.target.value}),style:{...y,minWidth:"100px"},children:Yo.map(R=>t.jsxs("option",{value:R,children:[R," miles"]},R))})]}),e.locationData&&t.jsx(tr,{location:e.locationData,radius:parseInt(e.radius||"25",10),theme:o})]})},nr=({breakdown:e,isLoading:r,theme:o})=>{const[a,i]=C.useState(!1);return r?t.jsx("div",{style:{padding:"12px 16px",backgroundColor:o.bgHover,borderRadius:"8px",marginTop:"12px",fontSize:"13px",color:o.textSecondary},children:"Loading location data..."}):!e||e.byCity.length===0?null:t.jsxs("div",{style:{marginTop:"12px",backgroundColor:o.bgCard,borderRadius:"8px",border:`1px solid ${o.border}`,overflow:"hidden"},children:[t.jsxs("button",{onClick:()=>i(!a),style:{width:"100%",padding:"12px 16px",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",color:o.text},children:[t.jsx("span",{style:{fontSize:"13px",fontWeight:"500"},children:"ðŸ“Š View Recipients by City"}),t.jsx("span",{style:{fontSize:"12px",color:o.textSecondary},children:a?"â–²":"â–¼"})]}),a&&t.jsx("div",{style:{padding:"0 16px 16px"},children:t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:e.byCity.map(({city:n,count:s})=>t.jsxs("div",{style:{padding:"6px 10px",backgroundColor:o.bgHover,borderRadius:"6px",fontSize:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{style:{color:o.text},children:n}),t.jsx("span",{style:{backgroundColor:o.primary,color:"#fff",padding:"2px 6px",borderRadius:"10px",fontSize:"11px",fontWeight:"600"},children:s})]},n))})})]})},ar=({group:e,groupIndex:r,onUpdateGroup:o,onRemoveGroup:a,onAddRule:i,onUpdateRule:n,onRemoveRule:s,showOrLabel:c,theme:d})=>{const l=e.rules||[];return t.jsxs("div",{style:{padding:"16px",backgroundColor:d.bgCard,borderRadius:"12px",border:`2px solid ${d.border}`,position:"relative"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[t.jsxs("span",{style:{fontSize:"12px",fontWeight:"600",color:d.textSecondary,textTransform:"uppercase",letterSpacing:"0.5px"},children:["Group ",r+1]}),t.jsx("button",{onClick:()=>a(r),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:d.textMuted,cursor:"pointer",fontSize:"12px",borderRadius:"4px"},title:"Remove group",children:"Remove Group"})]}),l.length===0?t.jsx("div",{style:{textAlign:"center",padding:"12px",color:d.textMuted,fontSize:"13px"},children:"Add filters to this group"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:l.map((h,y)=>t.jsx(or,{rule:h,index:y,onUpdate:(p,v)=>n(r,p,v),onRemove:p=>s(r,p),theme:d},y))}),t.jsxs("button",{onClick:()=>i(r),style:{width:"100%",padding:"8px",backgroundColor:d.bgHover,border:`1px dashed ${d.border}`,borderRadius:"6px",color:d.primary,cursor:"pointer",fontSize:"12px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[t.jsx("span",{children:"+"})," Add Filter to Group"]})]})},ir=({filterConfig:e,setFilterConfig:r,recipientCount:o,isLoading:a,isFetching:i,locationBreakdown:n,isLoadingBreakdown:s,includeRoleAccounts:c,setIncludeRoleAccounts:d,roleUserCount:l,previewRecipients:h,isLoadingPreview:y,theme:p})=>{var V;const[v,R]=C.useState(!1),x=e.groups||(((V=e.rules)==null?void 0:V.length)>0?[{rules:e.rules}]:[]),b=x.length>0,m=()=>{const T=[...x,{rules:[{field:"",operator:"",value:""}]}];r({...e,groups:T,rules:void 0})},I=T=>{const q=x.filter((P,K)=>K!==T);r({...e,groups:q,rules:void 0})},D=T=>{const q=[...x];q[T]={...q[T],rules:[...q[T].rules||[],{field:"",operator:"",value:""}]},r({...e,groups:q,rules:void 0})},E=(T,q,P)=>{const K=[...x],L=[...K[T].rules||[]];L[q]=P,K[T]={...K[T],rules:L},r({...e,groups:K,rules:void 0})},S=(T,q)=>{const P=[...x];P[T]={...P[T],rules:P[T].rules.filter((K,L)=>L!==q)},P[T].rules.length===0&&P.splice(T,1),r({...e,groups:P,rules:void 0})},_=()=>{r({...e,groups:[],rules:void 0,search:""})},W=x.reduce((T,q)=>T+(q.rules||[]).filter(P=>P.field&&P.operator&&(P.value||["is_empty","is_not_empty"].includes(P.operator))).length,0);return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:p.text,margin:0},children:"Filter Recipients"}),(b||e.search)&&t.jsx("button",{onClick:_,style:{padding:"6px 12px",backgroundColor:"transparent",border:`1px solid ${p.border}`,borderRadius:"6px",color:p.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Clear all"})]}),t.jsxs("div",{style:{padding:"16px",backgroundColor:p.bgCard,borderRadius:"12px",border:`1px solid ${p.border}`,marginBottom:"16px"},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:p.textSecondary,marginBottom:"10px"},children:"Quick Filters"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[{label:"Renewals (30 days)",filter:{field:"policy_expiration",operator:"in_next_days",value:"30"}},{label:"New Customers (90 days)",filter:{field:"account_created",operator:"in_last_days",value:"90"}},{label:"Not Emailed (30 days)",filter:{field:"last_email_sent",operator:"before",value:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0]}},{label:"Active Customers",filter:{field:"account_status",operator:"is",value:"customer"}},{label:"Cross-Sell: Auto Only",filters:[{field:"active_policy_type",operator:"is",value:"Auto"},{field:"active_policy_type",operator:"is_not",value:"Home"}]},{label:"Cross-Sell: Home Only",filters:[{field:"active_policy_type",operator:"is",value:"Home"},{field:"active_policy_type",operator:"is_not",value:"Auto"}]},{label:"Prior Customers (90 days)",filters:[{field:"account_status",operator:"is",value:"prior_customer"},{field:"last_email_sent",operator:"before",value:new Date(Date.now()-90*24*60*60*1e3).toISOString().split("T")[0]}]},{label:"Prospects (90 days)",filters:[{field:"account_status",operator:"is",value:"prospect"},{field:"last_email_sent",operator:"before",value:new Date(Date.now()-90*24*60*60*1e3).toISOString().split("T")[0]}]}].map((T,q)=>t.jsxs("button",{onClick:()=>{if(T.filters){const P={rules:T.filters};r({...e,groups:[...x,P],rules:void 0})}else{const P={rules:[T.filter]};r({...e,groups:[...x,P],rules:void 0})}},style:{padding:"6px 12px",backgroundColor:p.bgHover,border:`1px solid ${p.border}`,borderRadius:"16px",color:p.text,cursor:"pointer",fontSize:"12px",fontWeight:"500",transition:"all 0.15s ease"},onMouseEnter:P=>{P.target.style.backgroundColor=p.primary+"20",P.target.style.borderColor=p.primary,P.target.style.color=p.primary},onMouseLeave:P=>{P.target.style.backgroundColor=p.bgHover,P.target.style.borderColor=p.border,P.target.style.color=p.text},children:["+ ",T.label]},q))})]}),t.jsx("div",{style:{padding:"16px",backgroundColor:p.bgCard,borderRadius:"12px",border:`1px solid ${p.border}`,marginBottom:"16px",display:"flex",alignItems:"center",gap:"12px"},children:t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",flex:1},children:[t.jsx("input",{type:"checkbox",checked:c,onChange:T=>d(T.target.checked),style:{width:"18px",height:"18px",cursor:"pointer",accentColor:p.primary}}),t.jsxs("div",{children:[t.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:p.text},children:"Include accounts from users in my role"}),t.jsx("p",{style:{fontSize:"12px",color:p.textSecondary,margin:"2px 0 0"},children:c&&l>1?`Includes accounts from ${l} users with the same role`:"When enabled, includes accounts from all users with the same role as you"})]})]})}),t.jsxs("div",{style:{padding:"16px",backgroundColor:p.bgHover,borderRadius:"12px",marginBottom:"16px"},children:[b?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},children:x.map((T,q)=>t.jsxs("div",{children:[q>0&&t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:"8px 0",gap:"12px"},children:[t.jsx("div",{style:{flex:1,height:"1px",backgroundColor:p.border}}),t.jsx("span",{style:{fontSize:"12px",fontWeight:"700",color:"#f59e0b",padding:"4px 12px",backgroundColor:"#f59e0b20",borderRadius:"4px",textTransform:"uppercase",letterSpacing:"1px"},children:"OR"}),t.jsx("div",{style:{flex:1,height:"1px",backgroundColor:p.border}})]}),t.jsx(ar,{group:T,groupIndex:q,onRemoveGroup:I,onAddRule:D,onUpdateRule:E,onRemoveRule:S,showOrLabel:q>0,theme:p})]},q))}):t.jsx("div",{style:{textAlign:"center",padding:"20px",color:p.textMuted,fontSize:"14px"},children:"No filters applied. All accounts with valid emails will be included."}),t.jsx("div",{style:{display:"flex",gap:"8px"},children:t.jsxs("button",{onClick:m,style:{flex:1,padding:"10px",backgroundColor:p.bgCard,border:`1px dashed ${p.border}`,borderRadius:"8px",color:p.primary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," ",b?"Add OR Group":"Add Filter Group"]})})]}),W>0&&t.jsxs("div",{style:{padding:"12px 16px",backgroundColor:`${p.primary}10`,borderRadius:"8px",marginBottom:"16px",fontSize:"13px",color:p.text},children:[t.jsx("strong",{children:W})," filter",W!==1?"s":""," in ",t.jsx("strong",{children:x.length})," group",x.length!==1?"s":"",x.length>1&&t.jsx("span",{style:{color:p.textSecondary},children:" (groups combined with OR)"}),t.jsx("span",{style:{color:p.textSecondary},children:" â€” results update automatically"})]}),t.jsxs("button",{onClick:()=>R(!0),disabled:a||o===0,style:{width:"100%",padding:"20px",backgroundColor:`${p.primary}10`,borderRadius:"12px",border:`1px solid ${p.primary}30`,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:a||o===0?"default":"pointer",textAlign:"left",transition:"all 0.2s"},onMouseEnter:T=>{!a&&o>0&&(T.currentTarget.style.backgroundColor=`${p.primary}18`,T.currentTarget.style.borderColor=`${p.primary}50`)},onMouseLeave:T=>{T.currentTarget.style.backgroundColor=`${p.primary}10`,T.currentTarget.style.borderColor=`${p.primary}30`},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:p.text},children:"Matching Recipients"}),t.jsx("div",{style:{fontSize:"12px",color:p.textSecondary},children:i&&o!==void 0?"Updating count...":o>0?"Click to view matching accounts":"Accounts with valid emails who haven't opted out"})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[t.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:p.primary,opacity:i?.6:1,transition:"opacity 0.2s"},children:a?"...":(o??0).toLocaleString()}),!a&&o>0&&t.jsx("div",{style:{padding:"6px 10px",backgroundColor:p.primary,color:"#fff",borderRadius:"6px",fontSize:"12px",fontWeight:"500"},children:"View"})]})]}),t.jsx(nr,{breakdown:n,isLoading:s,theme:p}),v&&t.jsx(Zo,{recipients:h,filterConfig:e,isLoading:y,onClose:()=>R(!1),theme:p})]})},sr=({template:e,filterConfig:r,subject:o,setSubject:a,name:i,setName:n,recipients:s,isLoadingRecipients:c,theme:d})=>t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:d.text,marginBottom:"16px"},children:"Review & Send"}),t.jsxs("div",{style:{padding:"20px",backgroundColor:d.bgCard,borderRadius:"12px",border:`1px solid ${d.border}`,marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:d.text,display:"block",marginBottom:"6px"},children:"Campaign Name"}),t.jsx("input",{type:"text",placeholder:"e.g., December Newsletter",value:i,onChange:l=>n(l.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgInput,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"}})]}),t.jsxs("div",{style:{padding:"20px",backgroundColor:d.bgCard,borderRadius:"12px",border:`1px solid ${d.border}`,marginBottom:"16px"},children:[t.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:d.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),t.jsx("input",{type:"text",placeholder:"Email subject...",value:o,onChange:l=>a(l.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgInput,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"}}),t.jsxs("p",{style:{fontSize:"12px",color:d.textMuted,marginTop:"6px"},children:["Use merge fields like ","{{first_name}}"," for personalization"]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[t.jsxs("div",{style:{padding:"16px",backgroundColor:d.bgCard,borderRadius:"12px",border:`1px solid ${d.border}`},children:[t.jsx("div",{style:{fontSize:"12px",color:d.textMuted,marginBottom:"4px"},children:"Template"}),t.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:d.text},children:e==null?void 0:e.name})]}),t.jsxs("div",{style:{padding:"16px",backgroundColor:d.bgCard,borderRadius:"12px",border:`1px solid ${d.border}`},children:[t.jsx("div",{style:{fontSize:"12px",color:d.textMuted,marginBottom:"4px"},children:"Recipients"}),t.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:d.text},children:[c?"...":((s==null?void 0:s.length)||0).toLocaleString()," accounts"]})]})]}),s&&s.length>0&&t.jsxs("div",{style:{padding:"16px",backgroundColor:d.bgCard,borderRadius:"12px",border:`1px solid ${d.border}`},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:d.text,marginBottom:"12px"},children:"Preview Recipients (first 10)"}),t.jsx("div",{style:{maxHeight:"200px",overflow:"auto"},children:s.slice(0,10).map((l,h)=>t.jsxs("div",{style:{padding:"8px 0",borderBottom:h<Math.min(9,s.length-1)?`1px solid ${d.border}`:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"13px",color:d.text},children:l.primary_contact_first_name?`${l.primary_contact_first_name} ${l.primary_contact_last_name||""}`:l.name}),t.jsx("div",{style:{fontSize:"12px",color:d.textMuted},children:l.person_email||l.email})]}),t.jsx("span",{style:{padding:"2px 8px",backgroundColor:d.bgHover,color:d.textSecondary,borderRadius:"4px",fontSize:"11px",textTransform:"capitalize"},children:l.account_status})]},l.account_unique_id))}),s.length>10&&t.jsxs("div",{style:{fontSize:"12px",color:d.textMuted,marginTop:"8px",textAlign:"center"},children:["+",s.length-10," more recipients"]})]})]}),lr=({t:e})=>{const{userId:r}=le(),[o,a]=C.useState(!1),[i,n]=C.useState(!1),[s,c]=C.useState(0),[d,l]=C.useState(null),[h,y]=C.useState({rules:[],search:"",notOptedOut:!0}),[p,v]=C.useState(!1),[R,x]=C.useState(""),[b,m]=C.useState(""),[I,D]=C.useState(!1),[E,S]=C.useState(null),[_,W]=C.useState(null),{data:V,isLoading:T,refetch:q}=Je(),{data:P,isLoading:K,refetch:L}=uo(),{data:N}=wt(p),{data:O,isLoading:B,isFetching:u}=kt(s>=1?h:null,p),{data:A,isLoading:G}=xo(s>=1?h:null,p),{data:Q,isLoading:Z}=Ke(s>=1?h:null,{limit:500}),{data:$,isLoading:w}=Ke(s===2?h:null,{limit:100}),{createBatch:f,scheduleBatch:z}=go(),{createTemplate:j}=mt(),M=["Select Template","Filter Recipients","Review & Send"],ze=re=>{l(re),x(re.subject||"")},Re=async re=>{const me=await j.mutateAsync(re);return await q(),me},ee=re=>{n(!1),re&&(l(re),x(re.subject||""))},We=()=>{s<2&&c(s+1)},Be=()=>{s>0&&c(s-1)},Ee=async()=>{if(!(!d||!R)){D(!0),S(null);try{const re=await f.mutateAsync({name:b||`Mass Email - ${new Date().toLocaleDateString()}`,subject:R,template_id:d.id,filter_config:h,total_recipients:O||0});await z.mutateAsync({batchId:re.id}),W(`Successfully scheduled ${O} emails for sending!`),a(!1),Ae(),L()}catch(re){S(re.message||"Failed to send mass email")}finally{D(!1)}}},Ae=()=>{c(0),l(null),y({rules:[],search:"",notOptedOut:!0}),v(!1),x(""),m("")},ue=()=>s===0?!!d:s===1?(O||0)>0:s===2?!!R&&!!b:!1;return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Mass Email"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px",margin:0},children:"Send one-off emails to filtered recipients"})]}),!o&&t.jsxs("button",{onClick:()=>a(!0),style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("span",{children:"+"})," New Campaign"]})]}),_&&t.jsxs("div",{style:{padding:"16px",backgroundColor:`${e.success}15`,border:`1px solid ${e.success}30`,borderRadius:"8px",marginBottom:"24px",color:e.success,fontSize:"14px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[_,t.jsx("button",{onClick:()=>W(null),style:{background:"none",border:"none",color:e.success,cursor:"pointer"},children:"Ã—"})]}),o?t.jsxs("div",{style:{backgroundColor:e.bgCard,borderRadius:"16px",border:`1px solid ${e.border}`,padding:"24px"},children:[t.jsx(Vo,{currentStep:s,steps:M,theme:e}),E&&t.jsx("div",{style:{padding:"12px 16px",backgroundColor:`${e.danger}15`,border:`1px solid ${e.danger}30`,borderRadius:"8px",marginBottom:"16px",color:e.danger,fontSize:"14px"},children:E}),t.jsxs("div",{style:{minHeight:"300px"},children:[s===0&&t.jsx(Qo,{selectedTemplate:d,onSelect:ze,onCreateNew:()=>n(!0),templates:V,isLoading:T,theme:e}),s===1&&t.jsx(ir,{filterConfig:h,setFilterConfig:y,recipientCount:O,isLoading:B,isFetching:u,locationBreakdown:A,isLoadingBreakdown:G,includeRoleAccounts:p,setIncludeRoleAccounts:v,roleUserCount:(N==null?void 0:N.length)||1,previewRecipients:Q,isLoadingPreview:Z,theme:e}),s===2&&t.jsx(sr,{template:d,filterConfig:h,subject:R,setSubject:x,name:b,setName:m,recipients:$,isLoadingRecipients:w,theme:e})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"24px",borderTop:`1px solid ${e.border}`,marginTop:"24px"},children:[t.jsx("button",{onClick:()=>{s===0?(a(!1),Ae()):Be()},style:{padding:"10px 20px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"8px",color:e.text,cursor:"pointer",fontSize:"14px"},children:s===0?"Cancel":"Back"}),s<2?t.jsx("button",{onClick:We,disabled:!ue(),style:{padding:"10px 24px",backgroundColor:ue()?e.primary:e.bgHover,border:"none",borderRadius:"8px",color:ue()?"#fff":e.textMuted,cursor:ue()?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500"},children:"Continue"}):t.jsx("button",{onClick:Ee,disabled:!ue()||I,style:{padding:"10px 24px",backgroundColor:ue()&&!I?e.success:e.bgHover,border:"none",borderRadius:"8px",color:ue()&&!I?"#fff":e.textMuted,cursor:ue()&&!I?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px"},children:I?"Sending...":"Send Emails"})]})]}):t.jsx(t.Fragment,{children:t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:e.text,marginBottom:"16px"},children:"Recent Campaigns"}),K?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:Array.from({length:3}).map((re,me)=>t.jsxs("div",{style:{padding:"16px",backgroundColor:e.bgCard,borderRadius:"10px",border:`1px solid ${e.border}`},children:[t.jsx(Fe,{width:"200px",height:"18px"}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(Fe,{width:"300px",height:"14px"})})]},me))}):P&&P.length>0?t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:P.map(re=>t.jsx(Ko,{batch:re,onView:me=>console.log("View batch:",me),theme:e},re.id))}):t.jsxs("div",{style:{padding:"60px 20px",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ“§"}),t.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:e.text,marginBottom:"8px"},children:"No campaigns yet"}),t.jsx("p",{style:{fontSize:"14px",color:e.textSecondary,marginBottom:"24px"},children:"Create your first mass email campaign to reach your clients."}),t.jsx("button",{onClick:()=>a(!0),style:{padding:"10px 20px",backgroundColor:e.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Campaign"})]})]})}),i&&t.jsx(Go,{template:null,onSave:Re,onClose:ee,theme:e})]})},dr=C.createContext(),Ue={light:{bg:"#f8fafc",bgCard:"#ffffff",bgSidebar:"#ffffff",bgHover:"#f1f5f9",bgInput:"#ffffff",border:"#e2e8f0",borderLight:"#f1f5f9",text:"#1e293b",textSecondary:"#64748b",textMuted:"#94a3b8",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},dark:{bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"}},cr=C.createContext(),pr=({t:e})=>{const r=ye(),{isAdmin:o,isAgencyAdmin:a,user:i,impersonate:n,impersonating:s}=ve(),[c,d]=C.useState(!1),[l,h]=C.useState(""),[y,p]=C.useState([]),[v,R]=C.useState(!1),x=ke.useRef(null);if(!o&&!a)return null;const b=async(_="")=>{R(!0);try{if(o){const W=await pe.getAllUsers(_);p(W)}else if(a&&(i!=null&&i.profileName)){const W=await pe.getAgencyAgents(i.profileName,i.id,_);p(W)}}catch(W){console.error("Error fetching users:",W)}finally{R(!1)}},m=async()=>{d(!0),await b()},I=_=>{h(_),x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{b(_)},300)},D=_=>{const W=`${_.first_name||""} ${_.last_name||""}`.trim()||_.email;n(_.user_unique_id,W,_.profile_name),d(!1),h(""),r(`/${_.user_unique_id}/dashboard`)},E=()=>o?"View As User":"View As Agent",S=()=>o?"Select a user to impersonate":"Select an agent in your agency to impersonate";return t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:m,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",color:e.textSecondary,cursor:"pointer",fontSize:"13px",textAlign:"left",alignItems:"center",gap:"10px"},children:[t.jsx("span",{children:"ðŸ‘ï¸"})," ",E(),s.active&&t.jsx("span",{style:{marginLeft:"auto",padding:"2px 6px",backgroundColor:e.warning,borderRadius:"4px",fontSize:"9px",color:"#fff",fontWeight:"600"},children:"ACTIVE"})]}),c&&t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>d(!1),children:t.jsxs("div",{style:{backgroundColor:e.bgCard,borderRadius:"12px",width:"400px",maxHeight:"500px",overflow:"hidden",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:_=>_.stopPropagation(),children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${e.border}`},children:[t.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:e.text},children:E()}),t.jsx("p",{style:{margin:"4px 0 0",fontSize:"13px",color:e.textMuted},children:S()})]}),t.jsx("div",{style:{padding:"12px 20px"},children:t.jsx("input",{type:"text",placeholder:"Search by name or email...",value:l,onChange:_=>I(_.target.value),style:{width:"100%",padding:"10px 12px",fontSize:"14px",border:`1px solid ${e.border}`,borderRadius:"8px",backgroundColor:e.bgInput,color:e.text,outline:"none"},autoFocus:!0})}),t.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",padding:"0 12px 12px"},children:v?t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted},children:"Loading..."}):y.length===0?t.jsx("div",{style:{padding:"20px",textAlign:"center",color:e.textMuted},children:"No users found"}):y.map(_=>{const W=`${_.first_name||""} ${_.last_name||""}`.trim()||"Unknown";return t.jsxs("button",{onClick:()=>D(_),style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",textAlign:"left",alignItems:"center",gap:"12px",marginBottom:"4px"},onMouseEnter:V=>V.currentTarget.style.backgroundColor=e.bgHover,onMouseLeave:V=>V.currentTarget.style.backgroundColor="transparent",children:[t.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:e.bgHover,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",flexShrink:0},children:"ðŸ‘¤"}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:e.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:W}),t.jsx("div",{style:{fontSize:"12px",color:e.textMuted,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:_.email})]})]},_.user_unique_id)})}),t.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${e.border}`,display:"flex",justifyContent:"flex-end"},children:t.jsx("button",{onClick:()=>d(!1),style:{padding:"8px 16px",fontSize:"13px",backgroundColor:e.bgHover,border:`1px solid ${e.border}`,borderRadius:"6px",color:e.text,cursor:"pointer"},children:"Cancel"})})]})})]})},ur=()=>{const{userId:e}=le(),r=Ye(),o=ye(),[a,i]=C.useState(!1),{user:n,isAdmin:s,impersonating:c,logout:d}=ve(),{data:l}=oe({queryKey:["currentUser",e],queryFn:()=>he.getCurrentUser(e),enabled:!!e}),[h,y]=C.useState({id:e,name:"",email:"",org:""});C.useEffect(()=>{l&&y({id:e,name:`${l.first_name||""} ${l.last_name||""}`.trim()||"Unknown User",email:l.email||"",org:l.profile_name||""})},[l,e]),C.useEffect(()=>{n&&e&&!c.active&&n.id!==e&&!s&&o(`/${n.id}/dashboard`,{replace:!0})},[n,e,s,c.active,o]);const p=a?Ue.dark:Ue.light,R=(()=>{const I=r.pathname.split("/").slice(2).join("/");return I.startsWith("automations/")?"automations":I.startsWith("accounts/")?"accounts":I||"dashboard"})(),x=[{id:"dashboard",label:"Dashboard",icon:"ðŸ“Š",path:`/${e}/dashboard`},{id:"automations",label:"Automations",icon:"âš¡",path:`/${e}/automations`},{id:"templates",label:"Templates",icon:"ðŸ“",path:`/${e}/templates`},{id:"mass-email",label:"Mass Email",icon:"ðŸ“§",path:`/${e}/mass-email`},{id:"accounts",label:"Accounts",icon:"ðŸ‘¥",path:`/${e}/accounts`},{id:"settings",label:"Settings",icon:"âš™ï¸",path:`/${e}/settings`}],b=async()=>{await d(),o("/login")},m=c.active?"44px":"0px";return t.jsx(dr.Provider,{value:{isDark:a,setIsDark:i,t:p,themes:Ue},children:t.jsxs(cr.Provider,{value:{userId:e,currentUser:h,setCurrentUser:y},children:[t.jsx(Ht,{}),t.jsxs("div",{style:{fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",backgroundColor:p.bg,minHeight:"100vh",display:"flex",color:p.text,paddingTop:m},children:[t.jsxs("div",{style:{width:"220px",backgroundColor:p.bgSidebar,borderRight:`1px solid ${p.border}`,display:"flex",flexDirection:"column",position:"fixed",top:m,left:0,bottom:0},children:[t.jsx("div",{style:{padding:"20px 16px",borderBottom:`1px solid ${p.border}`},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:p.primary,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"18px"},children:"ðŸ“§"}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"700",fontSize:"14px",color:p.text},children:"Email Automation"}),t.jsx("div",{style:{fontSize:"11px",color:p.textMuted},children:"Marketing System"})]})]})}),t.jsxs("div",{style:{flex:1,padding:"12px 8px",overflowY:"auto"},children:[t.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:p.textMuted,padding:"8px 12px",textTransform:"uppercase"},children:"Navigation"}),x.map(I=>t.jsxs(Ce,{to:I.path,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:R===I.id?`${p.primary}15`:"transparent",border:"none",borderRadius:"8px",color:R===I.id?p.primary:p.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:R===I.id?"600":"400",textAlign:"left",alignItems:"center",gap:"10px",marginBottom:"2px",textDecoration:"none"},children:[t.jsx("span",{children:I.icon})," ",I.label]},I.id)),t.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:p.textMuted,padding:"16px 12px 8px",textTransform:"uppercase"},children:"Admin"}),t.jsxs(Ce,{to:`/${e}/timeline`,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:R==="timeline"?`${p.primary}15`:"transparent",border:"none",borderRadius:"8px",color:R==="timeline"?p.primary:p.textSecondary,cursor:"pointer",fontSize:"13px",textAlign:"left",alignItems:"center",gap:"10px",textDecoration:"none"},children:[t.jsx("span",{children:"ðŸ“ˆ"})," Timeline",t.jsx("span",{style:{marginLeft:"auto",padding:"2px 8px",backgroundColor:p.bgHover,borderRadius:"4px",fontSize:"10px",color:p.textMuted},children:"Admin"})]}),t.jsx(pr,{t:p})]}),t.jsxs("div",{style:{padding:"16px",borderTop:`1px solid ${p.border}`},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"12px"},children:[t.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:p.bgHover,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:"ðŸ‘¤"}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:p.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c.active?h.name:n==null?void 0:n.name}),t.jsx("div",{style:{fontSize:"11px",color:p.textMuted,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c.active?h.email:n==null?void 0:n.email})]})]}),t.jsxs("button",{onClick:b,style:{width:"100%",padding:"8px 12px",fontSize:"13px",backgroundColor:"transparent",border:`1px solid ${p.border}`,borderRadius:"6px",color:p.textSecondary,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[t.jsx("span",{children:"ðŸšª"})," Sign Out"]})]})]}),t.jsxs("div",{style:{flex:1,marginLeft:"220px"},children:[t.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${p.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:p.bgCard},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[t.jsx("div",{style:{fontSize:"11px",color:p.textMuted},children:c.active?t.jsxs("span",{children:["Viewing as: ",t.jsx("strong",{children:h.name})]}):t.jsxs("span",{children:["User: ",e==null?void 0:e.substring(0,8),"..."]})}),t.jsx(Ut,{t:p})]}),t.jsx("button",{onClick:()=>i(!a),style:{padding:"8px 12px",backgroundColor:p.bgHover,border:`1px solid ${p.border}`,borderRadius:"8px",color:p.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:a?"â˜€ï¸ Light":"ðŸŒ™ Dark"})]}),t.jsx("div",{style:{padding:"24px"},children:t.jsxs(ft,{children:[t.jsx(ae,{path:"dashboard",element:t.jsx(dt,{t:p})}),t.jsx(ae,{path:"automations",element:t.jsx(vo,{t:p})}),t.jsx(ae,{path:"automations/new",element:t.jsx(xt,{t:p})}),t.jsx(ae,{path:"automations/:automationId",element:t.jsx(xt,{t:p})}),t.jsx(ae,{path:"templates",element:t.jsx(So,{t:p})}),t.jsx(ae,{path:"mass-email",element:t.jsx(lr,{t:p})}),t.jsx(ae,{path:"accounts",element:t.jsx(zo,{t:p})}),t.jsx(ae,{path:"accounts/:accountId",element:t.jsx($o,{t:p})}),t.jsx(ae,{path:"settings",element:t.jsx(Mo,{t:p})}),t.jsx(ae,{path:"timeline",element:t.jsx(xr,{t:p})}),t.jsx(ae,{path:"*",element:t.jsx(dt,{t:p})})]})})]})]})]})})},xr=({t:e})=>t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:e.text,marginBottom:"4px"},children:"Activity Timeline"}),t.jsx("p",{style:{color:e.textSecondary,fontSize:"14px"},children:"View all email activity across your organization"}),t.jsxs("div",{style:{marginTop:"24px",padding:"60px",textAlign:"center",backgroundColor:e.bgCard,borderRadius:"12px",border:`1px solid ${e.border}`},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ“ˆ"}),t.jsx("p",{style:{color:e.textMuted},children:"Timeline view coming soon..."})]})]}),gr=()=>{const e=ye(),{isAuthenticated:r,isLoading:o,user:a}=ve();return C.useEffect(()=>{o||(r&&(a!=null&&a.id)?e(`/${a.id}/dashboard`,{replace:!0}):e("/login",{replace:!0}))},[r,o,a,e]),t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"'Inter', sans-serif"},children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"32px",marginBottom:"16px"},children:"â³"}),t.jsx("div",{children:"Loading..."})]})})},fr=()=>t.jsxs($t,{client:qt,children:[t.jsx(Wt,{children:t.jsx(Ot,{children:t.jsxs(ft,{children:[t.jsx(ae,{path:"/login",element:t.jsx(Ft,{})}),t.jsx(ae,{path:"/",element:t.jsx(gr,{})}),t.jsx(ae,{path:"/:userId/*",element:t.jsx(Nt,{children:t.jsx(ur,{})})})]})})}),t.jsx(Et,{initialIsOpen:!1})]});Ge.createRoot(document.getElementById("root")).render(t.jsx(ke.StrictMode,{children:t.jsx(fr,{})}));
