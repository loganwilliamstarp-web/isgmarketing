import{Q as ns,u as ve,a as ei,b as ce,j as i,c as os}from"./query-BHFOmHtL.js";import{a as rs,u as _e,L as Xe,b as ut,r as O,R as Ne,c as po,d as ss,g as as,B as ls,e as ho,f as Ce}from"./vendor-fFS1ukCR.js";import{c as ds}from"./supabase-GtAdROLV.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))l(d);new MutationObserver(d=>{for(const p of d)if(p.type==="childList")for(const u of p.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function s(d){const p={};return d.integrity&&(p.integrity=d.integrity),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?p.credentials="include":d.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function l(d){if(d.ep)return;d.ep=!0;const p=s(d);fetch(d.href,p)}})();var qi={},so=rs;qi.createRoot=so.createRoot,qi.hydrateRoot=so.hydrateRoot;var cs=function(){return null};const us=new ns({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*30,retry:1,refetchOnWindowFocus:!0,refetchOnMount:!0},mutations:{retry:0}}}),ps=void 0,hs=void 0;throw new Error("Missing Supabase environment variables");const j=ds(ps,hs),ct={async getAll(n,r={}){const{category:s,isDefault:l,search:d}=r;let p=j.from("email_templates").select("*").eq("owner_id",n).order("is_default",{ascending:!1}).order("name");s&&(p=p.eq("category",s)),typeof l=="boolean"&&(p=p.eq("is_default",l)),d&&(p=p.or(`name.ilike.%${d}%,subject.ilike.%${d}%`));const{data:u,error:g}=await p;if(g)throw g;return u},async getById(n,r){const{data:s,error:l}=await j.from("email_templates").select("*").eq("owner_id",n).eq("id",r).single();if(l)throw l;return s},async getByDefaultKey(n,r){const{data:s,error:l}=await j.from("email_templates").select("*").eq("owner_id",n).eq("default_key",r).single();if(l)throw l;return s},async create(n,r){const{data:s,error:l}=await j.from("email_templates").insert({owner_id:n,is_default:!1,...r}).select().single();if(l)throw l;return s},async update(n,r,s){const{data:l,error:d}=await j.from("email_templates").update({...s,updated_at:new Date().toISOString()}).eq("owner_id",n).eq("id",r).select().single();if(d)throw d;return l},async delete(n,r){const{error:s}=await j.from("email_templates").delete().eq("owner_id",n).eq("id",r).eq("is_default",!1);if(s)throw s;return!0},async duplicate(n,r){const s=await this.getById(n,r),{data:l,error:d}=await j.from("email_templates").insert({owner_id:n,is_default:!1,default_key:null,name:`${s.name} (Copy)`,subject:s.subject,body_html:s.body_html,body_text:s.body_text,category:s.category,merge_fields:s.merge_fields}).select().single();if(d)throw d;return l},async getByCategory(n,r){const{data:s,error:l}=await j.from("email_templates").select("*").eq("owner_id",n).eq("category",r).order("is_default",{ascending:!1}).order("name");if(l)throw l;return s},async getCategories(n){const{data:r,error:s}=await j.from("email_templates").select("category").eq("owner_id",n).not("category","is",null);if(s)throw s;return[...new Set(r.map(l=>l.category))]},async resetToDefault(n,r){return this.getById(n,r)}},Fi=()=>{const{userId:n}=_e();return n};function fo(n={}){const r=Fi();return ve({queryKey:["templates",r,n],queryFn:()=>ct.getAll(r,n),enabled:!!r})}function fs(){const n=Fi();return ve({queryKey:["templates",n,"categories"],queryFn:()=>ct.getCategories(n),enabled:!!n})}function xo(){const n=Fi(),r=ei(),s=()=>{r.invalidateQueries({queryKey:["templates",n]})},l=ce({mutationFn:g=>ct.create(n,g),onSuccess:s}),d=ce({mutationFn:({templateId:g,updates:m})=>ct.update(n,g,m),onSuccess:g=>{s(),r.setQueryData(["template",n,g.id],g)}}),p=ce({mutationFn:g=>ct.delete(n,g),onSuccess:s}),u=ce({mutationFn:g=>ct.duplicate(n,g),onSuccess:s});return{createTemplate:l,updateTemplate:d,deleteTemplate:p,duplicateTemplate:u}}const ke={async getAll(n,r={}){const{status:s,category:l,search:d}=r;let p=j.from("automations").select(`
        *,
        _count:automation_enrollments(count)
      `).eq("owner_id",n).order("is_default",{ascending:!1}).order("name");s&&(p=p.eq("status",s)),l&&(p=p.eq("category",l)),d&&(p=p.or(`name.ilike.%${d}%,description.ilike.%${d}%`));const{data:u,error:g}=await p;if(g)throw g;return u},async getAllWithStats(n){const{data:r,error:s}=await j.from("automations").select("*").eq("owner_id",n).order("is_default",{ascending:!1}).order("name");if(s)throw s;const l=r.map(g=>g.id),{data:d,error:p}=await j.from("automation_enrollments").select("automation_id, status").in("automation_id",l);if(p)throw p;const u={};return d.forEach(g=>{u[g.automation_id]||(u[g.automation_id]={total:0,active:0,completed:0,exited:0}),u[g.automation_id].total++,u[g.automation_id][g.status.toLowerCase()]++}),r.map(g=>({...g,enrollmentStats:u[g.id]||{total:0,active:0,completed:0,exited:0}}))},async getById(n,r){const{data:s,error:l}=await j.from("automations").select("*").eq("owner_id",n).eq("id",r).single();if(l)throw l;return s},async getByIdWithDetails(n,r){const s=await this.getById(n,r),{data:l,error:d}=await j.from("automation_enrollments").select("status").eq("automation_id",r);if(d)throw d;const p={total:l.length,active:l.filter(f=>f.status==="Active").length,completed:l.filter(f=>f.status==="Completed").length,exited:l.filter(f=>f.status==="Exited").length,paused:l.filter(f=>f.status==="Paused").length},{data:u,error:g}=await j.from("email_logs").select("status, open_count, click_count").eq("automation_id",r);if(g)throw g;const m={sent:u.length,delivered:u.filter(f=>f.status==="Delivered"||f.status==="Opened"||f.status==="Clicked").length,opened:u.filter(f=>f.open_count>0).length,clicked:u.filter(f=>f.click_count>0).length,bounced:u.filter(f=>f.status==="Bounced").length};return{...s,enrollmentStats:p,emailSummary:m}},async getByDefaultKey(n,r){const{data:s,error:l}=await j.from("automations").select("*").eq("owner_id",n).eq("default_key",r).single();if(l)throw l;return s},async create(n,r){const{data:s,error:l}=await j.from("automations").insert({owner_id:n,is_default:!1,status:"Draft",...r}).select().single();if(l)throw l;return s},async update(n,r,s){const{data:l,error:d}=await j.from("automations").update({...s,updated_at:new Date().toISOString()}).eq("owner_id",n).eq("id",r).select().single();if(d)throw d;return l},async updateStatus(n,r,s){return this.update(n,r,{status:s})},async activate(n,r){return this.updateStatus(n,r,"active")},async pause(n,r){return this.updateStatus(n,r,"paused")},async archive(n,r){return this.updateStatus(n,r,"archived")},async delete(n,r){const{error:s}=await j.from("automations").delete().eq("owner_id",n).eq("id",r).eq("is_default",!1);if(s)throw s;return!0},async duplicate(n,r){const s=await this.getById(n,r),{data:l,error:d}=await j.from("automations").insert({owner_id:n,is_default:!1,default_key:null,name:`${s.name} (Copy)`,description:s.description,category:s.category,status:"Draft",send_time:s.send_time,timezone:s.timezone,frequency:s.frequency,max_enrollments:s.max_enrollments,enrollment_cooldown_days:s.enrollment_cooldown_days,distribute_evenly:s.distribute_evenly,filter_config:s.filter_config,nodes:s.nodes}).select().single();if(d)throw d;return l},async updateFilters(n,r,s){return this.update(n,r,{filter_config:s})},async updateNodes(n,r,s){return this.update(n,r,{nodes:s})},async updateSchedule(n,r,s){const{sendTime:l,timezone:d,frequency:p}=s;return this.update(n,r,{send_time:l,timezone:d,frequency:p})},async updateEnrollmentRules(n,r,s){const{maxEnrollments:l,cooldownDays:d,distributeEvenly:p}=s;return this.update(n,r,{max_enrollments:l,enrollment_cooldown_days:d,distribute_evenly:p})},async getByStatus(n,r){const{data:s,error:l}=await j.from("automations").select("*").eq("owner_id",n).eq("status",r).order("name");if(l)throw l;return s},async getActive(n){return this.getByStatus(n,"Active")},async getCategories(n){const{data:r,error:s}=await j.from("automations").select("category").eq("owner_id",n).not("category","is",null);if(s)throw s;return[...new Set(r.map(l=>l.category))]}},$i=()=>{const{userId:n}=_e();return n};function xs(){const n=$i();return ve({queryKey:["automations",n,"withStats"],queryFn:()=>ke.getAllWithStats(n),enabled:!!n})}function ms(n){const r=$i();return ve({queryKey:["automation",r,n],queryFn:()=>ke.getById(r,n),enabled:!!r&&!!n})}function mo(){const n=$i(),r=ei(),s=()=>{r.invalidateQueries({queryKey:["automations",n]})},l=ce({mutationFn:w=>ke.create(n,w),onSuccess:s}),d=ce({mutationFn:({automationId:w,updates:k})=>ke.update(n,w,k),onSuccess:w=>{s(),r.setQueryData(["automation",n,w.id],w)}}),p=ce({mutationFn:w=>ke.delete(n,w),onSuccess:s}),u=ce({mutationFn:w=>ke.duplicate(n,w),onSuccess:s}),g=ce({mutationFn:w=>ke.activate(n,w),onSuccess:w=>{s(),r.setQueryData(["automation",n,w.id],w)}}),m=ce({mutationFn:w=>ke.pause(n,w),onSuccess:w=>{s(),r.setQueryData(["automation",n,w.id],w)}}),f=ce({mutationFn:w=>ke.archive(n,w),onSuccess:s}),P=ce({mutationFn:({automationId:w,filterConfig:k})=>ke.updateFilters(n,w,k),onSuccess:w=>{r.setQueryData(["automation",n,w.id],w)}}),v=ce({mutationFn:({automationId:w,nodes:k})=>ke.updateNodes(n,w,k),onSuccess:w=>{r.setQueryData(["automation",n,w.id],w)}}),I=ce({mutationFn:({automationId:w,scheduleConfig:k})=>ke.updateSchedule(n,w,k),onSuccess:w=>{r.setQueryData(["automation",n,w.id],w)}}),T=ce({mutationFn:({automationId:w,rules:k})=>ke.updateEnrollmentRules(n,w,k),onSuccess:w=>{r.setQueryData(["automation",n,w.id],w)}});return{createAutomation:l,updateAutomation:d,deleteAutomation:p,duplicateAutomation:u,activateAutomation:g,pauseAutomation:m,archiveAutomation:f,updateFilters:P,updateNodes:v,updateSchedule:I,updateEnrollmentRules:T}}const gs={async getByAutomation(n,r={}){const{status:s,limit:l=50,offset:d=0}=r;let p=j.from("automation_enrollments").select(`
        *,
        account:accounts(
          account_unique_id,
          name,
          person_email,
          email,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("automation_id",n).order("enrolled_at",{ascending:!1}).range(d,d+l-1);s&&(p=p.eq("status",s));const{data:u,error:g}=await p;if(g)throw g;return u},async getByAccount(n,r={}){const{status:s}=r;let l=j.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category, status)
      `).eq("account_id",n).order("enrolled_at",{ascending:!1});s&&(l=l.eq("status",s));const{data:d,error:p}=await l;if(p)throw p;return d},async getById(n){const{data:r,error:s}=await j.from("automation_enrollments").select(`
        *,
        account:accounts(*),
        automation:automations(*)
      `).eq("id",n).single();if(s)throw s;return r},async getStats(n){const{data:r,error:s}=await j.from("automation_enrollments").select("status, emails_sent, emails_opened, emails_clicked").eq("automation_id",n);if(s)throw s;const l={total:r.length,active:0,completed:0,exited:0,paused:0,totalEmailsSent:0,totalOpens:0,totalClicks:0};return r.forEach(d=>{l[d.status.toLowerCase()]++,l.totalEmailsSent+=d.emails_sent||0,l.totalOpens+=d.emails_opened||0,l.totalClicks+=d.emails_clicked||0}),l},async canEnroll(n,r){const{data:s,error:l}=await j.rpc("can_enroll_in_automation",{p_account_id:n,p_automation_id:r});if(l)throw l;return s},async enroll(n,r,s={}){var f;if(!await this.canEnroll(r,n))throw new Error("Account cannot be enrolled in this automation");const{data:d,error:p}=await j.from("automations").select("nodes").eq("id",n).single();if(p)throw p;const u=(f=d.nodes)==null?void 0:f[0],{data:g,error:m}=await j.from("automation_enrollments").insert({automation_id:n,account_id:r,status:"Active",current_node_id:(u==null?void 0:u.id)||null,metadata:s}).select().single();if(m)throw m;return g},async bulkEnroll(n,r){const s={enrolled:[],skipped:[],errors:[]};for(const l of r)try{if(await this.canEnroll(l,n)){const p=await this.enroll(n,l);s.enrolled.push(p)}else s.skipped.push(l)}catch(d){s.errors.push({accountId:l,error:d.message})}return s},async exit(n,r="manual"){const{data:s,error:l}=await j.from("automation_enrollments").update({status:"Exited",exit_reason:r,exited_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",n).select().single();if(l)throw l;return s},async pause(n){const{data:r,error:s}=await j.from("automation_enrollments").update({status:"Paused",updated_at:new Date().toISOString()}).eq("id",n).select().single();if(s)throw s;return r},async resume(n){const{data:r,error:s}=await j.from("automation_enrollments").update({status:"Active",updated_at:new Date().toISOString()}).eq("id",n).select().single();if(s)throw s;return r},async complete(n){const{data:r,error:s}=await j.from("automation_enrollments").update({status:"Completed",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",n).select().single();if(s)throw s;return r},async updateProgress(n,r,s=null){const{data:l,error:d}=await j.from("automation_enrollments").update({current_node_id:r,current_branch:s,last_action_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",n).select().single();if(d)throw d;return l},async setNextAction(n,r){const{data:s,error:l}=await j.from("automation_enrollments").update({next_action_at:r,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(l)throw l;return s},async incrementEmailSent(n){const{data:r,error:s}=await j.rpc("increment_enrollment_email_sent",{p_enrollment_id:n});if(s){const{data:l}=await j.from("automation_enrollments").select("emails_sent").eq("id",n).single();return j.from("automation_enrollments").update({emails_sent:((l==null?void 0:l.emails_sent)||0)+1}).eq("id",n)}return r},async getReadyForAction(){const{data:n,error:r}=await j.from("automation_enrollments").select(`
        *,
        automation:automations(*),
        account:accounts(*)
      `).eq("status","Active").lte("next_action_at",new Date().toISOString()).order("next_action_at");if(r)throw r;return n},async getHistory(n){const{data:r,error:s}=await j.from("enrollment_history").select(`
        *,
        email_log:email_logs(id, subject, status, sent_at, first_opened_at, first_clicked_at)
      `).eq("enrollment_id",n).order("created_at",{ascending:!0});if(s)throw s;return r},async logHistory(n,r){const{data:s,error:l}=await j.from("enrollment_history").insert({enrollment_id:n,...r}).select().single();if(l)throw l;return s}};function _s(n,r={}){return ve({queryKey:["enrollments","account",n,r],queryFn:()=>gs.getByAccount(n,r),enabled:!!n,staleTime:3e4})}const Qt={async getAll(n,r={}){const{status:s,automationId:l,accountId:d,limit:p=50,offset:u=0,startDate:g,endDate:m}=r;let f=j.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email, primary_contact_first_name),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",n).order("created_at",{ascending:!1}).range(u,u+p-1);s&&(f=f.eq("status",s)),l&&(f=f.eq("automation_id",l)),d&&(f=f.eq("account_id",d)),g&&(f=f.gte("sent_at",g)),m&&(f=f.lte("sent_at",m));const{data:P,error:v}=await f;if(v)throw v;return P},async getById(n,r){const{data:s,error:l}=await j.from("email_logs").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name),
        enrollment:automation_enrollments(id, status)
      `).eq("owner_id",n).eq("id",r).single();if(l)throw l;return s},async getByIdWithEvents(n,r){const s=await this.getById(n,r),{data:l,error:d}=await j.from("email_events").select("*").eq("email_log_id",r).order("event_timestamp",{ascending:!0});if(d)throw d;return{...s,events:l}},async getByAccount(n,r,s={}){const{limit:l=20}=s,{data:d,error:p}=await j.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",n).eq("account_id",r).order("created_at",{ascending:!1}).limit(l);if(p)throw p;return d},async getByAutomation(n,r,s={}){const{limit:l=50,offset:d=0,status:p}=s;let u=j.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",n).eq("automation_id",r).order("created_at",{ascending:!1}).range(d,d+l-1);p&&(u=u.eq("status",p));const{data:g,error:m}=await u;if(m)throw m;return g},async create(n,r){const{data:s,error:l}=await j.from("email_logs").insert({owner_id:n,status:"Queued",...r}).select().single();if(l)throw l;return s},async updateStatus(n,r,s,l={}){const{data:d,error:p}=await j.from("email_logs").update({status:s,...l,updated_at:new Date().toISOString()}).eq("owner_id",n).eq("id",r).select().single();if(p)throw p;return d},async markSent(n,r,s){return this.updateStatus(n,r,"Sent",{sent_at:new Date().toISOString(),sendgrid_message_id:s})},async markFailed(n,r,s,l=null){return this.updateStatus(n,r,"Failed",{failed_at:new Date().toISOString(),error_message:s,error_code:l})},async getRecentOpens(n,r=10){const{data:s,error:l}=await j.from("email_logs").select(`
        id, subject, first_opened_at, open_count,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",n).not("first_opened_at","is",null).order("first_opened_at",{ascending:!1}).limit(r);if(l)throw l;return s},async getRecentClicks(n,r=10){const{data:s,error:l}=await j.from("email_logs").select(`
        id, subject, first_clicked_at, click_count,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",n).not("first_clicked_at","is",null).order("first_clicked_at",{ascending:!1}).limit(r);if(l)throw l;return s},async getBounces(n,r={}){const{limit:s=50,offset:l=0}=r,{data:d,error:p}=await j.from("email_logs").select(`
        *,
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",n).eq("status","Bounced").order("bounced_at",{ascending:!1}).range(l,l+s-1);if(p)throw p;return d},async getStats(n,r,s,l=null){const{data:d,error:p}=await j.rpc("get_email_stats",{p_owner_id:n,p_start_date:r,p_end_date:s,p_automation_id:l});if(p)throw p;return(d==null?void 0:d[0])||{total_sent:0,total_delivered:0,total_opened:0,unique_opens:0,total_clicked:0,unique_clicks:0,total_bounced:0,open_rate:0,click_rate:0}},async getDailyStats(n,r,s,l=null){let d=j.from("email_stats_daily").select("*").eq("owner_id",n).gte("stat_date",r).lte("stat_date",s).order("stat_date");l?d=d.eq("automation_id",l):d=d.is("automation_id",null);const{data:p,error:u}=await d;if(u)throw u;return p},async getComparisonStats(n,r=30){const s=new Date,l=new Date(s);l.setDate(l.getDate()-r);const d=new Date(l);d.setDate(d.getDate()-r);const[p,u]=await Promise.all([this.getStats(n,l.toISOString().split("T")[0],s.toISOString().split("T")[0]),this.getStats(n,d.toISOString().split("T")[0],l.toISOString().split("T")[0])]),g=(m,f)=>f===0?m>0?100:0:((m-f)/f*100).toFixed(1);return{current:p,previous:u,changes:{sent:g(p.total_sent,u.total_sent),delivered:g(p.total_delivered,u.total_delivered),opened:g(p.unique_opens,u.unique_opens),clicked:g(p.unique_clicks,u.unique_clicks),bounced:g(p.total_bounced,u.total_bounced)}}}},ys=()=>{const{userId:n}=_e();return n};function vs(n,r={}){const s=ys();return ve({queryKey:["emailLogs",s,"account",n,r],queryFn:()=>Qt.getByAccount(s,n,r),enabled:!!s&&!!n,staleTime:3e4})}const go={async getRecent(n,r={}){const{category:s,limit:l=20,offset:d=0}=r;let p=j.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name),
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).eq("owner_id",n).order("created_at",{ascending:!1}).range(d,d+l-1);s&&(p=p.eq("event_category",s));const{data:u,error:g}=await p;if(g)throw g;return u},async getByAccount(n,r,s=20){const{data:l,error:d}=await j.from("activity_log").select(`
        *,
        automation:automations(id, name),
        email_log:email_logs(id, subject)
      `).eq("owner_id",n).eq("account_id",r).order("created_at",{ascending:!1}).limit(s);if(d)throw d;return l},async getByAutomation(n,r,s=50){const{data:l,error:d}=await j.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("owner_id",n).eq("automation_id",r).order("created_at",{ascending:!1}).limit(s);if(d)throw d;return l},async getByType(n,r,s={}){const{limit:l=50,offset:d=0}=s,{data:p,error:u}=await j.from("activity_log").select(`
        *,
        account:accounts(account_unique_id, name)
      `).eq("owner_id",n).eq("event_type",r).order("created_at",{ascending:!1}).range(d,d+l-1);if(u)throw u;return p},async log(n,r){const{data:s,error:l}=await j.from("activity_log").insert({owner_id:n,...r}).select().single();if(l)throw l;return s},async logEmailSent(n,r,s,l=null){return this.log(n,{event_type:"email_sent",event_category:"email",title:"Email sent",email_log_id:r,account_id:s,automation_id:l,actor_type:l?"automation":"user"})},async logEmailOpened(n,r,s){return this.log(n,{event_type:"email_opened",event_category:"email",title:"Email opened",email_log_id:r,account_id:s,actor_type:"system"})},async logEmailClicked(n,r,s,l=null){return this.log(n,{event_type:"email_clicked",event_category:"email",title:"Email link clicked",email_log_id:r,account_id:s,actor_type:"system",event_data:l?{url:l}:{}})},async logEnrollment(n,r,s,l){return this.log(n,{event_type:"enrollment_created",event_category:"automation",title:`Enrolled in ${l}`,automation_id:r,account_id:s,actor_type:"automation"})},async logAutomationCompleted(n,r,s,l){return this.log(n,{event_type:"automation_completed",event_category:"automation",title:`Completed ${l}`,automation_id:r,account_id:s,actor_type:"automation"})},async logUnsubscribe(n,r,s,l=null){return this.log(n,{event_type:"unsubscribed",event_category:"account",title:s==="all"?"Unsubscribed from all emails":"Unsubscribed from automation",account_id:r,automation_id:l,actor_type:"system",severity:"warning"})},async logBounce(n,r,s,l){return this.log(n,{event_type:"email_bounced",event_category:"email",title:`Email bounced (${l})`,email_log_id:r,account_id:s,actor_type:"system",severity:"warning",event_data:{bounce_type:l}})},async getStats(n,r=7){const s=new Date;s.setDate(s.getDate()-r);const{data:l,error:d}=await j.from("activity_log").select("event_type, event_category").eq("owner_id",n).gte("created_at",s.toISOString());if(d)throw d;const p={total:l.length,byType:{},byCategory:{}};return l.forEach(u=>{p.byType[u.event_type]=(p.byType[u.event_type]||0)+1,p.byCategory[u.event_category]=(p.byCategory[u.event_category]||0)+1}),p}},_o={async getAll(n,r={}){const{status:s,automationId:l,limit:d=50,offset:p=0}=r;let u=j.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",n).order("scheduled_for",{ascending:!0}).range(p,p+d-1);s&&(u=u.eq("status",s)),l&&(u=u.eq("automation_id",l));const{data:g,error:m}=await u;if(m)throw m;return g},async getUpcoming(n,r=10){const{data:s,error:l}=await j.from("scheduled_emails").select(`
        *,
        account:accounts(account_unique_id, name, person_email),
        automation:automations(id, name)
      `).eq("owner_id",n).eq("status","Pending").gte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0}).limit(r);if(l)throw l;return s},async getReadyToSend(){const{data:n,error:r}=await j.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name, owner_id)
      `).eq("status","Pending").lte("scheduled_for",new Date().toISOString()).order("scheduled_for",{ascending:!0});if(r)throw r;return n},async getById(n,r){const{data:s,error:l}=await j.from("scheduled_emails").select(`
        *,
        account:accounts(*),
        template:email_templates(*),
        automation:automations(id, name)
      `).eq("owner_id",n).eq("id",r).single();if(l)throw l;return s},async create(n,r){const{data:s,error:l}=await j.from("scheduled_emails").insert({owner_id:n,status:"Pending",...r}).select().single();if(l)throw l;return s},async createBatch(n,r){const s=r.map(p=>({owner_id:n,status:"Pending",...p})),{data:l,error:d}=await j.from("scheduled_emails").insert(s).select();if(d)throw d;return l},async update(n,r,s){const{data:l,error:d}=await j.from("scheduled_emails").update({...s,updated_at:new Date().toISOString()}).eq("owner_id",n).eq("id",r).select().single();if(d)throw d;return l},async cancel(n,r){return this.update(n,r,{status:"Cancelled"})},async reschedule(n,r,s){return this.update(n,r,{scheduled_for:s,status:"Pending",attempts:0})},async markProcessing(n){const{data:r,error:s}=await j.from("scheduled_emails").update({status:"Processing",last_attempt_at:new Date().toISOString(),attempts:j.sql`attempts + 1`,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(s)throw s;return r},async markSent(n,r){const{data:s,error:l}=await j.from("scheduled_emails").update({status:"Sent",email_log_id:r,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(l)throw l;return s},async markFailed(n,r){const{data:s,error:l}=await j.from("scheduled_emails").select("attempts, max_attempts").eq("id",n).single();if(l)throw l;const d=s.attempts<s.max_attempts,{data:p,error:u}=await j.from("scheduled_emails").update({status:d?"Pending":"Failed",error_message:r,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(u)throw u;return p},async delete(n,r){const{error:s}=await j.from("scheduled_emails").delete().eq("owner_id",n).eq("id",r);if(s)throw s;return!0},async getStats(n){const{data:r,error:s}=await j.from("scheduled_emails").select("status, scheduled_for").eq("owner_id",n);if(s)throw s;const l=new Date,d={pending:0,processing:0,sent:0,failed:0,cancelled:0,upcomingToday:0,upcomingThisWeek:0},p=new Date(l);p.setHours(23,59,59,999);const u=new Date(l);return u.setDate(u.getDate()+7),r.forEach(g=>{if(d[g.status.toLowerCase()]++,g.status==="Pending"){const m=new Date(g.scheduled_for);m<=p&&d.upcomingToday++,m<=u&&d.upcomingThisWeek++}}),d}},Pt={async getAll(n,r={}){const{status:s,search:l,limit:d=25,offset:p=0,expiring:u=!1}=r;let g=j.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n);if(s){let W=s;s.toLowerCase()==="prior"&&(W="prior_customer"),g=g.ilike("account_status",W)}l&&(g=g.or(`name.ilike.%${l}%,person_email.ilike.%${l}%,email.ilike.%${l}%`));const{count:m,error:f}=await g;if(f)throw f;let P=j.from("accounts").select("*").eq("owner_id",n).order("name").range(p,p+d-1);if(s){let W=s;s.toLowerCase()==="prior"&&(W="prior_customer"),P=P.ilike("account_status",W)}l&&(P=P.or(`name.ilike.%${l}%,person_email.ilike.%${l}%,email.ilike.%${l}%`));const{data:v,error:I}=await P;if(I)throw I;if(!v||v.length===0)return{accounts:[],total:m||0};const T=v.map(W=>W.account_unique_id).filter(Boolean),k=new Date().toISOString().split("T")[0],R=new Date;R.setDate(R.getDate()+30);const C=R.toISOString().split("T")[0];if(T.length>0){const{data:W,error:Z}=await j.from("policies").select("account_id, policy_lob, policy_status, expiration_date").in("account_id",T);if(!Z&&W){const B={};W.forEach(z=>{var Q;B[z.account_id]||(B[z.account_id]=[]);const N=z.expiration_date&&z.expiration_date>=k&&z.expiration_date<=C;B[z.account_id].push({policy_type:z.policy_lob,status:((Q=z.policy_status)==null?void 0:Q.toLowerCase())||"unknown",expiration_date:z.expiration_date,is_expiring:N})}),v.forEach(z=>{z.policies=B[z.account_unique_id]||[],z.policy_count=z.policies.length,z.has_expiring_policy=z.policies.some(N=>N.is_expiring),z.expiring_policy_count=z.policies.filter(N=>N.is_expiring).length})}}if(u){const W=v.filter(Z=>Z.has_expiring_policy);return{accounts:W,total:W.length,isExpiringFilter:!0}}return{accounts:v,total:m||0}},async getStats(n){const{count:r,error:s}=await j.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n);if(s)throw s;const{count:l}=await j.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n).ilike("account_status","customer"),{count:d}=await j.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n).ilike("account_status","prospect"),{count:p}=await j.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n).ilike("account_status","prior_customer"),{count:u}=await j.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n).ilike("account_status","lead");let g=0;const m=new Date().toISOString().split("T")[0],f=new Date;f.setDate(f.getDate()+30);const P=f.toISOString().split("T")[0],{count:v}=await j.from("policies").select("*",{count:"exact",head:!0}).gte("expiration_date",m).lte("expiration_date",P);if(v&&v>0){const{data:I}=await j.from("policies").select("account_id").gte("expiration_date",m).lte("expiration_date",P).limit(5e3);if(I&&I.length>0){const T=[...new Set(I.map(w=>w.account_id).filter(Boolean))];if(T.length>0){let w=0;const k=100;for(let R=0;R<T.length;R+=k){const C=T.slice(R,R+k),{count:W}=await j.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n).in("account_unique_id",C);w+=W||0}g=w}}}return{Customer:l||0,Prospect:d||0,Prior:p||0,Lead:u||0,total:r||0,expiring:g}},async getById(n){const{data:r,error:s}=await j.from("accounts").select("*").eq("account_unique_id",n).single();if(s)throw s;return r},async getByIdWithPolicies(n){const{data:r,error:s}=await j.from("accounts").select("*").eq("account_unique_id",n).single();if(s)throw s;if(!r)return null;const{data:l,error:d}=await j.from("policies").select("*").eq("account_id",n).order("expiration_date",{ascending:!1});if(d)return console.error("Error fetching policies:",d),{...r,policies:[]};if(l&&l.length>0){const p=[...new Set(l.map(u=>u.carrier_id).filter(Boolean))];if(p.length>0){const{data:u,error:g}=await j.from("carriers").select("id, name").in("id",p);if(u&&u.length>0){const m={};u.forEach(f=>{m[f.id]=f.name}),l.forEach(f=>{f.carrier_id&&m[f.carrier_id]&&(f.carrier={name:m[f.carrier_id]})})}}}return{...r,policies:l||[]}},async getByIdWithEmailHistory(n,r){const s=await this.getByIdWithPolicies(r),{data:l,error:d}=await j.from("email_logs").select(`
        *,
        template:email_templates(id, name),
        automation:automations(id, name)
      `).eq("owner_id",n).eq("account_id",r).order("created_at",{ascending:!1}).limit(20);if(d)throw d;const{data:p,error:u}=await j.from("automation_enrollments").select(`
        *,
        automation:automations(id, name, category)
      `).eq("account_id",r).order("enrolled_at",{ascending:!1});if(u)throw u;return{...s,emailLogs:l,enrollments:p}},async search(n,r,s=20){const{data:l,error:d}=await j.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name").eq("owner_id",n).or(`name.ilike.%${r}%,person_email.ilike.%${r}%,email.ilike.%${r}%,primary_contact_first_name.ilike.%${r}%,primary_contact_last_name.ilike.%${r}%`).limit(s);if(d)throw d;return l},async getByStatus(n,r,s={}){const{limit:l=50,offset:d=0}=s,{data:p,error:u}=await j.from("accounts").select("*").eq("owner_id",n).eq("account_status",r).order("name").range(d,d+l-1);if(u)throw u;return p},async getCustomers(n,r={}){return this.getByStatus(n,"customer",r)},async getProspects(n,r={}){return this.getByStatus(n,"prospect",r)},async getPriorCustomers(n,r={}){return this.getByStatus(n,"prior_customer",r)},async getWithExpiringPolicies(n,r=45){const s=new Date;s.setDate(s.getDate()+r);const{data:l,error:d}=await j.from("policies").select(`
        policy_unique_id,
        policy_lob,
        expiration_date,
        policy_status,
        account_id,
        account:accounts!policies_account_id_fkey(
          account_unique_id,
          name,
          person_email,
          email,
          owner_id,
          primary_contact_first_name,
          primary_contact_last_name
        )
      `).eq("policy_status","Active").lte("expiration_date",s.toISOString().split("T")[0]).gte("expiration_date",new Date().toISOString().split("T")[0]).order("expiration_date");if(d)throw d;return l.filter(p=>{var u;return((u=p.account)==null?void 0:u.owner_id)===n})},async getCounts(n){const{data:r,error:s}=await j.from("accounts").select("account_status").eq("owner_id",n);if(s)throw s;const l={total:r.length,customer:0,prospect:0,prior_customer:0,other:0};return r.forEach(d=>{var u;const p=((u=d.account_status)==null?void 0:u.toLowerCase().replace(" ","_"))||"other";l[p]!==void 0?l[p]++:l.other++}),l},getEmail(n){return n.person_email||n.email},getDisplayName(n){return n.primary_contact_first_name?`${n.primary_contact_first_name} ${n.primary_contact_last_name||""}`.trim():n.name},canReceiveMarketing(n){return n.user_subscribed_to_marketing!==!1&&n.person_has_opted_out_of_email!==!0&&(n.person_email||n.email)},async getEligibleForAutomation(n,r){let s=j.from("accounts").select("*").eq("owner_id",n).or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false").not("person_email","is",null);const{data:l,error:d}=await s;if(d)throw d;const p=l.map(f=>f.account_unique_id),{data:u,error:g}=await j.from("policies").select("*").in("account_id",p);if(g)throw g;return l.map(f=>({...f,policies:u.filter(P=>P.account_id===f.account_unique_id)})).filter(f=>this.canReceiveMarketing(f))}},yo={async getDashboardData(n,r={}){const{days:s=30}=r,[l,d,p,u,g,m,f]=await Promise.all([Qt.getComparisonStats(n,s),go.getRecent(n,{limit:10}),_o.getUpcoming(n,5),Qt.getRecentOpens(n,5),Qt.getRecentClicks(n,5),Pt.getCounts(n),this.getAutomationStats(n)]);return{emailStats:l.current,emailChanges:l.changes,recentActivity:d,scheduledEmails:p,recentOpens:u,recentClicks:g,accountCounts:m,automationStats:f}},async getAutomationStats(n){const{data:r,error:s}=await j.from("automations").select(`
        id,
        name,
        status,
        stats
      `).eq("owner_id",n).eq("status","Active");if(s)throw s;const l=r.map(g=>g.id),{data:d,error:p}=await j.from("automation_enrollments").select("automation_id, status").in("automation_id",l);if(p)throw p;const u={};return d.forEach(g=>{u[g.automation_id]||(u[g.automation_id]={active:0,total:0}),u[g.automation_id].total++,g.status==="Active"&&u[g.automation_id].active++}),{total:r.length,active:r.filter(g=>g.status==="Active").length,automations:r.map(g=>{var m,f;return{...g,enrollmentCount:((m=u[g.id])==null?void 0:m.total)||0,activeEnrollments:((f=u[g.id])==null?void 0:f.active)||0}})}},async getEmailPerformanceOverTime(n,r=30){const s=new Date;s.setDate(s.getDate()-r);const{data:l,error:d}=await j.from("email_stats_daily").select("*").eq("owner_id",n).is("automation_id",null).gte("stat_date",s.toISOString().split("T")[0]).order("stat_date");if(d)throw d;return l},async getTopAutomations(n,r=5){const{data:s,error:l}=await j.from("automations").select("id, name, stats").eq("owner_id",n).eq("status","Active");if(l)throw l;return s.map(p=>{var u,g,m,f,P;return{...p,sent:((u=p.stats)==null?void 0:u.sent)||0,opened:((g=p.stats)==null?void 0:g.opened)||0,clicked:((m=p.stats)==null?void 0:m.clicked)||0,openRate:((f=p.stats)==null?void 0:f.sent)>0?(((P=p.stats)==null?void 0:P.opened)||0)/p.stats.sent*100:0}}).sort((p,u)=>u.openRate-p.openRate).slice(0,r)},async getAccountsNeedingAttention(n){const{data:r,error:s}=await j.from("email_logs").select(`
        account:accounts(account_unique_id, name, person_email)
      `).eq("owner_id",n).eq("status","Bounced").not("account_id","is",null).limit(10);if(s)throw s;const l=await Pt.getWithExpiringPolicies(n,30);return{bouncedEmails:r.map(d=>d.account).filter((d,p,u)=>u.findIndex(g=>g.account_unique_id===d.account_unique_id)===p),expiringPolicies:l.slice(0,10)}},async getQuickStats(n){const r=new Date().toISOString().split("T")[0],s=new Date;s.setDate(s.getDate()-30);const[{count:l},{count:d},{count:p},{count:u}]=await Promise.all([j.from("email_logs").select("*",{count:"exact",head:!0}).eq("owner_id",n).gte("sent_at",r),j.from("email_logs").select("*",{count:"exact",head:!0}).eq("owner_id",n).gte("first_opened_at",r),j.from("automations").select("*",{count:"exact",head:!0}).eq("owner_id",n).eq("status","Active"),j.from("scheduled_emails").select("*",{count:"exact",head:!0}).eq("owner_id",n).eq("status","Pending")]);return{emailsToday:l||0,opensToday:d||0,activeAutomations:p||0,pendingScheduled:u||0}}},vo=()=>{const{userId:n}=_e();return n};function bo(){const n=vo();return ve({queryKey:["dashboard",n,"quick"],queryFn:()=>yo.getQuickStats(n),enabled:!!n,staleTime:1e4,refetchInterval:3e4})}function bs(n=30){const r=vo();return ve({queryKey:["dashboard",r,"performance",n],queryFn:()=>yo.getEmailPerformanceOverTime(r,n),enabled:!!r})}const dt={async get(n){const{data:r,error:s}=await j.from("user_settings").select("*").eq("user_id",n).single();if(s&&s.code!=="PGRST116")throw s;return r},async getWithUser(n){const{data:r,error:s}=await j.from("user_settings").select(`
        *,
        user:users(user_unique_id, email, first_name, last_name, role_name, profile_name)
      `).eq("user_id",n).single();if(s&&s.code!=="PGRST116")throw s;return r},async create(n,r={}){const{data:s,error:l}=await j.from("user_settings").insert({user_id:n,...r}).select().single();if(l)throw l;return s},async update(n,r){const{data:s,error:l}=await j.from("user_settings").update({...r,updated_at:new Date().toISOString()}).eq("user_id",n).select().single();if(l)throw l;return s},async updateSignature(n,r){const{signatureName:s,signatureTitle:l,signaturePhone:d,signatureEmail:p,signatureMessage:u}=r;return this.update(n,{signature_name:s,signature_title:l,signature_phone:d,signature_email:p,signature_message:u})},async updateAgencyInfo(n,r){const{agencyName:s,agencyAddress:l,agencyPhone:d,agencyWebsite:p}=r;return this.update(n,{agency_name:s,agency_address:l,agency_phone:d,agency_website:p})},async updateEmailSettings(n,r){const{fromName:s,fromEmail:l,replyToEmail:d,defaultSendTime:p,timezone:u,dailySendLimit:g}=r;return this.update(n,{from_name:s,from_email:l,reply_to_email:d,default_send_time:p,timezone:u,daily_send_limit:g})},async updatePreferences(n,r){const s=await this.get(n);return this.update(n,{preferences:{...s==null?void 0:s.preferences,...r}})},async getSignatureHtml(n){const r=await this.get(n);if(!r)return"";const{signature_name:s,signature_title:l,signature_phone:d,signature_email:p,signature_message:u}=r;let g='<table style="margin-top: 20px; font-family: Arial, sans-serif;">';return g+="<tr><td>",s&&(g+=`<strong style="font-size: 14px;">${s}</strong><br>`),l&&(g+=`<span style="color: #666;">${l}</span><br>`),d&&(g+=`<span>${d}</span><br>`),p&&(g+=`<a href="mailto:${p}" style="color: #0066cc;">${p}</a><br>`),u&&(g+=`<p style="margin-top: 10px; font-style: italic; color: #666;">${u}</p>`),g+="</td></tr></table>",g},async getUnsubscribeFooterHtml(n,r,s=null){const l=await this.get(n),d="https://your-app.com",p=`${d}/unsubscribe?type=automation&id=${r}&aid=${s}`,u=`${d}/unsubscribe?type=all&id=${r}`;let g=`
      <table style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; width: 100%; font-family: Arial, sans-serif;">
        <tr>
          <td style="text-align: center; font-size: 12px; color: #666;">
    `;return s&&(g+=`<a href="${p}" style="color: #666;">Unsubscribe from these emails</a> &nbsp;|&nbsp; `),g+=`<a href="${u}" style="color: #666;">Unsubscribe from all emails</a>`,(l!=null&&l.agency_name||l!=null&&l.agency_address)&&(g+="<br><br>",l.agency_name&&(g+=l.agency_name),l.agency_address&&(g+=` | ${l.agency_address}`)),g+=`
          </td>
        </tr>
      </table>
    `,g}},wo=()=>{const{userId:n}=_e();return n};function ws(){const n=wo();return ve({queryKey:["userSettings",n],queryFn:()=>dt.get(n),enabled:!!n})}function Ss(){const n=wo(),r=ei(),s=()=>{r.invalidateQueries({queryKey:["userSettings",n]})},l=ce({mutationFn:m=>dt.update(n,m),onSuccess:s}),d=ce({mutationFn:m=>dt.updateSignature(n,m),onSuccess:s}),p=ce({mutationFn:m=>dt.updateAgencyInfo(n,m),onSuccess:s}),u=ce({mutationFn:m=>dt.updateEmailSettings(n,m),onSuccess:s}),g=ce({mutationFn:m=>dt.updatePreferences(n,m),onSuccess:s});return{updateSettings:l,updateSignature:d,updateAgencyInfo:p,updateEmailSettings:u,updatePreferences:g}}const So=()=>{const{userId:n}=_e();return n};function js(n={}){const r=So();return ve({queryKey:["accounts",r,n],queryFn:()=>Pt.getAll(r,n),enabled:!!r,staleTime:3e4})}function Cs(n){return ve({queryKey:["account",n,"policies"],queryFn:()=>Pt.getByIdWithPolicies(n),enabled:!!n,staleTime:3e4})}function ks(){const n=So();return ve({queryKey:["accounts",n,"stats"],queryFn:()=>Pt.getStats(n),enabled:!!n})}const zs=()=>{const{userId:n}=_e();return n};function Ts(n,r=20){const s=zs();return ve({queryKey:["activity",s,"account",n],queryFn:()=>go.getByAccount(s,n,r),enabled:!!s&&!!n,staleTime:3e4})}const Ps=()=>{const{userId:n}=_e();return n};function Ls(n=10){const r=Ps();return ve({queryKey:["scheduledEmails",r,"upcoming",n],queryFn:()=>_o.getUpcoming(r,n),enabled:!!r})}const Rs=(n,r,s,l)=>{const p=(s-n)*Math.PI/180,u=(l-r)*Math.PI/180,g=Math.sin(p/2)*Math.sin(p/2)+Math.cos(n*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2);return 3959*(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)))},Tt={},Ms=n=>new Promise(r=>setTimeout(r,n)),Is=async(n,r=!1)=>{if(Tt[n])return Tt[n];try{r||await Ms(100);const l=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&q=${encodeURIComponent(n)}&limit=1`,{headers:{"User-Agent":"ISGMarketing/1.0"}})).json();if(l&&l.length>0){const d={lat:parseFloat(l[0].lat),lng:parseFloat(l[0].lon)};return Tt[n]=d,d}}catch(s){console.error("Geocoding error:",s)}return null},As=async n=>{const r={},s=[...new Set(n.filter(Boolean))];for(const l of s)if(Tt[l])r[l]=Tt[l];else{const d=await Is(l,!1);d&&(r[l]=d)}return r},He={async getAll(n,r={}){const{status:s,limit:l=50,offset:d=0}=r;let p=j.from("mass_email_batches").select(`
        *,
        template:email_templates(id, name, subject)
      `).eq("owner_id",n).order("created_at",{ascending:!1}).range(d,d+l-1);s&&(p=p.eq("status",s));const{data:u,error:g}=await p;if(g)throw g;return u},async getById(n,r){const{data:s,error:l}=await j.from("mass_email_batches").select(`
        *,
        template:email_templates(*)
      `).eq("owner_id",n).eq("id",r).single();if(l)throw l;return s},async create(n,r){const{data:s,error:l}=await j.from("mass_email_batches").insert({owner_id:n,status:"Draft",...r}).select().single();if(l)throw l;return s},async update(n,r,s){const{data:l,error:d}=await j.from("mass_email_batches").update({...s,updated_at:new Date().toISOString()}).eq("owner_id",n).eq("id",r).select().single();if(d)throw d;return l},async delete(n,r){const{error:s}=await j.from("mass_email_batches").delete().eq("owner_id",n).eq("id",r).eq("status","Draft");if(s)throw s;return!0},async getRecipients(n,r,s={}){const{limit:l=100,offset:d=0}=s,{rules:p=[],notOptedOut:u=!0,search:g=""}=r||{},m=p.filter(B=>B.field==="account_status"&&B.value),f=p.filter(B=>B.field==="policy_type"&&B.value),P=p.filter(B=>B.field==="policy_count"&&B.value),v=p.filter(B=>B.field==="policy_expiration"&&B.value),I=p.filter(B=>B.field==="location"&&B.value),T=p.filter(B=>B.field==="state"&&B.value),w=p.filter(B=>B.field==="city"&&B.value);let k=j.from("accounts").select("account_unique_id, name, person_email, email, account_status, primary_contact_first_name, primary_contact_last_name, person_has_opted_out_of_email, billing_city, billing_state, billing_postal_code, billing_street").eq("owner_id",n);if(m.length>0){const B=m[0];if(B.operator==="is")k=k.eq("account_status",B.value);else if(B.operator==="is_not")k=k.neq("account_status",B.value);else if(B.operator==="is_any"){const z=B.value.split(",").filter(N=>N);z.length>0&&(k=k.in("account_status",z))}}u&&(k=k.or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false")),g&&(k=k.or(`name.ilike.%${g}%,person_email.ilike.%${g}%,email.ilike.%${g}%`)),k=k.order("name").range(d,d+l-1);const{data:R,error:C}=await k;if(C)throw C;let W=R.filter(B=>{const z=B.person_email||B.email;return z&&z.includes("@")});if((f.length>0||P.length>0||v.length>0)&&W.length>0){const B=W.map(K=>K.account_unique_id),{data:z,error:N}=await j.from("policies").select("account_id, policy_lob, expiration_date, policy_status").in("account_id",B);if(N)throw N;const Q={};z.forEach(K=>{Q[K.account_id]||(Q[K.account_id]=[]),Q[K.account_id].push(K)}),W=W.filter(K=>{const se=Q[K.account_unique_id]||[];for(const _ of P){const S=se.length,E=parseInt(_.value,10);if(_.operator==="equals"&&S!==E||_.operator==="greater_than"&&S<=E||_.operator==="less_than"&&S>=E||_.operator==="at_least"&&S<E)return!1}for(const _ of f){const S=_.operator==="is_any"?_.value.split(","):[_.value],E=se.some(M=>S.some($=>{var U;return(U=M.policy_lob)==null?void 0:U.toLowerCase().includes($.toLowerCase())}));if(_.operator==="is"&&!E||_.operator==="is_any"&&!E||_.operator==="is_not"&&E)return!1}const X=new Date().toISOString().split("T")[0];for(const _ of v)if(_.operator==="in_next_days"){const S=parseInt(_.value,10),E=new Date;E.setDate(E.getDate()+S);const M=E.toISOString().split("T")[0];if(!se.some(U=>U.expiration_date&&U.expiration_date>=X&&U.expiration_date<=M))return!1}else if(_.operator==="before"){if(!se.some(E=>E.expiration_date&&E.expiration_date<_.value))return!1}else if(_.operator==="after"){if(!se.some(E=>E.expiration_date&&E.expiration_date>_.value))return!1}else if(_.operator==="between"&&!se.some(E=>E.expiration_date&&E.expiration_date>=_.value&&E.expiration_date<=(_.value2||_.value)))return!1;return!0})}if(T.length>0&&W.length>0&&(W=W.filter(B=>{for(const z of T){const N=(B.billing_state||"").toUpperCase();if(z.operator==="is"){if(N!==z.value.toUpperCase())return!1}else if(z.operator==="is_not"){if(N===z.value.toUpperCase())return!1}else if(z.operator==="is_any"&&!z.value.split(",").map(K=>K.toUpperCase()).includes(N))return!1}return!0})),w.length>0&&W.length>0&&(W=W.filter(B=>{for(const z of w){const N=(B.billing_city||"").toLowerCase(),Q=(z.value||"").toLowerCase();if(z.operator==="contains"){if(!N.includes(Q))return!1}else if(z.operator==="equals"){if(N!==Q)return!1}else if(z.operator==="starts_with"&&!N.startsWith(Q))return!1}return!0})),I.length>0&&W.length>0)for(const B of I){const[z,N]=B.value.split(",").map(parseFloat),Q=parseInt(B.radius||"25",10);console.log("Location filter:",{centerLat:z,centerLng:N,radiusMiles:Q,recipientCount:W.length});const K={};W.forEach(_=>{const S=_.billing_postal_code||[_.billing_city,_.billing_state].filter(Boolean).join(", ");S&&(K[_.account_unique_id]=S)});const se=[...new Set(Object.values(K))];console.log("Unique locations to geocode:",se.length);const X=await As(se);console.log("Geocode results:",Object.keys(X).length),W=W.filter(_=>{const S=K[_.account_unique_id];if(!S)return console.log("No location for account:",_.account_unique_id),!1;const E=X[S];if(!E)return console.log("No geocode result for:",S),!1;const M=Rs(z,N,E.lat,E.lng),$=M<=Q;return $&&console.log("Account in radius:",_.name,M.toFixed(1),"miles"),$}),console.log("Recipients after location filter:",W.length)}return W},async countRecipients(n,r){const{rules:s=[],notOptedOut:l=!0,search:d=""}=r||{},p=s.filter(R=>R.field==="policy_type"&&R.value),u=s.filter(R=>R.field==="policy_count"&&R.value),g=s.filter(R=>R.field==="policy_expiration"&&R.value),m=s.filter(R=>R.field==="location"&&R.value),f=s.filter(R=>R.field==="city"&&R.value);if(p.length>0||u.length>0||g.length>0||m.length>0||f.length>0)return(await this.getRecipients(n,r,{limit:1e4})).length;let v=j.from("accounts").select("*",{count:"exact",head:!0}).eq("owner_id",n);const I=s.filter(R=>R.field==="account_status"&&R.value);if(I.length>0){const R=I[0];if(R.operator==="is")v=v.eq("account_status",R.value);else if(R.operator==="is_not")v=v.neq("account_status",R.value);else if(R.operator==="is_any"){const C=R.value.split(",").filter(W=>W);C.length>0&&(v=v.in("account_status",C))}}const T=s.filter(R=>R.field==="state"&&R.value);if(T.length>0){const R=T[0];if(R.operator==="is")v=v.ilike("billing_state",R.value);else if(R.operator==="is_not")v=v.not("billing_state","ilike",R.value);else if(R.operator==="is_any"){const C=R.value.split(",").filter(W=>W);C.length>0&&(v=v.in("billing_state",C))}}l&&(v=v.or("person_has_opted_out_of_email.is.null,person_has_opted_out_of_email.eq.false")),d&&(v=v.or(`name.ilike.%${d}%,person_email.ilike.%${d}%,email.ilike.%${d}%`));const{count:w,error:k}=await v;if(k)throw k;return w||0},async scheduleBatch(n,r,s=null){const l=await this.getById(n,r);if(!l)throw new Error("Batch not found");if(l.status!=="Draft")throw new Error("Can only schedule draft batches");const d=await this.getRecipients(n,l.filter_config,{limit:1e4});if(d.length===0)throw new Error("No recipients match the filter");const p=s||new Date().toISOString(),u=d.map(f=>({owner_id:n,account_id:f.account_unique_id,template_id:l.template_id,recipient_email:f.person_email||f.email,recipient_name:f.primary_contact_first_name?`${f.primary_contact_first_name} ${f.primary_contact_last_name||""}`.trim():f.name,subject:l.subject,scheduled_for:p,status:"Pending",batch_id:r})),g=100;let m=0;for(let f=0;f<u.length;f+=g){const P=u.slice(f,f+g),{data:v,error:I}=await j.from("scheduled_emails").insert(P).select();if(I)throw I;m+=v.length}return await this.update(n,r,{status:s?"Scheduled":"Sending",total_recipients:d.length,scheduled_for:p,started_at:s?null:new Date().toISOString()}),{scheduled:m,total:d.length,scheduledFor:p}},async cancelBatch(n,r){await this.update(n,r,{status:"Cancelled"});const{error:s}=await j.from("scheduled_emails").update({status:"Cancelled"}).eq("owner_id",n).eq("batch_id",r).eq("status","Pending");if(s)throw s;return!0},async getBatchStats(n,r){const{data:s,error:l}=await j.from("scheduled_emails").select("status").eq("owner_id",n).eq("batch_id",r);if(l)throw l;const d={pending:0,sent:0,failed:0,cancelled:0,total:s.length};return s.forEach(p=>{const u=p.status.toLowerCase();d[u]!==void 0&&d[u]++}),d},async getAllWithStats(n,r={}){const s=await this.getAll(n,r);return await Promise.all(s.map(async d=>{if(d.status==="Draft")return{...d,stats:null};const p=await this.getBatchStats(n,d.id);return{...d,stats:p}}))}},ti=()=>{const{userId:n}=_e();return n};function Es(n={}){const r=ti();return ve({queryKey:["massEmails",r,"withStats",n],queryFn:()=>He.getAllWithStats(r,n),enabled:!!r})}function Bs(n,r={}){const s=ti();return ve({queryKey:["massEmailRecipients",s,n,r],queryFn:()=>He.getRecipients(s,n,r),enabled:!!s&&!!n})}function Os(n){const r=ti();return ve({queryKey:["massEmailRecipientCount",r,n],queryFn:()=>He.countRecipients(r,n),enabled:!!r&&!!n})}function Ds(){const n=ti(),r=ei(),s=()=>{r.invalidateQueries({queryKey:["massEmails",n]})},l=ce({mutationFn:m=>He.create(n,m),onSuccess:s}),d=ce({mutationFn:({batchId:m,updates:f})=>He.update(n,m,f),onSuccess:s}),p=ce({mutationFn:m=>He.delete(n,m),onSuccess:s}),u=ce({mutationFn:({batchId:m,scheduledFor:f})=>He.scheduleBatch(n,m,f),onSuccess:()=>{s(),r.invalidateQueries({queryKey:["scheduledEmails",n]})}}),g=ce({mutationFn:m=>He.cancelBatch(n,m),onSuccess:()=>{s(),r.invalidateQueries({queryKey:["scheduledEmails",n]})}});return{createBatch:l,updateBatch:d,deleteBatch:p,scheduleBatch:u,cancelBatch:g}}const Qe=({width:n="100%",height:r="20px"})=>i.jsx("div",{style:{width:n,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite"}}),Yt=({label:n,value:r,change:s,icon:l,positive:d,isLoading:p,theme:u})=>i.jsxs("div",{style:{padding:"20px",backgroundColor:u.bgCard,borderRadius:"12px",border:`1px solid ${u.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[i.jsx("span",{style:{color:u.textSecondary,fontSize:"13px"},children:n}),i.jsx("span",{style:{fontSize:"20px"},children:l})]}),p?i.jsx(Qe,{height:"32px",width:"80px"}):i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:u.text,marginBottom:"4px"},children:r}),s&&i.jsx("span",{style:{fontSize:"12px",color:d?u.success:u.danger},children:s})]})]}),Ws=({email:n,theme:r,userId:s})=>{var l,d,p;return i.jsx("div",{style:{padding:"14px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`},children:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[i.jsxs("div",{children:[i.jsxs("div",{style:{fontSize:"11px",color:r.textMuted,marginBottom:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{children:""})," ",new Date(n.scheduled_for).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]}),i.jsx(Xe,{to:`/${s}/clients/${n.account_id}`,style:{fontSize:"14px",fontWeight:"600",color:r.text,textDecoration:"none"},children:((l=n.accounts)==null?void 0:l.name)||"Unknown Account"}),i.jsx("div",{style:{fontSize:"12px",color:r.textSecondary,marginTop:"2px"},children:((d=n.email_templates)==null?void 0:d.subject)||"No subject"}),i.jsx("span",{style:{display:"inline-block",marginTop:"6px",padding:"3px 8px",backgroundColor:r.bgHover,borderRadius:"4px",fontSize:"11px",color:r.textSecondary},children:((p=n.email_templates)==null?void 0:p.name)||"Unknown Template"})]}),i.jsxs("div",{style:{display:"flex",gap:"6px"},children:[i.jsx("button",{style:{padding:"6px 10px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.textSecondary,cursor:"pointer",fontSize:"12px"},children:""}),i.jsx("button",{style:{padding:"6px 10px",backgroundColor:r.bgHover,border:`1px solid ${r.border}`,borderRadius:"6px",color:r.textSecondary,cursor:"pointer",fontSize:"12px"},children:""})]})]})})},qs=({label:n,you:r,avg:s,theme:l})=>i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[i.jsx("span",{style:{fontSize:"12px",color:l.textSecondary},children:n}),i.jsxs("span",{style:{fontSize:"12px",color:l.textMuted},children:[r,"% vs ",s,"%"]})]}),i.jsxs("div",{style:{display:"flex",gap:"4px",height:"24px"},children:[i.jsx("div",{style:{width:`${Math.min(r,100)}%`,backgroundColor:l.primary,borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:i.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[r,"%"]})}),i.jsx("div",{style:{width:`${Math.min(s,100)}%`,backgroundColor:"#14b8a6",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:"6px",minWidth:"30px"},children:i.jsxs("span",{style:{fontSize:"10px",color:"#fff",fontWeight:"600"},children:[s,"%"]})})]})]}),ao=({t:n})=>{const{userId:r}=_e(),{data:s,isLoading:l,error:d}=bo(),{data:p,isLoading:u}=Ls(7),{data:g,isLoading:m}=bs(30),f=[{label:"Open Rate",you:(s==null?void 0:s.openRate)||0,avg:32},{label:"Click Rate",you:(s==null?void 0:s.clickRate)||0,avg:8},{label:"Response Rate",you:(s==null?void 0:s.responseRate)||8,avg:5}],P=I=>I>=1e3?`${(I/1e3).toFixed(1)}k`:(I==null?void 0:I.toLocaleString())||"0",v=I=>`${Math.round(I||0)}%`;return i.jsxs("div",{children:[i.jsxs("div",{style:{marginBottom:"24px"},children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Dashboard"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px",margin:0},children:"Overview of your email campaigns and performance"})]}),d&&i.jsx("div",{style:{padding:"16px",backgroundColor:`${n.danger}15`,border:`1px solid ${n.danger}30`,borderRadius:"8px",marginBottom:"24px",color:n.danger,fontSize:"14px"},children:"Failed to load dashboard data. Please try refreshing the page."}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"24px"},children:[i.jsx(Yt,{label:"Emails Sent",value:P(s==null?void 0:s.emailsSent),change:s!=null&&s.emailsSentChange?`${s.emailsSentChange>0?"+":""}${s.emailsSentChange}%`:null,icon:"",positive:(s==null?void 0:s.emailsSentChange)>0,isLoading:l,theme:n}),i.jsx(Yt,{label:"Open Rate",value:v(s==null?void 0:s.openRate),change:s!=null&&s.openRateChange?`${s.openRateChange>0?"+":""}${s.openRateChange}%`:null,icon:"",positive:(s==null?void 0:s.openRateChange)>0,isLoading:l,theme:n}),i.jsx(Yt,{label:"Click Rate",value:v(s==null?void 0:s.clickRate),change:s!=null&&s.clickRateChange?`${s.clickRateChange>0?"+":""}${s.clickRateChange}%`:null,icon:"",positive:(s==null?void 0:s.clickRateChange)>0,isLoading:l,theme:n}),i.jsx(Yt,{label:"Scheduled",value:P(s==null?void 0:s.scheduledCount),change:null,icon:"",positive:null,isLoading:l,theme:n})]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Upcoming Scheduled Emails"}),i.jsx(Xe,{to:`/${r}/scheduled`,style:{fontSize:"12px",color:n.primary,textDecoration:"none"},children:"View all "})]}),i.jsx("p",{style:{fontSize:"12px",color:n.textSecondary,marginBottom:"16px"},children:"Emails scheduled to be sent in the next 7 days"}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:u?Array.from({length:3}).map((I,T)=>i.jsxs("div",{style:{padding:"14px",backgroundColor:n.bg,borderRadius:"8px",border:`1px solid ${n.border}`},children:[i.jsx(Qe,{height:"12px",width:"120px"}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(Qe,{height:"16px",width:"180px"})}),i.jsx("div",{style:{marginTop:"4px"},children:i.jsx(Qe,{height:"12px",width:"220px"})})]},T)):(p==null?void 0:p.length)>0?p.slice(0,5).map(I=>i.jsx(Ws,{email:I,theme:n,userId:r},I.id)):i.jsxs("div",{style:{padding:"40px 20px",textAlign:"center",color:n.textMuted,fontSize:"14px"},children:[i.jsx("div",{style:{fontSize:"32px",marginBottom:"8px"},children:""}),"No scheduled emails in the next 7 days"]})})]}),i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"4px"},children:"Performance Comparison"}),i.jsx("p",{style:{fontSize:"12px",color:n.textSecondary,marginBottom:"16px"},children:"Your metrics compared to industry averages"}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:l?Array.from({length:3}).map((I,T)=>i.jsxs("div",{children:[i.jsx(Qe,{height:"12px",width:"100px"}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(Qe,{height:"24px"})})]},T)):f.map((I,T)=>i.jsx(qs,{label:I.label,you:I.you,avg:I.avg,theme:n},T))}),i.jsxs("div",{style:{display:"flex",gap:"16px",marginTop:"16px",justifyContent:"center"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:n.primary,borderRadius:"2px"}}),i.jsx("span",{style:{fontSize:"11px",color:n.textSecondary},children:"You"})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:"#14b8a6",borderRadius:"2px"}}),i.jsx("span",{style:{fontSize:"11px",color:n.textSecondary},children:"Industry Avg"})]})]})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Recent Email Activity"}),i.jsx(Xe,{to:`/${r}/activity`,style:{fontSize:"12px",color:n.primary,textDecoration:"none"},children:"View all "})]}),m?i.jsx(Qe,{height:"200px"}):(g==null?void 0:g.length)>0?i.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"4px",height:"200px",padding:"20px 0"},children:g.slice(-14).map((I,T)=>{const w=Math.max(...g.map(R=>R.sent||0),1),k=(I.sent||0)/w*150;return i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[i.jsx("div",{style:{width:"100%",height:`${k}px`,backgroundColor:n.primary,borderRadius:"4px 4px 0 0",minHeight:"4px"},title:`${I.sent||0} sent on ${I.date}`}),i.jsx("span",{style:{fontSize:"9px",color:n.textMuted},children:new Date(I.date).toLocaleDateString("en-US",{weekday:"short"}).charAt(0)})]},T)})}):i.jsx("div",{style:{padding:"40px 20px",textAlign:"center",color:n.textMuted,fontSize:"14px"},children:"No email activity data yet"})]})]})},Bi=({width:n="100%",height:r="20px"})=>i.jsx("div",{style:{width:n,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Ns=[{id:"welcome",name:"Welcome Series",desc:"Send a series of welcome emails to new clients over their first 30 days",icon:"",category:"Onboarding",defaultNodes:[{type:"trigger",config:{frequency:"daily",time:"09:00"}},{type:"send_email",config:{templateKey:"welcome_email"}},{type:"delay",config:{days:3}},{type:"send_email",config:{templateKey:"getting_started"}}]},{id:"renewal",name:"Renewal Reminder",desc:"Automated reminders for upcoming policy renewals with customizable timing",icon:"",category:"Retention",defaultNodes:[{type:"trigger",config:{frequency:"daily",time:"09:00"}},{type:"send_email",config:{templateKey:"renewal_30_day"}},{type:"delay",config:{days:14}},{type:"condition",config:{type:"email_opened"}}]},{id:"engagement",name:"Engagement Campaign",desc:"Re-engage inactive clients with targeted email sequences",icon:"",category:"Engagement",defaultNodes:[{type:"trigger",config:{frequency:"weekly",time:"10:00"}},{type:"send_email",config:{templateKey:"reengagement"}}]},{id:"policy_update",name:"Policy Update Alert",desc:"Notify clients about important policy changes and updates",icon:"",category:"Communication",defaultNodes:[{type:"trigger",config:{frequency:"immediate"}},{type:"send_email",config:{templateKey:"policy_update"}}]}],Zs=({template:n,onUse:r,theme:s})=>i.jsxs("div",{style:{padding:"20px",backgroundColor:s.bgCard,borderRadius:"12px",border:`1px solid ${s.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:s.bgHover,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:n.icon}),i.jsx("span",{style:{padding:"4px 10px",backgroundColor:s.bgHover,borderRadius:"20px",fontSize:"11px",color:s.textSecondary},children:n.category})]}),i.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:s.text,marginBottom:"6px"},children:n.name}),i.jsx("p",{style:{fontSize:"13px",color:s.textSecondary,marginBottom:"16px",lineHeight:"1.5"},children:n.desc}),i.jsx("button",{onClick:()=>r(n),style:{width:"100%",padding:"10px",backgroundColor:s.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Use Template"})]}),Fs=({automation:n,onEdit:r,onToggle:s,theme:l})=>{var u;const d=n.stats||{},p=n.status==="active";return i.jsxs("tr",{style:{borderTop:`1px solid ${l.border}`},children:[i.jsx("td",{style:{padding:"14px 16px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:l.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px"},children:""}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:l.text},children:n.name}),n.description&&i.jsx("div",{style:{fontSize:"12px",color:l.textMuted},children:n.description})]})]})}),i.jsx("td",{style:{padding:"14px 16px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx("button",{onClick:()=>s(n.id,p?"pause":"activate"),style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:p?l.success:l.bgHover,cursor:"pointer",position:"relative",transition:"background-color 0.2s",flexShrink:0},children:i.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:p?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})}),i.jsx("span",{style:{fontSize:"12px",color:p?l.success:l.textMuted,fontWeight:"500"},children:p?"Active":n.status==="draft"?"Draft":"Paused"})]})}),i.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:l.textSecondary},children:((u=d.totalSent)==null?void 0:u.toLocaleString())||0}),i.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:l.textSecondary},children:d.openRate?`${Math.round(d.openRate)}%`:""}),i.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:l.textSecondary},children:d.clickRate?`${Math.round(d.clickRate)}%`:""}),i.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:l.textSecondary},children:d.activeEnrollments||0}),i.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:i.jsx("button",{onClick:()=>r(n.id),style:{padding:"6px 12px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"6px",color:l.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Edit"})})]})},$s=({t:n})=>{const{userId:r}=_e(),s=ut(),[l,d]=O.useState("my"),{data:p,isLoading:u,error:g}=xs(),{activateAutomation:m,pauseAutomation:f}=mo(),P=()=>{s(`/${r}/automations/new`)},v=async C=>{s(`/${r}/automations/new`,{state:{templateId:C.id,templateName:C.name,defaultNodes:C.defaultNodes}})},I=C=>{s(`/${r}/automations/${C}`)},T=async(C,W)=>{try{W==="activate"?await m.mutateAsync(C):await f.mutateAsync(C)}catch(Z){console.error(`Failed to ${W} automation:`,Z)}},w=(p==null?void 0:p.filter(C=>C.status==="active"))||[],k=(p==null?void 0:p.filter(C=>C.status==="paused"))||[],R=(p==null?void 0:p.filter(C=>C.status==="draft"))||[];return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Automations"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px",margin:0},children:"Create and manage automated email workflows"})]}),i.jsxs("button",{onClick:P,style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:"+"})," Create Custom"]})]}),g&&i.jsx("div",{style:{padding:"16px",backgroundColor:`${n.danger}15`,border:`1px solid ${n.danger}30`,borderRadius:"8px",marginBottom:"24px",color:n.danger,fontSize:"14px"},children:"Failed to load automations. Please try refreshing the page."}),!u&&p&&i.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"24px",padding:"16px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsxs("div",{style:{textAlign:"center",flex:1},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.success},children:w.length}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary},children:"Active"})]}),i.jsx("div",{style:{width:"1px",backgroundColor:n.border}}),i.jsxs("div",{style:{textAlign:"center",flex:1},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.warning},children:k.length}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary},children:"Paused"})]}),i.jsx("div",{style:{width:"1px",backgroundColor:n.border}}),i.jsxs("div",{style:{textAlign:"center",flex:1},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.textMuted},children:R.length}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary},children:"Drafts"})]}),i.jsx("div",{style:{width:"1px",backgroundColor:n.border}}),i.jsxs("div",{style:{textAlign:"center",flex:1},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.primary},children:p.reduce((C,W)=>{var Z;return C+(((Z=W.stats)==null?void 0:Z.totalSent)||0)},0).toLocaleString()}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary},children:"Total Sent"})]})]}),i.jsxs("div",{style:{display:"flex",gap:"0",marginBottom:"24px",backgroundColor:n.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:[i.jsxs("button",{onClick:()=>d("my"),style:{padding:"10px 20px",backgroundColor:l==="my"?n.bgCard:"transparent",border:"none",borderRadius:"8px",color:l==="my"?n.text:n.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:l==="my"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:["My Automations ",p&&`(${p.length})`]}),i.jsx("button",{onClick:()=>d("templates"),style:{padding:"10px 20px",backgroundColor:l==="templates"?n.bgCard:"transparent",border:"none",borderRadius:"8px",color:l==="templates"?n.text:n.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",boxShadow:l==="templates"?"0 1px 3px rgba(0,0,0,0.1)":"none"},children:"Templates"})]}),l==="templates"&&i.jsxs(i.Fragment,{children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Pre-built Templates"}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:Ns.map(C=>i.jsx(Zs,{template:C,onUse:v,theme:n},C.id))})]}),l==="my"&&i.jsx(i.Fragment,{children:u?i.jsx("div",{style:{backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,padding:"20px"},children:Array.from({length:3}).map((C,W)=>i.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:W>0?`1px solid ${n.border}`:"none"},children:[i.jsx(Bi,{width:"36px",height:"36px"}),i.jsxs("div",{style:{flex:1},children:[i.jsx(Bi,{width:"200px",height:"16px"}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(Bi,{width:"120px",height:"12px"})})]})]},W))}):(p==null?void 0:p.length)>0?i.jsx("div",{style:{backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,overflow:"hidden"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{backgroundColor:n.bgHover},children:[i.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Automation"}),i.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Status"}),i.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Sent"}),i.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Open Rate"}),i.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Click Rate"}),i.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Enrolled"}),i.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Actions"})]})}),i.jsx("tbody",{children:p.map(C=>i.jsx(Fs,{automation:C,onEdit:I,onToggle:T,theme:n},C.id))})]})}):i.jsxs("div",{style:{padding:"60px 20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"8px"},children:"No automations yet"}),i.jsx("p",{style:{fontSize:"14px",color:n.textSecondary,marginBottom:"24px"},children:"Create your first automation to start sending targeted emails automatically."}),i.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[i.jsx("button",{onClick:()=>d("templates"),style:{padding:"10px 20px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,cursor:"pointer",fontSize:"14px"},children:"Browse Templates"}),i.jsx("button",{onClick:P,style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Custom"})]})]})})]})},Jt=({width:n="100%",height:r="20px"})=>i.jsx("div",{style:{width:n,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Hs=({template:n,onSave:r,onClose:s,theme:l})=>{const[d,p]=O.useState((n==null?void 0:n.name)||""),[u,g]=O.useState((n==null?void 0:n.subject)||""),[m,f]=O.useState((n==null?void 0:n.body_html)||(n==null?void 0:n.body_text)||""),[P,v]=O.useState((n==null?void 0:n.category)||"general"),[I,T]=O.useState(!1),w=async()=>{T(!0);try{await r({name:d,subject:u,body_html:m,body_text:m.replace(/<[^>]*>/g,""),category:P}),s()}catch(C){console.error("Failed to save template:",C)}finally{T(!1)}},k=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],R=C=>{f(m+C)};return i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:100},onClick:s}),i.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxHeight:"90vh",backgroundColor:l.bgCard,borderRadius:"16px",border:`1px solid ${l.border}`,zIndex:101,display:"flex",flexDirection:"column",overflow:"hidden"},children:[i.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${l.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:l.text,margin:0},children:n?"Edit Template":"Create Template"}),i.jsx("button",{onClick:s,style:{background:"none",border:"none",color:l.textMuted,cursor:"pointer",fontSize:"20px"},children:""})]}),i.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Template Name"}),i.jsx("input",{type:"text",value:d,onChange:C=>p(C.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Category"}),i.jsxs("select",{value:P,onChange:C=>v(C.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"},children:[i.jsx("option",{value:"general",children:"General"}),i.jsx("option",{value:"welcome",children:"Welcome"}),i.jsx("option",{value:"renewal",children:"Renewal"}),i.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),i.jsx("option",{value:"engagement",children:"Engagement"}),i.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),i.jsx("input",{type:"text",value:u,onChange:C=>g(C.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:k.map(C=>i.jsx("button",{onClick:()=>R(C.key),style:{padding:"4px 10px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"6px",color:l.textSecondary,cursor:"pointer",fontSize:"11px"},children:C.label},C.key))})]}),i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Email Body"}),i.jsx("textarea",{value:m,onChange:C=>f(C.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:12,style:{width:"100%",padding:"12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),i.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${l.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[i.jsx("button",{onClick:s,style:{padding:"10px 20px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),i.jsx("button",{onClick:w,disabled:I||!d||!u,style:{padding:"10px 20px",backgroundColor:l.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:I?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:I||!d||!u?.6:1},children:I?"Saving...":n?"Save Changes":"Create Template"})]})]})]})},Us=({template:n,onEdit:r,onDuplicate:s,onDelete:l,theme:d})=>{var m,f;const[p,u]=O.useState(!1),g={welcome:d.success,renewal:d.warning,cross_sell:d.primary,engagement:d.purple,policy_update:"#06b6d4",general:d.textMuted};return i.jsxs("div",{style:{padding:"20px",backgroundColor:d.bgCard,borderRadius:"12px",border:`1px solid ${d.border}`,position:"relative"},children:[i.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px"},children:[i.jsx("button",{onClick:()=>u(!p),style:{padding:"4px 8px",backgroundColor:"transparent",border:"none",color:d.textMuted,cursor:"pointer",fontSize:"16px"},children:""}),p&&i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,zIndex:10},onClick:()=>u(!1)}),i.jsxs("div",{style:{position:"absolute",top:"100%",right:0,backgroundColor:d.bgCard,border:`1px solid ${d.border}`,borderRadius:"8px",padding:"4px",zIndex:11,minWidth:"140px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[i.jsx("button",{onClick:()=>{r(n),u(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:d.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:" Edit"}),i.jsx("button",{onClick:()=>{s(n),u(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:d.text,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:" Duplicate"}),i.jsx("button",{onClick:()=>{l(n.id),u(!1)},style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:d.danger,cursor:"pointer",fontSize:"13px",textAlign:"left"},children:" Delete"})]})]})]}),i.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${g[n.category]||d.textMuted}15`,color:g[n.category]||d.textMuted,borderRadius:"20px",fontSize:"11px",fontWeight:"500",marginBottom:"12px",textTransform:"capitalize"},children:((m=n.category)==null?void 0:m.replace("_"," "))||"General"}),i.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:d.text,marginBottom:"6px"},children:n.name}),i.jsx("p",{style:{fontSize:"13px",color:d.textSecondary,marginBottom:"8px"},children:n.subject}),i.jsxs("p",{style:{fontSize:"12px",color:d.textMuted,marginBottom:"12px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:[(f=n.body_text)==null?void 0:f.substring(0,100),"..."]}),i.jsxs("div",{style:{display:"flex",gap:"16px",paddingTop:"12px",borderTop:`1px solid ${d.border}`,fontSize:"11px",color:d.textMuted},children:[i.jsxs("span",{children:[" ",n.usage_count||0," sent"]}),i.jsxs("span",{children:[" ",n.open_rate?`${Math.round(n.open_rate)}%`:""," opens"]})]}),i.jsx("button",{onClick:()=>r(n),style:{marginTop:"12px",width:"100%",padding:"10px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,cursor:"pointer",fontSize:"13px"},children:"Edit Template"})]})},Gs=({t:n})=>{const{userId:r}=_e(),[s,l]=O.useState("my"),[d,p]=O.useState("all"),[u,g]=O.useState(""),[m,f]=O.useState(!1),[P,v]=O.useState(null),{data:I,isLoading:T,error:w}=fo(),{data:k}=fs(),{createTemplate:R,updateTemplate:C,deleteTemplate:W,duplicateTemplate:Z}=xo(),B=(I==null?void 0:I.filter(X=>!(d!=="all"&&X.category!==d||u&&!X.name.toLowerCase().includes(u.toLowerCase())&&!X.subject.toLowerCase().includes(u.toLowerCase()))))||[],z=()=>{v(null),f(!0)},N=X=>{v(X),f(!0)},Q=async X=>{P?await C.mutateAsync({id:P.id,...X}):await R.mutateAsync(X)},K=async X=>{await Z.mutateAsync(X.id)},se=async X=>{window.confirm("Are you sure you want to delete this template?")&&await W.mutateAsync(X)};return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Email Templates"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px",margin:0},children:"Create and manage reusable email templates"})]}),i.jsxs("button",{onClick:z,style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:"+"})," Create Template"]})]}),w&&i.jsx("div",{style:{padding:"16px",backgroundColor:`${n.danger}15`,border:`1px solid ${n.danger}30`,borderRadius:"8px",marginBottom:"24px",color:n.danger,fontSize:"14px"},children:"Failed to load templates. Please try refreshing the page."}),i.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"24px",alignItems:"center"},children:[i.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"300px"},children:[i.jsx("input",{type:"text",placeholder:"Search templates...",value:u,onChange:X=>g(X.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"}}),i.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:n.textMuted},children:""})]}),i.jsxs("select",{value:d,onChange:X=>p(X.target.value),style:{padding:"10px 12px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px",minWidth:"150px"},children:[i.jsx("option",{value:"all",children:"All Categories"}),i.jsx("option",{value:"welcome",children:"Welcome"}),i.jsx("option",{value:"renewal",children:"Renewal"}),i.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),i.jsx("option",{value:"engagement",children:"Engagement"}),i.jsx("option",{value:"policy_update",children:"Policy Update"}),i.jsx("option",{value:"general",children:"General"})]}),i.jsxs("span",{style:{fontSize:"13px",color:n.textMuted},children:[B.length," template",B.length!==1?"s":""]})]}),T?i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:Array.from({length:6}).map((X,_)=>i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx(Jt,{width:"80px",height:"20px"}),i.jsx("div",{style:{marginTop:"12px"},children:i.jsx(Jt,{width:"180px",height:"18px"})}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(Jt,{width:"220px",height:"14px"})}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(Jt,{height:"40px"})})]},_))}):B.length>0?i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"},children:B.map(X=>i.jsx(Us,{template:X,onEdit:N,onDuplicate:K,onDelete:se,theme:n},X.id))}):i.jsxs("div",{style:{padding:"60px 20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"8px"},children:u||d!=="all"?"No templates found":"No templates yet"}),i.jsx("p",{style:{fontSize:"14px",color:n.textSecondary,marginBottom:"24px"},children:u||d!=="all"?"Try adjusting your search or filter criteria.":"Create your first email template to get started."}),!u&&d==="all"&&i.jsx("button",{onClick:z,style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Template"})]}),m&&i.jsx(Hs,{template:P,onSave:Q,onClose:()=>f(!1),theme:n})]})},Oi=({width:n="100%",height:r="20px"})=>i.jsx("div",{style:{width:n,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Vs=({type:n,theme:r})=>{const s=(n||"").toLowerCase();let l=s;(s==="prior_customer"||s.startsWith("prior"))&&(l="prior"),s.startsWith("customer")&&(l="customer"),s.startsWith("prospect")&&(l="prospect"),s.startsWith("lead")&&(l="lead");const d={customer:{bg:`${r.success}20`,text:r.success,label:"Customer"},prospect:{bg:`${r.primary}20`,text:r.primary,label:"Prospect"},prior:{bg:`${r.textMuted}20`,text:r.textMuted,label:"Prior Customer"},lead:{bg:`${r.warning}20`,text:r.warning,label:"Lead"}},p=d[l]||d.prospect;return i.jsx("span",{style:{padding:"4px 10px",backgroundColor:p.bg,color:p.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:p.label||n||"Unknown"})},Ks=({policyType:n,status:r,theme:s})=>{const l=r==="active";return i.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"3px 8px",backgroundColor:l?`${s.success}10`:`${s.textMuted}10`,borderRadius:"6px",fontSize:"11px",color:l?s.success:s.textMuted},children:[l?"":""," ",n]})},Ys=({client:n,onClick:r,theme:s})=>{var l,d,p;return i.jsxs("tr",{style:{borderTop:`1px solid ${s.border}`,cursor:"pointer"},onClick:r,onMouseOver:u=>u.currentTarget.style.backgroundColor=s.bgHover,onMouseOut:u=>u.currentTarget.style.backgroundColor="transparent",children:[i.jsx("td",{style:{padding:"14px 16px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",backgroundColor:s.bgHover,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",color:s.textMuted},children:((l=n.name)==null?void 0:l.charAt(0).toUpperCase())||"?"}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:s.text},children:n.name}),i.jsx("div",{style:{fontSize:"12px",color:s.textMuted},children:n.person_email||n.email||""})]})]})}),i.jsx("td",{style:{padding:"14px 16px"},children:i.jsx(Vs,{type:n.account_status||"Prospect",theme:s})}),i.jsx("td",{style:{padding:"14px 16px"},children:i.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",alignItems:"center"},children:((d=n.policies)==null?void 0:d.length)>0?i.jsxs(i.Fragment,{children:[n.policies.slice(0,3).map((u,g)=>i.jsx(Ks,{policyType:u.policy_type||"Policy",status:u.status,theme:s},g)),n.policies.length>3&&i.jsxs("span",{style:{fontSize:"11px",color:s.textMuted},children:["+",n.policies.length-3," more"]})]}):i.jsx("span",{style:{fontSize:"13px",color:s.textMuted},children:"No policies"})})}),i.jsx("td",{style:{padding:"14px 16px",fontSize:"14px",color:s.textSecondary,textAlign:"center"},children:n.policy_count||((p=n.policies)==null?void 0:p.length)||0}),i.jsx("td",{style:{padding:"14px 16px",textAlign:"right"},children:i.jsxs("div",{style:{display:"flex",gap:"6px",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:u=>{u.stopPropagation()},style:{padding:"6px 12px",backgroundColor:s.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:" Email"}),i.jsx("button",{onClick:u=>{u.stopPropagation(),r()},style:{padding:"6px 12px",backgroundColor:s.bgHover,border:`1px solid ${s.border}`,borderRadius:"6px",color:s.textSecondary,cursor:"pointer",fontSize:"12px"},children:"View"})]})})]})},kt=({label:n,value:r,icon:s,color:l,theme:d,onClick:p,active:u})=>i.jsxs("div",{onClick:p,style:{padding:"16px",backgroundColor:u?`${l}15`:d.bgCard,borderRadius:"10px",border:`2px solid ${u?l:d.border}`,textAlign:"center",cursor:p?"pointer":"default",transition:"all 0.2s ease",transform:u?"scale(1.02)":"scale(1)"},onMouseOver:g=>{p&&(g.currentTarget.style.borderColor=l,g.currentTarget.style.transform="scale(1.02)")},onMouseOut:g=>{p&&!u&&(g.currentTarget.style.borderColor=d.border,g.currentTarget.style.transform="scale(1)")},children:[i.jsx("div",{style:{fontSize:"24px",marginBottom:"4px"},children:s}),i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:l||d.text},children:r}),i.jsx("div",{style:{fontSize:"12px",color:d.textSecondary},children:n})]}),Js=({t:n})=>{const{userId:r}=_e(),s=ut(),[l,d]=O.useState(""),[p,u]=O.useState("all"),[g,m]=O.useState("name"),[f,P]=O.useState("asc"),[v,I]=O.useState(1),T=25,w=O.useMemo(()=>{const S={limit:T,offset:(v-1)*T};return p!=="all"&&p!=="expiring"&&(S.status=p),p==="expiring"&&(S.expiring=!0,S.limit=100,S.offset=0),l.length>=2&&(S.search=l),S},[p,v,l]),{data:k,isLoading:R,error:C}=js(w),{data:W,isLoading:Z}=ks(),B=(k==null?void 0:k.accounts)||[],z=(k==null?void 0:k.total)||0,N=Math.ceil(z/T),Q=O.useMemo(()=>!B||B.length===0?[]:[...B].sort((S,E)=>{let M=S[g],$=E[g];return g==="name"&&(M=(M==null?void 0:M.toLowerCase())||"",$=($==null?void 0:$.toLowerCase())||""),g==="policy_count"&&(M=S.policy_count||0,$=E.policy_count||0),f==="asc"?M>$?1:-1:M<$?1:-1}),[B,g,f]),K=S=>{u(S),I(1)},se=S=>{d(S),I(1)},X=S=>{s(`/${r}/accounts/${S}`)},_=W||{Customer:0,Prospect:0,Prior:0,total:0,expiring:0};return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Accounts"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px",margin:0},children:"View and manage your account database"})]}),i.jsxs("div",{style:{display:"flex",gap:"12px"},children:[i.jsx("button",{onClick:()=>{},style:{padding:"10px 16px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:" Export"}),i.jsx("button",{style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:"+ Add Account"})]})]}),C&&i.jsx("div",{style:{padding:"16px",backgroundColor:`${n.danger}15`,border:`1px solid ${n.danger}30`,borderRadius:"8px",marginBottom:"24px",color:n.danger,fontSize:"14px"},children:"Failed to load accounts. Please try refreshing the page."}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"16px",marginBottom:"24px"},children:[i.jsx(kt,{label:"Total Accounts",value:Z?"...":_.total,icon:"",color:n.text,theme:n,onClick:()=>K("all"),active:p==="all"}),i.jsx(kt,{label:"Customers",value:Z?"...":_.Customer,icon:"",color:n.success,theme:n,onClick:()=>K(p==="Customer"?"all":"Customer"),active:p==="Customer"}),i.jsx(kt,{label:"Prospects",value:Z?"...":_.Prospect,icon:"",color:n.primary,theme:n,onClick:()=>K(p==="Prospect"?"all":"Prospect"),active:p==="Prospect"}),i.jsx(kt,{label:"Prior Customers",value:Z?"...":_.Prior,icon:"",color:n.textMuted,theme:n,onClick:()=>K(p==="Prior"?"all":"Prior"),active:p==="Prior"}),i.jsx(kt,{label:"Expiring in 30d",value:Z?"...":_.expiring,icon:"",color:n.warning,theme:n,onClick:()=>K(p==="expiring"?"all":"expiring"),active:p==="expiring"})]}),i.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"20px",alignItems:"center",flexWrap:"wrap"},children:[i.jsxs("div",{style:{position:"relative",flex:1,maxWidth:"350px"},children:[i.jsx("input",{type:"text",placeholder:"Search by name, email, or phone...",value:l,onChange:S=>se(S.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px"}}),i.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:n.textMuted},children:""})]}),i.jsxs("select",{value:p,onChange:S=>K(S.target.value),style:{padding:"10px 12px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px",minWidth:"150px"},children:[i.jsx("option",{value:"all",children:"All Types"}),i.jsx("option",{value:"Customer",children:"Customers"}),i.jsx("option",{value:"Prospect",children:"Prospects"}),i.jsx("option",{value:"Prior",children:"Prior Customers"}),i.jsx("option",{value:"Lead",children:"Leads"}),i.jsx("option",{value:"expiring",children:"Expiring Policies"})]}),i.jsxs("select",{value:`${g}-${f}`,onChange:S=>{const[E,M]=S.target.value.split("-");m(E),P(M)},style:{padding:"10px 12px",backgroundColor:n.bgInput,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,fontSize:"14px",minWidth:"150px"},children:[i.jsx("option",{value:"name-asc",children:"Name (A-Z)"}),i.jsx("option",{value:"name-desc",children:"Name (Z-A)"}),i.jsx("option",{value:"created_at-desc",children:"Newest First"}),i.jsx("option",{value:"created_at-asc",children:"Oldest First"})]}),i.jsx("span",{style:{fontSize:"13px",color:n.textMuted,marginLeft:"auto"},children:p==="expiring"?`${Q.length} account${Q.length!==1?"s":""} with expiring policies`:`Showing ${(v-1)*T+1}-${Math.min(v*T,z)} of ${z} account${z!==1?"s":""}`})]}),R?i.jsx("div",{style:{backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,padding:"20px"},children:Array.from({length:5}).map((S,E)=>i.jsxs("div",{style:{display:"flex",gap:"16px",padding:"16px 0",borderTop:E>0?`1px solid ${n.border}`:"none"},children:[i.jsx(Oi,{width:"40px",height:"40px"}),i.jsxs("div",{style:{flex:1},children:[i.jsx(Oi,{width:"200px",height:"16px"}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(Oi,{width:"150px",height:"12px"})})]})]},E))}):Q.length>0?i.jsx("div",{style:{backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,overflow:"hidden"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{backgroundColor:n.bgHover},children:[i.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Account"}),i.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Type"}),i.jsx("th",{style:{padding:"14px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Policies"}),i.jsx("th",{style:{padding:"14px 16px",textAlign:"center",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"# Policies"}),i.jsx("th",{style:{padding:"14px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:n.textSecondary},children:"Actions"})]})}),i.jsx("tbody",{children:Q.map(S=>i.jsx(Ys,{client:S,onClick:()=>X(S.account_unique_id),theme:n},S.id))})]})}):i.jsxs("div",{style:{padding:"60px 20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"8px"},children:l?"No accounts found":"No accounts yet"}),i.jsx("p",{style:{fontSize:"14px",color:n.textSecondary,marginBottom:"24px"},children:l?"Try adjusting your search criteria.":"Your accounts will appear here once synced from Salesforce."})]}),N>1&&p!=="expiring"&&i.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginTop:"24px",padding:"16px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("button",{onClick:()=>I(1),disabled:v===1,style:{padding:"8px 12px",backgroundColor:v===1?n.bgHover:n.bg,border:`1px solid ${n.border}`,borderRadius:"6px",color:v===1?n.textMuted:n.text,cursor:v===1?"not-allowed":"pointer",fontSize:"13px"},children:" First"}),i.jsx("button",{onClick:()=>I(S=>Math.max(1,S-1)),disabled:v===1,style:{padding:"8px 12px",backgroundColor:v===1?n.bgHover:n.bg,border:`1px solid ${n.border}`,borderRadius:"6px",color:v===1?n.textMuted:n.text,cursor:v===1?"not-allowed":"pointer",fontSize:"13px"},children:" Prev"}),i.jsxs("span",{style:{padding:"8px 16px",fontSize:"14px",color:n.text,fontWeight:"500"},children:["Page ",v," of ",N]}),i.jsx("button",{onClick:()=>I(S=>Math.min(N,S+1)),disabled:v===N,style:{padding:"8px 12px",backgroundColor:v===N?n.bgHover:n.bg,border:`1px solid ${n.border}`,borderRadius:"6px",color:v===N?n.textMuted:n.text,cursor:v===N?"not-allowed":"pointer",fontSize:"13px"},children:"Next "}),i.jsx("button",{onClick:()=>I(N),disabled:v===N,style:{padding:"8px 12px",backgroundColor:v===N?n.bgHover:n.bg,border:`1px solid ${n.border}`,borderRadius:"6px",color:v===N?n.textMuted:n.text,cursor:v===N?"not-allowed":"pointer",fontSize:"13px"},children:"Last "})]}),_.expiring>0&&p!=="expiring"&&i.jsxs("div",{style:{marginTop:"24px",padding:"16px 20px",backgroundColor:`${n.warning}10`,border:`1px solid ${n.warning}30`,borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("span",{style:{fontSize:"24px"},children:""}),i.jsxs("div",{children:[i.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:n.text},children:[_.expiring," account",_.expiring!==1?"s have":" has"," policies expiring in the next 30 days"]}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary},children:"Consider setting up renewal reminders for these accounts."})]})]}),i.jsx("button",{onClick:()=>K("expiring"),style:{padding:"8px 16px",backgroundColor:n.warning,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"View Expiring"})]})]})},Je=({width:n="100%",height:r="20px"})=>i.jsx("div",{style:{width:n,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),jo=({status:n,theme:r})=>{const s={active:{bg:`${r.success}20`,text:r.success},pending:{bg:`${r.warning}20`,text:r.warning},cancelled:{bg:`${r.danger}20`,text:r.danger},expired:{bg:`${r.textMuted}20`,text:r.textMuted}},l=s[n]||s.pending;return i.jsx("span",{style:{padding:"4px 10px",backgroundColor:l.bg,color:l.text,borderRadius:"20px",fontSize:"11px",fontWeight:"500",textTransform:"capitalize"},children:n})},zt=({event:n,theme:r})=>{const s={sent:"",delivered:"",opened:"",clicked:"",bounced:"",unsubscribed:""};return i.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"2px 8px",backgroundColor:r.bgHover,borderRadius:"4px",fontSize:"11px",color:r.textSecondary},children:[s[n]||""," ",n]})},Qs=({policy:n,theme:r})=>{var u;const s=n.expiration_date?Math.ceil((new Date(n.expiration_date)-new Date)/864e5):null,l=n.policy_lob||n.policy_type||"Unknown",d=n.policy_status||n.status||"unknown",p=((u=n.carrier)==null?void 0:u.name)||n.carrier_name||n.carrier||"";return i.jsxs("div",{style:{padding:"16px",backgroundColor:r.bg,borderRadius:"10px",border:`1px solid ${r.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[i.jsx("div",{style:{padding:"8px 12px",backgroundColor:`${r.primary}15`,borderRadius:"8px",fontSize:"14px",fontWeight:"600",color:r.primary},children:l}),i.jsx(jo,{status:d.toLowerCase(),theme:r})]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",fontSize:"13px"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Policy Number"}),i.jsx("div",{style:{color:r.text},children:n.policy_number||""})]}),i.jsxs("div",{children:[i.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Carrier"}),i.jsx("div",{style:{color:r.text},children:p})]}),i.jsxs("div",{children:[i.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Effective Date"}),i.jsx("div",{style:{color:r.text},children:n.effective_date?new Date(n.effective_date).toLocaleDateString():""})]}),i.jsxs("div",{children:[i.jsx("div",{style:{color:r.textMuted,fontSize:"11px",marginBottom:"2px"},children:"Expiration"}),i.jsx("div",{style:{color:s!==null&&s>0&&s<=30?r.warning:r.text},children:n.expiration_date?i.jsxs(i.Fragment,{children:[new Date(n.expiration_date).toLocaleDateString(),s!==null&&s>0&&s<=30&&i.jsxs("span",{style:{fontSize:"11px",marginLeft:"6px"},children:["(",s,"d left)"]})]}):""})]})]}),(n.premium||n.annual_premium)&&i.jsxs("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:`1px solid ${r.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("span",{style:{fontSize:"12px",color:r.textMuted},children:"Annual Premium"}),i.jsxs("span",{style:{fontSize:"16px",fontWeight:"600",color:r.success},children:["$",(n.premium||n.annual_premium).toLocaleString()]})]})]})},Xs=({log:n,theme:r})=>{var s;return i.jsxs("div",{style:{padding:"14px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`,marginBottom:"8px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:r.text},children:((s=n.email_templates)==null?void 0:s.name)||"Direct Email"}),i.jsx("div",{style:{fontSize:"12px",color:r.textSecondary,marginTop:"2px"},children:n.subject})]}),i.jsx("div",{style:{textAlign:"right"},children:i.jsxs("div",{style:{fontSize:"11px",color:r.textMuted},children:[new Date(n.sent_at).toLocaleDateString()," at"," ",new Date(n.sent_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})})]}),i.jsxs("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:[i.jsx(zt,{event:"sent",theme:r}),n.delivered_at&&i.jsx(zt,{event:"delivered",theme:r}),n.opened_at&&i.jsx(zt,{event:"opened",theme:r}),n.clicked_at&&i.jsx(zt,{event:"clicked",theme:r}),n.bounced_at&&i.jsx(zt,{event:"bounced",theme:r})]})]})},ea=({activity:n,theme:r})=>{const s={email_sent:"",email_opened:"",email_clicked:"",enrollment_started:"",enrollment_completed:"",enrollment_paused:"",note_added:""};return i.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[i.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:r.bgHover,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:s[n.action_type]||""}),i.jsxs("div",{style:{flex:1},children:[i.jsx("div",{style:{fontSize:"13px",color:r.text},children:n.description}),i.jsx("div",{style:{fontSize:"11px",color:r.textMuted,marginTop:"2px"},children:new Date(n.created_at).toLocaleString()})]})]})},lo=({enrollment:n,theme:r,userId:s})=>{var l;return i.jsxs("div",{style:{padding:"14px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`,marginBottom:"8px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx(Xe,{to:`/${s}/automations/${n.automation_id}`,style:{fontSize:"14px",fontWeight:"500",color:r.text,textDecoration:"none"},children:((l=n.automations)==null?void 0:l.name)||"Unknown Automation"}),i.jsxs("div",{style:{fontSize:"12px",color:r.textMuted,marginTop:"2px"},children:["Started ",new Date(n.enrolled_at).toLocaleDateString()]})]}),i.jsx(jo,{status:n.status==="active"?"active":n.status,theme:r})]}),n.current_node_id&&i.jsxs("div",{style:{marginTop:"10px",padding:"8px 10px",backgroundColor:r.bgHover,borderRadius:"6px",fontSize:"12px",color:r.textSecondary},children:[" Current step: ",n.current_node_name||n.current_node_id]})]})},ta=({t:n})=>{var Z,B;const{userId:r,accountId:s}=_e(),l=ut(),[d,p]=O.useState("overview"),{data:u,isLoading:g,error:m}=Cs(s),{data:f,isLoading:P}=vs(d==="overview"||d==="emails"?s:null),{data:v,isLoading:I}=Ts(d==="activity"?s:null),{data:T,isLoading:w}=_s(d==="overview"||d==="automations"?s:null),{data:k}=bo(),R={emailsSent:(f==null?void 0:f.length)||0,opened:(f==null?void 0:f.filter(z=>z.opened_at).length)||0,clicked:(f==null?void 0:f.filter(z=>z.clicked_at).length)||0,openRate:(f==null?void 0:f.length)>0?Math.round(f.filter(z=>z.opened_at).length/f.length*100):0,clickRate:(f==null?void 0:f.length)>0?Math.round(f.filter(z=>z.clicked_at).length/f.length*100):0,activeEnrollments:(T==null?void 0:T.filter(z=>z.status==="active").length)||0},C={openRate:(k==null?void 0:k.openRate)||25,clickRate:(k==null?void 0:k.clickRate)||5};if(g)return i.jsxs("div",{children:[i.jsx(Je,{width:"200px",height:"32px"}),i.jsx("div",{style:{marginTop:"20px"},children:i.jsx(Je,{height:"200px"})})]});if(m||!u)return i.jsxs("div",{style:{padding:"60px 20px",textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),i.jsx("h2",{style:{color:n.text,marginBottom:"8px"},children:"Account Not Found"}),i.jsx("p",{style:{color:n.textSecondary,marginBottom:"24px"},children:"We couldn't find the account you're looking for."}),i.jsx("button",{onClick:()=>l(`/${r}/accounts`),style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Accounts"})]});const W=[{id:"overview",label:"Overview"},{id:"emails",label:`Emails (${(f==null?void 0:f.length)||0})`},{id:"automations",label:`Automations (${(T==null?void 0:T.length)||0})`},{id:"activity",label:"Activity"}];return i.jsxs("div",{children:[i.jsxs("div",{style:{marginBottom:"24px"},children:[i.jsx("button",{onClick:()=>l(`/${r}/accounts`),style:{background:"none",border:"none",color:n.textMuted,cursor:"pointer",fontSize:"14px",marginBottom:"12px",padding:0,display:"flex",alignItems:"center",gap:"6px"},children:" Back to Accounts"}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:u.name}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(()=>{const z=(u.account_status||"").toLowerCase();let N=z;(z==="prior_customer"||z.startsWith("prior"))&&(N="prior"),z.startsWith("customer")&&(N="customer"),z.startsWith("prospect")&&(N="prospect"),z.startsWith("lead")&&(N="lead");const Q={customer:{bg:`${n.success}20`,text:n.success,label:"Customer"},prospect:{bg:`${n.primary}20`,text:n.primary,label:"Prospect"},prior:{bg:`${n.textMuted}20`,text:n.textMuted,label:"Prior Customer"},lead:{bg:`${n.warning}20`,text:n.warning,label:"Lead"}},K=Q[N]||Q.prospect;return i.jsx("span",{style:{padding:"4px 10px",backgroundColor:K.bg,color:K.text,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:K.label})})(),u.account_unique_id&&i.jsxs("span",{style:{fontSize:"12px",color:n.textMuted},children:["ID: ",u.account_unique_id]})]})]}),i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx("button",{style:{padding:"10px 16px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:" Add Note"}),i.jsx("button",{style:{padding:"10px 16px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:" Send Email"})]})]})]}),i.jsxs("div",{style:{display:"flex",gap:"24px",padding:"16px 20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,marginBottom:"24px",flexWrap:"wrap"},children:[(u.person_email||u.email)&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"16px"},children:""}),i.jsx("a",{href:`mailto:${u.person_email||u.email}`,style:{color:n.primary,textDecoration:"none",fontSize:"14px"},children:u.person_email||u.email})]}),u.phone&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"16px"},children:""}),i.jsx("a",{href:`tel:${u.phone}`,style:{color:n.text,textDecoration:"none",fontSize:"14px"},children:u.phone})]}),(u.billing_street||u.billing_city||u.billing_state)&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"16px"},children:""}),i.jsx("span",{style:{color:n.textSecondary,fontSize:"14px"},children:[u.billing_street,[u.billing_city,u.billing_state].filter(Boolean).join(", "),u.billing_postal_code].filter(Boolean).join("  ")})]}),u.primary_contact_first_name&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"16px"},children:""}),i.jsxs("span",{style:{color:n.textSecondary,fontSize:"14px"},children:[u.primary_contact_first_name," ",u.primary_contact_last_name]})]})]}),i.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:n.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:W.map(z=>i.jsx("button",{onClick:()=>p(z.id),style:{padding:"10px 20px",backgroundColor:d===z.id?n.bgCard:"transparent",border:"none",borderRadius:"8px",color:d===z.id?n.text:n.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:z.label},z.id))}),d==="overview"&&i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,display:"flex",flexDirection:"column"},children:[i.jsxs("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px",flexShrink:0},children:["Policies (",((Z=u.policies)==null?void 0:Z.length)||0,")"]}),((B=u.policies)==null?void 0:B.length)>0?i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto",flex:1,paddingRight:"8px"},children:u.policies.map((z,N)=>i.jsx(Qs,{policy:z,theme:n},N))}):i.jsx("div",{style:{padding:"30px",textAlign:"center",color:n.textMuted},children:"No policies on file"})]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Email Engagement"}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"20px"},children:[i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.primary},children:R.emailsSent}),i.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:"Sent"})]}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.success},children:R.opened}),i.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:"Opened"})]}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.warning},children:R.clicked}),i.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:"Clicked"})]}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"24px",fontWeight:"700",color:n.danger},children:(f==null?void 0:f.filter(z=>z.bounced_at).length)||0}),i.jsx("div",{style:{fontSize:"11px",color:n.textMuted},children:"Bounced"})]})]})]}),i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Compared to Average"}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[i.jsx("span",{style:{fontSize:"13px",color:n.textSecondary},children:"Open Rate"}),i.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:R.openRate>=C.openRate?n.success:n.danger},children:[R.openRate,"%",R.openRate>=C.openRate?" ":" "]})]}),i.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:n.bgHover,borderRadius:"4px",overflow:"hidden"},children:[i.jsx("div",{style:{position:"absolute",left:`${Math.min(C.openRate,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:n.textMuted,zIndex:2}}),i.jsx("div",{style:{width:`${Math.min(R.openRate,100)}%`,height:"100%",backgroundColor:R.openRate>=C.openRate?n.success:n.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[i.jsx("span",{style:{fontSize:"10px",color:n.textMuted},children:"0%"}),i.jsxs("span",{style:{fontSize:"10px",color:n.textMuted},children:["Avg: ",C.openRate,"%"]}),i.jsx("span",{style:{fontSize:"10px",color:n.textMuted},children:"100%"})]})]}),i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[i.jsx("span",{style:{fontSize:"13px",color:n.textSecondary},children:"Click Rate"}),i.jsxs("span",{style:{fontSize:"13px",fontWeight:"600",color:R.clickRate>=C.clickRate?n.success:n.danger},children:[R.clickRate,"%",R.clickRate>=C.clickRate?" ":" "]})]}),i.jsxs("div",{style:{position:"relative",height:"8px",backgroundColor:n.bgHover,borderRadius:"4px",overflow:"hidden"},children:[i.jsx("div",{style:{position:"absolute",left:`${Math.min(C.clickRate*5,100)}%`,top:0,width:"2px",height:"100%",backgroundColor:n.textMuted,zIndex:2}}),i.jsx("div",{style:{width:`${Math.min(R.clickRate*5,100)}%`,height:"100%",backgroundColor:R.clickRate>=C.clickRate?n.success:n.warning,borderRadius:"4px",transition:"width 0.3s"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[i.jsx("span",{style:{fontSize:"10px",color:n.textMuted},children:"0%"}),i.jsxs("span",{style:{fontSize:"10px",color:n.textMuted},children:["Avg: ",C.clickRate,"%"]}),i.jsx("span",{style:{fontSize:"10px",color:n.textMuted},children:"20%+"})]})]}),i.jsxs("div",{style:{padding:"16px",backgroundColor:n.bg,borderRadius:"10px",textAlign:"center",marginTop:"8px"},children:[i.jsx("div",{style:{fontSize:"11px",color:n.textMuted,marginBottom:"4px"},children:"ENGAGEMENT SCORE"}),i.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:R.openRate>=C.openRate&&R.clickRate>=C.clickRate?n.success:R.openRate>=C.openRate||R.clickRate>=C.clickRate?n.warning:n.danger},children:R.emailsSent===0?"":R.openRate>=C.openRate&&R.clickRate>=C.clickRate?"High":R.openRate>=C.openRate||R.clickRate>=C.clickRate?"Medium":"Low"}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary,marginTop:"4px"},children:R.emailsSent===0?"No emails sent yet":R.openRate>=C.openRate?"Above average engagement":"Below average engagement"})]})]})]}),i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Active Automations"}),(T==null?void 0:T.filter(z=>z.status==="active").length)>0?T.filter(z=>z.status==="active").map(z=>i.jsx(lo,{enrollment:z,theme:n,userId:r},z.id)):i.jsx("div",{style:{padding:"20px",textAlign:"center",color:n.textMuted,fontSize:"13px"},children:"Not enrolled in any automations"})]})]})]}),d==="emails"&&i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Email History"}),P?Array.from({length:3}).map((z,N)=>i.jsx("div",{style:{marginBottom:"12px"},children:i.jsx(Je,{height:"80px"})},N)):(f==null?void 0:f.length)>0?f.map(z=>i.jsx(Xs,{log:z,theme:n},z.id)):i.jsx("div",{style:{padding:"40px",textAlign:"center",color:n.textMuted},children:"No emails sent to this client yet"})]}),d==="automations"&&i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,margin:0},children:"Automation Enrollments"}),i.jsx("button",{style:{padding:"8px 12px",backgroundColor:n.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px"},children:"+ Enroll in Automation"})]}),w?Array.from({length:2}).map((z,N)=>i.jsx("div",{style:{marginBottom:"12px"},children:i.jsx(Je,{height:"60px"})},N)):(T==null?void 0:T.length)>0?T.map(z=>i.jsx(lo,{enrollment:z,theme:n,userId:r},z.id)):i.jsx("div",{style:{padding:"40px",textAlign:"center",color:n.textMuted},children:"Not enrolled in any automations"})]}),d==="activity"&&i.jsxs("div",{style:{padding:"20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Activity Timeline"}),I?Array.from({length:5}).map((z,N)=>i.jsxs("div",{style:{display:"flex",gap:"12px",padding:"12px 0"},children:[i.jsx(Je,{width:"32px",height:"32px"}),i.jsxs("div",{style:{flex:1},children:[i.jsx(Je,{width:"80%",height:"14px"}),i.jsx("div",{style:{marginTop:"4px"},children:i.jsx(Je,{width:"120px",height:"12px"})})]})]},N)):(v==null?void 0:v.length)>0?i.jsx("div",{style:{borderLeft:`2px solid ${n.border}`,marginLeft:"15px",paddingLeft:"20px"},children:v.map(z=>i.jsx(ea,{activity:z,theme:n},z.id))}):i.jsx("div",{style:{padding:"40px",textAlign:"center",color:n.textMuted},children:"No activity recorded yet"})]})]})},Di=({width:n="100%",height:r="20px"})=>i.jsx("div",{style:{width:n,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Le=({label:n,value:r,onChange:s,placeholder:l,type:d="text",disabled:p,hint:u,theme:g})=>i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:g.text,display:"block",marginBottom:"6px"},children:n}),i.jsx("input",{type:d,value:r||"",onChange:m=>s(m.target.value),placeholder:l,disabled:p,style:{width:"100%",padding:"12px",backgroundColor:p?g.bgHover:g.bgInput,border:`1px solid ${g.border}`,borderRadius:"8px",color:g.text,fontSize:"14px",opacity:p?.6:1}}),u&&i.jsx("p",{style:{fontSize:"11px",color:g.textMuted,marginTop:"4px"},children:u})]}),ia=({label:n,value:r,onChange:s,placeholder:l,rows:d=3,disabled:p,theme:u})=>i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:u.text,display:"block",marginBottom:"6px"},children:n}),i.jsx("textarea",{value:r||"",onChange:g=>s(g.target.value),placeholder:l,rows:d,disabled:p,style:{width:"100%",padding:"12px",backgroundColor:p?u.bgHover:u.bgInput,border:`1px solid ${u.border}`,borderRadius:"8px",color:u.text,fontSize:"14px",resize:"vertical",opacity:p?.6:1}})]}),na=({settings:n,theme:r})=>i.jsxs("div",{style:{padding:"16px",backgroundColor:r.bg,borderRadius:"8px",border:`1px solid ${r.border}`},children:[(n==null?void 0:n.full_name)&&i.jsx("div",{style:{fontWeight:"600",color:r.text},children:n.full_name}),(n==null?void 0:n.job_title)&&i.jsx("div",{style:{color:r.textSecondary,fontSize:"14px"},children:n.job_title}),i.jsx("div",{style:{color:r.textSecondary,fontSize:"14px",marginTop:"4px"},children:[n==null?void 0:n.phone,n==null?void 0:n.email].filter(Boolean).join("  ")}),(n==null?void 0:n.custom_message)&&i.jsx("div",{style:{color:r.textMuted,fontSize:"14px",fontStyle:"italic",marginTop:"8px"},children:n.custom_message}),!(n!=null&&n.full_name)&&!(n!=null&&n.job_title)&&i.jsx("div",{style:{color:r.textMuted,fontSize:"14px"},children:"Fill in your details to see a preview"})]}),oa=({t:n})=>{const{userId:r}=_e(),[s,l]=O.useState("signature"),[d,p]=O.useState(!1),[u,g]=O.useState(null),{data:m,isLoading:f,error:P}=ws(),{updateSettings:v,updateSignature:I}=Ss(),[T,w]=O.useState({full_name:"",job_title:"",phone:"",email:"",custom_message:"",agency_name:"",agency_address:"",agency_phone:"",agency_website:"",default_from_name:"",default_from_email:"",reply_to_email:"",sending_domain:""});O.useEffect(()=>{m&&w({full_name:m.full_name||"",job_title:m.job_title||"",phone:m.phone||"",email:m.email||"",custom_message:m.custom_message||"",agency_name:m.agency_name||"",agency_address:m.agency_address||"",agency_phone:m.agency_phone||"",agency_website:m.agency_website||"",default_from_name:m.default_from_name||"",default_from_email:m.default_from_email||"",reply_to_email:m.reply_to_email||"",sending_domain:m.sending_domain||""})},[m]);const k=Z=>B=>{w(z=>({...z,[Z]:B})),g(null)},R=async()=>{p(!0),g(null);try{await I.mutateAsync({full_name:T.full_name,job_title:T.job_title,phone:T.phone,email:T.email,custom_message:T.custom_message}),g({type:"success",text:"Signature saved successfully!"})}catch{g({type:"error",text:"Failed to save signature. Please try again."})}finally{p(!1)}},C=async()=>{p(!0),g(null);try{await v.mutateAsync(T),g({type:"success",text:"Settings saved successfully!"})}catch{g({type:"error",text:"Failed to save settings. Please try again."})}finally{p(!1)}},W=[{id:"signature",label:"Email Signature",icon:""},{id:"agency",label:"Agency Info",icon:""},{id:"email",label:"Email Settings",icon:""},{id:"integrations",label:"Integrations",icon:""}];return i.jsxs("div",{children:[i.jsxs("div",{style:{marginBottom:"24px"},children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Settings"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px",margin:0},children:"Manage your email preferences and configuration"})]}),P&&i.jsx("div",{style:{padding:"16px",backgroundColor:`${n.danger}15`,border:`1px solid ${n.danger}30`,borderRadius:"8px",marginBottom:"24px",color:n.danger,fontSize:"14px"},children:"Failed to load settings. Please try refreshing the page."}),u&&i.jsx("div",{style:{padding:"12px 16px",backgroundColor:u.type==="success"?`${n.success}15`:`${n.danger}15`,border:`1px solid ${u.type==="success"?n.success:n.danger}30`,borderRadius:"8px",marginBottom:"24px",color:u.type==="success"?n.success:n.danger,fontSize:"14px"},children:u.text}),i.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"24px",backgroundColor:n.bgHover,padding:"4px",borderRadius:"10px",width:"fit-content"},children:W.map(Z=>i.jsxs("button",{onClick:()=>l(Z.id),style:{padding:"10px 20px",backgroundColor:s===Z.id?n.bgCard:"transparent",border:"none",borderRadius:"8px",color:s===Z.id?n.text:n.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[Z.icon," ",Z.label]},Z.id))}),f?i.jsxs("div",{style:{padding:"24px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx(Di,{width:"200px",height:"24px"}),i.jsx("div",{style:{marginTop:"24px"},children:i.jsx(Di,{height:"40px"})}),i.jsx("div",{style:{marginTop:"16px"},children:i.jsx(Di,{height:"40px"})})]}):i.jsxs(i.Fragment,{children:[s==="signature"&&i.jsxs("div",{style:{padding:"24px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"4px"},children:"Your Email Signature"}),i.jsx("p",{style:{fontSize:"13px",color:n.textSecondary,marginBottom:"24px"},children:"This signature will be automatically added to all emails you send through the platform"}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[i.jsx(Le,{label:"Full Name",value:T.full_name,onChange:k("full_name"),placeholder:"John Doe",theme:n}),i.jsx(Le,{label:"Job Title",value:T.job_title,onChange:k("job_title"),placeholder:"Insurance Advisor",theme:n}),i.jsx(Le,{label:"Phone Number",value:T.phone,onChange:k("phone"),placeholder:"(555) 123-4567",theme:n}),i.jsx(Le,{label:"Email Address",value:T.email,onChange:k("email"),placeholder:"john.doe@company.com",type:"email",theme:n})]}),i.jsx(ia,{label:"Custom Message (Optional)",value:T.custom_message,onChange:k("custom_message"),placeholder:"Looking forward to serving you!",theme:n}),i.jsxs("div",{style:{marginBottom:"24px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:n.text,display:"block",marginBottom:"8px"},children:"Preview"}),i.jsx(na,{settings:T,theme:n})]}),i.jsx("button",{onClick:R,disabled:d,style:{padding:"12px 24px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:d?"wait":"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px",opacity:d?.7:1},children:d?" Saving...":" Save Signature"})]}),s==="agency"&&i.jsxs("div",{style:{padding:"24px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"4px"},children:"Agency Information"}),i.jsx("p",{style:{fontSize:"13px",color:n.textSecondary,marginBottom:"24px"},children:"Your agency details used in email templates and footers"}),i.jsx(Le,{label:"Agency Name",value:T.agency_name,onChange:k("agency_name"),placeholder:"Insurance Solutions Group",theme:n}),i.jsx(Le,{label:"Address",value:T.agency_address,onChange:k("agency_address"),placeholder:"123 Main Street, Suite 100, Dallas, TX 75201",theme:n}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[i.jsx(Le,{label:"Phone",value:T.agency_phone,onChange:k("agency_phone"),placeholder:"(555) 000-0000",theme:n}),i.jsx(Le,{label:"Website",value:T.agency_website,onChange:k("agency_website"),placeholder:"https://www.example.com",theme:n})]}),i.jsx("button",{onClick:C,disabled:d,style:{padding:"12px 24px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:d?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:d?.7:1},children:d?" Saving...":" Save Agency Info"})]}),s==="email"&&i.jsxs("div",{style:{padding:"24px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[i.jsxs("div",{children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"4px"},children:"Email Configuration"}),i.jsx("p",{style:{fontSize:"13px",color:n.textSecondary},children:"Configure your sending domain and default email settings"})]}),i.jsx("span",{style:{padding:"4px 10px",backgroundColor:n.bgHover,borderRadius:"20px",fontSize:"11px",color:n.textSecondary},children:"Admin Only"})]}),i.jsx(Le,{label:"Sending Domain",value:T.sending_domain,onChange:k("sending_domain"),placeholder:"emails.yourcompany.com",hint:"The domain that will be used to send emails. Must be verified in SendGrid.",theme:n}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[i.jsx(Le,{label:"Default From Name",value:T.default_from_name,onChange:k("default_from_name"),placeholder:"Your Company",theme:n}),i.jsx(Le,{label:"Default From Email",value:T.default_from_email,onChange:k("default_from_email"),placeholder:"noreply@yourcompany.com",type:"email",theme:n})]}),i.jsx(Le,{label:"Reply-To Email",value:T.reply_to_email,onChange:k("reply_to_email"),placeholder:"support@yourcompany.com",type:"email",hint:"Where replies will be directed when recipients respond to automated emails.",theme:n}),i.jsx("button",{onClick:C,disabled:d,style:{padding:"12px 24px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:d?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:d?.7:1},children:d?" Saving...":" Save Configuration"})]}),s==="integrations"&&i.jsxs("div",{style:{padding:"24px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"24px"},children:"Integrations"}),i.jsx("div",{style:{padding:"20px",backgroundColor:n.bg,borderRadius:"10px",border:`1px solid ${n.border}`,marginBottom:"16px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#1A82E2",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SG"}),i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:"600",color:n.text,marginBottom:"2px"},children:"SendGrid"}),i.jsx("div",{style:{fontSize:"13px",color:n.textSecondary},children:"Email delivery service"})]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${n.success}20`,color:n.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),i.jsx("button",{style:{padding:"8px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"6px",color:n.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Configure"})]})]})}),i.jsx("div",{style:{padding:"20px",backgroundColor:n.bg,borderRadius:"10px",border:`1px solid ${n.border}`,marginBottom:"16px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{width:"48px",height:"48px",backgroundColor:"#00A1E0",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"20px",fontWeight:"700"},children:"SF"}),i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:"600",color:n.text,marginBottom:"2px"},children:"Salesforce"}),i.jsx("div",{style:{fontSize:"13px",color:n.textSecondary},children:"CRM data sync"})]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("span",{style:{padding:"4px 10px",backgroundColor:`${n.success}20`,color:n.success,borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:"Connected"}),i.jsx("button",{style:{padding:"8px 12px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"6px",color:n.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Sync Now"})]})]})}),i.jsxs("div",{style:{padding:"16px",backgroundColor:`${n.primary}10`,borderRadius:"8px",marginTop:"24px"},children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:n.text,marginBottom:"4px"},children:" Webhook URL"}),i.jsx("div",{style:{fontSize:"12px",color:n.textSecondary,marginBottom:"8px"},children:"Configure this URL in SendGrid to receive email event notifications"}),i.jsxs("code",{style:{display:"block",padding:"8px 12px",backgroundColor:n.bgCard,borderRadius:"6px",fontSize:"12px",color:n.primary,wordBreak:"break-all"},children:["https://your-app-url.com/api/webhooks/sendgrid/",r]})]})]})]})]})},Co={bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},ra=({onClose:n,t:r=Co})=>{const[s,l]=O.useState("simple"),[d,p]=O.useState("OR"),[u,g]=O.useState(""),[m,f]=O.useState(null),P=[{id:1,name:"John Smith",policies:"Auto only  Expires in 52 days",passes:!0,conditions:[{label:"Has policy type: Auto",passes:!0,value:"Auto (Active)"},{label:"Has policy type: Home",passes:!0,value:"None (Excluded)"},{label:"Expiration: 45-60 days",passes:!0,value:"52 days"}],groupResults:[{passes:!0},{passes:!1}]},{id:2,name:"Jane Wilson",policies:"Home only  Expires in 48 days",passes:!0,conditions:[{label:"Has policy type: Home",passes:!0,value:"Home (Active)"},{label:"Has policy type: Auto",passes:!0,value:"None (Excluded)"},{label:"Expiration: 45-60 days",passes:!0,value:"48 days"}],groupResults:[{passes:!1},{passes:!0}]},{id:3,name:"Bob Johnson",policies:"Auto + Home  Expires in 55 days",passes:!1,conditions:[{label:"Has policy type: Auto",passes:!0,value:"Auto (Active)"},{label:"Excludes: Home",passes:!1,reason:"Account has Home policy",value:"Home (Active)"},{label:"Expiration: 45-60 days",passes:!0,value:"55 days"}],groupResults:[{passes:!1},{passes:!1}]},{id:4,name:"Sarah Davis",policies:"Auto only  Expires in 90 days",passes:!1,conditions:[{label:"Has policy type: Auto",passes:!0,value:"Auto (Active)"},{label:"Has policy type: Home",passes:!0,value:"None (Excluded)"},{label:"Expiration: 45-60 days",passes:!1,reason:"Outside timing window",value:"90 days"}],groupResults:[{passes:!1},{passes:!1}]}].filter(_=>_.name.toLowerCase().includes(u.toLowerCase())),[v,I]=O.useState([{id:1,name:"Group 1",logic:"AND",color:r.primary,filters:{include:[{id:1,conditionId:"has_policy_type",label:"Has policy type",icon:"",value:"Auto"}],exclude:[{id:2,conditionId:"has_policy_type",label:"Has policy type",icon:"",value:"Home"}],activity:[]}},{id:2,name:"Group 2",logic:"AND",color:r.purple,filters:{include:[{id:3,conditionId:"has_policy_type",label:"Has policy type",icon:"",value:"Home"}],exclude:[{id:4,conditionId:"has_policy_type",label:"Has policy type",icon:"",value:"Auto"}],activity:[]}}]),[T,w]=O.useState({enabled:!0,field:"expiration_days",min:45,max:60}),k={"Customer Type":{icon:"",color:r.purple,conditions:[{id:"customer_status",label:"Customer status",configType:"select",options:["New","Existing","Prior","Prospect"]},{id:"is_new",label:"Is a new customer",configType:"none"},{id:"is_existing",label:"Is an existing customer",configType:"none"},{id:"is_prior",label:"Is a prior customer",configType:"none"}]},"Policy Bundle":{icon:"",color:r.primary,conditions:[{id:"bundle_status",label:"Bundle status",configType:"select",options:["Monoline","Bundled"]},{id:"policy_count",label:"Number of policies",configType:"number_compare",unit:"policies"}]},Coverage:{icon:"",color:r.success,conditions:[{id:"has_policy_type",label:"Has policy type",configType:"select",options:["Auto","Home","Renters","Umbrella","Life","Any Active"]},{id:"policy_status",label:"Policy status",configType:"select",options:["Active","Pending","Cancelled","Expired"]},{id:"has_active_renewal",label:"Has an active renewal",configType:"none"}]},"Policy Timing":{icon:"",color:r.warning,conditions:[{id:"expiration_days",label:"Expiration date",configType:"days_from_now"},{id:"effective_days",label:"Effective date",configType:"days_ago"},{id:"approaching_renewal",label:"Is approaching renewal",configType:"none"}]},"Email History":{icon:"",color:"#06b6d4",conditions:[{id:"no_email_in",label:"Hasn't received email in",configType:"days_threshold",defaultValue:30},{id:"received_template",label:"Has received email",configType:"select",options:["Welcome","Renewal","Cross Sell","Follow-Up","Feedback"]},{id:"not_received_template",label:"Has NOT received email",configType:"select",options:["Welcome","Renewal","Cross Sell","Follow-Up","Feedback"]}]},Engagement:{icon:"",color:"#8b5cf6",conditions:[{id:"opened_last",label:"Opened last email",configType:"none"},{id:"clicked_last",label:"Clicked last email",configType:"none"},{id:"no_opens_in",label:"Hasn't opened email in",configType:"days_threshold",defaultValue:60}]},Feedback:{icon:"",color:"#eab308",conditions:[{id:"feedback_score",label:"Feedback score",configType:"number_compare",unit:"stars",max:5},{id:"gave_feedback",label:"Has given feedback",configType:"none"},{id:"no_feedback",label:"Has not given feedback",configType:"none"}]}},R=["#3b82f6","#a78bfa","#22c55e","#f59e0b","#ec4899","#06b6d4"],C=()=>{const _=Math.max(...v.map(S=>S.id),0)+1;I([...v,{id:_,name:`Group ${_}`,logic:"AND",color:R[(_-1)%R.length],filters:{include:[],exclude:[],activity:[]}}])},W=_=>{v.length>1&&I(v.filter(S=>S.id!==_))},Z=(_,S,E)=>{I(v.map(M=>M.id===_?{...M,filters:{...M.filters,[S]:[...M.filters[S],{...E,id:Date.now()}]}}:M))},B=(_,S,E,M)=>{I(v.map($=>$.id===_?{...$,filters:{...$.filters,[S]:$.filters[S].map(U=>U.id===E?{...U,...M}:U)}}:$))},z=(_,S,E)=>{I(v.map(M=>M.id===_?{...M,filters:{...M.filters,[S]:M.filters[S].filter($=>$.id!==E)}}:M))},N=_=>{for(const S of Object.values(k)){const E=S.conditions.find(M=>M.id===_);if(E)return E}return null},Q=({filter:_,groupId:S,section:E,color:M})=>{const $=N(_.conditionId),U=()=>{if(!$)return null;switch($.configType){case"select":return i.jsx("select",{value:_.value||$.options[0],onChange:te=>B(S,E,_.id,{value:te.target.value}),style:{backgroundColor:r.bgHover,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"4px 8px",color:r.text,fontSize:"12px",marginLeft:"6px"},children:$.options.map(te=>i.jsx("option",{value:te,children:te},te))});case"days_threshold":return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginLeft:"6px"},children:[i.jsx("input",{type:"number",value:_.value||$.defaultValue||30,onChange:te=>B(S,E,_.id,{value:te.target.value}),style:{backgroundColor:r.bgHover,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"4px 6px",color:r.text,fontSize:"12px",width:"50px",textAlign:"center"}}),i.jsx("span",{style:{color:r.textMuted,fontSize:"11px"},children:"days"})]});case"number_compare":return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginLeft:"6px"},children:[i.jsxs("select",{value:_.operator||"at_least",onChange:te=>B(S,E,_.id,{operator:te.target.value}),style:{backgroundColor:r.bgHover,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"4px 6px",color:r.text,fontSize:"11px"},children:[i.jsx("option",{value:"equals",children:"equals"}),i.jsx("option",{value:"at_least",children:"at least"}),i.jsx("option",{value:"at_most",children:"at most"})]}),i.jsx("input",{type:"number",value:_.value||1,max:$.max,onChange:te=>B(S,E,_.id,{value:te.target.value}),style:{backgroundColor:r.bgHover,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"4px 6px",color:r.text,fontSize:"12px",width:"45px",textAlign:"center"}}),$.unit&&i.jsx("span",{style:{color:r.textMuted,fontSize:"11px"},children:$.unit})]});default:return null}};return i.jsxs("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"4px",padding:"8px 10px",backgroundColor:`${M}12`,borderRadius:"8px",border:`1px solid ${M}25`,fontSize:"13px",color:r.text},children:[i.jsx("span",{style:{opacity:.7},children:_.icon}),i.jsx("span",{children:_.label}),U(),i.jsx("button",{onClick:()=>z(S,E,_.id),style:{background:"none",border:"none",color:r.textMuted,cursor:"pointer",padding:"0 2px",fontSize:"16px",lineHeight:1,marginLeft:"auto"},children:""})]})},K=({groupId:_,section:S,onSelect:E,buttonColor:M})=>{const[$,U]=O.useState(!1),[te,H]=O.useState(null),Se=S==="include"?"Add condition":S==="exclude"?"Add exclusion":"Add activity filter";return i.jsxs("div",{style:{position:"relative"},children:[i.jsxs("button",{onClick:()=>U(!$),style:{width:"100%",padding:"8px 12px",backgroundColor:"transparent",border:`1px dashed ${r.borderLight}`,borderRadius:"8px",color:r.textMuted,cursor:"pointer",fontSize:"12px",textAlign:"left",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{style:{color:M},children:"+"})," ",Se]}),$&&i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:()=>{U(!1),H(null)}}),i.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",backgroundColor:r.bgCard,border:`1px solid ${r.borderLight}`,borderRadius:"12px",zIndex:100,overflow:"hidden",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},children:i.jsxs("div",{style:{display:"flex",maxHeight:"280px"},children:[i.jsx("div",{style:{width:"140px",borderRight:"1px solid #3f3f46",overflowY:"auto"},children:Object.entries(k).map(([D,ne])=>i.jsxs("button",{onClick:()=>H(D),style:{width:"100%",padding:"8px 10px",backgroundColor:te===D?"#27272a":"transparent",border:"none",borderLeft:te===D?`3px solid ${ne.color}`:"3px solid transparent",color:te===D?"#fafafa":"#a1a1aa",cursor:"pointer",fontSize:"11px",textAlign:"left",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:ne.icon})," ",D]},D))}),i.jsx("div",{style:{flex:1,padding:"6px",overflowY:"auto",minWidth:"180px"},children:te?k[te].conditions.map(D=>i.jsx("button",{onClick:()=>{E({conditionId:D.id,label:D.label,icon:k[te].icon,value:D.options?D.options[0]:D.defaultValue}),U(!1),H(null)},style:{width:"100%",padding:"8px 10px",backgroundColor:"transparent",border:"none",borderRadius:"6px",color:r.text,cursor:"pointer",fontSize:"12px",textAlign:"left"},children:D.label},D.id)):i.jsx("div",{style:{padding:"20px 12px",textAlign:"center",color:r.textMuted,fontSize:"11px"},children:" Select category"})})]})})]})]})},se=()=>i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 0"},children:[i.jsx("div",{style:{height:"14px",width:"2px",backgroundColor:r.borderLight}}),i.jsx("button",{onClick:()=>p(d==="OR"?"AND":"OR"),style:{margin:"0 -1px",padding:"4px 12px",backgroundColor:d==="OR"?"#7c3aed":"#0891b2",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",fontSize:"10px",fontWeight:"700"},children:d}),i.jsx("div",{style:{height:"14px",width:"2px",backgroundColor:r.borderLight}})]}),X=({group:_,index:S})=>i.jsxs("div",{style:{backgroundColor:r.bg,borderRadius:"10px",border:`2px solid ${_.color}30`,overflow:"hidden"},children:[i.jsxs("div",{style:{padding:"8px 12px",backgroundColor:`${_.color}10`,borderBottom:`1px solid ${_.color}20`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"5px",backgroundColor:_.color,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"700",color:"#fff"},children:S+1}),i.jsx("input",{type:"text",value:_.name,onChange:E=>I(v.map(M=>M.id===_.id?{...M,name:E.target.value}:M)),style:{background:"none",border:"none",color:r.text,fontSize:"12px",fontWeight:"600",width:"80px"}})]}),v.length>1&&i.jsx("button",{onClick:()=>W(_.id),style:{background:"none",border:"none",color:r.textMuted,cursor:"pointer",fontSize:"16px"},children:""})]}),i.jsxs("div",{style:{padding:"12px"},children:[i.jsxs("div",{style:{marginBottom:"10px"},children:[i.jsxs("div",{style:{fontSize:"10px",fontWeight:"600",color:r.success,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{children:""})," INCLUDE"]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[_.filters.include.map(E=>i.jsx(Q,{filter:E,groupId:_.id,section:"include",color:"#22c55e"},E.id)),i.jsx(K,{groupId:_.id,section:"include",onSelect:E=>Z(_.id,"include",E),buttonColor:"#22c55e"})]})]}),i.jsxs("div",{style:{marginBottom:"10px"},children:[i.jsxs("div",{style:{fontSize:"10px",fontWeight:"600",color:r.danger,marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{children:""})," EXCLUDE"]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[_.filters.exclude.map(E=>i.jsx(Q,{filter:E,groupId:_.id,section:"exclude",color:"#ef4444"},E.id)),i.jsx(K,{groupId:_.id,section:"exclude",onSelect:E=>Z(_.id,"exclude",E),buttonColor:"#ef4444"})]})]}),i.jsxs("div",{children:[i.jsxs("div",{style:{fontSize:"10px",fontWeight:"600",color:"#06b6d4",marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{children:""})," ACTIVITY"]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:[_.filters.activity.map(E=>i.jsx(Q,{filter:E,groupId:_.id,section:"activity",color:"#06b6d4"},E.id)),i.jsx(K,{groupId:_.id,section:"activity",onSelect:E=>Z(_.id,"activity",E),buttonColor:"#06b6d4"})]})]})]})]});return i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 280px",gap:"16px",height:"100%"},children:[i.jsxs("div",{style:{overflowY:"auto",paddingRight:"8px"},children:[i.jsx("div",{style:{display:"flex",gap:"4px",marginBottom:"16px",backgroundColor:r.bgHover,padding:"3px",borderRadius:"8px",width:"fit-content"},children:[{id:"simple",label:"Guided",icon:""},{id:"advanced",label:"Advanced",icon:""}].map(_=>i.jsxs("button",{onClick:()=>l(_.id),style:{padding:"6px 12px",borderRadius:"6px",border:"none",cursor:"pointer",fontSize:"11px",fontWeight:"500",backgroundColor:s===_.id?"#3b82f6":"transparent",color:s===_.id?"#fff":"#71717a",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{children:_.icon})," ",_.label]},_.id))}),s==="simple"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px",padding:"8px 12px",backgroundColor:r.bgHover,borderRadius:"8px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"12px",color:r.textSecondary},children:"Filter Groups"}),v.length>1&&i.jsxs("span",{style:{padding:"2px 6px",backgroundColor:d==="OR"?"#7c3aed25":"#0891b225",borderRadius:"4px",fontSize:"9px",fontWeight:"600",color:d==="OR"?"#a78bfa":"#22d3ee"},children:[v.length," groups  ",d]})]}),i.jsx("button",{onClick:C,style:{padding:"4px 8px",backgroundColor:r.primary,border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer",fontSize:"10px",fontWeight:"500"},children:"+ Add Group"})]}),v.map((_,S)=>i.jsxs(Ne.Fragment,{children:[i.jsx(X,{group:_,index:S}),S<v.length-1&&i.jsx(se,{})]},_.id)),i.jsxs("div",{style:{marginTop:"16px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"8px"},children:[i.jsx("span",{style:{fontSize:"11px",color:r.primary},children:""}),i.jsx("span",{style:{fontSize:"12px",fontWeight:"600",color:r.text},children:"Timing"})]}),i.jsx("div",{style:{padding:"12px",backgroundColor:"rgba(59, 130, 246, 0.08)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[i.jsx("span",{style:{fontSize:"12px",color:r.textSecondary},children:"When"}),i.jsxs("select",{style:{backgroundColor:r.bgHover,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"6px 8px",color:r.text,fontSize:"11px"},children:[i.jsx("option",{children:"Days until expiration"}),i.jsx("option",{children:"Days since effective"}),i.jsx("option",{children:"Days since status change"})]}),i.jsx("span",{style:{fontSize:"12px",color:r.textSecondary},children:"is between"}),i.jsx("input",{type:"number",defaultValue:T.min,style:{backgroundColor:r.bgHover,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"6px",color:r.text,fontSize:"11px",width:"45px",textAlign:"center"}}),i.jsx("span",{style:{fontSize:"12px",color:r.textSecondary},children:"and"}),i.jsx("input",{type:"number",defaultValue:T.max,style:{backgroundColor:r.bgHover,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"6px",color:r.text,fontSize:"11px",width:"45px",textAlign:"center"}}),i.jsx("span",{style:{fontSize:"12px",color:r.textSecondary},children:"days"})]})})]})]}),s==="advanced"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px",padding:"8px 12px",backgroundColor:r.bgHover,borderRadius:"8px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"12px",color:r.textSecondary},children:"Rule Groups"}),i.jsx("button",{onClick:()=>p(d==="OR"?"AND":"OR"),style:{padding:"3px 8px",backgroundColor:d==="OR"?"#7c3aed":"#0891b2",border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer",fontSize:"9px",fontWeight:"700"},children:d}),i.jsx("span",{style:{fontSize:"10px",color:r.textMuted},children:"between groups"})]}),i.jsx("button",{onClick:C,style:{padding:"4px 8px",backgroundColor:r.primary,border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer",fontSize:"10px",fontWeight:"500"},children:"+ Add Group"})]}),v.map((_,S)=>i.jsxs(Ne.Fragment,{children:[i.jsxs("div",{style:{backgroundColor:r.bg,borderRadius:"10px",border:`2px solid ${_.color}30`,marginBottom:S<v.length-1?"0":"16px",overflow:"hidden"},children:[i.jsxs("div",{style:{padding:"8px 12px",backgroundColor:`${_.color}10`,borderBottom:`1px solid ${_.color}20`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"4px",backgroundColor:_.color,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"700",color:"#fff"},children:S+1}),i.jsx("input",{type:"text",value:_.name,onChange:E=>I(v.map(M=>M.id===_.id?{...M,name:E.target.value}:M)),style:{background:"none",border:"none",color:r.text,fontSize:"12px",fontWeight:"600",width:"80px"}})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{style:{fontSize:"10px",color:r.textMuted},children:"Logic:"}),i.jsxs("select",{value:_.logic,onChange:E=>I(v.map(M=>M.id===_.id?{...M,logic:E.target.value}:M)),style:{backgroundColor:r.bgHover,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"3px 6px",color:r.text,fontSize:"10px"},children:[i.jsx("option",{value:"AND",children:"AND"}),i.jsx("option",{value:"OR",children:"OR"})]}),v.length>1&&i.jsx("button",{onClick:()=>W(_.id),style:{background:"none",border:"none",color:r.textMuted,cursor:"pointer",fontSize:"14px"},children:""})]})]}),i.jsxs("div",{style:{padding:"10px"},children:[[..._.filters.include,..._.filters.exclude].map((E,M)=>i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"8px 10px",backgroundColor:r.bgHover,borderRadius:"6px",marginBottom:"6px"},children:[i.jsxs("span",{style:{fontSize:"10px",color:r.textMuted,width:"16px",fontFamily:"monospace"},children:[M+1,"."]}),i.jsxs("select",{style:{backgroundColor:r.bgCard,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:r.textSecondary,fontSize:"10px",width:"80px"},children:[i.jsx("option",{children:"Field"}),i.jsx("option",{children:"Relationship"})]}),i.jsxs("select",{style:{backgroundColor:r.bgCard,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:r.text,fontSize:"10px",width:"70px"},children:[i.jsx("option",{children:"Policy"}),i.jsx("option",{children:"Account"}),i.jsx("option",{children:"Contact"})]}),i.jsx("span",{style:{color:r.borderLight,fontSize:"10px"},children:"."}),i.jsxs("select",{style:{backgroundColor:r.bgCard,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:r.text,fontSize:"10px",flex:1},children:[i.jsx("option",{children:"Type"}),i.jsx("option",{children:"Status"}),i.jsx("option",{children:"Premium"}),i.jsx("option",{children:"Effective Date"}),i.jsx("option",{children:"Expiration Date"})]}),i.jsxs("select",{style:{backgroundColor:r.bgCard,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:_.filters.exclude.find($=>$.id===E.id)?"#f87171":"#4ade80",fontSize:"10px",width:"80px"},children:[i.jsx("option",{children:"equals"}),i.jsx("option",{children:"not equals"}),i.jsx("option",{children:"contains"}),i.jsx("option",{children:"is empty"}),i.jsx("option",{children:"is not empty"})]}),i.jsx("input",{type:"text",defaultValue:E.value||"",placeholder:"value",style:{backgroundColor:r.bgCard,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"5px 8px",color:r.text,fontSize:"10px",width:"70px"}}),i.jsx("button",{onClick:()=>{const $=_.filters.include.find(U=>U.id===E.id)?"include":"exclude";z(_.id,$,E.id)},style:{background:"none",border:"none",color:r.textMuted,cursor:"pointer",fontSize:"12px"},children:""})]},E.id)),i.jsx("button",{onClick:()=>Z(_.id,"include",{label:"New Rule",value:"",icon:""}),style:{width:"100%",padding:"8px",backgroundColor:"transparent",border:`1px dashed ${r.borderLight}`,borderRadius:"6px",color:r.textMuted,cursor:"pointer",fontSize:"10px"},children:"+ Add Rule"})]})]}),S<v.length-1&&i.jsx(se,{})]},_.id)),i.jsxs("div",{style:{padding:"12px",backgroundColor:"rgba(59, 130, 246, 0.08)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)"},children:[i.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:r.primary,marginBottom:"8px"},children:" Timing Window"}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[i.jsxs("select",{style:{backgroundColor:r.bgHover,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"6px 8px",color:r.text,fontSize:"10px"},children:[i.jsx("option",{children:"Policy.ExpirationDate"}),i.jsx("option",{children:"Policy.EffectiveDate"}),i.jsx("option",{children:"Account.StatusChangeDate"}),i.jsx("option",{children:"EmailActivity.LastSentDate"})]}),i.jsxs("select",{style:{backgroundColor:r.bgHover,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"6px 8px",color:r.text,fontSize:"10px"},children:[i.jsx("option",{children:"days from now between"}),i.jsx("option",{children:"days ago between"})]}),i.jsx("input",{type:"number",defaultValue:"45",style:{backgroundColor:r.bgHover,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"6px",color:r.text,fontSize:"10px",width:"40px",textAlign:"center"}}),i.jsx("span",{style:{color:r.textMuted,fontSize:"10px"},children:"AND"}),i.jsx("input",{type:"number",defaultValue:"60",style:{backgroundColor:r.bgHover,border:`1px solid ${r.borderLight}`,borderRadius:"4px",padding:"6px",color:r.text,fontSize:"10px",width:"40px",textAlign:"center"}})]})]})]})]}),i.jsxs("div",{style:{backgroundColor:r.bg,borderRadius:"10px",padding:"14px",display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:r.textMuted,textTransform:"uppercase",marginBottom:"10px"},children:"Audience Preview"}),i.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"6px",marginBottom:"12px"},children:[i.jsx("span",{style:{fontSize:"32px",fontWeight:"700",color:r.primary,fontFamily:"monospace",lineHeight:1},children:"1,247"}),i.jsx("span",{style:{color:r.textMuted,fontSize:"12px"},children:"match"})]}),i.jsxs("div",{style:{display:"flex",gap:"6px",marginBottom:"12px"},children:[i.jsxs("div",{style:{flex:1,padding:"8px",backgroundColor:r.bgHover,borderRadius:"6px",textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:r.success},children:"2,847"}),i.jsx("div",{style:{fontSize:"9px",color:r.textMuted},children:"Included"})]}),i.jsxs("div",{style:{flex:1,padding:"8px",backgroundColor:r.bgHover,borderRadius:"6px",textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:r.danger},children:"1,600"}),i.jsx("div",{style:{fontSize:"9px",color:r.textMuted},children:"Excluded"})]})]}),v.length>1&&i.jsxs("div",{style:{marginBottom:"10px"},children:[i.jsx("div",{style:{fontSize:"9px",color:r.textMuted,marginBottom:"4px"},children:"By group:"}),v.map((_,S)=>i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px 6px",backgroundColor:r.bgHover,borderRadius:"4px",marginBottom:"3px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("div",{style:{width:"14px",height:"14px",borderRadius:"3px",backgroundColor:_.color,fontSize:"8px",fontWeight:"700",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},children:S+1}),i.jsx("span",{style:{fontSize:"10px",color:r.textSecondary},children:_.name})]}),i.jsx("span",{style:{fontSize:"11px",fontWeight:"600",color:_.color},children:S===0?"847":"523"})]},_.id))]})]}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:r.textMuted,textTransform:"uppercase",marginBottom:"8px"},children:" Test with Account"}),i.jsxs("div",{style:{position:"relative",marginBottom:"10px"},children:[i.jsx("input",{type:"text",placeholder:"Search accounts...",value:u,onChange:_=>g(_.target.value),style:{width:"100%",padding:"8px 10px",paddingRight:"30px",backgroundColor:r.bgHover,border:`1px solid ${r.borderLight}`,borderRadius:"6px",color:r.text,fontSize:"11px"}}),i.jsx("span",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:r.textMuted,fontSize:"12px"},children:""})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:P.map(_=>i.jsxs("div",{onClick:()=>f(m===_.id?null:_.id),style:{padding:"8px 10px",backgroundColor:_.passes?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",border:`1px solid ${_.passes?"rgba(34, 197, 94, 0.2)":"rgba(239, 68, 68, 0.2)"}`,borderRadius:"6px",cursor:"pointer"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:r.text},children:_.name}),i.jsx("div",{style:{fontSize:"9px",color:r.textMuted},children:_.policies})]}),i.jsx("div",{style:{padding:"3px 8px",backgroundColor:_.passes?"#22c55e":"#ef4444",borderRadius:"4px",fontSize:"9px",fontWeight:"600",color:"#fff"},children:_.passes?" Pass":" Fail"})]}),m===_.id&&i.jsxs("div",{style:{marginTop:"10px",paddingTop:"10px",borderTop:"1px solid rgba(255,255,255,0.1)"},children:[i.jsx("div",{style:{fontSize:"9px",fontWeight:"600",color:r.textMuted,marginBottom:"6px"},children:"CONDITION RESULTS"}),_.conditions.map((S,E)=>i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"6px",marginBottom:"4px",padding:"4px 6px",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"4px"},children:[i.jsx("span",{style:{fontSize:"10px",color:S.passes?"#22c55e":"#ef4444",flexShrink:0},children:S.passes?"":""}),i.jsxs("div",{style:{flex:1},children:[i.jsx("div",{style:{fontSize:"10px",color:r.text},children:S.label}),!S.passes&&S.reason&&i.jsx("div",{style:{fontSize:"9px",color:r.danger,marginTop:"2px"},children:S.reason}),S.value&&i.jsxs("div",{style:{fontSize:"9px",color:r.textMuted,marginTop:"2px"},children:["Actual: ",S.value]})]})]},E)),v.length>1&&i.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.05)"},children:[i.jsx("div",{style:{fontSize:"9px",color:r.textMuted,marginBottom:"4px"},children:"GROUP RESULTS"}),i.jsx("div",{style:{display:"flex",gap:"4px"},children:_.groupResults.map((S,E)=>{var M;return i.jsxs("div",{style:{flex:1,padding:"4px",backgroundColor:S.passes?"rgba(34, 197, 94, 0.15)":"rgba(239, 68, 68, 0.15)",borderRadius:"4px",textAlign:"center"},children:[i.jsxs("div",{style:{fontSize:"9px",fontWeight:"600",color:((M=v[E])==null?void 0:M.color)||"#71717a"},children:["G",E+1]}),i.jsx("div",{style:{fontSize:"10px",color:S.passes?"#22c55e":"#ef4444"},children:S.passes?"":""})]},E)})}),i.jsx("div",{style:{fontSize:"9px",color:r.textMuted,textAlign:"center",marginTop:"4px"},children:d==="OR"?"Needs 1 group to pass":"Needs all groups to pass"})]})]})]},_.id))}),i.jsx("button",{style:{width:"100%",marginTop:"8px",padding:"6px",backgroundColor:"transparent",border:`1px dashed ${r.borderLight}`,borderRadius:"6px",color:r.textMuted,cursor:"pointer",fontSize:"10px"},children:"View all matching records "})]}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:r.textMuted,textTransform:"uppercase",marginBottom:"8px"},children:"Summary"}),i.jsx("div",{style:{fontSize:"10px",color:r.textSecondary,lineHeight:"1.6"},children:v.map((_,S)=>i.jsxs(Ne.Fragment,{children:[i.jsxs("div",{style:{padding:"6px",backgroundColor:`${_.color}10`,borderRadius:"4px",border:`1px solid ${_.color}20`,marginBottom:(S<v.length-1,"0")},children:[i.jsx("div",{style:{fontWeight:"600",color:_.color,marginBottom:"2px",fontSize:"9px"},children:_.name}),i.jsxs("div",{style:{color:r.text,fontSize:"10px"},children:[_.filters.include.map(E=>`${E.label}: ${E.value||""}`).join(" + "),_.filters.exclude.length>0&&i.jsxs("span",{style:{color:r.danger},children:[" "," ",_.filters.exclude.map(E=>`${E.value||E.label}`).join(", ")]})]})]}),S<v.length-1&&i.jsx("div",{style:{textAlign:"center",padding:"3px 0",fontWeight:"700",fontSize:"9px",color:d==="OR"?"#a78bfa":"#22d3ee"},children:d})]},_.id))})]})]})]})},sa=[{id:"entry-criteria",type:"entry_criteria",title:"Entry Criteria",subtitle:"Define who enters this automation",config:{filterConfig:{}}},{id:"trigger",type:"trigger",title:"Trigger",subtitle:"Daily at 09:00 (Central)",config:{time:"09:00",timezone:"America/Chicago",frequency:"Daily"}},{id:"node-1",type:"send_email",title:"Send Email",subtitle:"Select template...",config:{template:""}}],aa=({t:n,automation:r,onUpdate:s,onSave:l})=>{var z,N,Q,K,se,X,_,S,E;const d=n||Co,p=r!=null&&r.nodes&&r.nodes.length>0?r.nodes:sa,[u,g]=O.useState(p),[m,f]=O.useState(null),[P,v]=O.useState(null),[I,T]=O.useState(!1),w={entry_criteria:{icon:"",color:"#8b5cf6",label:"Entry Criteria"},trigger:{icon:"",color:d.primary,label:"Trigger"},send_email:{icon:"",color:d.success,label:"Send Email"},delay:{icon:"",color:d.warning,label:"Delay"},condition:{icon:"",color:d.purple,label:"Condition"},field_condition:{icon:"",color:"#ec4899",label:"Field Check"},update_field:{icon:"",color:"#06b6d4",label:"Update Field"},end:{icon:"",color:d.textMuted,label:"End"}},k=[{type:"send_email",label:"Send Email",desc:"Send an email template",icon:""},{type:"delay",label:"Delay",desc:"Wait before continuing",icon:""},{type:"condition",label:"Email Engagement",desc:"Branch on open/click",icon:""},{type:"field_condition",label:"Field Condition",desc:"Branch on field value",icon:""},{type:"update_field",label:"Update Field",desc:"Update a record field",icon:""},{type:"end",label:"End",desc:"Stop automation",icon:""}],R=(M,$,U=null)=>{var H;const te={id:`node-${Date.now()}`,type:$,title:((H=k.find(Se=>Se.type===$))==null?void 0:H.label)||$,subtitle:"Configure...",config:{}};if(($==="condition"||$==="field_condition")&&(te.branches={yes:[],no:[]}),U)g(Se=>{const D=ne=>ne.map(ae=>ae.id===M&&ae.branches?{...ae,branches:{...ae.branches,[U]:[...ae.branches[U],te]}}:ae.branches?{...ae,branches:{yes:D(ae.branches.yes),no:D(ae.branches.no)}}:ae);return D(Se)});else{const Se=u.findIndex(ne=>ne.id===M),D=[...u];D.splice(Se+1,0,te),g(D)}v(null),f(te.id)},C=M=>{g($=>$.filter(U=>U.id!==M&&U.id!=="trigger"&&U.id!=="entry-criteria")),m===M&&f(null)},W=({node:M})=>{const $=w[M.type]||w.send_email,U=m===M.id,te=M.type==="entry_criteria",H=M.type==="trigger",Se=te||H;return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[i.jsxs("div",{onClick:()=>{f(M.id),te&&T(!0)},style:{width:"320px",backgroundColor:d.bgCard,border:U?`2px solid ${$.color}`:`1px solid ${d.border}`,borderRadius:"12px",padding:"16px 18px",cursor:"pointer",position:"relative"},children:[!Se&&i.jsx("button",{onClick:D=>{D.stopPropagation(),C(M.id)},style:{position:"absolute",top:"8px",right:"8px",background:"none",border:"none",color:d.textMuted,cursor:"pointer",fontSize:"16px"},children:""}),i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${$.color}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:$.icon}),i.jsxs("div",{style:{flex:1},children:[i.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:d.text},children:M.title}),i.jsx("div",{style:{fontSize:"12px",color:d.textMuted,marginTop:"2px"},children:M.subtitle})]})]}),te&&i.jsxs("button",{onClick:D=>{D.stopPropagation(),T(!0)},style:{marginTop:"12px",width:"100%",padding:"10px",backgroundColor:d.bgHover,border:`1px solid ${d.borderLight}`,borderRadius:"8px",color:d.textSecondary,cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[i.jsx("span",{children:""})," Edit Entry Criteria"]})]}),!M.branches&&i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[i.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.borderLight}}),i.jsx("button",{onClick:()=>v({afterNodeId:M.id,branch:null}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:d.bgHover,border:`1px solid ${d.borderLight}`,color:d.textMuted,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"}),i.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.borderLight}}),(P==null?void 0:P.afterNodeId)===M.id&&!(P!=null&&P.branch)&&i.jsx(Z,{onSelect:D=>R(M.id,D),onClose:()=>v(null)})]}),M.branches&&i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[i.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.borderLight}}),i.jsxs("div",{style:{display:"flex"},children:[i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:d.success}}),i.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#22c55e20",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:d.success},children:"YES"})]}),i.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.success}}),M.branches.yes.map(D=>i.jsx(W,{node:D},D.id)),i.jsx("button",{onClick:()=>v({afterNodeId:M.id,branch:"yes"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:d.bgHover,border:"1px dashed #22c55e",color:d.success,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(P==null?void 0:P.afterNodeId)===M.id&&(P==null?void 0:P.branch)==="yes"&&i.jsx(Z,{onSelect:D=>R(M.id,D,"yes"),onClose:()=>v(null)})]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"340px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#ef444420",borderRadius:"12px",fontSize:"10px",fontWeight:"600",color:d.danger},children:"NO"}),i.jsx("div",{style:{width:"60px",height:"2px",backgroundColor:d.danger}})]}),i.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:d.danger}}),M.branches.no.map(D=>i.jsx(W,{node:D},D.id)),i.jsx("button",{onClick:()=>v({afterNodeId:M.id,branch:"no"}),style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:d.bgHover,border:"1px dashed #ef4444",color:d.danger,cursor:"pointer",fontSize:"14px",marginTop:"10px"},children:"+"}),(P==null?void 0:P.afterNodeId)===M.id&&(P==null?void 0:P.branch)==="no"&&i.jsx(Z,{onSelect:D=>R(M.id,D,"no"),onClose:()=>v(null)})]})]})]})]})},Z=({onSelect:M,onClose:$})=>i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:$}),i.jsx("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"10px",backgroundColor:d.bgCard,border:`1px solid ${d.borderLight}`,borderRadius:"12px",padding:"8px",zIndex:100,width:"240px",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},children:k.map(U=>i.jsxs("button",{onClick:()=>M(U.type),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px",color:d.text,textAlign:"left"},children:[i.jsx("span",{style:{fontSize:"18px"},children:U.icon}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500"},children:U.label}),i.jsx("div",{style:{fontSize:"11px",color:d.textMuted},children:U.desc})]})]},U.type))})]}),B=u.find(M=>M.id===m)||u.flatMap(M=>M.branches?[...M.branches.yes||[],...M.branches.no||[]]:[]).find(M=>M.id===m);return i.jsxs("div",{style:{fontFamily:"'IBM Plex Sans', -apple-system, sans-serif",backgroundColor:d.bg,height:"100%",color:d.text,display:"flex"},children:[i.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[i.jsxs("div",{style:{width:"220px",borderRight:`1px solid ${d.border}`,padding:"16px",backgroundColor:d.bgCard,overflowY:"auto"},children:[i.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:d.textMuted,marginBottom:"12px",textTransform:"uppercase"},children:"Add Nodes"}),k.map(M=>i.jsxs("div",{style:{padding:"12px",backgroundColor:d.bgHover,borderRadius:"8px",marginBottom:"8px",cursor:"grab",display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx("span",{style:{fontSize:"18px"},children:M.icon}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:d.text},children:M.label}),i.jsx("div",{style:{fontSize:"11px",color:d.textMuted},children:M.desc})]})]},M.type))]}),i.jsx("div",{style:{flex:1,padding:"40px",overflowY:"auto",display:"flex",justifyContent:"center"},children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[u.map(M=>i.jsx(W,{node:M},M.id)),i.jsx("div",{style:{marginTop:"16px",padding:"8px 18px",backgroundColor:d.bgHover,borderRadius:"20px",fontSize:"12px",color:d.textMuted},children:"End of automation"})]})}),i.jsxs("div",{style:{width:"300px",borderLeft:`1px solid ${d.border}`,backgroundColor:d.bgCard,overflowY:"auto"},children:[i.jsx("div",{style:{padding:"14px 18px",borderBottom:`1px solid ${d.border}`,fontSize:"11px",fontWeight:"600",color:d.textMuted,textTransform:"uppercase"},children:"Configuration"}),i.jsx("div",{style:{padding:"18px"},children:B?i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${((z=w[B.type])==null?void 0:z.color)||d.primary}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px"},children:((N=w[B.type])==null?void 0:N.icon)||""}),i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:"600",color:d.text,fontSize:"15px"},children:B.title}),i.jsx("div",{style:{fontSize:"12px",color:d.textMuted},children:((Q=w[B.type])==null?void 0:Q.label)||"Node"})]})]}),B.type==="entry_criteria"&&i.jsxs("div",{children:[i.jsx("p",{style:{fontSize:"13px",color:d.textSecondary,marginBottom:"16px"},children:"Define which contacts enter this automation based on their attributes and behavior."}),i.jsx("button",{onClick:()=>T(!0),style:{width:"100%",padding:"12px",backgroundColor:d.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:"Edit Entry Criteria"})]}),B.type==="trigger"&&i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Run Time"}),i.jsx("input",{type:"time",defaultValue:((K=B.config)==null?void 0:K.time)||"09:00",style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px",marginBottom:"16px"}}),i.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Frequency"}),i.jsxs("select",{defaultValue:((se=B.config)==null?void 0:se.frequency)||"Daily",style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"},children:[i.jsx("option",{children:"Daily"}),i.jsx("option",{children:"Weekly"}),i.jsx("option",{children:"Monthly"})]})]}),B.type==="send_email"&&i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Email Template"}),i.jsxs("select",{defaultValue:((X=B.config)==null?void 0:X.template)||"",style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"},children:[i.jsx("option",{value:"",children:"Select template..."}),i.jsx("option",{children:"Welcome Email"}),i.jsx("option",{children:"Cross-Sell Introduction"}),i.jsx("option",{children:"Renewal Reminder"}),i.jsx("option",{children:"Follow-Up"}),i.jsx("option",{children:"Re-engagement"})]})]}),B.type==="delay"&&i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Wait Duration"}),i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx("input",{type:"number",defaultValue:((_=B.config)==null?void 0:_.duration)||1,min:"1",style:{flex:1,padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"}}),i.jsxs("select",{defaultValue:((S=B.config)==null?void 0:S.unit)||"days",style:{flex:1,padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"},children:[i.jsx("option",{value:"hours",children:"Hours"}),i.jsx("option",{value:"days",children:"Days"}),i.jsx("option",{value:"weeks",children:"Weeks"})]})]})]}),(B.type==="condition"||B.type==="field_condition")&&i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"12px",color:d.textSecondary,marginBottom:"6px"},children:"Condition Type"}),i.jsxs("select",{defaultValue:((E=B.config)==null?void 0:E.type)||"email_opened",style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgHover,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"},children:[i.jsx("option",{value:"email_opened",children:"Email Opened"}),i.jsx("option",{value:"email_clicked",children:"Email Clicked"}),i.jsx("option",{value:"field_value",children:"Field Value"})]})]}),B.type==="end"&&i.jsx("p",{style:{fontSize:"13px",color:d.textSecondary},children:"This node ends the automation flow. Contacts reaching this point will exit the automation."})]}):i.jsxs("div",{style:{textAlign:"center",color:d.textMuted,padding:"30px 0"},children:[i.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:""}),i.jsx("div",{style:{fontSize:"13px"},children:"Select a node to configure"})]})})]})]}),I&&i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.7)",zIndex:200},onClick:()=>T(!1)}),i.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"1000px",height:"80vh",backgroundColor:d.bgCard,borderRadius:"16px",border:`1px solid ${d.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[i.jsxs("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${d.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[i.jsx("h2",{style:{fontSize:"15px",fontWeight:"600",color:d.text,margin:0},children:"Audience Criteria"}),i.jsx("button",{onClick:()=>T(!1),style:{background:"none",border:"none",color:d.textMuted,cursor:"pointer",fontSize:"18px"},children:""})]}),i.jsx("div",{style:{flex:1,padding:"20px",overflow:"hidden"},children:i.jsx(ra,{onClose:()=>T(!1),t:d})}),i.jsxs("div",{style:{padding:"12px 20px",borderTop:`1px solid ${d.border}`,display:"flex",justifyContent:"flex-end",gap:"8px",flexShrink:0},children:[i.jsx("button",{onClick:()=>T(!1),style:{padding:"8px 16px",backgroundColor:d.bgHover,border:`1px solid ${d.borderLight}`,borderRadius:"6px",color:d.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Cancel"}),i.jsx("button",{onClick:()=>T(!1),style:{padding:"8px 16px",backgroundColor:d.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"12px",fontWeight:"500"},children:"Save Criteria"})]})]})]})]})},co=({t:n})=>{var W,Z;const{userId:r,automationId:s}=_e(),l=ut(),d=po(),p=!s||s==="new";(W=d.state)!=null&&W.templateName||((Z=d.state)==null||Z.templateId);const{data:u,isLoading:g,error:m}=ms(p?null:s),{createAutomation:f,updateAutomation:P,activateAutomation:v,pauseAutomation:I}=mo(),T=async()=>{if(p)return;const B=w.status==="active",z=B?"paused":"active";try{B?await I.mutateAsync(s):await v.mutateAsync(s),k(N=>({...N,status:z}))}catch(N){console.error("Failed to toggle status:",N)}},[w,k]=O.useState({name:"",description:"",category:"general",status:"draft",send_time:"10:00",timezone:"America/Chicago",frequency:"Daily",filter_config:{},nodes:[]});O.useEffect(()=>{u&&k({name:u.name||"",description:u.description||"",category:u.category||"general",status:u.status||"draft",send_time:u.send_time||"10:00",timezone:u.timezone||"America/Chicago",frequency:u.frequency||"Daily",filter_config:u.filter_config||{},nodes:u.nodes||[]})},[u]);const R=async B=>{try{if(p){const z=await f.mutateAsync(B);l(`/${r}/automations/${z.id}`,{replace:!0})}else await P.mutateAsync({automationId:s,updates:B})}catch(z){console.error("Failed to save automation:",z),alert("Failed to save automation. Please try again.")}},C=()=>{l(`/${r}/automations`)};return!p&&g?i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[i.jsx("div",{style:{fontSize:"32px"},children:""}),i.jsx("div",{style:{color:(n==null?void 0:n.textSecondary)||"#a1a1aa"},children:"Loading automation..."})]}):m?i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 100px)",gap:"16px"},children:[i.jsx("div",{style:{fontSize:"48px"},children:""}),i.jsx("h2",{style:{color:(n==null?void 0:n.text)||"#fafafa",margin:0},children:"Automation Not Found"}),i.jsx("p",{style:{color:(n==null?void 0:n.textSecondary)||"#a1a1aa"},children:"We couldn't find the automation you're looking for."}),i.jsx("button",{onClick:C,style:{padding:"10px 20px",backgroundColor:(n==null?void 0:n.primary)||"#3b82f6",border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px"},children:"Back to Automations"})]}):i.jsxs("div",{style:{margin:"-24px",height:"calc(100vh - 49px)",display:"flex",flexDirection:"column"},children:[i.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${(n==null?void 0:n.border)||"#27272a"}`,display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:(n==null?void 0:n.bgCard)||"#18181b",flexShrink:0},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("button",{onClick:C,style:{background:"none",border:"none",color:(n==null?void 0:n.textSecondary)||"#a1a1aa",cursor:"pointer",fontSize:"20px",padding:"4px 8px",display:"flex",alignItems:"center"},children:""}),i.jsx("h1",{style:{fontSize:"16px",fontWeight:"600",color:(n==null?void 0:n.text)||"#fafafa",margin:0},children:p?"Create Automation":`Edit: ${(u==null?void 0:u.name)||"Automation"}`})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[!p&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"13px",color:(n==null?void 0:n.textSecondary)||"#a1a1aa"},children:w.status==="active"?"Active":"Inactive"}),i.jsx("button",{onClick:T,disabled:v.isPending||I.isPending,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",backgroundColor:w.status==="active"?(n==null?void 0:n.success)||"#22c55e":(n==null?void 0:n.bgHover)||"#27272a",cursor:"pointer",position:"relative",transition:"background-color 0.2s",opacity:v.isPending||I.isPending?.6:1},children:i.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",backgroundColor:"#fff",position:"absolute",top:"3px",left:w.status==="active"?"23px":"3px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none"}})})]}),i.jsx("button",{onClick:()=>R(w),disabled:f.isPending||P.isPending,style:{padding:"8px 16px",backgroundColor:(n==null?void 0:n.primary)||"#3b82f6",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",opacity:f.isPending||P.isPending?.7:1},children:f.isPending||P.isPending?"Saving...":p?"Create":"Save Changes"})]})]}),i.jsx("div",{style:{flex:1,overflow:"hidden"},children:i.jsx(aa,{t:n,automation:w,onUpdate:k,onSave:R})})]})};function la(n,r){const s=O.useRef(r);O.useEffect(function(){r!==s.current&&n.attributionControl!=null&&(s.current!=null&&n.attributionControl.removeAttribution(s.current),r!=null&&n.attributionControl.addAttribution(r)),s.current=r},[n,r])}function da(n,r,s){r.center!==s.center&&n.setLatLng(r.center),r.radius!=null&&r.radius!==s.radius&&n.setRadius(r.radius)}const ca=1;function ua(n){return Object.freeze({__version:ca,map:n})}function ko(n,r){return Object.freeze({...n,...r})}const zo=O.createContext(null),To=zo.Provider;function Hi(){const n=O.useContext(zo);if(n==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return n}function Po(n){function r(s,l){const{instance:d,context:p}=n(s).current;return O.useImperativeHandle(l,()=>d),s.children==null?null:Ne.createElement(To,{value:p},s.children)}return O.forwardRef(r)}function pa(n){function r(s,l){const{instance:d}=n(s).current;return O.useImperativeHandle(l,()=>d),null}return O.forwardRef(r)}function Lo(n,r){const s=O.useRef();O.useEffect(function(){return r!=null&&n.instance.on(r),s.current=r,function(){s.current!=null&&n.instance.off(s.current),s.current=null}},[n,r])}function Ui(n,r){const s=n.pane??r.pane;return s?{...n,pane:s}:n}var Ni={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(n,r){(function(s,l){l(r)})(ss,function(s){var l="1.9.4";function d(e){var t,o,a,c;for(o=1,a=arguments.length;o<a;o++){c=arguments[o];for(t in c)e[t]=c[t]}return e}var p=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}();function u(e,t){var o=Array.prototype.slice;if(e.bind)return e.bind.apply(e,o.call(arguments,1));var a=o.call(arguments,2);return function(){return e.apply(t,a.length?a.concat(o.call(arguments)):arguments)}}var g=0;function m(e){return"_leaflet_id"in e||(e._leaflet_id=++g),e._leaflet_id}function f(e,t,o){var a,c,h,x;return x=function(){a=!1,c&&(h.apply(o,c),c=!1)},h=function(){a?c=arguments:(e.apply(o,arguments),setTimeout(x,t),a=!0)},h}function P(e,t,o){var a=t[1],c=t[0],h=a-c;return e===a&&o?e:((e-c)%h+h)%h+c}function v(){return!1}function I(e,t){if(t===!1)return e;var o=Math.pow(10,t===void 0?6:t);return Math.round(e*o)/o}function T(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function w(e){return T(e).split(/\s+/)}function k(e,t){Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?p(e.options):{});for(var o in t)e.options[o]=t[o];return e.options}function R(e,t,o){var a=[];for(var c in e)a.push(encodeURIComponent(o?c.toUpperCase():c)+"="+encodeURIComponent(e[c]));return(!t||t.indexOf("?")===-1?"?":"&")+a.join("&")}var C=/\{ *([\w_ -]+) *\}/g;function W(e,t){return e.replace(C,function(o,a){var c=t[a];if(c===void 0)throw new Error("No value provided for variable "+o);return typeof c=="function"&&(c=c(t)),c})}var Z=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function B(e,t){for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1}var z="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function N(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var Q=0;function K(e){var t=+new Date,o=Math.max(0,16-(t-Q));return Q=t+o,window.setTimeout(e,o)}var se=window.requestAnimationFrame||N("RequestAnimationFrame")||K,X=window.cancelAnimationFrame||N("CancelAnimationFrame")||N("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function _(e,t,o){if(o&&se===K)e.call(t);else return se.call(window,u(e,t))}function S(e){e&&X.call(window,e)}var E={__proto__:null,extend:d,create:p,bind:u,get lastId(){return g},stamp:m,throttle:f,wrapNum:P,falseFn:v,formatNum:I,trim:T,splitWords:w,setOptions:k,getParamString:R,template:W,isArray:Z,indexOf:B,emptyImageUrl:z,requestFn:se,cancelFn:X,requestAnimFrame:_,cancelAnimFrame:S};function M(){}M.extend=function(e){var t=function(){k(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},o=t.__super__=this.prototype,a=p(o);a.constructor=t,t.prototype=a;for(var c in this)Object.prototype.hasOwnProperty.call(this,c)&&c!=="prototype"&&c!=="__super__"&&(t[c]=this[c]);return e.statics&&d(t,e.statics),e.includes&&($(e.includes),d.apply(null,[a].concat(e.includes))),d(a,e),delete a.statics,delete a.includes,a.options&&(a.options=o.options?p(o.options):{},d(a.options,e.options)),a._initHooks=[],a.callInitHooks=function(){if(!this._initHooksCalled){o.callInitHooks&&o.callInitHooks.call(this),this._initHooksCalled=!0;for(var h=0,x=a._initHooks.length;h<x;h++)a._initHooks[h].call(this)}},t},M.include=function(e){var t=this.prototype.options;return d(this.prototype,e),e.options&&(this.prototype.options=t,this.mergeOptions(e.options)),this},M.mergeOptions=function(e){return d(this.prototype.options,e),this},M.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),o=typeof e=="function"?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(o),this};function $(e){if(!(typeof L>"u"||!L||!L.Mixin)){e=Z(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var U={on:function(e,t,o){if(typeof e=="object")for(var a in e)this._on(a,e[a],t);else{e=w(e);for(var c=0,h=e.length;c<h;c++)this._on(e[c],t,o)}return this},off:function(e,t,o){if(!arguments.length)delete this._events;else if(typeof e=="object")for(var a in e)this._off(a,e[a],t);else{e=w(e);for(var c=arguments.length===1,h=0,x=e.length;h<x;h++)c?this._off(e[h]):this._off(e[h],t,o)}return this},_on:function(e,t,o,a){if(typeof t!="function"){console.warn("wrong listener type: "+typeof t);return}if(this._listens(e,t,o)===!1){o===this&&(o=void 0);var c={fn:t,ctx:o};a&&(c.once=!0),this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(c)}},_off:function(e,t,o){var a,c,h;if(this._events&&(a=this._events[e],!!a)){if(arguments.length===1){if(this._firingCount)for(c=0,h=a.length;c<h;c++)a[c].fn=v;delete this._events[e];return}if(typeof t!="function"){console.warn("wrong listener type: "+typeof t);return}var x=this._listens(e,t,o);if(x!==!1){var y=a[x];this._firingCount&&(y.fn=v,this._events[e]=a=a.slice()),a.splice(x,1)}}},fire:function(e,t,o){if(!this.listens(e,o))return this;var a=d({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var c=this._events[e];if(c){this._firingCount=this._firingCount+1||1;for(var h=0,x=c.length;h<x;h++){var y=c[h],b=y.fn;y.once&&this.off(e,b,y.ctx),b.call(y.ctx||this,a)}this._firingCount--}}return o&&this._propagateEvent(a),this},listens:function(e,t,o,a){typeof e!="string"&&console.warn('"string" type argument expected');var c=t;typeof t!="function"&&(a=!!t,c=void 0,o=void 0);var h=this._events&&this._events[e];if(h&&h.length&&this._listens(e,c,o)!==!1)return!0;if(a){for(var x in this._eventParents)if(this._eventParents[x].listens(e,t,o,a))return!0}return!1},_listens:function(e,t,o){if(!this._events)return!1;var a=this._events[e]||[];if(!t)return!!a.length;o===this&&(o=void 0);for(var c=0,h=a.length;c<h;c++)if(a[c].fn===t&&a[c].ctx===o)return c;return!1},once:function(e,t,o){if(typeof e=="object")for(var a in e)this._on(a,e[a],t,!0);else{e=w(e);for(var c=0,h=e.length;c<h;c++)this._on(e[c],t,o,!0)}return this},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[m(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[m(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,d({layer:e.target,propagatedFrom:e.target},e),!0)}};U.addEventListener=U.on,U.removeEventListener=U.clearAllEventListeners=U.off,U.addOneTimeEventListener=U.once,U.fireEvent=U.fire,U.hasEventListeners=U.listens;var te=M.extend(U);function H(e,t,o){this.x=o?Math.round(e):e,this.y=o?Math.round(t):t}var Se=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};H.prototype={clone:function(){return new H(this.x,this.y)},add:function(e){return this.clone()._add(D(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(D(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new H(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new H(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Se(this.x),this.y=Se(this.y),this},distanceTo:function(e){e=D(e);var t=e.x-this.x,o=e.y-this.y;return Math.sqrt(t*t+o*o)},equals:function(e){return e=D(e),e.x===this.x&&e.y===this.y},contains:function(e){return e=D(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+I(this.x)+", "+I(this.y)+")"}};function D(e,t,o){return e instanceof H?e:Z(e)?new H(e[0],e[1]):e==null?e:typeof e=="object"&&"x"in e&&"y"in e?new H(e.x,e.y):new H(e,t,o)}function ne(e,t){if(e)for(var o=t?[e,t]:e,a=0,c=o.length;a<c;a++)this.extend(o[a])}ne.prototype={extend:function(e){var t,o;if(!e)return this;if(e instanceof H||typeof e[0]=="number"||"x"in e)t=o=D(e);else if(e=ae(e),t=e.min,o=e.max,!t||!o)return this;return!this.min&&!this.max?(this.min=t.clone(),this.max=o.clone()):(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(o.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(o.y,this.max.y)),this},getCenter:function(e){return D((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return D(this.min.x,this.max.y)},getTopRight:function(){return D(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,o;return typeof e[0]=="number"||e instanceof H?e=D(e):e=ae(e),e instanceof ne?(t=e.min,o=e.max):t=o=e,t.x>=this.min.x&&o.x<=this.max.x&&t.y>=this.min.y&&o.y<=this.max.y},intersects:function(e){e=ae(e);var t=this.min,o=this.max,a=e.min,c=e.max,h=c.x>=t.x&&a.x<=o.x,x=c.y>=t.y&&a.y<=o.y;return h&&x},overlaps:function(e){e=ae(e);var t=this.min,o=this.max,a=e.min,c=e.max,h=c.x>t.x&&a.x<o.x,x=c.y>t.y&&a.y<o.y;return h&&x},isValid:function(){return!!(this.min&&this.max)},pad:function(e){var t=this.min,o=this.max,a=Math.abs(t.x-o.x)*e,c=Math.abs(t.y-o.y)*e;return ae(D(t.x-a,t.y-c),D(o.x+a,o.y+c))},equals:function(e){return e?(e=ae(e),this.min.equals(e.getTopLeft())&&this.max.equals(e.getBottomRight())):!1}};function ae(e,t){return!e||e instanceof ne?e:new ne(e,t)}function be(e,t){if(e)for(var o=t?[e,t]:e,a=0,c=o.length;a<c;a++)this.extend(o[a])}be.prototype={extend:function(e){var t=this._southWest,o=this._northEast,a,c;if(e instanceof re)a=e,c=e;else if(e instanceof be){if(a=e._southWest,c=e._northEast,!a||!c)return this}else return e?this.extend(ee(e)||pe(e)):this;return!t&&!o?(this._southWest=new re(a.lat,a.lng),this._northEast=new re(c.lat,c.lng)):(t.lat=Math.min(a.lat,t.lat),t.lng=Math.min(a.lng,t.lng),o.lat=Math.max(c.lat,o.lat),o.lng=Math.max(c.lng,o.lng)),this},pad:function(e){var t=this._southWest,o=this._northEast,a=Math.abs(t.lat-o.lat)*e,c=Math.abs(t.lng-o.lng)*e;return new be(new re(t.lat-a,t.lng-c),new re(o.lat+a,o.lng+c))},getCenter:function(){return new re((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new re(this.getNorth(),this.getWest())},getSouthEast:function(){return new re(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){typeof e[0]=="number"||e instanceof re||"lat"in e?e=ee(e):e=pe(e);var t=this._southWest,o=this._northEast,a,c;return e instanceof be?(a=e.getSouthWest(),c=e.getNorthEast()):a=c=e,a.lat>=t.lat&&c.lat<=o.lat&&a.lng>=t.lng&&c.lng<=o.lng},intersects:function(e){e=pe(e);var t=this._southWest,o=this._northEast,a=e.getSouthWest(),c=e.getNorthEast(),h=c.lat>=t.lat&&a.lat<=o.lat,x=c.lng>=t.lng&&a.lng<=o.lng;return h&&x},overlaps:function(e){e=pe(e);var t=this._southWest,o=this._northEast,a=e.getSouthWest(),c=e.getNorthEast(),h=c.lat>t.lat&&a.lat<o.lat,x=c.lng>t.lng&&a.lng<o.lng;return h&&x},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return e?(e=pe(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function pe(e,t){return e instanceof be?e:new be(e,t)}function re(e,t,o){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,o!==void 0&&(this.alt=+o)}re.prototype={equals:function(e,t){if(!e)return!1;e=ee(e);var o=Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng));return o<=(t===void 0?1e-9:t)},toString:function(e){return"LatLng("+I(this.lat,e)+", "+I(this.lng,e)+")"},distanceTo:function(e){return de.distance(this,ee(e))},wrap:function(){return de.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,o=t/Math.cos(Math.PI/180*this.lat);return pe([this.lat-t,this.lng-o],[this.lat+t,this.lng+o])},clone:function(){return new re(this.lat,this.lng,this.alt)}};function ee(e,t,o){return e instanceof re?e:Z(e)&&typeof e[0]!="object"?e.length===3?new re(e[0],e[1],e[2]):e.length===2?new re(e[0],e[1]):null:e==null?e:typeof e=="object"&&"lat"in e?new re(e.lat,"lng"in e?e.lng:e.lon,e.alt):t===void 0?null:new re(e,t,o)}var me={latLngToPoint:function(e,t){var o=this.projection.project(e),a=this.scale(t);return this.transformation._transform(o,a)},pointToLatLng:function(e,t){var o=this.scale(t),a=this.transformation.untransform(e,o);return this.projection.unproject(a)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,o=this.scale(e),a=this.transformation.transform(t.min,o),c=this.transformation.transform(t.max,o);return new ne(a,c)},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?P(e.lng,this.wrapLng,!0):e.lng,o=this.wrapLat?P(e.lat,this.wrapLat,!0):e.lat,a=e.alt;return new re(o,t,a)},wrapLatLngBounds:function(e){var t=e.getCenter(),o=this.wrapLatLng(t),a=t.lat-o.lat,c=t.lng-o.lng;if(a===0&&c===0)return e;var h=e.getSouthWest(),x=e.getNorthEast(),y=new re(h.lat-a,h.lng-c),b=new re(x.lat-a,x.lng-c);return new be(y,b)}},de=d({},me,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var o=Math.PI/180,a=e.lat*o,c=t.lat*o,h=Math.sin((t.lat-e.lat)*o/2),x=Math.sin((t.lng-e.lng)*o/2),y=h*h+Math.cos(a)*Math.cos(c)*x*x,b=2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y));return this.R*b}}),Ze=6378137,ii={R:Ze,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,o=this.MAX_LATITUDE,a=Math.max(Math.min(o,e.lat),-o),c=Math.sin(a*t);return new H(this.R*e.lng*t,this.R*Math.log((1+c)/(1-c))/2)},unproject:function(e){var t=180/Math.PI;return new re((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:function(){var e=Ze*Math.PI;return new ne([-e,-e],[e,e])}()};function ni(e,t,o,a){if(Z(e)){this._a=e[0],this._b=e[1],this._c=e[2],this._d=e[3];return}this._a=e,this._b=t,this._c=o,this._d=a}ni.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new H((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};function pt(e,t,o,a){return new ni(e,t,o,a)}var oi=d({},de,{code:"EPSG:3857",projection:ii,transformation:function(){var e=.5/(Math.PI*ii.R);return pt(e,.5,-e,.5)}()}),Io=d({},oi,{code:"EPSG:900913"});function Yi(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Ji(e,t){var o="",a,c,h,x,y,b;for(a=0,h=e.length;a<h;a++){for(y=e[a],c=0,x=y.length;c<x;c++)b=y[c],o+=(c?"L":"M")+b.x+" "+b.y;o+=t?F.svg?"z":"x":""}return o||"M0 0"}var ri=document.documentElement.style,Rt="ActiveXObject"in window,Ao=Rt&&!document.addEventListener,Qi="msLaunchUri"in navigator&&!("documentMode"in document),si=Ie("webkit"),Xi=Ie("android"),en=Ie("android 2")||Ie("android 3"),Eo=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Bo=Xi&&Ie("Google")&&Eo<537&&!("AudioNode"in window),ai=!!window.opera,tn=!Qi&&Ie("chrome"),nn=Ie("gecko")&&!si&&!ai&&!Rt,Oo=!tn&&Ie("safari"),on=Ie("phantom"),rn="OTransition"in ri,Do=navigator.platform.indexOf("Win")===0,sn=Rt&&"transition"in ri,li="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!en,an="MozPerspective"in ri,Wo=!window.L_DISABLE_3D&&(sn||li||an)&&!rn&&!on,ht=typeof orientation<"u"||Ie("mobile"),qo=ht&&si,No=ht&&li,ln=!window.PointerEvent&&window.MSPointerEvent,dn=!!(window.PointerEvent||ln),cn="ontouchstart"in window||!!window.TouchEvent,Zo=!window.L_NO_TOUCH&&(cn||dn),Fo=ht&&ai,$o=ht&&nn,Ho=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Uo=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",v,t),window.removeEventListener("testPassiveEventSupport",v,t)}catch{}return e}(),Go=function(){return!!document.createElement("canvas").getContext}(),di=!!(document.createElementNS&&Yi("svg").createSVGRect),Vo=!!di&&function(){var e=document.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Ko=!di&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&typeof t.adj=="object"}catch{return!1}}(),Yo=navigator.platform.indexOf("Mac")===0,Jo=navigator.platform.indexOf("Linux")===0;function Ie(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var F={ie:Rt,ielt9:Ao,edge:Qi,webkit:si,android:Xi,android23:en,androidStock:Bo,opera:ai,chrome:tn,gecko:nn,safari:Oo,phantom:on,opera12:rn,win:Do,ie3d:sn,webkit3d:li,gecko3d:an,any3d:Wo,mobile:ht,mobileWebkit:qo,mobileWebkit3d:No,msPointer:ln,pointer:dn,touch:Zo,touchNative:cn,mobileOpera:Fo,mobileGecko:$o,retina:Ho,passiveEvents:Uo,canvas:Go,svg:di,vml:Ko,inlineSvg:Vo,mac:Yo,linux:Jo},un=F.msPointer?"MSPointerDown":"pointerdown",pn=F.msPointer?"MSPointerMove":"pointermove",hn=F.msPointer?"MSPointerUp":"pointerup",fn=F.msPointer?"MSPointerCancel":"pointercancel",ci={touchstart:un,touchmove:pn,touchend:hn,touchcancel:fn},xn={touchstart:nr,touchmove:Mt,touchend:Mt,touchcancel:Mt},et={},mn=!1;function Qo(e,t,o){return t==="touchstart"&&ir(),xn[t]?(o=xn[t].bind(this,o),e.addEventListener(ci[t],o,!1),o):(console.warn("wrong event specified:",t),v)}function Xo(e,t,o){if(!ci[t]){console.warn("wrong event specified:",t);return}e.removeEventListener(ci[t],o,!1)}function er(e){et[e.pointerId]=e}function tr(e){et[e.pointerId]&&(et[e.pointerId]=e)}function gn(e){delete et[e.pointerId]}function ir(){mn||(document.addEventListener(un,er,!0),document.addEventListener(pn,tr,!0),document.addEventListener(hn,gn,!0),document.addEventListener(fn,gn,!0),mn=!0)}function Mt(e,t){if(t.pointerType!==(t.MSPOINTER_TYPE_MOUSE||"mouse")){t.touches=[];for(var o in et)t.touches.push(et[o]);t.changedTouches=[t],e(t)}}function nr(e,t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&ye(t),Mt(e,t)}function or(e){var t={},o,a;for(a in e)o=e[a],t[a]=o&&o.bind?o.bind(e):o;return e=t,t.type="dblclick",t.detail=2,t.isTrusted=!1,t._simulated=!0,t}var rr=200;function sr(e,t){e.addEventListener("dblclick",t);var o=0,a;function c(h){if(h.detail!==1){a=h.detail;return}if(!(h.pointerType==="mouse"||h.sourceCapabilities&&!h.sourceCapabilities.firesTouchEvents)){var x=wn(h);if(!(x.some(function(b){return b instanceof HTMLLabelElement&&b.attributes.for})&&!x.some(function(b){return b instanceof HTMLInputElement||b instanceof HTMLSelectElement}))){var y=Date.now();y-o<=rr?(a++,a===2&&t(or(h))):a=1,o=y}}}return e.addEventListener("click",c),{dblclick:t,simDblclick:c}}function ar(e,t){e.removeEventListener("dblclick",t.dblclick),e.removeEventListener("click",t.simDblclick)}var ui=Et(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ft=Et(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),_n=ft==="webkitTransition"||ft==="OTransition"?ft+"End":"transitionend";function yn(e){return typeof e=="string"?document.getElementById(e):e}function xt(e,t){var o=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!o||o==="auto")&&document.defaultView){var a=document.defaultView.getComputedStyle(e,null);o=a?a[t]:null}return o==="auto"?null:o}function oe(e,t,o){var a=document.createElement(e);return a.className=t||"",o&&o.appendChild(a),a}function ue(e){var t=e.parentNode;t&&t.removeChild(e)}function It(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function tt(e){var t=e.parentNode;t&&t.lastChild!==e&&t.appendChild(e)}function it(e){var t=e.parentNode;t&&t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function pi(e,t){if(e.classList!==void 0)return e.classList.contains(t);var o=At(e);return o.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(o)}function Y(e,t){if(e.classList!==void 0)for(var o=w(t),a=0,c=o.length;a<c;a++)e.classList.add(o[a]);else if(!pi(e,t)){var h=At(e);hi(e,(h?h+" ":"")+t)}}function he(e,t){e.classList!==void 0?e.classList.remove(t):hi(e,T((" "+At(e)+" ").replace(" "+t+" "," ")))}function hi(e,t){e.className.baseVal===void 0?e.className=t:e.className.baseVal=t}function At(e){return e.correspondingElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function ze(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&lr(e,t)}function lr(e,t){var o=!1,a="DXImageTransform.Microsoft.Alpha";try{o=e.filters.item(a)}catch{if(t===1)return}t=Math.round(t*100),o?(o.Enabled=t!==100,o.Opacity=t):e.style.filter+=" progid:"+a+"(opacity="+t+")"}function Et(e){for(var t=document.documentElement.style,o=0;o<e.length;o++)if(e[o]in t)return e[o];return!1}function Ue(e,t,o){var a=t||new H(0,0);e.style[ui]=(F.ie3d?"translate("+a.x+"px,"+a.y+"px)":"translate3d("+a.x+"px,"+a.y+"px,0)")+(o?" scale("+o+")":"")}function fe(e,t){e._leaflet_pos=t,F.any3d?Ue(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function Ge(e){return e._leaflet_pos||new H(0,0)}var mt,gt,fi;if("onselectstart"in document)mt=function(){V(window,"selectstart",ye)},gt=function(){le(window,"selectstart",ye)};else{var _t=Et(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);mt=function(){if(_t){var e=document.documentElement.style;fi=e[_t],e[_t]="none"}},gt=function(){_t&&(document.documentElement.style[_t]=fi,fi=void 0)}}function xi(){V(window,"dragstart",ye)}function mi(){le(window,"dragstart",ye)}var Bt,gi;function _i(e){for(;e.tabIndex===-1;)e=e.parentNode;e.style&&(Ot(),Bt=e,gi=e.style.outlineStyle,e.style.outlineStyle="none",V(window,"keydown",Ot))}function Ot(){Bt&&(Bt.style.outlineStyle=gi,Bt=void 0,gi=void 0,le(window,"keydown",Ot))}function vn(e){do e=e.parentNode;while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function yi(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}var dr={__proto__:null,TRANSFORM:ui,TRANSITION:ft,TRANSITION_END:_n,get:yn,getStyle:xt,create:oe,remove:ue,empty:It,toFront:tt,toBack:it,hasClass:pi,addClass:Y,removeClass:he,setClass:hi,getClass:At,setOpacity:ze,testProp:Et,setTransform:Ue,setPosition:fe,getPosition:Ge,get disableTextSelection(){return mt},get enableTextSelection(){return gt},disableImageDrag:xi,enableImageDrag:mi,preventOutline:_i,restoreOutline:Ot,getSizedParentNode:vn,getScale:yi};function V(e,t,o,a){if(t&&typeof t=="object")for(var c in t)bi(e,c,t[c],o);else{t=w(t);for(var h=0,x=t.length;h<x;h++)bi(e,t[h],o,a)}return this}var Ae="_leaflet_events";function le(e,t,o,a){if(arguments.length===1)bn(e),delete e[Ae];else if(t&&typeof t=="object")for(var c in t)wi(e,c,t[c],o);else if(t=w(t),arguments.length===2)bn(e,function(y){return B(t,y)!==-1});else for(var h=0,x=t.length;h<x;h++)wi(e,t[h],o,a);return this}function bn(e,t){for(var o in e[Ae]){var a=o.split(/\d/)[0];(!t||t(a))&&wi(e,a,null,null,o)}}var vi={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function bi(e,t,o,a){var c=t+m(o)+(a?"_"+m(a):"");if(e[Ae]&&e[Ae][c])return this;var h=function(y){return o.call(a||e,y||window.event)},x=h;!F.touchNative&&F.pointer&&t.indexOf("touch")===0?h=Qo(e,t,h):F.touch&&t==="dblclick"?h=sr(e,h):"addEventListener"in e?t==="touchstart"||t==="touchmove"||t==="wheel"||t==="mousewheel"?e.addEventListener(vi[t]||t,h,F.passiveEvents?{passive:!1}:!1):t==="mouseenter"||t==="mouseleave"?(h=function(y){y=y||window.event,ji(e,y)&&x(y)},e.addEventListener(vi[t],h,!1)):e.addEventListener(t,x,!1):e.attachEvent("on"+t,h),e[Ae]=e[Ae]||{},e[Ae][c]=h}function wi(e,t,o,a,c){c=c||t+m(o)+(a?"_"+m(a):"");var h=e[Ae]&&e[Ae][c];if(!h)return this;!F.touchNative&&F.pointer&&t.indexOf("touch")===0?Xo(e,t,h):F.touch&&t==="dblclick"?ar(e,h):"removeEventListener"in e?e.removeEventListener(vi[t]||t,h,!1):e.detachEvent("on"+t,h),e[Ae][c]=null}function Ve(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function Si(e){return bi(e,"wheel",Ve),this}function yt(e){return V(e,"mousedown touchstart dblclick contextmenu",Ve),e._leaflet_disable_click=!0,this}function ye(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function Ke(e){return ye(e),Ve(e),this}function wn(e){if(e.composedPath)return e.composedPath();for(var t=[],o=e.target;o;)t.push(o),o=o.parentNode;return t}function Sn(e,t){if(!t)return new H(e.clientX,e.clientY);var o=yi(t),a=o.boundingClientRect;return new H((e.clientX-a.left)/o.x-t.clientLeft,(e.clientY-a.top)/o.y-t.clientTop)}var cr=F.linux&&F.chrome?window.devicePixelRatio:F.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function jn(e){return F.edge?e.wheelDeltaY/2:e.deltaY&&e.deltaMode===0?-e.deltaY/cr:e.deltaY&&e.deltaMode===1?-e.deltaY*20:e.deltaY&&e.deltaMode===2?-e.deltaY*60:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?-e.detail*20:e.detail?e.detail/-32765*60:0}function ji(e,t){var o=t.relatedTarget;if(!o)return!0;try{for(;o&&o!==e;)o=o.parentNode}catch{return!1}return o!==e}var ur={__proto__:null,on:V,off:le,stopPropagation:Ve,disableScrollPropagation:Si,disableClickPropagation:yt,preventDefault:ye,stop:Ke,getPropagationPath:wn,getMousePosition:Sn,getWheelDelta:jn,isExternalTarget:ji,addListener:V,removeListener:le},Cn=te.extend({run:function(e,t,o,a){this.stop(),this._el=e,this._inProgress=!0,this._duration=o||.25,this._easeOutPower=1/Math.max(a||.5,.2),this._startPos=Ge(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=_(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,o=this._duration*1e3;t<o?this._runFrame(this._easeOut(t/o),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var o=this._startPos.add(this._offset.multiplyBy(e));t&&o._round(),fe(this._el,o),this.fire("step")},_complete:function(){S(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),ie=te.extend({options:{crs:oi,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,t){t=k(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=u(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),t.zoom!==void 0&&(this._zoom=this._limitZoom(t.zoom)),t.center&&t.zoom!==void 0&&this.setView(ee(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ft&&F.any3d&&!F.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),V(this._proxy,_n,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,t,o){if(t=t===void 0?this._zoom:this._limitZoom(t),e=this._limitCenter(ee(e),t,this.options.maxBounds),o=o||{},this._stop(),this._loaded&&!o.reset&&o!==!0){o.animate!==void 0&&(o.zoom=d({animate:o.animate},o.zoom),o.pan=d({animate:o.animate,duration:o.duration},o.pan));var a=this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,o.zoom):this._tryAnimatedPan(e,o.pan);if(a)return clearTimeout(this._sizeTimer),this}return this._resetView(e,t,o.pan&&o.pan.noMoveStart),this},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=e,this)},zoomIn:function(e,t){return e=e||(F.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,t)},zoomOut:function(e,t){return e=e||(F.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,t)},setZoomAround:function(e,t,o){var a=this.getZoomScale(t),c=this.getSize().divideBy(2),h=e instanceof H?e:this.latLngToContainerPoint(e),x=h.subtract(c).multiplyBy(1-1/a),y=this.containerPointToLatLng(c.add(x));return this.setView(y,t,{zoom:o})},_getBoundsCenterZoom:function(e,t){t=t||{},e=e.getBounds?e.getBounds():pe(e);var o=D(t.paddingTopLeft||t.padding||[0,0]),a=D(t.paddingBottomRight||t.padding||[0,0]),c=this.getBoundsZoom(e,!1,o.add(a));if(c=typeof t.maxZoom=="number"?Math.min(t.maxZoom,c):c,c===1/0)return{center:e.getCenter(),zoom:c};var h=a.subtract(o).divideBy(2),x=this.project(e.getSouthWest(),c),y=this.project(e.getNorthEast(),c),b=this.unproject(x.add(y).divideBy(2).add(h),c);return{center:b,zoom:c}},fitBounds:function(e,t){if(e=pe(e),!e.isValid())throw new Error("Bounds are not valid.");var o=this._getBoundsCenterZoom(e,t);return this.setView(o.center,o.zoom,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e,t){if(e=D(e).round(),t=t||{},!e.x&&!e.y)return this.fire("moveend");if(t.animate!==!0&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Cn,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart"),t.animate!==!1){Y(this._mapPane,"leaflet-pan-anim");var o=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,o,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,t,o){if(o=o||{},o.animate===!1||!F.any3d)return this.setView(e,t,o);this._stop();var a=this.project(this.getCenter()),c=this.project(e),h=this.getSize(),x=this._zoom;e=ee(e),t=t===void 0?x:t;var y=Math.max(h.x,h.y),b=y*this.getZoomScale(x,t),A=c.distanceTo(a)||1,q=1.42,G=q*q;function J(xe){var Kt=xe?-1:1,Xr=xe?b:y,es=b*b-y*y+Kt*G*G*A*A,ts=2*Xr*G*A,Ei=es/ts,ro=Math.sqrt(Ei*Ei+1)-Ei,is=ro<1e-9?-18:Math.log(ro);return is}function we(xe){return(Math.exp(xe)-Math.exp(-xe))/2}function ge(xe){return(Math.exp(xe)+Math.exp(-xe))/2}function Pe(xe){return we(xe)/ge(xe)}var je=J(0);function lt(xe){return y*(ge(je)/ge(je+q*xe))}function Kr(xe){return y*(ge(je)*Pe(je+q*xe)-we(je))/G}function Yr(xe){return 1-Math.pow(1-xe,1.5)}var Jr=Date.now(),no=(J(1)-je)/q,Qr=o.duration?1e3*o.duration:1e3*no*.8;function oo(){var xe=(Date.now()-Jr)/Qr,Kt=Yr(xe)*no;xe<=1?(this._flyToFrame=_(oo,this),this._move(this.unproject(a.add(c.subtract(a).multiplyBy(Kr(Kt)/A)),x),this.getScaleZoom(y/lt(Kt),x),{flyTo:!0})):this._move(e,t)._moveEnd(!0)}return this._moveStart(!0,o.noMoveStart),oo.call(this),this},flyToBounds:function(e,t){var o=this._getBoundsCenterZoom(e,t);return this.flyTo(o.center,o.zoom,t)},setMaxBounds:function(e){return e=pe(e),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),e.isValid()?(this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(e){var t=this.options.minZoom;return this.options.minZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var t=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,t){this._enforcingBounds=!0;var o=this.getCenter(),a=this._limitCenter(o,this._zoom,pe(e));return o.equals(a)||this.panTo(a,t),this._enforcingBounds=!1,this},panInside:function(e,t){t=t||{};var o=D(t.paddingTopLeft||t.padding||[0,0]),a=D(t.paddingBottomRight||t.padding||[0,0]),c=this.project(this.getCenter()),h=this.project(e),x=this.getPixelBounds(),y=ae([x.min.add(o),x.max.subtract(a)]),b=y.getSize();if(!y.contains(h)){this._enforcingBounds=!0;var A=h.subtract(y.getCenter()),q=y.extend(h).getSize().subtract(b);c.x+=A.x<0?-q.x:q.x,c.y+=A.y<0?-q.y:q.y,this.panTo(this.unproject(c),t),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=d({animate:!1,pan:!0},e===!0?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var o=this.getSize(),a=t.divideBy(2).round(),c=o.divideBy(2).round(),h=a.subtract(c);return!h.x&&!h.y?this:(e.animate&&e.pan?this.panBy(h):(e.pan&&this._rawPanBy(h),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(u(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:o}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=d({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=u(this._handleGeolocationResponse,this),o=u(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,o,e):navigator.geolocation.getCurrentPosition(t,o,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var t=e.code,o=e.message||(t===1?"permission denied":t===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+o+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var t=e.coords.latitude,o=e.coords.longitude,a=new re(t,o),c=a.toBounds(e.coords.accuracy*2),h=this._locateOptions;if(h.setView){var x=this.getBoundsZoom(c);this.setView(a,h.maxZoom?Math.min(x,h.maxZoom):x)}var y={latlng:a,bounds:c,timestamp:e.timestamp};for(var b in e.coords)typeof e.coords[b]=="number"&&(y[b]=e.coords[b]);this.fire("locationfound",y)}},addHandler:function(e,t){if(!t)return this;var o=this[e]=new t(this);return this._handlers.push(o),this.options[e]&&o.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),ue(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(S(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var e;for(e in this._layers)this._layers[e].remove();for(e in this._panes)ue(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,t){var o="leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),a=oe("div",o,t||this._mapPane);return e&&(this._panes[e]=a),a},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds(),t=this.unproject(e.getBottomLeft()),o=this.unproject(e.getTopRight());return new be(t,o)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,o){e=pe(e),o=D(o||[0,0]);var a=this.getZoom()||0,c=this.getMinZoom(),h=this.getMaxZoom(),x=e.getNorthWest(),y=e.getSouthEast(),b=this.getSize().subtract(o),A=ae(this.project(y,a),this.project(x,a)).getSize(),q=F.any3d?this.options.zoomSnap:1,G=b.x/A.x,J=b.y/A.y,we=t?Math.max(G,J):Math.min(G,J);return a=this.getScaleZoom(we,a),q&&(a=Math.round(a/(q/100))*(q/100),a=t?Math.ceil(a/q)*q:Math.floor(a/q)*q),Math.max(c,Math.min(h,a))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new H(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,t){var o=this._getTopLeftPoint(e,t);return new ne(o,o.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(e===void 0?this.getZoom():e)},getPane:function(e){return typeof e=="string"?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,t){var o=this.options.crs;return t=t===void 0?this._zoom:t,o.scale(e)/o.scale(t)},getScaleZoom:function(e,t){var o=this.options.crs;t=t===void 0?this._zoom:t;var a=o.zoom(e*o.scale(t));return isNaN(a)?1/0:a},project:function(e,t){return t=t===void 0?this._zoom:t,this.options.crs.latLngToPoint(ee(e),t)},unproject:function(e,t){return t=t===void 0?this._zoom:t,this.options.crs.pointToLatLng(D(e),t)},layerPointToLatLng:function(e){var t=D(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){var t=this.project(ee(e))._round();return t._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(ee(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(pe(e))},distance:function(e,t){return this.options.crs.distance(ee(e),ee(t))},containerPointToLayerPoint:function(e){return D(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return D(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(D(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(ee(e)))},mouseEventToContainerPoint:function(e){return Sn(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=yn(e);if(t){if(t._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");V(t,"scroll",this._onScroll,this),this._containerId=m(t)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&F.any3d,Y(e,"leaflet-container"+(F.touch?" leaflet-touch":"")+(F.retina?" leaflet-retina":"")+(F.ielt9?" leaflet-oldie":"")+(F.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=xt(e,"position");t!=="absolute"&&t!=="relative"&&t!=="fixed"&&t!=="sticky"&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),fe(this._mapPane,new H(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Y(e.markerPane,"leaflet-zoom-hide"),Y(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,t,o){fe(this._mapPane,new H(0,0));var a=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire("viewprereset");var c=this._zoom!==t;this._moveStart(c,o)._move(e,t)._moveEnd(c),this.fire("viewreset"),a&&this.fire("load")},_moveStart:function(e,t){return e&&this.fire("zoomstart"),t||this.fire("movestart"),this},_move:function(e,t,o,a){t===void 0&&(t=this._zoom);var c=this._zoom!==t;return this._zoom=t,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),a?o&&o.pinch&&this.fire("zoom",o):((c||o&&o.pinch)&&this.fire("zoom",o),this.fire("move",o)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return S(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){fe(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[m(this._container)]=this;var t=e?le:V;t(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&t(window,"resize",this._onResize,this),F.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){S(this._resizeRequest),this._resizeRequest=_(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,t){for(var o=[],a,c=t==="mouseout"||t==="mouseover",h=e.target||e.srcElement,x=!1;h;){if(a=this._targets[m(h)],a&&(t==="click"||t==="preclick")&&this._draggableMoved(a)){x=!0;break}if(a&&a.listens(t,!0)&&(c&&!ji(h,e)||(o.push(a),c))||h===this._container)break;h=h.parentNode}return!o.length&&!x&&!c&&this.listens(t,!0)&&(o=[this]),o},_isClickDisabled:function(e){for(;e&&e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var t=e.target||e.srcElement;if(!(!this._loaded||t._leaflet_disable_events||e.type==="click"&&this._isClickDisabled(t))){var o=e.type;o==="mousedown"&&_i(t),this._fireDOMEvent(e,o)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,t,o){if(e.type==="click"){var a=d({},e);a.type="preclick",this._fireDOMEvent(a,a.type,o)}var c=this._findEventTargets(e,t);if(o){for(var h=[],x=0;x<o.length;x++)o[x].listens(t,!0)&&h.push(o[x]);c=h.concat(c)}if(c.length){t==="contextmenu"&&ye(e);var y=c[0],b={originalEvent:e};if(e.type!=="keypress"&&e.type!=="keydown"&&e.type!=="keyup"){var A=y.getLatLng&&(!y._radius||y._radius<=10);b.containerPoint=A?this.latLngToContainerPoint(y.getLatLng()):this.mouseEventToContainerPoint(e),b.layerPoint=this.containerPointToLayerPoint(b.containerPoint),b.latlng=A?y.getLatLng():this.layerPointToLatLng(b.layerPoint)}for(x=0;x<c.length;x++)if(c[x].fire(t,b,!0),b.originalEvent._stopped||c[x].options.bubblingMouseEvents===!1&&B(this._mouseEvents,t)!==-1)return}},_draggableMoved:function(e){return e=e.dragging&&e.dragging.enabled()?e:this,e.dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on("load",e,t),this},_getMapPanePos:function(){return Ge(this._mapPane)||new H(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,t){var o=e&&t!==void 0?this._getNewPixelOrigin(e,t):this.getPixelOrigin();return o.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,t){var o=this.getSize()._divideBy(2);return this.project(e,t)._subtract(o)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,t,o){var a=this._getNewPixelOrigin(o,t);return this.project(e,t)._subtract(a)},_latLngBoundsToNewLayerBounds:function(e,t,o){var a=this._getNewPixelOrigin(o,t);return ae([this.project(e.getSouthWest(),t)._subtract(a),this.project(e.getNorthWest(),t)._subtract(a),this.project(e.getSouthEast(),t)._subtract(a),this.project(e.getNorthEast(),t)._subtract(a)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,o){if(!o)return e;var a=this.project(e,t),c=this.getSize().divideBy(2),h=new ne(a.subtract(c),a.add(c)),x=this._getBoundsOffset(h,o,t);return Math.abs(x.x)<=1&&Math.abs(x.y)<=1?e:this.unproject(a.add(x),t)},_limitOffset:function(e,t){if(!t)return e;var o=this.getPixelBounds(),a=new ne(o.min.add(e),o.max.add(e));return e.add(this._getBoundsOffset(a,t))},_getBoundsOffset:function(e,t,o){var a=ae(this.project(t.getNorthEast(),o),this.project(t.getSouthWest(),o)),c=a.min.subtract(e.min),h=a.max.subtract(e.max),x=this._rebound(c.x,-h.x),y=this._rebound(c.y,-h.y);return new H(x,y)},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),o=this.getMaxZoom(),a=F.any3d?this.options.zoomSnap:1;return a&&(e=Math.round(e/a)*a),Math.max(t,Math.min(o,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){he(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,t){var o=this._getCenterOffset(e)._trunc();return(t&&t.animate)!==!0&&!this.getSize().contains(o)?!1:(this.panBy(o,t),!0)},_createAnimProxy:function(){var e=this._proxy=oe("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",function(t){var o=ui,a=this._proxy.style[o];Ue(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),a===this._proxy.style[o]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){ue(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),t=this.getZoom();Ue(this._proxy,this.project(e,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,o){if(this._animatingZoom)return!0;if(o=o||{},!this._zoomAnimated||o.animate===!1||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var a=this.getZoomScale(t),c=this._getCenterOffset(e)._divideBy(1-1/a);return o.animate!==!0&&!this.getSize().contains(c)?!1:(_(function(){this._moveStart(!0,o.noMoveStart||!1)._animateZoom(e,t,!0)},this),!0)},_animateZoom:function(e,t,o,a){this._mapPane&&(o&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,Y(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:t,noUpdate:a}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(u(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&he(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function pr(e,t){return new ie(e,t)}var Re=M.extend({options:{position:"topright"},initialize:function(e){k(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),o=this.getPosition(),a=e._controlCorners[o];return Y(t,"leaflet-control"),o.indexOf("bottom")!==-1?a.insertBefore(t,a.firstChild):a.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(ue(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),vt=function(e){return new Re(e)};ie.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},t="leaflet-",o=this._controlContainer=oe("div",t+"control-container",this._container);function a(c,h){var x=t+c+" "+t+h;e[c+h]=oe("div",x,o)}a("top","left"),a("top","right"),a("bottom","left"),a("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)ue(this._controlCorners[e]);ue(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var kn=Re.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,o,a){return o<a?-1:a<o?1:0}},initialize:function(e,t,o){k(this,o),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var a in e)this._addLayer(e[a],a);for(a in t)this._addLayer(t[a],a,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return Re.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(m(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){Y(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(Y(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):he(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return he(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=oe("div",e),o=this.options.collapsed;t.setAttribute("aria-haspopup",!0),yt(t),Si(t);var a=this._section=oe("section",e+"-list");o&&(this._map.on("click",this.collapse,this),V(t,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var c=this._layersLink=oe("a",e+"-toggle",t);c.href="#",c.title="Layers",c.setAttribute("role","button"),V(c,{keydown:function(h){h.keyCode===13&&this._expandSafely()},click:function(h){ye(h),this._expandSafely()}},this),o||this.expand(),this._baseLayersList=oe("div",e+"-base",a),this._separator=oe("div",e+"-separator",a),this._overlaysList=oe("div",e+"-overlays",a),t.appendChild(a)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&m(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,o){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:o}),this.options.sortLayers&&this._layers.sort(u(function(a,c){return this.options.sortFunction(a.layer,c.layer,a.name,c.name)},this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;It(this._baseLayersList),It(this._overlaysList),this._layerControlInputs=[];var e,t,o,a,c=0;for(o=0;o<this._layers.length;o++)a=this._layers[o],this._addItem(a),t=t||a.overlay,e=e||!a.overlay,c+=a.overlay?0:1;return this.options.hideSingleBase&&(e=e&&c>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(m(e.target)),o=t.overlay?e.type==="add"?"overlayadd":"overlayremove":e.type==="add"?"baselayerchange":null;o&&this._map.fire(o,t)},_createRadioElement:function(e,t){var o='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",a=document.createElement("div");return a.innerHTML=o,a.firstChild},_addItem:function(e){var t=document.createElement("label"),o=this._map.hasLayer(e.layer),a;e.overlay?(a=document.createElement("input"),a.type="checkbox",a.className="leaflet-control-layers-selector",a.defaultChecked=o):a=this._createRadioElement("leaflet-base-layers_"+m(this),o),this._layerControlInputs.push(a),a.layerId=m(e.layer),V(a,"click",this._onInputClick,this);var c=document.createElement("span");c.innerHTML=" "+e.name;var h=document.createElement("span");t.appendChild(h),h.appendChild(a),h.appendChild(c);var x=e.overlay?this._overlaysList:this._baseLayersList;return x.appendChild(t),this._checkDisabledLayers(),t},_onInputClick:function(){if(!this._preventClick){var e=this._layerControlInputs,t,o,a=[],c=[];this._handlingClick=!0;for(var h=e.length-1;h>=0;h--)t=e[h],o=this._getLayer(t.layerId).layer,t.checked?a.push(o):t.checked||c.push(o);for(h=0;h<c.length;h++)this._map.hasLayer(c[h])&&this._map.removeLayer(c[h]);for(h=0;h<a.length;h++)this._map.hasLayer(a[h])||this._map.addLayer(a[h]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var e=this._layerControlInputs,t,o,a=this._map.getZoom(),c=e.length-1;c>=0;c--)t=e[c],o=this._getLayer(t.layerId).layer,t.disabled=o.options.minZoom!==void 0&&a<o.options.minZoom||o.options.maxZoom!==void 0&&a>o.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var e=this._section;this._preventClick=!0,V(e,"click",ye),this.expand();var t=this;setTimeout(function(){le(e,"click",ye),t._preventClick=!1})}}),hr=function(e,t,o){return new kn(e,t,o)},Ci=Re.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",o=oe("div",t+" leaflet-bar"),a=this.options;return this._zoomInButton=this._createButton(a.zoomInText,a.zoomInTitle,t+"-in",o,this._zoomIn),this._zoomOutButton=this._createButton(a.zoomOutText,a.zoomOutTitle,t+"-out",o,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),o},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,t,o,a,c){var h=oe("a",o,a);return h.innerHTML=e,h.href="#",h.title=t,h.setAttribute("role","button"),h.setAttribute("aria-label",t),yt(h),V(h,"click",Ke),V(h,"click",c,this),V(h,"click",this._refocusOnMap,this),h},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";he(this._zoomInButton,t),he(this._zoomOutButton,t),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(Y(this._zoomOutButton,t),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(Y(this._zoomInButton,t),this._zoomInButton.setAttribute("aria-disabled","true"))}});ie.mergeOptions({zoomControl:!0}),ie.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Ci,this.addControl(this.zoomControl))});var fr=function(e){return new Ci(e)},zn=Re.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t="leaflet-control-scale",o=oe("div",t),a=this.options;return this._addScales(a,t+"-line",o),e.on(a.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),o},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,o){e.metric&&(this._mScale=oe("div",t,o)),e.imperial&&(this._iScale=oe("div",t,o))},_update:function(){var e=this._map,t=e.getSize().y/2,o=e.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(o)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),o=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,o,t/e)},_updateImperial:function(e){var t=e*3.2808399,o,a,c;t>5280?(o=t/5280,a=this._getRoundNum(o),this._updateScale(this._iScale,a+" mi",a/o)):(c=this._getRoundNum(t),this._updateScale(this._iScale,c+" ft",c/t))},_updateScale:function(e,t,o){e.style.width=Math.round(this.options.maxWidth*o)+"px",e.innerHTML=t},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),o=e/t;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,t*o}}),xr=function(e){return new zn(e)},mr='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',ki=Re.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(F.inlineSvg?mr+" ":"")+"Leaflet</a>"},initialize:function(e){k(this,e),this._attributions={}},onAdd:function(e){e.attributionControl=this,this._container=oe("div","leaflet-control-attribution"),yt(this._container);for(var t in e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",function(){this.removeAttribution(e.layer.getAttribution())},this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var o=[];this.options.prefix&&o.push(this.options.prefix),e.length&&o.push(e.join(", ")),this._container.innerHTML=o.join(' <span aria-hidden="true">|</span> ')}}});ie.mergeOptions({attributionControl:!0}),ie.addInitHook(function(){this.options.attributionControl&&new ki().addTo(this)});var gr=function(e){return new ki(e)};Re.Layers=kn,Re.Zoom=Ci,Re.Scale=zn,Re.Attribution=ki,vt.layers=hr,vt.zoom=fr,vt.scale=xr,vt.attribution=gr;var Ee=M.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ee.addTo=function(e,t){return e.addHandler(t,this),this};var _r={Events:U},Tn=F.touch?"touchstart mousedown":"mousedown",Fe=te.extend({options:{clickTolerance:3},initialize:function(e,t,o,a){k(this,a),this._element=e,this._dragStartTarget=t||e,this._preventOutline=o},enable:function(){this._enabled||(V(this._dragStartTarget,Tn,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Fe._dragging===this&&this.finishDrag(!0),le(this._dragStartTarget,Tn,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!pi(this._element,"leaflet-zoom-anim"))){if(e.touches&&e.touches.length!==1){Fe._dragging===this&&this.finishDrag();return}if(!(Fe._dragging||e.shiftKey||e.which!==1&&e.button!==1&&!e.touches)&&(Fe._dragging=this,this._preventOutline&&_i(this._element),xi(),mt(),!this._moving)){this.fire("down");var t=e.touches?e.touches[0]:e,o=vn(this._element);this._startPoint=new H(t.clientX,t.clientY),this._startPos=Ge(this._element),this._parentScale=yi(o);var a=e.type==="mousedown";V(document,a?"mousemove":"touchmove",this._onMove,this),V(document,a?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(e){if(this._enabled){if(e.touches&&e.touches.length>1){this._moved=!0;return}var t=e.touches&&e.touches.length===1?e.touches[0]:e,o=new H(t.clientX,t.clientY)._subtract(this._startPoint);!o.x&&!o.y||Math.abs(o.x)+Math.abs(o.y)<this.options.clickTolerance||(o.x/=this._parentScale.x,o.y/=this._parentScale.y,ye(e),this._moved||(this.fire("dragstart"),this._moved=!0,Y(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Y(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(o),this._moving=!0,this._lastEvent=e,this._updatePosition())}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),fe(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){he(document.body,"leaflet-dragging"),this._lastTarget&&(he(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),le(document,"mousemove touchmove",this._onMove,this),le(document,"mouseup touchend touchcancel",this._onUp,this),mi(),gt();var t=this._moved&&this._moving;this._moving=!1,Fe._dragging=!1,t&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)})}});function Pn(e,t,o){var a,c=[1,4,2,8],h,x,y,b,A,q,G,J;for(h=0,q=e.length;h<q;h++)e[h]._code=Ye(e[h],t);for(y=0;y<4;y++){for(G=c[y],a=[],h=0,q=e.length,x=q-1;h<q;x=h++)b=e[h],A=e[x],b._code&G?A._code&G||(J=Dt(A,b,G,t,o),J._code=Ye(J,t),a.push(J)):(A._code&G&&(J=Dt(A,b,G,t,o),J._code=Ye(J,t),a.push(J)),a.push(b));e=a}return e}function Ln(e,t){var o,a,c,h,x,y,b,A,q;if(!e||e.length===0)throw new Error("latlngs not passed");Te(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var G=ee([0,0]),J=pe(e),we=J.getNorthWest().distanceTo(J.getSouthWest())*J.getNorthEast().distanceTo(J.getNorthWest());we<1700&&(G=zi(e));var ge=e.length,Pe=[];for(o=0;o<ge;o++){var je=ee(e[o]);Pe.push(t.project(ee([je.lat-G.lat,je.lng-G.lng])))}for(y=b=A=0,o=0,a=ge-1;o<ge;a=o++)c=Pe[o],h=Pe[a],x=c.y*h.x-h.y*c.x,b+=(c.x+h.x)*x,A+=(c.y+h.y)*x,y+=x*3;y===0?q=Pe[0]:q=[b/y,A/y];var lt=t.unproject(D(q));return ee([lt.lat+G.lat,lt.lng+G.lng])}function zi(e){for(var t=0,o=0,a=0,c=0;c<e.length;c++){var h=ee(e[c]);t+=h.lat,o+=h.lng,a++}return ee([t/a,o/a])}var yr={__proto__:null,clipPolygon:Pn,polygonCenter:Ln,centroid:zi};function Rn(e,t){if(!t||!e.length)return e.slice();var o=t*t;return e=wr(e,o),e=br(e,o),e}function Mn(e,t,o){return Math.sqrt(bt(e,t,o,!0))}function vr(e,t,o){return bt(e,t,o)}function br(e,t){var o=e.length,a=typeof Uint8Array<"u"?Uint8Array:Array,c=new a(o);c[0]=c[o-1]=1,Ti(e,c,t,0,o-1);var h,x=[];for(h=0;h<o;h++)c[h]&&x.push(e[h]);return x}function Ti(e,t,o,a,c){var h=0,x,y,b;for(y=a+1;y<=c-1;y++)b=bt(e[y],e[a],e[c],!0),b>h&&(x=y,h=b);h>o&&(t[x]=1,Ti(e,t,o,a,x),Ti(e,t,o,x,c))}function wr(e,t){for(var o=[e[0]],a=1,c=0,h=e.length;a<h;a++)Sr(e[a],e[c])>t&&(o.push(e[a]),c=a);return c<h-1&&o.push(e[h-1]),o}var In;function An(e,t,o,a,c){var h=a?In:Ye(e,o),x=Ye(t,o),y,b,A;for(In=x;;){if(!(h|x))return[e,t];if(h&x)return!1;y=h||x,b=Dt(e,t,y,o,c),A=Ye(b,o),y===h?(e=b,h=A):(t=b,x=A)}}function Dt(e,t,o,a,c){var h=t.x-e.x,x=t.y-e.y,y=a.min,b=a.max,A,q;return o&8?(A=e.x+h*(b.y-e.y)/x,q=b.y):o&4?(A=e.x+h*(y.y-e.y)/x,q=y.y):o&2?(A=b.x,q=e.y+x*(b.x-e.x)/h):o&1&&(A=y.x,q=e.y+x*(y.x-e.x)/h),new H(A,q,c)}function Ye(e,t){var o=0;return e.x<t.min.x?o|=1:e.x>t.max.x&&(o|=2),e.y<t.min.y?o|=4:e.y>t.max.y&&(o|=8),o}function Sr(e,t){var o=t.x-e.x,a=t.y-e.y;return o*o+a*a}function bt(e,t,o,a){var c=t.x,h=t.y,x=o.x-c,y=o.y-h,b=x*x+y*y,A;return b>0&&(A=((e.x-c)*x+(e.y-h)*y)/b,A>1?(c=o.x,h=o.y):A>0&&(c+=x*A,h+=y*A)),x=e.x-c,y=e.y-h,a?x*x+y*y:new H(c,h)}function Te(e){return!Z(e[0])||typeof e[0][0]!="object"&&typeof e[0][0]<"u"}function En(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Te(e)}function Bn(e,t){var o,a,c,h,x,y,b,A;if(!e||e.length===0)throw new Error("latlngs not passed");Te(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var q=ee([0,0]),G=pe(e),J=G.getNorthWest().distanceTo(G.getSouthWest())*G.getNorthEast().distanceTo(G.getNorthWest());J<1700&&(q=zi(e));var we=e.length,ge=[];for(o=0;o<we;o++){var Pe=ee(e[o]);ge.push(t.project(ee([Pe.lat-q.lat,Pe.lng-q.lng])))}for(o=0,a=0;o<we-1;o++)a+=ge[o].distanceTo(ge[o+1])/2;if(a===0)A=ge[0];else for(o=0,h=0;o<we-1;o++)if(x=ge[o],y=ge[o+1],c=x.distanceTo(y),h+=c,h>a){b=(h-a)/c,A=[y.x-b*(y.x-x.x),y.y-b*(y.y-x.y)];break}var je=t.unproject(D(A));return ee([je.lat+q.lat,je.lng+q.lng])}var jr={__proto__:null,simplify:Rn,pointToSegmentDistance:Mn,closestPointOnSegment:vr,clipSegment:An,_getEdgeIntersection:Dt,_getBitCode:Ye,_sqClosestPointOnSegment:bt,isFlat:Te,_flat:En,polylineCenter:Bn},Pi={project:function(e){return new H(e.lng,e.lat)},unproject:function(e){return new re(e.y,e.x)},bounds:new ne([-180,-90],[180,90])},Li={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ne([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(e){var t=Math.PI/180,o=this.R,a=e.lat*t,c=this.R_MINOR/o,h=Math.sqrt(1-c*c),x=h*Math.sin(a),y=Math.tan(Math.PI/4-a/2)/Math.pow((1-x)/(1+x),h/2);return a=-o*Math.log(Math.max(y,1e-10)),new H(e.lng*t*o,a)},unproject:function(e){for(var t=180/Math.PI,o=this.R,a=this.R_MINOR/o,c=Math.sqrt(1-a*a),h=Math.exp(-e.y/o),x=Math.PI/2-2*Math.atan(h),y=0,b=.1,A;y<15&&Math.abs(b)>1e-7;y++)A=c*Math.sin(x),A=Math.pow((1-A)/(1+A),c/2),b=Math.PI/2-2*Math.atan(h*A)-x,x+=b;return new re(x*t,e.x*t/o)}},Cr={__proto__:null,LonLat:Pi,Mercator:Li,SphericalMercator:ii},kr=d({},de,{code:"EPSG:3395",projection:Li,transformation:function(){var e=.5/(Math.PI*Li.R);return pt(e,.5,-e,.5)}()}),On=d({},de,{code:"EPSG:4326",projection:Pi,transformation:pt(1/180,1,-1/180,.5)}),zr=d({},me,{projection:Pi,transformation:pt(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var o=t.lng-e.lng,a=t.lat-e.lat;return Math.sqrt(o*o+a*a)},infinite:!0});me.Earth=de,me.EPSG3395=kr,me.EPSG3857=oi,me.EPSG900913=Io,me.EPSG4326=On,me.Simple=zr;var Me=te.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[m(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[m(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var o=this.getEvents();t.on(o,this),this.once("remove",function(){t.off(o,this)},this)}this.onAdd(t),this.fire("add"),t.fire("layeradd",{layer:this})}}});ie.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var t=m(e);return this._layers[t]?this:(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e),this)},removeLayer:function(e){var t=m(e);return this._layers[t]?(this._loaded&&e.onRemove(this),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return m(e)in this._layers},eachLayer:function(e,t){for(var o in this._layers)e.call(t,this._layers[o]);return this},_addLayers:function(e){e=e?Z(e)?e:[e]:[];for(var t=0,o=e.length;t<o;t++)this.addLayer(e[t])},_addZoomLimit:function(e){(!isNaN(e.options.maxZoom)||!isNaN(e.options.minZoom))&&(this._zoomBoundLayers[m(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var t=m(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,t=-1/0,o=this._getZoomSpan();for(var a in this._zoomBoundLayers){var c=this._zoomBoundLayers[a].options;e=c.minZoom===void 0?e:Math.min(e,c.minZoom),t=c.maxZoom===void 0?t:Math.max(t,c.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=e===1/0?void 0:e,o!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var nt=Me.extend({initialize:function(e,t){k(this,t),this._layers={};var o,a;if(e)for(o=0,a=e.length;o<a;o++)this.addLayer(e[o])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){var t=typeof e=="number"?e:this.getLayerId(e);return t in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t=Array.prototype.slice.call(arguments,1),o,a;for(o in this._layers)a=this._layers[o],a[e]&&a[e].apply(a,t);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var o in this._layers)e.call(t,this._layers[o]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return m(e)}}),Tr=function(e,t){return new nt(e,t)},Oe=nt.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),nt.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),nt.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new be;for(var t in this._layers){var o=this._layers[t];e.extend(o.getBounds?o.getBounds():o.getLatLng())}return e}}),Pr=function(e,t){return new Oe(e,t)},ot=M.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){k(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var o=this._getIconUrl(e);if(!o){if(e==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var a=this._createImg(o,t&&t.tagName==="IMG"?t:null);return this._setIconStyles(a,e),(this.options.crossOrigin||this.options.crossOrigin==="")&&(a.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),a},_setIconStyles:function(e,t){var o=this.options,a=o[t+"Size"];typeof a=="number"&&(a=[a,a]);var c=D(a),h=D(t==="shadow"&&o.shadowAnchor||o.iconAnchor||c&&c.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(o.className||""),h&&(e.style.marginLeft=-h.x+"px",e.style.marginTop=-h.y+"px"),c&&(e.style.width=c.x+"px",e.style.height=c.y+"px")},_createImg:function(e,t){return t=t||document.createElement("img"),t.src=e,t},_getIconUrl:function(e){return F.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function Lr(e){return new ot(e)}var wt=ot.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return typeof wt.imagePath!="string"&&(wt.imagePath=this._detectIconPath()),(this.options.imagePath||wt.imagePath)+ot.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var t=function(o,a,c){var h=a.exec(o);return h&&h[c]};return e=t(e,/^url\((['"])?(.+)\1\)$/,2),e&&t(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=oe("div","leaflet-default-icon-path",document.body),t=xt(e,"background-image")||xt(e,"backgroundImage");if(document.body.removeChild(e),t=this._stripUrl(t),t)return t;var o=document.querySelector('link[href$="leaflet.css"]');return o?o.href.substring(0,o.href.length-11-1):""}}),Dn=Ee.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new Fe(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Y(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&he(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,o=t._map,a=this._marker.options.autoPanSpeed,c=this._marker.options.autoPanPadding,h=Ge(t._icon),x=o.getPixelBounds(),y=o.getPixelOrigin(),b=ae(x.min._subtract(y).add(c),x.max._subtract(y).subtract(c));if(!b.contains(h)){var A=D((Math.max(b.max.x,h.x)-b.max.x)/(x.max.x-b.max.x)-(Math.min(b.min.x,h.x)-b.min.x)/(x.min.x-b.min.x),(Math.max(b.max.y,h.y)-b.max.y)/(x.max.y-b.max.y)-(Math.min(b.min.y,h.y)-b.min.y)/(x.min.y-b.min.y)).multiplyBy(a);o.panBy(A,{animate:!1}),this._draggable._newPos._add(A),this._draggable._startPos._add(A),fe(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=_(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(S(this._panRequest),this._panRequest=_(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,o=t._shadow,a=Ge(t._icon),c=t._map.layerPointToLatLng(a);o&&fe(o,a),t._latlng=c,e.latlng=c,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){S(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),Wt=Me.extend({options:{icon:new wt,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){k(this,t),this._latlng=ee(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=ee(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),o=e.icon.createIcon(this._icon),a=!1;o!==this._icon&&(this._icon&&this._removeIcon(),a=!0,e.title&&(o.title=e.title),o.tagName==="IMG"&&(o.alt=e.alt||"")),Y(o,t),e.keyboard&&(o.tabIndex="0",o.setAttribute("role","button")),this._icon=o,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&V(o,"focus",this._panOnFocus,this);var c=e.icon.createShadow(this._shadow),h=!1;c!==this._shadow&&(this._removeShadow(),h=!0),c&&(Y(c,t),c.alt=""),this._shadow=c,e.opacity<1&&this._updateOpacity(),a&&this.getPane().appendChild(this._icon),this._initInteraction(),c&&h&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&le(this._icon,"focus",this._panOnFocus,this),ue(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ue(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&fe(this._icon,e),this._shadow&&fe(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(Y(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Dn)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Dn(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&ze(this._icon,e),this._shadow&&ze(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var t=this.options.icon.options,o=t.iconSize?D(t.iconSize):D(0,0),a=t.iconAnchor?D(t.iconAnchor):D(0,0);e.panInside(this._latlng,{paddingTopLeft:a,paddingBottomRight:o.subtract(a)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Rr(e,t){return new Wt(e,t)}var $e=Me.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return k(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),qt=$e.extend({options:{fill:!0,radius:10},initialize:function(e,t){k(this,t),this._latlng=ee(e),this._radius=this.options.radius},setLatLng:function(e){var t=this._latlng;return this._latlng=ee(e),this.redraw(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return $e.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,o=this._clickTolerance(),a=[e+o,t+o];this._pxBounds=new ne(this._point.subtract(a),this._point.add(a))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Mr(e,t){return new qt(e,t)}var Ri=qt.extend({initialize:function(e,t,o){if(typeof t=="number"&&(t=d({},o,{radius:t})),k(this,t),this._latlng=ee(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new be(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:$e.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,o=this._map,a=o.options.crs;if(a.distance===de.distance){var c=Math.PI/180,h=this._mRadius/de.R/c,x=o.project([t+h,e]),y=o.project([t-h,e]),b=x.add(y).divideBy(2),A=o.unproject(b).lat,q=Math.acos((Math.cos(h*c)-Math.sin(t*c)*Math.sin(A*c))/(Math.cos(t*c)*Math.cos(A*c)))/c;(isNaN(q)||q===0)&&(q=h/Math.cos(Math.PI/180*t)),this._point=b.subtract(o.getPixelOrigin()),this._radius=isNaN(q)?0:b.x-o.project([A,e-q]).x,this._radiusY=b.y-x.y}else{var G=a.unproject(a.project(this._latlng).subtract([this._mRadius,0]));this._point=o.latLngToLayerPoint(this._latlng),this._radius=this._point.x-o.latLngToLayerPoint(G).x}this._updateBounds()}});function Ir(e,t,o){return new Ri(e,t,o)}var De=$e.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){k(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t=1/0,o=null,a=bt,c,h,x=0,y=this._parts.length;x<y;x++)for(var b=this._parts[x],A=1,q=b.length;A<q;A++){c=b[A-1],h=b[A];var G=a(e,c,h,!0);G<t&&(t=G,o=a(e,c,h))}return o&&(o.distance=Math.sqrt(t)),o},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Bn(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t=t||this._defaultShape(),e=ee(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new be,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return Te(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],o=Te(e),a=0,c=e.length;a<c;a++)o?(t[a]=ee(e[a]),this._bounds.extend(t[a])):t[a]=this._convertLatLngs(e[a]);return t},_project:function(){var e=new ne;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),t=new H(e,e);this._rawPxBounds&&(this._pxBounds=new ne([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)]))},_projectLatlngs:function(e,t,o){var a=e[0]instanceof re,c=e.length,h,x;if(a){for(x=[],h=0;h<c;h++)x[h]=this._map.latLngToLayerPoint(e[h]),o.extend(x[h]);t.push(x)}else for(h=0;h<c;h++)this._projectLatlngs(e[h],t,o)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}var t=this._parts,o,a,c,h,x,y,b;for(o=0,c=0,h=this._rings.length;o<h;o++)for(b=this._rings[o],a=0,x=b.length;a<x-1;a++)y=An(b[a],b[a+1],e,a,!0),y&&(t[c]=t[c]||[],t[c].push(y[0]),(y[1]!==b[a+1]||a===x-2)&&(t[c].push(y[1]),c++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,o=0,a=e.length;o<a;o++)e[o]=Rn(e[o],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var o,a,c,h,x,y,b=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(o=0,h=this._parts.length;o<h;o++)for(y=this._parts[o],a=0,x=y.length,c=x-1;a<x;c=a++)if(!(!t&&a===0)&&Mn(e,y[c],y[a])<=b)return!0;return!1}});function Ar(e,t){return new De(e,t)}De._flat=En;var rt=De.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ln(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(e){var t=De.prototype._convertLatLngs.call(this,e),o=t.length;return o>=2&&t[0]instanceof re&&t[0].equals(t[o-1])&&t.pop(),t},_setLatLngs:function(e){De.prototype._setLatLngs.call(this,e),Te(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Te(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,o=new H(t,t);if(e=new ne(e.min.subtract(o),e.max.add(o)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}for(var a=0,c=this._rings.length,h;a<c;a++)h=Pn(this._rings[a],e,!0),h.length&&this._parts.push(h)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t=!1,o,a,c,h,x,y,b,A;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(h=0,b=this._parts.length;h<b;h++)for(o=this._parts[h],x=0,A=o.length,y=A-1;x<A;y=x++)a=o[x],c=o[y],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(t=!t);return t||De.prototype._containsPoint.call(this,e,!0)}});function Er(e,t){return new rt(e,t)}var We=Oe.extend({initialize:function(e,t){k(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t=Z(e)?e:e.features,o,a,c;if(t){for(o=0,a=t.length;o<a;o++)c=t[o],(c.geometries||c.geometry||c.features||c.coordinates)&&this.addData(c);return this}var h=this.options;if(h.filter&&!h.filter(e))return this;var x=Nt(e,h);return x?(x.feature=$t(e),x.defaultOptions=x.options,this.resetStyle(x),h.onEachFeature&&h.onEachFeature(e,x),this.addLayer(x)):this},resetStyle:function(e){return e===void 0?this.eachLayer(this.resetStyle,this):(e.options=d({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(e,t){e.setStyle&&(typeof t=="function"&&(t=t(e.feature)),e.setStyle(t))}});function Nt(e,t){var o=e.type==="Feature"?e.geometry:e,a=o?o.coordinates:null,c=[],h=t&&t.pointToLayer,x=t&&t.coordsToLatLng||Mi,y,b,A,q;if(!a&&!o)return null;switch(o.type){case"Point":return y=x(a),Wn(h,e,y,t);case"MultiPoint":for(A=0,q=a.length;A<q;A++)y=x(a[A]),c.push(Wn(h,e,y,t));return new Oe(c);case"LineString":case"MultiLineString":return b=Zt(a,o.type==="LineString"?0:1,x),new De(b,t);case"Polygon":case"MultiPolygon":return b=Zt(a,o.type==="Polygon"?1:2,x),new rt(b,t);case"GeometryCollection":for(A=0,q=o.geometries.length;A<q;A++){var G=Nt({geometry:o.geometries[A],type:"Feature",properties:e.properties},t);G&&c.push(G)}return new Oe(c);case"FeatureCollection":for(A=0,q=o.features.length;A<q;A++){var J=Nt(o.features[A],t);J&&c.push(J)}return new Oe(c);default:throw new Error("Invalid GeoJSON object.")}}function Wn(e,t,o,a){return e?e(t,o):new Wt(o,a&&a.markersInheritOptions&&a)}function Mi(e){return new re(e[1],e[0],e[2])}function Zt(e,t,o){for(var a=[],c=0,h=e.length,x;c<h;c++)x=t?Zt(e[c],t-1,o):(o||Mi)(e[c]),a.push(x);return a}function Ii(e,t){return e=ee(e),e.alt!==void 0?[I(e.lng,t),I(e.lat,t),I(e.alt,t)]:[I(e.lng,t),I(e.lat,t)]}function Ft(e,t,o,a){for(var c=[],h=0,x=e.length;h<x;h++)c.push(t?Ft(e[h],Te(e[h])?0:t-1,o,a):Ii(e[h],a));return!t&&o&&c.length>0&&c.push(c[0].slice()),c}function st(e,t){return e.feature?d({},e.feature,{geometry:t}):$t(t)}function $t(e){return e.type==="Feature"||e.type==="FeatureCollection"?e:{type:"Feature",properties:{},geometry:e}}var Ai={toGeoJSON:function(e){return st(this,{type:"Point",coordinates:Ii(this.getLatLng(),e)})}};Wt.include(Ai),Ri.include(Ai),qt.include(Ai),De.include({toGeoJSON:function(e){var t=!Te(this._latlngs),o=Ft(this._latlngs,t?1:0,!1,e);return st(this,{type:(t?"Multi":"")+"LineString",coordinates:o})}}),rt.include({toGeoJSON:function(e){var t=!Te(this._latlngs),o=t&&!Te(this._latlngs[0]),a=Ft(this._latlngs,o?2:t?1:0,!0,e);return t||(a=[a]),st(this,{type:(o?"Multi":"")+"Polygon",coordinates:a})}}),nt.include({toMultiPoint:function(e){var t=[];return this.eachLayer(function(o){t.push(o.toGeoJSON(e).geometry.coordinates)}),st(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(t==="MultiPoint")return this.toMultiPoint(e);var o=t==="GeometryCollection",a=[];return this.eachLayer(function(c){if(c.toGeoJSON){var h=c.toGeoJSON(e);if(o)a.push(h.geometry);else{var x=$t(h);x.type==="FeatureCollection"?a.push.apply(a,x.features):a.push(x)}}}),o?st(this,{geometries:a,type:"GeometryCollection"}):{type:"FeatureCollection",features:a}}});function qn(e,t){return new We(e,t)}var Br=qn,Ht=Me.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,t,o){this._url=e,this._bounds=pe(t),k(this,o)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Y(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){ue(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&tt(this._image),this},bringToBack:function(){return this._map&&it(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=pe(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e=this._url.tagName==="IMG",t=this._image=e?this._url:oe("img");if(Y(t,"leaflet-image-layer"),this._zoomAnimated&&Y(t,"leaflet-zoom-animated"),this.options.className&&Y(t,this.options.className),t.onselectstart=v,t.onmousemove=v,t.onload=u(this.fire,this,"load"),t.onerror=u(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(t.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e){this._url=t.src;return}t.src=this._url,t.alt=this.options.alt},_animateZoom:function(e){var t=this._map.getZoomScale(e.zoom),o=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;Ue(this._image,o,t)},_reset:function(){var e=this._image,t=new ne(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),o=t.getSize();fe(e,t.min),e.style.width=o.x+"px",e.style.height=o.y+"px"},_updateOpacity:function(){ze(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),Or=function(e,t,o){return new Ht(e,t,o)},Nn=Ht.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e=this._url.tagName==="VIDEO",t=this._image=e?this._url:oe("video");if(Y(t,"leaflet-image-layer"),this._zoomAnimated&&Y(t,"leaflet-zoom-animated"),this.options.className&&Y(t,this.options.className),t.onselectstart=v,t.onmousemove=v,t.onloadeddata=u(this.fire,this,"load"),e){for(var o=t.getElementsByTagName("source"),a=[],c=0;c<o.length;c++)a.push(o[c].src);this._url=o.length>0?a:[t.src];return}Z(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(t.style,"objectFit")&&(t.style.objectFit="fill"),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop,t.muted=!!this.options.muted,t.playsInline=!!this.options.playsInline;for(var h=0;h<this._url.length;h++){var x=oe("source");x.src=this._url[h],t.appendChild(x)}}});function Dr(e,t,o){return new Nn(e,t,o)}var Zn=Ht.extend({_initImage:function(){var e=this._image=this._url;Y(e,"leaflet-image-layer"),this._zoomAnimated&&Y(e,"leaflet-zoom-animated"),this.options.className&&Y(e,this.options.className),e.onselectstart=v,e.onmousemove=v}});function Wr(e,t,o){return new Zn(e,t,o)}var Be=Me.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(e,t){e&&(e instanceof re||Z(e))?(this._latlng=ee(e),k(this,t)):(k(this,e),this._source=t),this.options.content&&(this._content=this.options.content)},openOn:function(e){return e=arguments.length?e:this._source._map,e.hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&ze(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&ze(this._container,1),this.bringToFront(),this.options.interactive&&(Y(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(ze(this._container,0),this._removeTimeout=setTimeout(u(ue,void 0,this._container),200)):ue(this._container),this.options.interactive&&(he(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=ee(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&tt(this._container),this},bringToBack:function(){return this._map&&it(this._container),this},_prepareOpen:function(e){var t=this._source;if(!t._map)return!1;if(t instanceof Oe){t=null;var o=this._source._layers;for(var a in o)if(o[a]._map){t=o[a];break}if(!t)return!1;this._source=t}if(!e)if(t.getCenter)e=t.getCenter();else if(t.getLatLng)e=t.getLatLng();else if(t.getBounds)e=t.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,t=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof t=="string")e.innerHTML=t;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=D(this.options.offset),o=this._getAnchor();this._zoomAnimated?fe(this._container,e.add(o)):t=t.add(e).add(o);var a=this._containerBottom=-t.y,c=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=a+"px",this._container.style.left=c+"px"}},_getAnchor:function(){return[0,0]}});ie.include({_initOverlay:function(e,t,o,a){var c=t;return c instanceof e||(c=new e(a).setContent(t)),o&&c.setLatLng(o),c}}),Me.include({_initOverlay:function(e,t,o,a){var c=o;return c instanceof e?(k(c,a),c._source=this):(c=t&&!a?t:new e(a,this),c.setContent(o)),c}});var Ut=Be.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return e=arguments.length?e:this._source._map,!e.hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,Be.prototype.openOn.call(this,e)},onAdd:function(e){Be.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof $e||this._source.on("preclick",Ve))},onRemove:function(e){Be.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof $e||this._source.off("preclick",Ve))},getEvents:function(){var e=Be.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",t=this._container=oe("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),o=this._wrapper=oe("div",e+"-content-wrapper",t);if(this._contentNode=oe("div",e+"-content",o),yt(t),Si(this._contentNode),V(t,"contextmenu",Ve),this._tipContainer=oe("div",e+"-tip-container",t),this._tip=oe("div",e+"-tip",this._tipContainer),this.options.closeButton){var a=this._closeButton=oe("a",e+"-close-button",t);a.setAttribute("role","button"),a.setAttribute("aria-label","Close popup"),a.href="#close",a.innerHTML='<span aria-hidden="true">&#215;</span>',V(a,"click",function(c){ye(c),this.close()},this)}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var o=e.offsetWidth;o=Math.min(o,this.options.maxWidth),o=Math.max(o,this.options.minWidth),t.width=o+1+"px",t.whiteSpace="",t.height="";var a=e.offsetHeight,c=this.options.maxHeight,h="leaflet-popup-scrolled";c&&a>c?(t.height=c+"px",Y(e,h)):he(e,h),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),o=this._getAnchor();fe(this._container,t.add(o))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var e=this._map,t=parseInt(xt(this._container,"marginBottom"),10)||0,o=this._container.offsetHeight+t,a=this._containerWidth,c=new H(this._containerLeft,-o-this._containerBottom);c._add(Ge(this._container));var h=e.layerPointToContainerPoint(c),x=D(this.options.autoPanPadding),y=D(this.options.autoPanPaddingTopLeft||x),b=D(this.options.autoPanPaddingBottomRight||x),A=e.getSize(),q=0,G=0;h.x+a+b.x>A.x&&(q=h.x+a-A.x+b.x),h.x-q-y.x<0&&(q=h.x-y.x),h.y+o+b.y>A.y&&(G=h.y+o-A.y+b.y),h.y-G-y.y<0&&(G=h.y-y.y),(q||G)&&(this.options.keepInView&&(this._autopanning=!0),e.fire("autopanstart").panBy([q,G]))}},_getAnchor:function(){return D(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),qr=function(e,t){return new Ut(e,t)};ie.mergeOptions({closePopupOnClick:!0}),ie.include({openPopup:function(e,t,o){return this._initOverlay(Ut,e,t,o).openOn(this),this},closePopup:function(e){return e=arguments.length?e:this._popup,e&&e.close(),this}}),Me.include({bindPopup:function(e,t){return this._popup=this._initOverlay(Ut,this._popup,e,t),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&(this instanceof Oe||(this._popup._source=this),this._popup._prepareOpen(e||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(!(!this._popup||!this._map)){Ke(e);var t=e.layer||e.target;if(this._popup._source===t&&!(t instanceof $e)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng);return}this._popup._source=t,this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){e.originalEvent.keyCode===13&&this._openPopup(e)}});var Gt=Be.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){Be.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){Be.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=Be.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip",t=e+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=oe("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+m(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var t,o,a=this._map,c=this._container,h=a.latLngToContainerPoint(a.getCenter()),x=a.layerPointToContainerPoint(e),y=this.options.direction,b=c.offsetWidth,A=c.offsetHeight,q=D(this.options.offset),G=this._getAnchor();y==="top"?(t=b/2,o=A):y==="bottom"?(t=b/2,o=0):y==="center"?(t=b/2,o=A/2):y==="right"?(t=0,o=A/2):y==="left"?(t=b,o=A/2):x.x<h.x?(y="right",t=0,o=A/2):(y="left",t=b+(q.x+G.x)*2,o=A/2),e=e.subtract(D(t,o,!0)).add(q).add(G),he(c,"leaflet-tooltip-right"),he(c,"leaflet-tooltip-left"),he(c,"leaflet-tooltip-top"),he(c,"leaflet-tooltip-bottom"),Y(c,"leaflet-tooltip-"+y),fe(c,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&ze(this._container,e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)},_getAnchor:function(){return D(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Nr=function(e,t){return new Gt(e,t)};ie.include({openTooltip:function(e,t,o){return this._initOverlay(Gt,e,t,o).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),Me.include({bindTooltip:function(e,t){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Gt,this._tooltip,e,t),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(!(!e&&this._tooltipHandlersAdded)){var t=e?"off":"on",o={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?o.add=this._openTooltip:(o.mouseover=this._openTooltip,o.mouseout=this.closeTooltip,o.click=this._openTooltip,this._map?this._addFocusListeners():o.add=this._addFocusListeners),this._tooltip.options.sticky&&(o.mousemove=this._moveTooltip),this[t](o),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&(this instanceof Oe||(this._tooltip._source=this),this._tooltip._prepareOpen(e)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(e){var t=typeof e.getElement=="function"&&e.getElement();t&&(V(t,"focus",function(){this._tooltip._source=e,this.openTooltip()},this),V(t,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(e){var t=typeof e.getElement=="function"&&e.getElement();t&&t.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(e){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var t=this;this._map.once("moveend",function(){t._openOnceFlag=!1,t._openTooltip(e)});return}this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0)}},_moveTooltip:function(e){var t=e.latlng,o,a;this._tooltip.options.sticky&&e.originalEvent&&(o=this._map.mouseEventToContainerPoint(e.originalEvent),a=this._map.containerPointToLayerPoint(o),t=this._map.layerPointToLatLng(a)),this._tooltip.setLatLng(t)}});var Fn=ot.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var t=e&&e.tagName==="DIV"?e:document.createElement("div"),o=this.options;if(o.html instanceof Element?(It(t),t.appendChild(o.html)):t.innerHTML=o.html!==!1?o.html:"",o.bgPos){var a=D(o.bgPos);t.style.backgroundPosition=-a.x+"px "+-a.y+"px"}return this._setIconStyles(t,"icon"),t},createShadow:function(){return null}});function Zr(e){return new Fn(e)}ot.Default=wt;var St=Me.extend({options:{tileSize:256,opacity:1,updateWhenIdle:F.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){k(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),ue(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(tt(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(it(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=f(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof H?e:new H(e,e)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var t=this.getPane().children,o=-e(-1/0,1/0),a=0,c=t.length,h;a<c;a++)h=t[a].style.zIndex,t[a]!==this._container&&h&&(o=e(o,+h));isFinite(o)&&(this.options.zIndex=o+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!F.ielt9){ze(this._container,this.options.opacity);var e=+new Date,t=!1,o=!1;for(var a in this._tiles){var c=this._tiles[a];if(!(!c.current||!c.loaded)){var h=Math.min(1,(e-c.loaded)/200);ze(c.el,h),h<1?t=!0:(c.active?o=!0:this._onOpaqueTile(c),c.active=!0)}}o&&!this._noPrune&&this._pruneTiles(),t&&(S(this._fadeFrame),this._fadeFrame=_(this._updateOpacity,this))}},_onOpaqueTile:v,_initContainer:function(){this._container||(this._container=oe("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,t=this.options.maxZoom;if(e!==void 0){for(var o in this._levels)o=Number(o),this._levels[o].el.children.length||o===e?(this._levels[o].el.style.zIndex=t-Math.abs(e-o),this._onUpdateLevel(o)):(ue(this._levels[o].el),this._removeTilesAtZoom(o),this._onRemoveLevel(o),delete this._levels[o]);var a=this._levels[e],c=this._map;return a||(a=this._levels[e]={},a.el=oe("div","leaflet-tile-container leaflet-zoom-animated",this._container),a.el.style.zIndex=t,a.origin=c.project(c.unproject(c.getPixelOrigin()),e).round(),a.zoom=e,this._setZoomTransform(a,c.getCenter(),c.getZoom()),v(a.el.offsetWidth),this._onCreateLevel(a)),this._level=a,a}},_onUpdateLevel:v,_onRemoveLevel:v,_onCreateLevel:v,_pruneTiles:function(){if(this._map){var e,t,o=this._map.getZoom();if(o>this.options.maxZoom||o<this.options.minZoom){this._removeAllTiles();return}for(e in this._tiles)t=this._tiles[e],t.retain=t.current;for(e in this._tiles)if(t=this._tiles[e],t.current&&!t.active){var a=t.coords;this._retainParent(a.x,a.y,a.z,a.z-5)||this._retainChildren(a.x,a.y,a.z,a.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}},_removeTilesAtZoom:function(e){for(var t in this._tiles)this._tiles[t].coords.z===e&&this._removeTile(t)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)ue(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,t,o,a){var c=Math.floor(e/2),h=Math.floor(t/2),x=o-1,y=new H(+c,+h);y.z=+x;var b=this._tileCoordsToKey(y),A=this._tiles[b];return A&&A.active?(A.retain=!0,!0):(A&&A.loaded&&(A.retain=!0),x>a?this._retainParent(c,h,x,a):!1)},_retainChildren:function(e,t,o,a){for(var c=2*e;c<2*e+2;c++)for(var h=2*t;h<2*t+2;h++){var x=new H(c,h);x.z=o+1;var y=this._tileCoordsToKey(x),b=this._tiles[y];if(b&&b.active){b.retain=!0;continue}else b&&b.loaded&&(b.retain=!0);o+1<a&&this._retainChildren(c,h,o+1,a)}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var t=this.options;return t.minNativeZoom!==void 0&&e<t.minNativeZoom?t.minNativeZoom:t.maxNativeZoom!==void 0&&t.maxNativeZoom<e?t.maxNativeZoom:e},_setView:function(e,t,o,a){var c=Math.round(t);this.options.maxZoom!==void 0&&c>this.options.maxZoom||this.options.minZoom!==void 0&&c<this.options.minZoom?c=void 0:c=this._clampZoom(c);var h=this.options.updateWhenZooming&&c!==this._tileZoom;(!a||h)&&(this._tileZoom=c,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),c!==void 0&&this._update(e),o||this._pruneTiles(),this._noPrune=!!o),this._setZoomTransforms(e,t)},_setZoomTransforms:function(e,t){for(var o in this._levels)this._setZoomTransform(this._levels[o],e,t)},_setZoomTransform:function(e,t,o){var a=this._map.getZoomScale(o,e.zoom),c=e.origin.multiplyBy(a).subtract(this._map._getNewPixelOrigin(t,o)).round();F.any3d?Ue(e.el,c,a):fe(e.el,c)},_resetGrid:function(){var e=this._map,t=e.options.crs,o=this._tileSize=this.getTileSize(),a=this._tileZoom,c=this._map.getPixelWorldBounds(this._tileZoom);c&&(this._globalTileRange=this._pxBoundsToTileRange(c)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],a).x/o.x),Math.ceil(e.project([0,t.wrapLng[1]],a).x/o.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],a).y/o.x),Math.ceil(e.project([t.wrapLat[1],0],a).y/o.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(e){var t=this._map,o=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),a=t.getZoomScale(o,this._tileZoom),c=t.project(e,this._tileZoom).floor(),h=t.getSize().divideBy(a*2);return new ne(c.subtract(h),c.add(h))},_update:function(e){var t=this._map;if(t){var o=this._clampZoom(t.getZoom());if(e===void 0&&(e=t.getCenter()),this._tileZoom!==void 0){var a=this._getTiledPixelBounds(e),c=this._pxBoundsToTileRange(a),h=c.getCenter(),x=[],y=this.options.keepBuffer,b=new ne(c.getBottomLeft().subtract([y,-y]),c.getTopRight().add([y,-y]));if(!(isFinite(c.min.x)&&isFinite(c.min.y)&&isFinite(c.max.x)&&isFinite(c.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var A in this._tiles){var q=this._tiles[A].coords;(q.z!==this._tileZoom||!b.contains(new H(q.x,q.y)))&&(this._tiles[A].current=!1)}if(Math.abs(o-this._tileZoom)>1){this._setView(e,o);return}for(var G=c.min.y;G<=c.max.y;G++)for(var J=c.min.x;J<=c.max.x;J++){var we=new H(J,G);if(we.z=this._tileZoom,!!this._isValidTile(we)){var ge=this._tiles[this._tileCoordsToKey(we)];ge?ge.current=!0:x.push(we)}}if(x.sort(function(je,lt){return je.distanceTo(h)-lt.distanceTo(h)}),x.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Pe=document.createDocumentFragment();for(J=0;J<x.length;J++)this._addTile(x[J],Pe);this._level.el.appendChild(Pe)}}}},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var o=this._globalTileRange;if(!t.wrapLng&&(e.x<o.min.x||e.x>o.max.x)||!t.wrapLat&&(e.y<o.min.y||e.y>o.max.y))return!1}if(!this.options.bounds)return!0;var a=this._tileCoordsToBounds(e);return pe(this.options.bounds).overlaps(a)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var t=this._map,o=this.getTileSize(),a=e.scaleBy(o),c=a.add(o),h=t.unproject(a,e.z),x=t.unproject(c,e.z);return[h,x]},_tileCoordsToBounds:function(e){var t=this._tileCoordsToNwSe(e),o=new be(t[0],t[1]);return this.options.noWrap||(o=this._map.wrapLatLngBounds(o)),o},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var t=e.split(":"),o=new H(+t[0],+t[1]);return o.z=+t[2],o},_removeTile:function(e){var t=this._tiles[e];t&&(ue(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){Y(e,"leaflet-tile");var t=this.getTileSize();e.style.width=t.x+"px",e.style.height=t.y+"px",e.onselectstart=v,e.onmousemove=v,F.ielt9&&this.options.opacity<1&&ze(e,this.options.opacity)},_addTile:function(e,t){var o=this._getTilePos(e),a=this._tileCoordsToKey(e),c=this.createTile(this._wrapCoords(e),u(this._tileReady,this,e));this._initTile(c),this.createTile.length<2&&_(u(this._tileReady,this,e,null,c)),fe(c,o),this._tiles[a]={el:c,coords:e,current:!0},t.appendChild(c),this.fire("tileloadstart",{tile:c,coords:e})},_tileReady:function(e,t,o){t&&this.fire("tileerror",{error:t,tile:o,coords:e});var a=this._tileCoordsToKey(e);o=this._tiles[a],o&&(o.loaded=+new Date,this._map._fadeAnimated?(ze(o.el,0),S(this._fadeFrame),this._fadeFrame=_(this._updateOpacity,this)):(o.active=!0,this._pruneTiles()),t||(Y(o.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:o.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),F.ielt9||!this._map._fadeAnimated?_(this._pruneTiles,this):setTimeout(u(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var t=new H(this._wrapX?P(e.x,this._wrapX):e.x,this._wrapY?P(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToTileRange:function(e){var t=this.getTileSize();return new ne(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function Fr(e){return new St(e)}var at=St.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,t){this._url=e,t=k(this,t),t.detectRetina&&F.retina&&t.maxZoom>0?(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom=Math.min(t.maxZoom,t.minZoom+1)):(t.zoomOffset++,t.maxZoom=Math.max(t.minZoom,t.maxZoom-1)),t.minZoom=Math.max(0,t.minZoom)):t.zoomReverse?t.minZoom=Math.min(t.maxZoom,t.minZoom):t.maxZoom=Math.max(t.minZoom,t.maxZoom),typeof t.subdomains=="string"&&(t.subdomains=t.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,t){return this._url===e&&t===void 0&&(t=!0),this._url=e,t||this.redraw(),this},createTile:function(e,t){var o=document.createElement("img");return V(o,"load",u(this._tileOnLoad,this,t,o)),V(o,"error",u(this._tileOnError,this,t,o)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(o.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(o.referrerPolicy=this.options.referrerPolicy),o.alt="",o.src=this.getTileUrl(e),o},getTileUrl:function(e){var t={r:F.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var o=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=o),t["-y"]=o}return W(this._url,d(t,this.options))},_tileOnLoad:function(e,t){F.ielt9?setTimeout(u(e,this,null,t),0):e(null,t)},_tileOnError:function(e,t,o){var a=this.options.errorTileUrl;a&&t.getAttribute("src")!==a&&(t.src=a),e(o,t)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,t=this.options.maxZoom,o=this.options.zoomReverse,a=this.options.zoomOffset;return o&&(e=t-e),e+a},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&(t=this._tiles[e].el,t.onload=v,t.onerror=v,!t.complete)){t.src=z;var o=this._tiles[e].coords;ue(t),delete this._tiles[e],this.fire("tileabort",{tile:t,coords:o})}},_removeTile:function(e){var t=this._tiles[e];if(t)return t.el.setAttribute("src",z),St.prototype._removeTile.call(this,e)},_tileReady:function(e,t,o){if(!(!this._map||o&&o.getAttribute("src")===z))return St.prototype._tileReady.call(this,e,t,o)}});function $n(e,t){return new at(e,t)}var Hn=at.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,t){this._url=e;var o=d({},this.defaultWmsParams);for(var a in t)a in this.options||(o[a]=t[a]);t=k(this,t);var c=t.detectRetina&&F.retina?2:1,h=this.getTileSize();o.width=h.x*c,o.height=h.y*c,this.wmsParams=o},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,at.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToNwSe(e),o=this._crs,a=ae(o.project(t[0]),o.project(t[1])),c=a.min,h=a.max,x=(this._wmsVersion>=1.3&&this._crs===On?[c.y,c.x,h.y,h.x]:[c.x,c.y,h.x,h.y]).join(","),y=at.prototype.getTileUrl.call(this,e);return y+R(this.wmsParams,y,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+x},setParams:function(e,t){return d(this.wmsParams,e),t||this.redraw(),this}});function $r(e,t){return new Hn(e,t)}at.WMS=Hn,$n.wms=$r;var qe=Me.extend({options:{padding:.1},initialize:function(e){k(this,e),m(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Y(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var o=this._map.getZoomScale(t,this._zoom),a=this._map.getSize().multiplyBy(.5+this.options.padding),c=this._map.project(this._center,t),h=a.multiplyBy(-o).add(c).subtract(this._map._getNewPixelOrigin(e,t));F.any3d?Ue(this._container,h,o):fe(this._container,h)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var e in this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,t=this._map.getSize(),o=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new ne(o,o.add(t.multiplyBy(1+e*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Un=qe.extend({options:{tolerance:0},getEvents:function(){var e=qe.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){qe.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");V(e,"mousemove",this._onMouseMove,this),V(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),V(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){S(this._redrawRequest),delete this._ctx,ue(this._container),le(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var e;this._redrawBounds=null;for(var t in this._layers)e=this._layers[t],e._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){qe.prototype._update.call(this);var e=this._bounds,t=this._container,o=e.getSize(),a=F.retina?2:1;fe(t,e.min),t.width=a*o.x,t.height=a*o.y,t.style.width=o.x+"px",t.style.height=o.y+"px",F.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){qe.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[m(e)]=e;var t=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var t=e._order,o=t.next,a=t.prev;o?o.prev=a:this._drawLast=a,a?a.next=o:this._drawFirst=o,delete e._order,delete this._layers[m(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if(typeof e.options.dashArray=="string"){var t=e.options.dashArray.split(/[, ]+/),o=[],a,c;for(c=0;c<t.length;c++){if(a=Number(t[c]),isNaN(a))return;o.push(a)}e.options._dashArray=o}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||_(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var t=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ne,this._redrawBounds.extend(e._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(e._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var t=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,t=this._redrawBounds;if(this._ctx.save(),t){var o=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,o.x,o.y),this._ctx.clip()}this._drawing=!0;for(var a=this._drawFirst;a;a=a.next)e=a.layer,(!t||e._pxBounds&&e._pxBounds.intersects(t))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,t){if(this._drawing){var o,a,c,h,x=e._parts,y=x.length,b=this._ctx;if(y){for(b.beginPath(),o=0;o<y;o++){for(a=0,c=x[o].length;a<c;a++)h=x[o][a],b[a?"lineTo":"moveTo"](h.x,h.y);t&&b.closePath()}this._fillStroke(b,e)}}},_updateCircle:function(e){if(!(!this._drawing||e._empty())){var t=e._point,o=this._ctx,a=Math.max(Math.round(e._radius),1),c=(Math.max(Math.round(e._radiusY),1)||a)/a;c!==1&&(o.save(),o.scale(1,c)),o.beginPath(),o.arc(t.x,t.y/c,a,0,Math.PI*2,!1),c!==1&&o.restore(),this._fillStroke(o,e)}},_fillStroke:function(e,t){var o=t.options;o.fill&&(e.globalAlpha=o.fillOpacity,e.fillStyle=o.fillColor||o.color,e.fill(o.fillRule||"evenodd")),o.stroke&&o.weight!==0&&(e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.globalAlpha=o.opacity,e.lineWidth=o.weight,e.strokeStyle=o.color,e.lineCap=o.lineCap,e.lineJoin=o.lineJoin,e.stroke())},_onClick:function(e){for(var t=this._map.mouseEventToLayerPoint(e),o,a,c=this._drawFirst;c;c=c.next)o=c.layer,o.options.interactive&&o._containsPoint(t)&&(!(e.type==="click"||e.type==="preclick")||!this._map._draggableMoved(o))&&(a=o);this._fireEvent(a?[a]:!1,e)},_onMouseMove:function(e){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var t=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,t)}},_handleMouseOut:function(e){var t=this._hoveredLayer;t&&(he(this._container,"leaflet-interactive"),this._fireEvent([t],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,t){if(!this._mouseHoverThrottled){for(var o,a,c=this._drawFirst;c;c=c.next)o=c.layer,o.options.interactive&&o._containsPoint(t)&&(a=o);a!==this._hoveredLayer&&(this._handleMouseOut(e),a&&(Y(this._container,"leaflet-interactive"),this._fireEvent([a],e,"mouseover"),this._hoveredLayer=a)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,e),this._mouseHoverThrottled=!0,setTimeout(u(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(e,t,o){this._map._fireDOMEvent(t,o||t.type,e)},_bringToFront:function(e){var t=e._order;if(t){var o=t.next,a=t.prev;if(o)o.prev=a;else return;a?a.next=o:o&&(this._drawFirst=o),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(e)}},_bringToBack:function(e){var t=e._order;if(t){var o=t.next,a=t.prev;if(a)a.next=o;else return;o?o.prev=a:a&&(this._drawLast=a),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(e)}}});function Gn(e){return F.canvas?new Un(e):null}var jt=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch{}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Hr={_initContainer:function(){this._container=oe("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(qe.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var t=e._container=jt("shape");Y(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",e._path=jt("path"),t.appendChild(e._path),this._updateStyle(e),this._layers[m(e)]=e},_addPath:function(e){var t=e._container;this._container.appendChild(t),e.options.interactive&&e.addInteractiveTarget(t)},_removePath:function(e){var t=e._container;ue(t),e.removeInteractiveTarget(t),delete this._layers[m(e)]},_updateStyle:function(e){var t=e._stroke,o=e._fill,a=e.options,c=e._container;c.stroked=!!a.stroke,c.filled=!!a.fill,a.stroke?(t||(t=e._stroke=jt("stroke")),c.appendChild(t),t.weight=a.weight+"px",t.color=a.color,t.opacity=a.opacity,a.dashArray?t.dashStyle=Z(a.dashArray)?a.dashArray.join(" "):a.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=a.lineCap.replace("butt","flat"),t.joinstyle=a.lineJoin):t&&(c.removeChild(t),e._stroke=null),a.fill?(o||(o=e._fill=jt("fill")),c.appendChild(o),o.color=a.fillColor||a.color,o.opacity=a.fillOpacity):o&&(c.removeChild(o),e._fill=null)},_updateCircle:function(e){var t=e._point.round(),o=Math.round(e._radius),a=Math.round(e._radiusY||o);this._setPath(e,e._empty()?"M0 0":"AL "+t.x+","+t.y+" "+o+","+a+" 0,"+65535*360)},_setPath:function(e,t){e._path.v=t},_bringToFront:function(e){tt(e._container)},_bringToBack:function(e){it(e._container)}},Vt=F.vml?jt:Yi,Ct=qe.extend({_initContainer:function(){this._container=Vt("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Vt("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){ue(this._container),le(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){qe.prototype._update.call(this);var e=this._bounds,t=e.getSize(),o=this._container;(!this._svgSize||!this._svgSize.equals(t))&&(this._svgSize=t,o.setAttribute("width",t.x),o.setAttribute("height",t.y)),fe(o,e.min),o.setAttribute("viewBox",[e.min.x,e.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(e){var t=e._path=Vt("path");e.options.className&&Y(t,e.options.className),e.options.interactive&&Y(t,"leaflet-interactive"),this._updateStyle(e),this._layers[m(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){ue(e._path),e.removeInteractiveTarget(e._path),delete this._layers[m(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,o=e.options;t&&(o.stroke?(t.setAttribute("stroke",o.color),t.setAttribute("stroke-opacity",o.opacity),t.setAttribute("stroke-width",o.weight),t.setAttribute("stroke-linecap",o.lineCap),t.setAttribute("stroke-linejoin",o.lineJoin),o.dashArray?t.setAttribute("stroke-dasharray",o.dashArray):t.removeAttribute("stroke-dasharray"),o.dashOffset?t.setAttribute("stroke-dashoffset",o.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),o.fill?(t.setAttribute("fill",o.fillColor||o.color),t.setAttribute("fill-opacity",o.fillOpacity),t.setAttribute("fill-rule",o.fillRule||"evenodd")):t.setAttribute("fill","none"))},_updatePoly:function(e,t){this._setPath(e,Ji(e._parts,t))},_updateCircle:function(e){var t=e._point,o=Math.max(Math.round(e._radius),1),a=Math.max(Math.round(e._radiusY),1)||o,c="a"+o+","+a+" 0 1,0 ",h=e._empty()?"M0 0":"M"+(t.x-o)+","+t.y+c+o*2+",0 "+c+-o*2+",0 ";this._setPath(e,h)},_setPath:function(e,t){e._path.setAttribute("d",t)},_bringToFront:function(e){tt(e._path)},_bringToBack:function(e){it(e._path)}});F.vml&&Ct.include(Hr);function Vn(e){return F.svg||F.vml?new Ct(e):null}ie.include({getRenderer:function(e){var t=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return t||(t=this._renderer=this._createRenderer()),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(e){if(e==="overlayPane"||e===void 0)return!1;var t=this._paneRenderers[e];return t===void 0&&(t=this._createRenderer({pane:e}),this._paneRenderers[e]=t),t},_createRenderer:function(e){return this.options.preferCanvas&&Gn(e)||Vn(e)}});var Kn=rt.extend({initialize:function(e,t){rt.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return e=pe(e),[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function Ur(e,t){return new Kn(e,t)}Ct.create=Vt,Ct.pointsToPath=Ji,We.geometryToLayer=Nt,We.coordsToLatLng=Mi,We.coordsToLatLngs=Zt,We.latLngToCoords=Ii,We.latLngsToCoords=Ft,We.getFeature=st,We.asFeature=$t,ie.mergeOptions({boxZoom:!0});var Yn=Ee.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){V(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){le(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){ue(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||e.which!==1&&e.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),mt(),xi(),this._startPoint=this._map.mouseEventToContainerPoint(e),V(document,{contextmenu:Ke,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=oe("div","leaflet-zoom-box",this._container),Y(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var t=new ne(this._point,this._startPoint),o=t.getSize();fe(this._box,t.min),this._box.style.width=o.x+"px",this._box.style.height=o.y+"px"},_finish:function(){this._moved&&(ue(this._box),he(this._container,"leaflet-crosshair")),gt(),mi(),le(document,{contextmenu:Ke,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if(!(e.which!==1&&e.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(u(this._resetState,this),0);var t=new be(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t})}},_onKeyDown:function(e){e.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});ie.addInitHook("addHandler","boxZoom",Yn),ie.mergeOptions({doubleClickZoom:!0});var Jn=Ee.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,o=t.getZoom(),a=t.options.zoomDelta,c=e.originalEvent.shiftKey?o-a:o+a;t.options.doubleClickZoom==="center"?t.setZoom(c):t.setZoomAround(e.containerPoint,c)}});ie.addInitHook("addHandler","doubleClickZoom",Jn),ie.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Qn=Ee.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new Fe(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}Y(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){he(this._map._container,"leaflet-grab"),he(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=pe(this._map.options.maxBounds);this._offsetLimit=ae(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var t=this._lastTime=+new Date,o=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(o),this._times.push(t),this._prunePositions(t)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,t){return e-(e-t)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var e=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;e.x<t.min.x&&(e.x=this._viscousLimit(e.x,t.min.x)),e.y<t.min.y&&(e.y=this._viscousLimit(e.y,t.min.y)),e.x>t.max.x&&(e.x=this._viscousLimit(e.x,t.max.x)),e.y>t.max.y&&(e.y=this._viscousLimit(e.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,t=Math.round(e/2),o=this._initialWorldOffset,a=this._draggable._newPos.x,c=(a-t+o)%e+t-o,h=(a+t+o)%e-t-o,x=Math.abs(c+o)<Math.abs(h+o)?c:h;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=x},_onDragEnd:function(e){var t=this._map,o=t.options,a=!o.inertia||e.noInertia||this._times.length<2;if(t.fire("dragend",e),a)t.fire("moveend");else{this._prunePositions(+new Date);var c=this._lastPos.subtract(this._positions[0]),h=(this._lastTime-this._times[0])/1e3,x=o.easeLinearity,y=c.multiplyBy(x/h),b=y.distanceTo([0,0]),A=Math.min(o.inertiaMaxSpeed,b),q=y.multiplyBy(A/b),G=A/(o.inertiaDeceleration*x),J=q.multiplyBy(-G/2).round();!J.x&&!J.y?t.fire("moveend"):(J=t._limitOffset(J,t.options.maxBounds),_(function(){t.panBy(J,{duration:G,easeLinearity:x,noMoveStart:!0,animate:!0})}))}}});ie.addInitHook("addHandler","dragging",Qn),ie.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Xn=Ee.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),V(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),le(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,t=document.documentElement,o=e.scrollTop||t.scrollTop,a=e.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(a,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var t=this._panKeys={},o=this.keyCodes,a,c;for(a=0,c=o.left.length;a<c;a++)t[o.left[a]]=[-1*e,0];for(a=0,c=o.right.length;a<c;a++)t[o.right[a]]=[e,0];for(a=0,c=o.down.length;a<c;a++)t[o.down[a]]=[0,e];for(a=0,c=o.up.length;a<c;a++)t[o.up[a]]=[0,-1*e]},_setZoomDelta:function(e){var t=this._zoomKeys={},o=this.keyCodes,a,c;for(a=0,c=o.zoomIn.length;a<c;a++)t[o.zoomIn[a]]=e;for(a=0,c=o.zoomOut.length;a<c;a++)t[o.zoomOut[a]]=-e},_addHooks:function(){V(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){le(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t=e.keyCode,o=this._map,a;if(t in this._panKeys){if(!o._panAnim||!o._panAnim._inProgress)if(a=this._panKeys[t],e.shiftKey&&(a=D(a).multiplyBy(3)),o.options.maxBounds&&(a=o._limitOffset(D(a),o.options.maxBounds)),o.options.worldCopyJump){var c=o.wrapLatLng(o.unproject(o.project(o.getCenter()).add(a)));o.panTo(c)}else o.panBy(a)}else if(t in this._zoomKeys)o.setZoom(o.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[t]);else if(t===27&&o._popup&&o._popup.options.closeOnEscapeKey)o.closePopup();else return;Ke(e)}}});ie.addInitHook("addHandler","keyboard",Xn),ie.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var eo=Ee.extend({addHooks:function(){V(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){le(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var t=jn(e),o=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var a=Math.max(o-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(u(this._performZoom,this),a),Ke(e)},_performZoom:function(){var e=this._map,t=e.getZoom(),o=this._map.options.zoomSnap||0;e._stop();var a=this._delta/(this._map.options.wheelPxPerZoomLevel*4),c=4*Math.log(2/(1+Math.exp(-Math.abs(a))))/Math.LN2,h=o?Math.ceil(c/o)*o:c,x=e._limitZoom(t+(this._delta>0?h:-h))-t;this._delta=0,this._startTime=null,x&&(e.options.scrollWheelZoom==="center"?e.setZoom(t+x):e.setZoomAround(this._lastMousePos,t+x))}});ie.addInitHook("addHandler","scrollWheelZoom",eo);var Gr=600;ie.mergeOptions({tapHold:F.touchNative&&F.safari&&F.mobile,tapTolerance:15});var to=Ee.extend({addHooks:function(){V(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){le(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),e.touches.length===1){var t=e.touches[0];this._startPos=this._newPos=new H(t.clientX,t.clientY),this._holdTimeout=setTimeout(u(function(){this._cancel(),this._isTapValid()&&(V(document,"touchend",ye),V(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",t))},this),Gr),V(document,"touchend touchcancel contextmenu",this._cancel,this),V(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){le(document,"touchend",ye),le(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),le(document,"touchend touchcancel contextmenu",this._cancel,this),le(document,"touchmove",this._onMove,this)},_onMove:function(e){var t=e.touches[0];this._newPos=new H(t.clientX,t.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,t){var o=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});o._simulated=!0,t.target.dispatchEvent(o)}});ie.addInitHook("addHandler","tapHold",to),ie.mergeOptions({touchZoom:F.touch,bounceAtZoomLimits:!0});var io=Ee.extend({addHooks:function(){Y(this._map._container,"leaflet-touch-zoom"),V(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){he(this._map._container,"leaflet-touch-zoom"),le(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(!(!e.touches||e.touches.length!==2||t._animatingZoom||this._zooming)){var o=t.mouseEventToContainerPoint(e.touches[0]),a=t.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),t.options.touchZoom!=="center"&&(this._pinchStartLatLng=t.containerPointToLatLng(o.add(a)._divideBy(2))),this._startDist=o.distanceTo(a),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),V(document,"touchmove",this._onTouchMove,this),V(document,"touchend touchcancel",this._onTouchEnd,this),ye(e)}},_onTouchMove:function(e){if(!(!e.touches||e.touches.length!==2||!this._zooming)){var t=this._map,o=t.mouseEventToContainerPoint(e.touches[0]),a=t.mouseEventToContainerPoint(e.touches[1]),c=o.distanceTo(a)/this._startDist;if(this._zoom=t.getScaleZoom(c,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&c<1||this._zoom>t.getMaxZoom()&&c>1)&&(this._zoom=t._limitZoom(this._zoom)),t.options.touchZoom==="center"){if(this._center=this._startLatLng,c===1)return}else{var h=o._add(a)._divideBy(2)._subtract(this._centerPoint);if(c===1&&h.x===0&&h.y===0)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(h),this._zoom)}this._moved||(t._moveStart(!0,!1),this._moved=!0),S(this._animRequest);var x=u(t._move,t,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=_(x,this,!0),ye(e)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,S(this._animRequest),le(document,"touchmove",this._onTouchMove,this),le(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});ie.addInitHook("addHandler","touchZoom",io),ie.BoxZoom=Yn,ie.DoubleClickZoom=Jn,ie.Drag=Qn,ie.Keyboard=Xn,ie.ScrollWheelZoom=eo,ie.TapHold=to,ie.TouchZoom=io,s.Bounds=ne,s.Browser=F,s.CRS=me,s.Canvas=Un,s.Circle=Ri,s.CircleMarker=qt,s.Class=M,s.Control=Re,s.DivIcon=Fn,s.DivOverlay=Be,s.DomEvent=ur,s.DomUtil=dr,s.Draggable=Fe,s.Evented=te,s.FeatureGroup=Oe,s.GeoJSON=We,s.GridLayer=St,s.Handler=Ee,s.Icon=ot,s.ImageOverlay=Ht,s.LatLng=re,s.LatLngBounds=be,s.Layer=Me,s.LayerGroup=nt,s.LineUtil=jr,s.Map=ie,s.Marker=Wt,s.Mixin=_r,s.Path=$e,s.Point=H,s.PolyUtil=yr,s.Polygon=rt,s.Polyline=De,s.Popup=Ut,s.PosAnimation=Cn,s.Projection=Cr,s.Rectangle=Kn,s.Renderer=qe,s.SVG=Ct,s.SVGOverlay=Zn,s.TileLayer=at,s.Tooltip=Gt,s.Transformation=ni,s.Util=E,s.VideoOverlay=Nn,s.bind=u,s.bounds=ae,s.canvas=Gn,s.circle=Ir,s.circleMarker=Mr,s.control=vt,s.divIcon=Zr,s.extend=d,s.featureGroup=Pr,s.geoJSON=qn,s.geoJson=Br,s.gridLayer=Fr,s.icon=Lr,s.imageOverlay=Or,s.latLng=ee,s.latLngBounds=pe,s.layerGroup=Tr,s.map=pr,s.marker=Rr,s.point=D,s.polygon=Er,s.polyline=Ar,s.popup=qr,s.rectangle=Ur,s.setOptions=k,s.stamp=m,s.svg=Vn,s.svgOverlay=Wr,s.tileLayer=$n,s.tooltip=Nr,s.transformation=pt,s.version=l,s.videoOverlay=Dr;var Vr=window.L;s.noConflict=function(){return window.L=Vr,this},window.L=s})})(Ni,Ni.exports);var Lt=Ni.exports;const Gi=as(Lt);function Vi(n,r,s){return Object.freeze({instance:n,context:r,container:s})}function Ki(n,r){return r==null?function(l,d){const p=O.useRef();return p.current||(p.current=n(l,d)),p}:function(l,d){const p=O.useRef();p.current||(p.current=n(l,d));const u=O.useRef(l),{instance:g}=p.current;return O.useEffect(function(){u.current!==l&&(r(g,l,u.current),u.current=l)},[g,l,d]),p}}function Ro(n,r){O.useEffect(function(){return(r.layerContainer??r.map).addLayer(n.instance),function(){var p;(p=r.layerContainer)==null||p.removeLayer(n.instance),r.map.removeLayer(n.instance)}},[r,n])}function Mo(n){return function(s){const l=Hi(),d=n(Ui(s,l),l);return la(l.map,s.attribution),Lo(d.current,s.eventHandlers),Ro(d.current,l),d}}function ha(n,r){const s=O.useRef();O.useEffect(function(){if(r.pathOptions!==s.current){const d=r.pathOptions??{};n.instance.setStyle(d),s.current=d}},[n,r])}function fa(n){return function(s){const l=Hi(),d=n(Ui(s,l),l);return Lo(d.current,s.eventHandlers),Ro(d.current,l),ha(d.current,s),d}}function xa(n,r){const s=Ki(n,r),l=Mo(s);return Po(l)}function ma(n,r){const s=Ki(n,r),l=fa(s);return Po(l)}function ga(n,r){const s=Ki(n,r),l=Mo(s);return pa(l)}function _a(n,r,s){const{opacity:l,zIndex:d}=r;l!=null&&l!==s.opacity&&n.setOpacity(l),d!=null&&d!==s.zIndex&&n.setZIndex(d)}function ya(){return Hi().map}const va=ma(function({center:r,children:s,...l},d){const p=new Lt.Circle(r,l);return Vi(p,ko(d,{overlayContainer:p}))},da);function Zi(){return Zi=Object.assign||function(n){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(n[l]=s[l])}return n},Zi.apply(this,arguments)}function ba({bounds:n,boundsOptions:r,center:s,children:l,className:d,id:p,placeholder:u,style:g,whenReady:m,zoom:f,...P},v){const[I]=O.useState({className:d,id:p,style:g}),[T,w]=O.useState(null);O.useImperativeHandle(v,()=>(T==null?void 0:T.map)??null,[T]);const k=O.useCallback(C=>{if(C!==null&&T===null){const W=new Lt.Map(C,P);s!=null&&f!=null?W.setView(s,f):n!=null&&W.fitBounds(n,r),m!=null&&W.whenReady(m),w(ua(W))}},[]);O.useEffect(()=>()=>{T==null||T.map.remove()},[T]);const R=T?Ne.createElement(To,{value:T},l):u??null;return Ne.createElement("div",Zi({},I,{ref:k}),R)}const wa=O.forwardRef(ba),Sa=xa(function({position:r,...s},l){const d=new Lt.Marker(r,s);return Vi(d,ko(l,{overlayContainer:d}))},function(r,s,l){s.position!==l.position&&r.setLatLng(s.position),s.icon!=null&&s.icon!==l.icon&&r.setIcon(s.icon),s.zIndexOffset!=null&&s.zIndexOffset!==l.zIndexOffset&&r.setZIndexOffset(s.zIndexOffset),s.opacity!=null&&s.opacity!==l.opacity&&r.setOpacity(s.opacity),r.dragging!=null&&s.draggable!==l.draggable&&(s.draggable===!0?r.dragging.enable():r.dragging.disable())}),ja=ga(function({url:r,...s},l){const d=new Lt.TileLayer(r,Ui(s,l));return Vi(d,l)},function(r,s,l){_a(r,s,l);const{url:d}=s;d!=null&&d!==l.url&&r.setUrl(d)});delete Gi.Icon.Default.prototype._getIconUrl;Gi.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const Xt=({width:n="100%",height:r="20px"})=>i.jsx("div",{style:{width:n,height:r,backgroundColor:"currentColor",opacity:.1,borderRadius:"4px"}}),Ca=({status:n,theme:r})=>{const s={Draft:{bg:r.textMuted,text:"#fff"},Scheduled:{bg:r.warning,text:"#fff"},Sending:{bg:r.primary,text:"#fff"},Completed:{bg:r.success,text:"#fff"},Cancelled:{bg:r.danger,text:"#fff"}},l=s[n]||s.Draft;return i.jsx("span",{style:{display:"inline-block",padding:"4px 10px",backgroundColor:`${l.bg}20`,color:l.bg,borderRadius:"20px",fontSize:"11px",fontWeight:"500"},children:n})},ka=({template:n,onSave:r,onClose:s,theme:l})=>{const[d,p]=O.useState((n==null?void 0:n.name)||""),[u,g]=O.useState((n==null?void 0:n.subject)||""),[m,f]=O.useState((n==null?void 0:n.body_html)||(n==null?void 0:n.body_text)||""),[P,v]=O.useState((n==null?void 0:n.category)||"general"),[I,T]=O.useState(!1),w=async()=>{T(!0);try{const C=await r({name:d,subject:u,body_html:m,body_text:m.replace(/<[^>]*>/g,""),category:P});s(C)}catch(C){console.error("Failed to save template:",C)}finally{T(!1)}},k=[{key:"{{first_name}}",label:"First Name"},{key:"{{last_name}}",label:"Last Name"},{key:"{{company_name}}",label:"Company Name"},{key:"{{email}}",label:"Email"},{key:"{{policy_type}}",label:"Policy Type"},{key:"{{policy_expiration}}",label:"Expiration Date"},{key:"{{agent_name}}",label:"Agent Name"},{key:"{{agent_phone}}",label:"Agent Phone"}],R=C=>{f(m+C)};return i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:200},onClick:()=>s(null)}),i.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"800px",maxWidth:"95vw",maxHeight:"90vh",backgroundColor:l.bgCard,borderRadius:"16px",border:`1px solid ${l.border}`,zIndex:201,display:"flex",flexDirection:"column",overflow:"hidden"},children:[i.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${l.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:l.text,margin:0},children:n?"Edit Template":"Create New Template"}),i.jsx("button",{onClick:()=>s(null),style:{background:"none",border:"none",color:l.textMuted,cursor:"pointer",fontSize:"20px"},children:""})]}),i.jsxs("div",{style:{flex:1,overflow:"auto",padding:"20px"},children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Template Name"}),i.jsx("input",{type:"text",value:d,onChange:C=>p(C.target.value),placeholder:"e.g., Welcome Email",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Category"}),i.jsxs("select",{value:P,onChange:C=>v(C.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"},children:[i.jsx("option",{value:"general",children:"General"}),i.jsx("option",{value:"welcome",children:"Welcome"}),i.jsx("option",{value:"renewal",children:"Renewal"}),i.jsx("option",{value:"cross_sell",children:"Cross-Sell"}),i.jsx("option",{value:"engagement",children:"Engagement"}),i.jsx("option",{value:"policy_update",children:"Policy Update"})]})]})]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),i.jsx("input",{type:"text",value:u,onChange:C=>g(C.target.value),placeholder:"e.g., Welcome to {{company_name}}!",style:{width:"100%",padding:"10px 12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px"}})]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Insert Merge Field"}),i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:k.map(C=>i.jsx("button",{onClick:()=>R(C.key),style:{padding:"4px 10px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"6px",color:l.textSecondary,cursor:"pointer",fontSize:"11px"},children:C.label},C.key))})]}),i.jsxs("div",{children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:l.text,display:"block",marginBottom:"6px"},children:"Email Body"}),i.jsx("textarea",{value:m,onChange:C=>f(C.target.value),placeholder:"Write your email content here. Use merge fields like {{first_name}} for personalization.",rows:10,style:{width:"100%",padding:"12px",backgroundColor:l.bgInput,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.text,fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.6"}})]})]}),i.jsxs("div",{style:{padding:"16px 20px",borderTop:`1px solid ${l.border}`,display:"flex",justifyContent:"flex-end",gap:"12px"},children:[i.jsx("button",{onClick:()=>s(null),style:{padding:"10px 20px",backgroundColor:l.bgHover,border:`1px solid ${l.border}`,borderRadius:"8px",color:l.textSecondary,cursor:"pointer",fontSize:"14px"},children:"Cancel"}),i.jsx("button",{onClick:w,disabled:I||!d||!u,style:{padding:"10px 20px",backgroundColor:l.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:I?"wait":"pointer",fontSize:"14px",fontWeight:"500",opacity:I||!d||!u?.6:1},children:I?"Creating...":"Create & Select"})]})]})]})},za=({batch:n,onView:r,theme:s})=>{var d;const l=n.total_recipients>0?Math.round(n.emails_sent/n.total_recipients*100):0;return i.jsxs("div",{style:{padding:"16px",backgroundColor:s.bgCard,borderRadius:"10px",border:`1px solid ${s.border}`,display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px"},children:[i.jsxs("div",{style:{flex:1},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"6px"},children:[i.jsx("span",{style:{fontWeight:"600",color:s.text},children:n.name||"Untitled Batch"}),i.jsx(Ca,{status:n.status,theme:s})]}),i.jsx("p",{style:{fontSize:"13px",color:s.textSecondary,margin:0},children:n.subject||"No subject"}),i.jsxs("p",{style:{fontSize:"12px",color:s.textMuted,margin:"4px 0 0"},children:[((d=n.template)==null?void 0:d.name)||"Custom email","  ",n.total_recipients||0," recipients"]})]}),n.status!=="Draft"&&i.jsxs("div",{style:{textAlign:"right",minWidth:"100px"},children:[i.jsxs("div",{style:{fontSize:"18px",fontWeight:"600",color:s.text},children:[l,"%"]}),i.jsxs("div",{style:{fontSize:"11px",color:s.textMuted},children:[n.emails_sent||0," / ",n.total_recipients||0," sent"]})]}),i.jsx("button",{onClick:()=>r(n),style:{padding:"8px 16px",backgroundColor:s.bgHover,border:`1px solid ${s.border}`,borderRadius:"6px",color:s.text,cursor:"pointer",fontSize:"13px"},children:"View"})]})},Ta=({currentStep:n,steps:r,theme:s})=>i.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"24px"},children:r.map((l,d)=>i.jsxs(Ne.Fragment,{children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",backgroundColor:d<=n?s.primary:s.bgHover,color:d<=n?"#fff":s.textMuted,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"13px",fontWeight:"600"},children:d<n?"":d+1}),i.jsx("span",{style:{fontSize:"14px",fontWeight:d===n?"600":"400",color:d<=n?s.text:s.textMuted},children:l})]}),d<r.length-1&&i.jsx("div",{style:{flex:1,height:"2px",backgroundColor:d<n?s.primary:s.border,minWidth:"40px"}})]},l))}),Pa=({selectedTemplate:n,onSelect:r,onCreateNew:s,templates:l,isLoading:d,theme:p})=>{const[u,g]=O.useState(""),m=O.useMemo(()=>l?u?l.filter(f=>f.name.toLowerCase().includes(u.toLowerCase())||f.subject.toLowerCase().includes(u.toLowerCase())):l:[],[l,u]);return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:p.text,margin:0},children:"Select an Email Template"}),i.jsxs("button",{onClick:s,style:{padding:"8px 16px",backgroundColor:p.bgHover,border:`1px solid ${p.border}`,borderRadius:"8px",color:p.text,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:"+"})," Create New Template"]})]}),i.jsxs("div",{style:{position:"relative",marginBottom:"16px"},children:[i.jsx("input",{type:"text",placeholder:"Search templates...",value:u,onChange:f=>g(f.target.value),style:{width:"100%",padding:"10px 12px 10px 36px",backgroundColor:p.bgInput,border:`1px solid ${p.border}`,borderRadius:"8px",color:p.text,fontSize:"14px"}}),i.jsx("span",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:p.textMuted},children:""})]}),d?i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"},children:Array.from({length:4}).map((f,P)=>i.jsxs("div",{style:{padding:"16px",backgroundColor:p.bgCard,borderRadius:"10px",border:`1px solid ${p.border}`},children:[i.jsx(Xt,{width:"120px",height:"16px"}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(Xt,{width:"200px",height:"14px"})})]},P))}):i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px",maxHeight:"400px",overflow:"auto"},children:m.map(f=>i.jsxs("div",{onClick:()=>r(f),style:{padding:"16px",backgroundColor:p.bgCard,borderRadius:"10px",border:`2px solid ${(n==null?void 0:n.id)===f.id?p.primary:p.border}`,cursor:"pointer",transition:"border-color 0.15s"},children:[i.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:p.text,marginBottom:"4px"},children:f.name}),i.jsx("div",{style:{fontSize:"13px",color:p.textSecondary},children:f.subject}),i.jsx("div",{style:{marginTop:"8px",padding:"4px 8px",backgroundColor:`${p.primary}15`,color:p.primary,borderRadius:"4px",fontSize:"11px",display:"inline-block",textTransform:"capitalize"},children:f.category||"General"})]},f.id))}),!d&&m.length===0&&i.jsx("div",{style:{textAlign:"center",padding:"40px",color:p.textMuted},children:u?"No templates match your search":"No templates available. Create one to get started!"})]})},uo=[{value:"account_status",label:"Account Status",type:"select",options:[{value:"customer",label:"Customer"},{value:"prospect",label:"Prospect"},{value:"prior_customer",label:"Prior Customer"},{value:"lead",label:"Lead"}]},{value:"policy_type",label:"Policy Type",type:"select",options:[{value:"Auto",label:"Auto"},{value:"Home",label:"Home"},{value:"Renters",label:"Renters"},{value:"Life",label:"Life"},{value:"Umbrella",label:"Umbrella"},{value:"Commercial",label:"Commercial"},{value:"Health",label:"Health"}]},{value:"policy_count",label:"Number of Policies",type:"number"},{value:"policy_expiration",label:"Policy Expiration",type:"date"},{value:"location",label:"Location",type:"location"},{value:"state",label:"State",type:"select",options:[{value:"AL",label:"Alabama"},{value:"AK",label:"Alaska"},{value:"AZ",label:"Arizona"},{value:"AR",label:"Arkansas"},{value:"CA",label:"California"},{value:"CO",label:"Colorado"},{value:"CT",label:"Connecticut"},{value:"DE",label:"Delaware"},{value:"FL",label:"Florida"},{value:"GA",label:"Georgia"},{value:"HI",label:"Hawaii"},{value:"ID",label:"Idaho"},{value:"IL",label:"Illinois"},{value:"IN",label:"Indiana"},{value:"IA",label:"Iowa"},{value:"KS",label:"Kansas"},{value:"KY",label:"Kentucky"},{value:"LA",label:"Louisiana"},{value:"ME",label:"Maine"},{value:"MD",label:"Maryland"},{value:"MA",label:"Massachusetts"},{value:"MI",label:"Michigan"},{value:"MN",label:"Minnesota"},{value:"MS",label:"Mississippi"},{value:"MO",label:"Missouri"},{value:"MT",label:"Montana"},{value:"NE",label:"Nebraska"},{value:"NV",label:"Nevada"},{value:"NH",label:"New Hampshire"},{value:"NJ",label:"New Jersey"},{value:"NM",label:"New Mexico"},{value:"NY",label:"New York"},{value:"NC",label:"North Carolina"},{value:"ND",label:"North Dakota"},{value:"OH",label:"Ohio"},{value:"OK",label:"Oklahoma"},{value:"OR",label:"Oregon"},{value:"PA",label:"Pennsylvania"},{value:"RI",label:"Rhode Island"},{value:"SC",label:"South Carolina"},{value:"SD",label:"South Dakota"},{value:"TN",label:"Tennessee"},{value:"TX",label:"Texas"},{value:"UT",label:"Utah"},{value:"VT",label:"Vermont"},{value:"VA",label:"Virginia"},{value:"WA",label:"Washington"},{value:"WV",label:"West Virginia"},{value:"WI",label:"Wisconsin"},{value:"WY",label:"Wyoming"}]},{value:"city",label:"City",type:"text"}],La={select:[{value:"is",label:"is"},{value:"is_not",label:"is not"},{value:"is_any",label:"is any of"}],number:[{value:"equals",label:"equals"},{value:"greater_than",label:"greater than"},{value:"less_than",label:"less than"},{value:"at_least",label:"at least"}],date:[{value:"before",label:"is before"},{value:"after",label:"is after"},{value:"between",label:"is between"},{value:"in_next_days",label:"is in the next"}],location:[{value:"within_radius",label:"is within"}],text:[{value:"contains",label:"contains"},{value:"equals",label:"equals"},{value:"starts_with",label:"starts with"}]},Ra=[5,10,15,25,50,100],Ma=({center:n,radiusMeters:r})=>{const s=ya();return O.useEffect(()=>{if(n&&r&&s){const l=r/111320,d=Gi.latLngBounds([n[0]-l,n[1]-l],[n[0]+l,n[1]+l]);s.fitBounds(d,{padding:[20,20]})}},[s,n,r]),null},Ia=({location:n,radius:r,onClose:s,theme:l})=>{if(!n)return null;const d=parseFloat(n.lat),p=parseFloat(n.lng),u=r*1609.34;return i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",zIndex:1e3},onClick:s}),i.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"600px",maxWidth:"95vw",backgroundColor:l.bgCard,borderRadius:"16px",border:`1px solid ${l.border}`,zIndex:1001,overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[i.jsxs("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${l.border}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{children:[i.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:l.text},children:"Location Radius Preview"}),i.jsxs("p",{style:{margin:"4px 0 0",fontSize:"13px",color:l.textSecondary},children:[" ",n.display]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsxs("div",{style:{padding:"6px 12px",backgroundColor:`${l.primary}15`,color:l.primary,borderRadius:"6px",fontWeight:"600",fontSize:"14px"},children:[r," mile radius"]}),i.jsx("button",{onClick:s,style:{background:"none",border:"none",color:l.textMuted,cursor:"pointer",fontSize:"24px",lineHeight:1},children:""})]})]}),i.jsx("div",{style:{height:"400px"},children:i.jsxs(wa,{center:[d,p],zoom:10,style:{height:"100%",width:"100%"},children:[i.jsx(ja,{attribution:' <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),i.jsx(va,{center:[d,p],radius:u,pathOptions:{color:l.primary,fillColor:l.primary,fillOpacity:.2,weight:3}}),i.jsx(Sa,{position:[d,p]}),i.jsx(Ma,{center:[d,p],radiusMeters:u})]})}),i.jsx("div",{style:{padding:"12px 20px",borderTop:`1px solid ${l.border}`,backgroundColor:l.bgHover,fontSize:"12px",color:l.textSecondary,textAlign:"center"},children:"Recipients within this area will be included in your campaign"})]})]})},Aa=({location:n,radius:r,theme:s})=>{const[l,d]=O.useState(!1);return n?i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{marginTop:"12px",borderRadius:"8px",overflow:"hidden",border:`1px solid ${s.border}`},children:i.jsxs("div",{style:{padding:"12px 16px",backgroundColor:s.bgHover,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx("span",{style:{fontSize:"20px"},children:""}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:s.text},children:n.display}),i.jsxs("div",{style:{fontSize:"12px",color:s.textSecondary},children:[r," mile radius"]})]})]}),i.jsx("button",{onClick:()=>d(!0),style:{padding:"8px 16px",backgroundColor:s.primary,border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:" View Map"})]})}),l&&i.jsx(Ia,{location:n,radius:r,onClose:()=>d(!1),theme:s})]}):null},Ea=({rule:n,index:r,onUpdate:s,onRemove:l,theme:d})=>{const p=uo.find(f=>f.value===n.field),u=p?La[p.type]:[],g={padding:"8px 12px",backgroundColor:d.bgInput,border:`1px solid ${d.border}`,borderRadius:"6px",color:d.text,fontSize:"13px",minWidth:"140px"},m={padding:"8px 12px",backgroundColor:d.bgInput,border:`1px solid ${d.border}`,borderRadius:"6px",color:d.text,fontSize:"13px",width:"120px"};return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:d.bgCard,borderRadius:"8px",border:`1px solid ${d.border}`,flexWrap:"wrap"},children:[r>0&&i.jsx("span",{style:{fontSize:"12px",color:d.primary,fontWeight:"600",padding:"4px 8px",backgroundColor:`${d.primary}15`,borderRadius:"4px"},children:"AND"}),i.jsxs("select",{value:n.field||"",onChange:f=>s(r,{...n,field:f.target.value,operator:"",value:""}),style:g,children:[i.jsx("option",{value:"",children:"Select field..."}),uo.map(f=>i.jsx("option",{value:f.value,children:f.label},f.value))]}),n.field&&i.jsxs("select",{value:n.operator||"",onChange:f=>s(r,{...n,operator:f.target.value}),style:g,children:[i.jsx("option",{value:"",children:"Select condition..."}),u.map(f=>i.jsx("option",{value:f.value,children:f.label},f.value))]}),n.field&&n.operator&&i.jsxs(i.Fragment,{children:[(p==null?void 0:p.type)==="select"&&n.operator!=="is_any"&&i.jsxs("select",{value:n.value||"",onChange:f=>s(r,{...n,value:f.target.value}),style:g,children:[i.jsx("option",{value:"",children:"Select value..."}),p.options.map(f=>i.jsx("option",{value:f.value,children:f.label},f.value))]}),(p==null?void 0:p.type)==="select"&&n.operator==="is_any"&&i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:p.options.map(f=>i.jsx("button",{onClick:()=>{const P=n.value?n.value.split(","):[],v=P.includes(f.value)?P.filter(I=>I!==f.value):[...P,f.value];s(r,{...n,value:v.join(",")})},style:{padding:"4px 10px",backgroundColor:(n.value||"").split(",").includes(f.value)?d.primary:d.bgHover,color:(n.value||"").split(",").includes(f.value)?"#fff":d.text,border:`1px solid ${(n.value||"").split(",").includes(f.value)?d.primary:d.border}`,borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:f.label},f.value))}),(p==null?void 0:p.type)==="number"&&i.jsx("input",{type:"number",value:n.value||"",onChange:f=>s(r,{...n,value:f.target.value}),placeholder:"0",style:m}),(p==null?void 0:p.type)==="date"&&n.operator==="in_next_days"&&i.jsxs(i.Fragment,{children:[i.jsx("input",{type:"number",value:n.value||"",onChange:f=>s(r,{...n,value:f.target.value}),placeholder:"30",style:{...m,width:"70px"}}),i.jsx("span",{style:{fontSize:"13px",color:d.textSecondary},children:"days"})]}),(p==null?void 0:p.type)==="date"&&n.operator==="between"&&i.jsxs(i.Fragment,{children:[i.jsx("input",{type:"date",value:n.value||"",onChange:f=>s(r,{...n,value:f.target.value}),style:m}),i.jsx("span",{style:{fontSize:"13px",color:d.textSecondary},children:"and"}),i.jsx("input",{type:"date",value:n.value2||"",onChange:f=>s(r,{...n,value2:f.target.value}),style:m})]}),(p==null?void 0:p.type)==="date"&&(n.operator==="before"||n.operator==="after")&&i.jsx("input",{type:"date",value:n.value||"",onChange:f=>s(r,{...n,value:f.target.value}),style:m}),(p==null?void 0:p.type)==="text"&&i.jsx("input",{type:"text",value:n.value||"",onChange:f=>s(r,{...n,value:f.target.value}),placeholder:`Enter ${p.label.toLowerCase()}...`,style:{...m,width:"160px"}}),(p==null?void 0:p.type)==="location"&&i.jsx(Ba,{rule:n,onUpdate:f=>s(r,{...n,...f}),theme:d})]}),i.jsx("button",{onClick:()=>l(r),style:{marginLeft:"auto",padding:"6px 10px",backgroundColor:"transparent",border:"none",color:d.textMuted,cursor:"pointer",fontSize:"16px",borderRadius:"4px"},title:"Remove filter",children:""})]})},Ba=({rule:n,onUpdate:r,theme:s})=>{const[l,d]=O.useState(n.locationDisplay||""),[p,u]=O.useState(!1),[g,m]=O.useState([]),[f,P]=O.useState(!1),v={padding:"8px 12px",backgroundColor:s.bgInput,border:`1px solid ${s.border}`,borderRadius:"6px",color:s.text,fontSize:"13px"},I=async w=>{if(w.length<3){m([]);return}u(!0);try{const R=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&q=${encodeURIComponent(w)}&limit=5`,{headers:{"Accept-Language":"en"}})).json();m(R.map(C=>({display:C.display_name,lat:C.lat,lng:C.lon,type:C.type}))),P(!0)}catch(k){console.error("Geocoding error:",k),m([])}finally{u(!1)}};Ne.useEffect(()=>{const w=setTimeout(()=>{l&&l!==n.locationDisplay&&I(l)},300);return()=>clearTimeout(w)},[l]);const T=w=>{d(w.display.split(",").slice(0,2).join(",")),r({value:`${w.lat},${w.lng}`,locationDisplay:w.display.split(",").slice(0,2).join(","),locationData:w}),P(!1)};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",flex:1,minWidth:"300px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[i.jsxs("div",{style:{position:"relative",flex:1,minWidth:"200px"},children:[i.jsx("input",{type:"text",value:l,onChange:w=>d(w.target.value),onFocus:()=>g.length>0&&P(!0),placeholder:"Enter zip code, city, or address...",style:{...v,width:"100%",paddingRight:"30px"}}),p&&i.jsx("span",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:s.textMuted,fontSize:"12px"},children:"..."}),f&&g.length>0&&i.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:s.bgCard,border:`1px solid ${s.border}`,borderRadius:"6px",marginTop:"4px",zIndex:100,maxHeight:"200px",overflow:"auto",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:g.map((w,k)=>i.jsxs("button",{onClick:()=>T(w),style:{width:"100%",padding:"10px 12px",backgroundColor:"transparent",border:"none",borderBottom:k<g.length-1?`1px solid ${s.border}`:"none",color:s.text,fontSize:"12px",textAlign:"left",cursor:"pointer",display:"flex",alignItems:"flex-start",gap:"8px"},onMouseEnter:R=>R.target.style.backgroundColor=s.bgHover,onMouseLeave:R=>R.target.style.backgroundColor="transparent",children:[i.jsx("span",{children:""}),i.jsx("span",{style:{lineHeight:"1.4"},children:w.display})]},k))})]}),i.jsx("span",{style:{fontSize:"13px",color:s.textSecondary},children:"of"}),i.jsx("select",{value:n.radius||"25",onChange:w=>r({radius:w.target.value}),style:{...v,minWidth:"100px"},children:Ra.map(w=>i.jsxs("option",{value:w,children:[w," miles"]},w))})]}),n.locationData&&i.jsx(Aa,{location:n.locationData,radius:parseInt(n.radius||"25",10),theme:s})]})},Oa=({filterConfig:n,setFilterConfig:r,recipientCount:s,isLoading:l,theme:d})=>{const p=n.rules||[],u=()=>{r({...n,rules:[...p,{field:"",operator:"",value:""}]})},g=(v,I)=>{const T=[...p];T[v]=I,r({...n,rules:T})},m=v=>{const I=p.filter((T,w)=>w!==v);r({...n,rules:I})},f=()=>{r({...n,rules:[],search:""})},P=p.filter(v=>v.field&&v.operator&&v.value).length;return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:d.text,margin:0},children:"Filter Recipients"}),(p.length>0||n.search)&&i.jsx("button",{onClick:f,style:{padding:"6px 12px",backgroundColor:"transparent",border:`1px solid ${d.border}`,borderRadius:"6px",color:d.textSecondary,cursor:"pointer",fontSize:"12px"},children:"Clear all"})]}),i.jsxs("div",{style:{padding:"16px",backgroundColor:d.bgHover,borderRadius:"12px",marginBottom:"16px"},children:[p.length===0?i.jsx("div",{style:{textAlign:"center",padding:"20px",color:d.textMuted,fontSize:"14px"},children:"No filters applied. All accounts with valid emails will be included."}):i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"12px"},children:p.map((v,I)=>i.jsx(Ea,{rule:v,index:I,onUpdate:g,onRemove:m,theme:d},I))}),i.jsxs("button",{onClick:u,style:{width:"100%",padding:"10px",backgroundColor:d.bgCard,border:`1px dashed ${d.border}`,borderRadius:"8px",color:d.primary,cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[i.jsx("span",{children:"+"})," Add Filter"]})]}),P>0&&i.jsxs("div",{style:{padding:"12px 16px",backgroundColor:`${d.primary}10`,borderRadius:"8px",marginBottom:"16px",fontSize:"13px",color:d.text},children:[i.jsx("strong",{children:P})," filter",P!==1?"s":""," applied",i.jsx("span",{style:{color:d.textSecondary},children:"  results update automatically"})]}),i.jsxs("div",{style:{padding:"16px",backgroundColor:d.bgCard,borderRadius:"12px",border:`1px solid ${d.border}`,marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:d.text,display:"block",marginBottom:"8px"},children:"Search by Name or Email"}),i.jsx("input",{type:"text",placeholder:"Type to search...",value:n.search||"",onChange:v=>r({...n,search:v.target.value}),style:{width:"100%",padding:"10px 12px",backgroundColor:d.bgInput,border:`1px solid ${d.border}`,borderRadius:"8px",color:d.text,fontSize:"14px"}})]}),i.jsxs("div",{style:{padding:"20px",backgroundColor:`${d.primary}10`,borderRadius:"12px",border:`1px solid ${d.primary}30`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:d.text},children:"Matching Recipients"}),i.jsx("div",{style:{fontSize:"12px",color:d.textSecondary},children:"Accounts with valid emails who haven't opted out"})]}),i.jsx("div",{style:{fontSize:"28px",fontWeight:"700",color:d.primary},children:l?"...":(s||0).toLocaleString()})]})]})},Da=({template:n,filterConfig:r,subject:s,setSubject:l,name:d,setName:p,recipients:u,isLoadingRecipients:g,theme:m})=>i.jsxs("div",{children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:m.text,marginBottom:"16px"},children:"Review & Send"}),i.jsxs("div",{style:{padding:"20px",backgroundColor:m.bgCard,borderRadius:"12px",border:`1px solid ${m.border}`,marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:m.text,display:"block",marginBottom:"6px"},children:"Campaign Name"}),i.jsx("input",{type:"text",placeholder:"e.g., December Newsletter",value:d,onChange:f=>p(f.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:m.bgInput,border:`1px solid ${m.border}`,borderRadius:"8px",color:m.text,fontSize:"14px"}})]}),i.jsxs("div",{style:{padding:"20px",backgroundColor:m.bgCard,borderRadius:"12px",border:`1px solid ${m.border}`,marginBottom:"16px"},children:[i.jsx("label",{style:{fontSize:"13px",fontWeight:"500",color:m.text,display:"block",marginBottom:"6px"},children:"Subject Line"}),i.jsx("input",{type:"text",placeholder:"Email subject...",value:s,onChange:f=>l(f.target.value),style:{width:"100%",padding:"10px 12px",backgroundColor:m.bgInput,border:`1px solid ${m.border}`,borderRadius:"8px",color:m.text,fontSize:"14px"}}),i.jsxs("p",{style:{fontSize:"12px",color:m.textMuted,marginTop:"6px"},children:["Use merge fields like ","{{first_name}}"," for personalization"]})]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[i.jsxs("div",{style:{padding:"16px",backgroundColor:m.bgCard,borderRadius:"12px",border:`1px solid ${m.border}`},children:[i.jsx("div",{style:{fontSize:"12px",color:m.textMuted,marginBottom:"4px"},children:"Template"}),i.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:m.text},children:n==null?void 0:n.name})]}),i.jsxs("div",{style:{padding:"16px",backgroundColor:m.bgCard,borderRadius:"12px",border:`1px solid ${m.border}`},children:[i.jsx("div",{style:{fontSize:"12px",color:m.textMuted,marginBottom:"4px"},children:"Recipients"}),i.jsxs("div",{style:{fontSize:"14px",fontWeight:"600",color:m.text},children:[g?"...":((u==null?void 0:u.length)||0).toLocaleString()," accounts"]})]})]}),u&&u.length>0&&i.jsxs("div",{style:{padding:"16px",backgroundColor:m.bgCard,borderRadius:"12px",border:`1px solid ${m.border}`},children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:m.text,marginBottom:"12px"},children:"Preview Recipients (first 10)"}),i.jsx("div",{style:{maxHeight:"200px",overflow:"auto"},children:u.slice(0,10).map((f,P)=>i.jsxs("div",{style:{padding:"8px 0",borderBottom:P<Math.min(9,u.length-1)?`1px solid ${m.border}`:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"13px",color:m.text},children:f.primary_contact_first_name?`${f.primary_contact_first_name} ${f.primary_contact_last_name||""}`:f.name}),i.jsx("div",{style:{fontSize:"12px",color:m.textMuted},children:f.person_email||f.email})]}),i.jsx("span",{style:{padding:"2px 8px",backgroundColor:m.bgHover,color:m.textSecondary,borderRadius:"4px",fontSize:"11px",textTransform:"capitalize"},children:f.account_status})]},f.account_unique_id))}),u.length>10&&i.jsxs("div",{style:{fontSize:"12px",color:m.textMuted,marginTop:"8px",textAlign:"center"},children:["+",u.length-10," more recipients"]})]})]}),Wa=({t:n})=>{const{userId:r}=_e(),[s,l]=O.useState(!1),[d,p]=O.useState(!1),[u,g]=O.useState(0),[m,f]=O.useState(null),[P,v]=O.useState({rules:[],search:"",notOptedOut:!0}),[I,T]=O.useState(""),[w,k]=O.useState(""),[R,C]=O.useState(!1),[W,Z]=O.useState(null),[B,z]=O.useState(null),{data:N,isLoading:Q,refetch:K}=fo(),{data:se,isLoading:X,refetch:_}=Es(),{data:S,isLoading:E}=Os(u>=1?P:null),{data:M,isLoading:$}=Bs(u===2?P:null,{limit:100}),{createBatch:U,scheduleBatch:te}=Ds(),{createTemplate:H}=xo(),Se=["Select Template","Filter Recipients","Review & Send"],D=de=>{f(de),T(de.subject||"")},ne=async de=>{const Ze=await H.mutateAsync(de);return await K(),Ze},ae=de=>{p(!1),de&&(f(de),T(de.subject||""))},be=()=>{u<2&&g(u+1)},pe=()=>{u>0&&g(u-1)},re=async()=>{if(!(!m||!I)){C(!0),Z(null);try{const de=await U.mutateAsync({name:w||`Mass Email - ${new Date().toLocaleDateString()}`,subject:I,template_id:m.id,filter_config:P,total_recipients:S||0});await te.mutateAsync({batchId:de.id}),z(`Successfully scheduled ${S} emails for sending!`),l(!1),ee(),_()}catch(de){Z(de.message||"Failed to send mass email")}finally{C(!1)}}},ee=()=>{g(0),f(null),v({rules:[],search:"",notOptedOut:!0}),T(""),k("")},me=()=>u===0?!!m:u===1?(S||0)>0:u===2?!!I&&!!w:!1;return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"24px"},children:[i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Mass Email"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px",margin:0},children:"Send one-off emails to filtered recipients"})]}),!s&&i.jsxs("button",{onClick:()=>l(!0),style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:"+"})," New Campaign"]})]}),B&&i.jsxs("div",{style:{padding:"16px",backgroundColor:`${n.success}15`,border:`1px solid ${n.success}30`,borderRadius:"8px",marginBottom:"24px",color:n.success,fontSize:"14px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[B,i.jsx("button",{onClick:()=>z(null),style:{background:"none",border:"none",color:n.success,cursor:"pointer"},children:""})]}),s?i.jsxs("div",{style:{backgroundColor:n.bgCard,borderRadius:"16px",border:`1px solid ${n.border}`,padding:"24px"},children:[i.jsx(Ta,{currentStep:u,steps:Se,theme:n}),W&&i.jsx("div",{style:{padding:"12px 16px",backgroundColor:`${n.danger}15`,border:`1px solid ${n.danger}30`,borderRadius:"8px",marginBottom:"16px",color:n.danger,fontSize:"14px"},children:W}),i.jsxs("div",{style:{minHeight:"300px"},children:[u===0&&i.jsx(Pa,{selectedTemplate:m,onSelect:D,onCreateNew:()=>p(!0),templates:N,isLoading:Q,theme:n}),u===1&&i.jsx(Oa,{filterConfig:P,setFilterConfig:v,recipientCount:S,isLoading:E,theme:n}),u===2&&i.jsx(Da,{template:m,filterConfig:P,subject:I,setSubject:T,name:w,setName:k,recipients:M,isLoadingRecipients:$,theme:n})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"24px",borderTop:`1px solid ${n.border}`,marginTop:"24px"},children:[i.jsx("button",{onClick:()=>{u===0?(l(!1),ee()):pe()},style:{padding:"10px 20px",backgroundColor:n.bgHover,border:`1px solid ${n.border}`,borderRadius:"8px",color:n.text,cursor:"pointer",fontSize:"14px"},children:u===0?"Cancel":"Back"}),u<2?i.jsx("button",{onClick:be,disabled:!me(),style:{padding:"10px 24px",backgroundColor:me()?n.primary:n.bgHover,border:"none",borderRadius:"8px",color:me()?"#fff":n.textMuted,cursor:me()?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500"},children:"Continue"}):i.jsx("button",{onClick:re,disabled:!me()||R,style:{padding:"10px 24px",backgroundColor:me()&&!R?n.success:n.bgHover,border:"none",borderRadius:"8px",color:me()&&!R?"#fff":n.textMuted,cursor:me()&&!R?"pointer":"not-allowed",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px"},children:R?"Sending...":"Send Emails"})]})]}):i.jsx(i.Fragment,{children:i.jsxs("div",{style:{marginBottom:"24px"},children:[i.jsx("h2",{style:{fontSize:"16px",fontWeight:"600",color:n.text,marginBottom:"16px"},children:"Recent Campaigns"}),X?i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:Array.from({length:3}).map((de,Ze)=>i.jsxs("div",{style:{padding:"16px",backgroundColor:n.bgCard,borderRadius:"10px",border:`1px solid ${n.border}`},children:[i.jsx(Xt,{width:"200px",height:"18px"}),i.jsx("div",{style:{marginTop:"8px"},children:i.jsx(Xt,{width:"300px",height:"14px"})})]},Ze))}):se&&se.length>0?i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:se.map(de=>i.jsx(za,{batch:de,onView:Ze=>console.log("View batch:",Ze),theme:n},de.id))}):i.jsxs("div",{style:{padding:"60px 20px",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`,textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:n.text,marginBottom:"8px"},children:"No campaigns yet"}),i.jsx("p",{style:{fontSize:"14px",color:n.textSecondary,marginBottom:"24px"},children:"Create your first mass email campaign to reach your clients."}),i.jsx("button",{onClick:()=>l(!0),style:{padding:"10px 20px",backgroundColor:n.primary,border:"none",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Create Your First Campaign"})]})]})}),d&&i.jsx(ka,{template:null,onSave:ne,onClose:ae,theme:n})]})},qa=O.createContext(),Wi={light:{bg:"#f8fafc",bgCard:"#ffffff",bgSidebar:"#ffffff",bgHover:"#f1f5f9",bgInput:"#ffffff",border:"#e2e8f0",borderLight:"#f1f5f9",text:"#1e293b",textSecondary:"#64748b",textMuted:"#94a3b8",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"},dark:{bg:"#09090b",bgCard:"#18181b",bgSidebar:"#18181b",bgHover:"#27272a",bgInput:"#27272a",border:"#27272a",borderLight:"#3f3f46",text:"#fafafa",textSecondary:"#a1a1aa",textMuted:"#71717a",primary:"#3b82f6",primaryHover:"#2563eb",success:"#22c55e",danger:"#ef4444",warning:"#f59e0b",purple:"#a78bfa"}},Na=O.createContext(),Za=()=>{const{userId:n}=_e(),r=po();ut();const[s,l]=O.useState(!1),[d,p]=O.useState({id:n,name:"Logan Johns",email:"info@isgdfw.com",org:"ISG"}),u=s?Wi.dark:Wi.light,m=(()=>{const P=r.pathname.split("/").slice(2).join("/");return P.startsWith("automations/")?"automations":P.startsWith("accounts/")?"accounts":P||"dashboard"})(),f=[{id:"dashboard",label:"Dashboard",icon:"",path:`/${n}/dashboard`},{id:"automations",label:"Automations",icon:"",path:`/${n}/automations`},{id:"templates",label:"Templates",icon:"",path:`/${n}/templates`},{id:"mass-email",label:"Mass Email",icon:"",path:`/${n}/mass-email`},{id:"accounts",label:"Accounts",icon:"",path:`/${n}/accounts`},{id:"settings",label:"Settings",icon:"",path:`/${n}/settings`}];return i.jsx(qa.Provider,{value:{isDark:s,setIsDark:l,t:u,themes:Wi},children:i.jsx(Na.Provider,{value:{userId:n,currentUser:d,setCurrentUser:p},children:i.jsxs("div",{style:{fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",backgroundColor:u.bg,minHeight:"100vh",display:"flex",color:u.text},children:[i.jsxs("div",{style:{width:"220px",backgroundColor:u.bgSidebar,borderRight:`1px solid ${u.border}`,display:"flex",flexDirection:"column",position:"fixed",top:0,left:0,bottom:0},children:[i.jsx("div",{style:{padding:"20px 16px",borderBottom:`1px solid ${u.border}`},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx("div",{style:{width:"36px",height:"36px",backgroundColor:u.primary,borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:"18px"},children:""}),i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:"700",fontSize:"14px",color:u.text},children:"Email Automation"}),i.jsx("div",{style:{fontSize:"11px",color:u.textMuted},children:"Marketing System"})]})]})}),i.jsxs("div",{style:{flex:1,padding:"12px 8px"},children:[i.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:u.textMuted,padding:"8px 12px",textTransform:"uppercase"},children:"Navigation"}),f.map(P=>i.jsxs(Xe,{to:P.path,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:m===P.id?`${u.primary}15`:"transparent",border:"none",borderRadius:"8px",color:m===P.id?u.primary:u.textSecondary,cursor:"pointer",fontSize:"13px",fontWeight:m===P.id?"600":"400",textAlign:"left",alignItems:"center",gap:"10px",marginBottom:"2px",textDecoration:"none"},children:[i.jsx("span",{children:P.icon})," ",P.label]},P.id)),i.jsx("div",{style:{fontSize:"10px",fontWeight:"600",color:u.textMuted,padding:"16px 12px 8px",textTransform:"uppercase"},children:"Admin"}),i.jsxs(Xe,{to:`/${n}/timeline`,style:{display:"flex",width:"100%",padding:"10px 12px",backgroundColor:m==="timeline"?`${u.primary}15`:"transparent",border:"none",borderRadius:"8px",color:m==="timeline"?u.primary:u.textSecondary,cursor:"pointer",fontSize:"13px",textAlign:"left",alignItems:"center",gap:"10px",textDecoration:"none"},children:[i.jsx("span",{children:""})," Timeline",i.jsx("span",{style:{marginLeft:"auto",padding:"2px 8px",backgroundColor:u.bgHover,borderRadius:"4px",fontSize:"10px",color:u.textMuted},children:"Admin"})]})]}),i.jsxs("div",{style:{padding:"16px",borderTop:`1px solid ${u.border}`,display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx("div",{style:{width:"32px",height:"32px",backgroundColor:u.bgHover,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px"},children:""}),i.jsxs("div",{style:{flex:1},children:[i.jsx("div",{style:{fontSize:"13px",fontWeight:"500",color:u.text},children:d.name}),i.jsx("div",{style:{fontSize:"11px",color:u.textMuted},children:d.email})]}),i.jsx(Xe,{to:`/${n}/settings`,style:{color:u.textMuted,fontSize:"16px",textDecoration:"none"},children:""})]})]}),i.jsxs("div",{style:{flex:1,marginLeft:"220px"},children:[i.jsxs("div",{style:{padding:"12px 24px",borderBottom:`1px solid ${u.border}`,display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:u.bgCard},children:[i.jsxs("div",{style:{fontSize:"11px",color:u.textMuted},children:["User: ",n==null?void 0:n.substring(0,8),"..."]}),i.jsx("button",{onClick:()=>l(!s),style:{padding:"8px 12px",backgroundColor:u.bgHover,border:`1px solid ${u.border}`,borderRadius:"8px",color:u.text,cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:s?" Light":" Dark"})]}),i.jsx("div",{style:{padding:"24px"},children:i.jsxs(ho,{children:[i.jsx(Ce,{path:"dashboard",element:i.jsx(ao,{t:u})}),i.jsx(Ce,{path:"automations",element:i.jsx($s,{t:u})}),i.jsx(Ce,{path:"automations/new",element:i.jsx(co,{t:u})}),i.jsx(Ce,{path:"automations/:automationId",element:i.jsx(co,{t:u})}),i.jsx(Ce,{path:"templates",element:i.jsx(Gs,{t:u})}),i.jsx(Ce,{path:"mass-email",element:i.jsx(Wa,{t:u})}),i.jsx(Ce,{path:"accounts",element:i.jsx(Js,{t:u})}),i.jsx(Ce,{path:"accounts/:accountId",element:i.jsx(ta,{t:u})}),i.jsx(Ce,{path:"settings",element:i.jsx(oa,{t:u})}),i.jsx(Ce,{path:"timeline",element:i.jsx(Fa,{t:u})}),i.jsx(Ce,{path:"*",element:i.jsx(ao,{t:u})})]})})]})]})})})},Fa=({t:n})=>i.jsxs("div",{children:[i.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:n.text,marginBottom:"4px"},children:"Activity Timeline"}),i.jsx("p",{style:{color:n.textSecondary,fontSize:"14px"},children:"View all email activity across your organization"}),i.jsxs("div",{style:{marginTop:"24px",padding:"60px",textAlign:"center",backgroundColor:n.bgCard,borderRadius:"12px",border:`1px solid ${n.border}`},children:[i.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),i.jsx("p",{style:{color:n.textMuted},children:"Timeline view coming soon..."})]})]}),$a=()=>{const n=ut();return O.useEffect(()=>{n("/0056g000004jvyVAAQ/dashboard")},[n]),i.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",fontFamily:"'Inter', sans-serif"},children:i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("div",{style:{fontSize:"32px",marginBottom:"16px"},children:""}),i.jsx("div",{children:"Loading..."})]})})},Ha=()=>i.jsxs(os,{client:us,children:[i.jsx(ls,{children:i.jsxs(ho,{children:[i.jsx(Ce,{path:"/",element:i.jsx($a,{})}),i.jsx(Ce,{path:"/:userId/*",element:i.jsx(Za,{})})]})}),i.jsx(cs,{initialIsOpen:!1})]});qi.createRoot(document.getElementById("root")).render(i.jsx(Ne.StrictMode,{children:i.jsx(Ha,{})}));
